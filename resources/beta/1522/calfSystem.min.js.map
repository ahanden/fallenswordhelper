{"version":3,"sources":["modules/common/getElement.js","modules/support/debug.js","modules/support/gmApi.js","modules/system/fallback.js","modules/system/createDocument.js","modules/system/setValue.js","modules/support/layout.js","modules/support/fshGa.js","modules/support/sch.js","modules/support/task.js","modules/support/calf.js","modules/common/dragStart.js","modules/system/escapeHtml.js","modules/support/defaultQuickSearchList.js","modules/support/dataObj.js","modules/system/getValue.js","modules/common/jsonParse.js","modules/system/getValueJSON.js","modules/system/system.js","modules/chrome/doQuickLinks.js","modules/system/getCustomUrlParameter.js","modules/system/getUrlParameter.js","modules/chrome/isMessageSound.js","modules/common/afterBegin.js","modules/chrome/changeGuildLogHREF.js","modules/ajax/getForage.js","modules/common/extend.js","modules/ajax/retryAjax.js","modules/app/callApp.js","modules/ajax/setForage.js","modules/guild/guildTracker/indexConstants.js","modules/guild/guildActivity.js","modules/app/guild/manage.js","modules/system/getRandomInt.js","modules/common/insertElementBefore.js","modules/common/isType.js","modules/common/isFunction.js","modules/common/jQueryPresent.js","modules/system/rnd.js","modules/composing/composing.js","modules/common/levelHighlight.js","modules/common/cElement.js","modules/common/jQueryNotPresent.js","modules/lists/makePageHeader.js","modules/lists/makePageTemplate.js","modules/system/intValue.js","modules/monstorLog.js","modules/combatLog.js","modules/misc.js","modules/chrome/jQueryDialog.js","modules/chrome/injectFSBoxLog.js","modules/buffLog/injectBuffLog.js","modules/system/addCommas.js","modules/common/doSortParams.js","modules/system/path.js","modules/system/sortDesc.js","modules/system/numberSort.js","modules/system/stringSort.js","modules/common/jConfirm.js","modules/onlinePlayers.js","modules/common/currentGuildId.js","modules/recipeMgr/generateRecipeTable.js","modules/system/shouldBeArray.js","modules/common/insertElement.js","modules/recipeMgr/processFirstPage.js","modules/recipeMgr/parseInventing.js","modules/common/jsonFail.js","modules/quickExtract.js","modules/recipeMgr/recipeMgr.js","modules/common/eventHandler.js","modules/ajax/getInventory.js","modules/common/outputResult.js","modules/app/profile/useitem.js","modules/quickWear/createQuickWear.js","modules/ajax/dialog.js","modules/ajax/equipItem.js","modules/quickWear/showAHInvManager.js","modules/system/isChecked.js","modules/settings/simple.js","modules/quickWear/quickWear.js","modules/settings/settingObj.js","modules/settings/simpleCheckbox.js","modules/common/toggleForce.js","modules/app/errorDialog.js","modules/ajax/useItem.js","modules/lists/lists.js","modules/app/profile/loadInventory.js","modules/system/setValueJSON.js","modules/support/buffObj.js","modules/common/colouredDots.js","modules/findBuffs/pageLayout.js","modules/common/moreToDo.js","modules/findBuffs/parseProfileAndDisplay.js","modules/findBuffs/assets.js","modules/findBuffs/findBuffs.js","modules/chrome/helperMenu.js","modules/chrome/accordion.js","modules/chrome/messaging.js","modules/system/parseDateAsTimestamp.js","modules/news/injectHomePageTwoLink.js","modules/notification/injectJoinAllLink.js","modules/common/insertElementAfter.js","modules/chrome/injectServerNode.js","modules/notification/displayDisconnectedFromGodsMessage.js","modules/notification/parseTemplePage.js","modules/notification/injectTempleAlert.js","modules/notification/displayUpgradeMsg.js","modules/notification/parseGoldUpgrades.js","modules/notification/injectUpgradeAlert.js","modules/chrome/navMenu.js","modules/system/outputFormat.js","modules/system/formatLastActivity.js","modules/ajax/getProfile.js","modules/ajax/myStats.js","modules/common/openQuickBuffByName.js","modules/chrome/allyEnemy.js","modules/activeWantedBounties/lists.js","modules/activeWantedBounties/findTarget.js","modules/activeWantedBounties/createDivs.js","modules/activeWantedBounties/injectBountyList.js","modules/activeWantedBounties/injectWantedList.js","modules/activeWantedBounties/parseBountyPageForWorld.js","modules/activeWantedBounties/activeWantedBounties.js","modules/chrome/keyHandler.js","modules/newMap/sendGold.js","modules/system/findNodes.js","modules/system/findNode.js","modules/seLog/seLog.js","modules/chrome/scoutTowerLink.js","modules/app/superelite.js","modules/chrome/statBar.js","modules/common/updateHCSQuickBuffLinks.js","modules/chrome/widgets.js","modules/system/padZ.js","modules/chrome/calc.js","modules/chrome/lookForHcsData.js","modules/guide/allowBack.js","modules/arena/assets.js","modules/common/perfFilter.js","modules/composing/breakdown.js","modules/arena/completedArenas.js","modules/ajax/getInventoryById.js","modules/craftForge/craftForge.js","modules/common/makeFolderSpans.js","modules/common/collapse.js","modules/guild/hall.js","modules/common/closest.js","modules/mailbox/guildMailbox.js","modules/ajax/getMembrList.js","modules/guildAdvisor.js","modules/arena/arena.js","modules/common/isObject.js","modules/bazaar.js","modules/system/testRange.js","modules/system/testQuant.js","modules/app/potionbazaar/buyitem.js","modules/profile/bio/bioEvtHdl.js","modules/profile/bio/bioWidgets.js","modules/groups/injectGroupStats.js","modules/groups/groups.js","modules/guild/guildTracker/trackerTable.js","modules/guild/guildTracker/rawData.js","modules/guild/guildTracker/guildTracker.js","modules/guild/guild.js","modules/rank.js","modules/common/insertTextBeforeEnd.js","modules/profile/bio/render.js","modules/ajax/getMercStats.js","modules/ajax/groupViewStats.js","modules/common/doBuffLinks.js","modules/ajax/getGroupStats.js","modules/common/alpha.js","modules/common/formatLocalDateTime.js","modules/common/toggleVisibilty.js","modules/system/getIntFromRegExp.js","modules/guild/guildUtils.js","modules/guild/injectGuildAddTagsWidgets.js","modules/app/guild/inventory/takeitem.js","modules/inventory/assets.js","modules/inventory/options.js","modules/inventory/render/craftRender.js","modules/inventory/render/createdRow.js","modules/inventory/render/gsRender.js","modules/inventory/render/wearUseRender.js","modules/inventory/render/whereData.js","modules/inventory/render/playerName.js","modules/system/isSelected.js","modules/inventory/table.js","modules/inventory/render/nameRender.js","modules/inventory/render/whereRender.js","modules/inventory/render/whereRenderDisplay.js","modules/inventory/render/whereRenderFilter.js","modules/inventory/render/durabilityRender.js","modules/inventory/render/bpRender.js","modules/inventory/render/dropRender.js","modules/inventory/render/sendRender.js","modules/inventory/setChecks.js","modules/inventory/eventHandlers/allChecks.js","modules/inventory/eventHandlers/changeLvls.js","modules/inventory/eventHandlers/clearChecks.js","modules/inventory/eventHandlers/doAction.js","modules/ajax/dropItem.js","modules/inventory/eventHandlers/getChecks.js","modules/ajax/moveItem.js","modules/inventory/eventHandlers/resetChecks.js","modules/inventory/eventHandlers/resetLvls.js","modules/ajax/sendItem.js","modules/ajaxQueue/queue.js","modules/ajax/takeItem.js","modules/ajax/backpack.js","modules/app/guild/inventory/recall.js","modules/inventory/eventHandlers/eventHandlers.js","modules/app/guild/inventory/dostoreitems.js","modules/inventory/filters.js","modules/logs/addGuildLogWidgets.js","modules/logs/addLogColoring.js","modules/inventory/inventory.js","modules/inventory/decorate.js","modules/inventory/headers.js","modules/inventory/setLvls.js","modules/inventory/clearButton.js","modules/mailbox/mailbox.js","modules/newGuildLog/profiler.js","modules/newGuildLog/assets.js","modules/newGuildLog/newGuildLog.js","modules/profile/ajaxifyProfileSections.js","modules/common/addStatTotalToMouseover.js","modules/profile/debuff.js","modules/profile/nekidBtn.js","modules/profile/components.js","modules/profile/fastWear.js","modules/app/profile/unequipitem.js","modules/profile/profileInjectGuildRel.js","modules/profile/profileInjectQuickButton.js","modules/profile/profileAllyEnemy.js","modules/profile/bio/bio.js","modules/profile/selectAllLink.js","modules/profile/updateStatistics.js","modules/profile/profile.js","modules/profile/storeVL.js","modules/profile/quickWearLink.js","modules/profile/updateNmv.js","modules/quickBuff.js","modules/common/reduceBuffArray.js","modules/guild/injectRPUpgrades.js","modules/guildReport/eventHandlers.js","modules/guildReport/potReport.js","modules/guildReport/prepareChildRows.js","modules/guildReport/reportHeader.js","modules/guildReport/searchUser.js","modules/topRated/toprated.js","modules/scavenging.js","modules/scoutTower/injectScouttowerBuffLinks.js","modules/common/isNaN.js","modules/common/roundToString.js","modules/common/round.js","modules/scoutTower/injectScouttower.js","modules/settings/generalPrefs.js","modules/settings/guildPrefs.js","modules/settings/worldPrefs.js","modules/settings/configData.js","modules/settings/logPrefs.js","modules/settings/equipPrefs.js","modules/settings/questPrefs.js","modules/settings/profilePrefs.js","modules/settings/bountyPrefs.js","modules/settings/otherPrefs.js","modules/settings/injectSettings.js","modules/common/common.js","modules/app/guild/view.js","modules/trade/doFolders.js","modules/guild/injectViewGuild.js","modules/trade/trade.js","modules/newMap/combatLogger.js","modules/newMap/doNotKill.js","modules/newMap/relic/assets.js","modules/newMap/relic/primaryElements.js","modules/newMap/relic/secondaryElements.js","modules/newMap/relic/parseGuild.js","modules/newMap/relic/calcs.js","modules/newMap/relic/relic.js","modules/newMap/assets.js","modules/newMap/titanStats/realm.js","modules/newMap/titanStats/placeholders.js","modules/newMap/titanStats/buildTitanInfoTable.js","modules/newMap/titanStats/hasTitan.js","modules/newMap/titanStats/titanStats.js","modules/newMap/buttons.js","modules/newMap/titanStats/common.js","modules/newMap/titanStats/processTitans.js","modules/app/guild/scouttower.js","modules/newMap/shop.js","modules/newMap/onWorld.js","modules/newMap/viewCreature/evalAnalysis.js","modules/newMap/monsterLog/creatureInfo.js","modules/newMap/viewCreature/evalArmour.js","modules/newMap/viewCreature/evalAttack.js","modules/newMap/viewCreature/evalCa.js","modules/newMap/viewCreature/evalDamage.js","modules/newMap/viewCreature/evalDefence.js","modules/newMap/viewCreature/evalExtraBuffs.js","modules/newMap/viewCreature/viewCreature.js","modules/newMap/viewCreature/evalHtml.js","modules/newMap/monsterLog/processMonsterLog.js","modules/newMap/worldPrefs/setCurrentBuffList.js","modules/newMap/monsterLog/monsterLog.js","modules/newMap/prepareHidePlayerActions.js","modules/newMap/worldPrefs/toggleEnabledHuntingMode.js","modules/newMap/interceptXHR.js","modules/newMap/worldPrefs/buildFshDivs.js","modules/newMap/worldPrefs/toggleShowHuntingBuffs.js","modules/newMap/worldPrefs/doHuntingBuffs.js","modules/newMap/worldPrefs/worldPrefs.js","modules/newMap/newMap.js","modules/legacy.js","modules/recipes.js","modules/marketplace.js","modules/app/inventing/doinvent.js","modules/ladder.js","modules/arena/setup.js","modules/upgrades.js","modules/arena/store.js","modules/seLog/superelite.js","modules/questBook.js","modules/common/formatUtcDateTime.js","modules/buffLog/updateBuffLog.js","modules/chrome/unknownPage.js","modules/news/viewArchive.js","modules/logs/addChatTextArea.js","modules/logs/processLadder.js","modules/support/specials.js","modules/logs/addPvpSummary.js","modules/app/combat/view.js","modules/logs/addLogWidgets.js","modules/auctionHouse.js","modules/bank.js","modules/dropItems/doCheckboxes.js","modules/dropItems/doToggleButtons.js","modules/dropItems/dropItems.js","modules/dropItems/doFolderButtons.js","modules/dropItems/quickAction.js","modules/news/news.js","modules/dropItems/moveItemsToFolder.js","modules/dropItems/hideFolders.js","modules/chrome/pageSwitcher.js","modules/chrome/environment.js","modules/dropItems/injectMoveItems.js","modules/guildReport/guildReport.js","modules/logs/logs.js","modules/settings/load.js","modules/scoutTower/injectTitan.js","modules/topRated/globalQuest.js","modules/guide/showAllQuestSteps.js"],"names":["getElementById","id","doc","document","timers","footWrap","log","text","value","insertAdjacentHTML","time","name","performance","now","timeEnd","Math","round","gvar","GMSTORAGE_PATH","storItem","type","window","localStorage","setItem","reviver","condition","result","substr","parseInt","cold","toString","indexOf","needApiUpgrade","navigator","appName","match","opera","isOpera","GM_log","postError","GM_setValue","gsv","e","isGreaseMonkey","isBuggedChrome","ws","uid","Date","getItem","removeItem","GM_getValue","defValue","i","length","test","retrieve","storType","temporarilyStorage","GM_listValues","list","reKey","RegExp","il","key","push","replace","fallback","a","b","createDocument","details","DOMParser","parseFromString","setValue","pCC","pCR","quickBuffHref","aPlayerId","buffList","passthru","infoBox","documentText","infoMsg","infoMatch","innerHTML","playerId","thePlayerId","textContent","playerName","times","refAry","noGa","docRef","referrer","includes","ga","start","category","variable","label","end","myTime","setup","page","userId","siteSpeedSampleRate","FSH","version","calf","location","pathname","search","screenview","funcName","screenName","sendEvent","eventCategory","eventAction","eventLabel","sendException","desc","fatal","console","exDescription","exFatal","heap","cmp","j","priority","swp","temp","pop","topVal","data","last","leftHigher","childIndex","sink","parentIndex","bubble","paused","message","taskRunner","postMessage","add","fn","args","scope","_scope","_args","bind","apply","concat","addEventListener","event","testFn","stack","concatStack","asyncTask","dragTarget","dragOver","preventDefault","dragDrop","offset","dataTransfer","getData","split","style","left","clientX","top","clientY","body","removeEventListener","draggable","element","parent","target","getComputedStyle","setData","getPropertyValue","escapeHtml","unsafe","thePlants","thePotions","defaults","lastActiveQuestPage","lastNormalActiveQuestPage","lastNormalCompletedQuestPage","lastNormalNotStartedQuestPage","lastSeasonalActiveQuestPage","lastSeasonalCompletedQuestPage","lastSeasonalNotStartedQuestPage","enableLogColoring","enableChatParsing","enableCreatureColoring","showCombatLog","showCreatureInfo","keepLogs","showExtraLinks","huntingBuffs","huntingBuffsName","huntingBuffs2","huntingBuffs2Name","huntingBuffs3","huntingBuffs3Name","showHuntingBuffs","moveFSBox","moveDailyQuest","guildSelf","guildSelfMessage","guildFrnd","guildFrndMessage","guildPast","guildPastMessage","guildEnmy","guildEnmyMessage","goldRecipient","goldAmount","sendGoldonWorld","hideQuests","hideQuestNames","hideRecipes","hideRecipeNames","enableGuildInfoWidgets","enableOnlineAlliesWidgets","guildOnlineRefreshTime","hideGuildInfoSecureTrade","hideGuildInfoTrade","hideGuildInfoMessage","hideGuildInfoBuff","buyBuffsGreeting","renderSelfBio","bioEditLines","renderOtherBios","playNewMessageSound","showSpeakerOnWorld","defaultMessageSound","highlightPlayersNearMyLvl","highlightGvGPlayersNearMyLvl","detailedConflictInfo","gameHelpLink","navigateToLogAfterMsg","enableAllyOnlineList","enableEnemyOnlineList","allyEnemyOnlineRefreshTime","moveGuildList","moveOnlineAlliesList","hideMatchesForCompletedMoves","doNotKillList","enableBioCompressor","maxCompressedCharacters","maxCompressedLines","currentGoldSentTotal","keepBuffLog","buffLog","enableActiveBountyList","bountyListRefreshTime","enableWantedList","wantedNames","wantedGuildMembers","bwNeedsRefresh","fsboxlog","fsboxcontent","itemRecipient","quickLinks","enableAttackHelper","minGroupLevel","combatEvaluatorBias","huntingMode","enabledHuntingMode","hideRelicOffline","enterForSendMessage","trackKillStreak","storeLastQuestPage","addAttackLinkToLog","showStatBonusTotal","newGuildLogHistoryPages","useNewGuildLog","enhanceChatTextEntry","ajaxifyRankControls","enableMaxGroupSizeToJoin","maxGroupSizeToJoin","enableTempleAlert","enableUpgradeAlert","enableComposingAlert","autoFillMinBidPrice","showPvPSummaryInLog","enableQuickDrink","enhanceOnlineDots","hideBuffSelected","hideHelperMenu","keepHelperMenuOnScreen","draggableHelperMenu","quickLinksTopPx","quickLinksLeftPx","draggableQuickLinks","showNextQuestSteps","showRecallMessages","showRelicMessages","showMercenaryMessages","showGroupCombatMessages","showDonationMessages","showRankingMessages","showGvGMessages","showTaggingMessages","showTitanMessages","showQuickDropLinks","onlinePlayerMinLvl","onlinePlayerMaxLvl","arenaMinLvl","arenaMaxLvl","showMonsterLog","lastTempleCheck","needToPray","lastChatCheck","lastGuildLogCheck","lastOutBoxCheck","lastPlayerLogCheck","showAdmin","alliestotal","enemiestotal","footprints","hideNonPlayerGuildLogMessages","listOfAllies","listOfEnemies","contactList","lastUpgradeCheck","needToDoUpgrade","characterVirtualLevel","guildLogoControl","statisticsControl","guildStructureControl","lastMembrListCheck","disableItemColoring","showQuickSendLinks","needToCompose","lastComposeCheck","lastOnlineCheck","bountyList","wantedList","lowestLevelInTop250","quickMsg","sendClasses","quickSearchList","JSON","stringify","map","el","searchname","nickname","displayOnAH","arenaMoves","arenaMatches","CombatLog","hideChampionsGroup","hideElitesGroup","hideSEGroup","hideTitanGroup","hideLegendaryGroup","disableDeactivatePrompts","moveComposingButtons","expandMenuOnKeyPress","disableBreakdownPrompts","collapseNewsArchive","collapseHallPosts","lastmyGuildLogCheck","hideSubLvlCreature","hidePlayerActions","extraProfile","textToSearchFor","lastLadderReset","disableQuickWearPrompts","enableGuildActivityTracker","enableSeTracker","showTitanInfo","rarity","colour","clas","places","months","mercRE","lastActivityRE","itemRE","defenderMultiplier","nowSecs","floor","newGuildLogLoc","newGuildLogUrl","beginFolderSpanElement","guideUrl","def_afterUpdateActionlist","def_playerBuffs","def_suffixSuccessActionResponse","def_fetch_worldRealmActions","getValue","jsonParse","str","parse","exec","UTC","Number","getValueJSON","resultJSON","server","protocol","host","imageServer","HCS","defines","fileserver","slice","retBool","bool","ifTrue","ifFalse","haveNode","node","draggableQuickLinksClass","html","newWindow","url","injectQuickLinks","getCustomUrlParameter","sPageURL","sParam","sParameterName","param","sURLVariables","getUrlParameter","decodeURIComponent","substring","doMsgSound","soundLocation","$","each","after","afterBegin","parentNode","newNode","Element","insertBefore","firstChild","hideGuildLogMsg","guildLogNode","messageBox","classList","changeGuildLogHREF","guildLogNodes","querySelectorAll","href","gotGuildLogNodes","getForage","forage","dfr","Deferred","localforage","err","reject","resolve","promise","extend","obj","mixins","Object","keys","forEach","constructor","queue","beforeSend","xhr","abort","doAjax","options","retries","opt","ajax","pipe","jqXhr","textStatus","errorThrown","status","setTimeout","active","opts","shift","retryAjax","callApp","app","dataType","setForage","_data","jQuery","ajaxComplete","oldArchive","guild","act","cur","lvl","max","utc","vl","gxp","pushNewRecord","member","members","last_activity","current_stamina","level","max_stamina","guild_xp","type2tests","archive","current","doMerge","newArchive","lastUpdate","r","archiveMember","archiveRecord","some","gotGuild","gotActivity","cmd","subcmd","done","guildActivity","getRandomInt","_min","_max","min","ceil","random","insertElementBefore","referenceNode","Node","isType","t","isFunction","jQueryPresent","rnd","pvpLowerLevel","pvpUpperLevel","gvgLowerLevel","gvgUpperLevel","composeMsg","displayComposeMsg","parseComposing","timeRE","openSlots","getElementsByClassName","Array","prototype","call","timeArr","milli","eta","createPotion","cache","template_id","_rnd","potName","myParent","infoDiv","error","selectedIndex","previousElementSibling","children","backgroundImage","quickCreate","evt","self","tagName","className","composeAlert","injectComposeAlert","hasJQuery","buttons","buttonDiv","setAttribute","moveButtons","cElement","props","createElement","mixin","createDiv","createSpan","createTable","createTBody","createTr","createTd","createUl","createLi","createButton","createBr","createAnchor","createInput","createLabel","textSpan","jQueryNotPresent","makePageHeader","title","comment","spanId","button","_comment","_span","makePageTemplate","o","divId","intValue","theText","lowerPvpCalcs","levelToTest","content","monsterAry","lowerGvgCalcs","calculateBoundaries","modifier","nextElementSibling","find","injectFsBoxContent","injector","reload","jQueryDialog","display","appendChild","dialog","width","modal","position","my","at","collision","resizable","storeFSBox","_boxList","boxList","fsbox","injectFSBoxLog","nodediv","lastElementChild","getElementsByTagName","fSBoxExists","displayBuffLog","clearBuffLog","injectBuffLog","addCommas","x","doSortParams","headerClicked","sortAsc","sortBy","path","aPath","def","_obj","_path","len","getPath","sortDesc","intFromString","val","numberSort","valueA","valueB","stringSort","_a","_b","toLowerCase","noMobs","drawMobs","inject","image","creature_class","attack","defense","armor","damage","hp","enhancements","mobRows","sortCol","getAttribute","sortType","sort","doHandlers","contains","prepAry","reduce","prev","curr","tmpObj","image_id","tmp","_prev","_curr","injectMonsterLog","jConfirm","msgText","fshMsg","autoOpen","dialogClass","Yes","this","No","textArea","context","onlinePlayers","onlineData","onlinePages","lastPage","table","guildId","combatLog","notepadCopyLog","focus","select","clearCombatLog","notepadClearLog","gotCombatLog","injectNotepadShowLogs","currentGuildId","nodeList","saveVal","isNaN","lvlTests","dataTableSearch","_settings","currentPlayerId","highlightTests","guildNumber","gotOnlinePlayers","player","guildImage","append","addClass","dataTable","ext","pageLength","lengthMenu","columns","class","orderable","createdRow","row","every","eq","order","stateSave","stateDuration","api","getOnlinePlayers","input","first","thePage","attr","index","tds","changeLvl","draw","doOnlinePlayerEventHandlers","hide","injectOnlinePlayers","refreshButton","lastCheck","shouldBeArray","pref","stored","generateRecipeTable","output","recipebook","recipe","link","img","items","itm","verify","amountPresent","amountNeeded","components","comp","drawRecipeTable","insertElement","child","lastMsg","extTbl","extractInv","selectST","selectMain","resourceList","buyResult","itmRE","reduceItemOrComponent","bgGif","background","mouseOverRX","dataset","tipped","amounts","resultAmounts","hasAmounts","parseRecipeItemOrComponent","tblCells","processFolderAnyPage","firstElementChild","rows","cells","prm","when","processFolderFirstPage","innerPcc","thisFolder","filter","pages","processFirstPage","folderName","displayStuff","parseInventingStart","sortRecipeTable","rmEvtHdl","injectRecipeManager","eventHandler","evtAry","getInventory","outputResult","handle","jsonFail","json","s","useitem","item","inventory_id","quickDoneExtracted","invId","ary","inv_id","splice","checkFlags","folder_id","is_in_st","resources","item_id","invIDs","item_name","tableRows","res","showQuickExtract","prepInv","player_id","extractEvents","InventoryIDs","insertQuickExtract","alpha","n","tbl","newRow","insertRow","dom","ret","equipClass","useClass","extra","design","color","createQuickWear","appInv","folderObj","tbody","aFolder","qw","m","equipItem","backpackInvId","ahLink","buildHTML","invCount","quickSL","nicknameList","join","count","found","isChecked","itemList","mySimpleCheckboxes","helpTitle","helpText","network","networkIcon","saveBoxes","helpLink","justLabel","justCheckbox","simpleCheckboxHtml","simpleCheckbox","toggleForce","force","toggle","errorDialog","useItem","doAction","verb","remove","itemid","doUseItem","processFolder","folderId","tr","events","folder","showQuickWear","invTabs","invTabsQw","listItem","im","showAHInvManager","hasJquery","insertQuickWear","setValueJSON","detailRow","itemField","tags","generateManageTable","headers","currentCategory","currentItems","categoryField","fields","itemRow","doInputs","gmname","listEvents","userInput","isArray","newItem","checked","buildNewItem","itemId","injectAuctionSearch","injectQuickLinkManager","dotList","dotCount","stam","nicks","pageLayout","header","what","control","cutoff","searched","potential","processed","progress","moreToDo","limit","cntr","redDot","getMins","day","hour","last_login","getDot","onlineDot","batchDots","contactLink","lastActivity","previousSibling","colouredDots","sustainLevelRE","parseProfileAndDisplay","responseText","callback","sustainLevel","aLinks","bioCellHtml","innerPlayerName","levelValue","virtualLevelValue","lastActivityElement","buffTable","textLineArray","findBuffNicks","runningTotalPosition","nextBR","prevBR","arr","removeBy","seen","buffPosition","startingPosition","bioTextToSearch","buffRE","lastIndexOf","textLine","getBioLines","sustainText","hasExtendBuff","querySelector","newCell","insertCell","verticalAlign","click","openQuickMsgDialog","sustain","playerInfo","processedBuffers","potentialBuffers","processedBuffersCount","bufferProgress","characterName","findBuffMinCastLevel","findBuffsLevel175Only","onlinePlayersSetting","profilePagesToSearch","profilePagesToSearchProcessed","buffCustom","otherCustom","findBuffsParsePlayersForBuffs","calcMinLvl","addPlayerToSearchList","onlinePlayer","onlinePlayerName","trim","playerRow","onlinePlayerLevel","minPlayerVirtualLevel","findBuffsParseOnlinePlayers","curPage","maxPage","playerRows","newPage","findBuffsParseOnlinePlayersStart","parsePlayerLink","lastActivityDays","lastActivityHours","vlevel","lastActivityMinutes","findBuffsParseProfilePage","profileAlliesEnemies","findBuffsParseGuildManagePage","memList","findBuffsClearResults","deleteRow","findAnyStart","progMsg","findBuffsStart","selectedBuff","findOtherStart","injectFindBuffs","injectFindOther","fshTemplate","sendMessage","helperMenuBlob","functionLookup","Buff Log","Combat Log","Creature Log","Recipe Manager","Quick Links","Find Buffs","Find Other","Online Players","AH Quick Search","Quick Extract","Quick Wear","FS Box Log","functionPath","showHelperMenu","helperMenu","helperMenuDiv","injectHelperMenu","parseDateAsTimestamp","textDate","dateAry","newsEvt","newsHead","newsBody","newsClass","closestHead","show","stopPropagation","injectHomePageTwoLink","newsCol","rumours","imgs","archiveLink","head","logTime","myName","encodeURIComponent","myLink","findNewGroup","groupJoinHTML","injectJoinAllLink","insertElementAfter","nextSibling","insertAdjElement","insertAdjHtml","insertAfterParent","tgt","anchorButton","navLvl","li","al","navHeightExists","theNav","myNav","heights","state","height","navExists","injectMenu","showMsgTemplate","targetPlayer","prepend","selectable","stop","Manage","Cancel","keypress","code","shiftKey","msg","tip","Template","removeAttr","injectQuickMsgDialogJQ","statBoxesExist","topbannerStats","gameStats","playersOnline","miniboxList","injectServerNode","hidden","h3coll","havePrayedMsg","godsNotification","havePrayed","outerHTML","setUTCHours","prayToGods","myGod","qtip","displayDisconnectedFromGodsMessage","parseTemplePage","doWeNeedToParse","templeAlertLastUpdate","injectTempleAlert","goldUpgradeMsg","displayUpgradeMsg","parseGoldUpgrades","checkDoneUpgrade","tables","notUpgradesPage","injectUpgradeAlert","navMenu","oldSave","_saveState","_id","outputFormat","suffix","formatLastActivity","abs","h","d","getProfile","username","player_username","sendMyProfileToForage","addLastUpdateDate","getMyProfile","getProfileFromForage","myStats","openQuickBuffByName","aPlayerName","openWindow","buffCheck","msgButton","buffButton","contactClass","ally","enemy","contactColor","addContact","noAlliesTests","allies","enemies","injectAllyEnemyList","_allies","_enemies","fshContactList","hazAllies","toggleBuffSelected","activeBountyListPosted","wantedArray","classEvt","handler","buffBalls","makeDiv","fshAllyEnemy","wrapper","prepareAllyEnemyList","thisBounty","bountyUrl","getActiveBountyList","activeTable","bounty","isRefreshed","theCells","reward","rewardType","posted","xpLoss","parseActiveBounty","testCacheInvalid","bountyListDiv","wantedListDiv","bountyListReset","wantedListReset","isWanted","theRow","wantedTarget","action","cell","offerer","tickets","accept","createMiniBox","injectBountyList","heading","injectWantedList","getWantedBountyList","findTarget","parseBountyPageForWorld","refreshConditions","retrieveBountyInfo","enableActiveList","resetList","prepareBountyData","doSendGold","no_mobile","xc","ajaxXC","target_username","gold_amount","info","GameData","fetch","updateSendGoldOnWorld","gold","css","findNodes","xpath","_xpath","nodes","_doc","findQ","HTMLDocument","evaluate","XPathResult","UNORDERED_NODE_SNAPSHOT_TYPE","snapshotLength","snapshotItem","findNode","movePage","dir","dirButton","logPage","combatSetKey","itemIndex","allItems","combatSetId","submit","success","keyDict","33","arg","64","34","35","36","37","94","38","42","40","60","62","71","76","98","103","106","108","112","114","118","dialogIsClosed","121","163","oldLog","timeoutId","intervalId","bailOut","ctrlKey","metaKey","altKey","keyPress","charCode","replaceKeyHandler","onkeypress","scoutTowerLink","spoils","disableBackgroundChecks","clearTimeout","clearInterval","gotSe","serverTime","se","mobName","creature","getSeLog","doBackgroundCheck","setInterval","setupBackgroundCheck","lastCheckSecs","gotLog","getFshSeLog","seLog","statbarWrapper","myWrapper","character","statWrapper","statbar","updateHCSQuickBuffLinks","selector","hideElement","hideNodeList","contactColour","onMouseOver","l1","l2","l3","guildColour","alliesColour","hideBtn","guildSelector","allySelector","doHideBtn","addGuildInfoWidgets","guildMembrList","addOnlineAlliesWidgets","onlineAlliesList","padZ","days","timeBox","nextGainTime","hrsToGo","aDate","yyyy","dd","ddd","month","nextGain","getFullYear","getDate","getDay","getMonth","getHours","getMinutes","injectStaminaCalculator","staminaMouseover","stamVals","injectLevelupCalculator","conditional","moveRHSBoxUpOnRHS","box","moveRHSBoxToLHS","boxDiv","fixOnlineGuildBuffLinks","notHuntMode","lookForHcsData","hcsData","hcs","allowBack","inv","moveOptions","tableOpts","paging","columnDefs","targets","arenaFilter","dontPost","pvpId","gotoPage","pageId","rekeyInventory","fshHasST","getInventoryById","selectPerf","thisItem","craft","drawFilters","perfFilter","loc","itemTable","itemsAry","invItems","selectedList","showComposingMessage","bgcolor","text-align","background-color","margin","padding","animate","opacity","validBreakEvent","item_list[]","response","breakEvt","itemClick","myItem","itemPos","togglePref","makeFolderSpans","folders","needsWorn","wornSelector","perfBox","drawingNewItemTable","itemGrid","itemDiv","aLink","afn","reDrawGrid","doHideFolders","evtFid","enhanceWarehouse","invItem","equipped","inventory","perfLabel","doPerfSwitch","getItems","allTables","imgList","craftForge","prefValue","headerIndex","warehouse","collapseArt","article","open","collapseAll","expandArt","closestTr","rowIndex","isHeader","evtHdl","myRow","articleNo","evtEnabled","testRowType","rowType","thisArticle","articleTest","extraFn","prefName","collapse","prefEl","headInd","theTable","testArticle","closestTable","translateReturnInfo","_r","guildMailboxEvent","anchor","addMembrListToForage","membrList","oldMemList","getGuildMembers","guild_id","ele","testList","Boolean","guildMembers","getMembrList","tabs","theTables","oldIds","newSummary","advisorColumns","doTable","autoWidth","f","playerLevel","playerRank","rank_name","injectAdvisorNew","totalRow","totalCell","updateInput","tfoot","removeChild","td","removeAttribute","tdOne","getAdvisorPage","period","deposit","tax","total","fsp","skills","grpCrt","grpJoin","relics","contrib","displayAdvisor","addStats","addAdvisorPages","injectAdvisor","subcmd2","isObject","changeLvls","maxLvl","minLvl","DataTable","resetLvls","hideMoves","sortHandler","closest","myCol","classes","sortOrder","filterHeader","clone","insertAfter","fshHideMoves","fshMinLvl","fshMaxLvl","aTable","prop","keyup","ItemId","doLvlFilter","lvlFilter","hazOpts","boolData","matches","optsHazMoves","moves","checkTournamentId","orderData","redoHead","firstRow","contents","unwrap","process","arena","off","on","injectArena","testRange","aValue","theValue","testQuant","bazaarTable","bazaarItem","testBuyAmount","dupNode","cloneNode","selected","quantity","buy","buyAmount","buffCost","buffs","numRE","priceRE","formatBuffsToBuy","buffsToBuy","greetingText","hasBuffTag","hasCostTag","buffCostTotalText","previewArea","theBox","groupStats","actBody","selMember","tgCont","memberSelect","myMembers","ioText","saveBtn","resetBtn","io","trackerData","tracker","trDialog","acttab2","leftHandSideColumnTable","memCount","ranks","myRank","theRows","rankCount","characterRow","costFormatter","String","k","unknown","hazBuffs","buff","totalText","thisLine","nodeName","getBuffCost","buffNameNode","newtext","buffName","cost","price","priceBeforeName","parseFloat","toggleBuffsToBuy","bioEvtHdl","getBuffNameNode","insertTextBeforeEnd","renderBio","_bioContents","bioContents","cbString","changeHeight","boxVal","updateBioCharacters","inputText","injectBioWidgets","widthClass","previewContainer","previewHeader","bioPreview","bioEditLinesDiv","saveLines","bioHeight","addMercStats","merc","mouseover","stat","parseMercStats","mercElements","mercTotal","getMercStats","statAsNumber","groupViewStats","attackElement","defenseElement","armorElement","damageElement","hpElement","displayStat","groupStat","mercStat","mercStats","doBuffLinks","slot","theNames","modifierWord","btn","parseGroupStats","getGroupStats","viewStats","filterMercs","doJoinUnderSize","joinButton","groupJoinURL","joinAllGroupsUnderSize","joinButtons","fetchGroupData","linkElement","extraText","memberLevel","membrlist","doGroupRow","creator","td2","listArr","theDateCell","curYear","groupDate","setUTCDate","setUTCMonth","setUTCFullYear","setUTCMinutes","doGroupPaint","has","injectGroups","buttonElement","formatLocalDateTime","getTime","getSeconds","toText","toLocaleString","memberRows","outside","memberKey","inside","activity","drawRows","queueDrawRows","myChange","initTable","theMembers","ourMembers","makeTg","tg","hrow","createTHead","memberHead","drawRawData","doReset","doSave","newData","fail","customButton","makeInOut","isClosed","keydownHandler","updateRawData","makePopup","dialogPopup","hdl","container","openDialog","guildTracker","gs","oldTr","newTr","cellOne","cellTwo","replaceChild","toggleVisibilty","anItemId","anItem","currentVisibility","getIntFromRegExp","rxSearch","removeGuildAvyImgBorder","guildXPLock","xpLock","xpLockmouseover","xpLockXP","actualXP","gotConflictInfo","insertHere","conflictTable","hazConflict","conflictInfo","logoToggle","guildLogoElement","statToggle","statisticsControlElement","structureToggle","guildStructureControlElement","batchBuffLinks","buffLinks","selfRecallLink","getLi","fastBp","itmId","guildstore_id","evtHdlr","boxes","injectGuildAddTagsWidgets","checkAll","formTags","doItemTable","privLookup","Bank Withdraw","Build/Upgrade/Demolish Structures","Can Un-Tag Items","Build/Upgrade Structures","Can Kick Members","Can Mass Messages","Take Items","Can Recall Tagged Items","Store Items","Can View Advisor","fetchRankData","targetNode","checkBoxes","checkbox","privName","taxRate","overrideUpDown","onclickHREF","thisRankRow","thisRankRowNum","targetRowNum","parentTable","injectRow","pxScroll","scrollBy","doButtons","founder","weightButton","theTd","paintRanks","rankCell","rankName","getRanks","outerTable","findTheRows","theInv","defaultOptions","checkedElements","0","1","2","3","4","5","6","7","8","100","101","102","104","105","invManFilter","inventoryCheckAll","9","10","11","12","13","14","15","16","itemType","craftHash","Perfect","abbr","Excellent","Very Good","Good","Average","Poor","Very Poor","Uncrafted","storeTheInv","extendOptions","craftRender","gsRecall","gsStore","gsDisplayType","locations","current_player_id","c","wuRender","whereData","isSelected","tblCols","render","invPlayer","rowPlayer","p","bold","_setName","stats","set_name","nameRenderDisplay","_","folderSelect","max_durability","durability","where","guild_tag","bound","_type","visible","tag","setChecks","allChecks","clearChecks","newEle","removeClass","empty","dropItem","invIdList","removeIndex","getChecks","moveItem","inv_list","resetChecks","htmlResult","sendItem","sendItemList","deferred","takeItemStatus","queueTakeItem","recallItemStatus","bpData","lastBackpackItem","pipeRecallToQueue","mode","queueRecallItem","setName","takeItem","recallItem","wearItem","doMoveItem","doStoreItem","invIdAry","storeIndex","doDropItem","doSendItem","nowUtc","lastCheckUtc","setFilter","_row","_index","set_id","getInvMan","reportTitle","myHtml","defaultContent","orderSequence","column","injectInventoryManagerNew","clear","wrap","clearButton","showError","$tempError","delay","failHndlr","jqXHR","statusText","quickDoneTaken","qtipId","temp_id","takeAllSimilar","invIds","toggleQuickTake","getPlayer","playerAry","findPlayers","aRow","messageHTML","secondPlayer","firstPlayer","firstPlayerID","secondPlayerID","guildInvite","hasInvited","charAt","firstPart","firstQuote","secondQuote","targetPlayerName","likeInvite","guildLogWidgetsEnabled","messageNameCell","getMessageHeader","logTable","addGuildLogWidgets","rowColor","logScreen","dateColumn","addBuffTag","postDateUtc","postAgeMins","playerID","chatRowBuffLink","doLogColoring","chatTable","setUTCSeconds","lastCheckScreen","increment","addLogColoring","depoRe","lookup","rowProfile","fshNewGuildLog","fshOutput","maxPagesToFetch","currPage","myTable","guildLogFilter","headerRow","defChecks","noChecks","tmpGuildLog","completeReload","getGuildLogPage","datatype","findPageInput","parsePage","inputList","pageInput","seenRowBefore","timestamp","myMsg","parseTable","tableList","myDate","getTableList","processPage","storeOptions","checks","gotOtherPages","setSeconds","sepRow","sep","colSpan","buildTable","getOtherPages","bpc","guildLogEvents","gotOptions","guildLog","reduceStatTable","ind","getVal","statTable","statObj","totalStats","Enhancements","fshDataFilter","bonus","fshPreFilter","dataFilter","addStatTotalToMouseover","ajaxPrefilter","elementTests","toggleTarget","hasAttribute","toggleSection","testForSection","profileCombatSetDiv","quickDelDiv","sumComp","delAllDiv","compDel","compSum","compDelAll","qe","thisInvTable","doDebuff","buffId","checkForPrompt","interceptDebuff","fastAction","_invId","srcData","drawButtons","theSpan","usable","toUse","myDiv","fastWearLinks","foundBackpack","backpackContainer","theBackpack","oldShow","_showPage","getNekid","usedCount","usedCountDom","totalCount","pageCount","componentList","getInvTables","retriveComponent","invTbl","src","onmouseover","del","tallyTableRow","displayComponentTally","tBody","totRow","totCell","gotComponentsPage","addDelBtn","updateUsedCount","currentGuildRelationship","lastRowIndex","pageLinks","compid","decorateButton","parentDiv","innerSpan","guildMessages","friendly","old","guildAry","foundGuildLink","guildIdResult","_txt","scenario","txt","guildRelationship","profileInjectQuickButton","avyImg","playerid","playername","newhtml","totalAllyEnemy","numberOfContacts","contactsTotal","_c","findAllyEnemy","isAllies","isEnemies","expandBio","bioExpander","compressBio","bioCell","maxChar","lines","maxRows","maxCharactersToShow","maxRowsToShow","numberOfLines","_maxRowsToShow","startIndex","findStartPosition","breakPoint","lineBreak","bioStart","bioEnd","extraOpenHTML","extraCloseHTML","closeTagIndex","openTagIndex","doCompression","shouldRender","testForRender","profileSelectAll","checkboxes","removeStatTable","tde","ifSelf","profileRightColumn","targetBr","nekidDiv","theBtn","virtualLevel","bpBack","injectFastWear","invTables","compDiv","cmDiv","qeDiv","profileComponents","quickWearLink","allSpan","selectAllLink","injectProfile","dodgyTables","nmvImg","atkStat","defStat","oldTipped","lvlAry","nmvLvl","nmvEffect","updateNmv","quickBuffHeader","excludeBuff","skill-50","skill-54","skill-55","skill-56","skill-60","skill-61","skill-98","skill-101","getEnhancement","enh","enhLevel","enhClass","timeUnit","unit","getBuff","_s","buffTimeToExpire","elem","quickActivate","trigger","addStatsQuickBuff","myPlayer","stamina","buffRunning","playerBuffLevel","playerSpan","lvlSpan","myLvl","fshPlayerSpan","newPlayerSpan","buffColor","addBuffLevels","playerData","foo","doLabels","nameSpan","dataTipped","haveTargets","getSustain","_enhancements","skl","_skills","duration","labels","reduceBuffArray","buffAry","packRE","parseProfile","myBuffs","packBuffs","spinner","eventHandlers","potObj","potOpts","mapping","thresholds","storeMap","defaultOpts","pottab1","pottab2","pottab3","myMap","minpoint","maxpoint","sortKeys","drawMapping","pot","pivotPotObj","makeRowsFromPivot","pivot","percent","perc","g","drawInventory","onChange","option","onInput","maybeValue","gotMap","panels","myCell","counter","nodeArray","headerCount","findUser","foundUser","wearRE","paintChild","mySpan","secondHref","firstHref","itemName","addPotObj","makeSpan","prepareChildRows","paintHeader","oldhtml","reportHeader","hideOthers","searchUser","userNodes","buffEvent","titanTable","shortList","firstCell","buffAll","injectScouttowerBuffLinks","titanTables","gotTables","roundToString","number","precision","factor","pow","getTitanName","cooldownTracker","theTitans","cooldown","coolTime","cooldownText","displayTracker","trackerTable","titan","getTitanString","guildKills","totalHP","currentHP","numberOfKillsToSecure","remainingKills","getKillsPct","currentNumberOfKills","killsSummary","titanHP","titanHPArray","gotOldTitans","oldTitans","myImg","newTitans","oldTitan","generalPrefs","injectSettingsGuildData","guildType","huntBuff","huntBuffCheck","showBuffs","huntMode","buffsName","buffs2Name","buffs3Name","huntingBuffsList","modeLabel","modeName","prefs","buffs2","buffs3","coderLink","listOfCoders","setupConfigData","configData","storage","toFixed","toggleTickAllBuffs","tckTxt","clearStorage","saveConfig","maxCompressedCharactersValue","maxCompressedLinesValue","newGuildLogHistoryPagesValue","maxGroupSizeToJoinValue","oForm","form","combatEvaluatorBiasElement","formElement","showLogs","showMonsterLogs","getStat","nodeType","nodeValue","getBuffLevel","hasBuff","getBonus","next","cloakGuess","updateForCloak","attackValue","attackBonus","defenseValue","defenseBonus","armorValue","armorBonus","damageValue","damageBonus","hpValue","hpBonus","playerDataString","atk","killStreakValue","counterAttackLevel","doublerLevel","deathDealerLevel","darkCurseLevel","holyFlameLevel","constitutionLevel","sanctuaryLevel","flinchLevel","nightmareVisageLevel","superEliteSlayerLevel","fortitudeLevel","chiStrikeLevel","terrorizeLevel","barricadeLevel","reignOfTerrorLevel","anchoredLevel","severeConditionLevel","entrenchLevel","cloakLevel","superEliteSlayerMultiplier","getBuffLvl","playerDataObject","bonus_attack","bonus_defense","bonus_armor","bonus_damage","bonus_hp","killstreak","guilds","myGuildId","validPvP","virtual_level","doOnlineDot","failFilter","addPlayerToGuild","guildHRef","stackAjax","parseGuild","findOnlinePlayers","someTables","getMyVL","topRatedTests","injectTopRated","theCell","findBtn","looksLikeTopRated","doHideFolder","folderid","oldItems","getItemDiv","all","hasFolder","hideFolder","forEachInvItem","processTrade","folderCell","foldersRow","doFolderHeaders","doFolders","doCheckAll","itemTables","howMany","itemsInSt","toggleAllPlants","injectTradeOld","myTd","multiple","injectTrade","isActive","highlightMembers","combatData","oldDoAction","notSave","storeBuffs","storeEnhancements","processCombatResponse","combat","drop","combatResponse","subscribe","afterUpdateActionList","creatures","actionsToIntercept","attempts","creatureName","actions","passback","maybeIntercept","interceptFunction","doNotKill","containerDiv","leftDiv","fetchStatsBtn","myDefenders","guildMemberList","twoMinutes","sevenDays","atkStats","defStats","proc","primaryElementsSetup","relicData","defenders","player_name","is_owner","relicCountElement","lDPercentageElement","lDCloakedElement","attackBuffedElement","defenseBuffedElement","armorBuffedElement","damageBuffedElement","hpBuffedElement","defCloakedElement","defProcessedElement","dc225Element","dc175Element","groupAttackElement","groupAttackBuffedElement","groupDefenseElement","groupDefenseBuffedElement","groupArmorElement","groupArmorBuffedElement","groupDamageElement","groupDamageBuffedElement","groupHPElement","groupHPBuffedElement","processingStatus","relicMultiplier","defRawAttack","defBuffedAttack","defRawDefense","defRawArmor","defRawDamage","defBuffedDamage","defRawHp","defCloaked","defProcessed","leadDefender","memberExclusions","missingMembers","filtered","prepareSecondaryDivs","midDiv","rightDiv","rels","relicCount","updateDefValues","calculateGroup","nightmareVisageEffect","storedFlinchEffectValue","defenseWithConstitution","Constitution","totalDefense","Sanctuary","fortitudeBonusHP","Fortitude","chiStrikeBonusDamage","storedTerrorizeEffectValue","flinchEffectValue","Flinch","terrorizeEffectValue","Terrorize","doCalculations","defBuffedDefense","defBuffedHp","hasGroup","parseDefender","defender","storeLeadDefender","storeGroupStats","storeMercStats","ajaxFailure","parseGroups","disband","getStats","controlled_by","viewRelic","realmName","currentHp","maxHp","currentPct","totalPct","titanTbl","titanDiv","titanId","buttonContainer","yourLvl","formGroup","quickBuff","realmMap","ufsgMap","soundCheck","huntCheck","colorHash","bias","generalVariable","hpVariable","addRowCells","someCells","attributes","aCell","addRows","isBlue","clearMemberRows","makePctWrapper","pct","pctWrapper","buildTitanInfoTable","titanHpWrapper","hideTitanDiv","hasTitan","base_creature_id","setupTitanDiv","actCont","getCooldownHtml","currentTitan","alive","realm","processTitans","ourTitan","current_hp","max_hp","kills","doMemberRows","titanToShow","dynamic","ajaxScoutTower","testDynamics","titanStats","shoppingData","jDialog","fshDiv","numInput","qbBtn","resultDiv","changeHdl","clickHdl","gameRealm","doBtn","worldName","showQuickLinks","lvlDiv","btmDiv","minlevel","createLbl","htmlFor","makeToggleBtn","btnDiv","btnCheck","prefVal","checkId","onLbl","onClass","onTip","offLbl","offClass","offTip","injectButtons","inHuntMode","GameController","Realm","footprintTileList","msgSounds","levelStats","fixDebuffQTip","injectWorldNewMap","impIconColour","imp","onWorld","initialGameData","quickDone","resp","rmsg","firstTag","normalBuy","close","qBuy","worldDialogShop","evalMiss","numberOfCreatureHitsTillDead","numberOfHitsRequired","evalFightStatus","playerHits","creatureHits","fStatus","evalArmour","armorVal","groupExists","groupArmorValue","overallArmorValue","extraNotes","terrorizeEffect","creatureDamageDone","overallHPValue","creatureHitByHowMuch","approxDmg","evalAttack","remainingDef","atkValue","groupAttackValue","nightmareVisageAttackMovedToDefense","counterAttackBonusAttack","overallAttackValue","hitByHowMuch","attackVariable","calcLowest","lowestCALevelToStillHit","lowestCALevelToStillKill","counterAttackBonusDamage","damageDone","caRunning","lowestFeasibleCALevel","extraAttackAtLowestFeasibleCALevel","extraDamageAtLowestFeasibleCALevel","extraStaminaPerHitAtLowestFeasibleCALevel","extraStaminaPerHit","evalCA","evalDamage","groupHPValue","fortitudeExtraHPs","chiStrikeExtraDamage","groupDamageValue","overallDamageValue","deathDealerBonusDamage","holyFlameBonusDamage","dmgLessArmor","calcDef","groupDefenseValue","evalDefence","overallDefenseValue","evalExtraBuffs","getCreaturePlayerData","ses","tempdata","evalCa","fightStatus","evalAnalysis","evaluatorHTML","groupEvaluation","getCreatureGroupData","checkIfGroupExists","groupExistsIMG","parents","addRemoveCreatureToDoNotKillList","readyViewCreature","statLevel","statDefense","statAttack","statDamage","statArmor","statHp","getStatText","statTooltip","statClassName","monsterLog","doCreatureInfo","monster","oneHitNumber","myLvlClas","monsterTip","description","doMouseOver","updateMinMax","_logStat","creatureStat","logStat","processMonsterLog","logCreature","logEnh","doMonsterLog","processMonster","loopActions","getCreatures","getMyStats","initMonsterLog","startMonsterLog","buffLookup","setCurrentBuffList","tmpFn","toggleEnabledHuntingMode","doHidePlayerActions","players","verbs","missingBuffsDiv","testActions","myData","xhrDataFilter","creature_type","xhrPreFilter","originalOptions","fshEvents","prefsClickEvent","blur","buildFshDivs","prefsDiv","dataEventsPlayerBuffs","buffHash","missingBuffs","huntingBuffsEnabled","worldPrefs","hideGroupByType","hideGroupTypes","hideGroupButton","colorType","actionList","creatureClass","colorClass","colorMonsters","doRepair","subscribes","worldMessageCenter","impStyles","impWarning","impsRemaining","recastButton","hasCA","replacementText","hasCounterAttack","counterAttack","getCaLvl","hasShieldImp","hasDeathDealer","doublerRE","getDoublerLevel","hasDoubler","doubler","doublerLvl","getKillStreak","playerKillStreakValue","killStreakLocation","deathDealerPercentage","deathDealerBuff","deathDealer","getLastValue","doDeathDealer","lastDeathDealerPercentage","lastKillStreak","trackText","recastImpAndRefresh","re","findImps","textToTest","impsRemainingRE","getImpHp","impRecast","_recastImpAndRefresh","impHref","checkBuffs","injectHere","trackKS","newSpan","injectWorld","amt","prc","warn","plantFromComponentHash","Amber Essense","Blood Bloom Flower","Dark Shade ","Snake Eye","Snake Venom Fang","Heffle Wart","Jademare Blossom","Trinettle Leaf","Purplet Flower","quickInventDone","inventResult","quickInvent","amountToInvent","recipeID","recipe_id","injectViewRecipeLinks","getItemName","plantFromComponent","itemLinks","encodeURI","injectViewRecipe","searchName","compI","mouseOver","reResult","theUrl","linkFromMouseoverCustom","componentCountElement","inventing","formatTime","getAmount","marketplaceWarning","sellPrice","gross","amount","getWarning","addMarketplaceWarning","selectRow","upgrades","currentFSP","oldMoves","doPickMove","moveId","slotId","move_id","slot_id","updateMoves","newMoves","selectMoves","move","gotMoves","_arena","findText","valRe","doStamCount","upgrade","extraStam","updateStamCount","span","getCell","injectUpgradeHelper","injectPoints","saveUpgradeValue","ratio","storePlayerUpgrades","trackerCell","normalLink","seasonLink","activeLink","completeLink","notStartedLink","currentPageValue","addRow","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","formatUtcDateTime","insertNewRow","seAry","gotSeLog","always","waitForLog","letter","sortby","sortbydir","currentLocationValue","savePrefKey","setLink","storeQuestPage","oppositeTypeUrl","lastQBPage","guideButtons","questID","questName","injectQuestBookFull","questTable","successfull","timeStamp","buffCast","getStamUsed","buffResult","_buffLog","buffsNotCast","buffsAttempted","buffsNotCastRE","buffsCastRE","buffNotCast","ladderResetPref","checkForPvPLadder","viewArchive","tests","addChatTextArea","btnMass","appendTo","ourTd","replaceWith","fshTxt","keydown","keyCode","hasTextEntry","processLadder","messageType","specials","18","17","19","20","21","22","23","24","25","26","27","28","29","30","31","combatCache","highlightSpecials","params","parseCombat","combatSummary","is_defender","winner","xp_gain","gold_gain","gold_stolen","pvp_prestige_gain","pvp_rating_change","inSpecialsList","unknownSpecials","specialHtml","processCombat","combatID","combat_id","cellContents","replaceLeadingText","msgCell","newHtml","replaceText","processCombatRow","combatRowTests","addPvpSummary","prepareCache","oneDay","combatId","checkCache","memberNameString","nickList","isChat","isGuildMate","extraPart","dateHTML","dateFirstPart","dateLastPart","thirdPart","targetPlayerID","fourthPart","lastPart","attackPart","buffsSent","nick","replyTo","msgReplyTo","playerColor","colorPlayerName","playerElement","hasPlayerLink","doExtraStuff","dateExtraText","buffingPlayerID","buffingPlayerName","addExtraStuff","doLogWidgetRow","addLogWidgetsOld","messageHeader","foundLogTable","addLogWidgets","cancelAllAH","cancelButtons","cancelButton","itemImage","auction_id","bankSettings","playerBank","headText","appLink","depoPos","balPos","initWithdraw","guildBank","transResponse","deposit_amount","oData","bankDeposit","isNumeric","bankWithdrawal","withdraw_amount","bank","depo","withdraw","ajaxifyBank","tickElement","disabled","extraLinks","paintCount","itemsHash","dropLinks","colouring","sendLinks","types","invid","doCheckboxes","invItems_","type_","itemId_","doFolderButtons","formNode","tRows","showHideLabel","doToggleButtons","quickAction","otherClass","otherButton","afterbegin","pattern","buildTrailer","beforeend","invPaint","maxcharacters","shoutboxPreview","evts","batchNo","invList","separator","injectStoreItems","updateShoutboxPreview","chars","injectShoutboxWidgets","coreFunction","pageSwitcher","settings","-","settingsTabs","tickAll","createEventListeners","world","news","shoutbox","blacksmith","repairall","completed","prevButton","nextButton","startButton","before","finishButton","overrideButtons","pickmove","questbook","atoz","viewquest","profile","managecombatset","report","equipitem","changebio","dropitems","flrEnabled","oFlr","flrRow","auctionhouse","cancelAll","fill","quickcreate","addtags","removetags","storeitems","chat","groups","viewstats","joinallgroupsundersize","joinall","manage","advisor","weekly","history","view","scouttower","mailbox","conflicts","rpupgrades","hall","flDiv","outbox","potionbazaar","pbImg","potions","marketplace","createreq","quickbuff","quickbuffDiv","notepad","showlogs","invmanagernew","guildinvmgr","recipemanager","auctionsearch","onlineplayers","quicklinkmanager","monsterlog","quickextract","quickwear","bufflogcontent","newguildlog","findbuffs","findother","savesettings","fshSettings","points","trade","createsecure","docreatesecure","toprated","xp","monthlyxp","bounties","risingstars","superelites","smasher","globalquest","topTable","viewrecipe","tempinv","wrapInner","itemIDs","quickTakeTable","titem","findplayer","quests","masterrealms","realms","shops","scavenging","temple","composing","breakdown","create","pvpladder","submitButton","leftCell","rightCell","align","lastReset","crafting","hellforge","superelite","viewupdatearchive","viewarchive","newSelector","test_cmd","isValid","getCoreFunction","fromWorld","testCoreFunction","asyncDispatcher","dispatch"],"mappings":"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","sourceRoot":"sourceMap","sourcesContent":["export function getElementById(id, doc) {\r\n  if (doc) {return doc.getElementById(id);}\r\n  return document.getElementById(id);\r\n}\r\n","import {getElementById} from '../common/getElement';\r\n\r\nvar timers = {};\r\nvar footWrap = getElementById('foot-wrap');\r\n\r\nexport function log(text, value) {\r\n  if (footWrap) {\r\n    footWrap.insertAdjacentHTML('beforeend',\r\n      '<br>' + text + ': ' + value + ' (' + typeof value + ')');\r\n  }\r\n}\r\n\r\nexport function time(name) {\r\n  if (name) {timers[name] = performance.now() * 1000;}\r\n}\r\n\r\nexport function timeEnd(name) {\r\n  if (timers[name]) {\r\n    log(name, Math.round(performance.now() * 1000 -\r\n      timers[name]) / 1000 + 'ms');\r\n    delete timers[name];\r\n  }\r\n}\r\n","import {log} from './debug';\r\n\r\n// GM_ApiBrowserCheck\r\n// @author        GIJoe\r\n// @license       http://creativecommons.org/licenses/by-nc-sa/3.0/\r\n// Global variables\r\nvar gvar = {};\r\nvar GMSTORAGE_PATH = 'GM_';\r\n\r\nfunction storItem(name, type, value) {\r\n  window.localStorage.setItem(GMSTORAGE_PATH + name, type + value);\r\n}\r\n\r\nvar reviver = [\r\n  {\r\n    condition: 'S]',\r\n    result: function(value) {return value.substr(2);}\r\n  },\r\n  {\r\n    condition: 'N]',\r\n    result: function(value) {return parseInt(value.substr(2), 10);}\r\n  },\r\n  {\r\n    condition: 'B]',\r\n    result: function(value) {return value.substr(2) === 'true';}\r\n  }\r\n];\r\nvar cold = [\r\n  {\r\n    condition: 'string',\r\n    result: function(name, value) {storItem(name, 'S]', value);}\r\n  },\r\n  {\r\n    condition: 'number',\r\n    result: function(name, value) {\r\n      if (value.toString().indexOf('.') < 0) {storItem(name, 'N]', value);}\r\n    }\r\n  },\r\n  {\r\n    condition: 'boolean',\r\n    result: function(name, value) {storItem(name, 'B]', value);}\r\n  }\r\n];\r\n\r\nfunction retrieve(value) {\r\n  for (var i = 0; i < reviver.length; i += 1) {\r\n    var test = reviver[i];\r\n    if (value.substr(0, 2) === test.condition) {return test.result(value);}\r\n  }\r\n  return value;\r\n}\r\n\r\n// You can change it to avoid conflict with others scripts\r\nvar needApiUpgrade = false;\r\nif (window.navigator.appName.match(/^opera/i) &&\r\n    typeof window.opera !== 'undefined') {\r\n  needApiUpgrade = true;\r\n  gvar.isOpera = true;\r\n  window.GM_log = window.opera.postError;\r\n}\r\nif (typeof GM_setValue !== 'undefined') {\r\n  var gsv;\r\n  try {\r\n    gsv = window.GM_setValue.toString();\r\n  } catch (e) {\r\n    gsv = 'staticArgs';\r\n  }\r\n  if (gsv.indexOf('staticArgs') > 0) {\r\n    gvar.isGreaseMonkey = true;\r\n  // test GM_hitch\r\n  } else if (gsv.match(/not\\s+supported/)) {\r\n    needApiUpgrade = true;\r\n    gvar.isBuggedChrome = true;\r\n  }\r\n} else {\r\n  needApiUpgrade = true;\r\n}\r\n\r\nif (needApiUpgrade) {\r\n  var ws = null;\r\n  var uid = new Date().toString();\r\n  var result;\r\n  try {\r\n    window.localStorage.setItem(uid, uid);\r\n    result = window.localStorage.getItem(uid) === uid;\r\n    window.localStorage.removeItem(uid);\r\n    if (result) {\r\n      ws = typeof window.localStorage;\r\n    } else {\r\n      log('There is a problem with your local storage. ' +\r\n        'FSH cannot persist your settings.');\r\n      ws = null;\r\n    }\r\n  } catch (e) {\r\n    ws = null;\r\n  }\r\n  // Catch Security error\r\n  if (ws === 'object') {\r\n    window.GM_getValue = function(name, defValue) {\r\n      var value = window.localStorage.getItem(GMSTORAGE_PATH + name);\r\n      if (value === null || typeof value === 'undefined') {return defValue;}\r\n      return retrieve(value);\r\n    };\r\n    window.GM_setValue = function(name, value) {\r\n      for (var i = 0; i < cold.length; i += 1) {\r\n        var storType = cold[i];\r\n        if (typeof value === storType.condition) {\r\n          storType.result(name, value);\r\n        }\r\n      }\r\n    };\r\n  } else if (!gvar.isOpera || typeof GM_setValue === 'undefined') {\r\n    gvar.temporarilyStorage = [];\r\n    window.GM_getValue = function(name, defValue) {\r\n      if (typeof gvar.temporarilyStorage[GMSTORAGE_PATH + name] ===\r\n        'undefined') {return defValue;}\r\n      return gvar.temporarilyStorage[GMSTORAGE_PATH + name];\r\n    };\r\n    window.GM_setValue = function(name, value) {\r\n      if (['string', 'boolean', 'number'].indexOf(typeof value) !== -1) {\r\n        gvar.temporarilyStorage[GMSTORAGE_PATH + name] = value;\r\n      }\r\n    };\r\n  }\r\n\r\n  window.GM_listValues = function() {\r\n    var list = [];\r\n    var reKey = new RegExp('^' + GMSTORAGE_PATH);\r\n    for (var i = 0, il = window.localStorage.length; i < il; i += 1) {\r\n      var key = window.localStorage.key(i);\r\n      if (key.match(reKey)) {\r\n        list.push(key.replace(GMSTORAGE_PATH, ''));\r\n      }\r\n    }\r\n    return list;\r\n  };\r\n}\r\n","export default function fallback(a, b) {\r\n  return a || b;\r\n}\r\n","export default function createDocument(details) {\r\n  // Use DOMParser to prevent img src tags downloading\r\n  var parser = new DOMParser();\r\n  var doc = parser.parseFromString(details, 'text/html');\r\n  return doc;\r\n}\r\n","export default function setValue(name, value) {\r\n  GM_setValue(name, value);\r\n}\r\n","import createDocument from '../system/createDocument';\r\nimport {getElementById} from '../common/getElement';\r\nimport setValue from '../system/setValue';\r\n\r\nexport var pCC = getElementById('pCC');\r\nexport var pCR = getElementById('pCR');\r\n\r\nexport function quickBuffHref(aPlayerId, buffList) { // Bad Pattern\r\n  var passthru = '';\r\n  if (buffList) {passthru = '&blist=' + buffList;}\r\n  return 'href=\\'javascript:window.openWindow(\"index.php?cmd=' +\r\n    'quickbuff&tid=' + aPlayerId + passthru +\r\n    '\", \"fsQuickBuff\", 618, 1000, \",scrollbars\")\\'';\r\n}\r\n\r\nexport function infoBox(documentText) {\r\n  var doc = createDocument(documentText);\r\n  var result;\r\n  var infoMsg = getElementById('info-msg', doc);\r\n  if (infoMsg) {\r\n    var infoMatch = infoMsg.innerHTML;\r\n    result = '';\r\n    if (infoMatch) {\r\n      infoMatch = infoMatch.replace(/<br.*/, '');\r\n      result = infoMatch;\r\n    }\r\n  }\r\n  return result;\r\n}\r\n\r\nexport function playerId() {\r\n  var thePlayerId = parseInt(getElementById('holdtext')\r\n    .textContent.match(/fallensword.com\\/\\?ref=(\\d+)/)[1], 10);\r\n  setValue('playerID', thePlayerId);\r\n  return thePlayerId;\r\n}\r\n\r\nexport function playerName() {\r\n  return getElementById('statbar-character').textContent;\r\n}\r\n","import {log} from './debug';\r\nimport {playerId} from './layout';\r\n\r\nvar times = {};\r\nvar refAry = ['www.lazywebtools.co.uk', 'refreshthing.com'];\r\n\r\nfunction isAuto() {\r\n  var docRef = document.referrer\r\n    .match(/^https?:\\/\\/([^/?#]+)(?:[/?#]|$)/i);\r\n  if (docRef) {docRef = docRef[1];}\r\n  return refAry.includes(docRef);\r\n}\r\n\r\nfunction noGa() {\r\n  return isAuto() || typeof ga === 'undefined';\r\n}\r\n\r\nexport function start(category, variable, label) {\r\n  if (noGa()) {return;}\r\n  times[category + ':' + variable + ':' + label] =\r\n    performance.now() * 1000;\r\n}\r\n\r\nfunction sendTiming(category, variable, label) {\r\n  var myTime = Math.round(performance.now() * 1000 -\r\n    times[category + ':' + variable + ':' + label]) / 1000;\r\n  if (myTime > 10) {\r\n    ga('fshApp.send', 'timing', category, variable, Math.round(myTime),\r\n      label);\r\n  }\r\n  //#if _BETA  //  Timing output\r\n  log(variable, myTime + 'ms');\r\n  //#endif\r\n}\r\n\r\nexport function end(category, variable, label) {\r\n  if (noGa()) {return;}\r\n  sendTiming(category, variable, label);\r\n}\r\n\r\nfunction fixupUrl() {\r\n  var origPath = window.location.pathname + window.location.search;\r\n  var page = origPath.replace(/&m=.*/, '')\r\n    .replace(/&subcmd=&.*/, '')\r\n    .replace(/&subcmd2=&.*/, '')\r\n    .replace(/&[a-z_]+_id=.+/, '')\r\n    .replace(/&id=.+/, '')\r\n    .replace(/&target_player=.+/, '')\r\n    .replace(/&[a-z]+_username=.+/, '')\r\n    .replace(/\\?cmd=auctionhouse.+/, '?cmd=auctionhouse')\r\n    .replace(/&subcmd=[0-9a-f]{32}/, '')\r\n    .replace(/&search_active=.+/, '')\r\n    .replace(/&letter=.+/, '')\r\n    .replace(/&guild_name=.+/, '')\r\n    .replace(/&user=.+/, '')\r\n    .replace(/&[a-z_]*page=.+/, '')\r\n    .replace(/&prestige=.+/, '')\r\n    .replace(/&withdraw_amount=.+/, '')\r\n    .replace(/&tickets=.+/, '')\r\n    .replace(/&search=.+/, '')\r\n    .replace(/&target=.+/, '')\r\n    .replace(/&xcv=[0-9a-f]{32}/, '')\r\n    .replace(/\\?ref=[0-9]+/, '');\r\n  ga('fsh.set', 'page', page);\r\n}\r\n\r\nexport function setup() {\r\n  if (noGa()) {return;}\r\n\r\n  ga('create', 'UA-76488113-1', 'auto', 'fshApp', {\r\n    userId: playerId(),\r\n    siteSpeedSampleRate: 10\r\n  });\r\n  ga('fshApp.set', 'appName', 'fshApp');\r\n  ga('fshApp.set', 'appVersion', FSH.version + '(' + FSH.calf + ')');\r\n  ga('create', 'UA-76488113-2', 'auto', 'fsh', {\r\n    userId: playerId(),\r\n    siteSpeedSampleRate: 10\r\n  });\r\n  fixupUrl();\r\n  ga('fsh.send', 'pageview');\r\n}\r\n\r\nexport function screenview(funcName) {\r\n  if (noGa()) {return;}\r\n  ga('fshApp.send', 'screenview', {screenName: funcName});\r\n}\r\n\r\nexport function sendEvent(eventCategory, eventAction, eventLabel) {\r\n  if (noGa()) {return;}\r\n  ga('fshApp.send', 'event', eventCategory, eventAction, eventLabel);\r\n}\r\n\r\nexport function sendException(desc, fatal) {\r\n  //#if _BETA  //  sendException\r\n  console.log('sendException', desc); // eslint-disable-line no-console\r\n  //#endif\r\n  if (noGa()) {return;}\r\n  ga('fshApp.send', 'exception', {\r\n    exDescription: desc,\r\n    exFatal: fatal\r\n  });\r\n}\r\n\r\n// TODO needs CORS\r\n\r\n// window.addEventListener('error', function(e) {\r\n//   // console.log('e.message', e.message);\r\n//   // console.log('e.filename', e.filename);\r\n//   // console.log('e.lineno', e.lineno);\r\n//   // console.log('e.colno', e.colno);\r\n//   console.log('error event', e);\r\n//   if (e.error) {\r\n//     console.log('error event message', e.error.message);\r\n//     console.log('error event stack', e.error.stack);\r\n//   }\r\n//   // sendException(e.error.stack, true);\r\n// });\r\n\r\n// var oldError = window.onerror;\r\n// window.onerror = function(message, source, lineno, colno, error) {\r\n//   console.log('onerror message', message);\r\n//   console.log('onerror source', source);\r\n//   console.log('onerror lineno', lineno);\r\n//   console.log('onerror colno', colno);\r\n//   console.log('onerror error', error);\r\n//   console.log('onerror error.message', error.message);\r\n//   console.log('onerror error.stack', error.stack);\r\n// };\r\n","/*\r\nBased on\r\nfiddle.jshell.net/GRIFFnDOOR/r7tvg/\r\n*/\r\n\r\nvar heap = [null];\r\n\r\nfunction cmp(i, j) {\r\n  return heap[i] && heap[i].priority < heap[j].priority;\r\n}\r\n\r\nfunction swp(i, j) {\r\n  var temp = heap[i];\r\n  heap[i] = heap[j];\r\n  heap[j] = temp;\r\n}\r\n\r\nfunction calcChildIndex(leftHigher, i) {\r\n  if (leftHigher) {return i * 2;}\r\n  return i * 2 + 1;\r\n}\r\n\r\nfunction sink(j) {\r\n  var i = j;\r\n  while (i * 2 < heap.length) {\r\n    var leftHigher = !cmp(i * 2 + 1, i * 2);\r\n    var childIndex = calcChildIndex(leftHigher, i);\r\n    if (cmp(i, childIndex)) {break;}\r\n    swp(i, childIndex);\r\n    i = childIndex;\r\n  }\r\n}\r\n\r\nfunction bubble(j) {\r\n  var i = j;\r\n  while (i > 1) {\r\n    /* jshint -W016 */\r\n    // eslint-disable-next-line no-bitwise\r\n    var parentIndex = i >> 1;\r\n    /* jshint +W016 */\r\n    if (!cmp(i, parentIndex)) {break;}\r\n    swp(i, parentIndex);\r\n    i = parentIndex;\r\n  }\r\n}\r\n\r\nexport function pop() {\r\n  if (heap.length === 1) {return;}\r\n  var topVal = heap[1].data;\r\n  var last = heap.pop();\r\n  if (heap.length > 1) {\r\n    heap[1] = last;\r\n    sink(1);\r\n  }\r\n  return topVal;\r\n}\r\n\r\nexport function push(data, priority) {\r\n  bubble(heap.push({data: data, priority: priority}) - 1);\r\n}\r\n\r\nexport function getLength() {\r\n  return heap.length - 1;\r\n}\r\n","import fallback from '../system/fallback';\r\nimport {sendException} from './fshGa';\r\nimport {getLength, pop, push} from './sch';\r\n\r\nvar paused = true;\r\nvar message = 'fshMessage';\r\n\r\nfunction taskRunner() {\r\n  if (getLength() === 0) {\r\n    paused = true;\r\n  } else {\r\n    paused = false;\r\n    window.postMessage(message, '*');\r\n  }\r\n}\r\n\r\nfunction devLog(args) {\r\n  if (args && !Array.isArray(args)) {\r\n    // eslint-disable-next-line no-console\r\n    console.log('addTask Array.isArray(args)', Array.isArray(args));\r\n  }\r\n}\r\n\r\nexport default function add(priority, fn, args, scope) {\r\n  //#if _DEV  //  Not sending args as Array\r\n  devLog(args);\r\n  //#endif\r\n  if (typeof fn === 'function') {\r\n    var _scope = fallback(scope, window);\r\n    var _args = fallback(args, []);\r\n    push(fn.bind.apply(fn, [_scope].concat(_args)), priority);\r\n    if (paused) {taskRunner();}\r\n  }\r\n}\r\n\r\nfunction parseStack(e) {\r\n  var concatStack = e.stack.replace(/\\n +/g, '|');\r\n  if (e.stack.includes(e.message)) {\r\n    return concatStack;\r\n  }\r\n  return e.message + '|' + concatStack;\r\n}\r\n\r\nfunction parseError(e) {\r\n  if (e.stack) {return parseStack(e);}\r\n  return e.message;\r\n}\r\n\r\nfunction asyncTask() {\r\n  try {\r\n    var testFn = pop();\r\n    if (typeof testFn === 'function') {\r\n      testFn();\r\n    } else {sendException('pop() was not a function', false);}\r\n    // pop()();\r\n  } catch (e) {\r\n    sendException(parseError(e), false);\r\n  } finally {\r\n    taskRunner();\r\n  }\r\n}\r\n\r\nfunction callback(event) {\r\n  var key = event.data;\r\n  if (typeof key === 'string' && key.indexOf(message) === 0) {\r\n    asyncTask();\r\n  }\r\n}\r\n\r\nwindow.addEventListener('message', callback);\r\n","export default {};\r\n","var dragTarget;\r\n\r\nfunction dragOver(event) {\r\n  event.preventDefault();\r\n  return false;\r\n}\r\n\r\nfunction dragDrop(event) {\r\n  var offset = event.dataTransfer.getData('text/plain').split(',');\r\n  dragTarget.style.left =\r\n    event.clientX + parseInt(offset[0], 10) + 'px';\r\n  dragTarget.style.top =\r\n    event.clientY + parseInt(offset[1], 10) + 'px';\r\n  document.body.removeEventListener('dragover', dragOver, false);\r\n  document.body.removeEventListener('drop', dragDrop, false);\r\n  event.preventDefault();\r\n  return false;\r\n}\r\n\r\nfunction dragStart(parent, event) {\r\n  if (parent) {\r\n    dragTarget = parent;\r\n  } else {\r\n    dragTarget = event.target;\r\n  }\r\n  var style = window.getComputedStyle(dragTarget, null);\r\n  event.dataTransfer.setData('text/plain',\r\n    parseInt(style.getPropertyValue('left'), 10) - event.clientX + ',' +\r\n    (parseInt(style.getPropertyValue('top'), 10) - event.clientY));\r\n  document.body.addEventListener('dragover', dragOver, false);\r\n  document.body.addEventListener('drop', dragDrop, false);\r\n}\r\n\r\nexport default function draggable(element, parent) {\r\n  element.draggable = true;\r\n  element.addEventListener('dragstart', dragStart.bind(null, parent));\r\n}\r\n","export default function escapeHtml(unsafe) {\r\n  return unsafe\r\n    .replace(/&/g, '&amp;')\r\n    .replace(/</g, '&lt;')\r\n    .replace(/>/g, '&gt;')\r\n    .replace(/\"/g, '&quot;')\r\n    .replace(/'/g, '&#039;');\r\n}\r\n","var thePlants = [\r\n  'Amber',\r\n  'Blood Bloom',\r\n  'Jademare',\r\n  'Dark Shade',\r\n  'Trinettle',\r\n  'Heffle Wart'\r\n];\r\nvar thePotions = [\r\n  ['Sludge Brew', 'DC 200'],\r\n  ['Potion of Black Death', 'DC 225'],\r\n  ['Potion of Aid', 'Assist'],\r\n  ['Potion of Supreme Doubling', 'DB 450'],\r\n  ['Potion of Acceleration', 'DB 500'],\r\n  ['Potion of Lesser Death Dealer', 'DD'],\r\n  ['Runic Potion', 'FI 250'],\r\n  ['Potion of the Bookworm', 'Lib 225'],\r\n  ['Potion of Truth', 'EW 1k'],\r\n  ['Dull Edge', 'DE 25'],\r\n  ['Notched Blade', 'DE 80'],\r\n  ['Potion of Death', 'DW 125'],\r\n  ['Potion of Decay', 'WI 150'],\r\n  ['Potion of Fatality', 'WI 350'],\r\n  ['Potion of Annihilation', 'DW 150'],\r\n  ['Potion of the Wise', 'Lib 200'],\r\n  ['Potion of Shattering', 'SA'],\r\n  ['Dragons Blood Potion', 'ZK 200'],\r\n  ['Berserkers Potion', 'ZK 300'],\r\n  ['Potion of Fury', 'ZK 350'],\r\n  ['Potion of Supreme Luck', 'FI 1k']\r\n];\r\n\r\nfunction plants() {\r\n  return thePlants.map(function(el) {\r\n    return {category: 'Plants', searchname: el, nickname: ''};\r\n  });\r\n}\r\n\r\nfunction potions() {\r\n  return thePotions.map(function(el) {\r\n    return {\r\n      category: 'Potions',\r\n      searchname: el[0],\r\n      nickname: el[1],\r\n      displayOnAH: true\r\n    };\r\n  });\r\n}\r\n\r\nexport function def_quickSearch() {\r\n  return JSON.stringify(plants().concat(potions()));\r\n}\r\n","import {def_quickSearch} from './defaultQuickSearchList';\r\n\r\n/* eslint-disable max-lines */\r\nexport var defaults = {\r\n  lastActiveQuestPage: '',\r\n  lastNormalActiveQuestPage: '',\r\n  lastNormalCompletedQuestPage: '',\r\n  lastNormalNotStartedQuestPage: '',\r\n  lastSeasonalActiveQuestPage: '',\r\n  lastSeasonalCompletedQuestPage: '',\r\n  lastSeasonalNotStartedQuestPage: '',\r\n\r\n  enableLogColoring: false,\r\n  enableChatParsing: false,\r\n  enableCreatureColoring: false,\r\n  showCombatLog: false,\r\n  showCreatureInfo: false,\r\n  keepLogs: false,\r\n\r\n  showExtraLinks: false,\r\n  huntingBuffs: 'Doubler,Librarian,Adept Learner,Merchant,' +\r\n    'Treasure Hunter,Animal Magnetism,Conserve',\r\n  huntingBuffsName: 'default',\r\n  huntingBuffs2: 'Deflect',\r\n  huntingBuffs2Name: 'PvP',\r\n  huntingBuffs3: 'Super Elite Slayer',\r\n  huntingBuffs3Name: 'SE',\r\n  showHuntingBuffs: false,\r\n  moveFSBox: false,\r\n  moveDailyQuest: false,\r\n\r\n  guildSelf: '',\r\n  guildSelfMessage: 'Member of your own guild!',\r\n  guildFrnd: '',\r\n  guildFrndMessage: 'Do not attack - Guild is friendly!',\r\n  guildPast: '',\r\n  guildPastMessage: 'Do not attack - You\\'ve been in that guild once!',\r\n  guildEnmy: '',\r\n  guildEnmyMessage: 'Enemy guild. Attack at will!',\r\n  goldRecipient: '',\r\n  goldAmount: '',\r\n  sendGoldonWorld: false,\r\n\r\n  hideQuests: false,\r\n  hideQuestNames: '',\r\n  hideRecipes: false,\r\n  hideRecipeNames: '',\r\n  enableGuildInfoWidgets: false,\r\n  enableOnlineAlliesWidgets: false,\r\n  guildOnlineRefreshTime: 300,\r\n  hideGuildInfoSecureTrade: false,\r\n  hideGuildInfoTrade: false,\r\n  hideGuildInfoMessage: false,\r\n  hideGuildInfoBuff: false,\r\n\r\n  buyBuffsGreeting: 'Hello {playername}, can I buy {buffs} for {cost} please?',\r\n  renderSelfBio: false,\r\n  bioEditLines: 10,\r\n  renderOtherBios: false,\r\n  playNewMessageSound: false,\r\n  showSpeakerOnWorld: false,\r\n  defaultMessageSound: 'https://fallenswordhelper.github.io/fallenswordhelper/audio/sms-alert-2-daniel_simon.wav',\r\n  highlightPlayersNearMyLvl: false,\r\n  highlightGvGPlayersNearMyLvl: false,\r\n  detailedConflictInfo: false,\r\n  gameHelpLink: true,\r\n  navigateToLogAfterMsg: false,\r\n\r\n  enableAllyOnlineList: false,\r\n  enableEnemyOnlineList: false,\r\n  allyEnemyOnlineRefreshTime: 300,\r\n  moveGuildList: false,\r\n  moveOnlineAlliesList: false,\r\n\r\n  hideMatchesForCompletedMoves: false,\r\n  doNotKillList: '',\r\n  enableBioCompressor: false,\r\n  maxCompressedCharacters: 250,\r\n  maxCompressedLines: 10,\r\n\r\n  currentGoldSentTotal: 0,\r\n  keepBuffLog: false,\r\n  buffLog: '',\r\n\r\n  enableActiveBountyList: false,\r\n  bountyListRefreshTime: 300,\r\n  enableWantedList: false,\r\n  wantedNames: '',\r\n  wantedGuildMembers: false,\r\n  bwNeedsRefresh: true,\r\n\r\n  fsboxlog: false,\r\n  fsboxcontent: '',\r\n  itemRecipient: '',\r\n  quickLinks: '[]',\r\n  enableAttackHelper: false,\r\n  minGroupLevel: 1,\r\n  combatEvaluatorBias: 0,\r\n  huntingMode: false,\r\n  enabledHuntingMode: '1',\r\n  hideRelicOffline: false,\r\n\r\n  enterForSendMessage: false,\r\n  trackKillStreak: false,\r\n  storeLastQuestPage: false,\r\n  addAttackLinkToLog: false,\r\n  showStatBonusTotal: false,\r\n\r\n  newGuildLogHistoryPages: 3,\r\n  useNewGuildLog: false,\r\n  enhanceChatTextEntry: false,\r\n\r\n  ajaxifyRankControls: false,\r\n\r\n  enableMaxGroupSizeToJoin: false,\r\n  maxGroupSizeToJoin: 11,\r\n\r\n  enableTempleAlert: false,\r\n  enableUpgradeAlert: false,\r\n  enableComposingAlert: false,\r\n  autoFillMinBidPrice: false,\r\n  showPvPSummaryInLog: false,\r\n  enableQuickDrink: false,\r\n  enhanceOnlineDots: false,\r\n  hideBuffSelected: false,\r\n  hideHelperMenu: false,\r\n  keepHelperMenuOnScreen: true,\r\n  draggableHelperMenu: false,\r\n  quickLinksTopPx: 22,\r\n  quickLinksLeftPx: 0,\r\n  draggableQuickLinks: false,\r\n  showNextQuestSteps: true,\r\n\r\n  showRecallMessages: true,\r\n  showRelicMessages: true,\r\n  showMercenaryMessages: true,\r\n  showGroupCombatMessages: true,\r\n  showDonationMessages: true,\r\n  showRankingMessages: true,\r\n  showGvGMessages: true,\r\n  showTaggingMessages: true,\r\n  showTitanMessages: true,\r\n\r\n  showQuickDropLinks: false,\r\n\r\n  onlinePlayerMinLvl: 1,\r\n  onlinePlayerMaxLvl: 9999,\r\n  arenaMinLvl: 1,\r\n  arenaMaxLvl: 9999,\r\n  showMonsterLog: false,\r\n  lastTempleCheck: 0,\r\n  needToPray: false,\r\n  lastChatCheck: '0',\r\n  lastGuildLogCheck: '0',\r\n  lastOutBoxCheck: '0',\r\n  lastPlayerLogCheck: '0',\r\n  showAdmin: false,\r\n  alliestotal: 0,\r\n  enemiestotal: 0,\r\n  footprints: false,\r\n  hideNonPlayerGuildLogMessages: false,\r\n  listOfAllies: '',\r\n  listOfEnemies: '',\r\n  contactList: '',\r\n  lastUpgradeCheck: 0,\r\n  needToDoUpgrade: false,\r\n  characterVirtualLevel: 0,\r\n  guildLogoControl: false,\r\n  statisticsControl: false,\r\n  guildStructureControl: false,\r\n  lastMembrListCheck: 0,\r\n  disableItemColoring: true,\r\n  showQuickSendLinks: false,\r\n  needToCompose: false,\r\n  lastComposeCheck: 0,\r\n  lastOnlineCheck: 0,\r\n  bountyList: '',\r\n  wantedList: '',\r\n  lowestLevelInTop250: 0,\r\n\r\n  quickMsg: '[\"Thank you very much ^_^\",\"Happy hunting, {playername}\"]',\r\n\r\n  sendClasses: '[\"Composed Pots\", \"13699\"], [\"Amber\", \"5611\"], ' +\r\n    '[\"Amethyst Weed\", \"9145\"], [\"Blood Bloom\", \"5563\"], ' +\r\n    '[\"Cerulean Rose\", \"9156\"], [\"Coleoptera Body\", \"9287\"], ' +\r\n    '[\"Dark Shade\", \"5564\"], [\"Deathbloom\", \"9140\"], ' +\r\n    '[\"Deathly Mold\", \"9153\"], [\"Greenskin\\u00A0Fungus\", \"9148\"], ' +\r\n    '[\"Heffle\", \"5565\"], [\"Jademare\", \"5566\"], ' +\r\n    '[\"Ruby Thistle\", \"9143\"], [\"Toad Corpse\",\"9288\"], ' +\r\n    '[\"Trinettle\", \"5567\"], [\"Viridian\\u00A0Vine\", \"9151\"], ' +\r\n    '[\"Mortar & Pestle\", \"9157\"], [\"Beetle Juice\", \"9158\"]',\r\n\r\n  quickSearchList: def_quickSearch,\r\n\r\n  arenaMoves: '[]',\r\n  arenaMatches: '[]',\r\n  CombatLog: '',\r\n  hideChampionsGroup: false,\r\n  hideElitesGroup: false,\r\n  hideSEGroup: false,\r\n  hideTitanGroup: false,\r\n  hideLegendaryGroup: false,\r\n  disableDeactivatePrompts: false,\r\n  moveComposingButtons: false,\r\n  expandMenuOnKeyPress: false,\r\n  disableBreakdownPrompts: false,\r\n  collapseNewsArchive: false,\r\n  collapseHallPosts: false,\r\n  lastmyGuildLogCheck: 0,\r\n  hideSubLvlCreature: false,\r\n  hidePlayerActions: false,\r\n  extraProfile: '',\r\n  textToSearchFor: '',\r\n  lastLadderReset: 0,\r\n  disableQuickWearPrompts: false,\r\n  enableGuildActivityTracker: false,\r\n  enableSeTracker: false,\r\n  showTitanInfo: false\r\n};\r\n\r\nexport var rarity = [\r\n  {colour: '#ffffff', clas: 'fshCommon'},\r\n  {colour: '#0099ff', clas: 'fshRare'},\r\n  {colour: '#cc00ff', clas: 'fshUnique'},\r\n  {colour: '#ffff33', clas: 'fshLegendary'},\r\n  {colour: '#cc0033', clas: 'fshSuper'},\r\n  {colour: '#6633ff', clas: 'fshCrystal'},\r\n  {colour: '#009900', clas: 'fshEpic'}\r\n];\r\n\r\nexport var places = ['first', 'second', 'third', 'fourth', 'fifth', 'sixth',\r\n  'seventh', 'eighth', 'ninth', 'tenth', 'eleventh', 'twelfth', 'thirteenth',\r\n  'fourteenth'];\r\n\r\nexport var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug',\r\n  'Sep', 'Oct', 'Nov', 'Dec'];\r\n\r\nexport var mercRE = [\r\n  /<td>Attack:<\\/td><td>(\\d+)<\\/td>/,\r\n  /<td>Defense:<\\/td><td>(\\d+)<\\/td>/,\r\n  /<td>Armor:<\\/td><td>(\\d+)<\\/td>/,\r\n  /<td>Damage:<\\/td><td>(\\d+)<\\/td>/,\r\n  /<td>HP:<\\/td><td>(\\d+)<\\/td>/\r\n];\r\n\r\nexport var lastActivityRE =\r\n  /<td>Last Activity:<\\/td><td>(\\d+)d (\\d+)h (\\d+)m (\\d+)s<\\/td>/;\r\n\r\nexport var itemRE = /item_id=(\\d+)&inv_id=(\\d+)/;\r\nexport var defenderMultiplier = 0.2;\r\nexport var now = Date.now();\r\nexport var nowSecs = Math.floor(now / 1000);\r\nexport var newGuildLogLoc = '?cmd=notepad&blank=1&subcmd=newguildlog';\r\nexport var newGuildLogUrl = 'index.php' + newGuildLogLoc;\r\nexport var beginFolderSpanElement =\r\n  '<span class=\"fshLink fshNoWrap fshFolder fshVMid\" data-folder=\"';\r\nexport var guideUrl = 'https://guide.fallensword.com/index.php?&cmd=';\r\nexport var def_afterUpdateActionlist = 'after-update.actionlist';\r\nexport var def_playerBuffs = 'buffs.player';\r\nexport var def_suffixSuccessActionResponse = '-success.action-response';\r\n\r\nexport var def_creatureCombat = 2;\r\nexport var def_repairAll = 15;\r\n\r\nexport var def_fetch_playerStats = 1;\r\nexport var def_fetch_playerBackpackCount = 2;\r\nexport var def_fetch_playerBackpackItems = 4;\r\nexport var def_fetch_playerPrefs = 8;\r\n\r\nexport var def_fetch_playerBuffs = 16;\r\nexport var def_fetch_worldDefines = 32;\r\nexport var def_fetch_worldRealmStatic = 64;\r\nexport var def_fetch_worldRealmDynamic = 128;\r\n\r\nexport var def_fetch_worldRealmActions = 256;\r\nexport var def_fetch_playerEquipment = 512;\r\nexport var def_fetch_playerNotifications = 1024;\r\n","import {defaults} from '../support/dataObj';\r\n\r\nexport default function getValue(name) {\r\n  //#if _DEV  //  No default setting available\r\n  if (typeof defaults[name] === 'undefined') {\r\n    // eslint-disable-next-line no-console\r\n    console.log(name, defaults[name]);\r\n  }\r\n  //#endif\r\n  return GM_getValue(name, defaults[name]);\r\n}\r\n","\r\nexport default function jsonParse(str, reviver) {\r\n  try {\r\n    return JSON.parse(str, reviver);\r\n  } catch (e) {\r\n    // Ignore bad json\r\n  }\r\n}\r\n","import getValue from './getValue';\r\nimport jsonParse from '../common/jsonParse';\r\n\r\nfunction reviver(key, value) {\r\n  if (typeof value === 'string') {\r\n    var a =\r\n      /^(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2}(?:\\.\\d*)?)Z$/\r\n        .exec(value);\r\n    if (a) {\r\n      return new Date(Date.UTC(Number(a[1]), Number(a[2]) - 1, Number(a[3]),\r\n        Number(a[4]), Number(a[5]), Number(a[6])));\r\n    }\r\n  }\r\n  return value;\r\n}\r\n\r\nexport default function getValueJSON(name) {\r\n  var resultJSON = getValue(name);\r\n  var result;\r\n  if (resultJSON) {result = jsonParse(resultJSON, reviver);}\r\n  return result;\r\n}\r\n","export var server = document.location.protocol + '//' +\r\n  document.location.host + '/';\r\nexport var imageServer = window.HCS && window.HCS.defines &&\r\n  window.HCS.defines.fileserver &&\r\n  window.HCS.defines.fileserver.slice(0, -1);\r\n","import add from '../support/task';\r\nimport calf from '../support/calf';\r\nimport draggable from '../common/dragStart';\r\nimport escapeHtml from '../system/escapeHtml';\r\nimport fallback from '../system/fallback';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport getValueJSON from '../system/getValueJSON';\r\nimport {imageServer} from '../system/system';\r\n\r\nfunction retBool(bool, ifTrue, ifFalse) {\r\n  if (bool) {\r\n    return ifTrue;\r\n  }\r\n  return ifFalse;\r\n}\r\n\r\nfunction retOption(option, ifTrue, ifFalse) {\r\n  return retBool(getValue(option), ifTrue, ifFalse);\r\n}\r\n\r\nfunction isDraggable(draggableQuickLinks) {\r\n  if (draggableQuickLinks) {\r\n    draggable(getElementById('fshQuickLinks'));\r\n  }\r\n}\r\n\r\nfunction haveNode(node, quickLinks) { // Native ?\r\n  var quickLinksTopPx = getValue('quickLinksTopPx');\r\n  var quickLinksLeftPx = getValue('quickLinksLeftPx');\r\n  var draggableQuickLinks = getValue('draggableQuickLinks');\r\n  var draggableQuickLinksClass = retBool(draggableQuickLinks, ' fshMove', '');\r\n  var html = '<div style=\"top:' + quickLinksTopPx + 'px; left:' +\r\n    quickLinksLeftPx + 'px; background-image:url(\\'' + imageServer +\r\n    '/skin/inner_bg.jpg\\');\" id=\"fshQuickLinks\" class=\"fshQuickLinks' +\r\n    retOption('keepHelperMenuOnScreen', ' fshFixed', '') +\r\n    draggableQuickLinksClass + '\">';\r\n  for (var i = 0; i < quickLinks.length; i += 1) {\r\n    var newWindow = retBool(quickLinks[i].newWindow, ' target=\"new\"', '');\r\n    html += '<li><a href=\"' + escapeHtml(quickLinks[i].url) + '\"' +\r\n      newWindow + '>' + quickLinks[i].name + '</a></li>';\r\n  }\r\n  html += '</div>';\r\n  document.body.insertAdjacentHTML('beforeend', html);\r\n  isDraggable(draggableQuickLinks);\r\n}\r\n\r\nfunction injectQuickLinks() { // Native ?\r\n  var node = getElementById('statbar-container');\r\n  if (!node) {return;}\r\n  var quickLinks = fallback(getValueJSON('quickLinks'), []);\r\n  if (quickLinks.length <= 0) {return;}\r\n  haveNode(node, quickLinks);\r\n}\r\n\r\nexport default function doQuickLinks() {\r\n  if (!calf.huntingMode) {\r\n    add(3, injectQuickLinks);\r\n  }\r\n}\r\n","function outputParamVal(param) {\r\n  if (typeof param === 'undefined') {return true;}\r\n  return param;\r\n}\r\n\r\nexport default function getCustomUrlParameter(sPageURL, sParam) {\r\n  var sURLVariables = sPageURL.split('&');\r\n  var sParameterName;\r\n  for (var i = 0; i < sURLVariables.length; i += 1) {\r\n    sParameterName = sURLVariables[i].split('=');\r\n    if (sParameterName[0] === sParam) {\r\n      return outputParamVal(sParameterName[1]);\r\n    }\r\n  }\r\n}\r\n","import getCustomUrlParameter from './getCustomUrlParameter';\r\n\r\nexport default function getUrlParameter(sParam) {\r\n  var sPageURL = decodeURIComponent(window.location.search.substring(1));\r\n  return getCustomUrlParameter(sPageURL, sParam);\r\n}\r\n","import add from '../support/task';\r\nimport getValue from '../system/getValue';\r\n\r\nfunction doMsgSound() { // jQuery\r\n  var soundLocation = getValue('defaultMessageSound');\r\n  $('a:contains(\"New log messages\"):first').each(function(i, e) {\r\n    $(e).after('<audio src=\"' + soundLocation +\r\n    '\" autoplay=true />');\r\n  });\r\n  $('a:contains(\"New Guild chat message\"):first').each(function(i, e) {\r\n    $(e).after('<audio src=\"' + soundLocation +\r\n    '\" autoplay=true />');\r\n  });\r\n}\r\n\r\nexport default function isMessageSound() {\r\n  if (getValue('playNewMessageSound')) {\r\n    add(3, doMsgSound);\r\n  }\r\n}\r\n","export default function afterBegin(parentNode, newNode) {\r\n  if (parentNode instanceof Element) {\r\n    parentNode.insertBefore(newNode, parentNode.firstChild);\r\n  }\r\n}\r\n","import getValue from '../system/getValue';\r\nimport {newGuildLogLoc, newGuildLogUrl} from '../support/dataObj';\r\n\r\nfunction testForGuildLogMsg(guildLogNode) {\r\n  return location.search !== newGuildLogLoc ||\r\n    guildLogNode.parentNode.id !== 'notification-guild-log';\r\n}\r\n\r\nfunction hideGuildLogMsg(guildLogNode) {\r\n  // hide the lhs box\r\n  if (testForGuildLogMsg(guildLogNode)) {return;}\r\n  var messageBox = guildLogNode.parentNode;\r\n  if (messageBox) {\r\n    messageBox.classList.add('fshHide');\r\n  }\r\n}\r\n\r\nfunction gotGuildLogNodes(guildLogNodes) {\r\n  var guildLogNode;\r\n  for (var i = 0; i < guildLogNodes.length; i += 1) {\r\n    guildLogNode = guildLogNodes[i];\r\n    guildLogNode.href = newGuildLogUrl;\r\n  }\r\n  hideGuildLogMsg(guildLogNode);\r\n}\r\n\r\nexport default function changeGuildLogHREF() {\r\n  if (!getValue('useNewGuildLog')) {return;}\r\n  var guildLogNodes = document.querySelectorAll(\r\n    '#pCL a[href=\"index.php?cmd=guild&subcmd=log\"]');\r\n  if (guildLogNodes) {gotGuildLogNodes(guildLogNodes);}\r\n}\r\n","import {log} from '../support/debug';\r\n\r\nexport default function getForage(forage) {\r\n  // Wrap in jQuery Deferred because we're using 1.7\r\n  // rather than using ES6 promise\r\n  var dfr = $.Deferred();\r\n  localforage.getItem(forage, function getItemCallback(err, data) {\r\n    if (err) {\r\n      log(forage + ' forage error', err);\r\n      dfr.reject(err);\r\n    } else {\r\n      // returns null if key does not exist\r\n      dfr.resolve(data);\r\n    }\r\n  });\r\n  return dfr.promise();\r\n}\r\n","export default function extend(obj, mixins) {\r\n  Object.keys(mixins).forEach(function(key) {\r\n    if (typeof mixins[key] === 'object' && mixins[key] !== null) {\r\n      obj[key] = extend(mixins[key].constructor(), mixins[key]);\r\n    } else {\r\n      obj[key] = mixins[key];\r\n    }\r\n  });\r\n  return obj;\r\n}\r\n","var paused = true;\r\nvar queue = [];\r\n\r\nfunction beforeSend(xhr) {\r\n  window.addEventListener('beforeunload', function() {\r\n    xhr.abort();\r\n    queue = [];\r\n  });\r\n}\r\n\r\nfunction doAjax(options, retries, dfr) {\r\n  var opt;\r\n  if (typeof options === 'string') {\r\n    opt = {url: options};\r\n  } else {\r\n    opt = options;\r\n  }\r\n  opt.beforeSend = beforeSend;\r\n  return $.ajax(opt).pipe(dfr.resolve,\r\n    function(jqXhr, textStatus, errorThrown) {\r\n      if (retries > 0 && jqXhr.status === 503) {\r\n        setTimeout(doAjax, 100, opt, retries - 1, dfr);\r\n      } else {\r\n        dfr.reject(jqXhr, textStatus, errorThrown);\r\n      }\r\n    }\r\n  );\r\n}\r\n\r\nfunction taskRunner() {\r\n  if (queue.length === 0) {\r\n    paused = true;\r\n  } else {\r\n    paused = false;\r\n    if ($.active < 4) {\r\n      var opts = queue.shift();\r\n      doAjax.apply(null, opts);\r\n      taskRunner();\r\n    }\r\n  }\r\n}\r\n\r\nfunction add(options, retries, dfr) {\r\n  queue.push([options, retries, dfr]);\r\n  if (paused) {taskRunner();}\r\n}\r\n\r\nexport default function retryAjax(options) {\r\n  var dfr = $.Deferred();\r\n  if (options) {add(options, 10, dfr);}\r\n  return dfr.promise();\r\n}\r\n\r\nif (typeof jQuery !== 'undefined') {\r\n  $(document).ajaxComplete(function() {\r\n    taskRunner();\r\n  });\r\n}\r\n","import extend from '../common/extend';\r\nimport retryAjax from '../ajax/retryAjax';\r\n\r\nexport default function callApp(data) {\r\n  extend(data, {app: 1});\r\n  return retryAjax({\r\n    url: 'app.php',\r\n    data: data,\r\n    dataType: 'json'\r\n  });\r\n}\r\n","import {log} from '../support/debug';\r\n\r\nexport default function setForage(forage, data) {\r\n  // Wrap in jQuery Deferred because we're using 1.7\r\n  // rather than using ES6 promise\r\n  var dfr = $.Deferred();\r\n  localforage.setItem(forage, data, function setItemCallback(err, _data) {\r\n    if (err) {\r\n      log(forage + ' forage error', err);\r\n      dfr.reject(err);\r\n    } else {\r\n      dfr.resolve(_data);\r\n    }\r\n  });\r\n  return dfr.promise();\r\n}\r\n","export var act = 0;\r\nexport var cur = 1;\r\nexport var lvl = 2;\r\nexport var max = 3;\r\nexport var utc = 4;\r\nexport var vl = 5;\r\nexport var gxp = 6;\r\n","import fallback from '../system/fallback';\r\nimport getForage from '../ajax/getForage';\r\nimport getValue from '../system/getValue';\r\nimport guildManage from '../app/guild/manage';\r\nimport {nowSecs} from '../support/dataObj';\r\nimport setForage from '../ajax/setForage';\r\nimport {act, cur, gxp, lvl, max, utc, vl} from './guildTracker/indexConstants';\r\n\r\nvar oldArchive;\r\nvar guild;\r\n\r\nfunction pushNewRecord(member) {\r\n  oldArchive.members[member.name].push([\r\n    Math.floor(member.last_activity / 86400),\r\n    member.current_stamina,\r\n    member.level,\r\n    member.max_stamina,\r\n    nowSecs,\r\n    member.vl,\r\n    member.guild_xp,\r\n  ]);\r\n}\r\n\r\nfunction initMember(member) {\r\n  if (!oldArchive.members[member.name]) {\r\n    oldArchive.members[member.name] = [];\r\n    pushNewRecord(member);\r\n  }\r\n}\r\n\r\nvar type2tests = [\r\n  function(archive, current) {\r\n    // Has current stam changed ?\r\n    return current.current_stamina !== archive[cur]; // probably want a weighted percentage here\r\n    // Might only care if it has dropped significantly ?\r\n  },\r\n  function(archive, current) {\r\n    // Has Max Stam increased ?\r\n    return current.max_stamina > archive[max]; // probably want a weighted percentage here\r\n  },\r\n  function(archive, current) {\r\n    // Has level changed ?\r\n    return current.level !== archive[lvl];\r\n  },\r\n  function(archive, current) {\r\n    // Has VL changed ?\r\n    return current.vl !== archive[vl];\r\n  },\r\n  function(archive, current) {\r\n    // Has GXP changed ?\r\n    return current.guild_xp !== archive[gxp]; // probably want a weighted percentage here\r\n  }\r\n];\r\n\r\nfunction doMerge() { // jQuery.min\r\n  var newArchive = {lastUpdate: nowSecs, members: {}};\r\n  guild.r.members.forEach(function(member) {\r\n    initMember(member);\r\n    var archiveMember = oldArchive.members[member.name];\r\n    var archiveLength = archiveMember.length;\r\n    var archiveRecord = archiveMember[archiveLength - 1];\r\n    var archiveAge = nowSecs - archiveRecord[utc];\r\n    if (archiveAge >= 86100) {\r\n      var type2change = type2tests.some(function(test) {\r\n        if (test(archiveRecord, member)) {\r\n          return true;\r\n        }\r\n        return false;\r\n      });\r\n      if (type2change) {\r\n        pushNewRecord(member);\r\n      } else {\r\n        archiveRecord[act] = Math.floor(member.last_activity / 86400);\r\n        archiveRecord[utc] = nowSecs;\r\n      }\r\n    }\r\n    newArchive.members[member.name] = oldArchive.members[member.name];\r\n  });\r\n  setForage('fsh_guildActivity', newArchive);\r\n}\r\n\r\nfunction gotGuild(data) {\r\n  guild = data;\r\n  doMerge();\r\n}\r\n\r\nfunction gotActivity(data) { // jQuery.min\r\n  if (data) {\r\n    oldArchive = data;\r\n  } else {\r\n    oldArchive = {lastUpdate: 0, members: {}};\r\n  }\r\n  if (nowSecs > fallback(oldArchive.lastUpdate, 0) + 300) { // 5 mins - probably want to increase\r\n    guildManage().done(gotGuild);\r\n  }\r\n}\r\n\r\nexport default function guildActivity() { // jQuery.min\r\n  if ($ && getValue('enableGuildActivityTracker')) {\r\n    getForage('fsh_guildActivity').done(gotActivity);\r\n  }\r\n}\r\n","import callApp from '../callApp';\r\n\r\nexport default function guildManage() {\r\n  return callApp({cmd: 'guild', subcmd: 'manage'});\r\n}\r\n","export default function getRandomInt(_min, _max) {\r\n  var min = Math.ceil(_min);\r\n  var max = Math.floor(_max);\r\n  return Math.floor(Math.random() * (max - min)) + min;\r\n}\r\n","export default function insertElementBefore(newNode, referenceNode) {\r\n  if (referenceNode instanceof Node &&\r\n      referenceNode.parentNode instanceof Node) {\r\n    return referenceNode.parentNode.insertBefore(newNode, referenceNode);\r\n  }\r\n}\r\n","export default function isType(e, t) {return typeof e === t;}\r\n","import isType from './isType';\r\n\r\nexport default function isFunction(e) {return isType(e, 'function');}\r\n","import isFunction from './isFunction';\r\n\r\nexport default function jQueryPresent() {return isFunction($);}\r\n","import getRandomInt from './getRandomInt';\r\n\r\nexport default function rnd() {\r\n  return getRandomInt(1000000000, 9999999998);\r\n}\r\n","import add from '../support/task';\r\nimport calf from '../support/calf';\r\nimport createDocument from '../system/createDocument';\r\nimport {getElementById} from '../common/getElement';\r\nimport getRandomInt from '../system/getRandomInt';\r\nimport getValue from '../system/getValue';\r\nimport {imageServer} from '../system/system';\r\nimport insertElementBefore from '../common/insertElementBefore';\r\nimport jQueryPresent from '../common/jQueryPresent';\r\nimport {now} from '../support/dataObj';\r\nimport {pCC} from '../support/layout';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport rnd from '../system/rnd';\r\nimport setValue from '../system/setValue';\r\n\r\nvar composeMsg =\r\n  '<li class=\"notification\"><a href=\"index.php?cmd=composing\"><span' +\r\n  ' class=\"notification-icon\"></span><p class=\"notification-content\">' +\r\n  'Composing to do</p></a></li>';\r\n\r\nfunction displayComposeMsg() {\r\n  getElementById('notifications')\r\n    .insertAdjacentHTML('afterbegin', composeMsg);\r\n}\r\n\r\nfunction getDoc(data) {\r\n  if (calf.cmd !== 'composing') {\r\n    return createDocument(data);\r\n  }\r\n  return document;\r\n}\r\n\r\nfunction parseComposing(data) {\r\n  var doc = getDoc(data);\r\n  var timeRE = /ETA:\\s*(\\d+)h\\s*(\\d+)m\\s*(\\d+)s/;\r\n  var times = [];\r\n  var openSlots = doc.getElementsByClassName('composing-potion-time');\r\n  Array.prototype.forEach.call(openSlots, function(el) {\r\n    if (el.textContent === 'ETA: Ready to Collect!' ||\r\n        el.textContent === 'ETA: n/a') {\r\n      times.push(0);\r\n    } else {\r\n      var timeArr = timeRE.exec(el.textContent);\r\n      var milli = (timeArr[1] * 3600 + timeArr[2] * 60 + Number(timeArr[3])) *\r\n        1000 + now;\r\n      times.push(milli);\r\n    }\r\n  });\r\n  var eta = Math.min.apply(null, times);\r\n  if (eta === 0) {\r\n    if (calf.cmd !== 'composing') {displayComposeMsg();}\r\n    setValue('needToCompose', true);\r\n  } else {\r\n    setValue('needToCompose', false);\r\n    setValue('lastComposeCheck', eta);\r\n  }\r\n}\r\n\r\nfunction createSuccess(temp, textStatus) {\r\n  var potName = temp[temp.selectedIndex].text;\r\n  var myParent = temp.parentNode;\r\n  var infoDiv = myParent.previousElementSibling.previousElementSibling;\r\n  infoDiv.children[0].innerHTML = '';\r\n  infoDiv.children[0].classList.add('fshPot');\r\n  infoDiv.children[0].style.backgroundImage = 'url(' + imageServer +\r\n    '/composing/potions/' + getRandomInt(1, 11) + '_' +\r\n    getRandomInt(1, 51) + '.gif)';\r\n  infoDiv.children[2].innerHTML = 'Creating \\'<span class=\"fshBold\">' +\r\n    potName + '</span>\\' Potion';\r\n  infoDiv.children[3].innerHTML = '';\r\n  myParent.innerHTML = '<div class=\"fshScs\">' + textStatus + '</div>';\r\n}\r\n\r\nfunction createPotion(temp) { // jQuery\r\n  retryAjax({\r\n    cache: false,\r\n    dataType: 'json',\r\n    url: 'index.php',\r\n    data: {\r\n      cmd: 'composing',\r\n      subcmd: 'createajax',\r\n      template_id: temp.value,\r\n      _rnd: rnd()\r\n    }\r\n  }).done(function potionDone(data, textStatus) {\r\n    if (data.error !== '') {\r\n      temp.parentNode.innerHTML = '<div class=\"fshScs\">' +\r\n        data.error + '</div>';\r\n    } else {\r\n      createSuccess(temp, textStatus);\r\n    }\r\n  });\r\n}\r\n\r\nfunction isOurTarget(target) {\r\n  return target.tagName === 'SPAN' && target.className === 'quickCreate';\r\n}\r\n\r\nfunction doQuickCreate(self) {\r\n  var temp = self.previousElementSibling.previousElementSibling;\r\n  if (temp && temp.value !== 'none') {\r\n    self.innerHTML = '';\r\n    self.classList.add('fshSpinner', 'fshSpinner12', 'fshComposingSpinner');\r\n    createPotion(temp);\r\n  }\r\n}\r\n\r\nfunction quickCreate(evt) {\r\n  var self = evt.target.parentNode;\r\n  if (isOurTarget(self)) {doQuickCreate(self);}\r\n}\r\n\r\nfunction checkLastCompose() { // jQuery\r\n  var lastComposeCheck = getValue('lastComposeCheck');\r\n  if (lastComposeCheck && now < lastComposeCheck) {return;}\r\n  retryAjax('index.php?no_mobile=1&cmd=composing').done(function(data) {\r\n    add(3, parseComposing, [data]);\r\n  });\r\n}\r\n\r\nfunction composeAlert() {\r\n  var needToCompose = getValue('needToCompose');\r\n  if (needToCompose) {\r\n    displayComposeMsg();\r\n    return;\r\n  }\r\n  checkLastCompose();\r\n}\r\n\r\nexport function injectComposeAlert() {\r\n  if (jQueryPresent() && calf.cmd !== 'composing') {composeAlert();}\r\n}\r\n\r\nfunction moveButtons() {\r\n  if (getValue('moveComposingButtons')) {\r\n    var buttonDiv = getElementById('composing-error-dialog')\r\n      .previousElementSibling;\r\n    buttonDiv.setAttribute('style', 'text-align: right; padding: 0 38px 0 0');\r\n    var top = pCC.getElementsByClassName('composing-level')[0]\r\n      .parentNode;\r\n    insertElementBefore(buttonDiv, top);\r\n  }\r\n}\r\n\r\nfunction hasJQuery() {\r\n  if (calf.enableComposingAlert) {\r\n    parseComposing();\r\n  }\r\n\r\n  var buttons = pCC\r\n    .querySelectorAll('input[id^=create-]:not(#create-multi)');\r\n  Array.prototype.forEach.call(buttons, function(el) {\r\n    el.insertAdjacentHTML('afterend', '<span class=\"quickCreate\">' +\r\n      '[<span class=\"sendLink\">Quick Create</span>]</span>');\r\n  });\r\n  pCC.addEventListener('click', quickCreate);\r\n  moveButtons();\r\n}\r\n\r\nexport function injectComposing() {\r\n  if (jQueryPresent() && pCC) {hasJQuery();}\r\n}\r\n\r\nexport function composingCreate() {\r\n  getElementById('composing-add-skill')\r\n    .addEventListener('click', function() {\r\n      getElementById('composing-skill-level-input').value =\r\n        getElementById('composing-skill-level-max').textContent;\r\n    });\r\n  getElementById('composing-skill-select')\r\n    .addEventListener('change', function() {\r\n      getElementById('composing-skill-level-input').value =\r\n        getElementById('composing-skill-level-max').textContent;\r\n    });\r\n}\r\n","import getValue from '../system/getValue';\r\nimport intValue from '../system/intValue';\r\n\r\nexport var pvpLowerLevel;\r\nexport var pvpUpperLevel;\r\nexport var gvgLowerLevel;\r\nexport var gvgUpperLevel;\r\n\r\nfunction calcLvlToTest() {\r\n  var levelToTest = intValue(document.getElementsByClassName(\r\n    'stat-level')[0].nextElementSibling.textContent);\r\n  var characterVirtualLevel = getValue('characterVirtualLevel');\r\n  if (characterVirtualLevel) {levelToTest = characterVirtualLevel;}\r\n  return levelToTest;\r\n}\r\n\r\nvar lowerPvpCalcs = [\r\n  {\r\n    a: function(levelToTest) {return levelToTest <= 205;},\r\n    b: function() {return 5;}\r\n  },\r\n  {\r\n    a: function(levelToTest) {return levelToTest >= 206 && levelToTest <= 209;},\r\n    b: function(levelToTest) {return levelToTest - 200;}\r\n  },\r\n  {a: function() {return true;}, b: function() {return 10;}}\r\n];\r\n\r\nfunction calcLowerPvpLevel(levelToTest) {\r\n  return levelToTest -\r\n    lowerPvpCalcs.find(function(e) {return e.a(levelToTest);}).b(levelToTest);\r\n}\r\n\r\nfunction calcUpperPvpLevel(levelToTest) {\r\n  var modifier = 10;\r\n  if (levelToTest < 200) {modifier = 5;}\r\n  return levelToTest + modifier;\r\n}\r\n\r\nvar lowerGvgCalcs = [\r\n  {\r\n    a: function(levelToTest) {return levelToTest >= 801;},\r\n    b: function() {return 100;}\r\n  },\r\n  {\r\n    a: function(levelToTest) {return levelToTest >= 752;},\r\n    b: function(levelToTest) {return levelToTest - 701;}\r\n  },\r\n  {\r\n    a: function(levelToTest) {return levelToTest >= 351;},\r\n    b: function() {return 50;}\r\n  },\r\n  {\r\n    a: function(levelToTest) {return levelToTest >= 326;},\r\n    b: function(levelToTest) {return levelToTest - 301;}\r\n  },\r\n  {a: function() {return true;}, b: function() {return 25;}}\r\n];\r\n\r\nfunction calcLowerGvgLevel(levelToTest) {\r\n  return levelToTest -\r\n    lowerGvgCalcs.find(function(e) {return e.a(levelToTest);}).b(levelToTest);\r\n}\r\n\r\nfunction calcUpperGvgLevel(levelToTest) {\r\n  var modifier = 100;\r\n  if (levelToTest <= 700) {modifier = 50;}\r\n  if (levelToTest <= 300) {modifier = 25;}\r\n  return levelToTest + modifier;\r\n}\r\n\r\nexport function calculateBoundaries() {\r\n  var levelToTest = calcLvlToTest();\r\n  pvpLowerLevel = calcLowerPvpLevel(levelToTest);\r\n  pvpUpperLevel = calcUpperPvpLevel(levelToTest);\r\n  gvgLowerLevel = calcLowerGvgLevel(levelToTest);\r\n  gvgUpperLevel = calcUpperGvgLevel(levelToTest);\r\n}\r\n","export function mixin(obj, mixins) {\r\n  Object.keys(mixins).forEach(function(key) {\r\n    if (typeof mixins[key] === 'object' && mixins[key] !== null) {\r\n      mixin(obj[key], mixins[key]);\r\n    } else {\r\n      obj[key] = mixins[key];\r\n    }\r\n  });\r\n}\r\n\r\nfunction cElement(type, props) {\r\n  var el = document.createElement(type);\r\n  if (props) {mixin(el, props);}\r\n  return el;\r\n}\r\n\r\nexport function createDiv(props) {\r\n  return cElement('div', props);\r\n}\r\n\r\nexport function createSpan(props) {\r\n  return cElement('span', props);\r\n}\r\n\r\nexport function createTable(props) {\r\n  return cElement('table', props);\r\n}\r\n\r\nexport function createTBody(props) {\r\n  return cElement('tbody', props);\r\n}\r\n\r\nexport function createTr(props) {\r\n  return cElement('tr', props);\r\n}\r\n\r\nexport function createTd(props) {\r\n  return cElement('td', props);\r\n}\r\n\r\nexport function createTFoot(props) {\r\n  return cElement('tfoot', props);\r\n}\r\n\r\nexport function createUl(props) {\r\n  return cElement('ul', props);\r\n}\r\n\r\nexport function createLi(props) {\r\n  return cElement('li', props);\r\n}\r\n\r\nexport function createButton(props) {\r\n  return cElement('button', props);\r\n}\r\n\r\nexport function createBr() {\r\n  return cElement('br');\r\n}\r\n\r\nexport function createAnchor(props) {\r\n  return cElement('a', props);\r\n}\r\n\r\nexport function createInput(props) {\r\n  return cElement('input', props);\r\n}\r\n\r\nexport function createTextArea(props) {\r\n  return cElement('textarea', props);\r\n}\r\n\r\nexport function createTh(props) {\r\n  return cElement('th', props);\r\n}\r\n\r\nexport function createLabel(props) {\r\n  return cElement('label', props);\r\n}\r\n\r\nexport function textSpan(text) {\r\n  return createSpan({textContent: text});\r\n}\r\n","import isFunction from './isFunction';\r\n\r\nexport default function jQueryNotPresent() {return !isFunction($);}\r\n","export default function makePageHeader(title, comment, spanId, button) {\r\n  var _comment = '';\r\n  if (comment !== '') {_comment = '&nbsp;(' + comment + ')';}\r\n  var _span = '';\r\n  if (spanId) {\r\n    _span = '[<span class=\"fshLink\" id=\"' +\r\n      spanId + '\">' + button + '</span>]';\r\n  }\r\n  return '<table width=100%><tbody><tr class=\"fshHeader\">' +\r\n    '<td width=\"90%\"><b>&nbsp;' + title + '</b>' + _comment +\r\n    '<td width=\"10%\" class=\"fshBtnBox\">' + _span +\r\n    '</td></tr><tbody></table>';\r\n}\r\n","import makePageHeader from './makePageHeader';\r\n\r\n// function makePageTemplate(title, comment, spanId, button, divId) {\r\nexport default function makePageTemplate(o) {\r\n  return makePageHeader(o.title, o.comment, o.spanId, o.button) +\r\n    '<div class=\"fshSmall\" id=\"' + o.divId + '\"></div>';\r\n}\r\n","export default function intValue(theText) {\r\n  if (!theText) {return 0;}\r\n  return parseInt(theText.replace(/,/g, ''), 10);\r\n}\r\n","import addCommas from './system/addCommas';\r\nimport calf from './support/calf';\r\nimport doSortParams from './common/doSortParams';\r\nimport {getElementById} from './common/getElement';\r\nimport getForage from './ajax/getForage';\r\nimport {imageServer} from './system/system';\r\nimport jQueryPresent from './common/jQueryPresent';\r\nimport numberSort from './system/numberSort';\r\nimport {pCC} from './support/layout';\r\nimport setForage from './ajax/setForage';\r\nimport stringSort from './system/stringSort';\r\n\r\nvar content;\r\nvar monsterAry;\r\n\r\nfunction noMobs() {\r\n  content.innerHTML = '<span>No monster information! ' +\r\n    'Please enable entity log and travel a bit to see the world</span>';\r\n}\r\n\r\nfunction mobRows() {\r\n  var result = '';\r\n  for (var i = 0; i < monsterAry.length; i += 1) {\r\n    result += '<tr>' +\r\n      '<td class=\"fshCenter\">' + monsterAry[i].image + '</td>' +\r\n      '<td>' + monsterAry[i].name + '</td>' +\r\n      '<td class=\"fshCenter\">' + monsterAry[i].creature_class + '</td>' +\r\n      '<td class=\"fshCenter\">' + monsterAry[i].level + '</td>' +\r\n      '<td class=\"fshCenter\">' + monsterAry[i].attack + '</td>' +\r\n      '<td class=\"fshCenter\">' + monsterAry[i].defense + '</td>' +\r\n      '<td class=\"fshCenter\">' + monsterAry[i].armor + '</td>' +\r\n      '<td class=\"fshCenter\">' + monsterAry[i].damage + '</td>' +\r\n      '<td class=\"fshCenter\">' + monsterAry[i].hp + '</td>' +\r\n      '<td class=\"fshCenter\">' + monsterAry[i].enhancements + '</td></tr>';\r\n  }\r\n  return result;\r\n}\r\n\r\nfunction drawMobs() {\r\n  var inject = getElementById('entityTableOutput');\r\n  if (!monsterAry || !inject) {return;}\r\n  inject.innerHTML = mobRows();\r\n}\r\n\r\nfunction findSortType(target) {\r\n  return target.getAttribute('sortType') || 'string';\r\n}\r\n\r\nfunction sortMonsterAry(sortType) {\r\n  if (sortType === 'string') {\r\n    monsterAry.sort(stringSort);\r\n  } else {\r\n    monsterAry.sort(numberSort);\r\n  }\r\n}\r\n\r\nfunction sortCol(target) {\r\n  doSortParams(target.getAttribute('sortKey'));\r\n  var sortType = findSortType(target);\r\n  sortMonsterAry(sortType);\r\n  drawMobs();\r\n}\r\n\r\nfunction doHandlers(evt) { // jQuery.min\r\n  var target = evt.target;\r\n  if (target.id === 'clearEntityLog') {\r\n    setForage('fsh_monsterLog', '');\r\n    noMobs();\r\n    return;\r\n  }\r\n  if (!target.classList.contains('fshLink')) {return;}\r\n  sortCol(target);\r\n}\r\n\r\nfunction drawTable() {\r\n  if (!monsterAry) {return;}\r\n  content.innerHTML = '<table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" ' +\r\n    'width=\"100%\"><tr class=\"fshBlack fshWhite\">' +\r\n    '<td width=\"90%\" class=\"fshCenter\"><b>Entity Information</b></td>' +\r\n    '<td width=\"10%\">[<span id=\"clearEntityLog\" class=\"fshPoint\">Clear' +\r\n    '</span>]</td></tr></table>' +\r\n    '<table cellspacing=\"1\" cellpadding=\"2\" border=\"0\"><thead>' +\r\n    '<tr class=\"fshVerySoftOrange\">' +\r\n    '<th width=\"25%\" class=\"fshLink\" sortkey=\"name\" colspan=\"2\">Entity</th>' +\r\n    '<th class=\"fshCenter fshLink\" sortkey=\"creature_class\">Class</th>' +\r\n    '<th class=\"fshCenter fshLink\" sortkey=\"level\" sorttype=\"number\">Lvl</th>' +\r\n    '<th class=\"fshCenter\">Attack</th>' +\r\n    '<th class=\"fshCenter\">Defence</th>' +\r\n    '<th class=\"fshCenter\">Armor</th>' +\r\n    '<th class=\"fshCenter\">Damage</th>' +\r\n    '<th class=\"fshCenter\">HP</th>' +\r\n    '<th class=\"fshCenter\">Enhancements</th>' +\r\n    '</tr></thead><tbody id=\"entityTableOutput\"></tbody></table>';\r\n  content.addEventListener('click', doHandlers);\r\n}\r\n\r\nfunction hazEnhancements(enhancements) {\r\n  return enhancements && enhancements.length > 0;\r\n}\r\n\r\nfunction prepMonster(data) {\r\n  monsterAry = Object.keys(data).reduce(function(prev, curr) {\r\n    var tmpObj = data[curr];\r\n    tmpObj.name = curr;\r\n    tmpObj.image = '<img class=\"tip-static\" src=\"' + imageServer +\r\n      '/creatures/' + tmpObj.image_id + '.jpg\" data-tipped=\"<img src=\\'' +\r\n      imageServer + '/creatures/' + tmpObj.image_id +\r\n      '.jpg\\' width=200 height=200>\" width=40 height=40>';\r\n    tmpObj.level = addCommas(tmpObj.level);\r\n    tmpObj.attack = tmpObj.attack.min + ' - ' + tmpObj.attack.max;\r\n    tmpObj.defense = tmpObj.defense.min + ' - ' + tmpObj.defense.max;\r\n    tmpObj.armor = tmpObj.armor.min + ' - ' + tmpObj.armor.max;\r\n    tmpObj.damage = tmpObj.damage.min + ' - ' + tmpObj.damage.max;\r\n    tmpObj.hp = tmpObj.hp.min + ' - ' + tmpObj.hp.max;\r\n    var enhancements;\r\n    if (tmpObj.enhancements) {enhancements = Object.keys(tmpObj.enhancements);}\r\n    if (hazEnhancements(enhancements)) {\r\n      var tmp = '<span class=\"fshXXSmall\">';\r\n      tmp += enhancements.reduce(function(_prev, _curr) {\r\n        return _prev + '<span class=\"fshNoWrap\">' + _curr + ': ' +\r\n          tmpObj.enhancements[_curr].min + ' - ' +\r\n          tmpObj.enhancements[_curr].max + '</span><br>';\r\n      }, '');\r\n      tmpObj.enhancements = tmp.slice(0, -4) + '</span>';\r\n    } else {\r\n      tmpObj.enhancements = '<span class=\"fshGrey\">**Missing**</span>';\r\n    }\r\n    prev.push(tmpObj);\r\n    return prev;\r\n  }, []);\r\n}\r\n\r\nfunction prepAry(data) {\r\n  if (!data || data === '') {\r\n    noMobs();\r\n    return;\r\n  }\r\n  prepMonster(data);\r\n  calf.sortBy = 'level';\r\n  calf.sortAsc = true;\r\n  monsterAry.sort(numberSort);\r\n  drawTable();\r\n  drawMobs();\r\n}\r\n\r\nfunction haveJquery(injector) { // jQuery.min\r\n  content = injector || pCC;\r\n  if (!content) {return;}\r\n  getForage('fsh_monsterLog').done(prepAry);\r\n}\r\n\r\nexport default function injectMonsterLog(injector) {\r\n  if (jQueryPresent()) {haveJquery(injector);}\r\n}\r\n","import {getElementById} from './common/getElement';\r\nimport getForage from './ajax/getForage';\r\nimport jConfirm from './common/jConfirm';\r\nimport jQueryNotPresent from './common/jQueryNotPresent';\r\nimport {pCC} from './support/layout';\r\nimport setForage from './ajax/setForage';\r\n\r\nvar content;\r\nvar combatLog = [];\r\nvar textArea;\r\n\r\nfunction notepadCopyLog() {\r\n  textArea.focus();\r\n  textArea.select();\r\n}\r\n\r\nfunction clearCombatLog() {\r\n  combatLog = [];\r\n  textArea.value = '[]';\r\n  setForage('fsh_combatLog', combatLog);\r\n}\r\n\r\nfunction notepadClearLog() { // jQuery\r\n  jConfirm('Clear Combat Log',\r\n    'Are you sure you want to clear your log?', clearCombatLog\r\n  );\r\n}\r\n\r\nfunction gotCombatLog(data) {\r\n  if (data) {combatLog = data;}\r\n  var yuuzParser = '<tr><td align=\"center\" colspan=\"4\"><b>Log Parser</b>' +\r\n    '</td></tr>' +\r\n    '<tr><td colspan=\"4\" align=\"center\">WARNING: this links to an ' +\r\n    'external site not related to HCS.<br />' +\r\n    'If you wish to visit site directly URL is: http://evolutions.' +\r\n    'yvong.com/fshlogparser.php<br />' +\r\n    '<tr><td colspan=4 align=\"center\"><input type=\"hidden\" value=\"true\" ' +\r\n    'name=\"submit\"><input type=\"submit\" value=\"Analyze!\"></td></tr>';\r\n  content.innerHTML = '<h1>Combat Logs</h1><br /><form action=\"http://' +\r\n    'evolutions.yvong.com/fshlogparser.php\" method=\"post\" target=\"_blank\">' +\r\n    '<div align=\"center\"><textarea align=\"center\" cols=\"80\" rows=\"25\" ' +\r\n    'readonly style=\"background-color:white;font-family:Consolas,\\'' +\r\n    'Lucida Console\\',\\'Courier New\\',monospace;\" id=\"combatLog\" ' +\r\n    'name=\"logs\">' + JSON.stringify(combatLog) + '</textarea></div>' +\r\n    '<br /><br /><table width=\"100%\"><tr>' +\r\n    '<td colspan=\"2\" align=center>' +\r\n    '<input type=\"button\" class=\"custombutton\" value=\"Select All\" ' +\r\n    'id=\"copyLog\"></td>' +\r\n    '<td colspan=\"2\" align=center>' +\r\n    '<input type=\"button\" class=\"custombutton\" value=\"Clear\" ' +\r\n    'id=\"clearLog\"></td>' +\r\n    '</tr>' + yuuzParser + '</table></div>' +\r\n    '</form>';\r\n  textArea = getElementById('combatLog');\r\n  getElementById('copyLog')\r\n    .addEventListener('click', notepadCopyLog);\r\n  getElementById('clearLog')\r\n    .addEventListener('click', notepadClearLog);\r\n}\r\n\r\nexport default function injectNotepadShowLogs(injector) { // jQuery.min\r\n  if (jQueryNotPresent()) {return;}\r\n  content = injector || pCC;\r\n  getForage('fsh_combatLog').done(gotCombatLog);\r\n}\r\n","import {getElementById} from './common/getElement';\r\nimport getForage from './ajax/getForage';\r\nimport jQueryNotPresent from './common/jQueryNotPresent';\r\nimport makePageTemplate from './lists/makePageTemplate';\r\nimport setForage from './ajax/setForage';\r\nimport {\r\n  calculateBoundaries,\r\n  gvgLowerLevel,\r\n  gvgUpperLevel,\r\n  pvpLowerLevel,\r\n  pvpUpperLevel\r\n} from './common/levelHighlight';\r\nimport {pCC, quickBuffHref} from './support/layout';\r\n\r\nexport function injectFindPlayer() { // Bad jQuery\r\n  if (jQueryNotPresent()) {return;}\r\n  calculateBoundaries();\r\n  var findPlayerButton = $('input[value=\"Find Player\"]');\r\n  findPlayerButton.parent().append('&nbsp;<a href=\"index.php?' +\r\n    'cmd=findplayer&search_active=1&search_username=&search_level_min=' +\r\n    pvpLowerLevel + '&search_level_max=' +\r\n    pvpUpperLevel + '&search_in_guild=0\"><span ' +\r\n    'style=\"color:blue;\">Get PvP targets</span></a>&nbsp;<a href=\"' +\r\n    'index.php?cmd=findplayer&search_active=1&search_username=&' +\r\n    'search_level_min=' + gvgLowerLevel + '&search_level_max=' +\r\n    gvgUpperLevel + '&search_in_guild=0\"><span style=\"color:blue;\">' +\r\n    'Get GvG targets</span></a>');\r\n\r\n  $('table[class=\"width_full\"]').find('a[href*=\"player_id\"]')\r\n    .each(function(i, e) {\r\n      var id = /player_id=([0-9]*)/.exec($(e).attr('href'));\r\n      $(e).after('<a style=\"color:blue;font-size:10px;\" ' +\r\n        quickBuffHref(id[1]) + '>[b]</a>');\r\n    });\r\n}\r\n\r\nexport function injectNotepad() { // jQuery\r\n  if (jQueryNotPresent()) {return;}\r\n  $('#notepad_notes')\r\n    .attr('cols', '90')\r\n    .attr('rows', '30')\r\n    .css('resize', 'none');\r\n}\r\n\r\nexport function injectFsBoxContent(injector) { // jQuery.min\r\n  if (jQueryNotPresent()) {return;}\r\n  var content = injector || pCC;\r\n  content.innerHTML = makePageTemplate({\r\n    title: 'FS Box Log',\r\n    comment: '',\r\n    spanId: 'fsboxclear',\r\n    button: 'Clear',\r\n    divId: 'fsboxdetail'\r\n  });\r\n  getForage('fsh_fsboxcontent').done(function(fsboxcontent) {\r\n    getElementById('fsboxdetail').innerHTML = fsboxcontent;\r\n  });\r\n  getElementById('fsboxclear')\r\n    .addEventListener('click', function() {\r\n      setForage('fsh_fsboxcontent', '');\r\n      location.reload();\r\n    }, true);\r\n}\r\n","import {createDiv} from '../common/cElement';\r\nimport {getElementById} from '../common/getElement';\r\n\r\nexport default function jQueryDialog(fn) { // jQuery\r\n  var content = getElementById('content');\r\n  if (content) {content.innerHTML = '';} else {\r\n    content = createDiv({\r\n      id: 'content',\r\n      style: {display: 'none'}\r\n    });\r\n    document.body.appendChild(content);\r\n  }\r\n  $(content).dialog({\r\n    width: 640,\r\n    modal: true,\r\n    position: {my: 'top', at: 'top', offset: '0 60', collision: 'none'},\r\n    resizable: false\r\n  });\r\n  fn(content);\r\n}\r\n","import {createSpan} from '../common/cElement';\r\nimport {getElementById} from '../common/getElement';\r\nimport getForage from '../ajax/getForage';\r\nimport {injectFsBoxContent} from '../misc';\r\nimport jQueryDialog from './jQueryDialog';\r\nimport {sendEvent} from '../support/fshGa';\r\nimport setForage from '../ajax/setForage';\r\n\r\nfunction getBoxList(boxList) {\r\n  if (boxList) {return boxList;}\r\n  return '';\r\n}\r\n\r\nfunction storeFSBox(_boxList) {\r\n  var boxList = getBoxList(_boxList);\r\n  var fsbox = getElementById('minibox-fsbox')\r\n    .getElementsByClassName('message')[0].innerHTML;\r\n  if (boxList.indexOf(fsbox) < 0) {boxList = '<br>' + fsbox + boxList;}\r\n  if (boxList.length > 10000) {boxList = boxList.substring(0, 10000);}\r\n  setForage('fsh_fsboxcontent', boxList);\r\n}\r\n\r\nfunction fSBoxExists(node) { // jQuery.min\r\n  var nodediv = node.lastElementChild;\r\n  var playerName = nodediv.getElementsByTagName('a');\r\n  if (playerName.length === 0) {return;}\r\n  getForage('fsh_fsboxcontent').done(storeFSBox);\r\n  playerName = playerName[0].textContent;\r\n  nodediv.insertAdjacentHTML('beforeend',\r\n    '<br><span class=\"fshPaleVioletRed\">' +\r\n    '[ <a href=\"index.php?cmd=log&subcmd=doaddignore&ignore_username=' +\r\n    playerName + '\">Ignore</a> ]</span> ');\r\n  var log = createSpan({\r\n    className: 'fshYellow',\r\n    innerHTML: '[ <span class=\"fshLink\">Log</span> ]'\r\n  });\r\n  log.addEventListener('click', function() {\r\n    sendEvent('injectFSBoxLog', 'injectFsBoxContent');\r\n    jQueryDialog(injectFsBoxContent);\r\n  });\r\n  nodediv.appendChild(log);\r\n}\r\n\r\nexport default function injectFSBoxLog() {\r\n  var node = getElementById('minibox-fsbox');\r\n  if ($ && node) {fSBoxExists(node);}\r\n}\r\n","import {getElementById} from '../common/getElement';\r\nimport getForage from '../ajax/getForage';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport makePageTemplate from '../lists/makePageTemplate';\r\nimport {pCC} from '../support/layout';\r\nimport setForage from '../ajax/setForage';\r\n\r\nfunction displayBuffLog(buffLog) {\r\n  getElementById('bufflog').innerHTML = buffLog;\r\n}\r\n\r\nfunction clearBuffLog() {\r\n  setForage('fsh_buffLog', '').done(displayBuffLog);\r\n}\r\n\r\nexport default function injectBuffLog(injector) { // jQuery.min\r\n  if (jQueryNotPresent()) {return;}\r\n  var content = injector || pCC;\r\n  content.innerHTML = makePageTemplate({\r\n    title: 'Buff Log',\r\n    comment: '',\r\n    spanId: 'clearBuffs',\r\n    button: 'Clear',\r\n    divId: 'bufflog'\r\n  });\r\n  getElementById('clearBuffs').addEventListener('click', clearBuffLog);\r\n  getForage('fsh_buffLog').done(displayBuffLog);\r\n}\r\n","export default function addCommas(x) {\r\n  return x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\r\n}\r\n","import calf from '../support/calf';\r\n\r\nfunction reverseSort(headerClicked) {\r\n  return calf.sortBy && calf.sortBy === headerClicked;\r\n}\r\n\r\nexport default function doSortParams(headerClicked) {\r\n  if (typeof calf.sortAsc === 'undefined') {calf.sortAsc = true;}\r\n  if (reverseSort(headerClicked)) {\r\n    calf.sortAsc = !calf.sortAsc;\r\n  }\r\n  calf.sortBy = headerClicked;\r\n}\r\n","import fallback from './fallback';\r\n\r\nfunction getPath(obj, aPath, def) {\r\n  var _obj = obj;\r\n  var _path = aPath.split('.');\r\n  var len = _path.length;\r\n  for (var i = 0; i < len; i += 1) {\r\n    if (fallback(!_obj, typeof _obj !== 'object')) {return def;}\r\n    _obj = _obj[_path[i]];\r\n  }\r\n  return _obj;\r\n}\r\n\r\nexport default function path(obj, aPath, def) {\r\n  var _obj = getPath(obj, aPath, def);\r\n  if (typeof _obj === 'undefined') {return def;}\r\n  return _obj;\r\n}\r\n","import calf from '../support/calf';\r\n\r\nexport default function sortDesc(result) {\r\n  if (calf.sortAsc) {return result;}\r\n  return -result;\r\n}\r\n","import calf from '../support/calf';\r\nimport path from './path';\r\nimport sortDesc from './sortDesc';\r\n\r\nfunction intFromString(val) {\r\n  if (typeof val === 'string') {\r\n    return parseInt(val.replace(/,|#/g, ''), 10);\r\n  }\r\n  return val;\r\n}\r\n\r\nfunction aIsNotEquipment(a) {\r\n  return typeof a.type !== 'undefined' && a.type > 8;\r\n}\r\n\r\nfunction bIsNotEquipment(a, b) {\r\n  return typeof a.type !== 'undefined' && b.type > 8;\r\n}\r\n\r\nexport default function numberSort(a, b) {\r\n  if (aIsNotEquipment(a)) {return 1;} // non equipment items\r\n  if (bIsNotEquipment(a, b)) {return -1;}\r\n  var valueA = path(a, calf.sortBy, 1);\r\n  var valueB = path(b, calf.sortBy, 1);\r\n  valueA = intFromString(valueA);\r\n  valueB = intFromString(valueB);\r\n  var result = valueA - valueB;\r\n  return sortDesc(result);\r\n}\r\n","import calf from '../support/calf';\r\nimport path from './path';\r\nimport sortDesc from './sortDesc';\r\n\r\nexport default function stringSort(a, b) {\r\n  var result = 0;\r\n  var _a = path(a, calf.sortBy, 'a');\r\n  var _b = path(b, calf.sortBy, 'a');\r\n  if (_a.toLowerCase() < _b.toLowerCase()) {result = -1;}\r\n  if (_a.toLowerCase() > _b.toLowerCase()) {result = 1;}\r\n  return sortDesc(result);\r\n}\r\n","import {createDiv} from './cElement';\r\nimport {getElementById} from './getElement';\r\n\r\nexport default function jConfirm(title, msgText, fn) { // jQuery\r\n  var fshMsg = getElementById('fshmsg');\r\n  if (!fshMsg) {\r\n    fshMsg = createDiv({id: 'fshmsg'});\r\n    document.body.appendChild(fshMsg);\r\n    $(fshMsg).dialog({\r\n      autoOpen: false,\r\n      dialogClass: 'no-close',\r\n      draggable: false,\r\n      modal: true,\r\n      resizable: false,\r\n    });\r\n  }\r\n  fshMsg.textContent = msgText;\r\n  $(fshMsg).dialog('option', {\r\n    buttons: {\r\n      Yes: function() {\r\n        fn();\r\n        $(this).dialog('close');\r\n      },\r\n      No: function() {$(this).dialog('close');}\r\n    },\r\n    title: title\r\n  }).dialog('open');\r\n}\r\n","import createDocument from './system/createDocument';\r\nimport currentGuildId from './common/currentGuildId';\r\nimport fallback from './system/fallback';\r\nimport getForage from './ajax/getForage';\r\nimport getValue from './system/getValue';\r\nimport intValue from './system/intValue';\r\nimport jQueryNotPresent from './common/jQueryNotPresent';\r\nimport retryAjax from './ajax/retryAjax';\r\nimport setForage from './ajax/setForage';\r\nimport setValue from './system/setValue';\r\nimport {\r\n  calculateBoundaries,\r\n  pvpLowerLevel,\r\n  pvpUpperLevel\r\n} from './common/levelHighlight';\r\nimport {defaults, now} from './support/dataObj';\r\n\r\nvar context;\r\nvar onlinePlayers;\r\nvar onlineData;\r\nvar highlightPlayersNearMyLvl;\r\nvar onlinePages;\r\nvar lastPage;\r\nvar table;\r\nvar guildId;\r\n\r\nfunction buildOnlinePlayerData() { // jQuery\r\n  onlineData = [];\r\n  Object.keys(onlinePlayers).forEach(function(player) {\r\n    var guildImage = $('<div/>')\r\n      .append(onlinePlayers[player][0]);\r\n    $('img', guildImage).addClass('fshImgCntr');\r\n    onlineData.push([\r\n      guildImage.html(),\r\n      onlinePlayers[player][1],\r\n      onlinePlayers[player][2],\r\n      onlinePlayers[player][3] * 100 +\r\n      onlinePlayers[player][4] + 1,\r\n    ]);\r\n  });\r\n}\r\n\r\nfunction saveVal(key, val) {\r\n  if (!isNaN(val)) {setValue(key, val);}\r\n}\r\n\r\nvar lvlTests = [\r\n  function(level, min, max) {return isNaN(min) && isNaN(max);},\r\n  function(level, min, max) {return isNaN(min) && level <= max;},\r\n  function(level, min, max) {return min <= level && isNaN(max);},\r\n  function(level, min, max) {return min <= level && level <= max;}\r\n];\r\n\r\nfunction dataTableSearch(_settings, data) { // jQuery\r\n  /* Custom filtering function which will search\r\n  data in column three between two values */\r\n  var min = parseInt($('#fshMinLvl', context).val(), 10); // context\r\n  var max = parseInt($('#fshMaxLvl', context).val(), 10); // context\r\n  saveVal('onlinePlayerMinLvl', min);\r\n  saveVal('onlinePlayerMaxLvl', max);\r\n  var level = fallback(intValue(data[2]), 0);\r\n  for (var i = 0; i < lvlTests.length; i += 1) {\r\n    if (lvlTests[i](level, min, max)) {return true;}\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction filterHeaderOnlinePlayers() { // jQuery\r\n  $('#fshOutput', context).html( // context\r\n    '<div align=right>' +\r\n    'Min lvl:<input value=\"' + getValue('onlinePlayerMinLvl') +\r\n      '\" size=5 id=\"fshMinLvl\" /> ' +\r\n    'Max lvl:<input value=\"' + getValue('onlinePlayerMaxLvl') +\r\n      '\" size=5 id=\"fshMaxLvl\" /> ' +\r\n    '<input id=\"fshReset\" type=\"button\" value=\"Reset\"/>' +\r\n    '</div><table id=\"fshInv\" class=\"allow stripe hover\"></table>');\r\n}\r\n\r\nfunction guildNumber(html) {\r\n  var match = html.match(/;guild_id=([0-9]+)\"/);\r\n  if (match) {return Number(match[1]);}\r\n}\r\n\r\nvar highlightTests = [\r\n  function() {return highlightPlayersNearMyLvl;},\r\n  function(data) {return guildNumber(data[0]) !== guildId;},\r\n  function(data) {return intValue(data[2]) >= pvpLowerLevel;},\r\n  function(data) {return intValue(data[2]) <= pvpUpperLevel;}\r\n];\r\n\r\nfunction pvpHighlight(data) {\r\n  return highlightTests.every(function(el) {\r\n    return el(data);\r\n  });\r\n}\r\n\r\nfunction gotOnlinePlayers() { // jQuery\r\n  buildOnlinePlayerData();\r\n  $.fn.dataTable.ext.search.push(dataTableSearch);\r\n  filterHeaderOnlinePlayers();\r\n  highlightPlayersNearMyLvl = getValue('highlightPlayersNearMyLvl');\r\n  calculateBoundaries();\r\n  guildId = currentGuildId();\r\n\r\n  table = $('#fshInv', context).dataTable({ // context\r\n    data: onlineData,\r\n    pageLength: 30,\r\n    lengthMenu: [[30, 60, -1], [30, 60, 'All']],\r\n    columns: [\r\n      {title: 'Guild', 'class': 'dt-center', orderable: false},\r\n      {title: 'Name', 'class': 'dt-center'},\r\n      {title: 'Level', 'class': 'dt-center'},\r\n      {title: 'Page/Index', 'class': 'dt-center'}\r\n    ],\r\n    createdRow: function(row, data) {\r\n      if (pvpHighlight(data)) {\r\n        $('td', row).eq(2).addClass('lvlHighlight');\r\n      }\r\n    },\r\n    order: [3, 'desc'],\r\n    stateSave: true,\r\n    stateDuration: 0\r\n  }).api();\r\n}\r\n\r\nfunction checkLastPage() {\r\n  if (onlinePages === lastPage) {\r\n    setForage('fsh_onlinePlayers', onlinePlayers);\r\n    gotOnlinePlayers();\r\n  }\r\n}\r\n\r\nfunction getOnlinePlayers(data) { // Bad jQuery\r\n  $('#fshOutput', context).append(' ' +\r\n    (onlinePages + 1)); // context\r\n  var doc = createDocument(data);\r\n  var input = $('#pCC input.custominput', doc).first();\r\n  var thePage = input.attr('value');\r\n  var theRows = $('#pCC img[src$=\"/skin/icon_action_view.gif',\r\n    doc).parent().parent().parent();\r\n  theRows.each(function(index, element) {\r\n    var tds = $('td', $(element));\r\n    var player = tds.eq(1).text();\r\n    if (onlinePlayers[player] &&\r\n        onlinePlayers[player][3] > thePage) {return;}\r\n    onlinePlayers[player] = [\r\n      tds.eq(0).html(),\r\n      tds.eq(1).html(),\r\n      tds.eq(2).text(),\r\n      thePage,\r\n      index\r\n    ];\r\n  });\r\n  onlinePages += 1;\r\n  if (onlinePages === 1) {\r\n    input = input.parent().text();\r\n    lastPage = parseInt(input.match(/(\\d+)/g)[0], 10);\r\n    for (var i = 2; i <= lastPage; i += 1) {\r\n      retryAjax('index.php?no_mobile=1&cmd=onlineplayers&page=' + i)\r\n        .done(getOnlinePlayers);\r\n    }\r\n  }\r\n  checkLastPage();\r\n}\r\n\r\nfunction refreshEvt() { // Bad jQuery\r\n  $('#fshRefresh', context).hide();\r\n  onlinePages = 0;\r\n  onlinePlayers = {};\r\n  retryAjax('index.php?no_mobile=1&cmd=onlineplayers&page=1')\r\n    .done(getOnlinePlayers);\r\n  setValue('lastOnlineCheck', now);\r\n  $('#fshOutput', context).append('Parsing online players...'); // context\r\n}\r\n\r\nfunction changeLvl(e) { // jQuery\r\n  if (e.target.id === 'fshMinLvl' || e.target.id === 'fshMaxLvl') {\r\n    table.draw();\r\n  }\r\n}\r\n\r\nfunction resetEvt() { // context\r\n  setValue('onlinePlayerMinLvl',\r\n    defaults.onlinePlayerMinLvl);\r\n  setValue('onlinePlayerMaxLvl',\r\n    defaults.onlinePlayerMaxLvl);\r\n  $('#fshMinLvl', context).val(\r\n    defaults.onlinePlayerMinLvl); // context\r\n  $('#fshMaxLvl', context).val(\r\n    defaults.onlinePlayerMaxLvl); // context\r\n  table.draw();\r\n}\r\n\r\nfunction doOnlinePlayerEventHandlers(e) {\r\n  if (e.target.id === 'fshRefresh') {refreshEvt();}\r\n  if (e.target.id === 'fshReset') {resetEvt();}\r\n}\r\n\r\nfunction injectOnlinePlayersNew() { // jQuery\r\n  var lastCheck = getValue('lastOnlineCheck');\r\n  var refreshButton;\r\n  if (now - lastCheck > 300000) {\r\n    refreshButton = '<span> (takes a while to refresh so only do it ' +\r\n      'if you really need to) </span><span id=\"fshRefresh\" class=\"fshLink\"' +\r\n      '>[Refresh]</span>';\r\n  } else {\r\n    refreshButton = '<span>[ Wait ' + Math.round(300 - (now -\r\n      lastCheck) / 1000) + 's ]</span>';\r\n  }\r\n  context.html(\r\n    '<span><b>Online Players</b></span>' + refreshButton +\r\n    '<div id=\"fshOutput\"></div>');\r\n  getForage('fsh_onlinePlayers').done(function(value) {\r\n    onlinePlayers = value || {};\r\n    gotOnlinePlayers();\r\n  });\r\n  context[0].addEventListener('click', doOnlinePlayerEventHandlers);\r\n  context[0].addEventListener('keyup', changeLvl);\r\n}\r\n\r\nexport default function injectOnlinePlayers(content) { // jQuery\r\n  if (jQueryNotPresent()) {return;}\r\n  if (content) {\r\n    context = $(content);\r\n  } else {\r\n    context = $('#pCC');\r\n  }\r\n  injectOnlinePlayersNew();\r\n}\r\n","export default function currentGuildId() {\r\n  var guildId;\r\n  var nodeList = document.body.getElementsByTagName('script');\r\n  Array.prototype.forEach.call(nodeList, function getGuildId(el) {\r\n    var match = el.textContent.match(/\\s+guildId: ([0-9]+),/);\r\n    if (match) {guildId = parseInt(match[1], 10);}\r\n  });\r\n  return guildId;\r\n}\r\n","import getValue from '../system/getValue';\r\nimport {playerId} from '../support/layout';\r\nimport setForage from '../ajax/setForage';\r\nimport shouldBeArray from '../system/shouldBeArray';\r\n\r\nvar currentPlayerId;\r\nvar hideRecipes = [];\r\n\r\nfunction getRecipeItems(recipe) {\r\n  if (recipe.items) {\r\n    return recipe.items.reduce(function(prev, itm) {\r\n      return prev + '<div class=\"rmItem\"><img class=\"tip-dynamic\" ' +\r\n        'data-tipped=\"fetchitem.php?item_id=' +\r\n        itm.id + '&inv_id=-1&t=2&p=' +\r\n        currentPlayerId + '&vcode=' +\r\n        itm.verify + '\" src=\"' +\r\n        itm.img + '\" height=\"20px\" width=\"20px\"><p>' +\r\n        itm.amountPresent + '/' +\r\n        itm.amountNeeded + '</p></div>';\r\n    }, '');\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction getComponents(recipe) {\r\n  if (recipe.components) {\r\n    return recipe.components.reduce(function(prev, comp) {\r\n      return prev + '<div class=\"rmItem\"><img class=\"tip-dynamic\" ' +\r\n        'data-tipped=\"fetchitem.php?item_id=' +\r\n        comp.id + '&inv_id=-1&t=2&p=' +\r\n        currentPlayerId + '&vcode=' +\r\n        comp.verify + '\" src=\"' +\r\n        comp.img + '\" height=\"20px\" width=\"20px\"><p>' +\r\n        comp.amountPresent + '/' +\r\n        comp.amountNeeded + '</p></div>';\r\n    }, '');\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction getImg(recipe) {\r\n  if (recipe.target) {\r\n    return ' <img class=\"tip-dynamic\" ' +\r\n      'data-tipped=\"fetchitem.php?item_id=' +\r\n      recipe.target.id + '&inv_id=-1&t=2&p=' + currentPlayerId +\r\n      '&vcode=' + recipe.target.verify + '\" ' +\r\n      'src=\"' + recipe.target.img +\r\n      '\" height=\"30px\" width=\"30px\"><br/>';\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction drawRecipeTable(output, recipebook) { // Legacy\r\n  currentPlayerId = playerId();\r\n  var i;\r\n  var result = '<table width=\"100%\"><tr class=\"rmTh\"><th>Recipe</th>' +\r\n    '<th><span id=\"sortName\" class=\"fshLink\" sortkey=\"name\">Name</span>' +\r\n    '</th><th>Items</th><th>Components</th><th>Target</th></tr>';\r\n  var recipe;\r\n  for (i = 0; i < recipebook.recipe.length; i += 1) {\r\n    recipe = recipebook.recipe[i];\r\n    if (hideRecipes.indexOf(recipe.name) !== -1) {continue;}\r\n    result += '<tr class=\"rmTr\"><td class=\"rmTd\"><a href=\"' + recipe.link +\r\n      '\"><img src=\"' + recipe.img +\r\n      '\" height=\"30px\" width=\"30px\"></a></td><td class=\"rmTd\"><a href=\"' +\r\n      recipe.link + '\">' + recipe.name + '</a></td><td class=\"rmTd\">';\r\n    result += getRecipeItems(recipe);\r\n    result += '</td><td class=\"rmTd\">';\r\n    result += getComponents(recipe);\r\n    result += '</td><td class=\"rmTd\">';\r\n    result += getImg(recipe);\r\n    result += '</td></tr>';\r\n  }\r\n  result += '</table>';\r\n  output.innerHTML = result;\r\n  recipebook.lastUpdate = new Date();\r\n  setForage('fsh_recipeBook', recipebook);\r\n}\r\n\r\nexport default function generateRecipeTable(output, recipebook) { // Legacy\r\n  if (recipebook) {\r\n    if (getValue('hideRecipes')) {\r\n      hideRecipes = shouldBeArray('hideRecipeNames');\r\n    }\r\n    drawRecipeTable(output, recipebook);\r\n  }\r\n}\r\n","import getValue from './getValue';\r\n\r\nexport default function shouldBeArray(pref) {\r\n  var stored = getValue(pref);\r\n  if (stored && stored !== '') {return stored.split(/\\s*,\\s*/);}\r\n  return [];\r\n}\r\n","export default function insertElement(parent, child) {\r\n  if (parent instanceof Node) {\r\n    parent.appendChild(child);\r\n  }\r\n}\r\n","import createDocument from '../system/createDocument';\r\nimport getCustomUrlParameter from '../system/getCustomUrlParameter';\r\nimport {getElementById} from '../common/getElement';\r\nimport retryAjax from '../ajax/retryAjax';\r\n\r\nvar itmRE =\r\n  /fetchitem.php\\?item_id=(\\d+)&inv_id=-1&t=2&p=(\\d+)&vcode=([a-z0-9]+)/i;\r\n\r\nfunction hasAmounts(result, amounts) {\r\n  if (amounts) {\r\n    var resultAmounts = amounts.textContent.split('/');\r\n    result.amountPresent = parseInt(resultAmounts[0], 10);\r\n    result.amountNeeded = parseInt(resultAmounts[1], 10);\r\n  }\r\n}\r\n\r\nfunction reduceItemOrComponent(bgGif, prev, el) {\r\n  var background = el.getAttribute('background');\r\n  if (!background || background.indexOf(bgGif) === -1) {return prev;}\r\n  var img = el.children[0].children[0];\r\n  var mouseOver = img.dataset.tipped;\r\n  var mouseOverRX = mouseOver.match(itmRE);\r\n  var result = {\r\n    img: img.getAttribute('src'),\r\n    id: mouseOverRX[1],\r\n    verify: mouseOverRX[3]\r\n  };\r\n  hasAmounts(result, el.parentNode.nextElementSibling);\r\n  prev.push(result);\r\n  return prev;\r\n}\r\n\r\nfunction parseRecipeItemOrComponent(bgGif, doc) {\r\n  var tblCells = getElementById('pCC', doc).getElementsByTagName('td');\r\n  return Array.prototype.reduce.call(tblCells,\r\n    reduceItemOrComponent.bind(null, bgGif), []);\r\n}\r\n\r\nfunction processRecipe(output, recipebook, recipe, data) {\r\n  var doc = createDocument(data);\r\n  output.insertAdjacentHTML('beforeend',\r\n    'Parsing blueprint ' + recipe.name + '...<br>');\r\n  recipe.items = parseRecipeItemOrComponent('/inventory/2x3.gif', doc);\r\n  recipe.components = parseRecipeItemOrComponent('/inventory/1x1mini.gif', doc);\r\n  recipe.target = parseRecipeItemOrComponent('/hellforge/2x3.gif', doc)[0];\r\n  recipebook.recipe.push(recipe);\r\n}\r\n\r\nfunction processFolderAnyPage(output, recipebook, data) { // jQuery.min\r\n  var doc = createDocument(data);\r\n  var innerPcc = getElementById('pCC', doc);\r\n  var scope = innerPcc.firstElementChild.rows[6].cells[0]\r\n    .firstElementChild.getElementsByTagName('a');\r\n  var prm = Array.prototype.reduce.call(scope, function(prev, el) {\r\n    output.insertAdjacentHTML('beforeend',\r\n      'Found blueprint \"' + el.textContent + '\".<br>');\r\n    var recipe = {\r\n      img: el.parentNode.previousElementSibling.firstElementChild\r\n        .getAttribute('src'),\r\n      link: el.href,\r\n      name: el.textContent,\r\n      id: getCustomUrlParameter(el.href, 'recipe_id')\r\n    };\r\n    prev.push(retryAjax(el.href)\r\n      .pipe(processRecipe.bind(null, output, recipebook, recipe)));\r\n    return prev;\r\n  }, []);\r\n  return $.when.apply($, prm);\r\n}\r\n\r\nfunction processFolderFirstPage(output, recipebook, data) { // jQuery.min\r\n  var prm = [];\r\n  var doc = createDocument(data);\r\n  var innerPcc = getElementById('pCC', doc);\r\n  var scope = innerPcc.firstElementChild.rows[4].cells[0]\r\n    .firstElementChild.getElementsByTagName('img');\r\n  var thisFolder = Array.prototype.filter.call(scope, function(el) {\r\n    return /\\/folder_on\\.gif/.test(el.getAttribute('src'));\r\n  })[0];\r\n  var pages = innerPcc.getElementsByClassName('customselect')[0]\r\n    .getElementsByTagName('option').length;\r\n  for (var i = 1; i < pages; i += 1) {\r\n    prm.push(retryAjax(thisFolder.parentNode.href + '&page=' + i)\r\n      .pipe(processFolderAnyPage.bind(null, output, recipebook)));\r\n  }\r\n  prm.push($.when(data)\r\n    .pipe(processFolderAnyPage.bind(null, output, recipebook)));\r\n  return $.when.apply($, prm);\r\n}\r\n\r\nfunction reduceFolders(output, recipebook, prev, el) { // jQuery.min\r\n  var href = el.parentNode.href;\r\n  var folderName = el.parentNode.nextElementSibling.nextElementSibling\r\n    .firstChild.textContent;\r\n  if (getCustomUrlParameter(href, 'folder_id') === '-1') {\r\n    return prev;\r\n  }\r\n  if (/quest/i.test(folderName)) {\r\n    output.insertAdjacentHTML('beforeend', 'Skipping folder \"' +\r\n      folderName + '\"  as it has the word \"quest\" in folder name.<br>');\r\n    return prev;\r\n  }\r\n  prev.push(retryAjax(href)\r\n    .pipe(processFolderFirstPage.bind(null, output, recipebook)));\r\n  return prev;\r\n}\r\n\r\nexport default function processFirstPage(output, recipebook, data) { // jQuery.min\r\n  var doc = createDocument(data);\r\n  var scope = getElementById('pCC', doc).firstElementChild.rows[4].cells[0]\r\n    .firstElementChild.getElementsByTagName('img');\r\n  var prm = Array.prototype.reduce.call(scope,\r\n    reduceFolders.bind(null, output, recipebook), []);\r\n  prm.push($.when(data)\r\n    .pipe(processFolderFirstPage.bind(null, output, recipebook)));\r\n  return $.when.apply($, prm);\r\n}\r\n","import {createDiv} from '../common/cElement';\r\nimport generateRecipeTable from './generateRecipeTable';\r\nimport insertElement from '../common/insertElement';\r\nimport processFirstPage from './processFirstPage';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport setForage from '../ajax/setForage';\r\n\r\nexport var recipebook;\r\nexport var output;\r\n\r\nfunction displayStuff() {\r\n  output.insertAdjacentHTML('beforeend', 'Finished parsing ... formatting ...');\r\n  setForage('fsh_recipeBook', recipebook);\r\n  generateRecipeTable(output, recipebook);\r\n}\r\n\r\nexport function parseInventingStart() { // jQuery.min\r\n  recipebook = {};\r\n  recipebook.recipe = [];\r\n  output.innerHTML = '<br>Parsing inventing screen ...<br>';\r\n  retryAjax('index.php?no_mobile=1&cmd=inventing')\r\n    .pipe(processFirstPage.bind(null, output, recipebook))\r\n    .done(displayStuff);\r\n}\r\n\r\nexport function gotRecipeBook(content, data) {\r\n  recipebook = data;\r\n  content.innerHTML = '<table class=\"fshInvFilter\"><thead><tr>' +\r\n    '<th width=\"90%\"><b>&nbsp;Recipe Manager</b></th>' +\r\n    '<th width=\"10%\" class=\"fshBtnBox\">[' +\r\n    '<span id=\"rfsh\" class=\"fshLink\">' +\r\n    'Refresh</span>]</th>' +\r\n    '</tr></thead></table>';\r\n  output = createDiv();\r\n  insertElement(content, output);\r\n  if (!recipebook) {\r\n    parseInventingStart();\r\n  } else {\r\n    generateRecipeTable(output, recipebook);\r\n  }\r\n}\r\n","import outputResult from './outputResult';\r\n\r\nvar lastMsg;\r\n\r\nfunction notSeenErrorMessage(json) {\r\n  return !json.s && lastMsg !== json.e.message;\r\n}\r\n\r\nexport default function jsonFail(json, handle) {\r\n  if (notSeenErrorMessage(json)) {\r\n    lastMsg = json.e.message;\r\n    outputResult(json.e.message, handle);\r\n  }\r\n  if (!json.s) {return true;}\r\n}\r\n","import {createTable} from './common/cElement';\r\nimport eventHandler from './common/eventHandler';\r\nimport {getElementById} from './common/getElement';\r\nimport getInventory from './ajax/getInventory';\r\nimport {imageServer} from './system/system';\r\nimport jConfirm from './common/jConfirm';\r\nimport jQueryNotPresent from './common/jQueryNotPresent';\r\nimport jsonFail from './common/jsonFail';\r\nimport outputResult from './common/outputResult';\r\nimport {pCC} from './support/layout';\r\nimport useitem from './app/profile/useitem';\r\n\r\nvar extTbl;\r\nvar playerId;\r\nvar extractInv;\r\nvar selectST;\r\nvar selectMain;\r\nvar resourceList;\r\nvar buyResult;\r\n\r\nfunction backpackRemove(invId) {\r\n  extractInv.some(function(el, i, ary) {\r\n    if (el.inv_id === invId) {\r\n      ary.splice(i, 1);\r\n      return true;\r\n    }\r\n    return false;\r\n  });\r\n}\r\n\r\nfunction quickDoneExtracted(invId, json) {\r\n  if (jsonFail(json, buyResult)) {return;}\r\n  backpackRemove(invId);\r\n  outputResult('Item Extracted.', buyResult);\r\n}\r\n\r\nfunction doExtract(target) {\r\n  var InventoryIDs = resourceList[target.id.replace('fshExtr', '')].invIDs;\r\n  target.parentNode.innerHTML = 'extracting all ' +\r\n    InventoryIDs.length + ' resources';\r\n  for (var i = 0; i < InventoryIDs.length; i += 1) {\r\n    useitem(InventoryIDs[i])\r\n      .done(quickDoneExtracted.bind(null, InventoryIDs[i]));\r\n  }\r\n}\r\n\r\nfunction extractAllSimilar(self) {\r\n  jConfirm('Extract Resources',\r\n    'Are you sure you want to extract all similar items?',\r\n    doExtract.bind(null, self)\r\n  );\r\n}\r\n\r\nfunction inMain(item) {\r\n  return selectMain && item.folder_id !== '-1';\r\n}\r\n\r\nfunction inSt(item) {\r\n  return !selectST && item.is_in_st;\r\n}\r\n\r\nfunction checkFlags(item) {\r\n  return inMain(item) || inSt(item);\r\n}\r\n\r\nfunction resources(prev, item) {\r\n  if (checkFlags(item)) {return prev;}\r\n  if (prev[item.item_id]) {\r\n    prev[item.item_id].invIDs.push(item.inv_id);\r\n  } else {\r\n    prev[item.item_id] = {\r\n      invIDs: [item.inv_id],\r\n      inv_id: item.inv_id,\r\n      item_name: item.item_name\r\n    };\r\n  }\r\n  return prev;\r\n}\r\n\r\nfunction tableRows(prev, item_id) {\r\n  var res = resourceList[item_id];\r\n  return prev + '<tr><td class=\"fshCenter\"><span class=\"smallLink\"' +\r\n    ' id=\"fshExtr' + item_id +\r\n    '\">Extract all ' + res.invIDs.length + '</span></td>' +\r\n    '<td><img src=\"' + imageServer + '/items/' +\r\n    item_id + '.gif\" class=\"tip-dynamic\" data-tipped=\"' +\r\n    'fetchitem.php?item_id=' + item_id + '&inv_id=' +\r\n    res.inv_id + '&t=1&p=' + playerId +\r\n    '\" border=0></td><td>' + res.item_name + '</td></tr>';\r\n}\r\n\r\nfunction showQuickExtract() {\r\n  resourceList = extractInv.reduce(resources, {});\r\n  var output = '<tr><th width=\"20%\">Actions</th><th>Items</th></tr>' +\r\n    '<tr><td colspan=\"2\"><ol id=\"qeresult\"></ol></td></tr>';\r\n  output += Object.keys(resourceList).reduce(tableRows, '');\r\n  extTbl.innerHTML = output;\r\n  buyResult = getElementById('qeresult');\r\n}\r\n\r\nfunction isExtractable(curr) {\r\n  return curr.item_name === 'Zombie Coffin' ||\r\n    curr.type === '12' ||\r\n    curr.type === '16';\r\n}\r\n\r\nfunction prepInv(data) {\r\n  playerId = data.player_id;\r\n  extractInv = data.items.reduce(function(prev, curr) {\r\n    if (isExtractable(curr)) {prev.push(curr);}\r\n    return prev;\r\n  }, []);\r\n  showQuickExtract();\r\n}\r\n\r\nvar extractEvents = [\r\n  {\r\n    test: function(self) {return self.id === 'fshInSt';},\r\n    act: function() {\r\n      selectST = !selectST;\r\n      showQuickExtract();\r\n    }\r\n  },\r\n  {\r\n    test: function(self) {return self.id === 'fshInMain';},\r\n    act: function() {\r\n      selectMain = !selectMain;\r\n      showQuickExtract();\r\n    }\r\n  },\r\n  {\r\n    test: function(self) {return self.id.indexOf('fshExtr') === 0;},\r\n    act: extractAllSimilar\r\n  }\r\n];\r\n\r\nexport default function insertQuickExtract(injector) { // jQuery.min\r\n  if (jQueryNotPresent()) {return;}\r\n  var content = injector || pCC;\r\n  content.innerHTML = '<div class=\"qeHead\"><b>Quick Extract</b></div>' +\r\n    'Select which type of plants you wish to extract all of. Only ' +\r\n    'select extractable resources.<br>' +\r\n    '<label><input type=\"checkbox\" id=\"fshInSt\" checked>' +\r\n    ' Select items in ST</label>&nbsp;&nbsp;' +\r\n    '<label><input type=\"checkbox\" id=\"fshInMain\" checked>' +\r\n    ' Only extract items in Main Folder</label>';\r\n  extTbl = createTable({width: '100%'});\r\n  content.appendChild(extTbl);\r\n  selectST = true;\r\n  selectMain = true;\r\n  content.addEventListener('click', eventHandler(extractEvents));\r\n  getInventory().done(prepInv);\r\n}\r\n","import doSortParams from '../common/doSortParams';\r\nimport generateRecipeTable from './generateRecipeTable';\r\nimport getForage from '../ajax/getForage';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport numberSort from '../system/numberSort';\r\nimport {pCC} from '../support/layout';\r\nimport stringSort from '../system/stringSort';\r\nimport {\r\n  gotRecipeBook,\r\n  output,\r\n  parseInventingStart,\r\n  recipebook\r\n} from './parseInventing';\r\n\r\nfunction testSortType(evt) {\r\n  var sortType = evt.target.getAttribute('sorttype');\r\n  if (!sortType) {sortType = 'string';}\r\n  sortType = sortType.toLowerCase();\r\n  return sortType;\r\n}\r\n\r\nfunction sortRecipeBook(sortType) {\r\n  if (sortType === 'number') {\r\n    recipebook.recipe.sort(numberSort);\r\n  } else {\r\n    recipebook.recipe.sort(stringSort);\r\n  }\r\n}\r\n\r\nfunction sortRecipeTable(evt) { // Legacy\r\n  doSortParams(evt.target.getAttribute('sortKey'));\r\n  var sortType = testSortType(evt);\r\n  sortRecipeBook(sortType);\r\n  generateRecipeTable(output, recipebook);\r\n}\r\n\r\nfunction rmEvtHdl(evt) {\r\n  if (evt.target.id === 'rfsh') {\r\n    parseInventingStart();\r\n  }\r\n  if (evt.target.id === 'sortName') {\r\n    sortRecipeTable(evt);\r\n  }\r\n}\r\n\r\nexport default function injectRecipeManager(injector) { // jQuery.min\r\n  if (jQueryNotPresent()) {return;}\r\n  var content = injector || pCC;\r\n  getForage('fsh_recipeBook').done(gotRecipeBook.bind(null, content));\r\n  content.addEventListener('click', rmEvtHdl);\r\n}\r\n","export default function eventHandler(evtAry) {\r\n  return function(evt) {\r\n    var self = evt.target;\r\n    evtAry.some(function(el) {\r\n      if (el.test(self)) {\r\n        el.act(self);\r\n        return true;\r\n      }\r\n      return false;\r\n    });\r\n  };\r\n}\r\n","import calf from '../support/calf';\r\nimport retryAjax from './retryAjax';\r\n\r\nexport default function getInventory() {\r\n  var subcmd = 'inventory';\r\n  if (calf.subcmd === 'guildinvmgr') {\r\n    subcmd = 'guild_store&inc_tagged=1';\r\n  }\r\n  return retryAjax({\r\n    dataType: 'json',\r\n    url: 'index.php?cmd=export&subcmd=' + subcmd\r\n  });\r\n}\r\n","export default function outputResult(result, handle) {\r\n  handle.insertAdjacentHTML('beforeend',\r\n    '<li class=\"fshNbrList\">' + result + '</li>');\r\n}\r\n","import callApp from '../callApp';\r\n\r\nexport default function useitem(item) {\r\n  return callApp({\r\n    cmd: 'profile',\r\n    subcmd: 'useitem',\r\n    inventory_id: item\r\n  });\r\n}\r\n","import {beginFolderSpanElement} from '../support/dataObj';\r\nimport {imageServer} from '../system/system';\r\nimport {playerId} from '../support/layout';\r\nimport {createDiv, createTBody, createTable} from '../common/cElement';\r\n\r\nfunction alpha(a, b) {\r\n  if (a.n.toLowerCase() < b.n.toLowerCase()) {return -1;}\r\n  if (a.n.toLowerCase() > b.n.toLowerCase()) {return 1;}\r\n  return 0;\r\n}\r\n\r\nfunction isUseable(item) {\r\n  if ([10, 12, 15, 16].indexOf(item.t) !== -1 ||\r\n      item.n === 'Zombie Coffin') {\r\n    return 'smallLink';\r\n  }\r\n  return 'notLink';\r\n}\r\n\r\nfunction itemImage(item) {\r\n  var ret = imageServer + '/';\r\n  if (item.b === 13699) {\r\n    ret += 'composing/potions/' + item.extra.design + '_' +\r\n      item.extra.color + '.gif';\r\n  } else {\r\n    ret += 'items/' + item.b + '.gif';\r\n  }\r\n  return ret;\r\n}\r\n\r\nfunction tableRows(tbl, currentPlayerId, item) {\r\n  var newRow = tbl.insertRow(-1);\r\n  item.dom = newRow;\r\n  var equipClass = 'fshEq ';\r\n  var useClass = 'fshUse ';\r\n  if (item.t < 9) {equipClass += 'smallLink';} else {equipClass += 'notLink';}\r\n  useClass += isUseable(item);\r\n  newRow.innerHTML = '<td class=\"fshCenter\"><span class=\"' + equipClass +\r\n    '\" data-itemid=\"' + item.a + '\">Wear</span>&nbsp;|&nbsp;<span class=\"' +\r\n    useClass + '\" data-itemid=\"' + item.a +\r\n    '\">Use/Ext</span></td><td><img src=\"' + itemImage(item) +\r\n    '\" class=\"tip-dynamic\" data-tipped=\"fetchitem.php?item_id=' + item.b +\r\n    '&amp;inv_id=' + item.a + '&amp;t=1&amp;p=' + currentPlayerId +\r\n    '&amp;currentPlayerId=' + currentPlayerId +\r\n    '\" width=\"30\" height=\"30\" border=\"0\"></td><td width=\"90%\">&nbsp;' +\r\n    item.n + '</td>';\r\n}\r\n\r\nfunction makeFolderSpans(appInv) {\r\n  return beginFolderSpanElement + '0\">All</span>' +\r\n    appInv.r.reduce(function(prev, folderObj) {\r\n      return prev + ' &ensp;' + beginFolderSpanElement +\r\n        folderObj.id.toString() + '\">' + folderObj.name + '</span>';\r\n    }, '');\r\n}\r\n\r\nexport default function createQuickWear(appInv) {\r\n  var currentPlayerId = playerId();\r\n  var tbl = createTable({\r\n    width: '100%',\r\n    innerHTML: '<thead><tr><th class=\"fshCenter\" colspan=\"3\">' +\r\n      makeFolderSpans(appInv) + '</th></tr>' +\r\n      '<tr class=\"fshHeader\"><th class=\"fshCenter\" width=\"20%\">Actions</th>' +\r\n      '<th colspan=\"2\">Items</th></tr></thead>'\r\n  });\r\n  var tbody = createTBody();\r\n  tbl.appendChild(tbody);\r\n  appInv.r.forEach(function(aFolder) {\r\n    aFolder.items.sort(alpha);\r\n    aFolder.items.forEach(tableRows.bind(null, tbody, currentPlayerId));\r\n  });\r\n  var qw = createDiv({\r\n    id: 'invTabs-qw',\r\n    className: 'ui-tabs-panel ui-corner-bottom'\r\n  });\r\n  qw.appendChild(tbl);\r\n  return qw;\r\n}\r\n","export default function dialog(data) {\r\n  if (data.r === 0) {return;}\r\n  $('#dialog_msg').html(data.m).dialog('open');\r\n}\r\n","import dialog from './dialog';\r\nimport retryAjax from './retryAjax';\r\n\r\nexport default function equipItem(backpackInvId) {\r\n  return retryAjax({\r\n    url: 'index.php',\r\n    data: {\r\n      cmd: 'profile',\r\n      subcmd: 'equipitem',\r\n      inventory_id: backpackInvId,\r\n      ajax: 1\r\n    },\r\n    dataType: 'json'\r\n  }).done(dialog);\r\n}\r\n","import {createDiv} from '../common/cElement';\r\nimport getValueJSON from '../system/getValueJSON';\r\n\r\nfunction ahLink(searchname, nickname) {\r\n  return '<a href=\"index.php?cmd=auctionhouse&search_text=' + searchname +\r\n    '\">' + nickname + '</a>';\r\n}\r\n\r\nfunction foundInvItem(invCount, name) {\r\n  if (invCount[name]) {\r\n    invCount[name].count += 1;\r\n  } else {\r\n    invCount[name] = {count: 1, nicknameList: []};\r\n  }\r\n}\r\n\r\nfunction displayFoundCount(invCount) {\r\n  return Object.keys(invCount).reduce(function(prev, key) {\r\n    if (invCount[key].nicknameList.length !== 0) {\r\n      return prev + '<tr><td>' + key + '</td><td>' +\r\n        invCount[key].nicknameList.map(function(nickname) {\r\n          return ahLink(key, nickname);\r\n        }).join(' ') + '</td><td>' +\r\n        invCount[key].count + '</td><td></td><td></td></tr>';\r\n    }\r\n    return prev;\r\n  }, '');\r\n}\r\n\r\nfunction displayNotFound(quickSL) {\r\n  return quickSL.reduce(function(prev, item) {\r\n    if (item.displayOnAH && !item.found) {\r\n      return prev + ahLink(item.searchname, item.nickname) + ', ';\r\n    }\r\n    return prev;\r\n  }, '');\r\n}\r\n\r\nfunction displayOtherCount(invCount) {\r\n  return Object.keys(invCount).reduce(function(prev, key) {\r\n    if (invCount[key].nicknameList.length === 0) {\r\n      return prev + '<tr><td>' + key + '</td><td></td><td>' +\r\n        invCount[key].count + '</td><td></td><td></td><td></td></tr>';\r\n    }\r\n    return prev;\r\n  }, '');\r\n}\r\n\r\nfunction buildHTML(invCount, quickSL) {\r\n  // TODO this is going to need significant rebuild\r\n  return '<table width=\"100%\" cellspacing=\"2\" cellpadding=\"2\"><thead>' +\r\n    '<tr><th colspan=\"5\" class=\"fshCenter\">Items from ' +\r\n    '<a href=\"index.php?cmd=notepad&blank=1&subcmd=auctionsearch\">' +\r\n    'AH Quick Search</a> found in your inventory</th></tr>' +\r\n    '<tr><th>Name</th><th>Nick Name</th><th>Inv Count</th>' +\r\n    '<th>AH Min Price</th><th>AH BuyNow Price</th></tr></thead><tbody>' +\r\n    // show inv & counter for item with nickname found\r\n    displayFoundCount(invCount) +\r\n    // show item from quick AH search that are not in our inv\r\n    '<tr><td colspan=\"5\"><hr></td></tr>' +\r\n    '<tr><td>Did not find:</td><td colspan=\"4\">' +\r\n    displayNotFound(quickSL) +\r\n    '</td></tr><tr><td colspan=\"5\"><hr></td></tr></tbody>' +\r\n    '<thead><tr><th colspan=\"5\" class=\"fshCenter\">Items NOT from ' +\r\n    '<a href=\"index.php?cmd=notepad&blank=1&subcmd=auctionsearch\">' +\r\n    'AH Quick Search</a> found in your inventory</td></thead><tbody>' +\r\n    // show inv & counter for item with nickname NOT found\r\n    displayOtherCount(invCount) +\r\n    '</tbody></table>';\r\n}\r\n\r\nfunction inQuickSearchList(invCount, name, listItem) {\r\n  if (name === listItem.searchname) {\r\n    listItem.found = true;\r\n    if (invCount[name].nicknameList.indexOf(listItem.nickname) < 0) {\r\n      invCount[name].nicknameList.push(listItem.nickname);\r\n    }\r\n  }\r\n}\r\n\r\nfunction testItemList(invCount, quickSL, item) {\r\n  var name = item.n;\r\n  foundInvItem(invCount, name);\r\n  quickSL.forEach(inQuickSearchList.bind(null, invCount, name));\r\n}\r\n\r\nexport default function showAHInvManager(itemList) {\r\n  var invCount = {};\r\n  var quickSL = getValueJSON('quickSearchList');\r\n  // fill up the Inv Counter\r\n  itemList.r.forEach(function(aFolder) {\r\n    aFolder.items.forEach(testItemList.bind(null, invCount, quickSL));\r\n  });\r\n  var im = createDiv({\r\n    id: 'invTabs-ah',\r\n    className: 'ui-tabs-panel ui-corner-bottom'\r\n  });\r\n  im.insertAdjacentHTML('beforeend', buildHTML(invCount, quickSL));\r\n  return im;\r\n}\r\n","export default function isChecked(pref) {\r\n  if (pref) {return ' checked';}\r\n  return '';\r\n}\r\n","/* eslint-disable max-lines */\r\nexport default {\r\n  moveGuildList: {\r\n    helpTitle: 'Move Guild Info List',\r\n    helpText: 'This will Move the Guild Info List higher ' +\r\n      'on the bar on the right'\r\n  },\r\n  moveOnlineAlliesList: {\r\n    helpTitle: 'Move Online Allies List',\r\n    helpText: 'This will Move the Online Allies List higher ' +\r\n      'on the bar on the right'\r\n  },\r\n  enableOnlineAlliesWidgets: {\r\n    helpTitle: 'Enable Online Allies Widgets',\r\n    helpText: 'Enabling this option will enable the Allies List ' +\r\n      'Widgets (coloring on the Allies List panel)'\r\n  },\r\n  moveFSBox: {\r\n    helpTitle: 'Move FS box',\r\n    helpText: 'This will move the FS box to the left, under the menu, ' +\r\n      'for better visibility (unless it is already hidden.)'\r\n  },\r\n  moveDailyQuest: {\r\n    helpTitle: 'Move Daily Quest',\r\n    helpText: 'This will move the Daily Quest to the left, under the menu, ' +\r\n      'for better visibility (unless it is already hidden.)'\r\n  },\r\n  gameHelpLink: {\r\n    helpTitle: '&quot;Game Help&quot; Settings Link',\r\n    helpText: 'This turns the Game Help text in the lower ' +\r\n      'right box into a link to this settings page.'\r\n  },\r\n  enableTempleAlert: {\r\n    helpTitle: 'Enable Temple Alert',\r\n    helpText: 'Puts an alert on the LHS if you have not ' +\r\n      'prayed at the temple today.',\r\n    network: true\r\n  },\r\n  enableUpgradeAlert: {\r\n    helpTitle: 'Enable Gold Upgrade Alert',\r\n    helpText: 'Puts an alert on the LHS if you have not upgraded your ' +\r\n      'stamina with gold today.',\r\n    network: true\r\n  },\r\n  enableComposingAlert: {\r\n    helpTitle: 'Enable Composing Alert',\r\n    helpText: 'Puts an alert on the LHS if you have composing ' +\r\n      'slots available.',\r\n    network: true\r\n  },\r\n  enhanceOnlineDots: {\r\n    helpTitle: 'Enhance Online Dots',\r\n    helpText: 'Enhances the green/grey dots by player names to show ' +\r\n      'online/offline status.'\r\n  },\r\n  hideBuffSelected: {\r\n    helpTitle: 'Hide Buff Selected',\r\n    helpText: 'Hides the buff selected functionality in the online allies ' +\r\n      'and guild info section.'\r\n  },\r\n  hideHelperMenu: {\r\n    helpTitle: 'Hide Helper Menu',\r\n    helpText: 'Hides the helper menu from top left.'\r\n  },\r\n  keepHelperMenuOnScreen: {\r\n    helpTitle: 'Keep Helper Menu On Screen',\r\n    helpText: 'Keeps helper menu on screen as you scroll (helper ' +\r\n      'menu must be enabled to work). Also works with quick links.'\r\n  },\r\n  showAdmin: {\r\n    helpTitle: 'Show rank controls',\r\n    helpText: 'Show ranking controls for guild managemenet in member ' +\r\n      'profile page - this works for guild founders only'\r\n  },\r\n  ajaxifyRankControls: {\r\n    helpTitle: 'AJAXify rank controls',\r\n    helpText: 'Enables guild founders with ranking rights to change rank ' +\r\n      'positions without a screen refresh.'\r\n  },\r\n  detailedConflictInfo: {\r\n    helpTitle: 'Show Conflict Details',\r\n    helpText: 'Inserts detailed conflict information onto your guild\\'s ' +\r\n      'manage page. Currently displays the target guild as well as ' +\r\n      'the current score.',\r\n    network: true\r\n  },\r\n  showCombatLog: {\r\n    helpTitle: 'Show Combat Log',\r\n    helpText: 'This will show the combat log for each automatic ' +\r\n      'battle below the monster list.'\r\n  },\r\n  enableCreatureColoring: {\r\n    helpTitle: 'Color Special Creatures',\r\n    helpText: 'Creatures will be colored according to their rarity. ' +\r\n      'Champions will be colored green, Elites yellow and Super Elites red.'\r\n  },\r\n  showCreatureInfo: {\r\n    helpTitle: 'Show Creature Info',\r\n    helpText: 'This will show the information from the view creature ' +\r\n      'link when you mouseover the link.',\r\n    network: true\r\n  },\r\n  fsboxlog: {\r\n    helpTitle: 'Enable FS Box Log',\r\n    helpText: 'This enables the functionality to keep a log of ' +\r\n      'recent seen FS Box message.'\r\n  },\r\n  keepBuffLog: {\r\n    helpTitle: 'Enable Buff Log',\r\n    helpText: 'This enables the functionality to keep a log of ' +\r\n      'recently casted buffs'\r\n  },\r\n  huntingMode: {\r\n    helpTitle: 'Enable Hunting Mode',\r\n    helpText: 'This disable menu and some visual features to ' +\r\n      'speed up the calf.'\r\n  },\r\n  hideNonPlayerGuildLogMessages: {\r\n    helpTitle: 'Cleanup Guild Log',\r\n    helpText: 'Any log messages not related to the current player ' +\r\n      'will be dimmed (e.g. recall messages from guild store)'\r\n  },\r\n  useNewGuildLog: {\r\n    helpTitle: 'Use New Guild Log',\r\n    helpText: 'This will replace the standard guild log with the ' +\r\n      'helper version of the guild log.'\r\n  },\r\n  enableLogColoring: {\r\n    helpTitle: 'Enable Log Coloring',\r\n    helpText: 'Three logs will be colored if this is enabled, ' +\r\n      'Guild Chat, Guild Log and Player Log. It will show any new ' +\r\n      'messages in yellow and anything 20 minutes old ones in brown.'\r\n  },\r\n  enableChatParsing: {\r\n    helpTitle: 'Enable Chat Parsing',\r\n    helpText: 'If this is checked, your character log will be parsed for ' +\r\n      'chat messages and show the chat message on the screen if you reply ' +\r\n      'to that message.'\r\n  },\r\n  addAttackLinkToLog: {\r\n    helpTitle: 'Add attack link to log',\r\n    helpText: 'If checked, this will add an Attack link to each message ' +\r\n      'in your log.'\r\n  },\r\n  enhanceChatTextEntry: {\r\n    helpTitle: 'Enhance Chat Text Entry',\r\n    helpText: 'If checked, this will enhance the entry field for entering ' +\r\n      'chat text on the guild chat page.'\r\n  },\r\n  showExtraLinks: {\r\n    helpTitle: 'Show Extra Links',\r\n    helpText: 'If checked, this will add AH and UFSG ' +\r\n      'links to equipment screens.'\r\n  },\r\n  disableItemColoring: {\r\n    helpTitle: 'Disable Item Coloring',\r\n    helpText: 'Disable the code that colors the item text based on the ' +\r\n      'rarity of the item.'\r\n  },\r\n  showQuickDropLinks: {\r\n    helpTitle: 'Show Quick Drop Item',\r\n    helpText: 'This will show a link beside each item which gives the ' +\r\n      'option to drop the item.  WARNING: NO REFUNDS ON ERROR'\r\n  },\r\n  storeLastQuestPage: {\r\n    helpTitle: 'Store Last Quest Page',\r\n    helpText: 'This will store the page and sort order of each of the ' +\r\n      'three quest selection pages for next time you visit. If you need ' +\r\n      'to reset the links, turn this option off, click on the link you ' +\r\n      'wish to reset and then turn this option back on again.'\r\n  },\r\n  showNextQuestSteps: {\r\n    helpTitle: 'Show Next Quest Steps',\r\n    helpText: 'Shows all quest steps in the UFSG.'\r\n  },\r\n  renderSelfBio: {\r\n    helpTitle: 'Render self bio',\r\n    helpText: 'This determines if your own bio will render the FSH ' +\r\n      'special bio tags.'\r\n  },\r\n  renderOtherBios: {\r\n    helpTitle: 'Render other players&#39; bios',\r\n    helpText: 'This determines if other players bios will render the FSH ' +\r\n      'special bio tags.'\r\n  },\r\n  showStatBonusTotal: {\r\n    helpTitle: 'Show Stat Bonus Total',\r\n    helpText: 'This will show a total of the item stats when you ' +\r\n      'mouseover an item on the profile screen.'\r\n  },\r\n  enableQuickDrink: {\r\n    helpTitle: 'Enable Quick Drink/Wear',\r\n    helpText: 'This enables the quick drink/wear functionality on the ' +\r\n      'profile page.'\r\n  },\r\n  disableDeactivatePrompts: {\r\n    helpTitle: 'Disable Deactivate Prompts',\r\n    helpText: 'This disables the prompts for deactivating buffs on ' +\r\n      'the profile page.'\r\n  },\r\n  enableAttackHelper: {\r\n    helpTitle: 'Show Attack Helper',\r\n    helpText: 'This will show extra information on the attack player ' +\r\n      'screen about stats and buffs on you and your target',\r\n    network: true\r\n  },\r\n  showPvPSummaryInLog: {\r\n    helpTitle: 'Show PvP Summary in Log',\r\n    helpText: 'This will show a summary of the PvP results in the log.',\r\n    network: true\r\n  },\r\n  autoFillMinBidPrice: {\r\n    helpTitle: 'Auto Fill Min Bid Price',\r\n    helpText: 'This enables the functionality to automatically fill in ' +\r\n      'the min bid price so you just have to hit bid and your bid will ' +\r\n      'be placed.'\r\n  },\r\n  hideRelicOffline: {\r\n    helpTitle: 'Hide Relic Offline',\r\n    helpText: 'This hides the relic offline defenders checker.'\r\n  },\r\n  enterForSendMessage: {\r\n    helpTitle: 'Enter Sends Message',\r\n    helpText: 'If enabled, will send a message from the Send Message ' +\r\n      'screen if you press enter. You can still insert a new line by ' +\r\n      'holding down shift when you press enter.'\r\n  },\r\n  navigateToLogAfterMsg: {\r\n    helpTitle: 'Navigate After Message Sent',\r\n    helpText: 'If enabled, will navigate to the referring page after a ' +\r\n      'successful message is sent. Example:  if you are on the world ' +\r\n      'screen and hit message on the guild info panel after you send the ' +\r\n      'message, it will return you to the world screen.'\r\n  },\r\n  moveComposingButtons: {\r\n    helpTitle: 'Move Composing Buttons',\r\n    helpText: 'If enabled, will move composing buttons to the top of ' +\r\n      'the composing screen.'\r\n  },\r\n  draggableHelperMenu: {\r\n    helpTitle: 'Draggable Helper Menu',\r\n    helpText: 'If enabled, allows the helper menu to ' +\r\n      'be dragged around the screen.'\r\n  },\r\n  draggableQuickLinks: {\r\n    helpTitle: 'Draggable Quick Links',\r\n    helpText: 'If enabled, allows the quick link box to ' +\r\n      'be dragged around the screen.'\r\n  },\r\n  expandMenuOnKeyPress: {\r\n    helpTitle: 'Expand Menu on Key Press',\r\n    helpText: 'If enabled, expands the left hand menu ' +\r\n      'when you use hotkeys.'\r\n  },\r\n  disableBreakdownPrompts: {\r\n    helpTitle: 'Disable Breakdown Prompts',\r\n    helpText: 'If enabled, will disable prompts when you breakdown items.' +\r\n      '<br>NO REFUNDS OR DO-OVERS! Use at own risk.'\r\n  },\r\n  collapseNewsArchive: {\r\n    helpTitle: 'Collapse News Archive',\r\n    helpText: 'If enabled, will collapse news archives.'\r\n  },\r\n  collapseHallPosts: {\r\n    helpTitle: 'Collapse Hall Posts',\r\n    helpText: 'If enabled, will collapse hall posts.'\r\n  },\r\n  hideSubLvlCreature: {\r\n    helpTitle: 'Hide Sub Level Creatures',\r\n    helpText: 'If enabled, will hide creatures that are ' +\r\n      'lower than the current realm level.'\r\n  },\r\n  hidePlayerActions: {\r\n    helpTitle: 'Hide Player Actions',\r\n    helpText: 'If enabled, will hide player actions.'\r\n  },\r\n  disableQuickWearPrompts: {\r\n    helpTitle: 'Disable Use/Ext Prompts',\r\n    helpText: 'If enabled, will disable prompts when you Use/Ext items.' +\r\n      '<br>NO REFUNDS OR DO-OVERS! Use at own risk.',\r\n    title: 'Disable Use/Ext<br>Prompts'\r\n  },\r\n  enableGuildActivityTracker: {\r\n    helpTitle: 'Enable Guild Activity Tracker',\r\n    helpText: 'If enabled, will track guild member activity over time.',\r\n    network: true,\r\n    title: 'Enable Tracker'\r\n  },\r\n  enableSeTracker: {\r\n    helpTitle: 'Enable SE Tracker',\r\n    helpText: 'If enabled, will track the last time each SE was killed.<br>' +\r\n      'This is DIFFERENT from the usual FSH network activity.<br>' +\r\n      'When this is enabled, if you have ANY game page open in a<br>' +\r\n      'browser tab it will scan the SE Log every 10 minutes.<br>' +\r\n      'You do not need auto-refresh for this to work.',\r\n    network: true\r\n  },\r\n  showMonsterLog: {\r\n    helpTitle: 'Keep Creature Log',\r\n    helpText: 'This will show the creature log for each creature you see ' +\r\n      'when you travel.',\r\n    network: true\r\n  },\r\n  showTitanInfo: {\r\n    helpTitle: 'Show Titan Info',\r\n    helpText: 'This will show titan info in the action list.',\r\n    network: true\r\n  },\r\n  wantedGuildMembers: {\r\n    helpTitle: 'Show Guild Members',\r\n    helpText: 'If enabled, will show guild members in the wanted bounty list.'\r\n  }\r\n};\r\n","import {createDiv} from '../common/cElement';\r\nimport createQuickWear from './createQuickWear';\r\nimport equipItem from '../ajax/equipItem';\r\nimport eventHandler from '../common/eventHandler';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport jConfirm from '../common/jConfirm';\r\nimport jQueryPresent from '../common/jQueryPresent';\r\nimport loadInventory from '../app/profile/loadInventory';\r\nimport {pCC} from '../support/layout';\r\nimport {sendEvent} from '../support/fshGa';\r\nimport setValue from '../system/setValue';\r\nimport showAHInvManager from './showAHInvManager';\r\nimport {simpleCheckboxHtml} from '../settings/simpleCheckbox';\r\nimport toggleForce from '../common/toggleForce';\r\nimport useItem from '../ajax/useItem';\r\n\r\nvar disableQuickWearPrompts;\r\nvar content;\r\nvar itemList;\r\n\r\nfunction doAction(self, fn, verb) { // jQuery.min\r\n  sendEvent('QuickWear', 'doAction');\r\n  self.textContent = '';\r\n  self.classList.remove('smallLink');\r\n  self.classList.add('fshSpinner', 'fshSpin12');\r\n  fn(self.dataset.itemid).done(function(data) {\r\n    if (data.r !== 0) {return;}\r\n    self.parentNode.innerHTML = '<span class=\"fastWorn\">' + verb + '</span>';\r\n  });\r\n}\r\n\r\nfunction doUseItem(self) {\r\n  doAction(self, useItem, 'Used');\r\n}\r\n\r\nfunction useProfileInventoryItem(self) {\r\n  if (disableQuickWearPrompts) {\r\n    doUseItem(self);\r\n  } else {\r\n    jConfirm('Use/Extract Item',\r\n      'Are you sure you want to use/extract the item?',\r\n      doUseItem.bind(null, self)\r\n    );\r\n  }\r\n}\r\n\r\nfunction equipProfileInventoryItem(self) {\r\n  doAction(self, equipItem, 'Worn');\r\n}\r\n\r\nfunction processItems(folderId, thisFolder, o) {\r\n  var tr = o.dom;\r\n  if (folderId === '0') {\r\n    tr.classList.remove('fshHide');\r\n  } else {\r\n    var force = folderId !== thisFolder.toString();\r\n    toggleForce(tr, force);\r\n  }\r\n}\r\n\r\nfunction processFolder(folderId, aFolder) {\r\n  var thisFolder = aFolder.id;\r\n  aFolder.items.forEach(processItems.bind(null, folderId, thisFolder));\r\n}\r\n\r\nfunction hideFolders(self) {\r\n  var folderId = self.dataset.folder;\r\n  itemList.r.forEach(processFolder.bind(null, folderId));\r\n}\r\n\r\nfunction togglePref() {\r\n  disableQuickWearPrompts = !disableQuickWearPrompts;\r\n  setValue('disableQuickWearPrompts', disableQuickWearPrompts);\r\n}\r\n\r\nvar events = [\r\n  {\r\n    test: function(self) {\r\n      return self.classList.contains('smallLink') &&\r\n        self.classList.contains('fshEq');\r\n    },\r\n    act: equipProfileInventoryItem\r\n  },\r\n  {\r\n    test: function(self) {\r\n      return self.classList.contains('smallLink') &&\r\n        self.classList.contains('fshUse');\r\n    },\r\n    act: useProfileInventoryItem\r\n  },\r\n  {\r\n    test: function(self) {return self.classList.contains('fshFolder');},\r\n    act: hideFolders\r\n  },\r\n  {\r\n    test: function(self) {return self.id === 'disableQuickWearPrompts';},\r\n    act: togglePref\r\n  }\r\n];\r\n\r\nfunction createInvTabs() {\r\n  return createDiv({\r\n    id: 'invTabs',\r\n    className: 'ui-tabs ui-widget-content ui-corner-all',\r\n    innerHTML: '<input id=\"qwtab1\" type=\"radio\" name=\"qwtabs\" checked>' +\r\n      '<input id=\"qwtab2\" type=\"radio\" name=\"qwtabs\">' +\r\n      '<ul class=\"ui-tabs-nav ui-helper-reset ' +\r\n        'ui-helper-clearfix ui-widget-header ui-corner-all\">' +\r\n      '<li class=\"ui-state-default ui-corner-top inv-tabs-qw\">' +\r\n      '<label for=\"qwtab1\">Quick Wear / Use / Extract<br>Manager</label>' +\r\n      '</li>' +\r\n      '<li class=\"ui-state-default ui-corner-top inv-tabs-ah\">' +\r\n      '<label for=\"qwtab2\">Inventory Manager Counter' +\r\n        '<br>filtered by AH Quick Search</label>' +\r\n      '</li><div id=\"setPrompt\" class=\"fshFloatRight fshCenter\"></div></ul>'\r\n  });\r\n}\r\n\r\nfunction showQuickWear(appInv) {\r\n  itemList = appInv;\r\n  var invTabs = createInvTabs();\r\n  var invTabsQw = createQuickWear(appInv);\r\n  invTabs.appendChild(invTabsQw);\r\n  content.innerHTML = '';\r\n  content.appendChild(invTabs);\r\n  invTabs.addEventListener('click', eventHandler(events));\r\n  invTabs.appendChild(showAHInvManager(appInv));\r\n  getElementById('setPrompt').insertAdjacentHTML('beforeend',\r\n    simpleCheckboxHtml('disableQuickWearPrompts'));\r\n}\r\n\r\nfunction hasJquery(injector) { // jQuery.min\r\n  content = injector || pCC;\r\n  if (!content) {return;}\r\n  content.insertAdjacentHTML('beforeend', 'Getting item list from backpack...');\r\n  loadInventory().done(showQuickWear);\r\n  disableQuickWearPrompts = getValue('disableQuickWearPrompts');\r\n}\r\n\r\nexport default function insertQuickWear(injector) {\r\n  if (jQueryPresent()) {hasJquery(injector);}\r\n}\r\n","export var networkIcon =\r\n  '<img class=\"networkIcon tip-static\" ' +\r\n  'data-tipped=\"This function retrieves data from the network. ' +\r\n  'Disable this to increase speed\" src=\"data:image/png;base64,' +\r\n  'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA' +\r\n  'B3RJTUUH1QgGDTMWk1twEwAAAAlwSFlzAAALEgAACxIB0t1+' +\r\n  '/AAAAARnQU1BAACxjwv8YQUAAAC8SURBVHjahVPBEcQgCEQn' +\r\n  'HdmTqUlr0qe16I8cufOiCGZnGCcIy4LEICJwmGgWJ3o0IOCQ' +\r\n  'EqVg9Y4U3CoCHQhvxuPUZEiA3XYkxyI1/6S6R6rke8AlJbkV' +\r\n  '7u95lleXq3yrdyUjLGxwnifmnHEXY3fJIQSIMcKOZCLgMltr' +\r\n  'r+1ZWgxp8wi1VrEqxfeFWloYq4wKtOHeBNqeawqmeOnNvfdY' +\r\n  'SvkbfaeUxP0w/G+k6WsT/xCBc25SuxDsnownEy4u5BHudpMF' +\r\n  'egAAAABJRU5ErkJggg==\" width=\"16\" height=\"16\" />';\r\n\r\nexport var saveBoxes = [\r\n  'navigateToLogAfterMsg',\r\n  'gameHelpLink',\r\n  'guildSelf',\r\n  'guildSelfMessage',\r\n  'guildFrnd',\r\n  'guildFrndMessage',\r\n  'guildPast',\r\n  'guildPastMessage',\r\n  'guildEnmy',\r\n  'guildEnmyMessage',\r\n  'showAdmin',\r\n  'ajaxifyRankControls',\r\n  'detailedConflictInfo',\r\n  'disableItemColoring',\r\n  'enableLogColoring',\r\n  'enableChatParsing',\r\n  'enableCreatureColoring',\r\n  'hideNonPlayerGuildLogMessages',\r\n  'buyBuffsGreeting',\r\n  'renderSelfBio',\r\n  'renderOtherBios',\r\n  'defaultMessageSound',\r\n  'showSpeakerOnWorld',\r\n  'playNewMessageSound',\r\n  'highlightPlayersNearMyLvl',\r\n  'highlightGvGPlayersNearMyLvl',\r\n  'showCombatLog',\r\n  'showMonsterLog',\r\n  'showCreatureInfo',\r\n  'keepLogs',\r\n  'enableGuildInfoWidgets',\r\n  'enableOnlineAlliesWidgets',\r\n  'hideGuildInfoMessage',\r\n  'hideGuildInfoBuff',\r\n  'hideGuildInfoSecureTrade',\r\n  'hideGuildInfoTrade',\r\n  'huntingBuffs',\r\n  'huntingBuffsName',\r\n  'huntingBuffs2',\r\n  'huntingBuffs2Name',\r\n  'huntingBuffs3',\r\n  'huntingBuffs3Name',\r\n  'showHuntingBuffs',\r\n  'moveGuildList',\r\n  'moveOnlineAlliesList',\r\n  'moveFSBox',\r\n  'moveDailyQuest',\r\n  'hideQuests',\r\n  'hideQuestNames',\r\n  'hideRecipes',\r\n  'hideRecipeNames',\r\n  'doNotKillList',\r\n  'enableBioCompressor',\r\n  'maxCompressedCharacters',\r\n  'maxCompressedLines',\r\n  'sendGoldonWorld',\r\n  'goldRecipient',\r\n  'goldAmount',\r\n  'keepBuffLog',\r\n  'showQuickSendLinks',\r\n  'showQuickDropLinks',\r\n  'sendClasses',\r\n  'itemRecipient',\r\n  'currentGoldSentTotal',\r\n  'enableAllyOnlineList',\r\n  'enableEnemyOnlineList',\r\n  'allyEnemyOnlineRefreshTime',\r\n  'quickLinksTopPx',\r\n  'quickLinksLeftPx',\r\n  'draggableQuickLinks',\r\n  'enableActiveBountyList',\r\n  'bountyListRefreshTime',\r\n  'enableWantedList',\r\n  'wantedNames',\r\n  'wantedGuildMembers',\r\n  'fsboxlog',\r\n  'huntingMode',\r\n  'enableAttackHelper',\r\n  'hideRelicOffline',\r\n  'enterForSendMessage',\r\n  'storeLastQuestPage',\r\n  'addAttackLinkToLog',\r\n  'showStatBonusTotal',\r\n  'newGuildLogHistoryPages',\r\n  'useNewGuildLog',\r\n  'enhanceChatTextEntry',\r\n  'enableMaxGroupSizeToJoin',\r\n  'maxGroupSizeToJoin',\r\n  'enableTempleAlert',\r\n  'enableUpgradeAlert',\r\n  'enableComposingAlert',\r\n  'autoFillMinBidPrice',\r\n  'showPvPSummaryInLog',\r\n  'enableQuickDrink',\r\n  'enhanceOnlineDots',\r\n  'hideBuffSelected',\r\n  'hideHelperMenu',\r\n  'keepHelperMenuOnScreen',\r\n  'draggableHelperMenu',\r\n  'showNextQuestSteps',\r\n  'hideChampionsGroup',\r\n  'hideElitesGroup',\r\n  'hideSEGroup',\r\n  'hideTitanGroup',\r\n  'hideLegendaryGroup',\r\n  'disableDeactivatePrompts',\r\n  'moveComposingButtons',\r\n  'showExtraLinks',\r\n  'expandMenuOnKeyPress'\r\n];\r\n","import fallback from '../system/fallback';\r\nimport getValue from '../system/getValue';\r\nimport isChecked from '../system/isChecked';\r\nimport mySimpleCheckboxes from './simple';\r\nimport {networkIcon} from './settingObj';\r\n\r\nexport function helpLink(title, text) {\r\n  return '&nbsp;[&nbsp;<span class=\"fshLink tip-static\" data-tipped=\"' +\r\n    '<span class=\\'fshHelpTitle\\'>' + title + '</span><br><br>' +\r\n    text + '\">?</span>&nbsp;]';\r\n}\r\n\r\nfunction hasNetwork(o) {\r\n  if (o.network) {return networkIcon;}\r\n  return '';\r\n}\r\n\r\nfunction isOn(name) {\r\n  return isChecked(getValue(name));\r\n}\r\n\r\nexport function justLabel(name) {\r\n  var o = mySimpleCheckboxes[name];\r\n  return hasNetwork(o) +\r\n    '<label for=\"' + name + '\">' + fallback(o.title, o.helpTitle) +\r\n    helpLink(o.helpTitle, o.helpText) +\r\n    ':</label>';\r\n}\r\n\r\nexport function justCheckbox(name) {\r\n  return '<input id=\"' + name + '\" name=\"' + name +\r\n    '\" class=\"fshVMid\" type=\"checkbox\" value=\"on\"' + isOn(name) + '>';\r\n}\r\n\r\nexport function simpleCheckboxHtml(name) {\r\n  return justLabel(name) + justCheckbox(name);\r\n}\r\n\r\nexport function simpleCheckbox(name) {\r\n  return '<tr><td align=\"right\">' + justLabel(name) +\r\n    '</td><td>' + justCheckbox(name) + '</td></tr>';\r\n}\r\n","export default function toggleForce(el, force) {\r\n  el.classList.toggle('fshHide', force);\r\n}\r\n","function hasErrorMsg(json) {\r\n  return json.e && json.e.message;\r\n}\r\n\r\nexport default function errorDialog(json) {\r\n  if (!json.s && hasErrorMsg(json)) {\r\n    $('#dialog_msg').html(json.e.message).dialog('open');\r\n    json.r = 1;\r\n  } else {json.r = 0;}\r\n  return json;\r\n}\r\n","import errorDialog from '../app/errorDialog';\r\nimport useitem from '../app/profile/useitem';\r\n\r\nexport default function useItem(backpackInvId) {\r\n  return useitem(backpackInvId).pipe(errorDialog);\r\n}\r\n","import {defaults} from '../support/dataObj';\r\nimport eventHandler from '../common/eventHandler';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValueJSON from '../system/getValueJSON';\r\nimport isChecked from '../system/isChecked';\r\nimport jsonParse from '../common/jsonParse';\r\nimport makePageHeader from './makePageHeader';\r\nimport makePageTemplate from './makePageTemplate';\r\nimport {pCC} from '../support/layout';\r\nimport setValueJSON from '../system/setValueJSON';\r\n\r\nvar param;\r\n\r\nfunction hasUrl(j) {\r\n  return param.url && param.url[j] !== '';\r\n}\r\n\r\nfunction detailRow(j, itemField) { // Legacy\r\n  if (param.tags[j] === 'checkbox') {\r\n    return '<input type=\"checkbox\"' + isChecked(itemField) +\r\n      ' disabled>';\r\n  } else if (hasUrl(j)) {\r\n    return '<a href=\"' + param.url[j].replace('@replaceme@', itemField) +\r\n      '\">' + itemField + '</a>';\r\n  }\r\n  return itemField;\r\n}\r\n\r\nfunction itemRow(item) { // Legacy\r\n  var result = '';\r\n  for (var j = 0; j < param.fields.length; j += 1) {\r\n    result += '<td class=\"fshCenter\">';\r\n    var itemField = item[param.fields[j]];\r\n    if (param.fields[j] === param.categoryField) {continue;}\r\n    result += detailRow(j, itemField) + '</td>';\r\n  }\r\n  return result;\r\n}\r\n\r\nfunction doInputs() { // Legacy\r\n  var result = '<tr>';\r\n  for (var i = 0; i < param.tags.length; i += 1) {\r\n    result += '<td align=center><input type=\"' + param.tags[i] +\r\n      '\" class=\"custominput\" id=\"fshIn' + param.fields[i] + '\"></td>';\r\n  }\r\n  return result;\r\n}\r\n\r\nfunction generateManageTable() { // Legacy\r\n  var result = '<table cellspacing=\"2\" cellpadding=\"2\" class=\"fshGc\" ' +\r\n    'width=\"100%\"><tr class=\"fshOr\">';\r\n  result += param.headers.reduce(function(prev, curr) {\r\n    return prev + '<th>' + curr + '</th>';\r\n  }, '');\r\n  result += '<th>Action</th></tr>';\r\n  var currentCategory = '';\r\n  param.currentItems.forEach(function(item, i) {\r\n    result += '<tr>';\r\n    if (param.categoryField &&\r\n        currentCategory !==\r\n        item[param.categoryField]) {\r\n      currentCategory = item[param.categoryField];\r\n      result += '<td><span class=\"fshQs\">' +\r\n        currentCategory + '</span></td><td></td><td></td><td></td><td></td>' +\r\n          '</tr><tr>';\r\n    }\r\n    result += itemRow(item);\r\n    result += '<td><span class=\"HelperTextLink\" data-itemId=\"' + i +\r\n      '\" id=\"fshDel' + i + '\">[Del]</span></td></tr>';\r\n  });\r\n  result += doInputs();\r\n  result += '<td><span class=\"HelperTextLink\" id=\"fshAdd\">' +\r\n    '[Add]</span></td></tr></table>' +\r\n    '<table width=\"100%\"><tr><td class=\"fshCenter\">' +\r\n    '<textarea cols=70 rows=20 id=\"fshEd\">' +\r\n    JSON.stringify(param.currentItems) + '</textarea></td></tr>' +\r\n    '<tr><td class=\"fshCenter\"><input id=\"fshSave\" ' +\r\n    'type=\"button\" value=\"Save\" class=\"custombutton\">' +\r\n    '&nbsp;<input id=\"fshReset\" type=\"button\" value=\"Reset\" ' +\r\n    'class=\"custombutton\"></td></tr>' +\r\n    '</tbody></table>';\r\n  getElementById(param.id).innerHTML = result;\r\n  setValueJSON(param.gmname, param.currentItems);\r\n}\r\n\r\nfunction deleteQuickItem(self) { // Legacy\r\n  var itemId = self.getAttribute('data-itemId');\r\n  param.currentItems.splice(itemId, 1);\r\n  generateManageTable();\r\n}\r\n\r\nfunction buildNewItem() { // Legacy\r\n  var newItem = {};\r\n  for (var i = 0; i < param.fields.length; i += 1) {\r\n    if (param.tags[i] === 'checkbox') {\r\n      newItem[param.fields[i]] =\r\n        getElementById('fshIn' + param.fields[i]).checked;\r\n    } else {\r\n      newItem[param.fields[i]] =\r\n        getElementById('fshIn' + param.fields[i]).value;\r\n    }\r\n  }\r\n  return newItem;\r\n}\r\n\r\nfunction addQuickItem() { // Legacy\r\n  var isArrayOnly = param.fields.length === 0;\r\n  var newItem = {};\r\n  if (isArrayOnly) {\r\n    newItem = getElementById('fshIn0').value;\r\n  } else {\r\n    newItem = buildNewItem();\r\n  }\r\n  param.currentItems.push(newItem);\r\n  generateManageTable();\r\n}\r\n\r\nfunction saveRawEditor() { // Legacy\r\n  var userInput = jsonParse(getElementById('fshEd').value);\r\n  if (Array.isArray(userInput)) {\r\n    param.currentItems = userInput;\r\n    generateManageTable();\r\n  }\r\n}\r\n\r\nfunction resetRawEditor() { // Legacy\r\n  if (param.id === 'fshAso') {\r\n    param.currentItems =\r\n      jsonParse(defaults.quickSearchList);\r\n  } else {param.currentItems = [];}\r\n  generateManageTable();\r\n}\r\n\r\nvar listEvents = [\r\n  {test: function(self) {return self.id === 'fshReset';}, act: resetRawEditor},\r\n  {test: function(self) {return self.id === 'fshSave';}, act: saveRawEditor},\r\n  {test: function(self) {return self.id === 'fshAdd';}, act: addQuickItem},\r\n  {\r\n    test: function(self) {return self.id.indexOf('fshDel') === 0;},\r\n    act: deleteQuickItem\r\n  }\r\n];\r\n\r\nexport function injectAuctionSearch(injector) { // Legacy\r\n  var content = injector || pCC;\r\n  content.innerHTML =\r\n    makePageHeader('Trade Hub Quick Search', '', '', '') +\r\n    '<div>This screen allows you to set up some quick ' +\r\n      'search templates for the Auction House. The Display on AH column ' +\r\n      'indicates if the quick search will show on the short list on the ' +\r\n      'Auction House main screen. A maximum of 36 items can show on this ' +\r\n      'list (It will not show more than 36 even if you have more than 36 ' +\r\n      'flagged). To edit items, either use the large text area below, or ' +\r\n      'add a new entry and delete the old one. You can always reset the ' +\r\n      'list to the default values.</div>' +\r\n    '<div class=\"fshSmall\" id=\"fshAso\">' +\r\n    '</div>';\r\n  // global parameters for the meta function generateManageTable\r\n  param = {\r\n    id: 'fshAso',\r\n    headers: ['Category', 'Nickname', 'Quick Search Text',\r\n      'Display in AH?'],\r\n    fields: ['category', 'nickname', 'searchname', 'displayOnAH'],\r\n    tags: ['text', 'text', 'text', 'checkbox'],\r\n    url: ['', '',\r\n      'index.php?cmd=auctionhouse&amp;type=-1&amp;search_text=@replaceme@', ''],\r\n    currentItems: getValueJSON('quickSearchList'),\r\n    gmname: 'quickSearchList',\r\n    categoryField: 'category',\r\n  };\r\n  generateManageTable();\r\n  content.addEventListener('click', eventHandler(listEvents));\r\n}\r\n\r\nexport function injectQuickLinkManager(injector) { // Legacy\r\n  var content = injector || pCC;\r\n  content.innerHTML = makePageTemplate({\r\n    title: 'Quick Links',\r\n    comment: '',\r\n    spanId: '',\r\n    button: '',\r\n    divId: 'qla'\r\n  });\r\n\r\n  // global parameters for the meta function generateManageTable\r\n  param = {\r\n    id: 'qla',\r\n    headers: ['Name', 'URL',\r\n      'New [<span class=\"fshLink tip-static\" ' +\r\n      'data-tipped=\"Open page in a new window\">?</span>]'],\r\n    fields: ['name', 'url', 'newWindow'],\r\n    tags: ['text', 'text', 'checkbox'],\r\n    currentItems: getValueJSON('quickLinks'),\r\n    gmname: 'quickLinks',\r\n  };\r\n  generateManageTable();\r\n  content.addEventListener('click', eventHandler(listEvents));\r\n}\r\n","import callApp from '../callApp';\r\n\r\nexport default function loadInventory() {\r\n  return callApp({cmd: 'profile', subcmd: 'loadinventory'});\r\n}\r\n","export default function setValueJSON(name, value) {\r\n  GM_setValue(name, JSON.stringify(value));\r\n}\r\n","/* eslint-disable no-multi-spaces, max-len */\r\nexport default [\r\n  {name: 'Rage',                stam: 10, lvl: 1,    id: 0,   nicks: 'rage'},\r\n  {name: 'Stun',                stam: 15, lvl: 1,    id: 1,   nicks: 'stun,st'},\r\n  {name: 'Fury',                stam: 10, lvl: 25,   id: 2,   nicks: 'fury'},\r\n  {name: 'Blood Thirst',        stam: 10, lvl: 25,   id: 4,   nicks: 'blood thirst,bloodthirst,bt'},\r\n  {name: 'Enchant Weapon',      stam: 10, lvl: 25,   id: 5,   nicks: 'enchant weapon,ew'},\r\n  {name: 'Berserk',             stam: 15, lvl: 75,   id: 3,   nicks: 'berserk'},\r\n  {name: 'Holy Flame',          stam: 15, lvl: 75,   id: 6,   nicks: 'holy flame,hf'},\r\n  {name: 'Dark Curse',          stam: 20, lvl: 150,  id: 7,   nicks: 'dark curse,dc'},\r\n  {name: 'Shockwave',           stam: 20, lvl: 200,  id: 29,  nicks: 'shockwave,sw,shock'},\r\n  {name: 'Ignite',              stam: 10, lvl: 200,  id: 30,  nicks: 'ignite,ign'},\r\n  {name: 'Super Elite Slayer',  stam: 25, lvl: 250,  id: 31,  nicks: 'super elite slayer,ses,se slayer'},\r\n  {name: 'Wither',              stam: 15, lvl: 250,  id: 32,  nicks: 'wither,with'},\r\n  {name: 'Shatter Armor',       stam: 20, lvl: 300,  id: 33,  nicks: 'shatter armor,sa'},\r\n  {name: 'Death Wish',          stam: 20, lvl: 300,  id: 34,  nicks: 'deathwish,dw,deathw,death wish'},\r\n  {name: 'Spell Breaker',       stam: 35, lvl: 300,  id: 35,  nicks: 'spell breaker,sb'},\r\n  {name: 'Spectral Knight',     stam: 15, lvl: 400,  id: 48,  nicks: 'spectral knight,sk,spec knight'},\r\n  {name: 'Keen Edge',           stam: 10, lvl: 400,  id: 47,  nicks: 'keen edge,ke'},\r\n  {name: 'Arterial Strike',     stam: 20, lvl: 500,  id: 49,  nicks: 'arterial strike,as,art strike,art str'},\r\n  {name: 'Death Dealer',        stam: 20, lvl: 500,  id: 50,  nicks: 'death dealer,dd'},\r\n  {name: 'Savagery',            stam: 15, lvl: 600,  id: 51,  nicks: 'savagery,savage'},\r\n  {name: 'Chi Strike',          stam: 20, lvl: 700,  id: 52,  nicks: 'chi strike,chi,chis,chi str'},\r\n  {name: 'Shield Strike',       stam: 20, lvl: 700,  id: 53,  nicks: 'shield strike,ss,sh str'},\r\n  {name: 'Demoralize',          stam: 25, lvl: 800,  id: 73,  nicks: 'demoralize,dem'},\r\n  {name: 'Poison',              stam: 25, lvl: 800,  id: 70,  nicks: 'poison,poi'},\r\n  {name: 'Iron Fist',           stam: 25, lvl: 900,  id: 74,  nicks: 'iron fist,if'},\r\n  {name: 'Spell Leech',         stam: 50, lvl: 900,  id: 79,  nicks: 'spell leech,sl'},\r\n  {name: 'Distraction',         stam: 25, lvl: 900,  id: 78,  nicks: 'distraction,dis'},\r\n  {name: 'Coordinated Attack',  stam: 30, lvl: 1000, id: 118, nicks: 'coordinated attack,coorda'},\r\n  {name: 'Undermine',           stam: 30, lvl: 1000, id: 108, nicks: 'undermine,um'},\r\n  {name: 'Cursed Rune',         stam: 30, lvl: 1000, id: 89,  nicks: 'cursed rune,crune'},\r\n  {name: 'Anti Deflect',        stam: 30, lvl: 1000, id: 105, nicks: 'anti deflect,ad'},\r\n  {name: 'Overkill',            stam: 30, lvl: 1200, id: 109, nicks: 'overkill,ok'},\r\n  {name: 'Smashing Hammer',     stam: 30, lvl: 1200, id: 111, nicks: 'smashing hammer,sh'},\r\n  {name: 'Mighty Vigor',        stam: 35, lvl: 1200, id: 113, nicks: 'mighty vigor,mv'},\r\n  {name: 'Fist Fight',          stam: 30, lvl: 1200, id: 115, nicks: 'fist fight,ff'},\r\n  {name: 'Cursed Ring',         stam: 30, lvl: 1400, id: 88,  nicks: 'cursed ring,cring'},\r\n  {name: 'Sharpen',             stam: 30, lvl: 1400, id: 106, nicks: 'sharpen,sharp'},\r\n  {name: 'Balanced Attack',     stam: 30, lvl: 1400, id: 116, nicks: 'balanced attack,ba'},\r\n  {name: 'Heavy Weight',        stam: 20, lvl: 1600, id: 146, nicks: 'heavy weight, hw'},\r\n  {name: 'Armored Strike',      stam: 30, lvl: 1600, id: 130, nicks: 'armored strike, armstr'},\r\n  {name: 'Invert',              stam: 40, lvl: 2000, id: 173, nicks: 'invert'},\r\n  {name: 'Reign of Terror',     stam: 40, lvl: 2500, id: 174, nicks: 'reign of terror'},\r\n  {name: 'Critical Strike',     stam: 40, lvl: 3000, id: 175, nicks: 'critical strike'},\r\n  {name: 'Great Vigor',         stam: 10, lvl: 1,    id: 12,  nicks: 'great vigor,vigor,gv'},\r\n  {name: 'Fortify',             stam: 10, lvl: 25,   id: 8,   nicks: 'fortify'},\r\n  {name: 'Evade',               stam: 10, lvl: 25,   id: 10,  nicks: 'evade'},\r\n  {name: 'Absorb',              stam: 20, lvl: 25,   id: 13,  nicks: 'absorb,abs'},\r\n  {name: 'Rock Skin',           stam: 15, lvl: 75,   id: 11,  nicks: 'rock skin,rs'},\r\n  {name: 'Enchanted Armor',     stam: 10, lvl: 75,   id: 9,   nicks: 'enchanted armor,enchant armor,ea,ench arm,ench armor'},\r\n  {name: 'Aura of Protection',  stam: 20, lvl: 150,  id: 15,  nicks: 'aura of protection,aop,aofp'},\r\n  {name: 'Deflect',             stam: 25, lvl: 150,  id: 14,  nicks: 'deflect,defl'},\r\n  {name: 'Force Shield',        stam: 10, lvl: 200,  id: 27,  nicks: 'force shield,fs'},\r\n  {name: 'Unbreakable',         stam: 20, lvl: 200,  id: 28,  nicks: 'unbreakable,ub,unb,unbr'},\r\n  {name: 'Honor',               stam: 10, lvl: 800,  id: 82,  nicks: 'honor'},\r\n  {name: 'Assist',              stam: 30, lvl: 250,  id: 36,  nicks: 'assist,ass'},\r\n  {name: 'Constitution',        stam: 25, lvl: 300,  id: 37,  nicks: 'constitution,const'},\r\n  {name: 'Counter Attack',      stam: 20, lvl: 400,  id: 54,  nicks: 'counter attack,ca'},\r\n  {name: 'Summon Shield Imp',   stam: 50, lvl: 400,  id: 55,  nicks: 'summon shield imp,ssi,imp'},\r\n  {name: 'Vision',              stam: 20, lvl: 500,  id: 56,  nicks: 'vision,vis'},\r\n  {name: 'Fortitude',           stam: 15, lvl: 500,  id: 57,  nicks: 'fortitude,fort'},\r\n  {name: 'Flinch',              stam: 20, lvl: 600,  id: 58,  nicks: 'flinch'},\r\n  {name: 'Terrorize',           stam: 20, lvl: 700,  id: 59,  nicks: 'terrorize,terror'},\r\n  {name: 'Nightmare Visage',    stam: 40, lvl: 700,  id: 60,  nicks: 'nightmare visage,nv,visage'},\r\n  {name: 'Sanctuary',           stam: 25, lvl: 800,  id: 44,  nicks: 'sanctuary,sanc'},\r\n  {name: 'Dull Edge',           stam: 10, lvl: 800,  id: 46,  nicks: 'dull edge,de'},\r\n  {name: 'Erosion',             stam: 25, lvl: 900,  id: 80,  nicks: 'erosion,ero'},\r\n  {name: 'Avert Gaze',          stam: 10, lvl: 900,  id: 71,  nicks: 'avert gaze,ag'},\r\n  {name: 'Enchant Shield',      stam: 25, lvl: 900,  id: 77,  nicks: 'enchant shield,es'},\r\n  {name: 'Smite',               stam: 30, lvl: 1000, id: 97,  nicks: 'smite,sm'},\r\n  {name: 'Balanced Defense',    stam: 30, lvl: 1000, id: 117, nicks: 'balanced defense,bd'},\r\n  {name: 'Bastion',             stam: 30, lvl: 1000, id: 122, nicks: 'bastion,bast'},\r\n  {name: 'Side Step',           stam: 30, lvl: 1000, id: 86,  nicks: 'side step,sstep'},\r\n  {name: 'High Guard',          stam: 30, lvl: 1200, id: 96,  nicks: 'high guard,hg'},\r\n  {name: 'Barricade',           stam: 30, lvl: 1200, id: 98,  nicks: 'barricade,bar'},\r\n  {name: 'Coordinated Defense', stam: 30, lvl: 1200, id: 119, nicks: 'coordinated defense,cd'},\r\n  {name: 'Degrade',             stam: 30, lvl: 1200, id: 121, nicks: 'degrade,deg,dg'},\r\n  {name: 'Retaliate',           stam: 30, lvl: 1400, id: 123, nicks: 'retaliate,ret'},\r\n  {name: 'Shame',               stam: 35, lvl: 1400, id: 110, nicks: 'shame'},\r\n  {name: 'Dispel Curse',        stam: 35, lvl: 1400, id: 114, nicks: 'dispel curse,dispel'},\r\n  {name: 'Anchored',            stam: 30, lvl: 1600, id: 154, nicks: 'anchored, anch, anchor'},\r\n  {name: 'Hardened',            stam: 30, lvl: 1600, id: 153, nicks: 'hardened, hard, harden'},\r\n  {name: 'Armor Boost',         stam: 30, lvl: 1600, id: 136, nicks: 'armor boost, armbst, arm bst, armb'},\r\n  {name: 'Shield Wall',         stam: 30, lvl: 1600, id: 135, nicks: 'shield wall, shldwll, sw'},\r\n  {name: 'Layered Armor',       stam: 40, lvl: 2000, id: 170, nicks: 'layered armor'},\r\n  {name: 'Defensive Aura',      stam: 40, lvl: 2500, id: 171, nicks: 'defensive aura'},\r\n  {name: 'Fumble',              stam: 40, lvl: 3000, id: 172, nicks: 'fumble'},\r\n  {name: 'Find Item',           stam: 10, lvl: 1,    id: 16,  nicks: 'find item,fi'},\r\n  {name: 'Treasure Hunter',     stam: 15, lvl: 1,    id: 17,  nicks: 'treasure hunter,th,treas hunter'},\r\n  {name: 'Deep Pockets',        stam: 10, lvl: 1,    id: 22,  nicks: 'deep pockets,dp'},\r\n  {name: 'Quest Finder',        stam: 5,  lvl: 1,    id: 61,  nicks: 'quest finder,qf'},\r\n  {name: 'Adept Learner',       stam: 10, lvl: 25,   id: 19,  nicks: 'adept learner,al'},\r\n  {name: 'Defiance',            stam: 15, lvl: 25,   id: 18,  nicks: 'defiance'},\r\n  {name: 'Librarian',           stam: 10, lvl: 75,   id: 20,  nicks: 'librarian,lib,libr'},\r\n  {name: 'Merchant',            stam: 10, lvl: 75,   id: 21,  nicks: 'merchant,merch,merc'},\r\n  {name: 'Last Ditch',          stam: 15, lvl: 150,  id: 23,  nicks: 'last ditch,ld'},\r\n  {name: 'Animal Magnetism',    stam: 10, lvl: 200,  id: 24,  nicks: 'animal magnetism,animag,ani mag,am'},\r\n  {name: 'Empower',             stam: 20, lvl: 200,  id: 25,  nicks: 'empower,emp'},\r\n  {name: 'Doubler',             stam: 5,  lvl: 200,  id: 26,  nicks: 'doubler,doub,db'},\r\n  {name: 'Conserve',            stam: 10, lvl: 250,  id: 39,  nicks: 'conserve,cons,consv,con'},\r\n  {name: 'Brewing Master',      stam: 10, lvl: 250,  id: 40,  nicks: 'brewing master,bm,brm,brewm'},\r\n  {name: 'Four Leaf',           stam: 20, lvl: 250,  id: 41,  nicks: 'four leaf,4l,fl'},\r\n  {name: 'Extend',              stam: 30, lvl: 300,  id: 42,  nicks: 'extend,ext'},\r\n  {name: 'Inventor',            stam: 15, lvl: 400,  id: 62,  nicks: 'inventor,inv,invI,inv1,inventor1,inventor 1,inventor i,inv i,inv 1'},\r\n  {name: 'Extractor',           stam: 15, lvl: 400,  id: 63,  nicks: 'extractor,extr'},\r\n  {name: 'Inventor II',         stam: 20, lvl: 500,  id: 64,  nicks: 'inventor ii,inventorii,invii,inv2,inventor 2,inv ii,inv 2'},\r\n  {name: 'Buff Master',         stam: 10, lvl: 500,  id: 65,  nicks: 'buff master,buffm,bum'},\r\n  {name: 'Reflection',          stam: 10, lvl: 600,  id: 66,  nicks: 'reflection,ref,refl,reflect'},\r\n  {name: 'Guild Buffer',        stam: 10, lvl: 600,  id: 160, nicks: 'guild buffer, gldbfr, gb'},\r\n  {name: 'Light Foot',          stam: 15, lvl: 700,  id: 67,  nicks: 'light foot,lf'},\r\n  {name: 'Mesmerize',           stam: 20, lvl: 700,  id: 68,  nicks: 'mesmerize,mesmer,mes,mez'},\r\n  {name: 'Resource Finder',     stam: 25, lvl: 800,  id: 76,  nicks: 'resource finder,rf'},\r\n  {name: 'Quest Hunter',        stam: 25, lvl: 800,  id: 166, nicks: 'quest hunter'},\r\n  {name: 'Gloat',               stam: 10, lvl: 900,  id: 81,  nicks: 'gloat'},\r\n  {name: 'Sacrifice',           stam: 25, lvl: 900,  id: 75,  nicks: 'sacrifice,sac'},\r\n  {name: 'Reckoning',           stam: 25, lvl: 900,  id: 72,  nicks: 'reckoning,rec,rek'},\r\n  {name: 'Reinforce',           stam: 30, lvl: 1000, id: 126, nicks: 'reinforce,rein'},\r\n  {name: 'Bodyguard',           stam: 30, lvl: 1000, id: 120, nicks: 'bodyguard,bg'},\r\n  {name: 'Riposte',             stam: 30, lvl: 1000, id: 124, nicks: 'riposte,rip'},\r\n  {name: 'Severe Condition',    stam: 30, lvl: 1000, id: 101, nicks: 'severe condition,sc'},\r\n  {name: 'Sealed',              stam: 35, lvl: 1200, id: 112, nicks: 'sealed,seal'},\r\n  {name: 'Righteous',           stam: 30, lvl: 1200, id: 107, nicks: 'righteous,right'},\r\n  {name: 'Epic Forge',          stam: 30, lvl: 1200, id: 102, nicks: 'epic forge,ef'},\r\n  {name: 'Golden Shield',       stam: 30, lvl: 1200, id: 103, nicks: 'golden shield,gs'},\r\n  {name: 'Stalker',             stam: 35, lvl: 1400, id: 125, nicks: 'stalker,stalk'},\r\n  {name: 'Ageless',             stam: 30, lvl: 1400, id: 100, nicks: 'ageless,age'},\r\n  {name: 'Extractor II',        stam: 30, lvl: 1400, id: 104, nicks: 'extractor ii,extractorii,extii,ext2,extractor 2,ext ii,ext 2'},\r\n  {name: 'Epic Craft',          stam: 30, lvl: 1600, id: 159, nicks: 'epic craft, epc crft, epccrft, ec'},\r\n  {name: 'Gold Foot',           stam: 20, lvl: 1600, id: 137, nicks: 'gold foot, goldfoot, gldft, gf'},\r\n  {name: 'Titan Doubler',       stam: 40, lvl: 2000, id: 167, nicks: 'titan doubler'},\r\n  {name: 'Teleport',            stam: 40, lvl: 2500, id: 168, nicks: 'teleport'},\r\n  {name: 'Invigorate',          stam: 40, lvl: 3000, id: 169, nicks: 'invigorate'}\r\n];\r\n","import add from '../support/task';\r\nimport getValue from '../system/getValue';\r\nimport moreToDo from '../common/moreToDo';\r\nimport {lastActivityRE, nowSecs} from '../support/dataObj';\r\n\r\nvar dotList;\r\nvar dotCount;\r\nvar redDot =\r\n  '<span class=\"fshDot redDot tip-static\" data-tipped=\"Offline\"></span>';\r\nvar greenDiamond =\r\n  '<span class=\"fshDot greenDiamond tip-static\" data-tipped=\"Online\"></span>';\r\nvar yellowDiamond =\r\n  '<span class=\"fshDot yellowDiamond tip-static\" data-tipped=\"Offline\"></span>';\r\nvar orangeDiamond =\r\n  '<span class=\"fshDot orangeDiamond tip-static\" data-tipped=\"Offline\"></span>';\r\nvar offlineDot =\r\n  '<span class=\"fshDot offlineDot tip-static\" data-tipped=\"Offline\"></span>';\r\nvar sevenDayDot =\r\n  '<span class=\"fshDot sevenDayDot tip-static\" data-tipped=\"Offline\"></span>';\r\n\r\nvar getMins = [\r\n  function(obj, min) {\r\n    if (obj.day) {return min + parseInt(obj.day, 10) * 1440;}\r\n    return min;\r\n  },\r\n  function(obj, min) {\r\n    if (obj.hour) {return min + parseInt(obj.hour, 10) * 60;}\r\n    return min;\r\n  },\r\n  function(obj, min) {\r\n    if (obj.min) {return min + parseInt(obj.min, 10);}\r\n    return min;\r\n  },\r\n  function(obj, min) {\r\n    if (obj.last_login) {\r\n      return Math.floor((nowSecs - obj.last_login) / 60);\r\n    }\r\n    return min;\r\n  },\r\n  function(obj, min) {\r\n    // last_login is 'false' over 30 days\r\n    if ('last_login' in obj && !obj.last_login) {return 99999;}\r\n    return min;\r\n  }\r\n];\r\n\r\nvar getDot = [\r\n  {condition: 2, result: greenDiamond},\r\n  {condition: 5, result: yellowDiamond},\r\n  {condition: 30, result: orangeDiamond},\r\n  {condition: 10080, result: offlineDot},\r\n  {condition: 44640, result: sevenDayDot}\r\n];\r\n\r\nexport function onlineDot(obj) {\r\n  var min = getMins.reduce(function(prev, curr) {\r\n    return curr(obj, prev);\r\n  }, 0);\r\n  for (var i = 0; i < getDot.length; i += 1) {\r\n    var el = getDot[i];\r\n    if (min < el.condition) {return el.result;}\r\n  }\r\n  return redDot;\r\n}\r\n\r\nfunction changeOnlineDot(contactLink) {\r\n  var lastActivity = lastActivityRE\r\n    .exec(contactLink.dataset.tipped);\r\n  contactLink.parentNode.previousSibling.innerHTML =\r\n    onlineDot({\r\n      min: lastActivity[3],\r\n      hour: lastActivity[2],\r\n      day: lastActivity[1]\r\n    });\r\n}\r\n\r\nfunction batchDots() {\r\n  var limit = performance.now() + 5;\r\n  while (moreToDo(limit, dotCount, dotList)) {\r\n    changeOnlineDot(dotList[dotCount]);\r\n    dotCount += 1;\r\n  }\r\n  if (dotCount < dotList.length) {\r\n    add(3, batchDots);\r\n  }\r\n}\r\n\r\nexport function colouredDots() {\r\n  if (!getValue('enhanceOnlineDots')) {return;}\r\n  dotList = document.querySelectorAll(\r\n    '#pCC a[data-tipped*=\"Last Activity\"]');\r\n  dotCount = 0;\r\n  add(3, batchDots);\r\n}\r\n","import {helpLink} from '../settings/simpleCheckbox';\r\n\r\nfunction outputTable(o) {\r\n  return '<br><h1>Potential ' + o.processed + 'ers and Bio Info</h1><br>' +\r\n    '<table class=\"fshResult\" id=\"buffTable\"><tbody>' +\r\n    '<tr><th class=\"nameCol\">&nbsp;Name</th>' +\r\n    '<th class=\"infoCol\">&nbsp;Player Info</th>' +\r\n    '<th>&nbsp;Notable Bio Text</th></tr>' +\r\n    '</tbody></table><br>';\r\n}\r\n\r\nfunction disclaimer() {\r\n  return '<div class=\"disclaim\">Disclaimer: This ' +\r\n    'functionality does a simple text search for the terms above. ' +\r\n    'It is not as smart as you are, so please do not judge the results ' +\r\n    'too harshly. It does not search all online players, just a subset ' +\r\n    'of those that have been on recently. ' +\r\n    'The aim is to be fast and still return a good set of results. This ' +\r\n    'feature is a work in progress, so it may be tweaked and enhanced ' +\r\n    'over time.</div>';\r\n}\r\n\r\nexport default function pageLayout(o, extraProfile) { // Legacy\r\n  return '<table class=\"fshFind\"><tbody>' +\r\n    '<tr><td rowspan=\"2\" colspan=\"2\" class=\"headCell\">' +\r\n    '<h1>Find ' + o.header + '</h1></td>' +\r\n    '<td class=\"findLabel\">Select ' + o.what + ' to search for:</td>' +\r\n    '<td>' + o.control() + '</td></tr>' +\r\n    '<tr><td class=\"findLabel\">Level ' + o.cutoff + 'ers only:</td>' +\r\n    '<td><input id=\"level175\" type=\"checkbox\"></td></tr>' +\r\n    '<tr><td class=\"leftLabel\">' + o.searched +\r\n    ':&nbsp;</td><td id=\"buffNicks\">&nbsp;</td>' +\r\n    '<td class=\"findLabel\">Search guild members:</td>' +\r\n    '<td><input id=\"guildMembers\" type=\"checkbox\" checked></td></tr>' +\r\n    '<tr><td class=\"findLabel\">' +\r\n    '# potential ' + o.potential + 'ers to search:&nbsp;</td>' +\r\n    '<td id=\"potentialBuffers\"></td>' +\r\n    '<td class=\"findLabel\">Search allies/enemies:' +\r\n    helpLink('Search Allies/Enemies',\r\n      'The checkbox enables searching your own personal ' +\r\n      'allies/enemies list for buffs.<br><br>' +\r\n      'Additional profiles to search can be added in the text ' +\r\n      'field to the right, separated by commas.') + '</td>' +\r\n    '<td><input id=\"alliesEnemies\" type=\"checkbox\" checked>' +\r\n    '<input class=\"extraProfile\" class=\"custominput\" id=\"extraProfile\" ' +\r\n    'type=\"text\" title=\"Extra profiles to search\" value=\"' +\r\n    (extraProfile || '') + '\"></td></tr>' +\r\n    '<tr><td class=\"findLabel\"># ' + o.processed + 'ers processed:' +\r\n    '&nbsp;</td><td id=\"buffersProcessed\">0</td>' +\r\n    '<td class=\"findLabel\">Search online list:</td>' +\r\n    '<td><select class=\"selectOnline\" id=\"onlinePlayers\">' +\r\n      '<option value=\"0\">Disabled</option>' +\r\n      '<option value=\"49\">Short (fastest)</option>' +\r\n      '<option value=\"47\">Medium (medium)</option>' +\r\n      '<option value=\"45\">Long (slowest)</option>' +\r\n    '</select></td></tr>' +\r\n    '<tr><td class=\"findLabel\">Find ' + o.progress + ' progress:' +\r\n    '&nbsp;</td><td class=\"buffProg\" id=\"bufferProgress\">Idle</td>' +\r\n    '<td align=\"center\"><input id=\"clearresultsbutton\" ' +\r\n    'class=\"custombutton\" type=\"button\" value=\"Clear Results\"></td>' +\r\n    '<td align=\"center\"><input id=\"findbuffsbutton\" class=\"custombutton\" ' +\r\n    'type=\"button\" value=\"Find Buffers\"></td></tr>' +\r\n    '</tbody></table>' +\r\n    outputTable(o) +\r\n    disclaimer();\r\n}\r\n","export default function moreToDo(limit, cntr, list) {\r\n  return performance.now() < limit && cntr < list.length;\r\n}\r\n","import createDocument from '../system/createDocument';\r\nimport fallback from '../system/fallback';\r\nimport {getElementById} from '../common/getElement';\r\nimport intValue from '../system/intValue';\r\nimport {onlineDot} from '../common/colouredDots';\r\n\r\nvar sustainLevelRE = /Level<br>(\\d+)%/;\r\n\r\nfunction uniq(arr, removeBy) {\r\n  var seen = {};\r\n  if (removeBy) {\r\n    return arr.filter(function(item) {\r\n      if (seen[item[removeBy]]) {return false;}\r\n      seen[item[removeBy]] = true;\r\n      return true;\r\n    });\r\n  }\r\n  return arr.filter(function(item) {\r\n    if (seen[item]) {return false;}\r\n    seen[item] = true;\r\n    return true;\r\n  });\r\n}\r\n\r\nfunction getPrevBr(bioCellHtml, runningTotalPosition) { // Legacy\r\n  var prevBR = bioCellHtml.lastIndexOf('<br>', runningTotalPosition - 1);\r\n  if (prevBR === -1) {return 0;}\r\n  return prevBR;\r\n}\r\n\r\nfunction getNextBr(bioCellHtml, runningTotalPosition) { // Legacy\r\n  var nextBR = bioCellHtml.indexOf('<br>', runningTotalPosition);\r\n  if (nextBR === -1 && bioCellHtml.indexOf('<br>') !== -1) {\r\n    return bioCellHtml.length - 5;\r\n  }\r\n  return nextBR;\r\n}\r\n\r\nfunction getBioLines(bioCellHtml, findBuffNicks) { // Legacy\r\n  var res = [];\r\n  var buffPosition = 0;\r\n  var startingPosition = 0;\r\n  var runningTotalPosition = 0;\r\n  var bioTextToSearch = ' ' + bioCellHtml + ' ';\r\n  var buffRE = new RegExp('[^a-zA-Z]((' +\r\n    findBuffNicks.replace(/,/g, ')|(') + '))[^a-zA-Z]', 'i');\r\n  while (buffPosition !== -1) {\r\n    bioTextToSearch = bioTextToSearch.substr(startingPosition,\r\n      bioTextToSearch.length);\r\n    buffPosition = bioTextToSearch.search(buffRE);\r\n    if (buffPosition !== -1) {\r\n      startingPosition = buffPosition + 1;\r\n      runningTotalPosition += buffPosition;\r\n      var prevBR = getPrevBr(bioCellHtml, runningTotalPosition);\r\n      var nextBR = getNextBr(bioCellHtml, runningTotalPosition);\r\n      var textLine = bioCellHtml.substr(prevBR + 4, nextBR - prevBR);\r\n      textLine = textLine.replace(/(`~)|(~`)|(\\{b\\})|(\\{\\/b\\})/g, '');\r\n      res.push(textLine);\r\n    }\r\n  }\r\n  return uniq(res);\r\n}\r\n\r\nfunction getSustain(doc) {\r\n  var aLinks = getElementById('profileLeftColumn', doc)\r\n    .getElementsByTagName('a');\r\n  var sustainLevel;\r\n  Array.prototype.some.call(aLinks, function(el) {\r\n    if (el.textContent === 'Sustain') {\r\n      var sustainText = el.parentNode.parentNode.parentNode.nextElementSibling\r\n        .firstElementChild.dataset.tipped;\r\n      sustainLevel = parseInt(sustainLevelRE.exec(sustainText)[1], 10);\r\n      return true;\r\n    }\r\n    return false;\r\n  });\r\n  return fallback(sustainLevel, -1);\r\n}\r\n\r\nfunction nameCell(doc, callback, lastActivity, bioCellHtml) { // Legacy\r\n  var innerPlayerName = getElementById('pCC', doc)\r\n    .getElementsByTagName('h1')[0].textContent;\r\n  var levelValue = intValue(getElementById('profileLeftColumn', doc)\r\n    .children[4].children[0].rows[0].cells[1].textContent);\r\n  var virtualLevelValue = parseInt(getElementById('stat-vl', doc)\r\n    .textContent, 10);\r\n  var lastActivityMinutes = parseInt(lastActivity[1], 10);\r\n  var lastActivityIMG = onlineDot({min: lastActivityMinutes});\r\n  var playerHREF = callback.href;\r\n  var bioTip = bioCellHtml.replace(/'|\"|\\n/g, '');\r\n  return '<nobr>' + lastActivityIMG + '&nbsp;<a href=\"' +\r\n    playerHREF + '\" target=\"new\" ' +\r\n    // FIXME - It kind works now, but not guaranteed?\r\n    'class=\"tip-static\" ' +\r\n    'data-tipped=\"' + bioTip + '\">' + innerPlayerName + '</a>' +\r\n    '&nbsp;<span class=\"fshBlue\">[<span class=\"a-reply fshLink\" ' +\r\n    'target_player=\"' + innerPlayerName + '\">m</span>]</span></nobr><br>' +\r\n    '<span class=\"fshGray\">Level:&nbsp;</span>' + levelValue +\r\n    '&nbsp;(' + virtualLevelValue + ')';\r\n}\r\n\r\nfunction playerInfo(lastActivity, sustainLevel, hasExtendBuff) { // Legacy\r\n  var sustain = 'fshRed';\r\n  if (sustainLevel >= 100) {sustain = 'fshGreen';}\r\n  var extend = '<span class=\"fshRed\">No</span>';\r\n  if (hasExtendBuff) {extend = '<span class=\"fshGreen\">Yes</span>';}\r\n  return '<table><tbody><tr>' +\r\n    '<td colspan=\"2\" class=\"resAct\">Last Activity:</td>' +\r\n    '<td colspan=\"2\"><nobr>' + lastActivity[0] + '</nobr></td></tr>' +\r\n    '<tr><td class=\"resLbl\">Sustain:' +\r\n    '</td><td class=\"resVal ' + sustain + '\">' + sustainLevel + '%</td>' +\r\n    '<td class=\"resLbl\">Extend:</td>' +\r\n    '<td class=\"resVal\">' + extend + '</td></tr>';\r\n}\r\n\r\nexport default function parseProfileAndDisplay(responseText, callback) { // Hybrid - Evil\r\n  var doc = createDocument(responseText);\r\n  // name and level\r\n  var innerPcc = getElementById('pCC', doc);\r\n  // last activity\r\n  var lastActivityElement = innerPcc.getElementsByTagName('p')[0];\r\n  var lastActivity = /(\\d+) mins, (\\d+) secs/\r\n    .exec(lastActivityElement.textContent);\r\n  // buffs\r\n  var bioCellHtml = getElementById('profile-bio', doc).innerHTML;\r\n  var buffTable = getElementById('buffTable');\r\n  var textLineArray = getBioLines(bioCellHtml, callback.findBuffNicks);\r\n  // sustain\r\n  var sustainLevel = getSustain(doc);\r\n  // extend\r\n  var hasExtendBuff = doc.querySelector(\r\n    'img.tip-static[data-tipped*=\"Extend\"]');\r\n\r\n  // add row to table\r\n  if (textLineArray.length > 0) {\r\n    var newRow = buffTable.insertRow(-1);\r\n    // name cell\r\n    var newCell = newRow.insertCell(0);\r\n    newCell.style.verticalAlign = 'top';\r\n    newCell.innerHTML = nameCell(doc, callback, lastActivity, bioCellHtml);\r\n    $('.a-reply').click(function(evt) {\r\n      window.openQuickMsgDialog(evt.target.getAttribute('target_player'));\r\n    });\r\n\r\n    // player info cell\r\n    newCell = newRow.insertCell(1);\r\n    newCell.innerHTML = playerInfo(lastActivity, sustainLevel, hasExtendBuff);\r\n    newCell.style.verticalAlign = 'top';\r\n    // buff cell\r\n    newCell = newRow.insertCell(2);\r\n    textLineArray.forEach(function(el) {\r\n      newCell.innerHTML += el + '<br>';\r\n    });\r\n  }\r\n  var processedBuffers = getElementById('buffersProcessed');\r\n  var potentialBuffers =\r\n    parseInt(getElementById('potentialBuffers').textContent, 10);\r\n  var processedBuffersCount = parseInt(processedBuffers.textContent, 10);\r\n  processedBuffers.innerHTML = processedBuffersCount + 1;\r\n  if (potentialBuffers === processedBuffersCount + 1) {\r\n    callback.bufferProgress.innerHTML = 'Done.';\r\n    callback.bufferProgress.style.color = 'blue';\r\n  }\r\n}\r\n","import buffList from '../support/buffObj';\r\nimport getValue from '../system/getValue';\r\n\r\nexport var buffCustom = {\r\n  header: 'Buff',\r\n  what: 'buff',\r\n  control: function() {\r\n    var ret = '<select style=\"width:140px;\" id=\"selectedBuff\">';\r\n    for (var j = 0; j < buffList.length; j += 1) {\r\n      ret += '<option value=\"' + buffList[j].id + '\">' +\r\n        buffList[j].name + '</option>';\r\n    }\r\n    ret += '</select>';\r\n    return ret;\r\n  },\r\n  cutoff: '175 buff',\r\n  searched: 'Nicknames of buff searched',\r\n  potential: 'buff',\r\n  processed: 'Buff',\r\n  progress: 'buffers'\r\n};\r\nexport var otherCustom = {\r\n  header: 'Other',\r\n  what: 'text',\r\n  control: function() {\r\n    var textToSearchFor = getValue('textToSearchFor') || '';\r\n    return '<input style=\"width:140px;\" class=\"custominput\" ' +\r\n      'id=\"textToSearchFor\" type=\"text\" title=\"Text to search for\" value=\"' +\r\n      textToSearchFor + '\">';\r\n  },\r\n  cutoff: '500+ play',\r\n  searched: 'Text searched for',\r\n  potential: 'play',\r\n  processed: 'Play',\r\n  progress: 'Other'\r\n};\r\n","import buffList from '../support/buffObj';\r\nimport calf from '../support/calf';\r\nimport createDocument from '../system/createDocument';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {lastActivityRE} from '../support/dataObj';\r\nimport pageLayout from './pageLayout';\r\nimport parseProfileAndDisplay from './parseProfileAndDisplay';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport setValue from '../system/setValue';\r\nimport stringSort from '../system/stringSort';\r\nimport {buffCustom, otherCustom} from './assets';\r\nimport {pCC, playerName} from '../support/layout';\r\n\r\nvar characterName;\r\nvar findBuffNicks;\r\nvar findBuffMinCastLevel;\r\nvar findBuffsLevel175Only;\r\nvar onlinePlayers;\r\nvar onlinePlayersSetting;\r\nexport var extraProfile;\r\nvar profilePagesToSearch;\r\nvar profilePagesToSearchProcessed;\r\nvar bufferProgress;\r\n\r\nfunction findBuffsParsePlayersForBuffs() { // Legacy\r\n  // remove duplicates TODO\r\n  // now need to parse player pages for buff ...\r\n  getElementById('potentialBuffers').innerHTML =\r\n    onlinePlayers.length;\r\n  if (onlinePlayers.length <= 0) {\r\n    bufferProgress.innerHTML = 'Done.';\r\n    bufferProgress.style.color = 'blue';\r\n    return;\r\n  }\r\n  bufferProgress.innerHTML = 'Parsing player data ...';\r\n  bufferProgress.style.color = 'green';\r\n\r\n  //#if _DEV  //  Find Buffs uglify bug\r\n  console.log('onlinePlayers', onlinePlayers); // eslint-disable-line no-console\r\n  //#endif\r\n\r\n  onlinePlayers.forEach(function(j) {\r\n    retryAjax(j).done(function(html) {\r\n      parseProfileAndDisplay(html, {\r\n        href: onlinePlayers[j],\r\n        bufferProgress: bufferProgress,\r\n        findBuffNicks: findBuffNicks\r\n      });\r\n    });\r\n  });\r\n}\r\n\r\nfunction calcMinLvl() { // Legacy\r\n  if (findBuffsLevel175Only) {return 500;}\r\n  return 1;\r\n}\r\n\r\nfunction calcNextPage(curPage, maxPage) { // Legacy\r\n  if (curPage === 1) {return Math.round(onlinePlayersSetting * maxPage / 50);}\r\n  return curPage + 1;\r\n}\r\n\r\nfunction addPlayerToSearchList(onlinePlayer, onlinePlayerName) {\r\n  // add online player to search list (all but self)\r\n  if (characterName !== onlinePlayerName.trim()) {\r\n    onlinePlayers.push(onlinePlayer);\r\n  }\r\n}\r\n\r\nfunction playerRow(i, e) {\r\n  var onlinePlayer = $(e).find('td:eq(1) a').attr('href');\r\n  var onlinePlayerLevel = parseInt($(e).find('td:eq(2)').text()\r\n    .replace(/,/g, ''), 10);\r\n  var onlinePlayerName = $(e).find('td:eq(1) a').text();\r\n  var minPlayerVirtualLevel = calcMinLvl();\r\n  if (onlinePlayerLevel >= findBuffMinCastLevel &&\r\n      onlinePlayerLevel >= minPlayerVirtualLevel) {\r\n    addPlayerToSearchList(onlinePlayer, onlinePlayerName);\r\n  }\r\n}\r\n\r\nfunction findBuffsParseOnlinePlayers(responseText) { // Legacy\r\n  var doc = createDocument(responseText);\r\n  var playerRows = $(doc).find('table:contains(\"Username\")>tbody>tr:has' +\r\n    '(td>a[href*=\"cmd=profile&player_id=\"])');\r\n  var maxPage = parseInt($(doc).find('td:has(input[name=\"page\"]):last')\r\n    .text().replace(/\\D/g, ''), 10);\r\n  var curPage = parseInt($(doc).find('input[name=\"page\"]:last').val()\r\n    .replace(/\\D/g, ''), 10);\r\n  if (curPage !== 1) {\r\n    playerRows.each(playerRow);\r\n  }\r\n  if (curPage < maxPage) {\r\n    var newPage = calcNextPage(curPage, maxPage);\r\n    bufferProgress.innerHTML = 'Parsing online page ' + curPage + ' ...';\r\n    retryAjax('index.php?no_mobile=1&cmd=onlineplayers&page=' +\r\n      newPage.toString()).done(findBuffsParseOnlinePlayers);\r\n  } else {\r\n    // all done so moving on\r\n    findBuffsParsePlayersForBuffs();\r\n  }\r\n}\r\n\r\nfunction findBuffsParseOnlinePlayersStart() { // Legacy\r\n  // if option enabled then parse online players\r\n  onlinePlayersSetting =\r\n    parseInt(getElementById('onlinePlayers').value, 10);\r\n  if (onlinePlayersSetting !== 0) {\r\n    retryAjax('index.php?no_mobile=1&cmd=onlineplayers&page=1')\r\n      .done(findBuffsParseOnlinePlayers);\r\n  } else {\r\n    findBuffsParsePlayersForBuffs();\r\n  }\r\n}\r\n\r\nfunction calcLastActMins(tipped) {\r\n  var lastActivity = lastActivityRE.exec(tipped);\r\n  var lastActivityDays = parseInt(lastActivity[1], 10);\r\n  var lastActivityHours = parseInt(lastActivity[2], 10) + lastActivityDays * 24;\r\n  return parseInt(lastActivity[3], 10) + lastActivityHours * 60;\r\n}\r\n\r\nfunction isValidPlayer(lastActivityMinutes, vlevel, minPlayerVirtualLevel) {\r\n  return lastActivityMinutes < 5 && vlevel >= findBuffMinCastLevel &&\r\n    vlevel >= minPlayerVirtualLevel;\r\n}\r\n\r\nfunction parsePlayerLink(el) {\r\n  var tipped = el.dataset.tipped;\r\n  var lastActivityMinutes = calcLastActMins(tipped);\r\n  // check if they are high enough level to cast the buff\r\n  var vlevel = Number(/VL:.+?(\\d+)/.exec(tipped)[1]);\r\n  var minPlayerVirtualLevel = calcMinLvl();\r\n  if (isValidPlayer(lastActivityMinutes, vlevel, minPlayerVirtualLevel)) {\r\n    addPlayerToSearchList(el.href, el.textContent);\r\n  }\r\n}\r\n\r\nfunction findBuffsParseProfilePage(responseText) {\r\n  var doc = createDocument(responseText);\r\n  var profileAlliesEnemies =\r\n    doc.querySelectorAll('#profileLeftColumn a[data-tipped*=\"Last Activity\"]');\r\n  Array.prototype.forEach.call(profileAlliesEnemies, parsePlayerLink);\r\n  // continue with online players\r\n  profilePagesToSearchProcessed += 1;\r\n  if (profilePagesToSearchProcessed ===\r\n    profilePagesToSearch.length) {\r\n    findBuffsParseOnlinePlayersStart();\r\n  }\r\n}\r\n\r\nfunction findBuffsParseProfilePageStart() { // Legacy\r\n  // if option enabled then parse profiles\r\n  profilePagesToSearch = [];\r\n  profilePagesToSearch.push('index.php?cmd=profile'); // ???\r\n  var extraProfileArray = extraProfile.split(',');\r\n  extraProfileArray.forEach(function(el) {\r\n    profilePagesToSearch.push('index.php?cmd=findplayer' + // ???\r\n      '&search_active=1&search_level_max=&search_level_min=' +\r\n      '&search_username=' + el + '&search_show_first=1');\r\n  });\r\n  profilePagesToSearchProcessed = 0;\r\n  if (getElementById('alliesEnemies').checked) {\r\n    profilePagesToSearch.forEach(function(el) {\r\n      retryAjax(el).done(findBuffsParseProfilePage);\r\n    });\r\n  } else {\r\n    findBuffsParseOnlinePlayersStart();\r\n  }\r\n}\r\n\r\nfunction findBuffsParseGuildManagePage(responseText) {\r\n  var doc = createDocument(responseText);\r\n  if (getElementById('guildMembers').checked) {\r\n    var memList = doc.querySelectorAll('#pCC a[data-tipped*=\"<td>VL:</td>\"]');\r\n    Array.prototype.forEach.call(memList, parsePlayerLink);\r\n  }\r\n  // continue with profile pages\r\n  findBuffsParseProfilePageStart();\r\n}\r\n\r\nfunction findBuffsClearResults() { // Legacy\r\n  var buffTable = getElementById('buffTable');\r\n  for (var j = buffTable.rows.length; j > 1; j -= 1) {\r\n    buffTable.deleteRow(j - 1);\r\n  }\r\n  getElementById('buffNicks').innerHTML = '';\r\n  // var bufferProgress = getElementById('bufferProgress');\r\n  bufferProgress.innerHTML = 'Idle.';\r\n  bufferProgress.style.color = 'black';\r\n  getElementById('potentialBuffers').innerHTML = '';\r\n  getElementById('buffersProcessed').innerHTML = 0;\r\n}\r\n\r\nfunction findAnyStart(progMsg) { // jQuery.min // jQuery\r\n  if (jQueryNotPresent()) {return;}\r\n  characterName = playerName();\r\n  getElementById('buffNicks').innerHTML = findBuffNicks;\r\n  bufferProgress = getElementById('bufferProgress');\r\n  bufferProgress.innerHTML = 'Gathering list of ' + progMsg + ' ...';\r\n  bufferProgress.style.color = 'green';\r\n  findBuffsLevel175Only =\r\n    getElementById('level175').checked;\r\n  getElementById('buffersProcessed').innerHTML = 0;\r\n  onlinePlayers = [];\r\n  extraProfile = getElementById('extraProfile').value;\r\n  setValue('extraProfile', extraProfile);\r\n  // get list of players to search, starting with guild>manage page\r\n  retryAjax('index.php?no_mobile=1&cmd=guild&subcmd=manage')\r\n    .done(findBuffsParseGuildManagePage);\r\n}\r\n\r\nfunction findBuffsStart() { // Legacy\r\n  var selectedBuff = parseInt($('#selectedBuff').val(), 10);\r\n  for (var j = 0; j < buffList.length; j += 1) {\r\n    if (selectedBuff === buffList[j].id) {\r\n      findBuffNicks = buffList[j].nicks;\r\n      findBuffMinCastLevel = buffList[j].lvl;\r\n      break;\r\n    }\r\n  }\r\n  findAnyStart('potential buffers');\r\n}\r\n\r\nfunction findOtherStart() { // Legacy\r\n  var textToSearchFor = $('#textToSearchFor').val().replace(/\\s*,\\s*/, ',');\r\n  setValue('textToSearchFor', textToSearchFor);\r\n  findBuffNicks = textToSearchFor;\r\n  findBuffMinCastLevel = 1;\r\n  findAnyStart('profiles to search');\r\n}\r\n\r\nexport function injectFindBuffs(injector) { // Legacy\r\n  var content = injector || pCC;\r\n  calf.sortBy = 'name';\r\n  calf.sortAsc = true;\r\n  buffList.sort(stringSort);\r\n  extraProfile = getValue('extraProfile');\r\n  content.innerHTML = pageLayout(buffCustom, extraProfile);\r\n  getElementById('findbuffsbutton')\r\n    .addEventListener('click', findBuffsStart, true);\r\n  getElementById('clearresultsbutton')\r\n    .addEventListener('click', findBuffsClearResults, true);\r\n}\r\n\r\nexport function injectFindOther(injector) { // Native - Bad\r\n  var content = injector || pCC;\r\n  extraProfile = getValue('extraProfile');\r\n  content.innerHTML = pageLayout(otherCustom, extraProfile);\r\n  getElementById('findbuffsbutton')\r\n    .addEventListener('click', findOtherStart, true);\r\n  getElementById('clearresultsbutton')\r\n    .addEventListener('click', findBuffsClearResults, true);\r\n}\r\n","import {createDiv} from '../common/cElement';\r\nimport draggable from '../common/dragStart';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport {imageServer} from '../system/system';\r\nimport injectBuffLog from '../buffLog/injectBuffLog';\r\nimport {injectFsBoxContent} from '../misc';\r\nimport injectMonsterLog from '../monstorLog';\r\nimport injectNotepadShowLogs from '../combatLog';\r\nimport injectOnlinePlayers from '../onlinePlayers';\r\nimport injectRecipeManager from '../recipeMgr/recipeMgr';\r\nimport insertQuickExtract from '../quickExtract';\r\nimport insertQuickWear from '../quickWear/quickWear';\r\nimport jQueryDialog from './jQueryDialog';\r\nimport {sendEvent} from '../support/fshGa';\r\nimport {injectAuctionSearch, injectQuickLinkManager} from '../lists/lists';\r\nimport {injectFindBuffs, injectFindOther} from '../findBuffs/findBuffs';\r\n\r\nvar helperMenuBlob =\r\n  '<div class=\"column\"><h3>Character</h3><ul>' +\r\n  '<li><span class=\"fshLink\">Buff Log</span></li>' +\r\n  '<li><span class=\"fshLink\">Combat Log</span></li>' +\r\n  '<li><span class=\"fshLink\">Creature Log</span></li>' +\r\n  '<li><span class=\"fshLink\">Recipe Manager</span></li>' +\r\n  '<li><span class=\"fshLink\">Quick Links</span></li>' +\r\n  '</ul><h3>Actions</h3><ul>' +\r\n  '<li><span class=\"fshLink\">Find Buffs</span></li>' +\r\n  '<li><span class=\"fshLink\">Find Other</span></li>' +\r\n  '<li><span class=\"fshLink\">Online Players</span></li>' +\r\n  '<li><span class=\"fshLink\">AH Quick Search</span></li>' +\r\n  '</ul><h3>Extra</h3><ul>' +\r\n  '<li><span class=\"fshLink\">Quick Extract</span></li>' +\r\n  '<li><span class=\"fshLink\">Quick Wear</span></li>' +\r\n  '<li><span class=\"fshLink\">FS Box Log</span></li>' +\r\n  '</ul><h3>FSH developer quick links</h3><ul>' +\r\n  '<li><span class=\"a-reply\" target_player=\"PointyHair\">PM</span> ' +\r\n  '<a href=\"index.php?cmd=profile&player_id=1963510\">PointyHair</a></li>' +\r\n  '<li><span class=\"a-reply\" target_player=\"yuuzhan\">PM</span> ' +\r\n  '<a href=\"index.php?cmd=profile&player_id=1599987\">yuuzhan</a></li>' +\r\n  '</ul></div>';\r\n\r\nvar functionLookup = {\r\n  'Buff Log': injectBuffLog,\r\n  'Combat Log': injectNotepadShowLogs,\r\n  'Creature Log': injectMonsterLog,\r\n  'Recipe Manager': injectRecipeManager,\r\n  'Quick Links': injectQuickLinkManager,\r\n  'Find Buffs': injectFindBuffs,\r\n  'Find Other': injectFindOther,\r\n  'Online Players': injectOnlinePlayers,\r\n  'AH Quick Search': injectAuctionSearch,\r\n  'Quick Extract': insertQuickExtract,\r\n  'Quick Wear': insertQuickWear,\r\n  'FS Box Log': injectFsBoxContent\r\n};\r\n\r\nfunction callHelperFunction(evt) {\r\n  var functionPath = evt.target.textContent;\r\n  var fn = functionLookup[functionPath];\r\n  if ($ && typeof fn === 'function') {\r\n    sendEvent('helperMenu', functionPath);\r\n    jQueryDialog(fn);\r\n  }\r\n}\r\n\r\nfunction eventHandler(evt) {\r\n  if (evt.target.classList.contains('fshLink')) {\r\n    callHelperFunction(evt);\r\n    return;\r\n  }\r\n  if (evt.target.classList.contains('a-reply')) {\r\n    window.openQuickMsgDialog(evt.target.getAttribute('target_player'));\r\n  }\r\n}\r\n\r\nfunction showHelperMenu() {\r\n  var helperMenu = getElementById('helperMenu');\r\n  helperMenu.removeEventListener('mouseenter', showHelperMenu);\r\n\r\n  var helperMenuDiv = createDiv({\r\n    id: 'helperMenuDiv',\r\n    className: 'helperMenuDiv',\r\n    style: {\r\n      backgroundImage: 'url(' + imageServer +\r\n        '/skin/inner_bg.jpg)'\r\n    }\r\n  });\r\n  helperMenuDiv.insertAdjacentHTML('beforeend', helperMenuBlob);\r\n  helperMenu.appendChild(helperMenuDiv);\r\n  helperMenu.addEventListener('click', function(evt) {\r\n    if (evt.target.id !== 'helperMenu') {return;}\r\n    var menu = evt.target.firstElementChild;\r\n    menu.classList.toggle('showMenuDiv');\r\n  });\r\n  helperMenuDiv.addEventListener('click', eventHandler);\r\n}\r\n\r\nfunction haveNode(node) {\r\n  var helperMenu = createDiv({\r\n    id: 'helperMenu',\r\n    className: 'helperMenu',\r\n    innerHTML: 'Helper&nbsp;Menu'\r\n  });\r\n  if (getValue('keepHelperMenuOnScreen')) {\r\n    helperMenu.classList.add('fshFixed');\r\n  }\r\n  helperMenu.addEventListener('mouseenter', showHelperMenu);\r\n  if (getValue('draggableHelperMenu')) {\r\n    helperMenu.classList.add('fshMove');\r\n    draggable(helperMenu);\r\n  }\r\n  node.parentNode.insertBefore(helperMenu, node);\r\n}\r\n\r\nexport default function injectHelperMenu() {\r\n  // don't put all the menu code here (but call if clicked) to minimize lag\r\n  var node = getElementById('statbar-container');\r\n  if (node) {haveNode(node);}\r\n}\r\n","import currentGuildId from '../common/currentGuildId';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport injectBuffLog from '../buffLog/injectBuffLog';\r\nimport injectMonsterLog from '../monstorLog';\r\nimport injectNotepadShowLogs from '../combatLog';\r\nimport injectOnlinePlayers from '../onlinePlayers';\r\nimport injectRecipeManager from '../recipeMgr/recipeMgr';\r\nimport insertElementAfter from '../common/insertElementAfter';\r\nimport jQueryDialog from './jQueryDialog';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {newGuildLogUrl} from '../support/dataObj';\r\nimport {createAnchor, createLi} from '../common/cElement';\r\nimport {injectAuctionSearch, injectQuickLinkManager} from '../lists/lists';\r\nimport {injectFindBuffs, injectFindOther} from '../findBuffs/findBuffs';\r\nimport {sendEvent, sendException} from '../support/fshGa';\r\n\r\nvar guildId;\r\n\r\nfunction updateQuestLink() {\r\n  var lastActiveQuestPage = getValue('lastActiveQuestPage');\r\n  if (lastActiveQuestPage.length > 0) {\r\n    getElementById('nav-character-questbook')\r\n      .setAttribute('href', lastActiveQuestPage);\r\n  }\r\n}\r\n\r\nfunction insertAdjElement(parent, listItem) {\r\n  insertElementAfter(listItem, parent);\r\n}\r\n\r\nfunction insertAdjHtml(parent, listItem) {\r\n  parent.insertAdjacentHTML('afterend', listItem);\r\n}\r\n\r\nfunction insertAfterParent(target, fn, listItem) {\r\n  var tgt = getElementById(target);\r\n  if (tgt instanceof Node) {\r\n    var parent = tgt.parentNode;\r\n    fn(parent, listItem);\r\n  } else {sendException('#' + target + ' is not a Node', false);}\r\n}\r\n\r\nfunction anchorButton(navLvl, text, fn, target) {\r\n  var li = createLi({className: 'nav-level-' + navLvl});\r\n  var al = createAnchor({\r\n    className: 'nav-link fshPoint',\r\n    textContent: text\r\n  });\r\n  al.addEventListener('click', function() {\r\n    sendEvent('accordion', text);\r\n    jQueryDialog(fn);\r\n  });\r\n  li.appendChild(al);\r\n  insertAfterParent(target, insertAdjElement, li);\r\n}\r\n\r\nfunction buffLogLink() {\r\n  if (getValue('keepBuffLog')) {\r\n    anchorButton('1', 'Buff Log', injectBuffLog, 'nav-character-log');\r\n  }\r\n}\r\n\r\nfunction combatLogLink() {\r\n  if (getValue('keepLogs')) {\r\n    anchorButton('1', 'Combat Logs', injectNotepadShowLogs,\r\n      'nav-character-notepad');\r\n  }\r\n}\r\n\r\nfunction creatureLogLink() {\r\n  if (getValue('showMonsterLog')) {\r\n    anchorButton('1', 'Creature Logs', injectMonsterLog,\r\n      'nav-character-notepad');\r\n  }\r\n}\r\n\r\nfunction newGuildLogLink() {\r\n  if (guildId && !getValue('useNewGuildLog')) {\r\n    // if not using the new guild log, show it as a separate menu entry\r\n    insertAfterParent('nav-guild-ledger-guildlog', insertAdjHtml,\r\n      '<li class=\"nav-level-2\"><a class=\"nav-link\" ' +\r\n      'href=\"index.php' + newGuildLogUrl + '\"' +\r\n      '>New Guild Log</a></li>');\r\n  }\r\n}\r\n\r\nfunction guildInventory() {\r\n  if (guildId) {\r\n    insertAfterParent('nav-guild-storehouse-inventory', insertAdjHtml,\r\n      '<li class=\"nav-level-2\"><a class=\"nav-link\" id=\"nav-' +\r\n      'guild-guildinvmanager\" href=\"index.php?cmd=notepad&blank=1' +\r\n      '&subcmd=guildinvmgr\">Guild Inventory</a></li>');\r\n  }\r\n}\r\n\r\nfunction navHeightsIsArray(theNav, myNav) {\r\n  // first the closed saved variables\r\n  myNav.heights = [\r\n    null,\r\n    null,\r\n    // Character\r\n    getElementById('nav-character').nextElementSibling.children\r\n      .length * 22,\r\n    660,\r\n    // Guild\r\n    document.querySelectorAll('#nav-guild > ul li').length * 22,\r\n    374,\r\n    132,\r\n    132,\r\n    null\r\n  ];\r\n  if (myNav.state !== '-1' && myNav.state !== -1) {\r\n    // and now the open one\r\n    theNav.children[myNav.state].children[1].style.height =\r\n      myNav.heights[myNav.state] + 'px';\r\n  }\r\n}\r\n\r\nfunction navHeightExists(theNav, myNav) {\r\n  if (Array.isArray(myNav.heights)) {\r\n    navHeightsIsArray(theNav, myNav);\r\n  } else {\r\n    sendException('$(\\'#nav\\').data(\\'nav\\').heights is not an Array', false);\r\n  }\r\n}\r\n\r\nfunction navDataExists(theNav, myNav) {\r\n  if ('heights' in myNav) {\r\n    navHeightExists(theNav, myNav);\r\n  } else {\r\n    sendException('$(\\'#nav\\').data(\\'nav\\').heights does not exist', false);\r\n  }\r\n}\r\n\r\nfunction navExists(theNav) { // jQuery\r\n  var myNav = $(theNav).data('nav');\r\n  if (typeof myNav === 'object') {\r\n    navDataExists(theNav, myNav);\r\n  } else {\r\n    sendException('$(\\'#nav\\').data(\\'nav\\') is not an object', false);\r\n  }\r\n}\r\n\r\nfunction adjustHeight() {\r\n  // adjust the menu height for the newly added items\r\n  var theNav = getElementById('nav');\r\n  if (theNav instanceof Element) {\r\n    navExists(theNav);\r\n  } else {\r\n    sendException('#nav is not an Element', false);\r\n  }\r\n}\r\n\r\nexport default function injectMenu() {\r\n  if (!getElementById('pCL') || jQueryNotPresent()) {return;}\r\n  guildId = currentGuildId();\r\n  updateQuestLink();\r\n  // character\r\n  anchorButton('1', 'Recipe Manager', injectRecipeManager, 'nav-character-log');\r\n  insertAfterParent('nav-character-log', insertAdjHtml,\r\n    '<li class=\"nav-level-1\"><a class=\"nav-link\" id=\"nav-' +\r\n    'character-medalguide\" href=\"index.php?cmd=profile&subcmd=' +\r\n    'medalguide\">Medal Guide</a></li>' +\r\n    '<li class=\"nav-level-1\"><a class=\"nav-link\" id=\"nav-' +\r\n    'character-invmanager\" href=\"index.php?cmd=notepad&blank=1&' +\r\n    'subcmd=invmanagernew\">Inventory Manager</a></li>');\r\n  buffLogLink();\r\n  combatLogLink();\r\n  creatureLogLink();\r\n  anchorButton('1', 'Quick Links', injectQuickLinkManager,\r\n    'nav-character-notepad');\r\n  // guild\r\n  guildInventory();\r\n  newGuildLogLink();\r\n  // top rated\r\n  insertAfterParent('nav-toprated-players-level', insertAdjHtml,\r\n    '<li class=\"nav-level-2\"><a class=\"nav-link\" id=\"nav-' +\r\n    'toprated-top250\" href=\"index.php?cmd=toprated&subcmd=xp\">' +\r\n    'Top 250 Players</a></li>');\r\n  // actions\r\n  anchorButton('2', 'AH Quick Search', injectAuctionSearch,\r\n    'nav-actions-trade-auctionhouse');\r\n  anchorButton('2', 'Online Players', injectOnlinePlayers,\r\n    'nav-actions-interaction-findplayer');\r\n  anchorButton('2', 'Find Other', injectFindOther,\r\n    'nav-actions-interaction-findplayer');\r\n  anchorButton('2', 'Find Buffs', injectFindBuffs,\r\n    'nav-actions-interaction-findplayer');\r\n  adjustHeight();\r\n}\r\n","import fallback from '../system/fallback';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport getValueJSON from '../system/getValueJSON';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport setValueJSON from '../system/setValueJSON';\r\n\r\nvar enterForSendMessage;\r\nvar fshTemplate;\r\nvar sendMessage;\r\n\r\nfunction showMsgTemplate() { // jQuery\r\n  var targetPlayer = $('#quickMsgDialog_targetUsername').text();\r\n  $('#msgTemplateDialog').remove();\r\n\r\n  // template displayed\r\n  var html = '<div id=msgTemplateDialog title=\"Choose Msg Template\" ' +\r\n    'style=\"display:none\"><style>#msgTemplate .ui-selecting { ' +\r\n    'background: #FECA40; };</style><ol id=msgTemplate valign=center>';\r\n  for (var i = 0; i < fshTemplate.length; i += 1) {\r\n    html += '<li class=\"ui-widget-content\">' +\r\n      fshTemplate[i].replace(/\\{playername\\}/g, targetPlayer) + '</li>';\r\n  }\r\n  html += '</ol></div>';\r\n  $('body').append(html);\r\n\r\n  // template manager\r\n  $('#msgTemplate li').prepend('<input type=button class=\"del-button\" ' +\r\n    'value=Del style=\"display:none\">');\r\n  $('#msgTemplate').append('<li class=\"add-button\" style=\"display:none\">' +\r\n    '<input type=button id=newTmplAdd value=Add><input id=newTmpl ' +\r\n    'class=ui-widget-content></li>');\r\n  $(':button', '#msgTemplate').button();\r\n  $('.del-button').click(function(evt) {\r\n    fshTemplate.splice($('#msgTemplate li')\r\n      .index(evt.target.parentNode), 1);\r\n    setValueJSON('quickMsg', fshTemplate);\r\n    $('#msgTemplateDialog').dialog('close');\r\n    showMsgTemplate();\r\n  });\r\n  $('#newTmplAdd').click(function() {\r\n    if ($('#newTmpl').val() === '') {return;}\r\n    fshTemplate.push($('#newTmpl').val());\r\n    setValueJSON('quickMsg', fshTemplate);\r\n    $('#msgTemplateDialog').dialog('close');\r\n    showMsgTemplate();\r\n  });\r\n\r\n  // enable selectable template\r\n  $('#msgTemplate').selectable({\r\n    filter: 'li.ui-widget-content',\r\n    stop: function() {\r\n      if ($('.add-button.ui-selected').length > 0) {return;} // click on add row\r\n      if ($('.ui-selected').length === 0) {return;} // nothing selected yet\r\n      $('#quickMsgDialog_msg').val($('#quickMsgDialog_msg').val() +\r\n        $('#msgTemplate .ui-selected').text() + '\\n');\r\n      $('#msgTemplateDialog').dialog('close');\r\n    }\r\n  });\r\n\r\n  // show the template form\r\n  $('#msgTemplateDialog').dialog({\r\n    buttons: {\r\n      Manage: function() {\r\n        $('.del-button').toggle();\r\n        $('.add-button').toggle();\r\n      },\r\n      Cancel: function() {\r\n        $('#msgTemplateDialog').dialog('close');\r\n        $('#msgTemplateDialog').remove();\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\nfunction keypress(evt) {\r\n  if (evt.code === 'Enter' && !evt.shiftKey) {\r\n    evt.preventDefault();\r\n    sendMessage();\r\n  }\r\n}\r\n\r\nfunction captureEnter() {\r\n  if (enterForSendMessage) {\r\n    getElementById('quickMsgDialog_msg')\r\n      .addEventListener('keypress', keypress);\r\n  }\r\n}\r\n\r\nfunction openQuickMsgDialog(name, msg, tip) { // jQuery\r\n  if (!fshTemplate) {\r\n    fshTemplate = getValueJSON('quickMsg');\r\n    var buttons = $('#quickMessageDialog').dialog('option', 'buttons');\r\n    sendMessage = buttons['Send Message'];\r\n    buttons.Template = showMsgTemplate;\r\n    $('#quickMessageDialog').dialog('option', 'buttons', buttons);\r\n  }\r\n  $('#quickMsgDialog_targetUsername').html(name);\r\n  $('#quickMsgDialog_targetPlayer').val(name);\r\n  $('#quickMsgDialog_msg').val(fallback(msg, ''));\r\n  $('#quickMsgDialog_msg').removeAttr('disabled');\r\n  captureEnter();\r\n  $('.validateTips').text(fallback(tip, ''));\r\n  $('#quickMessageDialog').dialog('open');\r\n}\r\n\r\nexport default function injectQuickMsgDialogJQ() {\r\n  if (jQueryNotPresent()) {return;}\r\n  enterForSendMessage = getValue('enterForSendMessage');\r\n  window.openQuickMsgDialog = openQuickMsgDialog;\r\n}\r\n","import {months} from '../support/dataObj';\r\n\r\nexport default function parseDateAsTimestamp(textDate) {\r\n  var dateAry = textDate.split(/[: /[]/);\r\n  return Date.UTC(Number(dateAry[4]), months.indexOf(dateAry[3]),\r\n    Number(dateAry[2]), Number(dateAry[0]), Number(dateAry[1]), 0);\r\n}\r\n","import {createAnchor} from '../common/cElement';\r\nimport getValue from '../system/getValue';\r\nimport {guideUrl} from '../support/dataObj';\r\nimport {pCC} from '../support/layout';\r\nimport parseDateAsTimestamp from '../system/parseDateAsTimestamp';\r\nimport setValue from '../system/setValue';\r\n\r\nfunction containsNewsHead(el) {\r\n  return el.classList.contains('news_head') ||\r\n    el.classList.contains('news_head_tavern');\r\n}\r\n\r\nfunction closestHead(el) {\r\n  if (containsNewsHead(el)) {\r\n    return el;\r\n  }\r\n  if (el.classList.contains('news_left_column')) {return;}\r\n  return closestHead(el.parentNode);\r\n}\r\n\r\nfunction getNewsClass(newsHead) {\r\n  if (newsHead.classList.contains('news_head_tavern')) {\r\n    return '.news_body_tavern';\r\n  }\r\n  return '.news_body';\r\n}\r\n\r\nfunction gotNewsHead(evt, newsHead) { // jQuery\r\n  var newsBody = newsHead.nextElementSibling;\r\n  var newsClass = getNewsClass(newsHead);\r\n  if (!$(newsBody).data('open')) {\r\n    evt.preventDefault();\r\n    $(newsClass).hide().data('open', false);\r\n    $(newsBody).show().data('open', true);\r\n  } else if (evt.target.tagName !== 'A') {\r\n    $(newsBody).hide().data('open', false);\r\n  }\r\n  evt.stopPropagation();\r\n}\r\n\r\nfunction newsEvt(evt) {\r\n  var newsHead = closestHead(evt.target);\r\n  if (newsHead) {gotNewsHead(evt, newsHead);}\r\n}\r\n\r\nfunction fixCollapse() {\r\n  var newsCol = document.getElementsByClassName('news_left_column');\r\n  if (!$ || newsCol.length !== 1) {return;}\r\n  newsCol[0].addEventListener('click', newsEvt, true);\r\n}\r\n\r\nfunction lookForPvPLadder() {\r\n  var lastLadderReset = getValue('lastLadderReset');\r\n  var rumours = pCC.getElementsByClassName('news_head_tavern');\r\n  Array.prototype.forEach.call(rumours, function(head) {\r\n    if (head.children[1].textContent === 'PvP Ladder') {\r\n      var logTime = parseDateAsTimestamp(head.children[2].textContent);\r\n      if (logTime > lastLadderReset) {\r\n        setValue('lastLadderReset', logTime);\r\n        lastLadderReset = logTime;\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\nfunction addUfsgLinks() {\r\n  var imgs = document.querySelectorAll(\r\n    '.news_body img[src^=\"https://cdn.fallensword.com/creatures/\"]');\r\n  Array.prototype.forEach.call(imgs, function(img) {\r\n    var myName = encodeURIComponent(img.getAttribute('oldtitle'));\r\n    var myLink = createAnchor({\r\n      href: guideUrl + 'creatures&search_name=' + myName,\r\n      target: '_blank'\r\n    });\r\n    img.parentNode.insertBefore(myLink, img);\r\n    myLink.appendChild(img);\r\n  });\r\n}\r\n\r\nexport default function injectHomePageTwoLink() { // Pref\r\n  var archiveLink = document.querySelector(\r\n    '#pCC a[href=\"index.php?cmd=&subcmd=viewupdatearchive\"]');\r\n  if (!archiveLink) {return;}\r\n  archiveLink.insertAdjacentHTML('afterend', '&nbsp;<a href=\"index.php?cmd=' +\r\n    '&subcmd=viewupdatearchive&subcmd2=&page=2&search_text=\">' +\r\n    'View Updates Page 2</a>');\r\n  archiveLink = document.querySelector(\r\n    '#pCC a[href=\"index.php?cmd=&subcmd=viewarchive\"]');\r\n  archiveLink.insertAdjacentHTML('afterend', '&nbsp;<a href=\"index.php?cmd=' +\r\n    '&subcmd=viewarchive&subcmd2=&page=2&search_text=\">View News Page 2</a>');\r\n  fixCollapse(); // Pref\r\n  lookForPvPLadder(); // Pref\r\n  addUfsgLinks(); // Pref\r\n}\r\n","import {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\n\r\nfunction findNewGroup(el) {\r\n  if (el.textContent.indexOf('New attack group created.') === -1) {return;}\r\n  var groupJoinHTML = '';\r\n  if (!getValue('enableMaxGroupSizeToJoin')) {\r\n    groupJoinHTML = '<a href=\"index.php?cmd=guild&subcmd=groups&' +\r\n      'subcmd2=joinall\"><span class=\"notification-icon\"></span>' +\r\n      '<p class=\"notification-content\">Join all attack groups.</p></a>';\r\n  } else {\r\n    var maxGroupSizeToJoin = getValue('maxGroupSizeToJoin');\r\n    groupJoinHTML = '<a href=\"index.php?cmd=guild&subcmd=groups&' +\r\n      'subcmd2=joinallgroupsundersize\"><span class=\"notification-icon\">' +\r\n      '</span><p class=\"notification-content\">Join all attack groups ' +\r\n      'less than size ' + maxGroupSizeToJoin + '.</p></a>';\r\n  }\r\n  el.insertAdjacentHTML('afterend',\r\n    '<li class=\"notification\">' + groupJoinHTML + '</li>');\r\n}\r\n\r\nexport default function injectJoinAllLink() {\r\n  var nodeList = getElementById('pCL').getElementsByTagName('li');\r\n  Array.prototype.forEach.call(nodeList, findNewGroup);\r\n}\r\n","export default function insertElementAfter(newNode, referenceNode) {\r\n  if (referenceNode instanceof Node &&\r\n      referenceNode.parentNode instanceof Node) {\r\n    return referenceNode.parentNode.insertBefore(newNode,\r\n      referenceNode.nextSibling);\r\n  }\r\n}\r\n","import {createDiv} from '../common/cElement';\r\nimport {getElementById} from '../common/getElement';\r\nimport insertElement from '../common/insertElement';\r\nimport toggleForce from '../common/toggleForce';\r\n\r\nfunction doServerNode(topbannerStats, miniboxList) {\r\n  var nodeName = miniboxList.children[7].textContent;\r\n  var serverDiv = createDiv({\r\n    className: 'tip-static',\r\n    dataset: {tipped: 'Server'},\r\n    textContent: 'Server: ' + nodeName\r\n  });\r\n  insertElement(topbannerStats, serverDiv);\r\n}\r\n\r\nfunction doOnlinePlayers(topbannerStats, miniboxList) {\r\n  var playersOnline = miniboxList.children[3].innerHTML;\r\n  var bannerPlayers = topbannerStats.children[0];\r\n  bannerPlayers.innerHTML = 'Online: ' + playersOnline;\r\n}\r\n\r\nfunction statBoxesExist(topbannerStats, gameStats) {\r\n  var miniboxList = gameStats.nextElementSibling.children[0];\r\n  if (miniboxList.children.length === 8) {\r\n    doServerNode(topbannerStats, miniboxList);\r\n    doOnlinePlayers(topbannerStats, miniboxList);\r\n    toggleForce(gameStats.parentNode, true);\r\n  }\r\n}\r\n\r\nfunction validStatBoxes(topbannerStats, gameStats) {\r\n  var hidden = topbannerStats.classList.contains('topbanner-stats-hidden');\r\n  return topbannerStats && !hidden && gameStats;\r\n}\r\n\r\nexport default function injectServerNode() {\r\n  var topbannerStats = getElementById('topbanner-stats');\r\n  var h3coll = document.querySelectorAll('#pCR h3');\r\n  var gameStats = Array.prototype.find.call(h3coll, function(el) {\r\n    return el.textContent === 'Game Stats';\r\n  });\r\n  if (validStatBoxes(topbannerStats, gameStats)) {\r\n    statBoxesExist(topbannerStats, gameStats);\r\n  }\r\n}\r\n","import {getElementById} from '../common/getElement';\r\nimport {imageServer} from '../system/system';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport setValue from '../system/setValue';\r\n\r\nvar havePrayedMsg =\r\n  '<span class=\"notification-icon\"></span><p class=\"notification-content\">' +\r\n  'You are currently praying at the temple.</p>';\r\nvar godsNotification =\r\n  '<li class=\"notification\">' +\r\n  '<span id=\"helperPrayToGods\" class=\"fastPray\">' +\r\n  '<table><tbody><tr><td>' +\r\n  '<span class=\"tip-static\" data-tipped=\"Pray to Sahria\" ' +\r\n  'style=\"background-image: url(\\'' + imageServer +\r\n  '/temple/0.gif\\');\" praytype=\"0\"></span></td><td>' +\r\n  '<span class=\"tip-static\" data-tipped=\"Pray to Osverin\" ' +\r\n  'style=\"background-image: url(\\'' + imageServer +\r\n  '/temple/1.gif\\');\" praytype=\"1\"></span></td></tr><tr><td>' +\r\n  '<span class=\"tip-static\" data-tipped=\"Pray to Gurgriss\" ' +\r\n  'style=\"background-image: url(\\'' + imageServer +\r\n  '/temple/2.gif\\');\" praytype=\"2\"></span></td><td>' +\r\n  '<span class=\"tip-static\" data-tipped=\"Pray to Lindarsil\" ' +\r\n  'style=\"background-image: url(\\'' + imageServer +\r\n  '/temple/3.gif\\');\" praytype=\"3\"></span></td></tr></tbody></table>' +\r\n  '<a href=\"index.php?cmd=temple\">' +\r\n  '<p class=\"notification-content\">Bow down to the gods</p>' +\r\n  '</a></span></li>';\r\n\r\nfunction havePrayed() {\r\n  getElementById('helperPrayToGods').outerHTML = havePrayedMsg;\r\n  setValue('needToPray', false);\r\n  setValue('lastTempleCheck', new Date()\r\n    .setUTCHours(23, 59, 59, 999) + 1); // Midnight\r\n}\r\n\r\nfunction prayToGods(e) { // jQuery\r\n  var myGod = e.target.getAttribute('praytype');\r\n  if (!myGod) {return;}\r\n  getElementById('helperPrayToGods').removeEventListener('click',\r\n    prayToGods);\r\n  retryAjax('index.php?no_mobile=1&cmd=temple&subcmd=pray&type=' + myGod)\r\n    .done(havePrayed);\r\n  $(e.target).qtip('hide');\r\n}\r\n\r\nexport default function displayDisconnectedFromGodsMessage() {\r\n  getElementById('notifications').insertAdjacentHTML('afterbegin',\r\n    godsNotification);\r\n  getElementById('helperPrayToGods').addEventListener('click',\r\n    prayToGods);\r\n}\r\n","import calf from '../support/calf';\r\nimport createDocument from '../system/createDocument';\r\nimport displayDisconnectedFromGodsMessage\r\n  from './displayDisconnectedFromGodsMessage';\r\nimport setValue from '../system/setValue';\r\n\r\nfunction templeAlertEnabled(responseText) {\r\n  var checkNeedToPray;\r\n  var doc;\r\n  if (calf.cmd !== 'temple') {\r\n    doc = createDocument(responseText);\r\n  } else {\r\n    doc = document;\r\n  }\r\n  checkNeedToPray = doc.querySelector('input[value=\"Pray to Osverin\"]');\r\n  var needToPray = false;\r\n  if (checkNeedToPray) {\r\n    displayDisconnectedFromGodsMessage();\r\n    needToPray = true;\r\n  }\r\n  setValue('needToPray', needToPray);\r\n  setValue('lastTempleCheck', new Date()\r\n    .setUTCHours(23, 59, 59, 999) + 1); // midnight\r\n}\r\n\r\nexport function parseTemplePage(responseText) {\r\n  if (calf.enableTempleAlert) {templeAlertEnabled(responseText);}\r\n}\r\n","import calf from '../support/calf';\r\nimport displayDisconnectedFromGodsMessage\r\n  from './displayDisconnectedFromGodsMessage';\r\nimport getValue from '../system/getValue';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {now} from '../support/dataObj';\r\nimport {parseTemplePage} from './parseTemplePage';\r\nimport retryAjax from '../ajax/retryAjax';\r\n\r\nfunction checkLastUpdate(templeAlertLastUpdate) {\r\n  return !templeAlertLastUpdate || now > templeAlertLastUpdate;\r\n}\r\n\r\nfunction doWeNeedToParse() {\r\n  if (checkLastUpdate(getValue('lastTempleCheck'))) {\r\n    retryAjax('index.php?no_mobile=1&cmd=temple').done(parseTemplePage);\r\n  } else if (getValue('needToPray')) {\r\n    displayDisconnectedFromGodsMessage();\r\n  }\r\n}\r\n\r\nexport default function injectTempleAlert() { // jQuery\r\n  // Checks to see if the temple is open for business.\r\n  if (calf.cmd === 'temple' || jQueryNotPresent()) {return;}\r\n  doWeNeedToParse();\r\n}\r\n","import {getElementById} from '../common/getElement';\r\n\r\nvar goldUpgradeMsg =\r\n'<li class=\"notification\"><a href=\"index.php?cmd=points&type=1\"><span' +\r\n' class=\"notification-icon\"></span><p class=\"notification-content\">Up' +\r\n'grade stamina with gold</p></a></li>';\r\n\r\nexport default function displayUpgradeMsg() {\r\n  if (location.search.indexOf('cmd=points&type=1') === -1) {\r\n    getElementById('notifications').insertAdjacentHTML('afterbegin',\r\n      goldUpgradeMsg);\r\n  }\r\n}\r\n","import calf from '../support/calf';\r\nimport createDocument from '../system/createDocument';\r\nimport displayUpgradeMsg from './displayUpgradeMsg';\r\nimport setValue from '../system/setValue';\r\n\r\nfunction findDoc(data) {\r\n  if (location.search.indexOf('cmd=points&type=1') === -1) {\r\n    return createDocument(data);\r\n  }\r\n  document.querySelectorAll('#pCC input[name=\"quantity\"]')[1].value = '10';\r\n  return document;\r\n}\r\n\r\nfunction checkUpgrade(limit) {\r\n  var checkDoneUpgrade = limit.textContent.split(' / ');\r\n  if (checkDoneUpgrade[0] !== checkDoneUpgrade[1]) {\r\n    displayUpgradeMsg();\r\n    setValue('needToDoUpgrade', true);\r\n  } else {\r\n    setValue('needToDoUpgrade', false);\r\n    setValue('lastUpgradeCheck',\r\n      Date.parse(limit.nextElementSibling.textContent + ' GMT'));\r\n  }\r\n}\r\n\r\nexport default function parseGoldUpgrades(data) {\r\n  if (!calf.enableUpgradeAlert) {return;}\r\n  var doc = findDoc(data);\r\n  var tables = doc.querySelectorAll('#pCC > table');\r\n  if (tables.length > 0) {\r\n    var limit = tables[tables.length - 1].rows[3].cells[2];\r\n    checkUpgrade(limit);\r\n  }\r\n}\r\n","import add from '../support/task';\r\nimport displayUpgradeMsg from './displayUpgradeMsg';\r\nimport getValue from '../system/getValue';\r\nimport {now} from '../support/dataObj';\r\nimport parseGoldUpgrades from './parseGoldUpgrades';\r\nimport retryAjax from '../ajax/retryAjax';\r\n\r\nfunction checkLastUpgrade() {\r\n  var lastUpgradeCheck = getValue('lastUpgradeCheck');\r\n  if (lastUpgradeCheck && now < lastUpgradeCheck) {return;}\r\n  retryAjax('index.php?no_mobile=1&cmd=points&type=1').done(function(data) {\r\n    add(3, parseGoldUpgrades, [data]);\r\n  });\r\n}\r\n\r\nfunction notUpgradesPage() {\r\n  if (getValue('needToDoUpgrade')) {\r\n    displayUpgradeMsg();\r\n    return;\r\n  }\r\n  checkLastUpgrade();\r\n}\r\n\r\nexport default function injectUpgradeAlert() { // jQuery\r\n  if ($ && location.search.indexOf('cmd=points&type=1') === -1) {\r\n    notUpgradesPage();\r\n  }\r\n}\r\n","import jQueryNotPresent from '../common/jQueryNotPresent';\r\n\r\nexport default function navMenu() { // jQuery\r\n  if (jQueryNotPresent()) {return;}\r\n  var myNav = $('#nav').data('nav');\r\n  if (!myNav) {return;}\r\n  var oldSave = myNav._saveState;\r\n  myNav._saveState = function(_id) {\r\n    var id = _id;\r\n    var myHeight = $('li.nav-level-0', '#nav').eq(id).find('ul').height();\r\n    if (myHeight === 0) {id = -1;}\r\n    oldSave.call(myNav, id);\r\n  };\r\n}\r\n","export default function outputFormat(value, suffix) {\r\n  if (value === 0) {return '';}\r\n  return value.toString() + suffix;\r\n}\r\n","import {nowSecs} from '../support/dataObj';\r\nimport outputFormat from './outputFormat';\r\n\r\nexport default function formatLastActivity(last_login) {\r\n  var s = Math.abs(nowSecs - last_login);\r\n  var m = Math.floor(s / 60);\r\n  s %= 60;\r\n  var h = Math.floor(m / 60);\r\n  m %= 60;\r\n  var d = Math.floor(h / 24);\r\n  h %= 24;\r\n  return outputFormat(d, ' days, ') + outputFormat(h, ' hours, ') +\r\n    outputFormat(m, ' mins, ') + s + ' secs';\r\n}\r\n","import retryAjax from './retryAjax';\r\n\r\nexport default function getProfile(username) {\r\n  return retryAjax({\r\n    url: 'index.php',\r\n    data: {\r\n      cmd: 'export',\r\n      subcmd: 'profile',\r\n      player_username: username\r\n    },\r\n    dataType: 'json'\r\n  });\r\n}\r\n","import calf from '../support/calf';\r\nimport getForage from './getForage';\r\nimport getProfile from './getProfile';\r\nimport {now} from '../support/dataObj';\r\nimport {playerName} from '../support/layout';\r\nimport setForage from './setForage';\r\n\r\nfunction sendMyProfileToForage(data) {\r\n  setForage('fsh_selfProfile', data);\r\n}\r\n\r\nfunction addLastUpdateDate(data) {\r\n  data.lastUpdate = now;\r\n  return data;\r\n}\r\n\r\nfunction getMyProfile() {\r\n  return getProfile(playerName())\r\n    .pipe(addLastUpdateDate)\r\n    .done(sendMyProfileToForage);\r\n}\r\n\r\nfunction getProfileFromForage(data) {\r\n  if (!data || data.lastUpdate < now -\r\n    calf.allyEnemyOnlineRefreshTime) {\r\n    return getMyProfile();\r\n  }\r\n  return data;\r\n}\r\n\r\nexport default function myStats(force) {\r\n  if (force) {return getMyProfile();}\r\n  // jQuery 1.7 uses pipe instead of then\r\n  return getForage('fsh_selfProfile')\r\n    .pipe(getProfileFromForage);\r\n}\r\n","export default function openQuickBuffByName(aPlayerName) {\r\n  window.openWindow('index.php?cmd=quickbuff&t=' + aPlayerName,\r\n    'fsQuickBuff', 618, 1000, ',scrollbars');\r\n}\r\n","import add from '../support/task';\r\nimport afterBegin from '../common/afterBegin';\r\nimport calf from '../support/calf';\r\nimport {createDiv} from '../common/cElement';\r\nimport fallback from '../system/fallback';\r\nimport formatLastActivity from '../system/formatLastActivity';\r\nimport {getElementById} from '../common/getElement';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport myStats from '../ajax/myStats';\r\nimport {nowSecs} from '../support/dataObj';\r\nimport openQuickBuffByName from '../common/openQuickBuffByName';\r\nimport {pCR} from '../support/layout';\r\n\r\nvar buffCheck = '<span class=\"enemy-buff-check-on\"></span>';\r\nvar msgButton = '<span class=\"enemy-send-message guild-icon left ' +\r\n  'guild-minibox-action tip-static\" data-tipped=\"Send Message\"></span>';\r\nvar buffButton = '<span class=\"enemy-quickbuff guild-icon left ' +\r\n  'guild-minibox-action tip-static\" data-tipped=\"Quick Buff\"></span>';\r\n\r\nvar contactClass = [\r\n  {\r\n    condition: function(n) {return n < 120;},\r\n    ally: 'fshDodgerBlue',\r\n    enemy: 'fshRed'\r\n  },\r\n  {\r\n    condition: function(n) {return n < 300;},\r\n    ally: 'fshDodgerBlue',\r\n    enemy: 'fshRed'\r\n  },\r\n  {\r\n    condition: function() {return true;},\r\n    ally: 'fshPowderBlue',\r\n    enemy: 'fshPink'\r\n  }\r\n];\r\n\r\nfunction allyOrEnemy(type, test) {\r\n  if (type) {return test.ally;}\r\n  return test.enemy;\r\n}\r\n\r\nfunction contactColor(last_login, type) {\r\n  for (var i = 0; i < contactClass.length; i += 1) {\r\n    var test = contactClass[i];\r\n    if (test.condition(nowSecs - last_login)) {\r\n      return allyOrEnemy(type, test);\r\n    }\r\n  }\r\n  return 'fshWhite';\r\n}\r\n\r\nfunction playerName(val, type) {\r\n  return '<a class=\"player-name tip-static ' +\r\n    contactColor(val.last_login, type) +\r\n    '\" data-tipped=\"<b>' + val.username + '</b><br><table><tbody><tr>' +\r\n    '<td>Level:</td><td>' + val.level + '</td></tr><tr><td>Last ' +\r\n    'Activity:</td><td>' + formatLastActivity(val.last_login) +\r\n    '</td></tr></tbody></table>\" href=\"index.php?cmd=profile&player_id=' +\r\n    val.id + '\">' + val.username + '</a>';\r\n}\r\n\r\nfunction doBuffCheck() {\r\n  if (!calf.hideBuffSelected) {\r\n    return buffCheck;\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction doMsgButton() {\r\n  if (!calf.hideGuildInfoMessage) {\r\n    return msgButton;\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction doBuffButton() {\r\n  if (!calf.hideGuildInfoBuff) {\r\n    return buffButton;\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction doSecureButton(val) {\r\n  if (!calf.hideGuildInfoSecureTrade) {\r\n    return '<a class=\"enemy-secure-trade guild-icon left ' +\r\n      'guild-minibox-action tip-static\" href=\"index.php?cmd=trade' +\r\n      '&subcmd=createsecure&target_username=' + val.username +\r\n      '\" data-tipped=\"Secure Trade\"></a>';\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction doTradeButton(val) {\r\n  if (!calf.hideGuildInfoTrade) {\r\n    return '<a class=\"enemy-trade guild-icon left ' +\r\n      'guild-minibox-action tip-static\" href=\"index.php?cmd=trade' +\r\n      '&target_player=' + val.username +\r\n      '\" data-tipped=\"Send Gold/Items/FSP\"></a>';\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction addContact(contactList, type) {\r\n  var output = '';\r\n  contactList.forEach(function(val) {\r\n    if (nowSecs - val.last_login > 1800) {return;} // 30 mins\r\n    output += '<li class=\"player\"><div class=\"player-row\">';\r\n    output += doBuffCheck();\r\n    output += playerName(val, type);\r\n    output += '</div><div class=\"guild-minibox-actions\">';\r\n    output += doMsgButton();\r\n    output += doBuffButton();\r\n    output += doSecureButton(val);\r\n    output += doTradeButton(val);\r\n    output += '</div></li>';\r\n  });\r\n  return output;\r\n}\r\n\r\nvar noAlliesTests = [\r\n  function(allies, enemies) {return allies.length + enemies.length;},\r\n  function(allies, enemies) {\r\n    if (!calf.enableAllyOnlineList) {return enemies.length;}\r\n  },\r\n  function(allies) {\r\n    if (!calf.enableEnemyOnlineList) {return allies.length;}\r\n  }\r\n];\r\n\r\nfunction noAllies(allies, enemies) {\r\n  return noAlliesTests.every(function(e) {return e(allies, enemies) === 0;});\r\n}\r\n\r\nfunction hazAllies(allies, enemies) {\r\n  var output = '';\r\n  if (calf.enableAllyOnlineList) {\r\n    output += addContact(allies, true);\r\n  }\r\n  if (calf.enableEnemyOnlineList) {\r\n    output += addContact(enemies, false);\r\n  }\r\n  var fshContactList = getElementById('fshContactList');\r\n  fshContactList.innerHTML = '';\r\n  fshContactList.insertAdjacentHTML('beforeend', output);\r\n}\r\n\r\nfunction injectAllyEnemyList(data) {\r\n  var allies = fallback(data._allies, []);\r\n  var enemies = fallback(data._enemies, []);\r\n  if (noAllies(allies, enemies)) {return;}\r\n  hazAllies(allies, enemies);\r\n}\r\n\r\nfunction resetList() { // jQuery.min\r\n  myStats(true).done(injectAllyEnemyList);\r\n}\r\n\r\nfunction toggleBuffSelected(self) {\r\n  self.classList.toggle('enemy-buff-check-on');\r\n  self.classList.toggle('enemy-buff-check-off');\r\n}\r\n\r\nfunction msgPlayer(self) {\r\n  window.openQuickMsgDialog(self.parentNode.previousElementSibling\r\n    .lastElementChild.textContent);\r\n}\r\n\r\nfunction buffPlayer(self) {\r\n  openQuickBuffByName(self.parentNode\r\n    .previousElementSibling.lastElementChild.textContent);\r\n}\r\n\r\nfunction selectedBuff() {\r\n  var buffBalls = getElementById('fshContactList')\r\n    .getElementsByClassName('enemy-buff-check-on');\r\n  var sendstring = Array.prototype.reduce.call(buffBalls,\r\n    function(prev, curr) {\r\n      prev.push(curr.nextElementSibling.textContent);\r\n      return prev;\r\n    }, []);\r\n  openQuickBuffByName(sendstring.join());\r\n}\r\n\r\nvar classEvt = [\r\n  {className: 'enemy-buff-check-on', handler: toggleBuffSelected},\r\n  {className: 'enemy-buff-check-off', handler: toggleBuffSelected},\r\n  {className: 'enemy-send-message', handler: msgPlayer},\r\n  {className: 'enemy-quickbuff', handler: buffPlayer},\r\n  {className: 'enemy-quick-buff', handler: selectedBuff}\r\n];\r\n\r\nfunction eventHandler(evt) {\r\n  var self = evt.target;\r\n  if (self.id === 'fshResetEnemy') {\r\n    resetList();\r\n    return;\r\n  }\r\n  classEvt.some(function(test) {\r\n    if (self.classList.contains(test.className)) {\r\n      test.handler(self);\r\n      return true;\r\n    }\r\n    return false;\r\n  });\r\n}\r\n\r\nfunction makeDiv(data) {\r\n  var fshAllyEnemy = createDiv({\r\n    id: 'fshAllyEnemy',\r\n    className: 'minibox'\r\n  });\r\n  var wrapper = '<h3>Allies/Enemies</h3><div class=\"minibox-content\">' +\r\n    '<h4>Online Contacts <span id=\"fshResetEnemy\">Reset</span></h4>' +\r\n    '<div id=\"minibox-enemy\"><ul id=\"fshContactList\"></ul>';\r\n  if (!calf.hideBuffSelected) {\r\n    wrapper += '<ul class=\"enemy-quick-buff\">Quick Buff Selected</ul>';\r\n  }\r\n  wrapper += '</div></div>';\r\n  fshAllyEnemy.insertAdjacentHTML('beforeend', wrapper);\r\n  afterBegin(pCR, fshAllyEnemy);\r\n  fshAllyEnemy.addEventListener('click', eventHandler);\r\n  injectAllyEnemyList(data);\r\n}\r\n\r\nexport default function prepareAllyEnemyList() { // jQuery.min\r\n  if (jQueryNotPresent()) {return;}\r\n  myStats(false)\r\n    .done(function(data) {\r\n      add(3, makeDiv, [data]);\r\n    });\r\n}\r\n","import {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport getValueJSON from '../system/getValueJSON';\r\nimport {nowSecs} from '../support/dataObj';\r\nimport setValue from '../system/setValue';\r\n\r\nexport var bountyList;\r\nexport var wantedList;\r\nexport var activeBountyListPosted;\r\nvar bountyListRefreshTime;\r\nexport var bwNeedsRefresh;\r\nvar wantedNames;\r\nexport var wantedArray;\r\nexport var bountyUrl = 'index.php?no_mobile=1&cmd=bounty&page=';\r\n\r\nfunction parseActiveBounty(activeTable) { // Legacy\r\n  if (!/No bounties active/.test(activeTable.rows[1].cells[0].innerHTML)) {\r\n    for (var i = 1; i < activeTable.rows.length - 2; i += 2) {\r\n      var theCells = activeTable.rows[i].cells;\r\n      var thisBounty = {};\r\n      thisBounty.target = theCells[0].firstChild\r\n        .firstChild.firstChild.textContent;\r\n      thisBounty.link = theCells[0].firstChild.firstChild.href;\r\n      thisBounty.lvl = theCells[0].firstChild\r\n        .firstChild.nextSibling.textContent\r\n        .replace(/\\[/, '').replace(/\\]/, '');\r\n      thisBounty.reward = theCells[2].textContent;\r\n      thisBounty.rewardType = theCells[2]\r\n        .firstChild.firstChild.firstChild.firstChild\r\n        .nextSibling.firstChild.title;\r\n      thisBounty.posted = theCells[3].textContent;\r\n      thisBounty.xpLoss = theCells[4].textContent;\r\n      thisBounty.progress = theCells[5].textContent;\r\n      bountyList.bounty.push(thisBounty);\r\n    }\r\n  }\r\n}\r\n\r\nexport function getActiveBountyList(doc) { // Legacy\r\n  var activeTable = getElementById('bounty-info', doc).parentNode.parentNode\r\n    .previousElementSibling.children[0].children[0];\r\n  bountyList = {};\r\n  bountyList.bounty = [];\r\n  bountyList.isRefreshed = true;\r\n  bountyList.lastUpdate = nowSecs;\r\n  if (activeTable) {parseActiveBounty(activeTable);}\r\n  activeBountyListPosted = true;\r\n}\r\n\r\nfunction testBountyList() {\r\n  return bountyList &&\r\n    nowSecs - bountyList.lastUpdate > bountyListRefreshTime;\r\n}\r\n\r\nfunction testWantedList() {\r\n  return wantedList &&\r\n    nowSecs - wantedList.lastUpdate > bountyListRefreshTime;\r\n}\r\n\r\nfunction testCacheInvalid() {\r\n  return testBountyList() || testWantedList();\r\n}\r\n\r\nexport function invalidateCache() {\r\n  bountyList = getValueJSON('bountyList');\r\n  wantedList = getValueJSON('wantedList');\r\n  bountyListRefreshTime = getValue('bountyListRefreshTime');\r\n  bwNeedsRefresh = getValue('bwNeedsRefresh');\r\n  if (bwNeedsRefresh) {return;}\r\n  if (testCacheInvalid()) {\r\n    bwNeedsRefresh = true; // invalidate cache\r\n  }\r\n}\r\n\r\nexport function doRefresh() {\r\n  wantedList = {};\r\n  wantedList.bounty = [];\r\n  wantedList.isRefreshed = true;\r\n  wantedList.lastUpdate = nowSecs;\r\n  activeBountyListPosted = false;\r\n  wantedNames = getValue('wantedNames');\r\n  wantedArray = wantedNames.split(/\\s*,\\s*/);\r\n  setValue('bwNeedsRefresh', false);\r\n}\r\n","import calf from '../support/calf';\r\nimport {wantedArray, wantedList} from './lists';\r\n\r\nvar thisBounty;\r\n\r\nfunction acceptBtn(action, cell) {\r\n  if (action !== '[n/a]') {\r\n    return cell.firstChild.firstChild.getAttribute('onclick');\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction getTarget(target, theRow) {\r\n  thisBounty = {};\r\n  thisBounty.target = target;\r\n  thisBounty.link = theRow.cells[0].firstChild.firstChild.href;\r\n  thisBounty.lvl = theRow.cells[0].firstChild.firstChild.nextSibling\r\n    .textContent.replace(/\\[/, '').replace(/\\]/, '');\r\n  thisBounty.offerer = theRow.cells[1].firstChild.firstChild.firstChild\r\n    .textContent;\r\n  thisBounty.reward = theRow.cells[2].textContent;\r\n  thisBounty.rewardType = theRow.cells[2].firstChild.firstChild.firstChild\r\n    .firstChild.nextSibling.firstChild.title;\r\n  thisBounty.xpLoss = theRow.cells[3].textContent;\r\n  thisBounty.posted = theRow.cells[4].textContent;\r\n  thisBounty.tickets = theRow.cells[5].textContent;\r\n  thisBounty.accept = acceptBtn(theRow.cells[6].textContent.trim(),\r\n    theRow.cells[6]);\r\n  wantedList.bounty.push(thisBounty);\r\n}\r\n\r\nvar isWanted = [\r\n  function() {return wantedArray.includes('*');},\r\n  function(target) {return wantedArray.includes(target);},\r\n  function(target, theRow) {\r\n    return calf.wantedGuildMembers &&\r\n      theRow.cells[6].textContent.trim() === '[n/a]';\r\n  }\r\n];\r\n\r\nfunction wantedTarget(target, theRow) {\r\n  if (theRow.cells[6].textContent.trim() !== '[active]' &&\r\n      isWanted.some(function(el) {return el(target, theRow);})) {\r\n    getTarget(target, theRow);\r\n  }\r\n}\r\n\r\nexport default function findTarget(activeTable) {\r\n  for (var i = 1; i < activeTable.rows.length - 2; i += 2) {\r\n    var theRow = activeTable.rows[i];\r\n    var target = theRow.cells[0].firstChild\r\n      .firstChild.firstChild.textContent;\r\n    if (target === '[ No bounties available. ]') {break;}\r\n    wantedTarget(target, theRow);\r\n  }\r\n}\r\n","import afterBegin from '../common/afterBegin';\r\nimport calf from '../support/calf';\r\nimport {createDiv} from '../common/cElement';\r\nimport {pCR} from '../support/layout';\r\n\r\nexport var bountyListDiv;\r\nexport var wantedListDiv;\r\n\r\nfunction createMiniBox() {\r\n  return createDiv({className: 'minibox'});\r\n}\r\n\r\nexport function createDivs() {\r\n  if (calf.enableWantedList) {\r\n    wantedListDiv = createMiniBox();\r\n    afterBegin(pCR, wantedListDiv);\r\n  }\r\n  if (calf.enableActiveBountyList) {\r\n    bountyListDiv = createMiniBox();\r\n    afterBegin(pCR, bountyListDiv);\r\n  }\r\n}\r\n","import {bountyList} from './lists';\r\nimport {bountyListDiv} from './createDivs';\r\nimport insertElement from '../common/insertElement';\r\nimport setValueJSON from '../system/setValueJSON';\r\nimport {createDiv, createSpan} from '../common/cElement';\r\n\r\nexport var bountyListReset;\r\n\r\nfunction makeMouseOver(el) {\r\n  return 'Level:  ' + el.lvl +\r\n    '<br>Reward: ' + el.reward + ' ' + el.rewardType +\r\n    '<br>XP Loss Remaining: ' + el.xpLoss +\r\n    '<br>Progress:  ' + el.progress;\r\n}\r\n\r\nexport function injectBountyList() { // Legacy\r\n  setValueJSON('bountyList', bountyList);\r\n\r\n  bountyListDiv.innerHTML = '';\r\n\r\n  var heading = createDiv({textContent: 'Active Bounties '});\r\n  bountyListReset = createSpan({className: 'xxsLink', textContent: 'Reset'});\r\n  insertElement(heading, bountyListReset);\r\n  insertElement(bountyListDiv, heading);\r\n\r\n  var output = '';\r\n  if (bountyList.bounty.length === 0) {\r\n    output += '<div class=\"xsOrange\">[No active bounties]</div>';\r\n  } else {\r\n    for (var i = 0; i < bountyList.bounty.length; i += 1) {\r\n      output += '<a href=\"' + bountyList.bounty[i].link +\r\n        '\" class=\"tip-static\" data-tipped=\"' +\r\n        makeMouseOver(bountyList.bounty[i]) + '\">' +\r\n        bountyList.bounty[i].target + '</a><br>';\r\n    }\r\n  }\r\n  bountyListDiv.insertAdjacentHTML('beforeend', output);\r\n}\r\n","import insertElement from '../common/insertElement';\r\nimport setValueJSON from '../system/setValueJSON';\r\nimport {wantedList} from './lists';\r\nimport {wantedListDiv} from './createDivs';\r\nimport {createDiv, createSpan} from '../common/cElement';\r\n\r\nexport var wantedListReset;\r\n\r\nfunction makeMouseOver(el) {\r\n  return 'Target Level:  ' + el.lvl +\r\n    '<br>Offerer: ' + el.offerer +\r\n    '<br>Reward: ' + el.reward + ' ' + el.rewardType +\r\n    '<br>XP Loss Remaining: ' + el.xpLoss +\r\n    '<br>Posted: ' + el.posted +\r\n    '<br>Tickets Req.:  ' + el.tickets;\r\n}\r\n\r\nfunction acceptBtn(bounty) {\r\n  if (bounty.accept) {\r\n    return '<span class=\"xsGreen\" onclick=\"' + bounty.accept +\r\n      '\">[a]</span>&nbsp;';\r\n  }\r\n  return '';\r\n}\r\n\r\nexport function injectWantedList() { // Legacy\r\n  setValueJSON('wantedList', wantedList);\r\n\r\n  wantedListDiv.innerHTML = '';\r\n\r\n  var heading = createDiv({textContent: 'Wanted Bounties '});\r\n  wantedListReset = createSpan({className: 'xxsLink', textContent: 'Reset'});\r\n  insertElement(heading, wantedListReset);\r\n  insertElement(wantedListDiv, heading);\r\n\r\n  var output = '';\r\n  if (wantedList.bounty.length === 0) {\r\n    output += '<div class=\"xsOrange\">[No wanted bounties]</div>';\r\n  } else {\r\n    for (var i = 0; i < wantedList.bounty.length; i += 1) {\r\n      output += acceptBtn(wantedList.bounty[i]) +\r\n        '<a class=\"xsKhaki tip-static\" data-tipped=\"' +\r\n        makeMouseOver(wantedList.bounty[i]) +\r\n        '\" href=\"' + wantedList.bounty[i].link + '\">' +\r\n        wantedList.bounty[i].target + '</a><br>';\r\n    }\r\n  }\r\n  wantedListDiv.insertAdjacentHTML('beforeend', output);\r\n}\r\n","import calf from '../support/calf';\r\nimport createDocument from '../system/createDocument';\r\nimport findTarget from './findTarget';\r\nimport {getElementById} from '../common/getElement';\r\nimport {injectBountyList} from './injectBountyList';\r\nimport {injectWantedList} from './injectWantedList';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport {activeBountyListPosted, bountyUrl, getActiveBountyList} from './lists';\r\n\r\nvar curPage;\r\nvar maxPage;\r\n\r\nfunction getWantedBountyList(doc) {\r\n  if (!calf.enableWantedList) {return;}\r\n  var page = doc.querySelector('#pCC input[name=\"page\"]');\r\n  curPage = Number(page.value);\r\n  maxPage = Number(page.parentNode.innerHTML.match(/of&nbsp;(\\d*)/)[1]);\r\n  var activeTable = getElementById('bounty-info', doc).parentNode.parentNode\r\n    .nextElementSibling.children[0].children[0];\r\n  if (activeTable) {findTarget(activeTable);}\r\n}\r\n\r\nfunction hazActiveBountyList(doc) {\r\n  if (calf.enableActiveBountyList && !activeBountyListPosted) {\r\n    getActiveBountyList(doc);\r\n    injectBountyList();\r\n  }\r\n}\r\n\r\nexport function parseBountyPageForWorld(details) {\r\n  var doc = createDocument(details);\r\n  getWantedBountyList(doc);\r\n  hazActiveBountyList(doc);\r\n  if (curPage < maxPage) {\r\n    retryAjax(bountyUrl + (curPage + 1).toString())\r\n      .done(parseBountyPageForWorld);\r\n  } else {\r\n    injectWantedList();\r\n  }\r\n}\r\n","import calf from '../support/calf';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {parseBountyPageForWorld} from './parseBountyPageForWorld';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport setValueJSON from '../system/setValueJSON';\r\nimport {\r\n  bountyList,\r\n  bountyUrl,\r\n  bwNeedsRefresh,\r\n  doRefresh,\r\n  invalidateCache,\r\n  wantedList\r\n} from './lists';\r\nimport {bountyListDiv, createDivs, wantedListDiv} from './createDivs';\r\nimport {bountyListReset, injectBountyList} from './injectBountyList';\r\nimport {injectWantedList, wantedListReset} from './injectWantedList';\r\n\r\nfunction notRefreshed(enableActiveBountyList, enableWantedList) {\r\n  if (enableWantedList) {\r\n    wantedList.isRefreshed = false;\r\n    injectWantedList(wantedList);\r\n  }\r\n  if (enableActiveBountyList) {\r\n    bountyList.isRefreshed = false;\r\n    injectBountyList(bountyList);\r\n  }\r\n}\r\n\r\nvar refreshConditions = [\r\n  function() {return !bountyList;},\r\n  function() {return !wantedList;},\r\n  function() {return bwNeedsRefresh;}\r\n];\r\n\r\nfunction needsRefresh() {\r\n  return refreshConditions.some(function(el) {\r\n    return el();\r\n  });\r\n}\r\n\r\nfunction retrieveBountyInfo(enableActiveList, enableWantedList) {\r\n  invalidateCache();\r\n  if (needsRefresh()) {\r\n    doRefresh();\r\n    retryAjax(bountyUrl + '1').done(parseBountyPageForWorld);\r\n  } else {\r\n    notRefreshed(enableActiveList, enableWantedList);\r\n  }\r\n}\r\n\r\nfunction resetList(e) {\r\n  if (e.target === bountyListReset) {\r\n    setValueJSON('bountyList', null);\r\n    retrieveBountyInfo(calf.enableActiveBountyList, calf.enableWantedList);\r\n  }\r\n  if (e.target === wantedListReset) {\r\n    setValueJSON('wantedList', null);\r\n    retrieveBountyInfo(calf.enableActiveBountyList, calf.enableWantedList);\r\n  }\r\n}\r\n\r\nexport function prepareBountyData() {\r\n  if (jQueryNotPresent()) {return;}\r\n  createDivs();\r\n  bountyListDiv.addEventListener('click', resetList);\r\n  wantedListDiv.addEventListener('click', resetList);\r\n  retrieveBountyInfo(calf.enableActiveBountyList, calf.enableWantedList);\r\n}\r\n","import calf from '../support/calf';\r\nimport createDocument from '../system/createDocument';\r\nimport {doSendGold} from '../newMap/sendGold';\r\nimport findNode from '../system/findNode';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport insertQuickWear from '../quickWear/quickWear';\r\nimport jQueryDialog from './jQueryDialog';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport {sendEvent} from '../support/fshGa';\r\n\r\nvar expandMenuOnKeyPress;\r\n\r\nfunction movePage(dir) { // Legacy\r\n  var dirButton = findNode('//input[@value=\"' + dir + '\"]');\r\n  if (!dirButton) {return;}\r\n  var url = dirButton.getAttribute('onClick');\r\n  url = url.replace(/^[^']*'/m, '').replace(/';$/m, '');\r\n  location.href = url;\r\n}\r\n\r\nfunction changeCombatSet(responseText, itemIndex) { // jQuery.min\r\n  var doc = createDocument(responseText);\r\n\r\n  var cbsSelect = doc.querySelector(\r\n    '#profileCombatSetDiv select[name=\"combatSetId\"]');\r\n\r\n  // find the combat set id value\r\n  var allItems = cbsSelect.getElementsByTagName('option');\r\n  if (itemIndex >= allItems.length) {return;}\r\n  var cbsIndex = allItems[itemIndex].value;\r\n\r\n  retryAjax({\r\n    url: 'index.php',\r\n    data: {\r\n      no_mobile: 1,\r\n      cmd: 'profile',\r\n      subcmd: 'managecombatset',\r\n      combatSetId: cbsIndex,\r\n      submit: 'Use'\r\n    },\r\n    success: function() {\r\n      if (expandMenuOnKeyPress) {\r\n        localStorage.setItem('hcs.nav.openIndex', '2');\r\n      }\r\n      location.href = 'index.php?cmd=profile';\r\n    }\r\n  });\r\n}\r\n\r\nfunction doRepair() {\r\n  // do not use repair link for new map\r\n  if (!getElementById('worldPage')) {\r\n    location.href = 'index.php?cmd=blacksmith&subcmd=repairall&fromworld=1';\r\n  }\r\n}\r\n\r\nfunction createGroup() {\r\n  if (expandMenuOnKeyPress) {localStorage.setItem('hcs.nav.openIndex', '4');}\r\n  location.href =\r\n    'index.php?cmd=guild&subcmd=groups&subcmd2=create&fromworld=1';\r\n}\r\n\r\nfunction logPage() {\r\n  if (expandMenuOnKeyPress) {localStorage.setItem('hcs.nav.openIndex', '2');}\r\n  location.href = 'index.php?cmd=log';\r\n}\r\n\r\nfunction gotoGuild() {\r\n  if (expandMenuOnKeyPress) {localStorage.setItem('hcs.nav.openIndex', '4');}\r\n  location.href = 'index.php?cmd=guild&subcmd=manage';\r\n}\r\n\r\nfunction joinAllGroup() {\r\n  if (expandMenuOnKeyPress) {localStorage.setItem('hcs.nav.openIndex', '4');}\r\n  if (!getValue('enableMaxGroupSizeToJoin')) {\r\n    location.href = 'index.php?cmd=guild&subcmd=groups&subcmd2=joinall';\r\n  } else {\r\n    location.href =\r\n      'index.php?cmd=guild&subcmd=groups&subcmd2=joinallgroupsundersize';\r\n  }\r\n}\r\n\r\nfunction backpack() {\r\n  if (expandMenuOnKeyPress) {localStorage.setItem('hcs.nav.openIndex', '2');}\r\n  location.href = 'index.php?cmd=profile&subcmd=dropitems';\r\n}\r\n\r\nfunction fastWearMgr() {\r\n  if (!('dialogIsClosed' in calf) || calf.dialogIsClosed()) {\r\n    sendEvent('keyHandler', 'insertQuickWear');\r\n    jQueryDialog(insertQuickWear);\r\n  }\r\n}\r\n\r\nfunction profile() {\r\n  if (expandMenuOnKeyPress) {localStorage.setItem('hcs.nav.openIndex', '2');}\r\n  location.href = 'index.php?cmd=profile';\r\n}\r\n\r\nfunction combatSetKey(itemIndex) {\r\n  retryAjax('index.php?no_mobile=1&cmd=profile').done(function(data) {\r\n    changeCombatSet(data, itemIndex);\r\n  });\r\n}\r\n\r\nvar keyDict = {\r\n  '33': {fn: combatSetKey, arg: 1}, // Shift+1\r\n  '64': {fn: combatSetKey, arg: 2}, // Shift+2\r\n  '34': {fn: combatSetKey, arg: 2}, // Shift+2 -- for UK keyboards, I think\r\n  '35': {fn: combatSetKey, arg: 3}, // Shift+3\r\n  '36': {fn: combatSetKey, arg: 4}, // Shift+4\r\n  '37': {fn: combatSetKey, arg: 5}, // Shift+5\r\n  '94': {fn: combatSetKey, arg: 6}, // Shift+6\r\n  '38': {fn: combatSetKey, arg: 7}, // Shift+7\r\n  '42': {fn: combatSetKey, arg: 8}, // Shift+8\r\n  '40': {fn: combatSetKey, arg: 9}, // Shift+9\r\n  '60': {fn: movePage, arg: '<'}, // move to prev page [<]\r\n  '62': {fn: movePage, arg: '>'}, // move to next page [>]\r\n  '71': {fn: createGroup}, // create group [G]\r\n  '76': {fn: logPage}, // Log Page [L]\r\n  '98': {fn: backpack}, // backpack [b]\r\n  '103': {fn: gotoGuild}, // go to guild [g]\r\n  '106': {fn: joinAllGroup}, // join all group [j]\r\n  '108': {fn: logPage}, // Log Page [l]\r\n  '112': {fn: profile}, // profile [p]\r\n  '114': {fn: doRepair}, // repair [r]\r\n  '118': {fn: fastWearMgr}, // fast wear manager [v]\r\n  '121': {fn: doSendGold}, // fast send gold [y]\r\n  '163': {fn: combatSetKey, arg: 3}, // Shift+3 -- for UK keyboards\r\n};\r\n\r\nfunction handleKey(r) {\r\n  if (r in keyDict) {\r\n    keyDict[r].fn(keyDict[r].arg);\r\n  }\r\n}\r\n\r\nvar bailOut = [\r\n  function(evt) {\r\n    return evt.target.tagName !== 'HTML' && evt.target.tagName !== 'BODY';\r\n  },\r\n  /* ignore control, alt and meta keys\r\n  (I think meta is the command key in Macintoshes) */\r\n  function(evt) {return evt.ctrlKey;},\r\n  function(evt) {return evt.metaKey;},\r\n  function(evt) {return evt.altKey;}\r\n];\r\n\r\nfunction keyPress(evt) {\r\n  for (var i = 0; i < bailOut.length; i += 1) {\r\n    if (bailOut[i](evt)) {return;}\r\n  }\r\n  handleKey(evt.charCode);\r\n}\r\n\r\nexport default function replaceKeyHandler() {\r\n  expandMenuOnKeyPress = getValue('expandMenuOnKeyPress');\r\n  document.onkeypress = keyPress;\r\n}\r\n","import getValue from '../system/getValue';\r\nimport {infoBox} from '../support/layout';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport setValue from '../system/setValue';\r\n\r\nexport function doSendGold() { // jQuery\r\n  retryAjax({\r\n    url: 'index.php',\r\n    data: {\r\n      no_mobile: 1,\r\n      cmd: 'trade',\r\n      subcmd: 'sendgold',\r\n      xc: window.ajaxXC,\r\n      target_username: $('#HelperSendTo').html(),\r\n      gold_amount: $('#HelperSendAmt').html().replace(/[^\\d]/g, '')\r\n    }\r\n  }).done(function(data) {\r\n    var info = infoBox(data);\r\n    if (info === 'You successfully sent gold!' || info === '') {\r\n      setValue('currentGoldSentTotal',\r\n        parseInt(getValue('currentGoldSentTotal'), 10) +\r\n        parseInt(getValue('goldAmount'), 10));\r\n      GameData.fetch(1);\r\n    }\r\n  });\r\n}\r\n\r\nexport function injectSendGoldOnWorld() { // jQuery\r\n  if (!getValue('sendGoldonWorld')) {return;}\r\n  $('#statbar-gold-tooltip-general').append(\r\n    '<dt class=\"stat-gold-sendTo\">Send To:</dt>' +\r\n    '<dd id=\"HelperSendTo\">' + getValue('goldRecipient') +\r\n    '</dd>' +\r\n    '<dt class=\"stat-gold-sendAmt\">Amount:</dt>' +\r\n    '<dd id=\"HelperSendAmt\">' + getValue('goldAmount')\r\n      .replace(/(\\d)(?=(\\d\\d\\d)+(?!\\d))/g, '$1,') + '</dd>' +\r\n    '<dt class=\"stat-gold-sendTo\">Send?</dt>' +\r\n    '<dd><input id=\"HelperSendGold\" value=\"Send!\" class=\"custombutton\" ' +\r\n    'type=\"submit\"><input type=\"hidden\" id=\"xc\" value=\"\"</dd>' +\r\n    '<dt class=\"stat-gold-sendTotal\">Total Sent:</dt>' +\r\n    '<dd id=\"HelperSendTotal\">' +\r\n      getValue('currentGoldSentTotal')\r\n        .toString()\r\n        .replace(/(\\d)(?=(\\d\\d\\d)+(?!\\d))/g, '$1,') +\r\n      '</dd>');\r\n  $('#HelperSendGold').click(doSendGold);\r\n}\r\n\r\nfunction updateGoldValue(data) {\r\n  $('#HelperSendTotal')\r\n    .html(getValue('currentGoldSentTotal')\r\n      .toString()\r\n      .replace(/(\\d)(?=(\\d\\d\\d)+(?!\\d))/g, '$1,'));\r\n  if (parseInt(data.player.gold, 10) > getValue('goldAmount')) {\r\n    $('#statbar-gold').css('background-color', 'red');\r\n  } else {\r\n    $('#statbar-gold').css('background-color', 'inherit');\r\n  }\r\n}\r\n\r\nexport function updateSendGoldOnWorld(data) { // jQuery\r\n  if (data.player && getValue('sendGoldonWorld')) {\r\n    updateGoldValue(data);\r\n  }\r\n}\r\n","import fallback from './fallback';\r\n\r\nfunction getTarget(doc) {\r\n  if (doc instanceof HTMLDocument) {return doc;}\r\n  return document;\r\n}\r\n\r\nfunction patchXPath(xpath) {\r\n  if (xpath.indexOf('/') === 0) {\r\n    return '.' + xpath;\r\n    // TODO this is likely to be bad\r\n    // this is a chrome fix - needs a .// for xpath\r\n    // where as firefox can function without it.\r\n    // firefox still works with .//\r\n  }\r\n  return xpath;\r\n}\r\n\r\nexport default function findNodes(xpath, doc) {\r\n  var _xpath = patchXPath(xpath);\r\n  var nodes = [];\r\n  var target;\r\n  // We may have passed in a HTMLDocument object as the context\r\n  // See createDocument with DOMParser\r\n  // This only matters in Firefox. evaluate will fail silently if\r\n  // the context is not part of the calling object.\r\n  var _doc = fallback(doc, document);\r\n  target = getTarget(_doc);\r\n  var findQ = target.evaluate(_xpath, _doc, null,\r\n    XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);\r\n  if (findQ.snapshotLength === 0) {return null;}\r\n  for (var i = 0; i < findQ.snapshotLength; i += 1) {\r\n    nodes.push(findQ.snapshotItem(i));\r\n  }\r\n  return nodes;\r\n}\r\n","import findNodes from './findNodes';\r\n\r\nexport default function findNode(xpath, doc) {\r\n  var nodes = findNodes(xpath, doc);\r\n  if (!nodes) {return null;}\r\n  return nodes[0];\r\n}\r\n","import calf from '../support/calf';\r\nimport getForage from '../ajax/getForage';\r\nimport {nowSecs} from '../support/dataObj';\r\nimport setForage from '../ajax/setForage';\r\nimport superelite from '../app/superelite';\r\n\r\nexport var oldLog;\r\nvar timeoutId;\r\nvar intervalId;\r\n\r\nexport function disableBackgroundChecks() {\r\n  if (timeoutId) {\r\n    window.clearTimeout(timeoutId);\r\n    timeoutId = false;\r\n  }\r\n  if (intervalId) {\r\n    window.clearInterval(intervalId);\r\n    intervalId = false;\r\n  }\r\n}\r\n\r\nfunction gotSe(data) { // jQuery.min\r\n  var serverTime = Number(data.t.split(' ')[1]);\r\n  if (!oldLog) {oldLog = {lastUpdate: 0, se: {}};}\r\n  oldLog.lastUpdate = serverTime;\r\n  var resultAry = data.r;\r\n  resultAry.forEach(function(element) {\r\n    var myTime = serverTime - element.time;\r\n    var mobName = element.creature.name.replace(' (Super Elite)', '');\r\n    if (!oldLog.se[mobName] || oldLog.se[mobName] < myTime) {\r\n      oldLog.se[mobName] = myTime;\r\n    }\r\n  });\r\n  setForage('fsh_seLog', oldLog);\r\n}\r\n\r\nfunction getSeLog() { // jQuery.min\r\n  return superelite().done(gotSe);\r\n}\r\n\r\nexport function doBackgroundCheck() {\r\n  disableBackgroundChecks();\r\n  intervalId = window.setInterval(getSeLog, 300000);\r\n  return getSeLog();\r\n}\r\n\r\nfunction whenWasLastCheck() {\r\n  return nowSecs - (oldLog && oldLog.lastUpdate || 0);\r\n}\r\n\r\nfunction setupBackgroundCheck() {\r\n  var lastCheckSecs = whenWasLastCheck();\r\n  if (lastCheckSecs >= 600) {\r\n    doBackgroundCheck();\r\n  } else {\r\n    timeoutId = window.setTimeout(doBackgroundCheck,\r\n      (600 - lastCheckSecs) * 1000);\r\n  }\r\n}\r\n\r\nfunction gotLog(data) {\r\n  if (data) {oldLog = data;}\r\n}\r\n\r\nexport function getFshSeLog() { // jQuery.min\r\n  return getForage('fsh_seLog').done(gotLog);\r\n}\r\n\r\nfunction shouldLog() {\r\n  return $ && calf.enableSeTracker && calf.cmd !== 'superelite';\r\n}\r\n\r\nexport function seLog() { // jQuery.min\r\n  if (shouldLog()) {\r\n    getFshSeLog().done(setupBackgroundCheck);\r\n  }\r\n}\r\n","import {getElementById} from '../common/getElement';\r\n\r\nexport default function scoutTowerLink() {\r\n  var spoils = getElementById('minibox-spoilsofwar');\r\n  if (spoils) {\r\n    var parent = spoils.children[1].children[0];\r\n    parent.insertAdjacentHTML('beforeend', '&nbsp;' +\r\n      '<a href=\"index.php?cmd=guild&subcmd=scouttower\" ' +\r\n      'class=\"tip-static\" data-tipped=\"View Scout Report\">' +\r\n      '<img id=\"fshScoutTower\" ' +\r\n      'src=\"https://cdn.fallensword.com/structures/27.gif\"></a>');\r\n  }\r\n}\r\n","import callApp from './callApp';\r\n// import failStub from './failStub';\r\n\r\nexport default function superelite() {\r\n  return callApp({cmd: 'superelite'});\r\n  // return failStub();\r\n}\r\n","import {createAnchor} from '../common/cElement';\r\nimport {getElementById} from '../common/getElement';\r\n\r\nfunction statbarWrapper(href, id) {\r\n  var myWrapper = createAnchor({href: href});\r\n  var character = getElementById(id);\r\n  var statWrapper = character.parentNode;\r\n  myWrapper.appendChild(character);\r\n  statWrapper.insertBefore(myWrapper, statWrapper.firstChild);\r\n  myWrapper.addEventListener('click', function(evt) {\r\n    evt.stopPropagation();\r\n  }, true);\r\n}\r\n\r\nexport default function statbar() {\r\n  statbarWrapper('index.php?cmd=profile', 'statbar-character');\r\n  statbarWrapper('index.php?cmd=points&subcmd=reserve', 'statbar-stamina');\r\n  statbarWrapper('index.php?cmd=blacksmith', 'statbar-equipment');\r\n  statbarWrapper('index.php?cmd=profile&subcmd=dropitems', 'statbar-inventory');\r\n  statbarWrapper('index.php?cmd=points', 'statbar-fsp');\r\n  statbarWrapper('index.php?cmd=bank', 'statbar-gold');\r\n}\r\n","export default function updateHCSQuickBuffLinks(selector) {\r\n  Array.prototype.forEach.call(document.querySelectorAll(selector),\r\n    function(el) {\r\n      el.href = el.getAttribute('href').replace(/, 500/g, ', 1000'); // getAttribute neccessary for FF\r\n    }\r\n  );\r\n}\r\n","import calf from '../support/calf';\r\nimport {getElementById} from '../common/getElement';\r\n\r\nfunction hideElement(el) {\r\n  el.classList.add('fshHide');\r\n}\r\n\r\nfunction hideNodeList(nodeList) {\r\n  Array.prototype.forEach.call(nodeList, hideElement);\r\n}\r\n\r\nfunction hideQuerySelectorAll(parent, selector) { // Native - probably wrong\r\n  hideNodeList(parent.querySelectorAll(selector));\r\n}\r\n\r\nfunction contactColour(el, obj) {\r\n  var onMouseOver = el.dataset.tipped;\r\n  var lastActivityMinutes =\r\n    /Last Activity:<\\/td><td>(\\d+) mins/.exec(onMouseOver)[1];\r\n  if (lastActivityMinutes < 2) {\r\n    el.classList.add(obj.l1);\r\n  } else if (lastActivityMinutes < 5) {\r\n    el.classList.add(obj.l2);\r\n  } else {\r\n    el.classList.add(obj.l3);\r\n  }\r\n}\r\n\r\nfunction guildColour(el) {\r\n  contactColour(el, {\r\n    l1: 'fshGreen',\r\n    l2: 'fshWhite',\r\n    l3: 'fshGrey'\r\n  });\r\n}\r\n\r\nfunction alliesColour(el) {\r\n  contactColour(el, {\r\n    l1: 'fshDodgerBlue',\r\n    l2: 'fshLightSkyBlue',\r\n    l3: 'fshPowderBlue'\r\n  });\r\n}\r\n\r\nvar hideBtn = [\r\n  {\r\n    condition: function() {return calf.hideGuildInfoTrade;},\r\n    guildSelector: '#guild-minibox-action-trade',\r\n    allySelector: '#online-allies-action-trade'\r\n  },\r\n  {\r\n    condition: function() {return calf.hideGuildInfoSecureTrade;},\r\n    guildSelector: '#guild-minibox-action-secure-trade',\r\n    allySelector: '#online-allies-action-secure-trade'\r\n  },\r\n  {\r\n    condition: function() {return calf.hideGuildInfoBuff;},\r\n    guildSelector: '#guild-minibox-action-quickbuff',\r\n    allySelector: '#online-allies-action-quickbuff'\r\n  },\r\n  {\r\n    condition: function() {return calf.hideGuildInfoMessage;},\r\n    guildSelector: '#guild-minibox-action-send-message',\r\n    allySelector: '#online-allies-action-send-message'\r\n  }\r\n];\r\n\r\nfunction doHideBtn(context, selector) {\r\n  hideBtn.forEach(function(el) {\r\n    if (el.condition()) {\r\n      hideQuerySelectorAll(context, el[selector]);\r\n    }\r\n  });\r\n}\r\n\r\nexport function addGuildInfoWidgets() {\r\n  var guildMembrList = getElementById('minibox-guild-members-list');\r\n  if (!guildMembrList) {return;} // list exists\r\n  // hide guild info links\r\n  doHideBtn(guildMembrList, 'guildSelector');\r\n  if (calf.hideBuffSelected) {\r\n    hideNodeList(\r\n      guildMembrList.getElementsByClassName('guild-buff-check-on'));\r\n    getElementById('guild-quick-buff').classList.add('fshHide');\r\n  }\r\n  // add coloring for offline time\r\n  Array.prototype.forEach.call(\r\n    guildMembrList.getElementsByClassName('player-name'), guildColour);\r\n  Array.prototype.forEach.call(\r\n    document.querySelectorAll('#pCR h4'),\r\n    function(el) {\r\n      if (el.textContent !== 'Chat') {return;}\r\n      el.innerHTML = '<a href=\"index.php?cmd=guild&subcmd=chat\">' +\r\n        el.textContent + '</a>';\r\n    }\r\n  );\r\n}\r\n\r\nexport function addOnlineAlliesWidgets() {\r\n  var onlineAlliesList = getElementById('minibox-allies-list');\r\n  if (!onlineAlliesList) {return;}\r\n  doHideBtn(onlineAlliesList, 'allySelector');\r\n  if (calf.hideBuffSelected) {\r\n    hideNodeList(\r\n      onlineAlliesList.getElementsByClassName('ally-buff-check-on'));\r\n    getElementById('ally-quick-buff').classList.add('fshHide');\r\n  }\r\n  // add coloring for offline time\r\n  Array.prototype.forEach.call(\r\n    onlineAlliesList.getElementsByClassName('player-name'), alliesColour);\r\n}\r\n","export default function padZ(n) {\r\n  var ret = n.toString();\r\n  if (n < 10) {ret = '0' + ret;}\r\n  return ret;\r\n}\r\n","import {getElementById} from '../common/getElement';\r\nimport intValue from '../system/intValue';\r\nimport padZ from '../system/padZ';\r\nimport {months, now} from '../support/dataObj';\r\n\r\nvar days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\r\n\r\nfunction formatShortDate(aDate) {\r\n  var yyyy = aDate.getFullYear();\r\n  var dd = padZ(aDate.getDate());\r\n  var ddd = days[aDate.getDay()];\r\n  var month = months[aDate.getMonth()];\r\n  var hh = padZ(aDate.getHours());\r\n  var mm = padZ(aDate.getMinutes());\r\n  return hh + ':' + mm + ' ' + ddd + ' ' + dd + '/' + month + '/' + yyyy;\r\n}\r\n\r\nfunction timeBox(nextGainTime, hrsToGo) {\r\n  var nextGain = /([0-9]+)m ([0-9]+)s/.exec(nextGainTime);\r\n  if (!nextGain) {return;}\r\n  return '<dd>' +\r\n    formatShortDate(new Date(now +\r\n    (hrsToGo * 60 * 60 + parseInt(nextGain[1], 10) * 60 +\r\n    parseInt(nextGain[2], 10)) * 1000)) + '</dd>';\r\n}\r\n\r\nexport function injectStaminaCalculator() {\r\n  var nextGain = document.getElementsByClassName('stat-stamina-nextGain');\r\n  if (!nextGain) {return;}\r\n  var staminaMouseover =\r\n    getElementById('statbar-stamina-tooltip-stamina');\r\n  var stamVals = /([,0-9]+)\\s\\/\\s([,0-9]+)/.exec(\r\n    staminaMouseover.getElementsByClassName('stat-name')[0]\r\n      .nextElementSibling.textContent\r\n  );\r\n  staminaMouseover.insertAdjacentHTML('beforeend',\r\n    '<dt class=\"stat-stamina-nextHuntTime\">Max Stam At</dt>' +\r\n    timeBox(\r\n      nextGain[0].nextElementSibling.textContent,\r\n      // get the max hours to still be inside stamina maximum\r\n      Math.floor(\r\n        (intValue(stamVals[2]) -\r\n        intValue(stamVals[1])) /\r\n        intValue(\r\n          document.getElementsByClassName('stat-stamina-gainPerHour')[0]\r\n            .nextElementSibling.textContent\r\n        )\r\n      )\r\n    )\r\n  );\r\n}\r\n\r\nexport function injectLevelupCalculator() {\r\n  var nextGain = document.getElementsByClassName('stat-xp-nextGain');\r\n  if (!nextGain) {return;}\r\n  getElementById('statbar-level-tooltip-general')\r\n    .insertAdjacentHTML('beforeend',\r\n      '<dt class=\"stat-xp-nextLevel\">Next Level At</dt>' +\r\n      timeBox(\r\n        nextGain[0].nextElementSibling.textContent,\r\n        Math.ceil(\r\n          intValue(\r\n            document.getElementsByClassName('stat-xp-remaining')[0]\r\n              .nextElementSibling.textContent\r\n          ) /\r\n          intValue(\r\n            document.getElementsByClassName('stat-xp-gainPerHour')[0]\r\n              .nextElementSibling.textContent\r\n          )\r\n        )\r\n      )\r\n    );\r\n}\r\n","import add from '../support/task';\r\nimport afterBegin from '../common/afterBegin';\r\nimport calf from '../support/calf';\r\nimport changeGuildLogHREF from './changeGuildLogHREF';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport guildActivity from '../guild/guildActivity';\r\nimport {injectComposeAlert} from '../composing/composing';\r\nimport injectFSBoxLog from './injectFSBoxLog';\r\nimport injectHelperMenu from './helperMenu';\r\nimport injectHomePageTwoLink from '../news/injectHomePageTwoLink';\r\nimport injectJoinAllLink from '../notification/injectJoinAllLink';\r\nimport injectMenu from './accordion';\r\nimport injectQuickMsgDialogJQ from './messaging';\r\nimport injectServerNode from './injectServerNode';\r\nimport injectTempleAlert from '../notification/injectTempleAlert';\r\nimport injectUpgradeAlert from '../notification/injectUpgradeAlert';\r\nimport jsonParse from '../common/jsonParse';\r\nimport navMenu from './navMenu';\r\nimport {pCR} from '../support/layout';\r\nimport prepareAllyEnemyList from './allyEnemy';\r\nimport {prepareBountyData} from '../activeWantedBounties/activeWantedBounties';\r\nimport replaceKeyHandler from './keyHandler';\r\nimport scoutTowerLink from './scoutTowerLink';\r\nimport {seLog} from '../seLog/seLog';\r\nimport statbar from './statBar';\r\nimport updateHCSQuickBuffLinks from '../common/updateHCSQuickBuffLinks';\r\nimport {addGuildInfoWidgets, addOnlineAlliesWidgets} from './widgets';\r\nimport {injectLevelupCalculator, injectStaminaCalculator} from './calc';\r\n\r\nfunction gameHelpLink() {\r\n  var nodeList = document.querySelectorAll('#pCR h3');\r\n  Array.prototype.forEach.call(nodeList, function(el) {\r\n    if (el.textContent === 'Game Help') {\r\n      el.innerHTML = '<a href=\"index.php?cmd=settings\">Game Help</a>';\r\n    }\r\n  });\r\n}\r\n\r\nfunction getEnvVars() {\r\n  calf.enableAllyOnlineList = getValue('enableAllyOnlineList');\r\n  calf.enableEnemyOnlineList = getValue('enableEnemyOnlineList');\r\n  calf.enableGuildInfoWidgets = getValue('enableGuildInfoWidgets');\r\n  calf.enableOnlineAlliesWidgets =\r\n    getValue('enableOnlineAlliesWidgets');\r\n  calf.enableSeTracker = getValue('enableSeTracker');\r\n  calf.hideGuildInfoTrade = getValue('hideGuildInfoTrade');\r\n  calf.hideGuildInfoSecureTrade = getValue('hideGuildInfoSecureTrade');\r\n  calf.hideGuildInfoBuff = getValue('hideGuildInfoBuff');\r\n  calf.hideGuildInfoMessage = getValue('hideGuildInfoMessage');\r\n  calf.hideBuffSelected = getValue('hideBuffSelected');\r\n  calf.enableTempleAlert = getValue('enableTempleAlert');\r\n  calf.enableUpgradeAlert = getValue('enableUpgradeAlert');\r\n  calf.enableComposingAlert = getValue('enableComposingAlert');\r\n  calf.enableActiveBountyList = getValue('enableActiveBountyList');\r\n  calf.enableWantedList = getValue('enableWantedList');\r\n  calf.wantedGuildMembers = getValue('wantedGuildMembers');\r\n  calf.allyEnemyOnlineRefreshTime =\r\n    getValue('allyEnemyOnlineRefreshTime') * 1000;\r\n}\r\n\r\nfunction callAllyEnemy() {\r\n  if (calf.enableAllyOnlineList ||\r\n      calf.enableEnemyOnlineList) {\r\n    add(3, prepareAllyEnemyList);\r\n  }\r\n}\r\n\r\nfunction callBounties() {\r\n  if (calf.enableWantedList ||\r\n      calf.enableActiveBountyList) {\r\n    add(3, prepareBountyData);\r\n  }\r\n}\r\n\r\nfunction callGuildInfo() {\r\n  if (calf.enableGuildInfoWidgets) {\r\n    add(3, addGuildInfoWidgets);\r\n  }\r\n}\r\n\r\nfunction callAllies() {\r\n  if (calf.enableOnlineAlliesWidgets) {\r\n    add(3, addOnlineAlliesWidgets);\r\n  }\r\n}\r\n\r\nfunction callTemple() {\r\n  if (calf.enableTempleAlert) {\r\n    add(3, injectTempleAlert);\r\n  }\r\n}\r\n\r\nfunction callUpgrade() {\r\n  if (calf.enableUpgradeAlert) {\r\n    add(3, injectUpgradeAlert);\r\n  }\r\n}\r\n\r\nfunction callComposing() {\r\n  if (calf.enableComposingAlert) {\r\n    add(3, injectComposeAlert);\r\n  }\r\n}\r\n\r\nfunction conditional() {\r\n  callAllyEnemy();\r\n  callBounties();\r\n  callGuildInfo();\r\n  callAllies();\r\n  callTemple();\r\n  callUpgrade();\r\n  callComposing();\r\n}\r\n\r\nfunction moveRHSBoxUpOnRHS(title) {\r\n  var box = getElementById(title);\r\n  if (box) {\r\n    afterBegin(pCR, box);\r\n  }\r\n}\r\n\r\nfunction moveRHSBoxToLHS(title) {\r\n  var boxDiv = getElementById(title);\r\n  if (boxDiv) {\r\n    boxDiv.classList.add('pCR');\r\n    getElementById('pCL').appendChild(boxDiv);\r\n  }\r\n}\r\n\r\nfunction doMoveGuildList() {\r\n  if (getValue('moveGuildList')) {\r\n    add(3, moveRHSBoxUpOnRHS, ['minibox-guild']);\r\n  }\r\n}\r\n\r\nfunction doMoveAllyList() {\r\n  if (getValue('moveOnlineAlliesList')) {\r\n    add(3, moveRHSBoxUpOnRHS, ['minibox-allies']);\r\n  }\r\n}\r\n\r\nfunction doMoveFsBox() {\r\n  if (getValue('moveFSBox')) {\r\n    add(3, moveRHSBoxToLHS, ['minibox-fsbox']);\r\n  }\r\n}\r\n\r\nfunction doMoveDailyQuest() {\r\n  if (getValue('moveDailyQuest')) {\r\n    add(3, moveRHSBoxToLHS, ['minibox-daily-quest']);\r\n  }\r\n}\r\n\r\nfunction fixOnlineGuildBuffLinks() {\r\n  updateHCSQuickBuffLinks(\r\n    '#minibox-guild-members-list #guild-minibox-action-quickbuff');\r\n  updateHCSQuickBuffLinks(\r\n    '#minibox-allies-list #online-allies-action-quickbuff');\r\n}\r\n\r\nfunction notHuntMode() {\r\n  if (calf.huntingMode) {return;}\r\n  // move boxes in opposite order that you want them to appear.\r\n  doMoveGuildList();\r\n  doMoveAllyList();\r\n  doMoveDailyQuest();\r\n  doMoveFsBox();\r\n\r\n  getEnvVars();\r\n  conditional();\r\n\r\n  add(3, navMenu);\r\n  add(3, statbar);\r\n\r\n  add(3, injectStaminaCalculator);\r\n  add(3, injectLevelupCalculator);\r\n\r\n  add(3, injectMenu);\r\n\r\n  if (getValue('fsboxlog')) {\r\n    add(3, injectFSBoxLog);\r\n  }\r\n  add(3, fixOnlineGuildBuffLinks);\r\n\r\n  add(3, injectJoinAllLink);\r\n  add(3, changeGuildLogHREF);\r\n  add(3, injectHomePageTwoLink);\r\n\r\n  add(3, injectQuickMsgDialogJQ);\r\n\r\n  add(3, injectServerNode);\r\n  add(3, scoutTowerLink);\r\n\r\n  add(4, guildActivity);\r\n  add(4, seLog);\r\n}\r\n\r\nfunction prepareEnv() {\r\n  if (getValue('gameHelpLink')) {\r\n    add(3, gameHelpLink);\r\n  }\r\n  calf.huntingMode = getValue('huntingMode');\r\n  add(3, replaceKeyHandler);\r\n  notHuntMode();\r\n  if (!getValue('hideHelperMenu')) {\r\n    add(3, injectHelperMenu);\r\n  }\r\n}\r\n\r\nexport default function lookForHcsData() {\r\n  var hcsData = getElementById('html');\r\n  if (hcsData && jsonParse(hcsData.dataset.hcs)['new-ui']) {\r\n    prepareEnv();\r\n  }\r\n}\r\n","export default function allowBack() {\r\n  document.querySelector('input[type=\"submit\"]')\r\n    .addEventListener('click', function(evt) {\r\n      evt.preventDefault();\r\n      var url = 'index.php?';\r\n      Array.prototype.forEach.call(\r\n        document.querySelectorAll('input:not([type=\"submit\"])' +\r\n          ':not([type=\"checkbox\"]), select, input[type=\"checkbox\"]:checked'),\r\n        function(e) {url += '&' + e.name + '=' + e.value;});\r\n      window.location = url;\r\n    });\r\n}\r\n","export var moveOptions =\r\n  '<td colspan=3 ' +\r\n  'style=\"padding-top: 2px;padding-bottom: 2px;\">' +\r\n  '<select style=\"max-width: 50px;\">' +\r\n  '<option value=\"x\">Basic Attack</option>' +\r\n  '<option value=\"0\">Block</option>' +\r\n  '<option value=\"1\">Counter Attack</option>' +\r\n  '<option value=\"2\">Critical Hit</option>' +\r\n  '<option value=\"3\">Defend</option>' +\r\n  '<option value=\"4\">Deflect</option>' +\r\n  '<option value=\"5\">Dodge</option>' +\r\n  '<option value=\"6\">Lunge</option>' +\r\n  '<option value=\"7\">Power Attack</option>' +\r\n  '<option value=\"8\">Spin Attack</option>' +\r\n  '<option value=\"9\">Piercing Strike</option>' +\r\n  '<option value=\"10\">Crush</option>' +\r\n  '<option value=\"11\">Weaken</option>' +\r\n  '<option value=\"12\">Ice Shard</option>' +\r\n  '<option value=\"13\">Fire Blast</option>' +\r\n  '<option value=\"14\">Poison</option>' +\r\n  '</select></td>';\r\nexport var tableOpts = {\r\n  paging: false,\r\n  info: false,\r\n  order: [[3, 'asc'], [0, 'asc']],\r\n  columnDefs: [\r\n    {orderable: false, targets: [9]}\r\n  ],\r\n  stateSave: true,\r\n  stateDuration: 0\r\n};\r\nexport var arenaFilter =\r\n  '<table width=\"100%\"><tbody><tr><td>' +\r\n  '<span class=\"fshBlue\"><input id=\"fshHideMoves\" type=\"checkbox\">' +\r\n  '&nbsp;Hide Matches for Completed Moves</span></td><td align=\"right\">' +\r\n  '<span class=\"fshBlue\">Min lvl:&nbsp;<input id=\"fshMinLvl\" size=\"5\">' +\r\n  '&nbsp;Max lvl:&nbsp;<input id=\"fshMaxLvl\" size=\"5\">&nbsp;&nbsp;' +\r\n  '<input id=\"fshReset\" class=\"custombutton\" type=\"button\" ' +\r\n  'value=\"Reset\"></span></td></tr></tbody></table>';\r\n\r\nexport function dontPost(e) { // jQuery\r\n  e.preventDefault();\r\n  var self = $(e.target);\r\n  var pvpId = self.prev().val();\r\n  var subcmd = self.prev().prev().val();\r\n  window.location = 'index.php?cmd=arena&subcmd=' + subcmd +\r\n    '&pvp_id=' + pvpId;\r\n}\r\n","import {createDiv} from './cElement';\r\nimport {getElementById} from '../common/getElement';\r\nimport getInventoryById from '../ajax/getInventoryById';\r\nimport jQueryNotPresent from './jQueryNotPresent';\r\nimport {pCC} from '../support/layout';\r\n\r\nvar inv;\r\nvar target;\r\n\r\nfunction selectPerf() {\r\n  var items = getElementById(target + '-items')\r\n    .getElementsByClassName('selectable-item');\r\n  if (items.length === 0) {return;}\r\n  Array.prototype.forEach.call(items, function(e) {\r\n    var thisItem = e.id.replace(target + '-item-', '');\r\n    if (inv[thisItem].craft === 'Perfect') {e.click();}\r\n  });\r\n}\r\n\r\nfunction drawFilters(data) {\r\n  inv = data.items;\r\n  var buttonDiv = createDiv({className: 'fshAC'});\r\n  buttonDiv.insertAdjacentHTML('beforeend',\r\n    '<button class=\"fshBl\">Perfect</button>');\r\n  pCC.appendChild(buttonDiv);\r\n  buttonDiv.addEventListener('click', selectPerf);\r\n}\r\n\r\nexport default function perfFilter(loc) { // jQuery.min\r\n  if (jQueryNotPresent()) {return;}\r\n  target = loc;\r\n  getInventoryById().done(drawFilters);\r\n}\r\n","import {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {pCC} from '../support/layout';\r\nimport perfFilter from '../common/perfFilter';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport setValue from '../system/setValue';\r\nimport {simpleCheckbox} from '../settings/simpleCheckbox';\r\n\r\nvar disableBreakdownPrompts;\r\nvar selectedList = [];\r\n\r\nfunction showComposingMessage(message, bgcolor) { // jQuery\r\n  $('#composingMessageContainer').remove();\r\n\r\n  $('#composingMessage')\r\n    .append(\r\n      $('<div/>', {\r\n        id: 'composingMessageContainer',\r\n        width: '100%'\r\n      })\r\n        .append(\r\n          $('<div/>', {id: 'composingMessageText'})\r\n            .css({\r\n              width: '90%',\r\n              'text-align': 'center',\r\n              'background-color': bgcolor,\r\n              color: 'rgb(255, 255, 255)',\r\n              margin: '5px auto 5px auto',\r\n              padding: '2px'\r\n            })\r\n            .html(message)\r\n        )\r\n    );\r\n\r\n  setTimeout(function() {\r\n    var self = $('#composingMessageContainer');\r\n    self.animate({opacity: 0}, 500, function() {\r\n      self.animate({height: 0}, 500, function() {\r\n        self.hide();\r\n      });\r\n    });\r\n  }, 5000);\r\n}\r\n\r\nfunction breakItems() { // jQuery.min\r\n  return retryAjax({\r\n    type: 'POST',\r\n    url: 'index.php?cmd=composing&subcmd=dobreakdown',\r\n    data: {'item_list[]': selectedList},\r\n    dataType: 'json'\r\n  }).done(function(response) {\r\n    if (response.error !== 0) {\r\n      showComposingMessage('Error: ' + response.msg, 'rgb(164, 28, 28)');\r\n    }\r\n    window.location = 'index.php?cmd=composing&subcmd=breakdown&m=1';\r\n  });\r\n}\r\n\r\nfunction validBreakEvent(evt) {\r\n  evt.stopPropagation();\r\n  if (selectedList.length === 0) {\r\n    showComposingMessage('Error: No items selected.', 'rgb(164, 28, 28)');\r\n    return;\r\n  }\r\n  breakItems();\r\n}\r\n\r\nfunction breakEvt(evt) {\r\n  if (disableBreakdownPrompts &&\r\n      evt.target.id === 'breakdown-selected-items') {\r\n    validBreakEvent(evt);\r\n  }\r\n}\r\n\r\nfunction itemClick(evt) {\r\n  if (!evt.target.classList.contains('selectable-item')) {return;}\r\n  var myItem = evt.target.id.replace('composing-item-', '');\r\n  var itemPos = selectedList.indexOf(myItem);\r\n  if (itemPos === -1) {\r\n    selectedList.push(myItem);\r\n  } else {\r\n    selectedList.splice(itemPos, 1);\r\n  }\r\n}\r\n\r\nfunction togglePref() {\r\n  disableBreakdownPrompts = !disableBreakdownPrompts;\r\n  setValue('disableBreakdownPrompts', disableBreakdownPrompts);\r\n}\r\n\r\nexport default function composingBreakdown() {\r\n  if (jQueryNotPresent()) {return;}\r\n  perfFilter('composing');\r\n  disableBreakdownPrompts = getValue('disableBreakdownPrompts');\r\n  getElementById('breakdown-selected-items').parentNode\r\n    .addEventListener('click', breakEvt, true);\r\n  getElementById('composing-items')\r\n    .addEventListener('click', itemClick);\r\n  pCC.insertAdjacentHTML('beforeend',\r\n    '<table class=\"fshTblCenter\"><tbody>' +\r\n    simpleCheckbox('disableBreakdownPrompts') +\r\n    '</tbody></table>');\r\n  getElementById('disableBreakdownPrompts')\r\n    .addEventListener('click', togglePref);\r\n}\r\n","import {dontPost} from './assets';\r\nimport jQueryPresent from '../common/jQueryPresent';\r\n\r\nfunction gotoPage(pageId) {\r\n  window.location = 'index.php?cmd=arena&subcmd=completed&page=' +\r\n    pageId;\r\n}\r\n\r\nfunction overrideButtons() {\r\n  var prevButton = $('#pCC input[value=\"<\"]');\r\n  var nextButton = $('#pCC input[value=\">\"]');\r\n  if (prevButton.length === 1) {\r\n    var startButton = $('<input value=\"<<\" type=\"button\">');\r\n    prevButton.before(startButton).before('&nbsp;');\r\n    startButton.click(function() {gotoPage(1);});\r\n  }\r\n  if (nextButton.length === 1) {\r\n    var lastPage = $('#pCC input[value=\"Go\"]').closest('td').prev().text()\r\n      .replace(/\\D/g, '');\r\n    var finishButton = $('<input value=\">>\" type=\"button\">');\r\n    nextButton.after(finishButton).after('&nbsp;');\r\n    finishButton.click(function() {gotoPage(lastPage);});\r\n  }\r\n  $('#pCC input[value=\"View\"]').click(dontPost);\r\n}\r\n\r\nexport default function completedArenas() { // jQuery\r\n  if (jQueryPresent()) {overrideButtons();}\r\n}\r\n","import getInventory from './getInventory';\r\n\r\nfunction rekeyInventory(data) {\r\n  data.items = data.items.reduce(function(prev, curr) {\r\n    if (curr.is_in_st) {prev.fshHasST = true;}\r\n    prev[curr.inv_id] = curr;\r\n    return prev;\r\n  }, {});\r\n  return data;\r\n}\r\n\r\nexport default function getInventoryById() {\r\n  return getInventory().pipe(rekeyInventory);\r\n}\r\n","import add from '../support/task';\r\nimport afterBegin from '../common/afterBegin';\r\nimport calf from '../support/calf';\r\nimport getInventoryById from '../ajax/getInventoryById';\r\nimport {itemRE} from '../support/dataObj';\r\nimport jQueryPresent from '../common/jQueryPresent';\r\nimport makeFolderSpans from '../common/makeFolderSpans';\r\nimport {pCC} from '../support/layout';\r\nimport toggleForce from '../common/toggleForce';\r\nimport {createDiv, createInput, createLabel} from '../common/cElement';\r\n\r\nvar itemTable;\r\nvar itemsAry;\r\nvar invItems;\r\nvar folderId = '0';\r\nvar perfBox;\r\n\r\nfunction whichTableHasItems() {\r\n  var allTables = pCC.lastElementChild.getElementsByTagName('table');\r\n  if (calf.cmd === 'crafting') {\r\n    return allTables[1];\r\n  }\r\n  return allTables[0];\r\n}\r\n\r\nfunction drawingNewItemTable() {\r\n  if (!drawingNewItemTable.itemGrid) {\r\n    drawingNewItemTable.itemGrid = createDiv({className: 'fshItemGrid'});\r\n    itemsAry.forEach(function(item) {\r\n      var itemDiv = createDiv();\r\n      var aLink = item[0].parentNode;\r\n      itemDiv.appendChild(aLink);\r\n      drawingNewItemTable.itemGrid.appendChild(itemDiv);\r\n    });\r\n    afterBegin(itemTable.parentNode, drawingNewItemTable.itemGrid);\r\n    itemTable.classList.add('fshHide');\r\n  }\r\n}\r\n\r\nfunction testFolder(item) {\r\n  return folderId !== '0' && item[2] !== folderId;\r\n}\r\n\r\nfunction testCraft(item) {\r\n  return perfBox.checked && item[3] !== 'Perfect';\r\n}\r\n\r\nfunction afn(item) {\r\n  var myDiv = item[0].parentNode.parentNode;\r\n  toggleForce(myDiv, testFolder(item) || testCraft(item));\r\n}\r\n\r\nfunction reDrawGrid() {\r\n  drawingNewItemTable();\r\n  itemsAry.forEach(afn);\r\n}\r\n\r\nfunction doHideFolders(evt) {\r\n  if (!evt.target.classList.contains('fshFolder')) {return;}\r\n  var evtFid = evt.target.dataset.folder;\r\n  if (evtFid !== folderId) {\r\n    folderId = evtFid;\r\n    reDrawGrid();\r\n  }\r\n}\r\n\r\nfunction getFolderId(item) {\r\n  if (item.equipped) {return '-2';}\r\n  return item.folder_id;\r\n}\r\n\r\nfunction enhanceWarehouse() {\r\n  itemsAry.forEach(function(item) {\r\n    var invItem = invItems[item[1]];\r\n    item.push(getFolderId(invItem), invItem.craft);\r\n  });\r\n}\r\n\r\nfunction doFolderButtons(folders) {\r\n  var inject = itemTable.parentNode.parentNode\r\n    .previousElementSibling.firstElementChild;\r\n  inject.classList.add('fshCenter');\r\n  inject.addEventListener('click', doHideFolders);\r\n  inject.insertAdjacentHTML('beforeend', makeFolderSpans(folders, true));\r\n  return inject;\r\n}\r\n\r\nfunction doPerfSwitch(inject) {\r\n  if (calf.cmd === 'crafting') {\r\n    perfBox = {checked: false};\r\n    return;\r\n  }\r\n  var perfLabel = createLabel({\r\n    className: 'fshVMid',\r\n    innerHTML: '<span class=\"fshLink\">Perfect</span> '\r\n  });\r\n  perfBox = createInput({\r\n    className: 'fshVMid',\r\n    type: 'checkbox'\r\n  });\r\n  perfBox.addEventListener('change', reDrawGrid);\r\n  perfLabel.appendChild(perfBox);\r\n  inject.insertAdjacentHTML('beforeend', ' &ensp;');\r\n  inject.appendChild(perfLabel);\r\n}\r\n\r\nfunction inventory(data) {\r\n  invItems = data.items;\r\n  add(4, enhanceWarehouse);\r\n  var inject = doFolderButtons(data.folders);\r\n  doPerfSwitch(inject);\r\n}\r\n\r\nfunction getItems() {\r\n  itemTable = whichTableHasItems();\r\n  var imgList = itemTable.getElementsByTagName('img');\r\n  itemsAry = Array.prototype.map.call(imgList, function(img) {\r\n    var tipped = img.dataset.tipped;\r\n    var matches = tipped.match(itemRE);\r\n    return [img, matches[2]];\r\n  });\r\n}\r\n\r\nexport default function craftForge() {\r\n  if (jQueryPresent()) {\r\n    getInventoryById().done(inventory);\r\n    add(3, getItems);\r\n  }\r\n}\r\n","import {beginFolderSpanElement} from '../support/dataObj';\r\n\r\nexport default function makeFolderSpans(folders, needsWorn) {\r\n  var wornSelector = '';\r\n  if (needsWorn) {\r\n    wornSelector = ' &ensp;' + beginFolderSpanElement + '-2\">Worn</span>';\r\n  }\r\n  return beginFolderSpanElement + '0\">All</span>' + wornSelector +\r\n    ' &ensp;' + beginFolderSpanElement + '-1\">Main</span>' +\r\n    Object.keys(folders).reduce(function(prev, key) {\r\n      return prev + ' &ensp;' + beginFolderSpanElement + key + '\">' +\r\n        folders[key] + '</span>';\r\n    }, '');\r\n}\r\n","import fallback from '../system/fallback';\r\nimport {getElementById} from '../common/getElement';\r\nimport setValue from '../system/setValue';\r\n\r\nvar warehouse = [];\r\nvar prefValue;\r\nvar headerIndex;\r\n\r\nfunction collapseArt(article) {\r\n  article.rows.forEach(function(el) {\r\n    el.row.classList.add('fshHide');\r\n  });\r\n  article.open = false;\r\n}\r\n\r\nfunction collapseAll() {\r\n  warehouse.forEach(function(article) {\r\n    if (article.open) {collapseArt(article);}\r\n  });\r\n}\r\n\r\nfunction expandArt(article) {\r\n  article.rows.forEach(function(el) {\r\n    el.row.classList.remove('fshHide');\r\n  });\r\n  article.open = true;\r\n}\r\n\r\nfunction expandAll() {\r\n  warehouse.forEach(function(article) {\r\n    if (!article.open) {expandArt(article);}\r\n  });\r\n}\r\n\r\nfunction isHeader(el) {\r\n  if (el.rowIndex % headerIndex === 0) {return el;}\r\n}\r\n\r\nfunction closestTr(el) {\r\n  if (el.tagName === 'TR') {\r\n    return isHeader(el);\r\n  }\r\n  if (el.tagName === 'TABLE') {return;}\r\n  return closestTr(el.parentNode);\r\n}\r\n\r\nfunction evtEnabled(evt) {\r\n  var myRow = closestTr(evt.target);\r\n  if (!myRow) {return;}\r\n  var articleNo = myRow.rowIndex / headerIndex;\r\n  var article = warehouse[articleNo];\r\n  if (article.open === false) {\r\n    collapseAll();\r\n    expandArt(article);\r\n  } else {\r\n    collapseArt(article);\r\n  }\r\n}\r\n\r\nfunction evtHdl(evt) {\r\n  if (prefValue) {evtEnabled(evt);}\r\n}\r\n\r\nfunction makeHeaderClickable(row) {\r\n  if (prefValue) {row.classList.add('fshPoint');}\r\n}\r\n\r\nfunction collapseDuringAnalysis(row, thisArticle) {\r\n  if (prefValue) {\r\n    row.classList.add('fshHide');\r\n    thisArticle.open = false;\r\n  } else {\r\n    thisArticle.open = true;\r\n  }\r\n}\r\n\r\nfunction hasExtraFn(extraFn, row) {\r\n  if (typeof extraFn === 'function') {extraFn(row);}\r\n}\r\n\r\nfunction testRowType(row, rowType, thisArticle, articleTest, extraFn) {\r\n  if (rowType === 0) {\r\n    thisArticle.header = row;\r\n    makeHeaderClickable(row);\r\n    hasExtraFn(extraFn, row);\r\n  }\r\n  if (articleTest(rowType)) {\r\n    thisArticle.rows[rowType] =\r\n      fallback(thisArticle[rowType], {});\r\n    thisArticle.rows[rowType].row = row;\r\n    collapseDuringAnalysis(row, thisArticle);\r\n  }\r\n}\r\n\r\nfunction doTagging(articleTest, extraFn, row) {\r\n  var rowType = row.rowIndex % headerIndex;\r\n  var articleNo = (row.rowIndex - rowType) / headerIndex;\r\n  warehouse[articleNo] = fallback(warehouse[articleNo], {});\r\n  var thisArticle = warehouse[articleNo];\r\n  thisArticle.rows = thisArticle.rows || [];\r\n  testRowType(row, rowType, thisArticle, articleTest, extraFn);\r\n}\r\n\r\nfunction toggleHeaderClass() {\r\n  warehouse.forEach(function(article) {\r\n    article.header.classList.toggle('fshPoint');\r\n  });\r\n}\r\n\r\nfunction togglePref(prefName) {\r\n  prefValue = !prefValue;\r\n  setValue(prefName, prefValue);\r\n  if (prefValue) {collapseAll();} else {expandAll();}\r\n  toggleHeaderClass();\r\n}\r\n\r\nfunction setupPref(prefName) {\r\n  var prefEl = getElementById(prefName);\r\n  prefValue = prefEl.checked;\r\n  getElementById(prefName)\r\n    .addEventListener('change', togglePref.bind(null, prefName));\r\n}\r\n\r\nexport default function collapse(param) {\r\n  headerIndex = param.headInd;\r\n  setupPref(param.prefName);\r\n  Array.prototype.forEach.call(param.theTable.rows,\r\n    doTagging.bind(null, param.articleTest, param.extraFn));\r\n  param.theTable.addEventListener('click', evtHdl);\r\n}\r\n","import collapse from '../common/collapse';\r\nimport {createDiv} from '../common/cElement';\r\nimport {pCC} from '../support/layout';\r\nimport {simpleCheckboxHtml} from '../settings/simpleCheckbox';\r\n\r\nfunction testArticle(rowType) {return rowType === 1;}\r\n\r\nfunction setupPref(prefName, injector) {\r\n  var flDiv = createDiv({\r\n    className: 'fshHallPref',\r\n    innerHTML: simpleCheckboxHtml(prefName)\r\n  });\r\n  injector.classList.add('fshRelative');\r\n  injector.appendChild(flDiv);\r\n}\r\n\r\nexport default function guildHall() {\r\n  var prefName = 'collapseHallPosts';\r\n  var theTable = pCC.lastElementChild;\r\n  setupPref(prefName, theTable.previousElementSibling.previousElementSibling);\r\n  collapse({\r\n    prefName: prefName,\r\n    theTable: theTable,\r\n    headInd: 3,\r\n    articleTest: testArticle\r\n  });\r\n}\r\n","export function closestTable(el) {\r\n  if (el.tagName === 'TABLE') {return el;}\r\n  return closestTable(el.parentNode);\r\n}\r\n","import {closestTable} from '../common/closest';\r\nimport dialog from '../ajax/dialog';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport {infoBox, pCC} from '../support/layout';\r\n\r\nfunction translateReturnInfo(data) {\r\n  var info = infoBox(data);\r\n  var _r = {r: 1, m: info};\r\n  if (info === 'Item was transferred to the guild store!') {\r\n    _r = {r: 0, m: ''};\r\n  }\r\n  return _r;\r\n}\r\n\r\nfunction guildMailboxTake(href) {\r\n  return retryAjax({url: href}).pipe(translateReturnInfo).done(dialog);\r\n}\r\n\r\nfunction takeResult(self, data) {\r\n  if (data.r === 0) {\r\n    closestTable(self).nextElementSibling.rows[0].cells[0].innerHTML =\r\n      '<span class=\"fshGreen\">Taken</span>';\r\n  }\r\n}\r\n\r\nfunction guildMailboxEvent(e) { // jQuery.min\r\n  var self = e.target;\r\n  if (self.tagName === 'IMG') {\r\n    e.preventDefault();\r\n    var anchor = self.parentNode.href;\r\n    guildMailboxTake(anchor).done(takeResult.bind(null, self));\r\n  }\r\n  if (self.className === 'sendLink') {\r\n    var nodeList = pCC.getElementsByTagName('img');\r\n    Array.prototype.forEach.call(nodeList, function(el) {el.click();});\r\n  }\r\n}\r\n\r\nexport default function guildMailbox() {\r\n  if (jQueryNotPresent()) {return;}\r\n  pCC.addEventListener('click', guildMailboxEvent);\r\n  document.querySelector('#pCC td[height=\"25\"]')\r\n    .insertAdjacentHTML('beforeend',\r\n      '<span class=\"sendLink\">Take All</span>');\r\n}\r\n","import calf from '../support/calf';\r\nimport currentGuildId from '../common/currentGuildId';\r\nimport getForage from './getForage';\r\nimport {now} from '../support/dataObj';\r\nimport retryAjax from './retryAjax';\r\nimport setForage from './setForage';\r\n\r\nfunction getGuild(guildId) {\r\n  return retryAjax({\r\n    dataType: 'json',\r\n    url: 'index.php',\r\n    data: {\r\n      cmd: 'export',\r\n      subcmd: 'guild_members',\r\n      guild_id: guildId\r\n    }\r\n  });\r\n}\r\n\r\nfunction addMembrListToForage(membrList) {\r\n  getForage('fsh_membrList')\r\n    .done(function saveMembrListInForage(data) {\r\n      var oldMemList = data || {};\r\n      setForage('fsh_membrList', $.extend(oldMemList, membrList));\r\n    });\r\n}\r\n\r\nfunction getGuildMembers(guildId) {\r\n  return getGuild(guildId).pipe(function membrListToHash(data) {\r\n    var membrList = {};\r\n    membrList[guildId] = {};\r\n    membrList[guildId].lastUpdate = now;\r\n    data.forEach(function memberToObject(ele) {\r\n      membrList[guildId][ele.username] = ele;\r\n    });\r\n    return membrList;\r\n  });\r\n}\r\n\r\nvar testList = [\r\n  function(guildId, membrList) {return Boolean(membrList);},\r\n  function(guildId, membrList) {return typeof membrList === 'object';},\r\n  function(guildId, membrList) {return typeof membrList[guildId] === 'object';},\r\n  function(guildId, membrList) {\r\n    return typeof membrList[guildId].lastUpdate === 'number';\r\n  },\r\n  function(guildId, membrList) {\r\n    return membrList[guildId].lastUpdate > now - 300000;\r\n  }\r\n];\r\n\r\nfunction getMembrListFromForage(guildId, membrList) {\r\n  if (testList.every(function(e) {return e(guildId, membrList);})) {\r\n    return membrList;\r\n  }\r\n  return getGuildMembers(guildId).done(addMembrListToForage);\r\n}\r\n\r\nfunction guildMembers(force, guildId) {\r\n  if (force) {\r\n    return getGuildMembers(guildId).done(addMembrListToForage);\r\n  }\r\n  return getForage('fsh_membrList')\r\n    .pipe(getMembrListFromForage.bind(null, guildId));\r\n}\r\n\r\nfunction setHelperMembrList(guildId, membrList) {\r\n  calf.membrList = membrList[guildId];\r\n  return calf.membrList;\r\n}\r\n\r\nexport default function getMembrList(force) {\r\n  var guildId = currentGuildId();\r\n  return guildMembers(force, guildId)\r\n    .pipe(setHelperMembrList.bind(null, guildId));\r\n}\r\n","import add from './support/task';\r\nimport addCommas from './system/addCommas';\r\nimport calf from './support/calf';\r\nimport createDocument from './system/createDocument';\r\nimport {createTFoot} from './common/cElement';\r\nimport fallback from './system/fallback';\r\nimport {getElementById} from './common/getElement';\r\nimport getMembrList from './ajax/getMembrList';\r\nimport insertElement from './common/insertElement';\r\nimport intValue from './system/intValue';\r\nimport jQueryNotPresent from './common/jQueryNotPresent';\r\nimport {pCC} from './support/layout';\r\nimport retryAjax from './ajax/retryAjax';\r\nimport {time, timeEnd} from './support/debug';\r\n\r\nvar newSummary = {};\r\nvar advisorColumns = [\r\n  {title: '<div class=\"fshBold\">Member</div>'},\r\n  {title: '<div class=\"fshBold\">Lvl</div>', 'class': 'dt-center'},\r\n  {title: '<div class=\"fshBold\">Rank</div>', 'class': 'dt-center dt-nowrap'},\r\n  {\r\n    title: '<div class=\"fshBold\">Gold From Deposits</div>',\r\n    'class': 'dt-center'\r\n  },\r\n  {title: '<div class=\"fshBold\">Gold From Tax</div>', 'class': 'dt-center'},\r\n  {title: '<div class=\"fshBold\">Gold Total</div>', 'class': 'dt-center'},\r\n  {title: '<div class=\"fshBold\">FSP</div>', 'class': 'dt-center'},\r\n  {title: '<div class=\"fshBold\">Skill Cast</div>', 'class': 'dt-center'},\r\n  {title: '<div class=\"fshBold\">Group Create</div>', 'class': 'dt-center'},\r\n  {title: '<div class=\"fshBold\">Group Join</div>', 'class': 'dt-center'},\r\n  {title: '<div class=\"fshBold\">Relic</div>', 'class': 'dt-center'},\r\n  {title: '<div class=\"fshBold\">XP Contrib</div>', 'class': 'dt-center'}\r\n];\r\nvar membrList;\r\nvar list;\r\nvar data = [];\r\n\r\nfunction doTable() { // jQuery\r\n  $(list).dataTable({\r\n    pageLength: 25,\r\n    lengthMenu: [[25, 50, -1], [25, 50, 'All']],\r\n    autoWidth: false,\r\n    columns: advisorColumns,\r\n    stateSave: true,\r\n    stateDuration: 0\r\n  });\r\n}\r\n\r\nfunction summaryLink() {\r\n  var updateInput = pCC.getElementsByClassName('custombutton');\r\n  if (!updateInput) {return;}\r\n  updateInput[0].insertAdjacentHTML('afterend', '<span> <a href=\"index.php' +\r\n    '?cmd=guild&subcmd=advisor&subcmd2=weekly\">7-Day Summary</a></span>');\r\n}\r\n\r\nfunction playerName(f) {\r\n  if (!membrList[f]) {return f;}\r\n  return '<a href=\"index.php?cmd=profile&player_id=' +\r\n    membrList[f].id + '\">' + f + '</a>';\r\n}\r\n\r\nfunction playerLevel(f) {\r\n  if (!membrList[f]) {return '';}\r\n  return membrList[f].level;\r\n}\r\n\r\nfunction playerRank(f) {\r\n  if (!membrList[f]) {return '';}\r\n  return '<div class=\"fshAdvRank\">' +\r\n    membrList[f].rank_name + '</div>';\r\n}\r\n\r\nfunction injectAdvisorNew() {\r\n\r\n  time('guildAdvisor.injectAdvisorNew');\r\n\r\n  list = pCC.getElementsByTagName('TABLE')[1];\r\n  if (!list) {return;}\r\n  var totalRow = list.firstElementChild.lastElementChild;\r\n  var totalCell = totalRow.firstElementChild;\r\n  totalCell.className = 'fshRight';\r\n  totalCell.setAttribute('colspan', '3');\r\n  var tfoot = createTFoot();\r\n  insertElement(tfoot, totalRow);\r\n  list.className = 'fshXSmall hover';\r\n  list.firstElementChild\r\n    .removeChild(list.firstElementChild.firstElementChild);\r\n  Array.prototype.forEach.call(list.rows, function(tr) {\r\n    Array.prototype.forEach.call(tr.cells, function(td) {\r\n      td.removeAttribute('bgcolor');\r\n    });\r\n    var tdOne = tr.cells[0];\r\n    var username = tdOne.textContent.trim();\r\n    tdOne.innerHTML = playerName(username);\r\n    tdOne.insertAdjacentHTML('afterend', '<td>' + playerLevel(username) +\r\n      '</td><td>' + playerRank(username) + '</td>');\r\n  });\r\n  insertElement(list, tfoot);\r\n  add(3, doTable);\r\n  summaryLink();\r\n\r\n  timeEnd('guildAdvisor.injectAdvisorNew');\r\n\r\n}\r\n\r\nfunction returnAdvisorPage(e, response) {\r\n\r\n  time('guildAdvisor.returnAdvisorPage' + e);\r\n\r\n  list.lastElementChild.lastElementChild\r\n    .insertAdjacentHTML('beforeend', ' day ' + e + ',');\r\n  var doc = createDocument(response);\r\n  var table = getElementById('pCC', doc).firstElementChild\r\n    .firstElementChild.lastElementChild.firstElementChild.firstElementChild;\r\n  var tr = table.rows;\r\n  Array.prototype.forEach.call(tr, function(el) {\r\n    var tds = el.cells;\r\n    var member = tds[0].textContent.trim();\r\n    if (member === 'Member') {return;}\r\n    newSummary[member] = fallback(newSummary[member], {});\r\n    newSummary[member].deposit =\r\n      fallback(newSummary[member].deposit, 0) +\r\n      intValue(tds[1].textContent);\r\n    newSummary[member].tax = fallback(newSummary[member].tax, 0) +\r\n      intValue(tds[2].textContent);\r\n    newSummary[member].total = fallback(newSummary[member].total, 0) +\r\n      intValue(tds[3].textContent);\r\n    newSummary[member].fsp = fallback(newSummary[member].fsp, 0) +\r\n      intValue(tds[4].textContent);\r\n    newSummary[member].skills = fallback(newSummary[member].skills, 0) +\r\n      intValue(tds[5].textContent);\r\n    newSummary[member].grpCrt = fallback(newSummary[member].grpCrt, 0) +\r\n      intValue(tds[6].textContent);\r\n    newSummary[member].grpJoin =\r\n      fallback(newSummary[member].grpJoin, 0) +\r\n      intValue(tds[7].textContent);\r\n    newSummary[member].relics = fallback(newSummary[member].relics, 0) +\r\n      intValue(tds[8].textContent);\r\n    newSummary[member].contrib =\r\n      fallback(newSummary[member].contrib, 0) +\r\n      intValue(tds[9].textContent);\r\n  });\r\n\r\n  timeEnd('guildAdvisor.returnAdvisorPage' + e);\r\n\r\n}\r\n\r\nfunction getAdvisorPage(e) { // jQuery\r\n  return retryAjax({\r\n    url: 'index.php',\r\n    data: {\r\n      no_mobile: 1,\r\n      cmd: 'guild',\r\n      subcmd: 'advisor',\r\n      period: e\r\n    }\r\n  }).done(returnAdvisorPage.bind(null, e));\r\n}\r\n\r\nfunction displayAdvisor() { // jQuery\r\n\r\n  time('guildAdvisor.displayAdvisor');\r\n\r\n  list.className = 'fshXSmall hover';\r\n  list.innerHTML = '<tfoot id=\"advTFoot\"><tr><td class=\"fshRight\" ' +\r\n    'colspan=\"3\">Total: </td><td><u>' +\r\n    addCommas(newSummary['Total:'].deposit) + '</u></td><td><u>' +\r\n    addCommas(newSummary['Total:'].tax) + '</u></td><td><u>' +\r\n    addCommas(newSummary['Total:'].total) + '</u></td><td><u>' +\r\n    addCommas(newSummary['Total:'].fsp) + '</u></td><td><u>' +\r\n    addCommas(newSummary['Total:'].skills) + '</u></td><td><u>' +\r\n    addCommas(newSummary['Total:'].grpCrt) + '</u></td><td><u>' +\r\n    addCommas(newSummary['Total:'].grpJoin) + '</u></td><td><u>' +\r\n    addCommas(newSummary['Total:'].relics) + '</u></td><td><u>' +\r\n    addCommas(newSummary['Total:'].contrib) +\r\n      '</u></td></tr></tfoot>';\r\n  $(list).dataTable({\r\n    data: data,\r\n    pageLength: 25,\r\n    lengthMenu: [[25, 50, -1], [25, 50, 'All']],\r\n    autoWidth: false,\r\n    columns: advisorColumns,\r\n    stateSave: true,\r\n    stateDuration: 0\r\n  });\r\n\r\n  timeEnd('guildAdvisor.displayAdvisor');\r\n\r\n}\r\n\r\nfunction addStats(f) {\r\n  if (f === 'Total:') {return;}\r\n  data.push([\r\n    playerName(f),\r\n    playerLevel(f),\r\n    playerRank(f),\r\n    addCommas(newSummary[f].deposit),\r\n    addCommas(newSummary[f].tax),\r\n    addCommas(newSummary[f].total),\r\n    addCommas(newSummary[f].fsp),\r\n    addCommas(newSummary[f].skills),\r\n    addCommas(newSummary[f].grpCrt),\r\n    addCommas(newSummary[f].grpJoin),\r\n    addCommas(newSummary[f].relics),\r\n    addCommas(newSummary[f].contrib),\r\n  ]);\r\n}\r\n\r\nfunction addAdvisorPages() {\r\n  Object.keys(newSummary).forEach(addStats);\r\n  add(3, displayAdvisor);\r\n}\r\n\r\nfunction injectAdvisorWeekly() { // jQuery\r\n\r\n  time('guildAdvisor.injectAdvisorWeekly');\r\n\r\n  list = pCC.firstElementChild.firstElementChild\r\n    .lastElementChild.firstElementChild.firstElementChild;\r\n  if (!list) {return;}\r\n  list.innerHTML = '<span class=\"fshCurveContainer fshFlex\">' +\r\n    '<span class=\"fshCurveEle fshCurveLbl fshOldSpinner\"></span>' +\r\n    '<span class=\"fshSpinnerMsg\">&nbsp;Retrieving daily data ...</span>' +\r\n    '</span>';\r\n\r\n  $.when(\r\n    getMembrList(false)\r\n      .done(function(response) {\r\n        membrList = response;\r\n      }),\r\n    getAdvisorPage(1),\r\n    getAdvisorPage(2),\r\n    getAdvisorPage(3),\r\n    getAdvisorPage(4),\r\n    getAdvisorPage(5),\r\n    getAdvisorPage(6),\r\n    getAdvisorPage(7)\r\n  ).done(function() {\r\n    add(3, addAdvisorPages);\r\n  });\r\n\r\n  timeEnd('guildAdvisor.injectAdvisorWeekly');\r\n\r\n}\r\n\r\nexport default function injectAdvisor() {\r\n  if (jQueryNotPresent()) {return;}\r\n  if (calf.subcmd2 === 'weekly') {\r\n    injectAdvisorWeekly();\r\n  } else {\r\n    getMembrList(false).done(function(response) {\r\n      membrList = response;\r\n      add(3, injectAdvisorNew);\r\n    });\r\n  }\r\n}\r\n","import {defaults} from '../support/dataObj';\r\nimport fallback from '../system/fallback';\r\nimport getForage from '../ajax/getForage';\r\nimport intValue from '../system/intValue';\r\nimport isObject from '../common/isObject';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport setForage from '../ajax/setForage';\r\nimport {arenaFilter, dontPost, tableOpts} from './assets';\r\nimport {time, timeEnd} from '../support/debug';\r\n\r\nvar tabs;\r\nvar theTables;\r\nvar opts;\r\nvar oldIds;\r\n\r\nfunction levelsAreNotNaN(minLvl, maxLvl) {\r\n  return !isNaN(minLvl) && !isNaN(maxLvl);\r\n}\r\n\r\nfunction changeLvls() { // jQuery\r\n  var minLvl = parseInt($('#fshMinLvl').val(), 10);\r\n  var maxLvl = parseInt($('#fshMaxLvl').val(), 10);\r\n  if (levelsAreNotNaN(minLvl, maxLvl)) {\r\n    opts = fallback(opts, {});\r\n    opts.minLvl = minLvl;\r\n    opts.maxLvl = maxLvl;\r\n    setForage('fsh_arena', opts);\r\n    $('#arenaTypeTabs table[width=\"635\"]').DataTable().draw();\r\n  }\r\n}\r\n\r\nfunction resetLvls() { // jQuery\r\n  opts = opts || {};\r\n  opts.minLvl = defaults.arenaMinLvl;\r\n  opts.maxLvl = defaults.arenaMaxLvl;\r\n  setForage('fsh_arena', opts);\r\n  $('#fshMinLvl').val(opts.minLvl);\r\n  $('#fshMaxLvl').val(opts.maxLvl);\r\n  $('#arenaTypeTabs table[width=\"635\"]').DataTable().draw();\r\n}\r\n\r\nfunction hideMoves(evt) { // jQuery\r\n  opts = opts || {};\r\n  opts.hideMoves = evt.target.checked;\r\n  setForage('fsh_arena', opts);\r\n  $('.moveMax').toggle(!evt.target.checked);\r\n}\r\n\r\nfunction testIsNotDesc(test) {\r\n  return test && test[1] === '_desc';\r\n}\r\n\r\nfunction sortHandler(evt) { // jQuery\r\n  var self = $(evt.target).closest('td');\r\n  var table = self.closest('table').DataTable();\r\n  var myCol = self.index();\r\n  var classes = self.attr('class');\r\n  var test = /sorting([^\\s]+)/.exec(classes);\r\n  var sortOrder = 'desc';\r\n  if (testIsNotDesc(test)) {sortOrder = 'asc';}\r\n  if (myCol !== 3) {\r\n    table.order([3, 'asc'], [myCol, sortOrder]).draw();\r\n  } else {\r\n    table.order([3, sortOrder]).draw();\r\n  }\r\n}\r\n\r\nfunction hideMovesCheckbox(aTable) { // jQuery\r\n  var fshHideMoves = $('#fshHideMoves', aTable);\r\n  if (opts && 'hideMoves' in opts) {\r\n    fshHideMoves.prop('checked', opts.hideMoves);\r\n    $('.moveMax').toggle(!opts.hideMoves);\r\n  }\r\n  fshHideMoves.click(hideMoves);\r\n}\r\n\r\nfunction minLvlValue(aTable) { // jQuery\r\n  var fshMinLvl = $('#fshMinLvl', aTable);\r\n  if (opts && 'minLvl' in opts) {\r\n    fshMinLvl.val(opts.minLvl);\r\n  } else {\r\n    fshMinLvl.val(defaults.arenaMinLvl);\r\n  }\r\n}\r\n\r\nfunction maxLvlValue(aTable) { // jQuery\r\n  var fshMaxLvl = $('#fshMaxLvl', aTable);\r\n  if (opts && 'maxLvl' in opts) {\r\n    fshMaxLvl.val(opts.maxLvl);\r\n  } else {\r\n    fshMaxLvl.val(defaults.arenaMaxLvl);\r\n  }\r\n}\r\n\r\nfunction filterHeader() { // jQuery\r\n  var theRow = $('#pCC > table > tbody > tr:nth-child(7)');\r\n  theRow.clone().insertBefore(theRow).find('td').attr('height', '2');\r\n  theRow.clone().insertAfter(theRow).find('td').attr('height', '1');\r\n  var aTable = $(arenaFilter);\r\n  hideMovesCheckbox(aTable);\r\n  minLvlValue(aTable);\r\n  maxLvlValue(aTable);\r\n  $('#fshMinLvl, #fshMaxLvl', aTable).keyup(changeLvls);\r\n  $('#fshReset', aTable).click(resetLvls);\r\n  $('td', theRow).append(aTable);\r\n}\r\n\r\nvar doLvlFilter = [\r\n  function(min) {return !min;},\r\n  function(min, max) {return !max;},\r\n  function(min, max) {return isNaN(min) && isNaN(max);},\r\n  function(min, max, level) {return isNaN(min) && level <= max;},\r\n  function(min, max, level) {return min <= level && isNaN(max);},\r\n  function(min, max, level) {return min <= level && level <= max;}\r\n];\r\n\r\nfunction hazOpts(_settings, data) {\r\n  var min = opts.minLvl;\r\n  var max = opts.maxLvl;\r\n  var level = intValue(data[7]);\r\n  for (var i = 0; i < doLvlFilter.length; i += 1) {\r\n    if (doLvlFilter[i](min, max, level)) {return true;}\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction lvlFilter(_settings, data) {\r\n  if (opts) {return hazOpts(_settings, data);}\r\n  return true;\r\n}\r\n\r\nfunction players(cell) { // jQuery\r\n  var matches = /(\\d+)\\s\\/\\s(\\d+)/.exec(cell.text());\r\n  if (matches) {\r\n    cell.attr('data-order', matches[2] * 1000 + Number(matches[1]));\r\n  }\r\n}\r\n\r\nfunction boolData(cell) { // jQuery\r\n  var matches = /(\\d)\\.gif/.exec($('img', cell).attr('src'));\r\n  if (matches) {cell.attr('data-order', matches[1]);}\r\n}\r\n\r\nfunction hazMaxMoves(matches, row) { // jQuery\r\n  if (opts.moves[matches[1]] &&\r\n    opts.moves[matches[1]].count === 3) {\r\n    row.addClass('moveMax');\r\n  }\r\n}\r\n\r\nfunction optsHazMoves(cell, row) { // jQuery\r\n  var matches = /\\/pvp\\/(\\d+)\\.gif/.exec($('img', cell).attr('src'));\r\n  if (matches) {\r\n    hazMaxMoves(matches, row);\r\n    cell.attr('data-order', matches[1]);\r\n  }\r\n}\r\n\r\nfunction maxMoves(cell, row) { // jQuery\r\n  if (opts && opts.moves) {\r\n    optsHazMoves(cell, row);\r\n  }\r\n}\r\n\r\nfunction reward(cell) { // jQuery\r\n  if (cell.children('table').length !== 1) {return;}\r\n  cell.attr('data-order', cell.find('td').first().text().replace(/[,\\s]/g, ''));\r\n}\r\n\r\nfunction colourNewRow(row, id) { // jQuery\r\n  if (oldIds && !oldIds[id]) {\r\n    row.css('background-color', '#F5F298');\r\n    row.find('tr').css('background-color', '#F5F298');\r\n  }\r\n}\r\n\r\nfunction checkTournamentId(row, cell) { // jQuery\r\n  var matches = /#\\s(\\d+)/.exec(cell.text());\r\n  if ([matches, opts, opts.id].every(isObject)) {\r\n    opts.id[matches[1]] = matches[1];\r\n    colourNewRow(row, matches[1]);\r\n  }\r\n}\r\n\r\nfunction orderData(i, e) { // jQuery\r\n  var row = $(e);\r\n  var theCells = row.children();\r\n  var cell = theCells.eq(0);\r\n  checkTournamentId(row, cell);\r\n  players(theCells.eq(1));\r\n  cell = theCells.eq(2);\r\n  cell.attr('data-order', $('td', cell).first().text().replace(/[,\\s]/g, ''));\r\n  boolData(theCells.eq(4));\r\n  boolData(theCells.eq(5));\r\n  boolData(theCells.eq(6));\r\n  maxMoves(theCells.eq(8), row);\r\n  reward(theCells.eq(8));\r\n}\r\n\r\nfunction redoHead(i, e) { // jQuery\r\n  var firstRow = $('tr', e).first();\r\n  $('a', firstRow).contents().unwrap();\r\n  $(e).prepend($('<thead/>').append(firstRow));\r\n}\r\n\r\nfunction process(arena) { // jQuery\r\n\r\n  time('arena.process');\r\n\r\n  theTables.each(redoHead);\r\n  opts = arena || {};\r\n  oldIds = opts.id || {};\r\n  opts.id = {};\r\n  var myRows = theTables.children('tbody').children('tr');\r\n  myRows.each(orderData);\r\n  filterHeader();\r\n  setForage('fsh_arena', opts);\r\n  $.fn.dataTable.ext.search.push(lvlFilter);\r\n  theTables.DataTable(tableOpts);\r\n  $('td.sorting, td.sorting_asc, td.sorting_desc', tabs).off('click');\r\n  $('div.dataTables_filter').hide();\r\n  tabs.on('click', 'td.sorting, td.sorting_asc, td.sorting_desc', sortHandler);\r\n  tabs.on('click', 'input.custombutton[type=\"submit\"]', dontPost);\r\n\r\n  timeEnd('arena.process');\r\n\r\n}\r\n\r\nexport default function injectArena() { // jQuery\r\n  if (jQueryNotPresent()) {return;}\r\n  tabs = $('#arenaTypeTabs');\r\n  if (tabs.length !== 1) {return;} // Join error screen\r\n  theTables = $('table[width=\"635\"]', tabs);\r\n  getForage('fsh_arena').done(process);\r\n}\r\n","import isType from './isType';\r\n\r\nexport default function isObject(e) {return isType(e, 'object');}\r\n","import buyitem from './app/potionbazaar/buyitem';\r\nimport {getElementById} from './common/getElement';\r\nimport jQueryNotPresent from './common/jQueryNotPresent';\r\nimport jsonFail from './common/jsonFail';\r\nimport outputResult from './common/outputResult';\r\nimport {pCC} from './support/layout';\r\nimport testQuant from './system/testQuant';\r\n\r\nvar ItemId;\r\nvar bazaarTable =\r\n  '<table id=\"fshBazaar\"><tr><td colspan=\"5\">Select an item to quick-buy:' +\r\n  '</td></tr><tr><td colspan=\"5\">Select how many to quick-buy</td></tr>' +\r\n  '<tr><td colspan=\"5\"><input id=\"buy_amount\" class=\"fshNumberInput\" ' +\r\n  'type=\"number\" min=\"0\" max=\"99\" value=\"1\"></td></tr><tr><td>@0@</td>' +\r\n  '<td>@1@</td><td>@2@</td><td>@3@</td><td>@4@</td></tr><tr><td>@5@</td>' +\r\n  '<td>@6@</td><td>@7@</td><td>@8@</td><td>@9@</td></tr><tr>' +\r\n  '<td colspan=\"3\">Selected item:</td><td id=\"selectedItem\" colspan=\"2\">' +\r\n  '</td></tr><tr><td colspan=\"5\">' +\r\n  '<span id=\"fshBazaarWarning\" class=\"fshHide\">' +\r\n  'Warning:<br>pressing [<span id=\"fshBuy\" class=\"fshLink\">This button' +\r\n  '</span>] now will buy the <span id=\"quantity\">1</span> item(s) WITHOUT ' +\r\n  'confirmation!</span></td></tr><tr><td colspan=\"5\">' +\r\n  '<span id=\"buyResultLabel\"></span><ol id=\"buy_result\"></ol>' +\r\n  '</td>' +\r\n  '</tr></table>';\r\nvar bazaarItem =\r\n  '<span class=\"bazaarButton tip-dynamic\" style=\"background-image: ' +\r\n  'url(\\'@src@\\');\" itemid=\"@itemid@\" data-tipped=\"@tipped@\"></span>';\r\n\r\nfunction testBuyAmount() {\r\n  return testQuant(getElementById('buy_amount').value);\r\n}\r\n\r\nfunction select(evt) {\r\n  var target = evt.target;\r\n  if (!target.classList.contains('bazaarButton')) {return;}\r\n  var theValue = testBuyAmount();\r\n  if (!theValue) {return;}\r\n  getElementById('quantity').textContent = theValue;\r\n  ItemId = target.getAttribute('itemid');\r\n  getElementById('fshBazaarWarning').removeAttribute('class');\r\n  var dupNode = target.cloneNode(false);\r\n  dupNode.className = 'bazaarSelected tip-dynamic';\r\n  var selected = getElementById('selectedItem');\r\n  selected.innerHTML = '';\r\n  selected.appendChild(dupNode);\r\n}\r\n\r\nfunction quantity() {\r\n  var theValue = testBuyAmount();\r\n  if (theValue) {\r\n    getElementById('quantity').textContent = theValue;\r\n  }\r\n}\r\n\r\nfunction done(json) {\r\n  var buyResult = getElementById('buy_result');\r\n  if (jsonFail(json, buyResult)) {return;}\r\n  if (json.s) {\r\n    outputResult('You purchased the item!', buyResult);\r\n  }\r\n}\r\n\r\nfunction buy() { // jQuery.min\r\n  if (!ItemId) {return;}\r\n  var buyAmount = getElementById('quantity').textContent;\r\n  getElementById('buyResultLabel').textContent =\r\n    'Buying ' + buyAmount + ' items';\r\n  for (var i = 0; i < buyAmount; i += 1) {\r\n    buyitem(ItemId).done(done);\r\n  }\r\n}\r\n\r\nexport default function injectBazaar() { // TODO stop using getElementById\r\n  if (jQueryNotPresent()) {return;}\r\n  var pbImg = pCC.getElementsByTagName('IMG')[0];\r\n  pbImg.className = 'fshFloatLeft';\r\n  var potions = pCC.getElementsByTagName('A');\r\n  Array.prototype.forEach.call(potions, function(el, i) {\r\n    var item = el.firstElementChild;\r\n    var tipped = item.dataset.tipped;\r\n    bazaarTable = bazaarTable\r\n      .replace('@' + i + '@', bazaarItem)\r\n      .replace('@src@', item.getAttribute('src'))\r\n      .replace('@itemid@', tipped.match(/\\?item_id=(\\d+)/)[1])\r\n      .replace('@tipped@', tipped);\r\n  });\r\n  bazaarTable = bazaarTable.replace(/@\\d@/g, '');\r\n  pbImg.parentNode.insertAdjacentHTML('beforeend', bazaarTable);\r\n  getElementById('fshBazaar').addEventListener('click', select);\r\n  getElementById('buy_amount').addEventListener('input', quantity);\r\n  getElementById('fshBuy').addEventListener('click', buy);\r\n}\r\n","function theValueIsValid(theValue, min, max) {\r\n  return !isNaN(theValue) && theValue > min && theValue < max;\r\n}\r\n\r\nexport default function testRange(aValue, min, max) {\r\n  var theValue = parseInt(aValue, 10);\r\n  if (theValueIsValid(theValue, min, max)) {\r\n    return theValue;\r\n  }\r\n}\r\n","import testRange from './testRange';\r\n\r\nexport default function testQuant(aValue) {\r\n  return testRange(aValue, 0, 100);\r\n}\r\n","import callApp from '../callApp';\r\n\r\nexport default function buyitem(item) {\r\n  return callApp({\r\n    cmd: 'potionbazaar',\r\n    subcmd: 'buyitem',\r\n    item_id: item\r\n  });\r\n}\r\n","import calf from '../../support/calf';\r\nimport {getElementById} from '../../common/getElement';\r\nimport getValue from '../../system/getValue';\r\nimport {sendEvent} from '../../support/fshGa';\r\nimport {pCC, playerName} from '../../support/layout';\r\n\r\nvar buffCost = {count: 0, buffs: {}};\r\nvar numRE = /[^a-zA-Z0-9.,+\\- ]/g;\r\nvar priceRE =\r\n  /([+-]{0,1}[.\\d]+ *k)|([+-]{0,1}[.\\d]+ *fsp)|([+-]{0,1}[.\\d]+ *stam)/;\r\n\r\nfunction profileBuyBuffsEvent() {\r\n  if (calf.subcmd === '-') {sendEvent('profile', 'formatBuffsToBuy');}\r\n}\r\n\r\nfunction getTargetPlayer() {\r\n  var targetPlayer = pCC\r\n    .getElementsByTagName('h1');\r\n  if (targetPlayer.length !== 0) {\r\n    targetPlayer = targetPlayer[0].textContent;\r\n  } else {\r\n    targetPlayer = playerName();\r\n  }\r\n  return targetPlayer;\r\n}\r\n\r\nfunction formatBuffsToBuy() { // Legacy\r\n  profileBuyBuffsEvent();\r\n  var targetPlayer = getTargetPlayer();\r\n  var buffsToBuy = Object.keys(buffCost.buffs).join(', ');\r\n  var greetingText = getValue('buyBuffsGreeting').trim();\r\n  var hasBuffTag = greetingText.indexOf('{buffs}') !== -1;\r\n  var hasCostTag = greetingText.indexOf('{cost}') !== -1;\r\n  greetingText = greetingText.replace(/{playername}/g, targetPlayer);\r\n  if (!hasBuffTag) {\r\n    greetingText += ' ' + buffsToBuy;\r\n  } else if (!hasCostTag) {\r\n    greetingText = greetingText\r\n      .replace(/{buffs}/g, '`~' + buffsToBuy + '~`');\r\n  } else {\r\n    greetingText = greetingText\r\n      .replace(/{buffs}/g, '`~' + buffsToBuy + '~`')\r\n      .replace(/{cost}/g, buffCost.buffCostTotalText);\r\n  }\r\n  window.openQuickMsgDialog(targetPlayer, greetingText, '');\r\n}\r\n\r\nfunction getBuffsToBuy() { // Legacy\r\n  if (buffCost.count > 0) {formatBuffsToBuy();}\r\n}\r\n\r\nvar costFormatter = [\r\n  {\r\n    condition: function(total) {\r\n      return total.fsp > 0;\r\n    },\r\n    result: function(total) {\r\n      return String(Math.round(total.fsp * 100) / 100) + ' FSP';\r\n    }\r\n  },\r\n  {\r\n    condition: function(total) {\r\n      return total.fsp > 0 && total.k > 0;\r\n    },\r\n    result: function() {\r\n      return ' and ';\r\n    }\r\n  },\r\n  {\r\n    condition: function(total) {\r\n      return total.k > 0;\r\n    },\r\n    result: function(total) {\r\n      return total.k + ' k';\r\n    }\r\n  },\r\n  {\r\n    condition: function(total) {\r\n      return total.stam > 0 && (total.fsp > 0 || total.k > 0);\r\n    },\r\n    result: function() {\r\n      return ' and ';\r\n    }\r\n  },\r\n  {\r\n    condition: function(total) {\r\n      return total.stam > 0;\r\n    },\r\n    result: function(total) {\r\n      return total.stam + ' Stam(' +\r\n        String(Math.round(total.stam / 25 * 10) / 10) + 'fsp)';\r\n    }\r\n  },\r\n  {\r\n    condition: function(total) {\r\n      return total.unknown > 0;\r\n    },\r\n    result: function(total) {\r\n      return ' (' + total.unknown + ' buff(s) with unknown cost)';\r\n    }\r\n  }\r\n];\r\n\r\nfunction formatCost(total) {\r\n  return costFormatter.reduce(function(prev, el) {\r\n    var ret = prev;\r\n    if (el.condition(total)) {\r\n      ret += el.result(total);\r\n    }\r\n    return ret;\r\n  }, '');\r\n}\r\n\r\nfunction hazBuffs() { // Legacy\r\n  var total = {k: 0, fsp: 0, stam: 0, unknown: 0};\r\n  var html = 'This is an estimated cost based on how the script finds ' +\r\n    'the cost associated with buffs from viewing bio.' +\r\n    'It can be incorrect, please use with discretion.<br><hr>' +\r\n    '<table border=0>';\r\n\r\n  Object.keys(buffCost.buffs).forEach(function(buff) {\r\n    total[buffCost.buffs[buff][1]] += buffCost.buffs[buff][0];\r\n    html += '<tr><td>' + buff + '</td><td>: ' + buffCost.buffs[buff][0] +\r\n      buffCost.buffs[buff][1] + '</td></tr>';\r\n  });\r\n\r\n  var totalText = formatCost(total);\r\n\r\n  html += '</table><b>Total: ' + totalText + '</b>';\r\n  getElementById('buffCost').innerHTML = '<br/><span ' +\r\n    'class=\"tip-static\" data-tipped=\"' + html + '\">Estimated Cost: <b>' +\r\n    totalText + '</b></span>';\r\n  buffCost.buffCostTotalText = totalText;\r\n}\r\n\r\nfunction updateBuffCost() { // Legacy\r\n  if (buffCost.count > 0) {\r\n    hazBuffs();\r\n  } else {\r\n    getElementById('buffCost').innerHTML = '';\r\n    buffCost.buffCostTotalText = '';\r\n  }\r\n}\r\n\r\nfunction priceUnit(price) {\r\n  if (price[0].indexOf('k') > 0) {\r\n    return 'k';\r\n  }\r\n  if (price[0].indexOf('f') > 0) {\r\n    return 'fsp';\r\n  }\r\n  return 'stam';\r\n}\r\n\r\nfunction thisLine(node) {\r\n  return node && node.nodeName.toLowerCase() !== 'br';\r\n}\r\n\r\nfunction priceBeforeName(buffNameNode, price) {\r\n  if (!price) { // some players have prices BEFORE the buff names\r\n    var newtext;\r\n    var text = '';\r\n    var node = buffNameNode;\r\n    while (thisLine(node)) {\r\n      newtext = node.textContent;\r\n      node = node.previousSibling;\r\n      text = newtext + text;\r\n    }\r\n    return text.replace(numRE, '').toLowerCase().match(priceRE);\r\n  }\r\n  return price;\r\n}\r\n\r\nfunction getBuffCost(buffNameNode) {\r\n  var node = buffNameNode;\r\n  var buffName = node.textContent;\r\n  var newtext;\r\n  var text = '';\r\n  // get the whole line from the buff name towards the end (even after\r\n  // the ',', in case of 'AL, Lib, Mer: 10k each'\r\n  while (thisLine(node)) {\r\n    newtext = node.textContent;\r\n    node = node.nextSibling;\r\n    text += newtext;\r\n  }\r\n  var price = text.replace(numRE, '').toLowerCase().match(priceRE);\r\n  price = priceBeforeName(buffNameNode, price);\r\n  var type;\r\n  var cost;\r\n  if (price) {\r\n    type = priceUnit(price);\r\n    cost = price[0].match(/([+-]{0,1}[.\\d]+)/)[0];\r\n  } else {\r\n    type = 'unknown';\r\n    cost = '1';\r\n  }\r\n  buffCost.buffs[buffName] = [parseFloat(cost), type];\r\n  buffCost.count += 1;\r\n}\r\n\r\nfunction toggleBuffsToBuy(evt) { // Legacy\r\n  // This is also called by bio preview\r\n  var buffNameNode = evt.target;\r\n  while (buffNameNode.tagName.toLowerCase() !== 'span') {\r\n    buffNameNode = buffNameNode.parentNode;\r\n  }\r\n  var node = buffNameNode;\r\n  var selected = node.classList.contains('fshBlue');\r\n  node.classList.toggle('fshBlue');\r\n  node.classList.toggle('fshYellow');\r\n  var buffName = node.textContent;\r\n  if (selected) {\r\n    getBuffCost(buffNameNode);\r\n  } else {\r\n    buffCost.count -= 1;\r\n    delete buffCost.buffs[buffName];\r\n  }\r\n  updateBuffCost();\r\n}\r\n\r\nfunction getBuffNameNode(e) {\r\n  var buffNameNode = e.target;\r\n  while (buffNameNode.tagName &&\r\n      buffNameNode.tagName.toLowerCase() !== 'span') {\r\n    buffNameNode = buffNameNode.parentNode;\r\n  }\r\n  return buffNameNode;\r\n}\r\n\r\nfunction isBuffLink(buffNameNode) {\r\n  return buffNameNode.classList &&\r\n    buffNameNode.classList.contains('buffLink');\r\n}\r\n\r\nexport default function bioEvtHdl(e) {\r\n  var buffNameNode = getBuffNameNode(e);\r\n  if (isBuffLink(buffNameNode)) {\r\n    toggleBuffsToBuy(e);\r\n  } else if (e.target.id === 'fshSendBuffMsg') {\r\n    getBuffsToBuy(e);\r\n  }\r\n}\r\n","import bioEvtHdl from './bioEvtHdl';\r\nimport calf from '../../support/calf';\r\nimport {getElementById} from '../../common/getElement';\r\nimport getValue from '../../system/getValue';\r\nimport insertTextBeforeEnd from '../../common/insertTextBeforeEnd';\r\nimport {pCC} from '../../support/layout';\r\nimport renderBio from './render';\r\nimport setValue from '../../system/setValue';\r\nimport testQuant from '../../system/testQuant';\r\nimport {createDiv, createInput} from '../../common/cElement';\r\n\r\nvar bioEditLines;\r\nvar textArea;\r\nvar previewArea;\r\nvar theBox;\r\n\r\nfunction convertTextToHtml(inputText) {\r\n  var ret = inputText\r\n    .replace(/</g, '&lt')\r\n    .replace(/>/g, '&gt')\r\n    .replace(/\\n/g, '<br>')\r\n    .replace(/\\[(\\/?)([biu])\\]/g, '<$1$2>')\r\n    .replace(/\\\\\\\\/g, '&#92')\r\n    .replace(/\\\\/g, '');\r\n  if (calf.cmd === 'guild') {\r\n    ret = ret\r\n      .replace(/\\[(\\/?)block\\]/g, '<$1blockquote>')\r\n      .replace(/\\[list\\]/g, '<ul class=\"list\">')\r\n      .replace(/\\[\\/list\\]/g, '</ul>')\r\n      .replace(/\\[\\*\\](.*?)<br>/g, '<li>$1</li>');\r\n  }\r\n  return ret;\r\n}\r\n\r\nfunction bioPreview() {\r\n  var widthClass = 'fshBioProfile';\r\n  if (calf.cmd === 'guild') {widthClass = 'fshBioGuild';}\r\n  var previewContainer = createDiv({\r\n    className:\r\n      'fshBioContainer ' + widthClass\r\n  });\r\n  var previewHeader = createDiv({\r\n    className: 'fshBioHeader fshBioInner',\r\n    innerHTML: 'Preview'\r\n  });\r\n  previewContainer.appendChild(previewHeader);\r\n  previewArea = createDiv({className: 'fshBioPreview fshBioInner'});\r\n  previewContainer.appendChild(previewArea);\r\n  textArea.parentNode.appendChild(previewContainer);\r\n}\r\n\r\nfunction bioWords() {\r\n  if (calf.cmd === 'profile') {\r\n    // Add description text for the new tags\r\n    pCC.insertAdjacentHTML('beforeend', '<div>' +\r\n      '`~This will allow FSH Script users to select buffs from your bio~`<br>' +\r\n      'You can use the [cmd] tag as well to determine where to put the \"Ask ' +\r\n      'For Buffs\" button<br><br><blockquote><ul class=\"list\">' +\r\n      '<li>Note 1: The ` and ~ characters are on the same key on US QWERTY ' +\r\n      'keyboards. ` is <b>NOT</b> an apostrophe.</li>' +\r\n      '<li>Note 2: Inner text will not contain special characters ' +\r\n      '(non-alphanumeric).</li>' +\r\n      '<li>P.S. Be creative with these! Wrap your buff pack names in ' +\r\n      'them to make buffing even easier!</li>' +\r\n      '</ul></blockquote></div>');\r\n  }\r\n}\r\n\r\nfunction changeHeight() {\r\n  var boxVal = testQuant(theBox.value);\r\n  if (boxVal) {\r\n    bioEditLines = boxVal;\r\n    setValue('bioEditLines', boxVal);\r\n    textArea.rows = bioEditLines;\r\n  }\r\n}\r\n\r\nfunction bioHeight() {\r\n  var bioEditLinesDiv = createDiv({innerHTML: '<br>Display '});\r\n  theBox = createInput({min: 1, max: 99, type: 'number', value: bioEditLines});\r\n  bioEditLinesDiv.appendChild(theBox);\r\n  insertTextBeforeEnd(bioEditLinesDiv, ' Lines ');\r\n  var saveLines = createInput({\r\n    className: 'custombutton',\r\n    value: 'Update Rows To Show',\r\n    type: 'button'\r\n  });\r\n  saveLines.addEventListener('click', changeHeight);\r\n  bioEditLinesDiv.appendChild(saveLines);\r\n  pCC.appendChild(bioEditLinesDiv);\r\n}\r\n\r\nfunction updateBioCharacters() {\r\n  var bioContents = convertTextToHtml(textArea.value);\r\n  bioContents = renderBio(bioContents);\r\n  previewArea.innerHTML = bioContents;\r\n}\r\n\r\nexport default function injectBioWidgets() {\r\n  bioEditLines = getValue('bioEditLines');\r\n  textArea = getElementById('textInputBox');\r\n  bioPreview();\r\n  bioWords();\r\n  bioHeight();\r\n  textArea.rows = bioEditLines;\r\n  if (calf.cmd === 'profile') {\r\n    textArea.parentNode.addEventListener('click', bioEvtHdl);\r\n  }\r\n  textArea.addEventListener('keyup', updateBioCharacters);\r\n  // Force the preview area to render\r\n  updateBioCharacters();\r\n}\r\n","import addCommas from '../system/addCommas';\r\nimport getMercStats from '../ajax/getMercStats';\r\nimport groupViewStats from '../ajax/groupViewStats';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\n\r\nvar groupStats;\r\n\r\nfunction displayStat(el, groupStat, mercStat) {\r\n  el.innerHTML = '<span class=\"fshBlue\">' + addCommas(groupStat) + '</span>' +\r\n    ' ( ' + addCommas(groupStat - mercStat) + ' )';\r\n}\r\n\r\nfunction parseMercStats(mercStats) {\r\n  displayStat(groupStats.attackElement, groupStats.attack, mercStats.attack);\r\n  displayStat(groupStats.defenseElement, groupStats.defense, mercStats.defense);\r\n  displayStat(groupStats.armorElement, groupStats.armor, mercStats.armor);\r\n  displayStat(groupStats.damageElement, groupStats.damage, mercStats.damage);\r\n  displayStat(groupStats.hpElement, groupStats.hp, mercStats.hp);\r\n}\r\n\r\nexport default function injectGroupStats() { // jQuery\r\n  if (jQueryNotPresent()) {return;}\r\n  groupStats = groupViewStats(document);\r\n  if (groupStats.attackElement) {\r\n    getMercStats().done(parseMercStats);\r\n  }\r\n}\r\n","import calf from '../support/calf';\r\nimport doBuffLinks from '../common/doBuffLinks';\r\nimport findNode from '../system/findNode';\r\nimport findNodes from '../system/findNodes';\r\nimport {getElementById} from '../common/getElement';\r\nimport getGroupStats from '../ajax/getGroupStats';\r\nimport getMembrList from '../ajax/getMembrList';\r\nimport getValue from '../system/getValue';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {months} from '../support/dataObj';\r\nimport {onlineDot} from '../common/colouredDots';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport {server} from '../system/system';\r\nimport {time, timeEnd} from '../support/debug';\r\n\r\nvar maxGroupSizeToJoin;\r\n\r\nfunction displayMinGroupLevel() { // jQuery\r\n  var minGroupLevel = getValue('minGroupLevel');\r\n  if (minGroupLevel) {\r\n    $('#pCC > table > tbody > tr > td > table td').first()\r\n      .append('<span style=\"color:blue\"> ' +\r\n      'Current Min Level Setting: ' + minGroupLevel + '</span>');\r\n  }\r\n}\r\n\r\nfunction filterMercs(e) {return e.search('#000099') === -1;}\r\n\r\nfunction joinGroup(groupJoinURL, joinButton) { // jQuery\r\n  return retryAjax(groupJoinURL).done(function() {\r\n    joinButton.classList.add('fshHide');\r\n  });\r\n}\r\n\r\nfunction doJoinUnderSize(prev, joinButton) { // Legacy\r\n  var memList = joinButton.parentNode.parentNode.parentNode\r\n    .previousSibling.previousSibling.previousSibling.previousSibling;\r\n  var memListArrayWithMercs = memList.innerHTML.split(',');\r\n  var memListArrayWithoutMercs = memListArrayWithMercs\r\n    .filter(filterMercs);\r\n  if (memListArrayWithoutMercs.length < maxGroupSizeToJoin) {\r\n    var groupID = /javascript:confirmJoin\\((\\d+)\\)/.exec(\r\n      joinButton.parentNode.href)[1];\r\n    var groupJoinURL = 'index.php?no_mobile=1&cmd=guild&subcmd=groups' +\r\n      '&subcmd2=join&group_id=' + groupID;\r\n    prev.push(joinGroup(groupJoinURL, joinButton));\r\n  }\r\n  return prev;\r\n}\r\n\r\nfunction joinAllGroupsUnderSize() { // Legacy\r\n  var joinButtons = findNodes(\r\n    '//img[contains(@src,\"skin/icon_action_join.gif\")]');\r\n  if (!joinButtons) {return;}\r\n  var prm = joinButtons.reduce(doJoinUnderSize, []);\r\n  $.when.apply($, prm).done(function() {\r\n    location.href = 'index.php?cmd=guild&subcmd=groups';\r\n  });\r\n}\r\n\r\nfunction parseGroupData(linkElement, obj) {\r\n  var extraText = '<table class=\"fshgrpstat\">' +\r\n    '<tr>' +\r\n    '<td class=\"fshBrown\">Attack</td>' +\r\n    '<td class=\"fshRight\">' + obj.attack + '</td>' +\r\n    '<td class=\"fshBrown\">Defense</td>' +\r\n    '<td class=\"fshRight\">' + obj.defense + '</td>' +\r\n    '</tr><tr>' +\r\n    '<td class=\"fshBrown\">Armor</td>' +\r\n    '<td class=\"fshRight\">' + obj.armor + '</td>' +\r\n    '<td class=\"fshBrown\">Damage</td>' +\r\n    '<td class=\"fshRight\">' + obj.damage + '</td>' +\r\n    '</tr><tr>' +\r\n    '<td class=\"fshBrown\">HP</td>' +\r\n    '<td class=\"fshRight\">' + obj.hp + '</td>' +\r\n    '<td colspan=\"2\"></td>' +\r\n    '</tr></table>';\r\n  var expiresLocation = linkElement.parentNode.parentNode\r\n    .previousElementSibling;\r\n  expiresLocation.insertAdjacentHTML('beforeend', extraText);\r\n}\r\n\r\nfunction fetchGroupData(evt) {\r\n  evt.target.classList.add('fshHide');\r\n  var allItems = document.querySelectorAll('#pCC a[href*=\"=viewstats&\"]');\r\n  Array.prototype.forEach.call(allItems, function(aLink) {\r\n    getGroupStats(aLink.href).done(parseGroupData.bind(null, aLink));\r\n  });\r\n}\r\n\r\nfunction groupButtons() { // Legacy\r\n  var buttonElement = findNode('//td[input[@value=\"Join All ' +\r\n    'Available Groups\"]]');\r\n  var enableMaxGroupSizeToJoin =\r\n    getValue('enableMaxGroupSizeToJoin');\r\n  if (enableMaxGroupSizeToJoin) {\r\n    maxGroupSizeToJoin = getValue('maxGroupSizeToJoin');\r\n    var joinAllInput = buttonElement.firstChild.nextSibling.nextSibling;\r\n    joinAllInput.classList.add('fshHide');\r\n    buttonElement.innerHTML += '&nbsp;<input id=\"joinallgroupsunder' +\r\n      'size\" type=\"button\" value=\"Join All Groups < ' +\r\n      maxGroupSizeToJoin + ' Members\" class=\"custombutton\">&nbsp;' +\r\n      '<input id=\"fetchgroupstats\" type=\"button\" value=\"Fetch ' +\r\n      'Group Stats\" class=\"custombutton\">';\r\n    getElementById('joinallgroupsundersize')\r\n      .addEventListener('click', joinAllGroupsUnderSize, true);\r\n  } else {\r\n    buttonElement.innerHTML += '&nbsp;<input id=\"fetchgroupstats\" ' +\r\n      'type=\"button\" value=\"Fetch Group Stats\" class=\"custombutton\">';\r\n  }\r\n  getElementById('fetchgroupstats')\r\n    .addEventListener('click', fetchGroupData);\r\n\r\n  if (calf.subcmd2 === 'joinallgroupsundersize') {\r\n    joinAllGroupsUnderSize();\r\n  }\r\n}\r\n\r\nfunction fixTable() { // jQuery\r\n  // Cows don't add!\r\n  var tds = $('#pCC td.header-dark');\r\n  tds.eq(0).attr('width', '20%');\r\n  tds.eq(1).attr('width', '51%');\r\n  tds.eq(2).attr('width', '22%');\r\n  tds.eq(3).attr('width', '7%');\r\n}\r\n\r\nfunction groupLocalTime(theDateCell) { // jQuery\r\n  var xRE = /([a-zA-Z]+), (\\d+) ([a-zA-Z]+) (\\d+):(\\d+):(\\d+) UTC/;\r\n  var x = xRE.exec(theDateCell.text());\r\n  var month = months.indexOf(x[3]);\r\n  var curYear = new Date().getFullYear(); // Boundary condition\r\n  var groupDate = new Date();\r\n  groupDate.setUTCDate(x[2]);\r\n  groupDate.setUTCMonth(month);\r\n  groupDate.setUTCFullYear(curYear);\r\n  groupDate.setUTCHours(x[4]);\r\n  groupDate.setUTCMinutes(x[5]);\r\n  theDateCell.append('<br><span style=\"color:blue; font-size:x-small\">' +\r\n    'Local: ' + groupDate.toString().substr(0, 21) + '</span>');\r\n}\r\n\r\nfunction getCreator(membrlist, creator) {\r\n  if (membrlist[creator]) {\r\n    return onlineDot({last_login: membrlist[creator].last_login}) +\r\n      '&nbsp;<a href=\"' + server + 'index.php?cmd=profile&player_id=' +\r\n      membrlist[creator].id + '\"><b>' + creator + '</b></a> [' +\r\n      membrlist[creator].level + ']';\r\n  }\r\n  return '<b>' + creator + '</b>';\r\n}\r\n\r\nfunction memberLevel(membrlist, member) {\r\n  if (membrlist[member]) {return membrlist[member].level;}\r\n  return 0;\r\n}\r\n\r\nfunction byMember(membrlist, a, b) {\r\n  return memberLevel(membrlist, b) - memberLevel(membrlist, a);\r\n}\r\n\r\nfunction doGroupRow(row, membrlist) { // jQuery\r\n  var creator = $('b', row).text();\r\n  var td = $('td', row).first();\r\n  td.html(getCreator(membrlist, creator));\r\n  var td2 = $('td', row).eq(1);\r\n  var theList = td2.html();\r\n  var listArr = theList.split(', ');\r\n  if (listArr.length > 1) {listArr.sort(byMember.bind(null, membrlist));}\r\n  var buffList = listArr.filter(function(name) {\r\n    return name !== '[none]' && name.indexOf('<font') === -1;\r\n  });\r\n  if (buffList.length > 0) {td.append(doBuffLinks(buffList));}\r\n  td.append('<span class=\"fshXSmall\">Members: ' +\r\n    buffList.length + '</span>');\r\n  listArr = listArr.map(function(name) {\r\n    if (!membrlist[name]) {return name;}\r\n    return '<a href=\"index.php?cmd=profile&player_id=' +\r\n      membrlist[name].id + '\">' + name + '</a>';\r\n  });\r\n  td2.html('<span>' + listArr.join(', ') + '</span>');\r\n  groupLocalTime($('td', row).eq(2));\r\n}\r\n\r\nfunction doGroupPaint(m) { // jQuery\r\n\r\n  time('groups.doGroupPaint');\r\n\r\n  $('#pCC table table table tr').has('.group-action-container')\r\n    .each(function(i, e) {\r\n      doGroupRow(e, m);\r\n    });\r\n\r\n  timeEnd('groups.doGroupPaint');\r\n\r\n}\r\n\r\nexport default function injectGroups() { // jQuery\r\n  if (jQueryNotPresent()) {return;}\r\n  getMembrList(false)\r\n    .done(doGroupPaint);\r\n  displayMinGroupLevel();\r\n  groupButtons();\r\n  fixTable();\r\n}\r\n","import add from '../../support/task';\r\nimport alpha from '../../common/alpha';\r\nimport formatLocalDateTime from '../../common/formatLocalDateTime';\r\nimport {act, cur, gxp, lvl, max, utc, vl} from './indexConstants';\r\nimport {\r\n  createDiv,\r\n  createTBody,\r\n  createTable,\r\n  createTh,\r\n} from '../../common/cElement';\r\n\r\nvar actBody;\r\nvar selMember;\r\nvar tgCont;\r\nvar memberSelect;\r\nvar myMembers;\r\n\r\nfunction buildOptions(ourMembers) {\r\n  return '<select name=\"member\">' +\r\n    '<option value=\"- All -\" selected>- All -</option>' +\r\n    Object.keys(ourMembers).sort(alpha).reduce(function(prev, member) {\r\n      return prev + '<option value=\"' + member + '\">' + member + '</option>';\r\n    }, '') + '</select>';\r\n}\r\n\r\nfunction toText(val) {\r\n  if (typeof val === 'undefined') {return '#DEF';}\r\n  return val.toLocaleString();\r\n}\r\n\r\nfunction memberFilter(memberKey) {\r\n  return selMember && selMember !== '- All -' && selMember !== memberKey;\r\n}\r\n\r\nfunction aMembersActivityRows(memberKey) {\r\n  return function(inside, activity) {\r\n    return inside + '<tr>' +\r\n      '<td>' +\r\n      formatLocalDateTime(new Date(activity[utc] * 1000)) +\r\n      '</td>' +\r\n      '<td>' + memberKey + '</td>' +\r\n      '<td class=\"fshRight\">' + toText(activity[lvl]) + '</td>' +\r\n      '<td class=\"fshRight\">' + toText(activity[vl]) + '</td>' +\r\n      '<td class=\"fshRight\">' + toText(activity[cur]) + '</td>' +\r\n      '<td class=\"fshRight\">' + toText(activity[max]) + '</td>' +\r\n      '<td class=\"fshRight\">' +\r\n        Math.floor(activity[cur] / activity[max] * 100) +\r\n      '</td>' +\r\n      '<td class=\"fshRight\">' + activity[act] + '</td>' +\r\n      '<td class=\"fshRight\">' + toText(activity[gxp]) + '</td>' +\r\n      '</tr>';\r\n  };\r\n}\r\n\r\nfunction memberRows() {\r\n  return Object.keys(myMembers).reduce(function(outside, memberKey) {\r\n    if (memberFilter(memberKey)) {return outside;}\r\n    return outside +\r\n      myMembers[memberKey].reduce(aMembersActivityRows(memberKey), '');\r\n  }, '');\r\n}\r\n\r\nfunction drawRows() {\r\n  if (myMembers) {actBody.innerHTML = memberRows();}\r\n  tgCont.classList.remove('fshSpinner');\r\n}\r\n\r\nfunction queueDrawRows() {\r\n  tgCont.classList.add('fshSpinner');\r\n  add(3, drawRows);\r\n}\r\n\r\nfunction myChange(e) {\r\n  selMember = e.target.value;\r\n  queueDrawRows();\r\n}\r\n\r\nexport function initTable(theMembers) {\r\n  if (theMembers) {\r\n    myMembers = theMembers;\r\n    memberSelect.innerHTML = buildOptions(theMembers);\r\n    queueDrawRows();\r\n  }\r\n}\r\n\r\nexport function makeTg() {\r\n  var tg = createTable({id: 'tg'});\r\n  var hrow = tg.createTHead().insertRow(-1);\r\n  hrow.insertAdjacentHTML('beforeend', '<th>Date</th>');\r\n\r\n  var memberHead = createTh({textContent: 'Member'});\r\n  memberSelect = createDiv();\r\n  memberHead.appendChild(memberSelect);\r\n  hrow.appendChild(memberHead);\r\n\r\n  hrow.insertAdjacentHTML('beforeend', '<th>Level</th><th>VL</th>' +\r\n  '<th>Stam</th><th>Max<br>Stam</th><th>Stam<br>%</th>' +\r\n  '<th>Last<br>Activity<br>(Days)</th><th>GXP</th>');\r\n\r\n  actBody = createTBody();\r\n  tg.appendChild(actBody);\r\n  tg.addEventListener('change', myChange);\r\n  tgCont = createDiv({className: 'tgCont fshSpinner64'});\r\n  tgCont.appendChild(tg);\r\n  return tgCont;\r\n}\r\n","import add from '../../support/task';\r\nimport {initTable} from './trackerTable';\r\nimport jsonParse from '../../common/jsonParse';\r\nimport setForage from '../../ajax/setForage';\r\nimport {\r\n  createBr,\r\n  createButton,\r\n  createDiv,\r\n  createTextArea,\r\n} from '../../common/cElement';\r\n\r\nvar ioText;\r\nvar saveBtn;\r\nvar resetBtn;\r\nvar io;\r\n\r\nfunction drawRawData(trackerData) {\r\n  ioText.value = trackerData;\r\n  io.classList.remove('fshSpinner');\r\n}\r\n\r\nexport function queueRawData(trackerData) {\r\n  if (trackerData) {\r\n    io.classList.add('fshSpinner');\r\n    add(4, drawRawData, [trackerData]);\r\n  }\r\n}\r\n\r\nfunction doReset() {\r\n  ioText.value = '{\"lastUpdate\": 0, \"members\": {}}';\r\n}\r\n\r\nfunction doSave() {\r\n  var newData = jsonParse(ioText.value);\r\n  setForage('fsh_guildActivity', newData)\r\n    .done(function() {\r\n      $('#dialog_msg').text('Update successful').dialog('open');\r\n      initTable(newData.members);\r\n    })\r\n    .fail(function(err) {\r\n      $('#dialog_msg').text(err).dialog('open');\r\n    });\r\n}\r\n\r\nfunction customButton(text, fn) {\r\n  var btn = createButton({\r\n    className: 'custombutton',\r\n    textContent: text\r\n  });\r\n  btn.addEventListener('click', fn);\r\n  return btn;\r\n}\r\n\r\nexport function makeInOut() {\r\n  io = createDiv({id: 'io', className: 'fshSpinner64'});\r\n  ioText = createTextArea();\r\n  ioText.setAttribute('autocapitalize', 'off');\r\n  ioText.setAttribute('autocomplete', 'off');\r\n  ioText.setAttribute('autocorrect', 'off');\r\n  ioText.setAttribute('spellcheck', 'false');\r\n  saveBtn = customButton('Save', doSave);\r\n  resetBtn = customButton('Reset', doReset);\r\n  io.appendChild(ioText);\r\n  io.appendChild(createBr());\r\n  io.appendChild(saveBtn);\r\n  io.appendChild(resetBtn);\r\n  return io;\r\n}\r\n","import calf from '../../support/calf';\r\nimport draggable from '../../common/dragStart';\r\nimport getForage from '../../ajax/getForage';\r\nimport getValue from '../../system/getValue';\r\nimport setValue from '../../system/setValue';\r\nimport {simpleCheckboxHtml} from '../../settings/simpleCheckbox';\r\nimport {\r\n  createDiv,\r\n  createInput,\r\n  createTr,\r\n  createUl\r\n} from '../../common/cElement';\r\nimport {initTable, makeTg} from './trackerTable';\r\nimport {makeInOut, queueRawData} from './rawData';\r\n\r\nvar trackerData;\r\nvar tracker;\r\nvar trDialog;\r\nvar acttab2;\r\n\r\nfunction isClosed() {\r\n  return !tracker.checked;\r\n}\r\n\r\nfunction isOpen() {\r\n  return tracker.checked;\r\n}\r\n\r\nfunction closeDialog() {\r\n  tracker.checked = false;\r\n}\r\n\r\nfunction keydownHandler(evt) {\r\n  if (isOpen() && evt.code === 'Escape') {\r\n    closeDialog();\r\n  }\r\n}\r\n\r\nfunction makeDragHandle() {\r\n  return createUl({\r\n    className: 'fshMove ui-tabs-nav ui-widget-header ui-corner-all ' +\r\n      'ui-helper-reset ui-helper-clearfix',\r\n    innerHTML: '<li class=\"ui-state-default ui-corner-top\">' +\r\n      '<label class=\"fsh-tab-label\" for=\"acttab1\">' +\r\n      'Guild Activity Tracker</label></li>' +\r\n      '<li class=\"ui-state-default ui-corner-top\">' +\r\n      '<label class=\"fsh-tab-label\" for=\"acttab2\">Import/Export</label></li>' +\r\n      '<label for=\"tracker\" class=\"fsh-dialog-close ' +\r\n      'ui-dialog-titlebar-close\">&times;</label>'\r\n  });\r\n}\r\n\r\nfunction updateRawData() {\r\n  acttab2.removeEventListener('change', updateRawData);\r\n  if (trackerData) {queueRawData(trackerData);}\r\n}\r\n\r\nfunction makeInnerPopup() {\r\n  var dialogPopup = createDiv({\r\n    className: 'fsh-dialog-popup ' +\r\n      'ui-dialog ui-tabs ui-widget ui-widget-content ui-corner-all',\r\n    innerHTML: '<input id=\"acttab1\" class=\"fsh-tab-open\" ' +\r\n      'name=\"acttabs\" checked type=\"radio\">'\r\n  });\r\n  acttab2 = createInput({\r\n    className: 'fsh-tab-open',\r\n    id: 'acttab2',\r\n    name: 'acttabs',\r\n    type: 'radio'\r\n  });\r\n  acttab2.addEventListener('change', updateRawData);\r\n  dialogPopup.appendChild(acttab2);\r\n  return dialogPopup;\r\n}\r\n\r\nfunction makePopup() {\r\n  var ret = makeInnerPopup();\r\n  var hdl = makeDragHandle();\r\n  ret.appendChild(hdl);\r\n  var container = createDiv({className: 'fsh-dialog-content'});\r\n  container.appendChild(makeTg());\r\n  container.appendChild(makeInOut());\r\n  ret.appendChild(container);\r\n  draggable(hdl, ret);\r\n  trDialog.appendChild(ret);\r\n}\r\n\r\nfunction addOverlay() {\r\n  trDialog.insertAdjacentHTML('beforeend',\r\n    '<div class=\"fsh-dialog-overlay\">' +\r\n    '<label class=\"fsh-dialog-cancel\" for=\"tracker\"></label>' +\r\n    '</div>');\r\n}\r\n\r\nfunction gotActivity(data) {\r\n  if (data) {\r\n    trackerData = JSON.stringify(data);\r\n    initTable(data.members);\r\n  }\r\n}\r\n\r\nfunction togglePref(evt) {\r\n  if (evt.target.id === 'enableGuildActivityTracker') {\r\n    setValue('enableGuildActivityTracker',\r\n      !getValue('enableGuildActivityTracker'));\r\n  }\r\n}\r\n\r\nfunction openDialog() {\r\n  getForage('fsh_guildActivity').done(gotActivity);\r\n  tracker.removeEventListener('change', openDialog);\r\n  calf.dialogIsClosed = isClosed;\r\n  addOverlay();\r\n  makePopup();\r\n}\r\n\r\nexport default function guildTracker() {\r\n  var gs = document.querySelector('#pCC img.guild_openGuildStore');\r\n  var oldTr = gs.parentNode.parentNode;\r\n  var newTr = createTr();\r\n  var cellOne = newTr.insertCell(-1);\r\n  var cellTwo = newTr.insertCell(-1);\r\n  cellOne.appendChild(gs);\r\n  cellTwo.innerHTML = simpleCheckboxHtml('enableGuildActivityTracker') +\r\n    '&nbsp;<label class=\"custombutton\" for=\"tracker\">Show</label>';\r\n  newTr.addEventListener('change', togglePref);\r\n  oldTr.parentNode.replaceChild(newTr, oldTr);\r\n  tracker = createInput({\r\n    id: 'tracker',\r\n    className: 'fsh-dialog-open',\r\n    type: 'checkbox'\r\n  });\r\n  tracker.addEventListener('change', openDialog);\r\n  trDialog = createDiv({className: 'fsh-dialog'});\r\n  trDialog.appendChild(tracker);\r\n  document.body.addEventListener('keydown', keydownHandler);\r\n  document.body.appendChild(trDialog);\r\n}\r\n","import add from '../support/task';\r\nimport {colouredDots} from '../common/colouredDots';\r\nimport createDocument from '../system/createDocument';\r\nimport findNode from '../system/findNode';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport guildTracker from './guildTracker/guildTracker';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport moreToDo from '../common/moreToDo';\r\nimport openQuickBuffByName from '../common/openQuickBuffByName';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport toggleVisibilty from '../common/toggleVisibilty';\r\nimport {guildXPLock, removeGuildAvyImgBorder} from './guildUtils';\r\nimport {pCC, playerName} from '../support/layout';\r\n\r\nvar leftHandSideColumnTable;\r\nvar members;\r\nvar memCount;\r\n\r\nfunction hazConflict(conflictTable, curPage, insertHere) { // Legacy\r\n  if (curPage === 1) {\r\n    var newNode = insertHere.insertRow(insertHere.rows.length - 2);\r\n    newNode.insertCell(0);\r\n    newNode.insertCell(0);\r\n    newNode.cells[0].innerHTML =\r\n      '<a href=\"index.php?cmd=guild&subcmd=conflicts\">Active Conflicts</a>';\r\n    newNode.cells[1].innerHTML = 'Score';\r\n  }\r\n  for (var i = 1; i <= conflictTable.rows.length - 4; i += 2) {\r\n    var newRow = insertHere.insertRow(insertHere.rows.length - 2);\r\n    newRow.insertCell(0);\r\n    newRow.insertCell(0);\r\n    newRow.cells[0].innerHTML = conflictTable.rows[i].cells[0].innerHTML;\r\n    newRow.cells[1].innerHTML = '<b>' + conflictTable.rows[i].cells[6]\r\n      .innerHTML + '</b>';\r\n  }\r\n}\r\n\r\nfunction activeConflicts(doc, curPage, insertHere) { // Legacy\r\n  var conflictTable = findNode(\r\n    '//font[contains(.,\"Participants\")]/ancestor::table[1]', doc);\r\n  if (conflictTable && conflictTable.rows.length > 3) {\r\n    hazConflict(conflictTable, curPage, insertHere);\r\n  }\r\n}\r\n\r\nfunction gotConflictInfo(responseText, callback) { // Legacy\r\n  var doc = createDocument(responseText);\r\n  var page = findNode('//td[contains(.,\"Page:\")]', doc);\r\n  var curPage = parseInt(findNode('//input[@name=\"page\"]',\r\n    doc).value, 10);\r\n  var maxPage = page.innerHTML.match(/of&nbsp;(\\d*)/);\r\n  activeConflicts(doc, curPage, callback.node);\r\n  if (maxPage && parseInt(maxPage[1], 10) > curPage) {\r\n    retryAjax('index.php?no_mobile=1&cmd=guild&subcmd=conflicts&page=' +\r\n      (curPage + 1).toString()\r\n    ).done(function(html) {\r\n      gotConflictInfo(html, {node: callback.node});\r\n    });\r\n  }\r\n}\r\n\r\nfunction conflictInfo() { // jQuery.min\r\n  retryAjax('index.php?no_mobile=1&cmd=guild&subcmd=conflicts')\r\n    .done(function(data) {\r\n      gotConflictInfo(data,\r\n        {node: getElementById('statisticsControl')});\r\n    });\r\n}\r\n\r\nfunction logoToggle() {\r\n  var changeLogoCell = leftHandSideColumnTable.rows[0].cells[1].firstChild;\r\n  changeLogoCell.insertAdjacentHTML('beforeend', '[ <span class=\"fshLink' +\r\n    ' tip-static\" id=\"toggleGuildLogoControl\" ' +\r\n    'linkto=\"guildLogoControl\" data-tipped=\"Toggle Section\">X</span> ]');\r\n  var guildLogoElement = leftHandSideColumnTable.rows[2].cells[0]\r\n    .firstChild.nextSibling;\r\n  guildLogoElement.id = 'guildLogoControl';\r\n  if (getValue('guildLogoControl')) {\r\n    guildLogoElement.classList.add('fshHide');\r\n  }\r\n  getElementById('toggleGuildLogoControl')\r\n    .addEventListener('click', toggleVisibilty);\r\n}\r\n\r\nfunction statToggle() {\r\n  var leaveGuildCell = leftHandSideColumnTable.rows[4].cells[1].firstChild;\r\n  leaveGuildCell.insertAdjacentHTML('beforeend', '<span class=\"fshNoWrap\">' +\r\n    '[ <span class=\"fshLink tip-static\" id=\"toggleStatisticsControl\" ' +\r\n    'linkto=\"statisticsControl\" data-tipped=\"Toggle Section\">X</span> ]' +\r\n    '</span>');\r\n  var statisticsControlElement = leftHandSideColumnTable.rows[6].cells[0]\r\n    .firstChild.nextSibling;\r\n  statisticsControlElement.id = 'statisticsControl';\r\n  if (getValue('statisticsControl')) {\r\n    statisticsControlElement.classList.add('fshHide');\r\n  }\r\n  getElementById('toggleStatisticsControl')\r\n    .addEventListener('click', toggleVisibilty);\r\n}\r\n\r\nfunction structureToggle() {\r\n  var buildCell = leftHandSideColumnTable.rows[15].cells[1].firstChild;\r\n  buildCell.insertAdjacentHTML('beforeend', '[ <span class=\"fshLink ' +\r\n    'tip-static\" id=\"toggleGuildStructureControl\" ' +\r\n    'linkto=\"guildStructureControl\" data-tipped=\"Toggle Section\">X</span> ]');\r\n  var guildStructureControlElement = leftHandSideColumnTable.rows[17]\r\n    .cells[0].firstChild.nextSibling;\r\n  guildStructureControlElement.id = 'guildStructureControl';\r\n  if (getValue('guildStructureControl')) {\r\n    guildStructureControlElement.classList.add('fshHide');\r\n  }\r\n  getElementById('toggleGuildStructureControl')\r\n    .addEventListener('click', toggleVisibilty);\r\n}\r\n\r\nfunction batchBuffLinks() {\r\n  var limit = performance.now() + 5;\r\n  while (moreToDo(limit, memCount, members)) {\r\n    members[memCount].parentNode.insertAdjacentHTML('beforeend',\r\n      ' <span class=\"smallLink\">[b]</span>');\r\n    memCount += 1;\r\n  }\r\n  if (memCount < members.length) {\r\n    add(3, batchBuffLinks);\r\n  }\r\n}\r\n\r\nfunction buffLinks() {\r\n  // TODO preference\r\n  memCount = 0;\r\n  members = document.querySelectorAll(\r\n    '#pCC a[href^=\"index.php?cmd=profile&player_id=\"]');\r\n  add(3, batchBuffLinks);\r\n  pCC.addEventListener('click', function(evt) {\r\n    if (evt.target.className !== 'smallLink') {return;}\r\n    openQuickBuffByName(evt.target.previousElementSibling.text);\r\n  });\r\n}\r\n\r\nfunction selfRecallLink() {\r\n  // self recall\r\n  var getLi = leftHandSideColumnTable.getElementsByTagName('LI');\r\n  var selfRecall = getLi[getLi.length - 1].parentNode;\r\n  selfRecall.insertAdjacentHTML('beforeend',\r\n    '<li><a href=\"index.php?cmd=guild&subcmd=inventory&subcmd2=report&' +\r\n    'user=' + playerName() +\r\n    '\" class=\"tip-static\" data-tipped=\"Self Recall\">Self Recall</a></li>');\r\n}\r\n\r\nexport default function injectGuild() {\r\n  add(3, colouredDots);\r\n  add(3, removeGuildAvyImgBorder);\r\n  add(3, guildXPLock);\r\n  leftHandSideColumnTable = pCC\r\n    .lastElementChild.rows[2].cells[0].firstElementChild;\r\n  add(3, logoToggle);\r\n  add(3, statToggle);\r\n  add(3, structureToggle);\r\n  add(3, buffLinks);\r\n  add(3, selfRecallLink);\r\n  if (jQueryNotPresent()) {return;}\r\n  // Detailed conflict information\r\n  if (getValue('detailedConflictInfo')) {\r\n    add(3, conflictInfo);\r\n  }\r\n  add(4, guildTracker);\r\n}\r\n","import add from './support/task';\r\nimport createDocument from './system/createDocument';\r\nimport {createInput} from './common/cElement';\r\nimport {getElementById} from './common/getElement';\r\nimport getMembrList from './ajax/getMembrList';\r\nimport getValue from './system/getValue';\r\nimport insertElement from './common/insertElement';\r\nimport jQueryNotPresent from './common/jQueryNotPresent';\r\nimport moreToDo from './common/moreToDo';\r\nimport retryAjax from './ajax/retryAjax';\r\nimport {pCC, playerName} from './support/layout';\r\n\r\nvar ranks;\r\nvar myRank;\r\nvar theRows;\r\nvar rankCount;\r\nvar characterRow;\r\n\r\nvar privLookup = {\r\n  'Bank Withdraw': 5,\r\n  'Build/Upgrade/Demolish Structures': 5,\r\n  'Can Un-Tag Items': 5,\r\n  'Build/Upgrade Structures': 4,\r\n  'Can Kick Members': 4,\r\n  'Can Mass Messages': 0.5,\r\n  'Take Items': 0.2,\r\n  'Can Recall Tagged Items': 0.2,\r\n  'Store Items': 0.1,\r\n  'Can View Advisor': 0.1\r\n};\r\n\r\nfunction parseRankData(linkElement, responseText) {\r\n  // Makes a weighted calculation of available permissions and gets tax rate\r\n  var doc = createDocument(responseText);\r\n  var checkBoxes = doc.querySelectorAll(\r\n    '#pCC input[type=\"checkbox\"]:checked');\r\n  var count = 0;\r\n  Array.prototype.forEach.call(checkBoxes, function(checkbox) {\r\n    var privName = checkbox.nextElementSibling.textContent.trim();\r\n    if (privName in privLookup) {\r\n      count += privLookup[privName];\r\n    } else {count += 1;}\r\n  });\r\n  var taxRate = doc.querySelector('#pCC input[name=\"rank_tax\"]').value;\r\n  linkElement.insertAdjacentHTML('afterbegin', '<span class=\"fshBlue\">(' +\r\n    Math.round(10 * count) / 10 + ') Tax:(' + taxRate + '%)</span> ');\r\n}\r\n\r\nfunction fetchRankData() { // jQuery.min\r\n  var calcButton = getElementById('getrankweightings');\r\n  calcButton.classList.add('fshHide');\r\n  var allItems = document.querySelectorAll('#pCC input[value=\"Edit\"]');\r\n  Array.prototype.forEach.call(allItems, function(anItem) {\r\n    var targetNode = anItem.parentNode.parentNode.previousElementSibling;\r\n    var href = /window\\.location='(.*)';/.exec(anItem\r\n      .getAttribute('onclick'))[1];\r\n    retryAjax(href).done(parseRankData.bind(null, targetNode));\r\n  });\r\n}\r\n\r\nfunction notValidRow(thisRankRowNum, targetRowNum, parentTable) {\r\n  return characterRow >= Math.min(thisRankRowNum, targetRowNum) ||\r\n    targetRowNum < 1 ||\r\n    targetRowNum > parentTable.rows.length;\r\n}\r\n\r\nfunction getTargetRowNumber(val) {\r\n  if (val === 'Up') {return -1;}\r\n  return 2;\r\n}\r\n\r\nfunction getPxScroll(val) {\r\n  if (val === 'Up') {return -22;}\r\n  return 22;\r\n}\r\n\r\nfunction overrideUpDown(evt, val) {\r\n  var onclickHREF = /window.location='(.*)';/\r\n    .exec(evt.target.getAttribute('onclick'))[1];\r\n  var thisRankRow = evt.target.parentNode.parentNode.parentNode;\r\n  var thisRankRowNum = thisRankRow.rowIndex;\r\n  var targetRowNum = thisRankRowNum + getTargetRowNumber(val);\r\n  var parentTable = thisRankRow.parentNode;\r\n  if (notValidRow(thisRankRowNum, targetRowNum, parentTable)) {return;}\r\n  retryAjax(onclickHREF);\r\n  var injectRow = parentTable.rows[targetRowNum];\r\n  parentTable.insertBefore(thisRankRow, injectRow);\r\n  var pxScroll = getPxScroll(val);\r\n  window.scrollBy(0, pxScroll);\r\n  evt.stopPropagation();\r\n}\r\n\r\nfunction ajaxifyRankControls(evt) {\r\n  var val = evt.target.getAttribute('value');\r\n  if (val === 'Up' || val === 'Down') {overrideUpDown(evt, val);}\r\n}\r\n\r\nfunction doButtons() {\r\n  // gather rank info button\r\n  var founder = getElementById('show-guild-founder-rank-name');\r\n  if (founder) {\r\n    var weightButton = createInput({\r\n      id: 'getrankweightings',\r\n      className: 'custombutton',\r\n      type: 'button',\r\n      value: 'Get Rank Weightings'\r\n    });\r\n    weightButton.addEventListener('click', fetchRankData);\r\n    var theTd = founder.parentNode;\r\n    theTd.insertAdjacentHTML('beforeend', '&nbsp;');\r\n    insertElement(theTd, weightButton);\r\n  }\r\n  // var theTd = getElementById('show-guild-founder-rank-name') // TODO why wouldn't you be able to see this?\r\n  //   .parentNode;\r\n\r\n  if (getValue('ajaxifyRankControls')) {\r\n    pCC.addEventListener('click',\r\n      ajaxifyRankControls, true);\r\n  }\r\n}\r\n\r\nfunction writeMembers(el) {\r\n  var rankCell = el.firstElementChild;\r\n  var rankName = rankCell.textContent;\r\n  if (ranks[rankName]) { // has members\r\n    if (rankName === myRank) {\r\n      characterRow = rankCount; // limit for ajaxify later\r\n    }\r\n    rankCell.insertAdjacentHTML('beforeend', ' <span class=\"fshBlue\">- ' +\r\n      ranks[rankName].join(', ') + '</span>');\r\n  }\r\n}\r\n\r\nfunction paintRanks() {\r\n  var limit = performance.now() + 10;\r\n  while (moreToDo(limit, rankCount, theRows)) {\r\n    var el = theRows[rankCount];\r\n\r\n    writeMembers(el);\r\n\r\n    rankCount += 1;\r\n  }\r\n  if (rankCount < theRows.length) {\r\n    add(3, paintRanks);\r\n  }\r\n}\r\n\r\nfunction findTheRows() {\r\n  var outerTable = pCC.lastElementChild.previousElementSibling;\r\n  if (outerTable.rows && outerTable.rows.length > 13) {\r\n    return outerTable.rows[13].firstElementChild.firstElementChild.rows;\r\n  }\r\n}\r\n\r\nfunction getRanks(membrList) {\r\n  ranks = Object.keys(membrList).reduce(function(prev, curr) {\r\n    if (curr !== 'lastUpdate') {\r\n      var rankName = membrList[curr].rank_name;\r\n      prev[rankName] = prev[rankName] || [];\r\n      prev[rankName].push(curr);\r\n    }\r\n    return prev;\r\n  }, {});\r\n  myRank = membrList[playerName()].rank_name;\r\n  theRows = findTheRows();\r\n  if (theRows) {\r\n    rankCount = 1;\r\n    add(3, paintRanks);\r\n  }\r\n}\r\n\r\nexport default function injectGuildRanks() { // jQuery.min\r\n  if (jQueryNotPresent()) {return;}\r\n  getMembrList(true).done(function(membrList) {\r\n    add(3, getRanks, [membrList]);\r\n  });\r\n  add(3, doButtons);\r\n}\r\n","export default function insertTextBeforeEnd(parent, text) {\r\n  if (parent instanceof Element) {\r\n    parent.insertAdjacentHTML('beforeend', text);\r\n  }\r\n}\r\n","export default function renderBio(_bioContents) {\r\n  var bioContents = _bioContents.replace(/\\{b\\}/g, '`~')\r\n    .replace(/\\{\\/b\\}/g, '~`');\r\n  var buffs = bioContents.match(/`~([^~]|~(?!`))*~`/g);\r\n  if (!buffs) {return _bioContents;}\r\n  buffs.forEach(function(buff, i) {\r\n    var fullName = buff.replace(/(`~)|(~`)|(\\{b\\})|(\\{\\/b\\})/g, '');\r\n    var cbString = '<span id=\"fshBuff' + i + '\" class=\"buffLink fshBlue\">' +\r\n      fullName + '</span>';\r\n    bioContents = bioContents.replace(buff, cbString);\r\n  });\r\n  if (bioContents.indexOf('[cmd]') < 0) {bioContents += '[cmd]';}\r\n  bioContents = bioContents.replace('[cmd]',\r\n    '<br><input id=\"fshSendBuffMsg\" ' +\r\n    'class=\"custombutton\" type=\"button\" value=\"Ask For Buffs\">' +\r\n    '<span id=\"buffCost\" class=\"fshRed\"></span>');\r\n  return bioContents;\r\n}\r\n","import createDocument from '../system/createDocument';\r\nimport retryAjax from './retryAjax';\r\nimport {defenderMultiplier, mercRE} from '../support/dataObj';\r\n\r\nfunction addMercStat(mouseover, stat, i) {\r\n  return stat +\r\n    Math.round(Number(mercRE[i].exec(mouseover)[1]) * defenderMultiplier);\r\n}\r\n\r\nfunction addMercStats(prev, merc) {\r\n  return prev.map(addMercStat.bind(null, merc.dataset.tipped));\r\n}\r\n\r\nfunction addAllMercStats(mercElements) {\r\n  return Array.prototype.reduce.call(mercElements, addMercStats,\r\n    [0, 0, 0, 0, 0]);\r\n}\r\n\r\nfunction transform(mercTotal) {\r\n  return {\r\n    attack: mercTotal[0],\r\n    defense: mercTotal[1],\r\n    armor: mercTotal[2],\r\n    damage: mercTotal[3],\r\n    hp: mercTotal[4]\r\n  };\r\n}\r\n\r\nfunction parseMercStats(html) {\r\n  var doc = createDocument(html);\r\n  var mercElements = doc.querySelectorAll('#pCC img[src*=\"/merc/\"]');\r\n  var mercTotal = addAllMercStats(mercElements);\r\n  return transform(mercTotal);\r\n}\r\n\r\nexport default function getMercStats() {\r\n  return retryAjax(\r\n    'index.php?no_mobile=1&cmd=guild&subcmd=mercs').pipe(parseMercStats);\r\n}\r\n","import {getElementById} from '../common/getElement';\r\nimport intValue from '../system/intValue';\r\n\r\nfunction statAsNumber(el) {\r\n  if (el) {\r\n    return intValue(el.textContent);\r\n  }\r\n  return 0;\r\n}\r\n\r\nexport default function groupViewStats(doc) {\r\n  var attackElement = getElementById('stat-attack', doc);\r\n  var defenseElement = getElementById('stat-defense', doc);\r\n  var armorElement = getElementById('stat-armor', doc);\r\n  var damageElement = getElementById('stat-damage', doc);\r\n  var hpElement = getElementById('stat-hp', doc);\r\n  return {\r\n    attack: statAsNumber(attackElement),\r\n    attackElement: attackElement,\r\n    defense: statAsNumber(defenseElement),\r\n    defenseElement: defenseElement,\r\n    armor: statAsNumber(armorElement),\r\n    armorElement: armorElement,\r\n    damage: statAsNumber(damageElement),\r\n    damageElement: damageElement,\r\n    hp: statAsNumber(hpElement),\r\n    hpElement: hpElement\r\n  };\r\n}\r\n","import fallback from '../system/fallback';\r\nimport openQuickBuffByName from './openQuickBuffByName';\r\nimport {places} from '../support/dataObj';\r\nimport {createButton, createLi, createUl} from './cElement';\r\n\r\nexport default function doBuffLinks(members) {\r\n  // quick buff only supports 16\r\n  var shortList = members.reduce(function(prev, curr, i) {\r\n    var slot = Math.floor(i / 16);\r\n    prev[slot] = fallback(prev[slot], []);\r\n    prev[slot].push(curr);\r\n    return prev;\r\n  }, []).reduce(function(prev, curr, i) {\r\n    var theNames = curr.join(',');\r\n    var modifierWord = places[i];\r\n    var li = createLi();\r\n    var btn = createButton({\r\n      className: 'fshBl fshBls tip-static',\r\n      dataset: {tipped: 'Quick buff functionality from HCS only does 16'},\r\n      textContent: 'Buff ' + modifierWord + ' 16'\r\n    });\r\n    btn.addEventListener('click',\r\n      openQuickBuffByName.bind(null, theNames));\r\n    li.appendChild(btn);\r\n    prev.appendChild(li);\r\n    return prev;\r\n  }, createUl());\r\n  return shortList;\r\n}\r\n","import createDocument from '../system/createDocument';\r\nimport groupViewStats from './groupViewStats';\r\nimport retryAjax from './retryAjax';\r\n\r\nfunction parseGroupStats(html) {\r\n  var doc = createDocument(html);\r\n  return groupViewStats(doc);\r\n}\r\n\r\nexport default function getGroupStats(viewStats) {\r\n  return retryAjax(viewStats).pipe(parseGroupStats);\r\n}\r\n","export default function alpha(a, b) {\r\n  if (a.toLowerCase() < b.toLowerCase()) {return -1;}\r\n  if (a.toLowerCase() > b.toLowerCase()) {return 1;}\r\n  return 0;\r\n}\r\n","import padZ from '../system/padZ';\r\n\r\nexport default function formatLocalDateTime(aDate) {\r\n  if (Object.prototype.toString.call(aDate) === '[object Date]' &&\r\n      !isNaN(aDate.getTime())) {\r\n    var yyyy = aDate.getFullYear().toString();\r\n    var mon = padZ(aDate.getMonth() + 1);\r\n    var dd = padZ(aDate.getDate());\r\n    var hh = padZ(aDate.getHours());\r\n    var mm = padZ(aDate.getMinutes());\r\n    var ss = padZ(aDate.getSeconds());\r\n    return yyyy + '-' + mon + '-' + dd + ' ' + hh + ':' + mm + ':' + ss;\r\n  }\r\n}\r\n","import {getElementById} from './getElement';\r\nimport setValue from '../system/setValue';\r\n\r\nexport default function toggleVisibilty(evt) {\r\n  var anItemId = evt.target.getAttribute('linkto');\r\n  var anItem = getElementById(anItemId);\r\n  var currentVisibility = anItem.classList.contains('fshHide');\r\n  anItem.classList.toggle('fshHide');\r\n  if (currentVisibility) {\r\n    setValue(anItemId, '');\r\n  } else {\r\n    setValue(anItemId, 'ON');\r\n  }\r\n}\r\n","export default function getIntFromRegExp(theText, rxSearch) {\r\n  var result;\r\n  var matches = theText.replace(/,/g, '').match(rxSearch);\r\n  if (matches) {\r\n    result = parseInt(matches[1], 10);\r\n  } else {\r\n    result = 0;\r\n  }\r\n  return result;\r\n}\r\n","import addCommas from '../system/addCommas';\r\nimport getIntFromRegExp from '../system/getIntFromRegExp';\r\n\r\nexport function removeGuildAvyImgBorder() {\r\n  document.querySelector('#pCC img[oldtitle$=\"\\'s Logo\"]')\r\n    .removeAttribute('style');\r\n}\r\n\r\nexport function guildXPLock() {\r\n  var xpLock = document\r\n    .querySelector('#pCC a[data-tipped^=\"<b>Guild XP</b>\"]');\r\n  if (!xpLock) {return;}\r\n  var xpLockmouseover = xpLock.dataset.tipped;\r\n  var xpLockXP = getIntFromRegExp(xpLockmouseover,\r\n    /XP Lock: <b>(\\d*)/);\r\n  var actualXP = getIntFromRegExp(xpLockmouseover,\r\n    /XP: <b>(\\d*)/);\r\n  if (actualXP < xpLockXP) {\r\n    xpLock.parentNode.nextElementSibling.insertAdjacentHTML('beforeend',\r\n      ' (<b>' + addCommas(xpLockXP - actualXP) + '</b>)');\r\n  }\r\n}\r\n","import {createInput} from '../common/cElement';\r\nimport {imageServer} from '../system/system';\r\nimport {pCC} from '../support/layout';\r\nimport takeitem from '../app/guild/inventory/takeitem';\r\n\r\nfunction doItemTable(rows) {\r\n  for (var i = 1; i < rows.length - 1; i += 2) {\r\n    rows[i].cells[2].insertAdjacentHTML('beforeend',\r\n      '&nbsp;<span class=\"sendLink\">Fast BP</span>');\r\n  }\r\n}\r\n\r\nfunction doCheckAll() {\r\n  var boxes = document.querySelectorAll('#pCC input[name=\"tagIndex[]\"]');\r\n  Array.prototype.forEach.call(boxes, function(el) {\r\n    el.click();\r\n  });\r\n}\r\n\r\nfunction takeResult(self, data) {\r\n  if (data.r === 0) {\r\n    self.removeAttribute('style');\r\n    self.className = 'fshGreen';\r\n    self.textContent = 'Taken';\r\n  }\r\n}\r\n\r\nfunction fastBp(el) {\r\n  var itmId = el.parentNode.previousElementSibling.previousElementSibling\r\n    .firstElementChild.value;\r\n  takeitem(itmId).done(takeResult.bind(null, el));\r\n  el.textContent = '';\r\n  el.className = 'guildTagSpinner';\r\n  el.style.backgroundImage = 'url(\\'' + imageServer +\r\n    '/skin/loading.gif\\')';\r\n}\r\n\r\nfunction evtHdlr(e) {\r\n  var self = e.target;\r\n  if (self.value === 'Check All') {doCheckAll();}\r\n  if (self.className === 'sendLink') {fastBp(self);}\r\n}\r\n\r\nfunction paintTable() {\r\n  var nodeList = pCC.getElementsByTagName('table');\r\n  if (nodeList.length > 0) {\r\n    doItemTable(nodeList[nodeList.length - 1].rows);\r\n  }\r\n}\r\n\r\nfunction checkAllBtn() {\r\n  var checkAll = createInput({type: 'button', value: 'Check All'});\r\n  var formTags = pCC.getElementsByTagName('form');\r\n  if (formTags.length === 1) {\r\n    formTags[0].previousElementSibling.cells[0].appendChild(checkAll);\r\n  }\r\n}\r\n\r\nexport default function injectGuildAddTagsWidgets() {\r\n  pCC.addEventListener('click', evtHdlr);\r\n  paintTable();\r\n  checkAllBtn();\r\n}\r\n","import callApp from '../../callApp';\r\nimport errorDialog from '../../errorDialog';\r\n\r\nexport default function takeitem(invId) {\r\n  return callApp({\r\n    cmd: 'guild',\r\n    subcmd: 'inventory',\r\n    subcmd2: 'takeitem',\r\n    guildstore_id: invId, // + 10000000,\r\n  }).pipe(errorDialog);\r\n}\r\n","export var defaultOptions = {\r\n  checkedElements: {\r\n    '0': 1,\r\n    '1': 1,\r\n    '2': 1,\r\n    '3': 1,\r\n    '4': 1,\r\n    '5': 1,\r\n    '6': 1,\r\n    '7': 1,\r\n    '8': 1,\r\n    '100': 1,\r\n    '101': 1,\r\n    '102': 1,\r\n    '103': 1,\r\n    '104': 1,\r\n    '105': 1,\r\n    '106': 1\r\n  },\r\n  fshMinLvl: 1,\r\n  fshMaxLvl: 9999\r\n};\r\nexport var invManFilter =\r\n  '<table class=\"fshInvFilter\">' +\r\n  '<tr><th colspan=\"14\">@@reportTitle@@</th>' +\r\n  '<th><span id=\"fshRefresh\" class=\"fshLink\">[Refresh]</span></th></tr>' +\r\n  '<tr><td colspan=\"2\" rowspan=\"3\"><b>&nbsp;Show Items:</b></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Helmet:</td>' +\r\n  '<td><input id=\"fshHelmet\" type=\"checkbox\" item=\"0\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Armor:</td>' +\r\n  '<td><input id=\"fshArmor\" type=\"checkbox\" item=\"1\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Gloves:</td>' +\r\n  '<td><input id=\"fshGloves\" type=\"checkbox\" item=\"2\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Boots:</td>' +\r\n  '<td><input id=\"fshBoots\" type=\"checkbox\" item=\"3\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Weapon:</td>' +\r\n  '<td><input id=\"fshWeapon\" type=\"checkbox\" item=\"4\"/></td>' +\r\n  '<td></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Min lvl:</td>' +\r\n  '<td><input id=\"fshMinLvl\" size=\"5\" value=\"1\"/></td>' +\r\n  '</tr><tr>' +\r\n  '<td class=\"fshRight\">&nbsp;Shield:</td>' +\r\n  '<td><input id=\"fshShield\" type=\"checkbox\" item=\"5\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Ring:</td>' +\r\n  '<td><input id=\"fshRing\" type=\"checkbox\" item=\"6\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Amulet:</td>' +\r\n  '<td><input id=\"fshAmulet\" type=\"checkbox\" item=\"7\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Rune:</td>' +\r\n  '<td><input id=\"fshRune\" type=\"checkbox\" item=\"8\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Sets Only:</td>' +\r\n  '<td><input id=\"fshSets\" item=\"-1\" type=\"checkbox\"/></td>' +\r\n  '<td></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Max lvl:</td>' +\r\n  '<td><input id=\"fshMaxLvl\" size=\"5\" value=\"9999\"/></td>' +\r\n  '</tr><tr>' +\r\n  '<td colspan=\"2\">' +\r\n  '&nbsp;[<span id=\"fshAll\" class=\"fshLink\">Select All</span>]</td>' +\r\n  '<td colspan=\"2\">' +\r\n  '&nbsp;[<span id=\"fshNone\" class=\"fshLink\">Select None</span>]</td>' +\r\n  '<td colspan=\"2\">' +\r\n  '&nbsp;[<span id=\"fshDefault\" class=\"fshLink\">Defaults</span>]</td>' +\r\n  '<td colspan=\"6\"></td>' +\r\n  '<td><input id=\"fshReset\" type=\"button\" value=\"Reset\"/></td>' +\r\n  '</tr>' +\r\n  '<tr>' +\r\n  '<td class=\"fshRight\">&nbsp;Quest Item:</td>' +\r\n  '<td><input id=\"fshQuest\" item=\"9\" type=\"checkbox\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Potion:</td>' +\r\n  '<td><input id=\"fshPotion\" item=\"10\" type=\"checkbox\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Resource:</td>' +\r\n  '<td><input id=\"fshResource\" item=\"12\" type=\"checkbox\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Recipe:</td>' +\r\n  '<td><input id=\"fshRecipe\" item=\"13\" type=\"checkbox\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Container:</td>' +\r\n  '<td><input id=\"fshContainer\" item=\"14\" type=\"checkbox\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Frag Stash:</td>' +\r\n  '<td><input id=\"fshStash\" item=\"16\" type=\"checkbox\"/></td>' +\r\n  // ' Composed: <input id=\"fshComposed\" item=\"15\" type=\"checkbox\"/>' +\r\n  '<td colspan=\"3\"></td></tr>' +\r\n  '<tr>' +\r\n  '<td class=\"fshRight\">&nbsp;Common:</td>' +\r\n  '<td><input id=\"fshCommon\" item=\"100\" type=\"checkbox\" checked/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Rare:</td>' +\r\n  '<td><input id=\"fshRare\" item=\"101\" type=\"checkbox\" checked/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Unique:</td>' +\r\n  '<td><input id=\"fshUnique\" item=\"102\" type=\"checkbox\" checked/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Legendary:</td>' +\r\n  '<td><input id=\"fshLegendary\" item=\"103\" type=\"checkbox\" checked/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Super Elite:</td>' +\r\n  '<td><input id=\"fshSuperElite\" item=\"104\" type=\"checkbox\" checked/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Crystalline:</td>' +\r\n  '<td><input id=\"fshCrystalline\" item=\"105\" type=\"checkbox\" checked/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Epic:</td>' +\r\n  '<td colspan=\"2\"><input id=\"fshEpic\" item=\"106\" type=\"checkbox\" checked/>' +\r\n  '</td>' +\r\n  '</tr>' +\r\n  '</table>';\r\nexport var inventoryCheckAll = {\r\n  '0': 1,\r\n  '1': 1,\r\n  '2': 1,\r\n  '3': 1,\r\n  '4': 1,\r\n  '5': 1,\r\n  '6': 1,\r\n  '7': 1,\r\n  '8': 1,\r\n  '9': 1,\r\n  '10': 1,\r\n  '11': 1,\r\n  '12': 1,\r\n  '13': 1,\r\n  '14': 1,\r\n  '15': 1,\r\n  '16': 1,\r\n  '100': 1,\r\n  '101': 1,\r\n  '102': 1,\r\n  '103': 1,\r\n  '104': 1,\r\n  '105': 1,\r\n  '106': 1\r\n};\r\nexport var itemType = ['Helmet', 'Armor', 'Gloves', 'Boots', 'Weapon', 'Shield',\r\n  'Ring', 'Amulet', 'Rune', 'Quest Item', 'Potion', 'Component',\r\n  'Resource', 'Recipe', 'Container', 'Composed', 'Frag Stash'];\r\nexport var craftHash = {\r\n  Perfect: {abbr: 'Perf', colour: '#00b600', index: 8},\r\n  Excellent: {abbr: 'Exc', colour: '#f6ed00', index: 7},\r\n  'Very Good': {abbr: 'VG', colour: '#f67a00', index: 6},\r\n  Good: {abbr: 'Good', colour: '#f65d00', index: 5},\r\n  Average: {abbr: 'Ave', colour: '#f64500', index: 4},\r\n  Poor: {abbr: 'Poor', colour: '#f61d00', index: 3},\r\n  'Very Poor': {abbr: 'VPr', colour: '#b21500', index: 2},\r\n  Uncrafted: {abbr: 'Unc', colour: '#666666', index: 1}\r\n};\r\n","import {defaultOptions} from './assets';\r\nimport extend from '../common/extend';\r\nimport fallback from '../system/fallback';\r\nimport getValue from '../system/getValue';\r\n\r\nexport var options;\r\nexport var showQuickDropLinks;\r\nexport var showQuickSendLinks;\r\nexport var theInv;\r\n\r\nexport function storeTheInv(data) {\r\n  theInv = data;\r\n}\r\n\r\nexport function extendOptions(data) {\r\n  options = extend({}, defaultOptions);\r\n  extend(options, fallback(data, {}));\r\n  showQuickDropLinks = getValue('showQuickDropLinks');\r\n  showQuickSendLinks = getValue('showQuickSendLinks');\r\n}\r\n","import {craftHash} from '../assets';\r\n\r\nexport default function craftRender(craft) {\r\n  if (craftHash[craft]) {return craftHash[craft].abbr;}\r\n  return '';\r\n}\r\n","function selfRowColor(data) {\r\n  if (data.equipped) {return 'fshGreen';}\r\n  return 'fshNavy';\r\n}\r\n\r\nfunction guildRowColor(data) {\r\n  if (data.player_id === -1) {return 'fshNavy';}\r\n  return 'fshMaroon';\r\n}\r\n\r\nfunction getRowColor(data) {\r\n  if (data.folder_id) {return selfRowColor(data);}\r\n  return guildRowColor(data);\r\n}\r\n\r\nexport default function createdRow(row, data) {\r\n  var colour = getRowColor(data);\r\n  row.classList.add(colour);\r\n}\r\n","import fallback from '../../system/fallback';\r\nimport {theInv} from '../options';\r\n\r\nfunction gsRecall(row) {\r\n  return '<span class=\"fshLink recallItem\" invid=\"' +\r\n    row.inv_id + '\" playerid=\"' +\r\n    fallback(row.player_id, theInv.player_id) +\r\n    '\" mode=\"1\" action=\"recall\">GS</span>';\r\n}\r\n\r\nfunction gsStore(row) {\r\n  return '<span class=\"fshLink storeItem\" invid=\"' +\r\n    row.inv_id + '\">GS</span>';\r\n}\r\n\r\nfunction gsDisplayType(type, row, fn) {\r\n  if (type === 'display') {\r\n    return fn(row);\r\n  }\r\n  return 'GS';\r\n}\r\n\r\nfunction onGuildMember(row) {\r\n  return row.player_id && row.player_id !== -1;\r\n}\r\n\r\nfunction isTagged(row) {\r\n  return row.folder_id && row.guild_tag !== '-1';\r\n}\r\n\r\nfunction canRecall(row) {\r\n  return onGuildMember(row) || isTagged(row);\r\n}\r\n\r\nfunction canStore(row) {\r\n  return row.folder_id && !row.bound; // && !row.equipped;\r\n}\r\n\r\nexport default function gsRender(_data, type, row) {\r\n  if (canRecall(row)) {return gsDisplayType(type, row, gsRecall);}\r\n  if (canStore(row)) {return gsDisplayType(type, row, gsStore);}\r\n}\r\n","import {theInv} from '../options';\r\n\r\nfunction userInvNotEquipped(row) {\r\n  return row.folder_id && !row.equipped;\r\n}\r\n\r\nfunction guidInvNotEquipped(row) {\r\n  return row.player_id && !row.equipped &&\r\n    row.player_id === theInv.current_player_id;\r\n}\r\n\r\nvar locations = [\r\n  {\r\n    test: function(row) {return row.player_id && row.player_id === -1;},\r\n    res: function(row, act) {\r\n      return 'takeItem\" action=\"' + act.a;\r\n    }\r\n  },\r\n  {\r\n    test: function(row) {\r\n      return row.player_id &&\r\n        row.player_id !== theInv.current_player_id;\r\n    },\r\n    res: function(row, act) {\r\n      return 'recallItem\" playerid=\"' + row.player_id +\r\n        '\" mode=\"0\" action=\"' + act.a;\r\n    }\r\n  },\r\n  {\r\n    test: function(row) {\r\n      return userInvNotEquipped(row) || guidInvNotEquipped(row);\r\n    },\r\n    res: function(row, act) {return act.c;}\r\n  }\r\n];\r\n\r\nfunction wuRender(row, act) {\r\n  for (var i = 0; i < locations.length; i += 1) {\r\n    if (locations[i].test(row)) {\r\n      return '<span class=\"fshLink ' + locations[i].res(row, act) +\r\n        '\" invid=\"' + row.inv_id + '\">' + act.b + '</span>';\r\n    }\r\n  }\r\n  return '';\r\n}\r\n\r\nexport default function wearUseRender(data, _type, row) {\r\n  //            0  1  2  3  4  5  6  7  8 9 10 11121314 15\r\n  // eslint-disable-next-line no-sparse-arrays\r\n  var action = [1, 1, 1, 1, 1, 1, 1, 1, 1, , 2, 2, , , , 2][data]; // jshint ignore:line\r\n  if (action === 1) {\r\n    return wuRender(row, {\r\n      a: 'wear',\r\n      b: 'Wear',\r\n      c: 'wearItem'\r\n    });\r\n  } else if (action === 2) {\r\n    return wuRender(row, {\r\n      a: 'use',\r\n      b: 'Use',\r\n      c: 'useItem'\r\n    });\r\n  }\r\n}\r\n","import fallback from '../../system/fallback';\r\n\r\nexport default function whereData(row) {\r\n  return fallback(row.folder_id, row.player_id);\r\n}\r\n","import calf from '../../support/calf';\r\n\r\nexport default function playerName(f) {\r\n  if (!calf.membrList[f]) {return '???';}\r\n  return calf.membrList[f].username;\r\n}\r\n","export default function isSelected(val, test) {\r\n  if (val === test) {return ' selected';}\r\n  return '';\r\n}\r\n","import bpRender from './render/bpRender';\r\nimport craftRender from './render/craftRender';\r\nimport createdRow from './render/createdRow';\r\nimport dropRender from './render/dropRender';\r\nimport durabilityRender from './render/durabilityRender';\r\nimport gsRender from './render/gsRender';\r\nimport nameRender from './render/nameRender';\r\nimport sendRender from './render/sendRender';\r\nimport wearUseRender from './render/wearUseRender';\r\nimport whereData from './render/whereData';\r\nimport whereRender from './render/whereRender';\r\nimport whereRenderDisplay from './render/whereRenderDisplay';\r\nimport whereRenderFilter from './render/whereRenderFilter';\r\nimport {craftHash, itemType} from './assets';\r\nimport {showQuickDropLinks, showQuickSendLinks, theInv} from './options';\r\n\r\nvar tblCols = [\r\n  {title: 'Name', data: 'item_name', render: nameRender},\r\n  {title: 'Level', data: 'stats.min_level'},\r\n  {\r\n    title: 'Where',\r\n    data: whereData,\r\n    render: {\r\n      _: whereRender,\r\n      display: whereRenderDisplay,\r\n      filter: whereRenderFilter\r\n    }\r\n  },\r\n  {\r\n    title: 'Type',\r\n    data: 'type',\r\n    render: function(type) {return itemType[type];}\r\n  },\r\n  {title: 'Att', data: 'stats.attack'},\r\n  {title: 'Def', data: 'stats.defense'},\r\n  {title: 'Arm', data: 'stats.armor'},\r\n  {title: 'Dam', data: 'stats.damage'},\r\n  {title: 'HP', data: 'stats.hp'},\r\n  {title: 'Frg', data: 'forge'},\r\n  {\r\n    title: 'Craft',\r\n    data: 'craft',\r\n    render: {\r\n      _: function(craft) {\r\n        if (craftHash[craft]) {\r\n          return craftHash[craft].index;\r\n        }\r\n        return 0;\r\n      },\r\n      display: craftRender,\r\n      filter: craftRender\r\n    }\r\n  },\r\n  {title: 'Du%', data: 'durability', render: durabilityRender},\r\n  {title: 'BP', data: whereData, render: bpRender},\r\n  {title: 'GS', data: whereData, render: gsRender},\r\n  {title: 'W/U', data: 'type', render: wearUseRender},\r\n  {\r\n    title: 'setName',\r\n    data: 'stats.set_name',\r\n    orderable: false,\r\n    visible: false\r\n  },\r\n  {\r\n    title: 'Tag',\r\n    data: 'guild_tag',\r\n    render: function(tag) {\r\n      if (tag === '-1') {return 'No';}\r\n      return 'Yes';\r\n    }\r\n  },\r\n  {title: 'Drop', data: 'type', render: dropRender},\r\n  {title: 'Send', data: 'type', render: sendRender}\r\n];\r\n\r\nexport default function doTable() { // jQuery\r\n  $('#pCC').append('<table id=\"fshInv\" class=\"hover\" ' +\r\n    'style=\"font-size: x-small;\"></table>');\r\n  var table = $('#fshInv').DataTable({\r\n    data: theInv.items,\r\n    autoWidth: false,\r\n    pageLength: 50,\r\n    lengthMenu: [[50, 100, 150, 200, -1], [50, 100, 150, 200, 'All']],\r\n    columnDefs: [{targets: '_all', defaultContent: ''},\r\n      {\r\n        targets: [1, 4, 5, 6, 7, 8, 9, 10, 12, 13],\r\n        orderSequence: ['desc', 'asc']\r\n      }],\r\n    columns: tblCols,\r\n    createdRow: createdRow,\r\n    stateSave: true,\r\n    stateDuration: 0\r\n  });\r\n  table.column(12).visible('current_player_id' in theInv);\r\n  table.column(17).visible('player_id' in theInv &&\r\n    showQuickDropLinks);\r\n  table.column(18).visible('player_id' in theInv &&\r\n    showQuickSendLinks);\r\n}\r\n","import fallback from '../../system/fallback';\r\nimport {rarity} from '../../support/dataObj';\r\nimport {theInv} from '../options';\r\n\r\nfunction getT(player_id) {\r\n  if (player_id === -1) {return 4;}\r\n  return 1;\r\n}\r\n\r\nfunction player(invPlayer, rowPlayer, guild) {\r\n  if (invPlayer) {return invPlayer;}\r\n  if (rowPlayer !== -1) {return rowPlayer;}\r\n  return guild;\r\n}\r\n\r\nfunction isPartOfSet(row) {\r\n  return row.stats && row.stats.set_name !== '';\r\n}\r\n\r\nfunction nameRenderDisplay(data, row) {\r\n  var cur = fallback(theInv.player_id,\r\n    theInv.current_player_id);\r\n  var t = getT(row.player_id);\r\n  var p = player(theInv.player_id, row.player_id,\r\n    theInv.guild_id);\r\n\r\n  var bold = data;\r\n  if (row.equipped) {bold = '<b>' + data + '</b>';}\r\n\r\n  var _setName = '';\r\n  if (isPartOfSet(row)) {\r\n    _setName = ' (<span class=\"fshLink setName\" set=\"' + row.stats.set_name +\r\n      '\">set</span>)';\r\n  }\r\n\r\n  return '<a href=\"index.php?cmd=auctionhouse&search_text=' + data +\r\n    '\" class=\"fshInvItem tip-dynamic ' +\r\n    rarity[row.rarity].clas + '\" ' +\r\n    'data-tipped=\"fetchitem.php?item_id=' + row.item_id +\r\n    '&inv_id=' + row.inv_id + '&t=' + t + '&p=' + p +\r\n    '&currentPlayerId=' + cur + '\">' +\r\n    bold + '</a>' + _setName;\r\n}\r\n\r\nexport default function nameRender(data, type, row) {\r\n  if (type !== 'display') {return data;}\r\n  return nameRenderDisplay(data, row);\r\n}\r\n","import playerName from './playerName';\r\n\r\nfunction whereRenderUserFolder(row) {\r\n  if (row.equipped) {return -2;}\r\n  return parseInt(row.folder_id, 10);\r\n}\r\n\r\nexport default function whereRender(data, type, row) {\r\n  if (row.folder_id) {\r\n    return whereRenderUserFolder(row);\r\n  }\r\n  if (row.player_id === -1) {return '~';}\r\n  return playerName(row.player_id);\r\n}\r\n","import isSelected from '../../system/isSelected';\r\nimport playerName from './playerName';\r\nimport {theInv} from '../options';\r\n\r\nfunction whereRenderGuildDisplay(row) {\r\n  if (row.player_id === -1) {return 'GS';}\r\n  return '<a class=\"fshMaroon\" href=\"index.php?cmd=profile&player_id=' +\r\n    row.player_id + '\">' + playerName(row.player_id) + '</a>';\r\n}\r\n\r\nexport default function whereRenderDisplay(data, type, row) {\r\n  if (row.player_id) {\r\n    return whereRenderGuildDisplay(row);\r\n  }\r\n  if (row.equipped) {return 'Worn';}\r\n  var folderSelect = '<select class=\"fshMoveItem\" data-inv=\"' + row.inv_id +\r\n    '\">';\r\n  var keysArray = Object.keys(theInv.folders)\r\n    .sort(function(a, b) {return a - b;});\r\n  keysArray.forEach(function(value) {\r\n    folderSelect += '<option value=\"' + value + '\"' +\r\n      isSelected(value, row.folder_id) + '>' +\r\n      theInv.folders[value] + '</option>';\r\n  });\r\n  folderSelect += '</select>';\r\n  return folderSelect;\r\n}\r\n","import playerName from './playerName';\r\nimport {theInv} from '../options';\r\n\r\nfunction whereRenderGuildFilter(row) {\r\n  if (row.player_id === -1) {return 'GS';}\r\n  return playerName(row.player_id);\r\n}\r\n\r\nexport default function whereRenderFilter(data, type, row) {\r\n  if (row.player_id) {\r\n    return whereRenderGuildFilter(row);\r\n  }\r\n  if (row.equipped) {return 'Worn';}\r\n  return theInv.folders[row.folder_id];\r\n}\r\n","export default function durabilityRender(data, type, row) {\r\n  if (parseInt(row.max_durability, 10) > 0) {\r\n    return Math.ceil(row.durability / row.max_durability * 100);\r\n  }\r\n}\r\n","import {theInv} from '../options';\r\n\r\nfunction bpDisplayType(type, row) {\r\n  if (type !== 'display') {return 'BP';}\r\n  if (row.player_id === -1) {\r\n    return '<span class=\"fshLink takeItem\" invid=\"' + row.inv_id +\r\n      '\" action=\"take\">BP</span>';\r\n  }\r\n  return '<span class=\"fshLink recallItem\" invid=\"' + row.inv_id +\r\n    '\" playerid=\"' + row.player_id +\r\n    '\" mode=\"0\" action=\"recall\">BP</span>';\r\n}\r\n\r\nexport default function bpRender(where, type, row) {\r\n  if (row.folder_id || row.player_id ===\r\n    theInv.current_player_id) {return;}\r\n  return bpDisplayType(type, row);\r\n}\r\n","function taggedOrEquipped(row) {\r\n  return row.guild_tag !== '-1' || row.equipped;\r\n}\r\n\r\nexport default function dropRender(data, type, row) {\r\n  if (taggedOrEquipped(row)) {return;}\r\n  if (type !== 'display') {return 'Drop';}\r\n  return '<span class=\"dropItem tip-static dropLink\" data-tipped=' +\r\n    '\"INSTANTLY DESTROY THE ITEM. NO REFUNDS OR DO-OVERS! Use at own risk.\"' +\r\n    ' data-inv=\"' + row.inv_id + '\">Drop</span>';\r\n}\r\n","import fallback from '../../system/fallback';\r\n\r\nexport default function sendRender(data, type, row) {\r\n  if (fallback(row.bound, row.equipped)) {return;}\r\n  if (type !== 'display') {return 'Send';}\r\n  return '<span class=\"sendItem tip-static sendLink\" data-tipped=' +\r\n    '\"INSTANTLY SEND THE ITEM. NO REFUNDS OR DO-OVERS! Use at own risk.\"' +\r\n    ' data-inv=\"' + row.inv_id + '\">Send</span>';\r\n}\r\n","import {options} from './options';\r\nimport setForage from '../ajax/setForage';\r\n\r\nexport default function setChecks() {\r\n  Array.prototype.forEach.call(\r\n    document.querySelectorAll('table.fshInvFilter input[type=\"checkbox\"]'),\r\n    function(el) {\r\n      el.checked =\r\n        options.checkedElements[el.getAttribute('item')] === 1;\r\n    });\r\n  setForage('fsh_inventory', options);\r\n}\r\n","import {inventoryCheckAll} from '../assets';\r\nimport {options} from '../options';\r\nimport setChecks from '../setChecks';\r\n\r\nexport default function allChecks() { // jQuery\r\n  options.checkedElements = inventoryCheckAll;\r\n  setChecks();\r\n  $('#fshInv').DataTable().draw(false);\r\n}\r\n","import {options} from '../options';\r\nimport setForage from '../../ajax/setForage';\r\n\r\nexport default function changeLvls() { // jQuery\r\n  var minLvl = parseInt($('#fshMinLvl').val(), 10);\r\n  var maxLvl = parseInt($('#fshMaxLvl').val(), 10);\r\n  if (isNaN(minLvl) || isNaN(maxLvl)) {return;}\r\n  options.fshMinLvl = minLvl;\r\n  options.fshMaxLvl = maxLvl;\r\n  setForage('fsh_inventory', options);\r\n  $('#fshInv').DataTable().draw(false);\r\n}\r\n","import {options} from '../options';\r\nimport setChecks from '../setChecks';\r\n\r\nfunction clearGearOnly(checkedElements) {\r\n  var newEle = {};\r\n  Object.keys(checkedElements).forEach(function(key) {\r\n    if (parseInt(key, 10) >= 100) {\r\n      newEle[key] = checkedElements[key];\r\n    }\r\n  });\r\n  return newEle;\r\n}\r\n\r\nexport default function clearChecks() { // jQuery\r\n  options.checkedElements = clearGearOnly(options.checkedElements);\r\n  setChecks();\r\n  $('#fshInv').DataTable().draw();\r\n}\r\n","import {imageServer} from '../../system/system';\r\n\r\nfunction removeClass(self) {\r\n  self.closest('tr')\r\n    .find('.takeItem, .recallItem, .wearItem, .dropItem, .sendItem, .storeItem')\r\n    .removeClass().qtip('hide');\r\n}\r\n\r\nfunction killRow(self, data) { // jQuery\r\n  if (data.r === 1) {return;}\r\n  var tr = self.closest('tr');\r\n  var td = $('td', tr);\r\n  td.eq(2).empty(); // Where\r\n  td.eq(12).empty(); // BP - GS\r\n  td.eq(13).empty(); // GS - W/U\r\n  td.eq(14).empty(); // W/U - Tag\r\n  td.eq(15).empty(); // Tag - Drop\r\n  td.eq(16).empty(); // ? - Send\r\n  tr.css('text-decoration', 'line-through');\r\n}\r\n\r\nfunction anotherSpinner(self) {\r\n  self.empty().append('<img src=\"' + imageServer +\r\n    '/skin/loading.gif\" width=\"11\" height=\"11\">');\r\n}\r\n\r\nexport default function doAction(fn, self) { // jQuery\r\n  removeClass(self);\r\n  fn().done(killRow.bind(null, self));\r\n  anotherSpinner(self);\r\n}\r\n","import dialog from './dialog';\r\nimport retryAjax from './retryAjax';\r\n\r\nexport default function dropItem(invIdList) {\r\n  return retryAjax({\r\n    url: 'index.php',\r\n    data: {\r\n      cmd: 'profile',\r\n      subcmd: 'dodropitems',\r\n      removeIndex: invIdList,\r\n      ajax: 1\r\n    },\r\n    dataType: 'json'\r\n  }).done(dialog);\r\n}\r\n","import {options} from '../options';\r\nimport setForage from '../../ajax/setForage';\r\n\r\nexport default function getChecks() { // jQuery\r\n  options.checkedElements = {};\r\n  Array.prototype.forEach.call(\r\n    document.querySelectorAll(\r\n      'table.fshInvFilter input[type=\"checkbox\"][item]:checked'),\r\n    function(el) {\r\n      options.checkedElements[el.getAttribute('item')] = 1;\r\n    });\r\n  setForage('fsh_inventory', options);\r\n  $('#fshInv').DataTable().draw(false);\r\n}\r\n","import dialog from './dialog';\r\nimport retryAjax from './retryAjax';\r\n\r\nexport default function moveItem(invIdList, folderId) {\r\n  return retryAjax({\r\n    url: 'index.php',\r\n    data: {\r\n      cmd: 'profile',\r\n      subcmd: 'sendtofolder',\r\n      inv_list: JSON.stringify(invIdList),\r\n      folder_id: folderId,\r\n      ajax: 1\r\n    },\r\n    dataType: 'json'\r\n  }).done(dialog);\r\n}\r\n","import {defaultOptions} from '../assets';\r\nimport {options} from '../options';\r\nimport setChecks from '../setChecks';\r\n\r\nexport default function resetChecks() { // jQuery\r\n  options.checkedElements = defaultOptions.checkedElements;\r\n  setChecks();\r\n  $('#fshInv').DataTable().draw(false);\r\n}\r\n","import {defaultOptions} from '../assets';\r\nimport {options} from '../options';\r\nimport setForage from '../../ajax/setForage';\r\n\r\nexport default function resetLvls() { // jQuery\r\n  options.fshMinLvl = defaultOptions.fshMinLvl;\r\n  options.fshMaxLvl = defaultOptions.fshMaxLvl;\r\n  setForage('fsh_inventory', options);\r\n  $('#fshMinLvl').val(options.fshMinLvl);\r\n  $('#fshMaxLvl').val(options.fshMaxLvl);\r\n  $('#fshInv').DataTable().draw(false);\r\n}\r\n","import dialog from './dialog';\r\nimport getValue from '../system/getValue';\r\nimport {infoBox} from '../support/layout';\r\nimport retryAjax from './retryAjax';\r\n\r\nfunction htmlResult(data) { // TODO change to app code to avoid 302 redirect\r\n  var info = infoBox(data);\r\n  var _r = 1;\r\n  // if (info.search(/(successfully|gained|components)/) !== -1) {_r = 0;}\r\n  if (info.includes('successfully')) {_r = 0;}\r\n  return {r: _r, m: info};\r\n}\r\n\r\nexport default function sendItem(invIdList) {\r\n  return retryAjax({\r\n    url: 'index.php',\r\n    data: {\r\n      no_mobile: 1,\r\n      cmd: 'trade',\r\n      subcmd: 'senditems',\r\n      xc: window.ajaxXC,\r\n      target_username: getValue('itemRecipient'),\r\n      sendItemList: invIdList\r\n    }\r\n  }).pipe(htmlResult)\r\n    .done(dialog);\r\n}\r\n","import backpack from '../ajax/backpack';\r\nimport equipItem from '../ajax/equipItem';\r\nimport errorDialog from '../app/errorDialog';\r\nimport recall from '../app/guild/inventory/recall';\r\nimport takeItem from '../ajax/takeItem';\r\nimport useItem from '../ajax/useItem';\r\n\r\nvar deferred = window.jQuery && jQuery.when();\r\n\r\nfunction itemStatus(data) {\r\n  return function() {return data;};\r\n}\r\n\r\nfunction doAction(fn, item, data) {\r\n  return fn(item).pipe(itemStatus(data));\r\n}\r\n\r\nfunction additionalAction(action, data) {\r\n  if (action === 'wear') {\r\n    return doAction(equipItem, data.b, data);\r\n    // Return takeitem status irrespective of the status of the equipitem\r\n  }\r\n  if (action === 'use') {\r\n    return doAction(useItem, data.b, data);\r\n    // Return takeitem status irrespective of the status of the useitem\r\n  }\r\n}\r\n\r\nfunction takeItemStatus(action, data) {\r\n  if (data.r === 0 && action !== 'take') {\r\n    return additionalAction(action, data);\r\n  }\r\n  return data;\r\n}\r\n\r\nexport function queueTakeItem(invId, action) {\r\n  // You have to chain them because they could be modifying the backpack\r\n  deferred = deferred.pipe(function pipeTakeToQueue() {\r\n    return takeItem(invId).pipe(takeItemStatus.bind(null, action));\r\n  });\r\n  return deferred;\r\n}\r\n\r\nfunction gotBackpack(o, data) {\r\n  return function(bpData) {\r\n    // TODO assuming backpack is successful...\r\n    var lastBackpackItem = bpData.items[bpData.items.length - 1].a;\r\n    if (o.action === 'wear') {\r\n      return doAction(equipItem, lastBackpackItem, data);\r\n      // Return recall status irrespective of the status of the equipitem\r\n    }\r\n    if (o.action === 'use') {\r\n      return doAction(useItem, lastBackpackItem, data);\r\n      // Return recall status irrespective of the status of the useitem\r\n    }\r\n  };\r\n}\r\n\r\nfunction recallItemStatus(o) {\r\n  return function(data) {\r\n    if (data.r === 0 && o.action !== 'recall') {\r\n      return backpack().pipe(gotBackpack(o, data));\r\n    }\r\n    return data;\r\n  };\r\n}\r\n\r\nfunction pipeRecallToQueue(o) {\r\n  return function() {\r\n    return recall(o.invId, o.playerId, o.mode).pipe(errorDialog)\r\n      .pipe(recallItemStatus(o));\r\n  };\r\n}\r\n\r\nexport function queueRecallItem(o) {\r\n  // You have to chain them because they could be modifying the backpack\r\n  deferred = deferred.pipe(pipeRecallToQueue(o));\r\n  return deferred;\r\n}\r\n","import dialog from './dialog';\r\nimport retryAjax from './retryAjax';\r\n\r\nexport default function takeItem(invId) {\r\n  return retryAjax({\r\n    url: 'index.php',\r\n    data: {\r\n      cmd: 'guild',\r\n      subcmd: 'inventory',\r\n      subcmd2: 'takeitem',\r\n      guildstore_id: invId,\r\n      ajax: 1\r\n    },\r\n    dataType: 'json'\r\n  }).done(dialog);\r\n}\r\n","import retryAjax from './retryAjax';\r\n\r\nexport default function backpack() {\r\n  return retryAjax({\r\n    url: 'index.php',\r\n    data: {cmd: 'profile', subcmd: 'fetchinv'},\r\n    dataType: 'json'\r\n  });\r\n}\r\n","import callApp from '../../callApp';\r\n// import failStub from '../../failStub';\r\n\r\nexport default function recall(invId, playerId, mode) {\r\n  // return failStub();\r\n  return callApp({\r\n    cmd: 'guild',\r\n    subcmd: 'inventory',\r\n    subcmd2: 'recall',\r\n    id: invId, // + 10000000,\r\n    player_id: playerId,\r\n    mode: mode\r\n  });\r\n}\r\n","import allChecks from './allChecks';\r\nimport changeLvls from './changeLvls';\r\nimport clearChecks from './clearChecks';\r\nimport doAction from './doAction';\r\nimport dostoreitems from '../../app/guild/inventory/dostoreitems';\r\nimport dropItem from '../../ajax/dropItem';\r\nimport equipItem from '../../ajax/equipItem';\r\nimport getChecks from './getChecks';\r\n// import {injectInventoryManagerNew} from '../inventory';\r\nimport moveItem from '../../ajax/moveItem';\r\nimport resetChecks from './resetChecks';\r\nimport resetLvls from './resetLvls';\r\nimport sendItem from '../../ajax/sendItem';\r\nimport useItem from '../../ajax/useItem';\r\nimport {queueRecallItem, queueTakeItem} from '../../ajaxQueue/queue';\r\n\r\nfunction setName(e) { // jQuery\r\n  $('#fshInv').DataTable().search($(e.target).attr('set')).draw();\r\n  $('#fshInv_filter input').focus();\r\n}\r\n\r\nfunction takeItem(e) { // jQuery\r\n  var self = $(e.target);\r\n  doAction(\r\n    queueTakeItem.bind(null, self.attr('invid'), self.attr('action')),\r\n    self\r\n  );\r\n}\r\n\r\nfunction recallItem(e) { // jQuery\r\n  var self = $(e.target);\r\n  doAction(\r\n    queueRecallItem.bind(null, {\r\n      invId: self.attr('invid'),\r\n      playerId: self.attr('playerid'),\r\n      mode: self.attr('mode'),\r\n      action: self.attr('action')\r\n    }),\r\n    self\r\n  );\r\n}\r\n\r\nfunction wearItem(e) { // jQuery\r\n  var self = $(e.target);\r\n  doAction(equipItem.bind(null, self.attr('invid')), self);\r\n}\r\n\r\nfunction doUseItem(e) { // jQuery\r\n  var self = $(e.target);\r\n  doAction(useItem.bind(null, self.attr('invid')), self);\r\n}\r\n\r\nfunction doMoveItem(e) { // jQuery\r\n  var self = $(e.target);\r\n  moveItem([self.data('inv')], self.val());\r\n}\r\n\r\nfunction doStoreItem(e) { // jQuery\r\n  var self = $(e.target);\r\n  doAction(dostoreitems.bind(null, [self.attr('invid')]), self);\r\n}\r\n\r\nfunction doDropItem(e) { // jQuery\r\n  var self = $(e.target);\r\n  doAction(dropItem.bind(null, [self.data('inv')]), self);\r\n}\r\n\r\nfunction doSendItem(e) { // jQuery\r\n  var self = $(e.target);\r\n  doAction(sendItem.bind(null, [self.data('inv')]), self);\r\n}\r\n\r\nexport default function eventHandlers() { // jQuery\r\n  // $('#fshRefresh').click(injectInventoryManagerNew);\r\n  $('#fshMinLvl, #fshMaxLvl').keyup(changeLvls);\r\n  $('#fshReset').click(resetLvls);\r\n  $('table.fshInvFilter').on('click', 'input[type=\"checkbox\"]', getChecks);\r\n  $('#fshAll').click(allChecks);\r\n  $('#fshNone').click(clearChecks);\r\n  $('#fshDefault').click(resetChecks);\r\n  $('#fshInv').on('click', 'span.setName', setName);\r\n  $('#fshInv').on('click', 'span.takeItem', takeItem);\r\n  $('#fshInv').on('click', 'span.recallItem', recallItem);\r\n  $('#fshInv').on('click', 'span.wearItem', wearItem);\r\n  $('#fshInv').on('click', 'span.useItem', doUseItem);\r\n  $('#fshInv').on('change', 'select.fshMoveItem', doMoveItem);\r\n  $('#fshInv').on('click', 'span.dropItem', doDropItem);\r\n  $('#fshInv').on('click', 'span.sendItem', doSendItem);\r\n  $('#fshInv').on('click', 'span.storeItem', doStoreItem);\r\n}\r\n","import callApp from '../../callApp';\r\nimport errorDialog from '../../errorDialog';\r\n\r\nexport default function dostoreitems(invIdAry) {\r\n  return callApp({\r\n    cmd: 'guild',\r\n    subcmd: 'inventory',\r\n    subcmd2: 'dostoreitems',\r\n    storeIndex: invIdAry\r\n  }).pipe(errorDialog);\r\n}\r\n","import intValue from '../system/intValue';\r\nimport {options} from './options';\r\n\r\nvar lvlTests = [\r\n  function(level) {return level === 0;},\r\n  function(level, min, max) {return isNaN(min) && isNaN(max);},\r\n  function(level, min, max) {return isNaN(min) && level <= max;},\r\n  function(level, min, max) {return min <= level && isNaN(max);},\r\n  function(level, min, max) {return min <= level && level <= max;}\r\n];\r\n\r\nfunction doLvlFilter(_settings, data) {\r\n  var min = options.fshMinLvl;\r\n  var max = options.fshMaxLvl;\r\n  var level = intValue(data[1]); // use data for the level column\r\n  for (var i = 0; i < lvlTests.length; i += 1) {\r\n    if (lvlTests[i](level, min, max)) {return true;}\r\n  }\r\n  return false;\r\n}\r\n\r\nexport function lvlFilter() { // jQuery\r\n  /* Custom filtering function which will search\r\n  data in column 2 between two values */\r\n  $.fn.dataTable.ext.search.push(doLvlFilter);\r\n}\r\n\r\nexport function typeFilter() { // jQuery\r\n  $.fn.dataTable.ext.search.push(\r\n    function(_settings, _row, _index, data) {\r\n      return !options.checkedElements ||\r\n        options.checkedElements[data.type];\r\n    }\r\n  );\r\n}\r\n\r\nfunction testSetId(data) {\r\n  return options.checkedElements['-1'] &&\r\n    data.stats && data.stats.set_id !== '-1';\r\n}\r\n\r\nexport function setFilter() { // jQuery\r\n  $.fn.dataTable.ext.search.push(\r\n    function(_settings, _row, _index, data) {\r\n      return !options.checkedElements ||\r\n        !options.checkedElements['-1'] ||\r\n        testSetId(data);\r\n    }\r\n  );\r\n}\r\n\r\nexport function rarityFilter() { // jQuery\r\n  $.fn.dataTable.ext.search.push(\r\n    function(_settings, _row, _index, data) {\r\n      var rarity = (parseInt(data.rarity, 10) + 100).toString();\r\n      return !options.checkedElements ||\r\n        options.checkedElements[rarity];\r\n    }\r\n  );\r\n}\r\n","import getValue from '../system/getValue';\r\nimport {pCC, playerId, playerName} from '../support/layout';\r\n\r\nvar currentPlayerId;\r\n\r\nfunction getPlayer(playerAry) { // Legacy\r\n  if (playerAry) {return Number(playerAry[1]);}\r\n  return 0;\r\n}\r\n\r\nfunction msgDoesNotIncludePlayer(aRow) {\r\n  var messageHTML = aRow.cells[2].innerHTML;\r\n  var doublerPlayerMessageRE =\r\n    /member\\s<a\\shref=\"index.php\\?cmd=profile&amp;player_id=(\\d+)/;\r\n  var secondPlayer = doublerPlayerMessageRE.exec(messageHTML);\r\n  var singlePlayerMessageRE =\r\n    /<a\\shref=\"index.php\\?cmd=profile&amp;player_id=(\\d+)/;\r\n  var firstPlayer = singlePlayerMessageRE.exec(messageHTML);\r\n  var firstPlayerID = getPlayer(firstPlayer);\r\n  var secondPlayerID = getPlayer(secondPlayer);\r\n  return firstPlayer &&\r\n    firstPlayerID !== currentPlayerId &&\r\n    secondPlayerID !== currentPlayerId;\r\n}\r\n\r\nfunction findPlayers(aRow) { // Legacy\r\n  if (msgDoesNotIncludePlayer(aRow)) {\r\n    for (var j = 0; j < 3; j += 1) {\r\n      aRow.cells[j].removeAttribute('class');\r\n    }\r\n    aRow.classList.add('fshGrey');\r\n    aRow.classList.add('fshXXSmall');\r\n  }\r\n}\r\n\r\nfunction likeInvite(aRow, hasInvited) { // Legacy\r\n  var message = aRow.cells[2].innerHTML;\r\n  var firstQuote = message.indexOf('\\'');\r\n  var firstPart = '';\r\n  firstPart = message.substring(0, firstQuote);\r\n  var secondQuote = message.indexOf('\\'', firstQuote + 1);\r\n  var targetPlayerName = message.substring(firstQuote + 1, secondQuote);\r\n  aRow.cells[2].innerHTML = firstPart + '\\'' +\r\n    '<a href=\"index.php?cmd=findplayer&search_active=1&' +\r\n    'search_level_max=&search_level_min=&search_username=' +\r\n    targetPlayerName + '&search_show_first=1\">' + targetPlayerName +\r\n    '</a>' + message.substring(secondQuote, message.length);\r\n  if (!hasInvited &&\r\n    targetPlayerName !== playerName()) {\r\n    $(aRow).find('td').removeClass('row').css('font-size', 'xx-small');\r\n    aRow.style.color = 'gray';\r\n  }\r\n}\r\n\r\nfunction guildInvite(aRow) { // Legacy\r\n  var hasInvited = aRow.cells[2].textContent\r\n    .search('has invited the player') !== -1;\r\n  if (aRow.cells[2].textContent.charAt(0) === '\\'' || hasInvited) {\r\n    likeInvite(aRow, hasInvited);\r\n  }\r\n}\r\n\r\nfunction processGuildWidgetRow(aRow) { // Legacy\r\n  findPlayers(aRow);\r\n  guildInvite(aRow);\r\n}\r\n\r\nfunction getMessageHeader() {\r\n  var nodeList = pCC.getElementsByTagName('TD');\r\n  for (var i = 0; i < nodeList.length; i += 1) {\r\n    if (nodeList[i].textContent === 'Message') {\r\n      return nodeList[i];\r\n    }\r\n  }\r\n}\r\n\r\nfunction guildLogWidgetsEnabled() { // Legacy\r\n  var messageNameCell = getMessageHeader();\r\n  if (!messageNameCell) {return;}\r\n  var logTable = messageNameCell.parentNode.parentNode.parentNode;\r\n  messageNameCell.innerHTML += '&nbsp;&nbsp;<span class=\"fshWhite\">' +\r\n    '(Guild Log messages not involving self are dimmed!)</span>';\r\n\r\n  currentPlayerId = playerId();\r\n\r\n  for (var i = 1; i < logTable.rows.length; i += 2) {\r\n    var aRow = logTable.rows[i];\r\n    processGuildWidgetRow(aRow);\r\n  }\r\n}\r\n\r\nexport default function addGuildLogWidgets() {\r\n  if (getValue('hideNonPlayerGuildLogMessages')) {\r\n    guildLogWidgetsEnabled();\r\n  }\r\n}\r\n","import findNode from '../system/findNode';\r\nimport getValue from '../system/getValue';\r\nimport parseDateAsTimestamp from '../system/parseDateAsTimestamp';\r\nimport {quickBuffHref} from '../support/layout';\r\nimport setValue from '../system/setValue';\r\n\r\nvar nowUtc;\r\nvar lastCheckUtc;\r\n\r\nfunction findChatTable() { // Legacy\r\n  var chatTable = findNode('//table[@class=\"width_full\"]'); // Guild Log\r\n  if (!chatTable) {\r\n    chatTable = findNode('//table[tbody/tr/td[.=\"Message\"]]'); // Outbox & Guild Chat\r\n  }\r\n  if (!chatTable) {\r\n    chatTable = findNode('//table[tbody/tr/td/span[' +\r\n      'contains(.,\"Currently showing:\")]]'); // personal log\r\n  }\r\n  return chatTable;\r\n}\r\n\r\nfunction isOldRow(postAgeMins, postDateUtc) {\r\n  return postAgeMins > 20 && postDateUtc <= lastCheckUtc;\r\n}\r\n\r\nfunction chatRowBuffLink(aRow, logScreen, addBuffTag) { // Legacy\r\n  if (logScreen === 'Chat' && addBuffTag) {\r\n    var playerIDRE = /player_id=(\\d+)/;\r\n    var playerID = playerIDRE.exec(aRow.cells[1].innerHTML)[1];\r\n    aRow.cells[1].innerHTML += ' <a class=\"fshBf\" ' +\r\n      quickBuffHref(playerID) + '>[b]</a>';\r\n  }\r\n}\r\n\r\nfunction rowColor(aRow, logScreen, dateColumn) { // Legacy\r\n  var addBuffTag = true;\r\n  var cellContents = aRow.cells[dateColumn].textContent;\r\n  var postDateUtc = parseDateAsTimestamp(cellContents);\r\n  var postAgeMins = (nowUtc - postDateUtc) / (1000 * 60);\r\n  if (postDateUtc > lastCheckUtc) {\r\n    aRow.classList.add('fshNr');\r\n  } else if (isOldRow(postAgeMins, postDateUtc)) {\r\n    aRow.classList.add('fshOr');\r\n    addBuffTag = false;\r\n  }\r\n  chatRowBuffLink(aRow, logScreen, addBuffTag);\r\n}\r\n\r\nfunction getLastCheck(lastCheckScreen) {\r\n  return getValue(lastCheckScreen) || nowUtc;\r\n}\r\n\r\nfunction doLogColoring(logScreen, dateColumn, chatTable) { // Legacy\r\n  nowUtc = (new Date()).setUTCSeconds(0, 0) - 1;\r\n  var lastCheckScreen = 'last' + logScreen + 'Check';\r\n  lastCheckUtc = getLastCheck(lastCheckScreen);\r\n  var increment = 2;\r\n  if (logScreen === 'Chat') {\r\n    increment = 4;\r\n    chatTable.classList.add('fshGc');\r\n  }\r\n  for (var i = 1; i < chatTable.rows.length; i += increment) {\r\n    rowColor(chatTable.rows[i], logScreen, dateColumn);\r\n  }\r\n  setValue(lastCheckScreen, nowUtc);\r\n}\r\n\r\nexport default function addLogColoring(logScreen, dateColumn) { // Legacy\r\n  if (!getValue('enableLogColoring')) {return;}\r\n  var chatTable = findChatTable();\r\n  if (chatTable) {doLogColoring(logScreen, dateColumn, chatTable);}\r\n}\r\n","import add from '../support/task';\r\nimport calf from '../support/calf';\r\nimport clearButton from './clearButton';\r\nimport decorate from './decorate';\r\nimport doTable from './table';\r\nimport eventHandlers from './eventHandlers/eventHandlers';\r\nimport getForage from '../ajax/getForage';\r\nimport getInventory from '../ajax/getInventory';\r\nimport getMembrList from '../ajax/getMembrList';\r\nimport headers from './headers';\r\nimport {imageServer} from '../system/system';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport setChecks from './setChecks';\r\nimport setLvls from './setLvls';\r\nimport {extendOptions, storeTheInv} from './options';\r\nimport {lvlFilter, rarityFilter, setFilter, typeFilter} from './filters';\r\nimport {time, timeEnd} from '../support/debug';\r\n\r\n/* jshint latedef: nofunc */\r\n\r\nfunction doSpinner() { // jQuery\r\n  $('#pCC').html('<span id=\"fshInvMan\"><img src = \"' +\r\n  imageServer + '/world/actionLoadingSpinner.gif\">&nbsp;' +\r\n    'Getting inventory data...</span>');\r\n}\r\n\r\nfunction rekeyMembrList() {\r\n  calf.membrList = Object.keys(calf.membrList)\r\n    // Using reduce() to rekey the membrList from names to id's\r\n    .reduce(function(prev, curr) {\r\n      if (curr !== 'lastUpdate') {\r\n        prev[calf.membrList[curr].id] =\r\n          calf.membrList[curr];\r\n      }\r\n      return prev;\r\n    }, {});\r\n}\r\n\r\nfunction getInvMan() {\r\n\r\n  time('inventory.getInvMan');\r\n\r\n  if (calf.membrList) {rekeyMembrList();}\r\n\r\n  decorate();\r\n  lvlFilter();\r\n  typeFilter();\r\n  setFilter();\r\n  rarityFilter();\r\n  headers();\r\n  setChecks();\r\n  setLvls();\r\n  doTable();\r\n  eventHandlers();\r\n  // eslint-disable-next-line no-use-before-define\r\n  $('#fshRefresh').click(injectInventoryManagerNew);\r\n  clearButton();\r\n\r\n  timeEnd('inventory.getInvMan');\r\n\r\n}\r\n\r\nfunction syncInvMan() { // jQuery\r\n  var prm = [];\r\n  prm.push(getInventory().done(storeTheInv));\r\n  if (calf.subcmd === 'guildinvmgr') {\r\n    prm.push(getMembrList(false));\r\n  }\r\n  prm.push(getForage('fsh_inventory')\r\n    .done(extendOptions)\r\n  );\r\n  $.when.apply($, prm).done(function() {\r\n    add(3, getInvMan);\r\n  });\r\n}\r\n\r\nexport function injectInventoryManagerNew() {\r\n  if (jQueryNotPresent()) {return;}\r\n  doSpinner();\r\n  syncInvMan();\r\n}\r\n","import {theInv} from './options';\r\n\r\nexport default function decorate() {\r\n  if (theInv.folders) {\r\n    theInv.folders['-1'] = 'Main';\r\n  }\r\n  // Hide composed potions until Zorg fixes the feed\r\n  theInv.items =\r\n    theInv.items.filter(function(obj) {\r\n      return obj.type !== '15';\r\n    });\r\n  //\r\n}\r\n","import {invManFilter} from './assets';\r\nimport {theInv} from './options';\r\n\r\nexport default function headers() { // jQuery\r\n  var reportTitle;\r\n  if (theInv.player_id) {\r\n    reportTitle = '<b>&nbsp;Inventory Manager</b> ' +\r\n      theInv.items.length +\r\n      ' items (green = worn, blue = backpack)';\r\n  } else {\r\n    reportTitle = '<b>&nbsp;Guild Inventory Manager</b> ' +\r\n      theInv.items.length +\r\n      ' items (maroon = in BP, blue=guild store)';\r\n  }\r\n  var myHtml = invManFilter.replace('@@reportTitle@@', reportTitle);\r\n  $('#pCC').html(myHtml);\r\n}\r\n","import {options} from './options';\r\n\r\nexport default function setLvls() { // jQuery\r\n  $('#fshMinLvl').val(options.fshMinLvl);\r\n  $('#fshMaxLvl').val(options.fshMaxLvl);\r\n}\r\n","export default function clearButton() { // jQuery\r\n  var input = $('#fshInv_filter input');\r\n  input.prop('type', 'text');\r\n  var clear = $('<span>&times;</span>');\r\n  input.wrap($('<span class=\"text-input-wrapper\"/>'));\r\n  input.after(clear);\r\n  clear.click(function() {\r\n    input.val('');\r\n    $('#fshInv').DataTable().search('').draw();\r\n  });\r\n}\r\n","import {getElementById} from '../common/getElement';\r\nimport {itemRE} from '../support/dataObj';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport outputResult from '../common/outputResult';\r\nimport retryAjax from '../ajax/retryAjax';\r\n\r\nfunction showError(data) { // jQuery\r\n  var $tempError = $('#temp_error');\r\n  $tempError.html('<span style=\"color: red\">Error:</span> ' + data.m);\r\n  $tempError.show().delay(5000).hide(400);\r\n}\r\n\r\nfunction failHndlr(jqXHR) {\r\n  showError({m: jqXHR.status + ' ' + jqXHR.statusText});\r\n}\r\n\r\nfunction quickDoneTaken(data) { // jQuery\r\n  if (data.r !== 0) {\r\n    showError(data);\r\n  } else {\r\n    var qtipId = $('#temp-inv-img-' + data.temp_id).data('hasqtip');\r\n    $('#temp-inv-' + data.temp_id).remove();\r\n    $('#qtip-' + qtipId).remove();\r\n  }\r\n  outputResult('Item taken.', getElementById('take_result'));\r\n}\r\n\r\nfunction takeAllSimilar(evt) { // jQuery.min\r\n  var invIds = evt.target.getAttribute('invIDs').split(',');\r\n  evt.target.parentNode.innerHTML = 'taking all ' +\r\n    invIds.length + ' items';\r\n  invIds.forEach(function(invId) {\r\n    retryAjax({\r\n      type: 'POST',\r\n      url: 'index.php',\r\n      data: {\r\n        cmd: 'tempinv',\r\n        subcmd: 'takeitem',\r\n        temp_id: invId,\r\n        ajax: '1'\r\n      },\r\n      dataType: 'json'\r\n    }).done(quickDoneTaken).fail(failHndlr);\r\n  });\r\n}\r\n\r\nfunction toggleQuickTake() { // jQuery\r\n  if ($('#currentMBDisplay').attr('value') === 'mailbox') {\r\n    $('#mailboxSwitcher').html('Toggle Mailbox');\r\n    $('#quickTake').css('display', 'block');\r\n    $('#regularMailbox').css('display', 'none');\r\n    $('#currentMBDisplay').attr('value', 'quicktake');\r\n  } else {\r\n    $('#mailboxSwitcher').html('Toggle Quick Take');\r\n    $('#quickTake').css('display', 'none');\r\n    $('#regularMailbox').css('display', 'block');\r\n    $('#currentMBDisplay').attr('value', 'mailbox');\r\n  }\r\n}\r\n\r\nexport default function injectMailbox() { // Bad jQuery\r\n  if (jQueryNotPresent()) {return;}\r\n  var items = $('#pCC a');\r\n  if (items.length === 0) {return;} // Empty mailbox\r\n  $('#pCC').wrapInner('<div id=\"regularMailbox\" />');\r\n  var quickTakeDiv = '<div id=\"quickTake\" style=\"display:none\"><br />' +\r\n    '<br /><center><font size=\"3\"><b>Quick Take</b></font>' +\r\n    '<br />Select which item to take all similar items from your ' +\r\n    'Mailbox.<br /></center>' +\r\n    '<table id=\"quickTakeTable\" align=\"left\"><tr><th width=20%>' +\r\n    'Actions</th><th>Items</th></tr><tr><td id=\"take_result\" ' +\r\n    'colspan=2></td></tr></table>' +\r\n    '</div>';\r\n  $('#pCC').prepend('<span id=\"mailboxSwitcher\" ' +\r\n    'style=\"cursor:pointer; text-decoration:underline; ' +\r\n    'color:blue;\">Toggle Quick Take</span><input type=\"hidden\" ' +\r\n    'id=\"currentMBDisplay\" value=\"mailbox\" />' + quickTakeDiv);\r\n  var itemList = {};\r\n  $('#regularMailbox img[data-tipped*=\"t=5\"]').each(function(i, e) {\r\n    var itemIDs = itemRE.exec($(e).attr('data-tipped'));\r\n    if (!itemIDs) {return;}\r\n    var itemId = itemIDs[1];\r\n    var invId = itemIDs[2];\r\n    var tipped = $(e).attr('data-tipped');\r\n    var src = $(e).attr('src');\r\n    if (!itemList[itemId]) {\r\n      var invIds = [];\r\n      invIds.push(invId);\r\n      itemList[itemId] = {\r\n        invIds: invIds,\r\n        tipped: tipped,\r\n        src: src\r\n      };\r\n    } else {\r\n      itemList[itemId].invIds.push(invId);\r\n    }\r\n  });\r\n  var quickTakeTable = $('#quickTakeTable');\r\n  Object.keys(itemList).forEach(function(id) {\r\n    var titem = itemList[id];\r\n    quickTakeTable.append('<tr><td align=center>' +\r\n      '<span style=\"cursor:pointer; text-decoration:underline; ' +\r\n      'color:blue; font-size:x-small;\" ' +\r\n      'id=\"Helper:takeAllSimilar' + id + '\" invIDs=\"' + titem.invIds.join() +\r\n      '\">Take All ' + titem.invIds.length + '</span></td>' +\r\n      '<td><img src=\"' + titem.src +\r\n      '\" class=\"tip-dynamic\" border=\"0\" data-tipped=\"' +\r\n      titem.tipped + '\"></td></tr>');\r\n    getElementById('Helper:takeAllSimilar' + id)\r\n      .addEventListener('click', takeAllSimilar, true);\r\n  });\r\n  getElementById('mailboxSwitcher')\r\n    .addEventListener('click', toggleQuickTake, true);\r\n}\r\n","var depoRe = /deposited ([,0-9]+) FallenSword Points into the guild./;\r\nvar lookup = [\r\n  {\r\n    condition: function(data) {return data.indexOf('(Potion)') !== -1;},\r\n    id: 1\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return data.indexOf('recalled the item') !== -1;\r\n    },\r\n    id: 2\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return data.indexOf('took the item') !== -1;\r\n    },\r\n    id: 2\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return data.indexOf('auto-returned the') !== -1;\r\n    },\r\n    id: 2\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return data.indexOf('stored the item') !== -1;\r\n    },\r\n    id: 2\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return data.indexOf('has added flags to') !== -1;\r\n    },\r\n    id: 3\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return data.indexOf('has removed flags to') !== -1;\r\n    },\r\n    id: 3\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return data.indexOf(\r\n        'relic. This relic now has an empower level of') !== -1;\r\n    },\r\n    id: 4\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return data.indexOf(\r\n        'relic. The relic empower level has been reset to zero.') !== -1;\r\n    },\r\n    id: 4\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return data.indexOf('failed to capture the relic') !== -1;\r\n    },\r\n    id: 4\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return data.indexOf('captured the relic') !== -1;\r\n    },\r\n    id: 4\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return data.indexOf('captured your relic') !== -1;\r\n    },\r\n    id: 4\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return data.indexOf('has captured the undefended relic') !== -1;\r\n    },\r\n    id: 4\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return data.indexOf('attempted to capture your relic') !== -1;\r\n    },\r\n    id: 4\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return / empowered the .+ relic/.test(data);\r\n    },\r\n    id: 4\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return / removed the empowerment from the .+ relic/.test(data);\r\n    },\r\n    id: 4\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return data.indexOf('disbanded a mercenary.') !== -1;\r\n    },\r\n    id: 5\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return data.indexOf('hired the mercenary') !== -1;\r\n    },\r\n    id: 5\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return data.indexOf('has disbanded one of their groups') !== -1;\r\n    },\r\n    id: 6\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return /A group from your guild was (.*) in combat./.test(data);\r\n    },\r\n    id: 6\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return /deposited ([,0-9]+) gold into the guild bank/.test(data);\r\n    },\r\n    id: 7\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return depoRe.test(data);\r\n    },\r\n    id: 7\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return data.indexOf('has added a new rank entitled') !== -1;\r\n    },\r\n    id: 8\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return data.indexOf('has deleted the rank') !== -1;\r\n    },\r\n    id: 8\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return data.indexOf('has requested to join the guild') !== -1;\r\n    },\r\n    id: 8\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return data.indexOf('has invited the player') !== -1;\r\n    },\r\n    id: 8\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return data.indexOf('has officially joined the guild') !== -1;\r\n    },\r\n    id: 8\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return data.indexOf('has been kicked from the guild by') !== -1;\r\n    },\r\n    id: 8\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return data.indexOf('has left the guild') !== -1;\r\n    },\r\n    id: 8\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return data.indexOf('has been assigned the rank') !== -1;\r\n    },\r\n    id: 8\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return /resulted in (.*) with a final score of/.test(data);\r\n    },\r\n    id: 9\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return data.indexOf('resulted in a draw. Your GvG rating ') !== -1;\r\n    },\r\n    id: 9\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return data.indexOf(\r\n        'has just initiated a conflict with the guild') !== -1;\r\n    },\r\n    id: 9\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return data.indexOf('has initiated a conflict with your guild') !== -1;\r\n    },\r\n    id: 9\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return data.indexOf('is participating in the conflict ' +\r\n        'against the guild') !== -1;\r\n    },\r\n    id: 9\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return data.indexOf('bought the Titan Reward item') !== -1;\r\n    },\r\n    id: 10\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return data.indexOf('from your guild\\'s contribution to the ' +\r\n        'defeat of the titan') !== -1;\r\n    },\r\n    id: 10\r\n  },\r\n  {\r\n    condition: function(data) {\r\n      return data.indexOf('a 7 day cooldown has been activated ' +\r\n        'on your guild for this titan') !== -1;\r\n    },\r\n    id: 10\r\n  }\r\n];\r\n\r\nexport function rowProfile(data) {\r\n  for (var i = 0; i < lookup.length; i += 1) {\r\n    var test = lookup[i];\r\n    if (test.condition(data)) {return test.id;}\r\n  }\r\n  return 0;\r\n}\r\n","export var guildLogFilter =\r\n  '<table id=\"fshNewGuildLog\" class=\"fshInvFilter\"><thead><tr>' +\r\n  '<th colspan=\"11\"><b>Guild Log Version 4</b></th>' +\r\n  '<th colspan=\"3\"><span id=\"rfsh\" class=\"sendLink\">Reset</span> ' +\r\n  '<a href=\"index.php?cmd=guild&subcmd=log\" class=\"sendLink\">' +\r\n  'Old Guild Log</a></th>' +\r\n  '</tr></thead><tbody>' +\r\n  '<tr><td rowspan=\"3\"><b>&nbsp;Filters:</b></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Potions:</td>' +\r\n  '<td><input id=\"fshPotion\" type=\"checkbox\" item=\"1\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Store/Recalls:</td>' +\r\n  '<td><input id=\"fshStore\" type=\"checkbox\" item=\"2\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Relics:</td>' +\r\n  '<td><input id=\"fshRelic\" type=\"checkbox\" item=\"4\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Mercenaries:</td>' +\r\n  '<td><input id=\"fshMerc\" type=\"checkbox\" item=\"5\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Group Combats:</td>' +\r\n  '<td><input id=\"fshGroup\" type=\"checkbox\" item=\"6\"/></td>' +\r\n  '<td colspan=\"3\">&nbsp;</td>' +\r\n  '</tr><tr>' +\r\n  '<td class=\"fshRight\">&nbsp;Donations:</td>' +\r\n  '<td><input id=\"fshDonation\" type=\"checkbox\" item=\"7\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Rankings:</td>' +\r\n  '<td><input id=\"fshRank\" type=\"checkbox\" item=\"8\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;GvGs:</td>' +\r\n  '<td><input id=\"fshGvG\" type=\"checkbox\" item=\"9\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Tag/UnTags:</td>' +\r\n  '<td><input id=\"fshTag\" type=\"checkbox\" item=\"3\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Titans:</td>' +\r\n  '<td><input id=\"fshTitan\" type=\"checkbox\" item=\"10\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Other:</td>' +\r\n  '<td><input id=\"fshOther\" type=\"checkbox\" item=\"0\"/></td>' +\r\n  '<td>&nbsp;</td>' +\r\n  '</tr><tr>' +\r\n  '<td colspan=\"2\">' +\r\n  '&nbsp;[<span id=\"fshAll\" class=\"fshLink\">Select All</span>]</td>' +\r\n  '<td colspan=\"2\">' +\r\n  '&nbsp;[<span id=\"fshNone\" class=\"fshLink\">Select None</span>]</td>' +\r\n  '<td colspan=\"9\"></td>' +\r\n  '</tr><tr><td id=\"fshOutput\" class=\"fshBlue\" colspan=\"14\">' +\r\n  'Loading Page 1 ...</td></tr>' +\r\n  '</tbody></table>' +\r\n  '<table id=\"fshInjectHere\">' +\r\n  '</table>';\r\nexport var headerRow = '<tbody><tr>' +\r\n  '<td class=\"header\" width=\"16\">&nbsp;</td>' +\r\n  '<td class=\"header\" width=\"20%\">Date</td>' +\r\n  '<td class=\"header\" width=\"80%\">Message</td></tr></tbody>';\r\nexport var msgType = [\r\n  'Unknown', // 0\r\n  'Potion', // 1\r\n  'showRecallMessages', // 2\r\n  'showTaggingMessages', // 3\r\n  'showRelicMessages', // 4\r\n  'showMercenaryMessages', // 5\r\n  'showGroupCombatMessages', // 6\r\n  'showDonationMessages', // 7\r\n  'showRankingMessages', // 8\r\n  'showGvGMessages', // 9\r\n  'showTitanMessages' // 10\r\n];\r\nexport var defChecks = [true, true, true, true, true, true,\r\n  true, true, true, true, true];\r\nexport var noChecks = [false, false, false, false, false, false,\r\n  false, false, false, false, false];\r\n","import addGuildLogWidgets from '../logs/addGuildLogWidgets';\r\nimport addLogColoring from '../logs/addLogColoring';\r\nimport createDocument from '../system/createDocument';\r\nimport {createTable} from '../common/cElement';\r\nimport eventHandler from '../common/eventHandler';\r\nimport {getElementById} from '../common/getElement';\r\nimport getForage from '../ajax/getForage';\r\nimport getValue from '../system/getValue';\r\nimport {imageServer} from '../system/system';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {pCC} from '../support/layout';\r\nimport parseDateAsTimestamp from '../system/parseDateAsTimestamp';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport {rowProfile} from './profiler';\r\nimport setForage from '../ajax/setForage';\r\nimport toggleForce from '../common/toggleForce';\r\nimport {defChecks, guildLogFilter, headerRow, noChecks} from './assets';\r\n\r\nvar options = {};\r\nvar fshNewGuildLog;\r\nvar fshOutput;\r\nvar maxPagesToFetch;\r\nvar maxPage;\r\nvar doc;\r\nvar currPage;\r\nvar lastPage;\r\nvar tmpGuildLog = [];\r\nvar completeReload = true;\r\nvar myTable;\r\n\r\nfunction getGuildLogPage(page) {\r\n  return retryAjax({\r\n    url: 'index.php',\r\n    data: {no_mobile: 1, cmd: 'guild', subcmd: 'log', page: page},\r\n    datatype: 'html'\r\n  });\r\n}\r\n\r\nfunction findPageInput(prev, curr) {\r\n  var output = prev;\r\n  if (!prev && curr.name === 'page') {output = curr;}\r\n  return output;\r\n}\r\n\r\nfunction getPageInput() {\r\n  var inputList = getElementById('pCC', doc)\r\n    .getElementsByClassName('custominput');\r\n  return Array.prototype.reduce.call(inputList, findPageInput, null);\r\n}\r\n\r\nfunction parsePage(data) {\r\n  doc = createDocument(data);\r\n  var pageInput = getPageInput();\r\n  currPage = Number(pageInput.value);\r\n  lastPage = Number(/\\d+/.exec(pageInput.parentNode.textContent)[0]);\r\n  if (currPage === 1) {maxPage = Math.min(lastPage, maxPagesToFetch);}\r\n  fshOutput.textContent = 'Loading ' + currPage + ' of ' + maxPage + '...';\r\n}\r\n\r\nfunction rowMatchesLog(timestamp, myMsg) {\r\n  return timestamp === options.log[0][0] && myMsg === options.log[0][2];\r\n}\r\n\r\nfunction seenRowBefore(timestamp, myMsg) {\r\n  return currPage === 1 && options.log && rowMatchesLog(timestamp, myMsg);\r\n}\r\n\r\nfunction getTableList(tableList) {\r\n  var theTable = tableList[0];\r\n  var limit = theTable.rows.length - 1;\r\n  for (var i = 1; i < limit; i += 2) {\r\n    var myRow = theTable.rows[i];\r\n    var myDate = myRow.cells[1].textContent;\r\n    var timestamp = parseDateAsTimestamp(myDate);\r\n    var myMsg = myRow.cells[2].innerHTML;\r\n    if (seenRowBefore(timestamp, myMsg)) {\r\n      completeReload = false;\r\n      break;\r\n    }\r\n    tmpGuildLog.push([currPage * 100 + i, timestamp, myDate, myMsg,\r\n      rowProfile(myMsg)]);\r\n  }\r\n}\r\n\r\nfunction parseTable() {\r\n  var tableList = doc.getElementsByClassName('width_full');\r\n  if (tableList.length === 1) {getTableList(tableList);}\r\n}\r\n\r\nfunction processPage(data) {\r\n  parsePage(data);\r\n  parseTable();\r\n}\r\n\r\nfunction getOtherPages() {\r\n  var prm = [];\r\n  if (completeReload) {\r\n    for (var i = 2; i <= maxPage; i += 1) {\r\n      prm.push(getGuildLogPage(i).done(processPage));\r\n    }\r\n  } else {\r\n    options.log.forEach(function(e) {\r\n      tmpGuildLog.push([0, e[0], e[1], e[2], e[3]]);\r\n    });\r\n  }\r\n  return $.when.apply($, prm);\r\n}\r\n\r\nfunction storeOptions() {\r\n  setForage('fsh_guildLog', options);\r\n}\r\n\r\nfunction updateOptionsLog() {\r\n  // Don't cache current minute as it may be incomplete\r\n  var nowUtc = (new Date()).setSeconds(0, 0);\r\n  options.log = tmpGuildLog.reduce(function(prev, curr) {\r\n    if (curr[1] !== nowUtc) {\r\n      prev.push([curr[1], curr[2], curr[3], curr[4]]);\r\n    }\r\n    return prev;\r\n  }, []);\r\n  storeOptions();\r\n}\r\n\r\nfunction buildTable() {\r\n  myTable = createTable({id: 'fshInjectHere', className: 'width_full'});\r\n  myTable.insertAdjacentHTML('beforeend', headerRow);\r\n\r\n  tmpGuildLog.forEach(function(r) {\r\n    var myRow = myTable.insertRow(-1);\r\n    r.push(myRow);\r\n    if (!options.checks[r[4]]) {myRow.className = 'fshHide';}\r\n    myRow.insertCell(-1).innerHTML =\r\n      '<span class=\"newGuildLog\" style=\"background-image: url(\\'' +\r\n      imageServer + '/skin/log_1.gif\\');\"></span>';\r\n    myRow.cells[0].className = 'row';\r\n    myRow.insertCell(-1).innerHTML = '<nobr>' + r[2] + '</nobr>';\r\n    myRow.cells[1].className = 'row';\r\n    myRow.insertCell(-1).innerHTML = r[3];\r\n    myRow.cells[2].className = 'row';\r\n    var sepRow = myTable.insertRow(-1);\r\n    r.push(sepRow);\r\n    if (!options.checks[r[4]]) {sepRow.className = 'fshHide';}\r\n    var sep = sepRow.insertCell(-1);\r\n    sep.className = 'divider';\r\n    sep.colSpan = 3;\r\n  });\r\n\r\n  var injector = getElementById('fshInjectHere');\r\n  pCC.replaceChild(myTable, injector);\r\n  addLogColoring('myGuildLog', 1);\r\n  addGuildLogWidgets();\r\n}\r\n\r\nfunction setChecks() {\r\n  Array.prototype.forEach.call(\r\n    fshNewGuildLog.getElementsByTagName('input'),\r\n    function(el) {\r\n      el.checked = options.checks[el.getAttribute('item')];\r\n    }\r\n  );\r\n  storeOptions();\r\n}\r\n\r\nfunction gotOtherPages() {\r\n  if (completeReload) {\r\n    tmpGuildLog.sort(function(a, b) {\r\n      return a[0] - b[0];\r\n    });\r\n  }\r\n  fshOutput.textContent = 'Loading complete.';\r\n  updateOptionsLog();\r\n  buildTable();\r\n}\r\n\r\nfunction processFirstPage(data) {\r\n  processPage(data);\r\n  getOtherPages().done(gotOtherPages);\r\n}\r\n\r\nfunction toggleItem(self) {\r\n  var item = Number(self.getAttribute('item'));\r\n  options.checks[item] = !options.checks[item];\r\n  storeOptions();\r\n  var hide = !options.checks[item];\r\n  tmpGuildLog.forEach(function(r) {\r\n    if (r[4] !== item) {return;}\r\n    toggleForce(r[5], hide);\r\n    toggleForce(r[6], hide);\r\n  });\r\n}\r\n\r\nfunction selectAll() {\r\n  options.checks = defChecks.slice(0);\r\n  setChecks();\r\n  tmpGuildLog.forEach(function(r) {\r\n    r[5].classList.remove('fshHide');\r\n    r[6].classList.remove('fshHide');\r\n  });\r\n}\r\n\r\nfunction selectNone() {\r\n  options.checks = noChecks.slice(0);\r\n  setChecks();\r\n  tmpGuildLog.forEach(function(r) {\r\n    r[5].classList.add('fshHide');\r\n    r[6].classList.add('fshHide');\r\n  });\r\n}\r\n\r\nfunction refresh() {\r\n  options.log = false;\r\n  storeOptions();\r\n  fshOutput.textContent = 'Loading Page 1 ...';\r\n  tmpGuildLog = [];\r\n  completeReload = true;\r\n  getElementById('fshInjectHere').innerHTML = '';\r\n  getGuildLogPage(1).done(processFirstPage);\r\n}\r\n\r\nvar guildLogEvents = [\r\n  {test: function(self) {return self.tagName === 'INPUT';}, act: toggleItem},\r\n  {test: function(self) {return self.id === 'fshAll';}, act: selectAll},\r\n  {test: function(self) {return self.id === 'fshNone';}, act: selectNone},\r\n  {test: function(self) {return self.id === 'rfsh';}, act: refresh}\r\n];\r\n\r\nfunction gotOptions(guildLog) {\r\n  options = guildLog || options;\r\n  options.checks = options.checks || defChecks.slice(0);\r\n  pCC.innerHTML = guildLogFilter;\r\n  fshNewGuildLog = getElementById('fshNewGuildLog');\r\n  fshNewGuildLog.addEventListener('click', eventHandler(guildLogEvents));\r\n  setChecks();\r\n  fshOutput = getElementById('fshOutput');\r\n  maxPagesToFetch = Number(getValue('newGuildLogHistoryPages'));\r\n  maxPage = maxPagesToFetch;\r\n  getGuildLogPage(1).done(processFirstPage);\r\n}\r\n\r\nexport default function injectNewGuildLog() { // jQuery.min\r\n  if (jQueryNotPresent()) {return;}\r\n  getForage('fsh_guildLog').done(gotOptions);\r\n}\r\n","import getCustomUrlParameter from '../system/getCustomUrlParameter';\r\nimport {getElementById} from '../common/getElement';\r\nimport {pCC} from '../support/layout';\r\nimport retryAjax from '../ajax/retryAjax';\r\n\r\nvar bpc;\r\n\r\nfunction bp() {\r\n  if (!bpc) {\r\n    bpc = getElementById('backpackContainer');\r\n  }\r\n  return bpc;\r\n}\r\n\r\nvar elementTests = [\r\n  function(self) {return self.tagName === 'A';},\r\n  function(self) {return Boolean(self.href);},\r\n  function(self) {return self.href.includes('togglesection');}\r\n];\r\n\r\nfunction isSectionToggle(self) {\r\n  return elementTests.every(function(el) {\r\n    return el(self);\r\n  });\r\n}\r\n\r\nfunction oldStyleDiv(target) {\r\n  if (target.style.display === 'block') {\r\n    target.classList.add('fshHide');\r\n  }\r\n  target.removeAttribute('style');\r\n  return 0;\r\n}\r\n\r\nfunction toggleTarget(target) {\r\n  if (target.hasAttribute('style')) {\r\n    oldStyleDiv(target);\r\n  } else {\r\n    target.classList.toggle('fshHide');\r\n  }\r\n}\r\n\r\nfunction toggleSection(self) {\r\n  var sectionId = Number(getCustomUrlParameter(self.href, 'section_id'));\r\n  if (sectionId === 5) {\r\n    toggleTarget(bp());\r\n  } else {\r\n    toggleTarget(self.parentNode.parentNode.nextElementSibling);\r\n  }\r\n}\r\n\r\nfunction testForSection(evt) {\r\n  var self = evt.target;\r\n  if (isSectionToggle(self)) {\r\n    toggleSection(self);\r\n    retryAjax(self.href);\r\n    evt.preventDefault();\r\n  }\r\n}\r\n\r\nexport default function ajaxifyProfileSections() {\r\n  pCC.addEventListener('click', testForSection);\r\n}\r\n","import {closestTable} from './closest';\r\nimport {createDiv} from './cElement';\r\n\r\nfunction cellOneHazText(curr) {\r\n  return curr.cells[1] && curr.cells[1].textContent;\r\n}\r\n\r\nfunction reduceStatTable(prev, curr, index) {\r\n  var key = curr.cells[0].textContent.trim().replace(':', '');\r\n  if (!key) {return prev;}\r\n  prev[key] = {ind: index};\r\n  if (cellOneHazText(curr)) {\r\n    prev[key].value = Number(\r\n      curr.cells[1].textContent.trim().replace('+', '')\r\n    );\r\n  }\r\n  return prev;\r\n}\r\n\r\nfunction getVal(prop, obj) {\r\n  if (obj[prop] && obj[prop].value) {\r\n    return obj[prop].value;\r\n  }\r\n  return 0;\r\n}\r\n\r\nfunction getLastIndex(obj, tbl) {\r\n  if (obj.Enhancements) {\r\n    return tbl.rows[obj.Enhancements.ind - 1];\r\n  }\r\n  return tbl.rows[tbl.rows.length - 1];\r\n}\r\n\r\nfunction addStats(el) {\r\n  var statTable = closestTable(el);\r\n  var statObj = Array.prototype.reduce.call(statTable.rows,\r\n    reduceStatTable, {});\r\n  var totalStats = getVal('Attack', statObj) + getVal('Defense', statObj) +\r\n    getVal('Armor', statObj) + getVal('Damage', statObj) +\r\n    getVal('HP', statObj);\r\n  getLastIndex(statObj, statTable).insertAdjacentHTML('beforebegin',\r\n    '<tr class=\"fshDodgerBlue\"><td>Stat Total:</td><td align=\"right\">' +\r\n    totalStats + '&nbsp;</td></tr>');\r\n}\r\n\r\nfunction fshDataFilter(data) {\r\n  var container = createDiv();\r\n  container.insertAdjacentHTML('beforeend', data);\r\n  var bonus = container.getElementsByTagName('font');\r\n  bonus = Array.prototype.filter.call(bonus, function(el) {\r\n    return el.textContent === 'Bonuses';\r\n  });\r\n  bonus.forEach(addStats);\r\n  return container.innerHTML;\r\n}\r\n\r\nfunction fshPreFilter(options) {\r\n  if (options.url.indexOf('fetchitem') !== 0) {return;}\r\n  options.dataFilter = fshDataFilter;\r\n}\r\n\r\nexport default function addStatTotalToMouseover() { // jQuery\r\n  $.ajaxPrefilter(fshPreFilter);\r\n}\r\n","import {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport jConfirm from '../common/jConfirm';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport {sendEvent} from '../support/fshGa';\r\n\r\nvar disableDeactivatePrompts = getValue('disableDeactivatePrompts');\r\n\r\nfunction debuff(buffId) {\r\n  return retryAjax({\r\n    url: 'fetchdata.php',\r\n    data: {\r\n      a: '22',\r\n      d: '0',\r\n      id: buffId\r\n    },\r\n    dataType: 'json'\r\n  });\r\n}\r\n\r\nfunction doDebuff(aLink) { // jQuery\r\n  sendEvent('profile', 'doDebuff');\r\n  var buffId = aLink.href.match(/(\\d+)$/)[1];\r\n  debuff(buffId)\r\n    .done(function(data) {\r\n      if (data.response.response === 0) {\r\n        aLink.parentNode.innerHTML = '';\r\n      } else {\r\n        $('#dialog_msg').html(data.response.msg).dialog('open');\r\n      }\r\n    });\r\n}\r\n\r\nfunction doPrompt(aLink) {\r\n  var onclick = aLink.getAttribute('onclick');\r\n  var warn = onclick\r\n    .match(/Are you sure you wish to remove the .* skill\\?/)[0];\r\n  jConfirm('Remove Skill', warn, function() {\r\n    doDebuff(aLink);\r\n  });\r\n}\r\n\r\nfunction checkForPrompt(aLink) {\r\n  if (!disableDeactivatePrompts) {\r\n    doPrompt(aLink);\r\n  } else {\r\n    doDebuff(aLink);\r\n  }\r\n}\r\n\r\nfunction interceptDebuff(e) { // jQuery\r\n  var aLink = e.target;\r\n  if (aLink.tagName === 'IMG') {\r\n    $(e.target).qtip('hide');\r\n    aLink = aLink.parentNode;\r\n  } else if (aLink.tagName !== 'A') {return;}\r\n  e.stopPropagation();\r\n  e.preventDefault();\r\n  checkForPrompt(aLink);\r\n}\r\n\r\nexport default function fastDebuff() {\r\n  var profileRightColumn = getElementById('profileRightColumn')\r\n    .lastElementChild;\r\n  profileRightColumn.addEventListener('click', interceptDebuff, true);\r\n}\r\n","import {getElementById} from '../common/getElement';\r\nimport insertElement from '../common/insertElement';\r\nimport insertTextBeforeEnd from '../common/insertTextBeforeEnd';\r\nimport {sendEvent} from '../support/fshGa';\r\nimport unequipitem from '../app/profile/unequipitem';\r\nimport {createButton, createDiv} from '../common/cElement';\r\n\r\nvar profileCombatSetDiv;\r\n\r\nfunction getNekid() {\r\n  sendEvent('profile', 'nekidBtn');\r\n  var profileBlock = profileCombatSetDiv.nextElementSibling;\r\n  var aLinks = profileBlock.getElementsByTagName('a');\r\n  Array.prototype.forEach.call(aLinks, function(link) {\r\n    var item = /inventory_id=(\\d+)/.exec(link.href)[1];\r\n    if (item) {\r\n      unequipitem(item).done(function(json) {\r\n        if (json.s) {link.parentNode.innerHTML = '';}\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\nexport default function nekidBtn() {\r\n  var profileRightColumn = getElementById('profileRightColumn');\r\n  profileCombatSetDiv = getElementById('profileCombatSetDiv');\r\n  var targetBr = profileCombatSetDiv.parentNode.nextElementSibling;\r\n  var nekidDiv = createDiv({className: 'fshCenter'});\r\n  var theBtn = createButton({\r\n    className: 'fshBl fshBls',\r\n    textContent: 'Nekid'\r\n  });\r\n  insertTextBeforeEnd(nekidDiv, '[ ');\r\n  insertElement(nekidDiv, theBtn);\r\n  insertTextBeforeEnd(nekidDiv, ' ]');\r\n  profileRightColumn.replaceChild(nekidDiv, targetBr);\r\n  theBtn.addEventListener('click', getNekid);\r\n}\r\n\r\n","import createDocument from '../system/createDocument';\r\nimport eventHandler from '../common/eventHandler';\r\nimport {getElementById} from '../common/getElement';\r\nimport {imageServer} from '../system/system';\r\nimport {infoBox} from '../support/layout';\r\nimport insertQuickExtract from '../quickExtract';\r\nimport insertTextBeforeEnd from '../common/insertTextBeforeEnd';\r\nimport jQueryDialog from '../chrome/jQueryDialog';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport {sendEvent} from '../support/fshGa';\r\nimport {\r\n  createDiv,\r\n  createSpan,\r\n  createTBody,\r\n  createTable\r\n} from '../common/cElement';\r\n\r\nvar quickDelDiv;\r\nvar sumComp;\r\nvar delAllDiv;\r\nvar compDel;\r\nvar compSum;\r\nvar compDelAll;\r\nvar qe;\r\nvar thisInvTable;\r\nvar componentList = {};\r\nvar usedCount;\r\nvar usedCountDom;\r\nvar totalCount;\r\nvar pageCount;\r\n\r\nfunction getInvTables(doc) {\r\n  return getElementById('profileRightColumn', doc)\r\n    .getElementsByClassName('inventory-table');\r\n}\r\n\r\nfunction tallyComponent(visible, el) {\r\n  var mouseover = el.dataset.tipped;\r\n  var id = mouseover.match(/fetchitem.php\\?item_id=(\\d+)/)[1];\r\n  componentList[id] = componentList[id] || {\r\n    count: 0,\r\n    src: el.getAttribute('src'),\r\n    onmouseover: mouseover,\r\n    del: [],\r\n    dom: []\r\n  };\r\n  componentList[id].count += 1;\r\n  componentList[id].del.push(el.parentNode.href);\r\n  if (visible) {componentList[id].dom.push(el.parentNode.parentNode);}\r\n  usedCount += 1;\r\n}\r\n\r\nfunction retriveComponent(doc) {\r\n  var visible = doc === document;\r\n  var invTbl = getInvTables(doc)[1];\r\n  var nodeList = invTbl.getElementsByTagName('IMG');\r\n  Array.prototype.forEach.call(nodeList, tallyComponent.bind(null, visible));\r\n  totalCount += invTbl.querySelectorAll(\r\n    'td[background$=\"inventory/1x1mini.gif\"]').length;\r\n}\r\n\r\nfunction tallyTableRow(prev, id) {\r\n  var comp = componentList[id];\r\n  return prev + '<tr><td><img src=\"' + comp.src +\r\n    '\" class=\"fshTblCenter tip-dynamic\" data-tipped=\"' + comp.onmouseover +\r\n    '\"></td><td>' + comp.count + '</td>' +\r\n    '<td>[<span class=\"sendLink compDelType\" data-compid=\"' + id +\r\n    '\">Del</span>]</td></tr>';\r\n}\r\n\r\nfunction displayComponentTally() {\r\n  var tbl = createTable({className: 'fshTblCenter'});\r\n  var tBody = createTBody();\r\n  tbl.appendChild(tBody);\r\n  tBody.insertAdjacentHTML('beforeend',\r\n    '<tr><td colspan=\"3\">Component Summary</td></tr>' +\r\n    Object.keys(componentList).reduce(tallyTableRow, ''));\r\n  var totRow = tbl.insertRow(-1);\r\n  totRow.insertAdjacentHTML('beforeend', '<td>Total:</td>');\r\n  var totCell = totRow.insertCell(-1);\r\n  totCell.colSpan = 2;\r\n  usedCountDom = createSpan();\r\n  usedCountDom.innerHTML = usedCount.toString();\r\n  totCell.appendChild(usedCountDom);\r\n  insertTextBeforeEnd(totCell, ' / ' + totalCount.toString());\r\n  sumComp.innerHTML = '';\r\n  sumComp.appendChild(tbl);\r\n}\r\n\r\nfunction gotComponentsPage(data) {\r\n  pageCount += 1;\r\n  sumComp.insertAdjacentHTML('beforeend', pageCount + ', ');\r\n  retriveComponent(createDocument(data));\r\n}\r\n\r\nfunction countComponent(self) { // jQuery.min\r\n  sendEvent('components', 'countComponent');\r\n  self.parentNode.innerHTML = 'Retrieve page: 1, ';\r\n  usedCount = 0;\r\n  totalCount = 0;\r\n  pageCount = 1;\r\n  var prm = [$.when(document).done(retriveComponent)];\r\n  var lastRowIndex = thisInvTable.rows.length - 1;\r\n  var pageLinks = thisInvTable.rows[lastRowIndex].firstChild.children;\r\n  Array.prototype.forEach.call(pageLinks, function(el) {\r\n    if (el.children.length === 0) {\r\n      prm.push(retryAjax(el.href).done(gotComponentsPage));\r\n    }\r\n  });\r\n  $.when.apply($, prm).done(displayComponentTally);\r\n}\r\n\r\nfunction delAllComponent() {\r\n  sendEvent('components', 'delAllComponent');\r\n  var nodeList = thisInvTable.getElementsByClassName('compDelBtn');\r\n  Array.prototype.forEach.call(nodeList, function(el) {\r\n    el.click();\r\n  });\r\n}\r\n\r\nfunction compDeleted(self, data) {\r\n  var response = infoBox(data);\r\n  if (response === 'Component destroyed.') {\r\n    self.parentNode.innerHTML = '';\r\n  } else {\r\n    $('#dialog_msg').html(response).dialog('open');\r\n  }\r\n}\r\n\r\nfunction delComponent(self) { // jQuery.min\r\n  var href = self.previousElementSibling.href;\r\n  retryAjax(href).done(compDeleted.bind(null, self));\r\n}\r\n\r\nfunction addDelBtn(el) {\r\n  el.parentNode.parentNode.insertAdjacentHTML('beforeend',\r\n    '<span class=\"compDelBtn\">Del</span>');\r\n}\r\n\r\nfunction enableDelComponent() {\r\n  sendEvent('components', 'enableDelComponent');\r\n  quickDelDiv.classList.add('fshHide');\r\n  delAllDiv.classList.remove('fshHide');\r\n  var nodeList = thisInvTable.getElementsByTagName('IMG');\r\n  Array.prototype.forEach.call(nodeList, addDelBtn);\r\n}\r\n\r\nfunction updateUsedCount() {\r\n  usedCount -= 1;\r\n  usedCountDom.textContent = usedCount.toString();\r\n}\r\n\r\nfunction delCompType(self) { // jQuery.min\r\n  var id = self.dataset.compid;\r\n  var td = self.parentNode;\r\n  td.innerHTML = '';\r\n  td.className = 'guildTagSpinner';\r\n  td.style.backgroundImage = 'url(\\'' + imageServer +\r\n    '/skin/loading.gif\\')';\r\n  var prm = [];\r\n  componentList[id].del.forEach(function(href) {\r\n    prm.push(retryAjax(href).done(updateUsedCount));\r\n  });\r\n  $.when.apply($, prm).done(function() {\r\n    componentList[id].dom.forEach(function(el) {el.innerHTML = '';});\r\n    td.parentNode.remove();\r\n  });\r\n}\r\n\r\nvar evtHdl = [\r\n  {\r\n    test: function(self) {return self === compDel;},\r\n    act: enableDelComponent\r\n  },\r\n  {\r\n    test: function(self) {return self === compSum;},\r\n    act: countComponent\r\n  },\r\n  {\r\n    test: function(self) {return self === compDelAll;},\r\n    act: delAllComponent\r\n  },\r\n  {\r\n    test: function(self) {return self === qe;},\r\n    act: function() {\r\n      sendEvent('components', 'insertQuickExtract');\r\n      jQueryDialog(insertQuickExtract);\r\n    }\r\n  },\r\n  {\r\n    test: function(self) {return self.classList.contains('compDelBtn');},\r\n    act: delComponent\r\n  },\r\n  {\r\n    test: function(self) {return self.classList.contains('compDelType');},\r\n    act: delCompType\r\n  }\r\n];\r\n\r\nfunction decorateButton(parentDiv, label) {\r\n  var innerSpan = createSpan(\r\n    {className: 'sendLink', textContent: label});\r\n  parentDiv.textContent = '[';\r\n  parentDiv.appendChild(innerSpan);\r\n  parentDiv.insertAdjacentHTML('beforeend', ']');\r\n  return innerSpan;\r\n}\r\n\r\nexport default function profileComponents() {\r\n  var invTables = getInvTables(document);\r\n  if (invTables.length !== 2) {return;}\r\n  thisInvTable = invTables[1];\r\n  var compDiv = thisInvTable.parentNode;\r\n  var cmDiv = createDiv({className: 'fshCenter'});\r\n  quickDelDiv = createDiv();\r\n  sumComp = createDiv();\r\n  delAllDiv = createDiv({className: 'fshHide'});\r\n  var qeDiv = createDiv();\r\n  compDel = decorateButton(quickDelDiv, 'Enable Quick Del');\r\n  compSum = decorateButton(sumComp, 'Count Components');\r\n  compDelAll = decorateButton(delAllDiv, 'Delete All Visible');\r\n  qe = decorateButton(qeDiv, 'Quick Extract Components');\r\n  cmDiv.appendChild(quickDelDiv);\r\n  cmDiv.appendChild(sumComp);\r\n  cmDiv.appendChild(qeDiv);\r\n  cmDiv.appendChild(delAllDiv);\r\n  compDiv.appendChild(cmDiv);\r\n  compDiv.addEventListener('click', eventHandler(evtHdl));\r\n}\r\n","import add from '../support/task';\r\nimport {createDiv} from '../common/cElement';\r\nimport equipItem from '../ajax/equipItem';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport {sendEvent} from '../support/fshGa';\r\nimport useItem from '../ajax/useItem';\r\n\r\nfunction backpackRemove(invId) { // jQuery.min\r\n  var _invId = parseInt(invId, 10);\r\n  var theBackpack = $('#backpackContainer').data('backpack');\r\n  // remove from srcData\r\n  theBackpack.srcData.some(function(el, i, ary) {\r\n    if (el.a === _invId) {\r\n      ary.splice(i, 1);\r\n      return true;\r\n    }\r\n    return false;\r\n  });\r\n}\r\n\r\nfunction getInvId(self) {\r\n  return self.parentNode.parentNode.firstElementChild.dataset.inv;\r\n}\r\n\r\nfunction fastAction(evt, action, result) { // jQuery.min\r\n  sendEvent('profile', 'fastAction');\r\n  var self = evt.target;\r\n  var invId = getInvId(self);\r\n  self.textContent = '';\r\n  self.className = 'fastAction fshSpinner fshSpinner12';\r\n  action(invId).done(function(data) {\r\n    if (data.r !== 0) {\r\n      self.remove();\r\n      return;\r\n    }\r\n    backpackRemove(invId);\r\n    self.classList.remove('fshSpinner');\r\n    self.parentNode.innerHTML = '<span class=\"fastWorn\">' + result + '</span>';\r\n  });\r\n}\r\n\r\nfunction fastWearUse(evt) {\r\n  fastAction(evt, useItem, 'Used');\r\n}\r\n\r\nfunction fastWearEquip(evt) {\r\n  fastAction(evt, equipItem, 'Worn');\r\n}\r\n\r\nfunction actionClass(usable) {\r\n  if (usable) {return 'fastUse';}\r\n  return 'fastWear';\r\n}\r\n\r\nfunction actionText(usable) {\r\n  if (usable) {return 'Use';}\r\n  return 'Wear';\r\n}\r\n\r\nfunction drawButtons(theSpan) {\r\n  var toUse = theSpan.classList.contains('backpackContextMenuUsable');\r\n  var myDiv = createDiv({\r\n    className: 'fastDiv',\r\n    innerHTML: '<span class=\"sendLink fastAction ' + actionClass(toUse) + '\">' +\r\n      actionText(toUse) + '</span>'\r\n  });\r\n  if (theSpan.parentNode.nextElementSibling) {\r\n    myDiv.appendChild(theSpan.parentNode.nextElementSibling.nextElementSibling);\r\n  }\r\n  theSpan.parentNode.parentNode.appendChild(myDiv);\r\n}\r\n\r\nfunction fastWearLinks() {\r\n  var bpTabs = getElementById('backpack_tabs');\r\n  var type = bpTabs.getElementsByClassName('tab-selected')[0].dataset.type;\r\n  var items = document.querySelectorAll('#backpackTab_' + type +\r\n    ' .backpackContextMenuEquippable,.backpackContextMenuUsable');\r\n  if (items.length === 0) {return;}\r\n  Array.prototype.forEach.call(items, drawButtons);\r\n}\r\n\r\nfunction foundBackpack(backpackContainer, theBackpack) {\r\n  var oldShow = theBackpack._showPage;\r\n  theBackpack._showPage = function(type, page) {\r\n    oldShow.call(theBackpack, type, page);\r\n    fastWearLinks();\r\n  };\r\n  if (getElementById('backpack_current').textContent.length !== 0) {\r\n    add(3, fastWearLinks);\r\n  }\r\n  backpackContainer.addEventListener('click', function(e) {\r\n    if (e.target.classList.contains('fastWear')) {fastWearEquip(e);}\r\n    if (e.target.classList.contains('fastUse')) {fastWearUse(e);}\r\n  });\r\n}\r\n\r\nexport default function injectFastWear() { // jQuery\r\n  if (!getValue('enableQuickDrink')) {return;}\r\n  var bpBack = getElementById('backpack');\r\n  bpBack.className = 'fshBackpack';\r\n  bpBack.removeAttribute('style');\r\n  var backpackContainer = getElementById('backpackContainer');\r\n  var theBackpack = $(backpackContainer).data('backpack');\r\n  if (theBackpack) {foundBackpack(backpackContainer, theBackpack);}\r\n}\r\n","import callApp from '../callApp';\r\n\r\nexport default function unequipitem(item) {\r\n  return callApp({\r\n    cmd: 'profile',\r\n    subcmd: 'unequipitem',\r\n    inventory_id: item\r\n  });\r\n}\r\n","import getValue from '../system/getValue';\r\nimport {imageServer} from '../system/system';\r\n\r\nvar guildId;\r\nvar currentGuildRelationship;\r\nvar guildMessages = {\r\n  self: {color: 'fshGreen', message: getValue('guildSelfMessage')},\r\n  friendly: {color: 'fshOliveDrab', message: getValue('guildFrndMessage')},\r\n  old: {color: 'fshDarkCyan', message: getValue('guildPastMessage')},\r\n  enemy: {color: 'fshRed', message: getValue('guildEnmyMessage')}\r\n};\r\n\r\nexport function showRecallButton(playername) {\r\n  if (currentGuildRelationship === 'self') {\r\n    return '<a class=\"quickButton tip-static\" ' +\r\n      'href=\"index.php?cmd=guild&subcmd=inventory&subcmd2=report&user=' +\r\n      playername + '\" data-tipped=\"Recall items from ' + playername +\r\n      '\" style=\"background-image: url(\\'' + imageServer +\r\n      '/temple/3.gif\\');\"></a>&nbsp;&nbsp;';\r\n  }\r\n  return '';\r\n}\r\n\r\nexport function showRankButton(playerid, playername) {\r\n  if (currentGuildRelationship === 'self' && getValue('showAdmin')) {\r\n    return '<a class=\"quickButton buttonGuildRank tip-static\" href=\"' +\r\n      'index.php?cmd=guild&subcmd=members&subcmd2=changerank&member_id=' +\r\n      playerid + '\" data-tipped=\"Rank ' + playername +\r\n      '\" style=\"background-image: url(\\'' + imageServer +\r\n      '/guilds/' + guildId + '_mini.jpg\\');\"></a>&nbsp;&nbsp;';\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction guildAry(val) {\r\n  if (val) {\r\n    return val.toLowerCase().replace(/\\s\\s*/g, ' ').split(/\\s*,\\s*/);\r\n  }\r\n  return [];\r\n}\r\n\r\nfunction guildRelationship(_txt) {\r\n  var scenario = [\r\n    {test: guildAry(getValue('guildSelf')), type: 'self'},\r\n    {test: guildAry(getValue('guildFrnd')), type: 'friendly'},\r\n    {test: guildAry(getValue('guildPast')), type: 'old'},\r\n    {test: guildAry(getValue('guildEnmy')), type: 'enemy'}\r\n  ];\r\n  var txt = _txt.toLowerCase().replace(/\\s\\s*/g, ' ');\r\n  for (var i = 0; i < scenario.length; i += 1) {\r\n    if (scenario[i].test.indexOf(txt) !== -1) {return scenario[i].type;}\r\n  }\r\n}\r\n\r\nfunction foundGuildLink(aLink) {\r\n  var guildIdResult = /guild_id=([0-9]+)/i.exec(aLink.href);\r\n  if (guildIdResult) {guildId = parseInt(guildIdResult[1], 10);}\r\n  currentGuildRelationship = guildRelationship(aLink.text);\r\n  if (currentGuildRelationship) {\r\n    aLink.parentNode.classList.add(\r\n      guildMessages[currentGuildRelationship].color);\r\n    aLink.parentNode.insertAdjacentHTML('beforeend', '<br>' +\r\n      guildMessages[currentGuildRelationship].message);\r\n  }\r\n}\r\n\r\nexport function profileInjectGuildRel() {\r\n  var aLink = document.querySelector(\r\n    '#pCC a[href^=\"index.php?cmd=guild&subcmd=view&guild_id=\"]');\r\n  if (aLink) {foundGuildLink(aLink);}\r\n}\r\n","import getValue from '../system/getValue';\r\nimport {imageServer} from '../system/system';\r\nimport {quickBuffHref} from '../support/layout';\r\nimport {showRankButton, showRecallButton} from './profileInjectGuildRel';\r\n\r\nexport default function profileInjectQuickButton(avyImg, playerid, playername) {\r\n  var newhtml = '<div align=\"center\">';\r\n  newhtml += '<a class=\"quickButton buttonQuickBuff tip-static\" ' +\r\n    quickBuffHref(playerid) + 'data-tipped=\"Buff ' + playername +\r\n    '\" style=\"background-image: url(\\'' + imageServer +\r\n    '/skin/realm/icon_action_quickbuff.gif\\');\"></a>&nbsp;&nbsp;';\r\n  if (!getValue('enableMaxGroupSizeToJoin')) {\r\n    newhtml += '<a class=\"quickButton buttonJoinAll tip-static\" ' +\r\n      'href=\"index.php?cmd=guild&subcmd=groups&subcmd2=joinall\" ' +\r\n      'data-tipped=\"Join All Groups\" style=\"background-image: url(\\'' +\r\n      imageServer +\r\n      '/skin/icon_action_join.gif\\');\"></a>&nbsp;&nbsp;';\r\n  } else {\r\n    var maxGroupSizeToJoin = getValue('maxGroupSizeToJoin');\r\n    newhtml += '<a class=\"quickButton buttonJoinUnder tip-static\" ' +\r\n      'href=\"index.php?cmd=guild&subcmd=groups&subcmd2=' +\r\n      'joinallgroupsundersize\" data-tipped=\"Join All Groups < ' +\r\n      maxGroupSizeToJoin + ' Members\" style=\"background-image: url(\\'' +\r\n      imageServer +\r\n      '/skin/icon_action_join.gif\\');\"></a>&nbsp;&nbsp;';\r\n  }\r\n  newhtml += '<a class=\"quickButton tip-static\" ' +\r\n    'href=\"index.php?cmd=auctionhouse&type=-3&tid=' + playerid +\r\n    '\" data-tipped=\"Go to ' + playername +\r\n    '\\'s auctions\" style=\"background-image: url(\\'' +\r\n    imageServer + '/skin/gold_button.gif\\');\"></a>&nbsp;&nbsp;';\r\n  newhtml += '<a class=\"quickButton tip-static\" ' +\r\n    'href=\"index.php?cmd=trade&subcmd=createsecure&target_username=' +\r\n    playername + '\" data-tipped=\"Create Secure Trade to ' + playername +\r\n    '\" style=\"background-image: url(\\'' + imageServer +\r\n    '/temple/2.gif\\');\"></a>&nbsp;&nbsp;';\r\n  newhtml += showRecallButton(playername);\r\n  newhtml += showRankButton(playerid, playername);\r\n  newhtml += '</div>';\r\n  avyImg.insertAdjacentHTML('afterend', newhtml);\r\n}\r\n","import getValue from '../system/getValue';\r\n\r\nfunction totalAllyEnemy(target, numberOfContacts, contactsTotal) {\r\n  var _c = '';\r\n  if (contactsTotal && contactsTotal >= numberOfContacts) {\r\n    _c = '/' + contactsTotal;\r\n  }\r\n  target.insertAdjacentHTML('beforeend', '<span class=\"fshBlue\">&nbsp;' +\r\n    numberOfContacts + _c + '</span>');\r\n}\r\n\r\nfunction countContacts(el, isAllies) {\r\n  var target = el.parentNode;\r\n  var numberOfContacts = target.nextSibling.nextSibling\r\n    .getElementsByTagName('table').length - 1;\r\n  if (isAllies) {\r\n    totalAllyEnemy(target, numberOfContacts, getValue('alliestotal'));\r\n  } else {\r\n    totalAllyEnemy(target, numberOfContacts, getValue('enemiestotal'));\r\n  }\r\n}\r\n\r\nfunction findAllyEnemy(el) {\r\n  var isAllies = el.textContent === 'Allies';\r\n  var isEnemies = el.textContent === 'Enemies';\r\n  if (isAllies || isEnemies) {\r\n    countContacts(el, isAllies);\r\n  }\r\n}\r\n\r\nexport default function profileParseAllyEnemy() {\r\n  // Allies/Enemies count/total function\r\n  Array.prototype.forEach.call(\r\n    document.querySelectorAll('#profileLeftColumn strong'), findAllyEnemy);\r\n}\r\n","import bioEvtHdl from './bioEvtHdl';\r\nimport {getElementById} from '../../common/getElement';\r\nimport getValue from '../../system/getValue';\r\nimport renderBio from './render';\r\n\r\nfunction expandBio() {\r\n  var bioExpander = getElementById('fshBioExpander');\r\n  if (bioExpander.textContent === 'More ...') {\r\n    bioExpander.textContent = 'Less ...';\r\n  } else {\r\n    bioExpander.textContent = 'More ...';\r\n  }\r\n  getElementById('fshBioHidden').classList.toggle('fshHide');\r\n}\r\n\r\nfunction foundMatchingTags(closeTagIndex, openTagIndex) {\r\n  return closeTagIndex !== -1 &&\r\n    (openTagIndex > closeTagIndex || openTagIndex === -1);\r\n}\r\n\r\nfunction doCompression(bioCell, bioContents, maxCharactersToShow) {\r\n  // find the end of next HTML tag after the max characters to show.\r\n  var breakPoint = bioContents.indexOf('<br>', maxCharactersToShow) + 4;\r\n  var lineBreak = '';\r\n  if (breakPoint === 3) {\r\n    breakPoint = bioContents.indexOf(' ', maxCharactersToShow) + 1;\r\n    if (breakPoint === 0) {return;}\r\n    lineBreak = '<br>';\r\n  }\r\n  var bioStart = bioContents.substring(0, breakPoint);\r\n  var bioEnd = bioContents.substring(breakPoint, bioContents.length);\r\n  var extraOpenHTML = '';\r\n  var extraCloseHTML = '';\r\n  var tagList = ['b', 'i', 'u', 'span'];\r\n  tagList.forEach(function(tag) {\r\n    var closeTagIndex = bioEnd.indexOf('</' + tag + '>');\r\n    var openTagIndex = bioEnd.indexOf('<' + tag + '>');\r\n    if (foundMatchingTags(closeTagIndex, openTagIndex)) {\r\n      extraOpenHTML += '<' + tag + '>';\r\n      extraCloseHTML += '</' + tag + '>';\r\n    }\r\n  });\r\n  bioCell.innerHTML = bioStart + extraCloseHTML + lineBreak +\r\n    '<span id=\"fshBioExpander\" class=\"sendLink\">More ...</span><br>' +\r\n    '<span class=\"fshHide\" id=\"fshBioHidden\">' + extraOpenHTML + bioEnd +\r\n    '</span>';\r\n  getElementById('fshBioExpander')\r\n    .addEventListener('click', expandBio);\r\n}\r\n\r\nfunction findStartPosition(bioContents, _maxRowsToShow) {\r\n  var maxRowsToShow = _maxRowsToShow;\r\n  var startIndex = 0;\r\n  while (maxRowsToShow > 0) {\r\n    maxRowsToShow -= 1;\r\n    startIndex = bioContents.indexOf('<br>\\n', startIndex + 1);\r\n  }\r\n  return startIndex;\r\n}\r\n\r\nfunction bioIsTooSmall(bio, maxChar, lines, maxRows) {\r\n  return bio.length <= maxChar && lines < maxRows;\r\n}\r\n\r\nfunction compressBio(bioCell) {\r\n  var bioContents = bioCell.innerHTML;\r\n  var maxCharactersToShow = getValue('maxCompressedCharacters');\r\n  var maxRowsToShow = getValue('maxCompressedLines');\r\n  var numberOfLines = bioContents.substr(0, maxCharactersToShow)\r\n    .split(/<br>\\n/).length - 1;\r\n  if (bioIsTooSmall(bioContents, maxCharactersToShow, numberOfLines,\r\n    maxRowsToShow)) {return;}\r\n  if (numberOfLines >= maxRowsToShow) {\r\n    maxCharactersToShow = findStartPosition(bioContents, maxRowsToShow);\r\n  }\r\n  doCompression(bioCell, bioContents, maxCharactersToShow);\r\n}\r\n\r\nfunction doRender(bioCell) {\r\n  var bioContents = bioCell.innerHTML;\r\n  bioContents = renderBio(bioContents);\r\n  if (bioContents) {\r\n    bioCell.innerHTML = bioContents;\r\n  }\r\n}\r\n\r\nfunction selfRender(self) {\r\n  return self && getValue('renderSelfBio');\r\n}\r\n\r\nfunction otherRender(self) {\r\n  return !self && getValue('renderOtherBios');\r\n}\r\n\r\nfunction shouldRender(self) {\r\n  return selfRender(self) || otherRender(self);\r\n}\r\n\r\nfunction testForRender(self, bioCell) {\r\n  if (shouldRender(self)) {\r\n    doRender(bioCell);\r\n  }\r\n}\r\n\r\nexport default function profileRenderBio(self) {\r\n  var bioCell = getElementById('profile-bio');\r\n  if (!bioCell) {return;}\r\n  testForRender(self, bioCell);\r\n  if (getValue('enableBioCompressor')) {compressBio(bioCell);}\r\n  bioCell.addEventListener('click', bioEvtHdl);\r\n}\r\n","import {createSpan} from '../common/cElement';\r\nimport {getElementById} from '../common/getElement';\r\n\r\nfunction profileSelectAll() {\r\n  var bpTabs = getElementById('backpack_tabs');\r\n  var type = bpTabs.getElementsByClassName('tab-selected')[0]\r\n    .getAttribute('data-type');\r\n  var items = document.querySelectorAll('#backpackTab_' + type +\r\n    ' li:not(.hcsPaginate_hidden) .backpackItem');\r\n  if (items.length === 0) {return;}\r\n  var checkboxes = document.querySelectorAll('#backpackTab_' + type +\r\n    ' li:not(.hcsPaginate_hidden) .backpackCheckbox:not(:disabled)');\r\n  if (checkboxes.length > 0) {items = checkboxes;}\r\n  Array.prototype.forEach.call(items, function(el) {el.click();});\r\n}\r\n\r\nexport default function selectAllLink() {\r\n  // select all link\r\n  var node = document.querySelector('#profileRightColumn' +\r\n    ' a[href=\"index.php?cmd=profile&subcmd=dropitems\"]');\r\n  if (!node) {return;}\r\n  var allSpan = createSpan({className: 'smallLink', textContent: 'All'});\r\n  allSpan.addEventListener('click', profileSelectAll);\r\n  var wrapper = createSpan({innerHTML: '[&nbsp;'});\r\n  wrapper.appendChild(allSpan);\r\n  wrapper.insertAdjacentHTML('beforeend', '&nbsp;]&nbsp;');\r\n  node.parentNode.appendChild(wrapper);\r\n}\r\n","import {getElementById} from '../common/getElement';\r\n\r\nfunction removeStatTable(el) {\r\n  var tde = el.getElementsByTagName('td');\r\n  el.parentNode.innerHTML = tde[0].innerHTML.replace(/&nbsp;/g, ' ') +\r\n    '<div class=\"profile-stat-bonus\">' + tde[1].textContent + '</div>';\r\n}\r\n\r\nexport default function updateStatistics() {\r\n  var charStats = getElementById('profileLeftColumn')\r\n    .getElementsByTagName('table')[0];\r\n  var dodgyTables = charStats.getElementsByTagName('table');\r\n  Array.prototype.forEach.call(dodgyTables, removeStatTable);\r\n}\r\n","import add from '../support/task';\r\nimport addStatTotalToMouseover from '../common/addStatTotalToMouseover';\r\nimport ajaxifyProfileSections from './ajaxifyProfileSections';\r\nimport {colouredDots} from '../common/colouredDots';\r\nimport fallback from '../system/fallback';\r\nimport fastDebuff from './debuff';\r\nimport getUrlParameter from '../system/getUrlParameter';\r\nimport highlightPvpProtection from './highlightPvpProtection';\r\nimport injectFastWear from './fastWear';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport nekidBtn from './nekidBtn';\r\nimport profileComponents from './components';\r\nimport {profileInjectGuildRel} from './profileInjectGuildRel';\r\nimport profileInjectQuickButton from './profileInjectQuickButton';\r\nimport profileParseAllyEnemy from './profileAllyEnemy';\r\nimport profileRenderBio from './bio/bio';\r\nimport quickWearLink from './quickWearLink';\r\nimport selectAllLink from './selectAllLink';\r\nimport storeVL from './storeVL';\r\nimport updateHCSQuickBuffLinks from '../common/updateHCSQuickBuffLinks';\r\nimport updateNmv from './updateNmv';\r\nimport updateStatistics from './updateStatistics';\r\nimport {\r\n  pCC,\r\n  playerId,\r\n  playerName\r\n} from '../support/layout';\r\n\r\nfunction ifSelf(self) {\r\n  if (self) {\r\n    // self inventory\r\n    fastDebuff();\r\n    profileParseAllyEnemy();\r\n    injectFastWear();\r\n    profileComponents();\r\n    quickWearLink();\r\n    selectAllLink();\r\n    storeVL();\r\n    nekidBtn();\r\n    ajaxifyProfileSections();\r\n  }\r\n}\r\n\r\nfunction yuuzhan(playername, avyImg) {\r\n  if (playername === 'yuuzhan') {\r\n    avyImg.src = 'http://evolutions.yvong.com/images/tumbler.gif';\r\n    avyImg.addEventListener('click', function() {\r\n      $('#dialog_msg').text('Winner!').dialog('open');\r\n    });\r\n  }\r\n}\r\n\r\nexport default function injectProfile() { // Legacy\r\n  if (jQueryNotPresent()) {return;}\r\n  var avyImg = document\r\n    .querySelector('#profileLeftColumn img[oldtitle*=\"\\'s Avatar\"]');\r\n  if (!avyImg) {return;}\r\n  var playername = pCC.getElementsByTagName('h1')[0].textContent;\r\n  var self = playername === playerName();\r\n  ifSelf(self);\r\n  // Must be before profileInjectQuickButton\r\n  profileInjectGuildRel();\r\n  // It sets up guildId and currentGuildRelationship\r\n  var playerid = fallback(getUrlParameter('player_id'), playerId());\r\n  profileInjectQuickButton(avyImg, playerid, playername);\r\n\r\n  //* ************* yuuzhan having fun\r\n  yuuzhan(playername, avyImg);\r\n  //* *************\r\n\r\n  updateHCSQuickBuffLinks('#profileRightColumn a[href*=\"quickbuff\"]');\r\n  updateNmv();\r\n  updateStatistics();\r\n  //#if _DEV  //  highlightPvpProtection\r\n  highlightPvpProtection();\r\n  //#endif\r\n  profileRenderBio(self);\r\n  addStatTotalToMouseover();\r\n  add(3, colouredDots);\r\n}\r\n","import {getElementById} from '../common/getElement';\r\nimport intValue from '../system/intValue';\r\nimport setValue from '../system/setValue';\r\n\r\nexport default function storeVL() {\r\n  // store the VL of the player\r\n  var virtualLevel = parseInt(getElementById('stat-vl').textContent, 10);\r\n  if (intValue(document.getElementsByClassName('stat-level')[0]\r\n    .nextElementSibling.textContent) === virtualLevel) {\r\n    setValue('characterVirtualLevel', ''); // ?\r\n  } else {\r\n    setValue('characterVirtualLevel', virtualLevel);\r\n  }\r\n}\r\n","import {createSpan} from '../common/cElement';\r\nimport insertQuickWear from '../quickWear/quickWear';\r\nimport insertTextBeforeEnd from '../common/insertTextBeforeEnd';\r\nimport jQueryDialog from '../chrome/jQueryDialog';\r\nimport {sendEvent} from '../support/fshGa';\r\n\r\nexport default function quickWearLink() {\r\n  // quick wear manager link\r\n  var node = document.querySelector('#profileRightColumn ' +\r\n    'a[href=\"index.php?cmd=profile&subcmd=togglesection&section_id=2\"]');\r\n  if (!node) {return;}\r\n  var wrap = createSpan({innerHTML: '&nbsp;['});\r\n  var qw = createSpan({className: 'sendLink', innerHTML: 'Quick&nbsp;Wear'});\r\n  wrap.appendChild(qw);\r\n  insertTextBeforeEnd(wrap, ']');\r\n  node.parentNode.appendChild(wrap);\r\n  qw.addEventListener('click', function() {\r\n    sendEvent('profile', 'insertQuickWear');\r\n    jQueryDialog(insertQuickWear);\r\n  });\r\n}\r\n","import {getElementById} from '../common/getElement';\r\n\r\nexport default function updateNmv() {\r\n  var nmvImg = document.querySelector(\r\n    '#profileRightColumn img[src$=\"/60_sm.gif\"]');\r\n  if (!nmvImg) {return;}\r\n  var atkStat = Number(\r\n    getElementById('stat-attack').firstChild.textContent.trim());\r\n  if (isNaN(atkStat)) {return;}\r\n  var defStat = Number(\r\n    getElementById('stat-defense').firstChild.textContent.trim());\r\n  var oldTipped = nmvImg.dataset.tipped;\r\n  var lvlAry = /\\(Level: (\\d+)\\)/.exec(oldTipped);\r\n  var nmvLvl = Number(lvlAry[1]);\r\n  var nmvEffect = Math.floor(atkStat * nmvLvl * 0.0025);\r\n  nmvImg.dataset.tipped = oldTipped.slice(0, -15) +\r\n    '<br>Attack: ' + (atkStat - nmvEffect).toString() +\r\n    '&nbsp;&nbsp;Defense: ' + (defStat + nmvEffect).toString() +\r\n    '</center></div>';\r\n}\r\n","import createDocument from './system/createDocument';\r\nimport {createSpan} from './common/cElement';\r\nimport fallback from './system/fallback';\r\nimport formatLastActivity from './system/formatLastActivity';\r\nimport {getElementById} from './common/getElement';\r\nimport getProfile from './ajax/getProfile';\r\nimport insertElementAfter from './common/insertElementAfter';\r\nimport jQueryNotPresent from './common/jQueryNotPresent';\r\nimport retryAjax from './ajax/retryAjax';\r\n\r\nvar retries = 0;\r\nvar quickBuffHeader =\r\n  '<div id=\"helperQBheader\"><table class=\"quickbuffTable\"><thead><tr>' +\r\n  '<th class=\"quickbuffTableHeader\">Sustain</th>' +\r\n  '<th class=\"quickbuffTableHeader\">Fury Caster</th>' +\r\n  '<th class=\"quickbuffTableHeader\">Guild Buffer</th>' +\r\n  '<th class=\"quickbuffTableHeader\">Buff Master</th>' +\r\n  '<th class=\"quickbuffTableHeader\">Extend</th>' +\r\n  '<th class=\"quickbuffTableHeader\">Reinforce</th>' +\r\n  '</tr></thead><tbody><tr>' +\r\n  '<td id=\"fshSus\" class=\"quickbuffTableDetail\">&nbsp;</td>' +\r\n  '<td id=\"fshFur\" class=\"quickbuffTableDetail\">&nbsp;</td>' +\r\n  '<td id=\"fshGB\"  class=\"quickbuffTableDetail\">&nbsp;</td>' +\r\n  '<td id=\"fshBM\"  class=\"quickbuffTableDetail\">&nbsp;</td>' +\r\n  '<td id=\"fshExt\" class=\"quickbuffTableDetail\">&nbsp;</td>' +\r\n  '<td id=\"fshRI\"  class=\"quickbuffTableDetail\">&nbsp;</td>' +\r\n  '</tr></tbody></table></div>';\r\nvar excludeBuff = {\r\n  'skill-50': 'Death Dealer',\r\n  'skill-54': 'Counter Attack',\r\n  'skill-55': 'Summon Shield Imp',\r\n  'skill-56': 'Vision',\r\n  'skill-60': 'Nightmare Visage',\r\n  'skill-61': 'Quest Finder',\r\n  'skill-98': 'Barricade',\r\n  'skill-101': 'Severe Condition'\r\n};\r\n\r\nfunction getEnhancement(doc, enh, inject) {\r\n  var enhLevel = doc[enh] || 0;\r\n  var enhClass = 'fshLime';\r\n  if (enhLevel < 100) {enhClass = 'fshRed';}\r\n  inject.innerHTML = '<span class=\"' + enhClass + '\">' + enhLevel + '%</span>';\r\n}\r\n\r\nfunction timeUnit(value, unit) {\r\n  if (value > 0) {return value.toString() + unit;}\r\n  return '';\r\n}\r\n\r\nfunction buffTimeLeft(_s) {\r\n  var m = Math.floor(_s / 60);\r\n  var s = _s % 60;\r\n  var buffTimeToExpire = timeUnit(m, 'm');\r\n  if (m > 0 && s > 0) {buffTimeToExpire += ' ';}\r\n  buffTimeToExpire += timeUnit(s, 's');\r\n  return buffTimeToExpire;\r\n}\r\n\r\nfunction getBuff(doc, buff, inject) {\r\n  var s = fallback(doc[buff], 0);\r\n  if (s) {\r\n    var buffTimeToExpire = buffTimeLeft(s);\r\n    inject.innerHTML = '<span class=\"fshLime\">On</span>&nbsp;<span ' +\r\n      'class=\"fshBuffOn\">(' + buffTimeToExpire + ')</span>';\r\n  } else {\r\n    var elem = getElementById('buff-outer')\r\n      .querySelector('input[data-name=\"' + buff + '\"]');\r\n    if (elem) {\r\n      inject.innerHTML = '<span class=\"quickbuffActivate\" ' +\r\n        'buffID=\"' + elem.getAttribute('value') + '\">Activate</span>';\r\n    } else {\r\n      inject.innerHTML = '<span class=\"fshRed;\">Off</span>';\r\n    }\r\n  }\r\n}\r\n\r\nfunction itWorked(result) {\r\n  return result &&\r\n    (result.textContent.indexOf(\r\n      'current or higher level is currently active on') !== -1 ||\r\n    result.textContent.indexOf('was activated on') !== -1);\r\n}\r\n\r\nfunction quickActivate(evt) { // jQuery\r\n  var trigger = evt.target;\r\n  if (trigger.className !== 'quickbuffActivate') {return;}\r\n  var buffHref = '?cmd=quickbuff&subcmd=activate&targetPlayers=' +\r\n    window.self + '&skills[]=' + trigger.getAttribute('buffID');\r\n  retryAjax(buffHref).done(function(data) {\r\n    var doc = createDocument(data);\r\n    var result = doc.querySelector('#quickbuff-report font');\r\n    if (itWorked(result)) {\r\n      trigger.className = 'fshLime';\r\n      trigger.innerHTML = 'On';\r\n    }\r\n  });\r\n}\r\n\r\nfunction addStatsQuickBuff(data) {\r\n  var myPlayer = document.querySelector('div.player[data-username=\"' +\r\n    data.username + '\"]');\r\n  var activity = myPlayer.querySelector('span.fshLastActivity');\r\n  if (!activity) {\r\n    activity = createSpan({className: 'fshLastActivity'});\r\n    var player = myPlayer.getElementsByTagName('h1')[0];\r\n    insertElementAfter(activity, player);\r\n  }\r\n  activity.innerHTML = 'Last Activity: ' +\r\n    formatLastActivity(data.last_login) +\r\n    '<br>Stamina: ' + data.current_stamina + ' / ' +\r\n    data.stamina + ' ( ' + Math.floor(data.current_stamina /\r\n    data.stamina * 100) + '% )';\r\n}\r\n\r\nfunction newPlayerSpan(el, playerSpan) {\r\n  if (!playerSpan) {\r\n    var ret = createSpan({className: 'fshPlayer'});\r\n    insertElementAfter(ret, el.nextElementSibling);\r\n    return ret;\r\n  }\r\n  return playerSpan;\r\n}\r\n\r\nfunction getBuffColor(myLvl, playerBuffLevel) {\r\n  if (myLvl > playerBuffLevel) {return 'fshRed';}\r\n  return 'fshGreen';\r\n}\r\n\r\nfunction buffRunning(el, playerBuffLevel, playerSpan) {\r\n  if (!playerBuffLevel) {\r\n    playerSpan.innerHTML = '';\r\n    return;\r\n  }\r\n  var lvlSpan = el.nextElementSibling.firstElementChild.firstElementChild;\r\n  var myLvl = parseInt(lvlSpan.textContent.replace(/\\[|\\]/g, ''), 10);\r\n  var fshPlayerSpan = newPlayerSpan(el, playerSpan);\r\n  var buffColor = getBuffColor(myLvl, playerBuffLevel);\r\n  fshPlayerSpan.innerHTML = ' <span class=\"' + buffColor +\r\n    '\">[' + playerBuffLevel + ']</span>';\r\n}\r\n\r\nfunction hazBuff(playerData, el) {\r\n  var myBuffName = el.getAttribute('data-name');\r\n  var playerBuffLevel = playerData[myBuffName];\r\n  var playerSpan = el.nextElementSibling.nextElementSibling;\r\n  if (playerBuffLevel || playerSpan) {\r\n    buffRunning(el, playerBuffLevel, playerSpan);\r\n  }\r\n}\r\n\r\nfunction addBuffLevels(evt) {\r\n  var player = evt.target;\r\n  if (player.tagName !== 'H1') {return;}\r\n  getProfile(player.textContent).done(addStatsQuickBuff);\r\n\r\n  var playerData = player.parentNode.lastElementChild.textContent.split(',');\r\n  playerData = playerData.reduce(function(prev, curr) {\r\n    if (curr.indexOf(' [') !== -1) {\r\n      var foo = curr.split(' [');\r\n      prev[foo[0].trim()] = parseInt(foo[1].replace(']', ''), 10);\r\n    }\r\n    return prev;\r\n  }, {});\r\n\r\n  var buffOuter = getElementById('buff-outer');\r\n  var nodeList = buffOuter.querySelectorAll('input[name]');\r\n\r\n  Array.prototype.forEach.call(nodeList, hazBuff.bind(null, playerData));\r\n\r\n}\r\n\r\nfunction doLabels(el) {\r\n  var nameSpan = el.firstElementChild;\r\n  var dataTipped = nameSpan.dataset.tipped;\r\n  var cost = el.previousElementSibling.getAttribute('data-cost');\r\n  nameSpan.dataset.tipped = dataTipped\r\n    .replace('</center>', '<br>Stamina Cost: ' + cost + '$&');\r\n  var lvlSpan = nameSpan.firstElementChild;\r\n  var myLvl = parseInt(lvlSpan.textContent.replace(/\\[|\\]/g, ''), 10);\r\n  if (!excludeBuff[el.getAttribute('for')] && myLvl < 125) {\r\n    el.classList.add('fshDim');\r\n  }\r\n}\r\n\r\nfunction waitForPlayer(firstPlayer) {\r\n  return !firstPlayer && retries < 9;\r\n}\r\n\r\nfunction haveTargets() {\r\n  var firstPlayer = getElementById('players')\r\n    .getElementsByTagName('h1')[0];\r\n  if (waitForPlayer(firstPlayer)) {\r\n    retries += 1;\r\n    setTimeout(haveTargets, 100);\r\n    return;\r\n  }\r\n  if (!firstPlayer) {return;}\r\n  firstPlayer.click();\r\n}\r\n\r\nfunction firstPlayerStats() {\r\n  var targets = getElementById('targetPlayers')\r\n    .getAttribute('value');\r\n  if (targets && targets !== '') {haveTargets();}\r\n}\r\n\r\nfunction getSustain(responseText) {\r\n  var enh = responseText._enhancements.reduce(function(prev, curr) {\r\n    prev[curr.name] = curr.value;\r\n    return prev;\r\n  }, {});\r\n  var skl = responseText._skills.reduce(function(prev, curr) {\r\n    prev[curr.name] = curr.duration;\r\n    return prev;\r\n  }, {});\r\n  getEnhancement(enh, 'Sustain', getElementById('fshSus'));\r\n  getEnhancement(enh, 'Fury Caster', getElementById('fshFur'));\r\n  getBuff(skl, 'Guild Buffer', getElementById('fshGB'));\r\n  getBuff(skl, 'Buff Master', getElementById('fshBM'));\r\n  getBuff(skl, 'Extend', getElementById('fshExt'));\r\n  getBuff(skl, 'Reinforce', getElementById('fshRI'));\r\n\r\n  getElementById('helperQBheader')\r\n    .addEventListener('click', quickActivate);\r\n  getElementById('players')\r\n    .addEventListener('click', addBuffLevels);\r\n\r\n  var labels = getElementById('buff-outer')\r\n    .querySelectorAll('label[for^=\"skill-\"]');\r\n  Array.prototype.forEach.call(labels, doLabels);\r\n\r\n  firstPlayerStats();\r\n\r\n}\r\n\r\nexport default function injectQuickBuff() { // jQuery\r\n  if (jQueryNotPresent()) {return;}\r\n  var quickbuffDiv = getElementById('quickbuff');\r\n  if (!quickbuffDiv) {return;}\r\n  quickbuffDiv.firstElementChild.insertAdjacentHTML('afterend',\r\n    quickBuffHeader);\r\n  getProfile(window.self).done(getSustain);\r\n}\r\n","export default function reduceBuffArray(buffAry) {\r\n  return buffAry.reduce(function(prev, curr) {\r\n    prev[curr.name] = Number(curr.level);\r\n    return prev;\r\n  }, {});\r\n}\r\n","import jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport myStats from '../ajax/myStats';\r\nimport {pCC} from '../support/layout';\r\nimport reduceBuffArray from '../common/reduceBuffArray';\r\n\r\nvar packRE = />([ a-zA-Z]+) Level (\\d+)/g;\r\n\r\nfunction postWarnings(myBuffs) {\r\n  var nodeList = pCC.firstElementChild.rows[9]\r\n    .cells[0].firstElementChild.getElementsByTagName('A');\r\n  Array.prototype.forEach.call(nodeList, function(el) {\r\n    var tipped = el.dataset.tipped;\r\n    var packBuffs;\r\n    while ((packBuffs = packRE.exec(tipped)) !== null) {\r\n      if (myBuffs[packBuffs[1]] === Number(packBuffs[2])) {\r\n        el.parentNode.insertAdjacentHTML('beforeend',\r\n          '<br><span class=\"fshRed fshNoWrap\">' + packBuffs[1] + ' ' +\r\n          packBuffs[2] + ' active</span>');\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\nfunction parseProfile(data) {\r\n  if (data._skills.length !== 0) {\r\n    var myBuffs = reduceBuffArray(data._skills);\r\n    postWarnings(myBuffs);\r\n  }\r\n}\r\n\r\nexport default function injectRPUpgrades() { // jQuery.min\r\n  if (jQueryNotPresent()) {return;}\r\n  myStats().done(parseProfile);\r\n}\r\n","import equipItem from '../ajax/equipItem';\r\nimport {imageServer} from '../system/system';\r\nimport {queueRecallItem} from '../ajaxQueue/queue';\r\n\r\nvar spinner = '<span class=\"guildReportSpinner\" style=\"background-image: ' +\r\n  'url(\\'' + imageServer + '/skin/loading.gif\\');\"></span>';\r\n\r\nfunction recallItem(evt) { // jQuery\r\n  $(evt.target).qtip('hide');\r\n  var mode = evt.target.getAttribute('mode');\r\n  var theTd = evt.target.parentNode.parentNode;\r\n  if (mode === '0') {theTd = theTd.parentNode;}\r\n  var href = theTd.firstElementChild.href;\r\n  queueRecallItem({\r\n    invId: href.match(/&id=(\\d+)/)[1],\r\n    playerId: href.match(/&player_id=(\\d+)/)[1],\r\n    mode: mode,\r\n    action: evt.target.getAttribute('action')\r\n  })\r\n    .done(function(data) {\r\n      if (data.r === 1) {return;}\r\n      theTd.innerHTML = '<span class=\"fastWorn\">' +\r\n        'You successfully recalled the item</span>';\r\n    });\r\n  theTd.innerHTML = spinner;\r\n}\r\n\r\nfunction wearItem(evt) { // jQuery\r\n  $(evt.target).qtip('hide');\r\n  var theTd = evt.target.parentNode.parentNode.parentNode;\r\n  var href = theTd.firstElementChild.href;\r\n  equipItem(href.match(/&id=(\\d+)/)[1]).done(function(data) {\r\n    if (data.r === 1) {return;}\r\n    theTd.innerHTML = '<span class=\"fastWorn\">Worn</span>';\r\n  });\r\n  theTd.innerHTML = spinner;\r\n}\r\n\r\nvar events = [\r\n  {test: 'recall', fn: recallItem},\r\n  {test: 'equip', fn: wearItem},\r\n  {\r\n    test: 'a-reply',\r\n    fn: function(evt) {\r\n      window.openQuickMsgDialog(evt.target.getAttribute('target_player'));\r\n    }\r\n  }\r\n];\r\n\r\nexport default function eventHandlers(evt) {\r\n  for (var i = 0; i < events.length; i += 1) {\r\n    if (evt.target.classList.contains(events[i].test)) {\r\n      events[i].fn(evt);\r\n      return;\r\n    }\r\n  }\r\n}\r\n","import alpha from '../common/alpha';\r\nimport {createDiv} from '../common/cElement';\r\nimport eventHandler from '../common/eventHandler';\r\nimport extend from '../common/extend';\r\nimport fallback from '../system/fallback';\r\nimport getForage from '../ajax/getForage';\r\nimport isChecked from '../system/isChecked';\r\nimport isSelected from '../system/isSelected';\r\nimport {pCC} from '../support/layout';\r\nimport setForage from '../ajax/setForage';\r\nimport testRange from '../system/testRange';\r\n\r\nvar storeMap = 'fsh_potMap';\r\nvar defaultOpts = {\r\n  pottab1: false,\r\n  pottab2: false,\r\n  pottab3: false,\r\n  myMap: {},\r\n  minpoint: 12,\r\n  maxpoint: 20\r\n};\r\nvar potObj;\r\nvar potOpts;\r\nvar inventory;\r\nvar mapping;\r\nvar thresholds;\r\n\r\nfunction createContainer() {\r\n  return createDiv({\r\n    id: 'potReport',\r\n    innerHTML: '<input id=\"pottab1\" type=\"checkbox\" name=\"pottabs\"' +\r\n      isChecked(potOpts.pottab1) + '>' +\r\n      '<label for=\"pottab1\">Composed Potion Inventory</label>' +\r\n      '<input id=\"pottab2\" type=\"checkbox\" name=\"pottabs\"' +\r\n      isChecked(potOpts.pottab2) + '>' +\r\n      '<label for=\"pottab2\">Mapping</label>' +\r\n      '<input id=\"pottab3\" type=\"checkbox\" name=\"pottabs\"' +\r\n      isChecked(potOpts.pottab3) + '>' +\r\n      '<label for=\"pottab3\">Thresholds</label>'\r\n  });\r\n}\r\n\r\nfunction createThresholds() {\r\n  return createDiv({\r\n    id: 'thresholds',\r\n    innerHTML: 'Min:' +\r\n      '<input id=\"minpoint\" type=\"number\" value=\"' +\r\n      potOpts.minpoint + '\" min=\"0\" max=\"999\">' +\r\n      'Max:' +\r\n      '<input id=\"maxpoint\" type=\"number\" value=\"' +\r\n      potOpts.maxpoint + '\" min=\"0\" max=\"999\">',\r\n  });\r\n}\r\n\r\nfunction sortKeys(obj) {\r\n  return Object.keys(obj).sort(alpha).reduce(function(result, key) {\r\n    result[key] = obj[key];\r\n    return result;\r\n  }, {});\r\n}\r\n\r\nfunction resetMap() {\r\n  potOpts.myMap = Object.keys(potObj).reduce(function(prev, pot) {\r\n    prev[pot] = pot;\r\n    return prev;\r\n  }, {});\r\n}\r\n\r\nfunction buildMap() {\r\n  Object.keys(potObj).forEach(function(pot) {\r\n    if (!potOpts.myMap[pot]) {potOpts.myMap[pot] = pot;}\r\n  });\r\n  potOpts.myMap = sortKeys(potOpts.myMap);\r\n}\r\n\r\nfunction buildOptions(select) {\r\n  return '<select name=\"' + select +\r\n    '\"><option value=\"Ignore\">Ignore</option>' +\r\n    Object.keys(potOpts.myMap).reduce(function(prev, pot) {\r\n      return prev + '<option value=\"' + pot + '\"' +\r\n        isSelected(pot, potOpts.myMap[select]) + '>' + pot + '</option>';\r\n    }, '') + '</select>';\r\n}\r\n\r\nfunction drawMapping() {\r\n  mapping.innerHTML = '<table><tbody>' +\r\n    Object.keys(potOpts.myMap).reduce(function(prev, pot) {\r\n      var options = buildOptions(pot);\r\n      return prev + '<tr height=\"19px\"><td>' + pot + '</td><td>' + options +\r\n        '</td></tr>';\r\n    }, '') + '<tr><td></td><td class=\"fshCenter\">' +\r\n    '<input id=\"fshReset\" value=\"Reset\" type=\"button\">' +\r\n    '</td></tr></tbody></table>';\r\n}\r\n\r\nfunction perc2color(percent) {\r\n  var perc = Math.max(Math.min(percent, 100), 0);\r\n  var r;\r\n  var g;\r\n  var b = 0;\r\n  if (perc < 50) {\r\n    r = 255;\r\n    g = Math.round(5.1 * perc);\r\n  } else {\r\n    g = 255;\r\n    r = Math.round(510 - 5.10 * perc);\r\n  }\r\n  var h = r * 0x10000 + g * 0x100 + b;\r\n  return '#' + ('000000' + h.toString(16)).slice(-6);\r\n}\r\n\r\nfunction pivotPotObj(prev, pot) {\r\n  if (potOpts.myMap[pot] !== 'Ignore') {\r\n    if (prev[potOpts.myMap[pot]]) {\r\n      prev[potOpts.myMap[pot]] += potObj[pot];\r\n    } else {\r\n      prev[potOpts.myMap[pot]] = potObj[pot];\r\n    }\r\n  }\r\n  return prev;\r\n}\r\n\r\nfunction makeRowsFromPivot(pivot, prev, pot) {\r\n  return prev + '<tr height=\"19px\"><td>' + pot +\r\n    '</td><td style=\"background-color: ' +\r\n    perc2color((pivot[pot] - potOpts.minpoint) /\r\n    (potOpts.maxpoint - potOpts.minpoint) * 100) + ';\">' +\r\n    pivot[pot].toString() + '</td></tr>';\r\n}\r\n\r\nfunction drawInventory() {\r\n  var pivot = Object.keys(potObj).reduce(pivotPotObj, {});\r\n  inventory.innerHTML = '<table><tbody>' +\r\n    Object.keys(pivot).reduce(makeRowsFromPivot.bind(null, pivot), '') +\r\n    '</tbody></table>';\r\n}\r\n\r\nfunction onChange(e) {\r\n  if (e.target.tagName === 'SELECT') {\r\n    potOpts.myMap[e.target.name] = e.target.value;\r\n    setForage(storeMap, potOpts);\r\n    drawInventory();\r\n  }\r\n}\r\n\r\nfunction doReset() {\r\n  resetMap();\r\n  setForage(storeMap, potOpts);\r\n  drawMapping();\r\n  drawInventory();\r\n}\r\n\r\nfunction saveState(self) {\r\n  var option = self.id;\r\n  potOpts[option] = self.checked;\r\n  setForage(storeMap, potOpts);\r\n}\r\n\r\nvar evtHdl = [\r\n  {\r\n    test: function(self) {return self.id === 'fshReset';},\r\n    act: doReset\r\n  },\r\n  {\r\n    test: function(self) {\r\n      return /^pottab\\d$/.test(self.id);\r\n    },\r\n    act: saveState\r\n  }\r\n];\r\n\r\nfunction onInput(e) {\r\n  var self = e.target.id;\r\n  var maybeValue = testRange(e.target.value, 0, 999);\r\n  if (maybeValue) {\r\n    potOpts[self] = maybeValue;\r\n    setForage(storeMap, potOpts);\r\n    drawInventory();\r\n  }\r\n}\r\n\r\nfunction gotMap(data) {\r\n  potOpts = extend({}, defaultOpts);\r\n  extend(potOpts, fallback(data, {}));\r\n  buildMap(potObj);\r\n  setForage(storeMap, potOpts);\r\n  var container = createContainer();\r\n  var panels = createDiv({id: 'panels'});\r\n  container.appendChild(panels);\r\n  inventory = createDiv({id: 'inventory'});\r\n  drawInventory();\r\n  panels.appendChild(inventory);\r\n  mapping = createDiv({id: 'mapping'});\r\n  drawMapping();\r\n  panels.appendChild(mapping);\r\n  thresholds = createThresholds();\r\n  panels.appendChild(thresholds);\r\n\r\n  var myCell = pCC.lastElementChild.insertRow(2).insertCell(-1);\r\n  myCell.addEventListener('change', onChange);\r\n  myCell.addEventListener('click', eventHandler(evtHdl));\r\n  myCell.addEventListener('input', onInput);\r\n  myCell.appendChild(container);\r\n}\r\n\r\nexport default function potReport(potObj_) {\r\n  potObj = sortKeys(potObj_);\r\n  getForage(storeMap).done(gotMap);\r\n}\r\n","import add from '../support/task';\r\nimport {createSpan} from '../common/cElement';\r\nimport moreToDo from '../common/moreToDo';\r\nimport potReport from './potReport';\r\n\r\nvar wearRE = new RegExp('<b>|Bottle|Brew|Draft|Elixir|Potion|Jagua Egg|' +\r\n  'Gut Rot Head Splitter|Serum');\r\nvar counter;\r\nvar nodeArray;\r\nvar nodeList;\r\nvar potObj;\r\n\r\nfunction paintChild() {\r\n  var limit = performance.now() + 1;\r\n  while (moreToDo(limit, counter, nodeArray)) {\r\n    var el = nodeList[counter];\r\n    var inject = nodeArray[counter];\r\n    el.appendChild(inject);\r\n    counter += 1;\r\n  }\r\n  if (counter < nodeArray.length) {\r\n    add(3, paintChild);\r\n  }\r\n}\r\n\r\nfunction hideElement(test) {\r\n  if (test) {return ' class=\"fshHide\"';}\r\n  return '';\r\n}\r\n\r\nfunction isEquipable(test) {\r\n  if (test) {return 'recall';}\r\n  return 'equip';\r\n}\r\n\r\nfunction addPotObj(item) {\r\n  if (item.indexOf(' (Potion)') !== -1) {\r\n    var itemName = item.replace(' (Potion)', '');\r\n    if (potObj[itemName]) {\r\n      potObj[itemName] += 1;\r\n    } else {\r\n      potObj[itemName] = 1;\r\n    }\r\n  }\r\n}\r\n\r\nfunction mySpan(el) {\r\n  var secondHref = el.children.length === 2;\r\n  var firstHref = hideElement(!secondHref);\r\n  var itemName = el.previousElementSibling.innerHTML;\r\n  addPotObj(itemName);\r\n  var wearable = hideElement(wearRE.test(itemName));\r\n  var equipable = isEquipable(secondHref);\r\n  return createSpan({\r\n    innerHTML: '<span' + firstHref +\r\n    '> | <span class=\"sendLink recall tip-static\" data-tipped=\"' +\r\n    'Click to recall to backpack\" mode=\"0\" action=\"recall\">Fast BP' +\r\n    '</span></span>' +\r\n    ' | <span class=\"sendLink recall tip-static\" ' +\r\n    'data-tipped=\"Click to recall to guild store\" mode=\"1\" ' +\r\n    'action=\"recall\">Fast GS</span>' +\r\n    '<span' + wearable +\r\n    '> | <span class=\"sendLink ' +\r\n    equipable +\r\n    '\" mode=\"0\" action=\"wear\">Fast Wear</span></span>'\r\n  });\r\n}\r\n\r\nfunction doSpan(el) {\r\n  if (counter === 0) {\r\n    el.previousSibling.setAttribute('width', '200px');\r\n    el.setAttribute('width', '370px');\r\n  } else {\r\n    el.previousSibling.removeAttribute('width');\r\n    el.removeAttribute('width');\r\n  }\r\n  nodeArray.push(mySpan(el));\r\n}\r\n\r\nfunction makeSpan() {\r\n  var limit = performance.now() + 10;\r\n  while (moreToDo(limit, counter, nodeList)) {\r\n    var el = nodeList[counter];\r\n\r\n    doSpan(el);\r\n\r\n    counter += 1;\r\n  }\r\n  if (counter < nodeList.length) {\r\n    add(3, makeSpan);\r\n  } else {\r\n    counter = 0;\r\n    add(3, paintChild);\r\n    potReport(potObj);\r\n  }\r\n}\r\n\r\nexport default function prepareChildRows() {\r\n  nodeList = document.querySelectorAll('#pCC table table ' +\r\n    'tr:not(.fshHide) td:nth-of-type(3n+0)');\r\n  potObj = {};\r\n  nodeArray = [];\r\n  counter = 0;\r\n  add(3, makeSpan);\r\n}\r\n","import add from '../support/task';\r\nimport calf from '../support/calf';\r\nimport moreToDo from '../common/moreToDo';\r\nimport {onlineDot} from '../common/colouredDots';\r\n\r\nvar headerCount;\r\nvar headers;\r\n\r\nfunction memberHeader(oldhtml) {\r\n  if (!calf.membrList[oldhtml]) {return oldhtml;}\r\n  return onlineDot({last_login: calf.membrList[oldhtml].last_login}) +\r\n    '<a href=\"index.php?cmd=profile&player_id=' + calf.membrList[oldhtml].id +\r\n    '\">' + oldhtml + '</a> [ <span class=\"a-reply fshLink\" target_player=' +\r\n    oldhtml + '>m</span> ]';\r\n}\r\n\r\nfunction paintHeader() {\r\n  var limit = performance.now() + 10;\r\n  while (moreToDo(limit, headerCount, headers)) {\r\n    // while (performance.now() < limit && headerCount < headers.length) {\r\n    var el = headers[headerCount];\r\n    var oldhtml = el.textContent;\r\n    el.innerHTML = memberHeader(oldhtml);\r\n    headerCount += 1;\r\n  }\r\n  if (headerCount < headers.length) {\r\n    add(3, paintHeader);\r\n  }\r\n}\r\n\r\nexport default function reportHeader() {\r\n  headers = document.querySelectorAll('#pCC table table ' +\r\n    'tr:not(.fshHide) td[bgcolor=\"#DAA534\"][colspan=\"2\"] b');\r\n  headerCount = 0;\r\n  add(3, paintHeader);\r\n}\r\n","import add from '../support/task';\r\nimport getUrlParameter from '../system/getUrlParameter';\r\nimport moreToDo from '../common/moreToDo';\r\n\r\nvar counter;\r\nvar nodeList;\r\nvar findUser;\r\nvar foundUser;\r\n\r\nfunction hideOther(el) {\r\n  if (el.firstChild.hasAttribute('bgcolor')) {\r\n    foundUser = el.firstChild.firstElementChild.textContent === findUser;\r\n  }\r\n  if (!foundUser) {\r\n    el.className = 'fshHide';\r\n  }\r\n}\r\n\r\nfunction hideOthers() {\r\n  var limit = performance.now() + 5;\r\n  while (moreToDo(limit, counter, nodeList)) {\r\n    var el = nodeList[counter];\r\n\r\n    hideOther(el);\r\n\r\n    counter += 1;\r\n  }\r\n  if (counter < nodeList.length) {\r\n    add(2, hideOthers);\r\n  }\r\n}\r\n\r\nexport default function searchUser() {\r\n  findUser = getUrlParameter('user');\r\n  if (!findUser) {return;}\r\n  var userNodes = document.querySelectorAll(\r\n    '#pCC table table td[bgcolor=\"#DAA534\"] b');\r\n  var userNode = Array.prototype.some.call(userNodes, function(el) {\r\n    return el.textContent === findUser;\r\n  });\r\n  if (!userNode) {return;}\r\n  nodeList = document.querySelectorAll('#pCC table table tr');\r\n  counter = 0;\r\n  add(2, hideOthers);\r\n}\r\n","import currentGuildId from '../common/currentGuildId';\r\nimport getProfile from '../ajax/getProfile';\r\nimport getValue from '../system/getValue';\r\nimport guildView from '../app/guild/view';\r\nimport isObject from '../common/isObject';\r\nimport jQueryPresent from '../common/jQueryPresent';\r\nimport {nowSecs} from '../support/dataObj';\r\nimport {onlineDot} from '../common/colouredDots';\r\nimport {pCC} from '../support/layout';\r\nimport {playerDataObject} from '../common/common';\r\nimport {\r\n  calculateBoundaries,\r\n  pvpLowerLevel,\r\n  pvpUpperLevel\r\n} from '../common/levelHighlight';\r\nimport {createInput, createSpan} from '../common/cElement';\r\n\r\nvar highlightPlayersNearMyLvl;\r\nvar spinner;\r\nvar validPvP = nowSecs - 604800;\r\nvar guilds;\r\nvar myGuildId;\r\n\r\nvar highlightTests = [\r\n  function() {return highlightPlayersNearMyLvl;},\r\n  function(guildId) {\r\n    return typeof guildId === 'undefined' || guildId !== myGuildId;\r\n  },\r\n  function(guildId, data) {return data.last_login >= validPvP;},\r\n  function(guildId, data) {return data.virtual_level >= pvpLowerLevel;},\r\n  function(guildId, data) {return data.virtual_level <= pvpUpperLevel;}\r\n];\r\n\r\nfunction pvpHighlight(guildId, data) {\r\n  return highlightTests.every(function(el) {\r\n    return el(guildId, data);\r\n  });\r\n}\r\n\r\nfunction doOnlineDot(aTable, guildId, data) {\r\n  aTable.rows[0].insertAdjacentHTML('beforeend',\r\n    '<td>' + onlineDot({last_login: data.last_login}) + '</td>');\r\n  if (pvpHighlight(guildId, data)) {\r\n    aTable.parentNode.parentNode.classList.add('lvlHighlight');\r\n  }\r\n}\r\n\r\nfunction parsePlayer(aTable, guildId, data, jqXhr) {\r\n  if (data) {\r\n    doOnlineDot(aTable, guildId, data);\r\n    //#if _DEV  //  get cloaked players\r\n    var defender = playerDataObject(data);\r\n    if (defender.cloakLevel !== 0) {console.log('Cloaked Player', data);} // eslint-disable-line no-console\r\n    //#endif\r\n  } else {\r\n    aTable.rows[0].insertAdjacentHTML('beforeend',\r\n      '<td class=\"fshBkRed\">' + jqXhr.status + '</td>');\r\n  }\r\n}\r\n\r\nfunction failFilter(jqXhr) {\r\n  return $.Deferred().resolve(null, jqXhr).promise();\r\n}\r\n\r\nfunction addPlayerObjectToGuild(guildId, obj) {\r\n  if (guilds[guildId]) {\r\n    guilds[guildId].push(obj);\r\n  } else {\r\n    guilds[guildId] = [obj];\r\n  }\r\n}\r\n\r\nfunction addPlayerToGuild(tbl, playerName) {\r\n  var guildHRef = tbl.rows[0].cells[0].firstElementChild.href;\r\n  var guildId = /guild_id=(\\d+)/.exec(guildHRef)[1];\r\n  addPlayerObjectToGuild(guildId, {dom: tbl, player: playerName});\r\n}\r\n\r\nfunction stackAjax(prm, playerName, tbl, guildId) {\r\n  prm.push(getProfile(playerName)\r\n    .pipe(null, failFilter)\r\n    .done(parsePlayer.bind(null, tbl, guildId))\r\n  );\r\n}\r\n\r\nfunction parseGuild(data) {\r\n  var guildId = data.r.id;\r\n  data.r.members.forEach(function(member) {\r\n    guilds[guildId].forEach(function(player) {\r\n      if (member.name === player.player) {\r\n        doOnlineDot(player.dom, guildId, {\r\n          last_login: (nowSecs - member.last_activity).toString(),\r\n          virtual_level: member.vl\r\n        });\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\nfunction findOnlinePlayers() { // jQuery\r\n  var someTables = pCC.getElementsByTagName('table');\r\n  var prm = [];\r\n  guilds = {};\r\n  Array.prototype.slice.call(someTables, 4).forEach(function(tbl) {\r\n    var playerName = tbl.textContent.trim();\r\n    if (tbl.rows[0].cells[0].firstElementChild) {\r\n      addPlayerToGuild(tbl, playerName);\r\n    } else {\r\n      stackAjax(prm, playerName, tbl);\r\n    }\r\n  });\r\n  Object.keys(guilds).forEach(function(guildId) {\r\n    if (guilds[guildId].length === 1) {\r\n      stackAjax(prm, guilds[guildId][0].player, guilds[guildId][0].dom,\r\n        guildId);\r\n    } else {\r\n      guildView(guildId).done(parseGuild);\r\n    }\r\n  });\r\n  $.when.apply($, prm).done(function() {\r\n    spinner.classList.add('fshHide');\r\n  });\r\n}\r\n\r\nfunction getMyVL(e) { // jQuery\r\n  $(e.target).qtip('hide');\r\n  spinner = createSpan({\r\n    className: 'fshCurveContainer fshTopListSpinner',\r\n    innerHTML: '<div class=\"fshCurveEle fshCurveLbl fshOldSpinner\"></div>'\r\n  });\r\n  e.target.parentNode.replaceChild(spinner, e.target);\r\n  highlightPlayersNearMyLvl = getValue('highlightPlayersNearMyLvl');\r\n  if (highlightPlayersNearMyLvl) {\r\n    calculateBoundaries();\r\n    myGuildId = currentGuildId();\r\n  }\r\n  findOnlinePlayers();\r\n}\r\n\r\nfunction looksLikeTopRated() {\r\n  var theCell = pCC.getElementsByTagName('TD')[0];\r\n  theCell.firstElementChild.className = 'fshTopListWrap';\r\n  var findBtn = createInput({\r\n    id: 'fshFindOnlinePlayers',\r\n    className: 'custombutton tip-static',\r\n    type: 'button',\r\n    value: 'Find Online Players',\r\n    dataset: {\r\n      tipped: 'Fetch the online status of the ' +\r\n        'top 250 players (warning ... takes a few seconds).'\r\n    }\r\n  });\r\n  theCell.insertBefore(findBtn, theCell.firstElementChild);\r\n  findBtn.addEventListener('click', getMyVL);\r\n}\r\n\r\nvar topRatedTests = [\r\n  function() {return jQueryPresent();},\r\n  function() {return isObject(pCC);},\r\n  function() {return isObject(pCC.firstElementChild);},\r\n  function() {return isObject(pCC.firstElementChild.rows);},\r\n  function() {return pCC.firstElementChild.rows.length > 2;},\r\n  function() {\r\n    return pCC.firstElementChild.rows[1].textContent.indexOf(\r\n      'Last Updated') === 0;\r\n  }\r\n];\r\n\r\nfunction testforTopRated() {\r\n  return topRatedTests.every(function(e) {return e();});\r\n}\r\n\r\nexport default function injectTopRated() {\r\n  if (testforTopRated()) {looksLikeTopRated();}\r\n}\r\n","import jQueryPresent from './common/jQueryPresent';\r\n\r\n// var system = require('./support/system');\r\n\r\n// Legacy - Bad, could be repurposed\r\n/* function getBpCountFromWorld(responseText) {\r\n  // backpack counter\r\n  var doc=system.createDocument(responseText);\r\n  var bp=system.findNode(\r\n    '//td[a/img[contains(@src,\"_manageitems.gif\")]]',doc);\r\n  var injectHere=document.getElementById('reportDiv');\r\n  if (!injectHere) {\r\n    injectHere=system.findNode(\r\n      '//b[contains(.,\"Multiple Scavenging Results\")]/..');\r\n  }\r\n  injectHere.appendChild(bp);\r\n}\r\n*/\r\n\r\n/* function multiSummary() { // Legacy - Bad, could be repurposed\r\n  var injectHere=system.findNode(\r\n    '//b[contains(.,\"Multiple Scavenging Results\")]/..');\r\n  if (injectHere) { // multi scavenging\r\n    var victories=system.findNodes('//td[contains(.,\"victorious\")]');\r\n    if (victories) {\r\n      injectHere.innerHTML+='<br/>Victories: '+victories.length;\r\n    }\r\n    var defeats=system.findNodes('//td[contains(.,\"defeated\")]');\r\n    if (defeats) {\r\n      injectHere.innerHTML+=', Defeated: '+defeats.length;\r\n    }\r\n    var gains=system.findNodes('//td[contains(.,\"Item Gained\")]/b');\r\n    if (gains) {\r\n      injectHere.innerHTML+='<br/>'+gains.length+' item(s): ';\r\n      var gainHash={};\r\n      for (var i=0;i<gains.length;i += 1) {\r\n        if (gainHash[gains[i].textContent]) {\r\n          gainHash[gains[i].textContent]+= 1;\r\n        } else {\r\n          gainHash[gains[i].textContent]=1;\r\n        }\r\n      }\r\n      for (var item in gainHash) {\r\n        if (!gainHash.hasOwnProperty(item)) { continue; }\r\n        injectHere.innerHTML+=gainHash[item]+' '+item+'(s), ';\r\n      }\r\n    }\r\n  }\r\n  system.xmlhttp('index.php?cmd=world', getBpCountFromWorld);\r\n}\r\n*/\r\n\r\nfunction dontPost(e) { // jQuery\r\n  e.preventDefault();\r\n  window.location = 'index.php?cmd=scavenging&subcmd=process' +\r\n    '&cave_id=' + $('#pCC input[name=\"cave_id\"]:checked').val() +\r\n    '&gold=' + $('#gold').val() + '&submit=Scavenge';\r\n}\r\n\r\nexport default function injectScavenging() { // jQuery\r\n  if (jQueryPresent()) {\r\n    $('#pCC input[value=\"Scavenge\"]').click(dontPost);\r\n  }\r\n}\r\n","import openQuickBuffByName from '../common/openQuickBuffByName';\r\n\r\nfunction buffAll(self) {\r\n  var titanTable = self.parentNode.parentNode.parentNode.parentNode;\r\n  var shortList = [];\r\n  for (var j = 1; j < titanTable.rows.length; j += 2) {\r\n    var firstCell = titanTable.rows[j].cells[0].firstChild.firstChild;\r\n    shortList.push(firstCell.textContent);\r\n  }\r\n  openQuickBuffByName(shortList.join());\r\n}\r\n\r\nfunction buffEvent(e) {\r\n  var self = e.target;\r\n  if (self.textContent === '[b]') {\r\n    openQuickBuffByName(self.previousElementSibling.textContent);\r\n  }\r\n  if (self.textContent === 'all') {\r\n    buffAll(self);\r\n  }\r\n}\r\n\r\nfunction evtHdl(e) {\r\n  if (e.target.classList.contains('fshBl')) {buffEvent(e);}\r\n}\r\n\r\nfunction doBuffLinks(titanTable) {\r\n  for (var j = 1; j < titanTable.rows.length; j += 2) {\r\n    var firstCell = titanTable.rows[j].cells[0];\r\n    firstCell.insertAdjacentHTML('beforeend',\r\n      ' <button class=\"fshBl fshXSmall\">[b]</button>');\r\n  }\r\n  titanTable.rows[0].cells[0].insertAdjacentHTML('beforeend',\r\n    ' <button class=\"fshBl fshXSmall\">all</button>');\r\n}\r\n\r\nfunction gotTables(titanTables) {\r\n  for (var i = 2; i < titanTables.length; i += 1) {\r\n    var titanTable = titanTables[i];\r\n    if (titanTable.rows.length < 2) {continue;}\r\n    doBuffLinks(titanTable);\r\n  }\r\n  titanTables[1].addEventListener('click', evtHdl);\r\n}\r\n\r\nexport default function injectScouttowerBuffLinks(titanTables) {\r\n  if (titanTables.length > 2) {gotTables(titanTables);}\r\n}\r\n","export default function isNaN(value) {\r\n  return Number.isNaN(value);\r\n}\r\n","import round from './round';\r\n\r\nexport default function roundToString(number, precision) {\r\n  return round(number, precision).toString();\r\n}\r\n","import isNaN from './isNaN';\r\n\r\nexport default function round(number, precision) {\r\n  var factor = Math.pow(10, precision);\r\n  if (isNaN(factor)) {factor = 1;}\r\n  return Math.round(number * factor) / factor;\r\n}\r\n","import getForage from '../ajax/getForage';\r\nimport injectScouttowerBuffLinks from './injectScouttowerBuffLinks';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {pCC} from '../support/layout';\r\nimport parseDateAsTimestamp from '../system/parseDateAsTimestamp';\r\nimport roundToString from '../common/roundToString';\r\nimport setForage from '../ajax/setForage';\r\nimport {createAnchor, createTBody, createTable} from '../common/cElement';\r\nimport {guideUrl, now} from '../support/dataObj';\r\n\r\nfunction getTitanName(aRow) {\r\n  return aRow.cells[0].firstElementChild.getAttribute('oldtitle');\r\n}\r\n\r\nfunction cooldownTracker(aRow, theTitans) {\r\n  var myName = getTitanName(aRow).replace(' (Titan)', '');\r\n  if (!theTitans[myName]) {\r\n    var cooldown = aRow.nextElementSibling.cells[0].textContent;\r\n    var coolTime = 0;\r\n    if (cooldown.indexOf('until') !== -1) {\r\n      coolTime = parseDateAsTimestamp(\r\n        cooldown.replace('Cooldown until: ', ''));\r\n    }\r\n    theTitans[myName] = {\r\n      cooldownText: cooldown,\r\n      coolTime: coolTime,\r\n      seen: 'yes'\r\n    };\r\n  }\r\n}\r\n\r\nfunction addRow(theTitans, trackerTable, titan) {\r\n  if (theTitans[titan].coolTime < now) {return;}\r\n  trackerTable.insertAdjacentHTML('beforeend',\r\n    '<tr><td class=\"fshCenter\">' + titan + '</td>' +\r\n    '<td class=\"fshBold fshCenter fshCooldown\">' +\r\n    theTitans[titan].cooldownText + '</td><td class=\"fshCenter\">' +\r\n    theTitans[titan].seen + '</td></tr>');\r\n}\r\n\r\nfunction displayTracker(parentTable, theTitans) {\r\n  var trackerTable = createTable({className: 'fshTTracker'});\r\n  var tBody = createTBody({\r\n    innerHTML: '<tr><td class=\"header fshCenter\">Titan</td>' +\r\n      '<td class=\"header fshCenter\">Cooldown</td>' +\r\n      '<td class=\"header fshCenter\">Visible</td></tr>'\r\n  });\r\n  trackerTable.appendChild(tBody);\r\n  Object.keys(theTitans).forEach(addRow.bind(null, theTitans, tBody));\r\n\r\n  var newRow = parentTable.insertRow(5);\r\n  var newCell = newRow.insertCell(-1);\r\n  newCell.colSpan = 3;\r\n  newCell.appendChild(trackerTable);\r\n}\r\n\r\nfunction addMissingTitansFromOld(oldTitans, newTitans) {\r\n  if (!oldTitans) {return;}\r\n  Object.keys(oldTitans).forEach(function(oldTitan) {\r\n    if (newTitans[oldTitan]) {return;}\r\n    if (oldTitans[oldTitan].coolTime <= now) {return;}\r\n    newTitans[oldTitan] = {\r\n      cooldownText: oldTitans[oldTitan].cooldownText,\r\n      coolTime: oldTitans[oldTitan].coolTime,\r\n      seen: 'no'\r\n    };\r\n  });\r\n}\r\n\r\nexport function getTitanString(guildKills, totalHP, currentHP) {\r\n  var numberOfKillsToSecure = Math.ceil(totalHP / 2 + 1);\r\n  if (guildKills >= numberOfKillsToSecure) {\r\n    return 'Secured';\r\n  }\r\n  var remainingKills = numberOfKillsToSecure - guildKills;\r\n  if (remainingKills > currentHP) {\r\n    return '<span class=\"fshRed\">Cannot Secure</span>';\r\n  }\r\n  return '<span class=\"fshRed\">' + remainingKills + '</span> to secure';\r\n}\r\n\r\nexport function getKillsPct(currentNumberOfKills, guildKills) {\r\n  if (currentNumberOfKills === 0) {return 0;}\r\n  return guildKills * 100 / currentNumberOfKills;\r\n}\r\n\r\nfunction killsSummary(aRow) {\r\n  var titanHP = aRow.cells[2].textContent;\r\n  if (titanHP.indexOf('-') !== -1) {return;}\r\n  var guildKills = Number(aRow.cells[3].textContent);\r\n  var titanHPArray = titanHP.split('/');\r\n  var currentHP = Number(titanHPArray[0]);\r\n  var totalHP = Number(titanHPArray[1]);\r\n  aRow.cells[3].insertAdjacentHTML('beforeend',\r\n    '<br><span class=\"fshBlue\"> (' +\r\n    roundToString(getKillsPct(totalHP - currentHP, guildKills), 2) +\r\n    '% Current <br>' + roundToString(guildKills * 100 / totalHP, 2) +\r\n    '% Total<br>' + getTitanString(guildKills, totalHP, currentHP) + ')');\r\n}\r\n\r\nfunction guideLink(aRow) {\r\n  var myName = encodeURIComponent(getTitanName(aRow));\r\n  var myImg = aRow.cells[0].firstElementChild;\r\n  var myLink = createAnchor({\r\n    href: guideUrl + 'creatures&search_name=' + myName,\r\n    target: '_blank'\r\n  });\r\n  myLink.appendChild(myImg);\r\n  aRow.cells[0].appendChild(myLink);\r\n}\r\n\r\nfunction gotOldTitans(oldTitans) {\r\n  var titanTables = pCC.getElementsByTagName('table');\r\n  injectScouttowerBuffLinks(titanTables);\r\n  var titanTable = titanTables[1];\r\n  var newTitans = {};\r\n  for (var i = 1; i < titanTable.rows.length - 1; i += 6) {\r\n    var aRow = titanTable.rows[i];\r\n    killsSummary(aRow);\r\n    cooldownTracker(aRow, newTitans); // Pref\r\n    guideLink(aRow);\r\n  }\r\n  addMissingTitansFromOld(oldTitans, newTitans); // Pref\r\n  displayTracker(titanTables[0], newTitans); // Pref\r\n  setForage('fsh_titans', newTitans); // Pref\r\n}\r\n\r\nexport default function injectScouttower() { // jQuery.min\r\n  if (jQueryNotPresent()) {return;}\r\n  getForage('fsh_titans').done(gotOldTitans); // Pref\r\n}\r\n","import calf from '../support/calf';\r\nimport getValue from '../system/getValue';\r\nimport isChecked from '../system/isChecked';\r\nimport {networkIcon} from './settingObj';\r\nimport {helpLink, simpleCheckbox} from './simpleCheckbox';\r\n\r\nfunction guildInfoWidgets() {\r\n  return '<tr><td class=\"fshRight\"><label for=\"enableGuildInfoWidgets\">' +\r\n    'Enable Guild Info Widgets' +\r\n    helpLink('Enable Guild Info Widgets',\r\n      'Enabling this option will enable the Guild Info Widgets ' +\r\n      '(coloring on the Guild Info panel)') +\r\n    ':</label></td><td>' +\r\n    '<input id=\"enableGuildInfoWidgets\" name=\"enableGuildInfoWidgets\" ' +\r\n    'type=\"checkbox\" value=\"on\"' + isChecked(calf.enableGuildInfoWidgets) +\r\n    '>&nbsp;<label>Hide Message&gt;<input name=\"hideGuildInfoMessage\" ' +\r\n    'type=\"checkbox\" value=\"on\"' + isChecked(calf.hideGuildInfoMessage) +\r\n    '></label>&nbsp;<label>Hide Buff&gt;<input name=\"hideGuildInfoBuff\" ' +\r\n    'type=\"checkbox\" value=\"on\"' + isChecked(calf.hideGuildInfoBuff) +\r\n    '></label>&nbsp;<label>Hide ST&gt;<input name=\"hideGuildInfoSecureTrade\" ' +\r\n    'type=\"checkbox\" value=\"on\"' + isChecked(calf.hideGuildInfoSecureTrade) +\r\n    '></label>&nbsp;<label>Hide Trade&gt;<input name=\"hideGuildInfoTrade\" ' +\r\n    'type=\"checkbox\" value=\"on\"' + isChecked(calf.hideGuildInfoTrade) +\r\n    '></label></td></tr>';\r\n}\r\n\r\nfunction onlineAlliesEnemies() {\r\n  return '<tr><td class=\"fshRight\">' + networkIcon +\r\n    'Show Online Allies/Enemies' +\r\n    helpLink('Show Online Allies/Enemies',\r\n      'This will show the allies/enemies online list on the right.') +\r\n    ':</td><td><label>Allies&nbsp;<input name=\"enableAllyOnlineList\" ' +\r\n    'type=\"checkbox\" value=\"on\"' + isChecked(calf.enableAllyOnlineList) +\r\n    '></label>&nbsp;&nbsp;<label>Enemies&nbsp;' +\r\n    '<input name=\"enableEnemyOnlineList\" type=\"checkbox\" value=\"on\"' +\r\n    isChecked(calf.enableEnemyOnlineList) + '></label>&nbsp;&nbsp;' +\r\n    '<input name=\"allyEnemyOnlineRefreshTime\" size=\"3\" value=\"' +\r\n    getValue('allyEnemyOnlineRefreshTime') + '\"> seconds refresh</td></tr>';\r\n}\r\n\r\nfunction quickLinksLocation() {\r\n  return '<tr><td class=\"fshRight\">Quick Links Screen Location' +\r\n    helpLink('Quick Links Screen Location',\r\n      'Determines where the quick links dialog shows on the screen. ' +\r\n      'Default is top 22, left 0.') +\r\n    ':</td><td>Top: <input name=\"quickLinksTopPx\" size=\"3\" value=\"' +\r\n    getValue('quickLinksTopPx') +\r\n    '\"> Left: <input name=\"quickLinksLeftPx\" size=\"3\" value=\"' +\r\n    getValue('quickLinksLeftPx') + '\"></td></tr>';\r\n}\r\n\r\nexport default function generalPrefs() {\r\n  // General Prefs\r\n  return '<tr><th colspan=\"2\"><b>General preferences ' +\r\n      '(apply to most screens)</b></th></tr>' +\r\n\r\n    guildInfoWidgets() +\r\n\r\n    simpleCheckbox('moveGuildList') +\r\n    simpleCheckbox('moveOnlineAlliesList') +\r\n\r\n    onlineAlliesEnemies() +\r\n\r\n    simpleCheckbox('enableOnlineAlliesWidgets') +\r\n    simpleCheckbox('moveFSBox') +\r\n    simpleCheckbox('moveDailyQuest') +\r\n    simpleCheckbox('fsboxlog') +\r\n    simpleCheckbox('gameHelpLink') +\r\n    simpleCheckbox('enableTempleAlert') +\r\n    simpleCheckbox('enableUpgradeAlert') +\r\n    simpleCheckbox('enableComposingAlert') +\r\n    simpleCheckbox('enhanceOnlineDots') +\r\n    simpleCheckbox('hideBuffSelected') +\r\n    simpleCheckbox('hideHelperMenu') +\r\n    simpleCheckbox('keepHelperMenuOnScreen') +\r\n    simpleCheckbox('draggableHelperMenu') +\r\n\r\n    quickLinksLocation() +\r\n\r\n    simpleCheckbox('draggableQuickLinks') +\r\n    simpleCheckbox('expandMenuOnKeyPress');\r\n}\r\n","import getValue from '../system/getValue';\r\nimport isChecked from '../system/isChecked';\r\nimport {helpLink, simpleCheckbox} from './simpleCheckbox';\r\n\r\nfunction injectSettingsGuildData(guildType) {\r\n  return '<input name=\"guild' + guildType + '\" size=\"60\" value=\"' +\r\n    getValue('guild' + guildType) + '\">' +\r\n    '<span class=\"fshPoint\" ' +\r\n    'id=\"toggleShowGuild' + guildType + 'Message\" linkto=\"showGuild' +\r\n    guildType + 'Message\"> &#x00bb;</span>' +\r\n    '<div id=\"showGuild' + guildType + 'Message\" class=\"fshHide\">' +\r\n    '<input name=\"guild' + guildType + 'Message\" size=\"60\" value=\"' +\r\n    getValue('guild' + guildType + 'Message') + '\">' +\r\n    '</div>';\r\n}\r\n\r\nexport default function guildPrefs() {\r\n  // Guild Manage\r\n  return '<tr><th colspan=\"2\"><b>Guild>Manage preferences' +\r\n      '</b></th></tr>' +\r\n    '<tr><td colspan=\"2\">Enter guild names, ' +\r\n      'separated by commas</td></tr>' +\r\n    '<tr><td class=\"fshRight\">Own Guild</td><td>' +\r\n      injectSettingsGuildData('Self') + '</td></tr>' +\r\n    '<tr><td class=\"fshRight\">Friendly Guilds</td><td>' +\r\n      injectSettingsGuildData('Frnd') + '</td></tr>' +\r\n    '<tr><td class=\"fshRight\">Old Guilds</td><td>' +\r\n      injectSettingsGuildData('Past') + '</td></tr>' +\r\n    '<tr><td class=\"fshRight\">Enemy Guilds</td><td>' +\r\n      injectSettingsGuildData('Enmy') + '</td></tr>' +\r\n\r\n    '<tr><td class=\"fshRight\">Highlight Valid PvP Targets' +\r\n      helpLink('Highlight Valid PvP Targets',\r\n        'Enabling this option will highlight targets in OTHER guilds that ' +\r\n        'are within your level range to attack for PvP or GvG.') +\r\n      ':</td><td>PvP: <input name=\"highlightPlayersNearMyLvl\" ' +\r\n      'type=\"checkbox\" value=\"on\"' +\r\n      isChecked(getValue('highlightPlayersNearMyLvl')) +\r\n      '> GvG: <input name=\"highlightGvGPlayersNearMyLvl\" ' +\r\n      'type=\"checkbox\" value=\"on\"' +\r\n      isChecked(getValue('highlightGvGPlayersNearMyLvl')) +\r\n      '></td></tr>' +\r\n\r\n    simpleCheckbox('showAdmin') +\r\n    simpleCheckbox('ajaxifyRankControls') +\r\n    simpleCheckbox('detailedConflictInfo');\r\n}\r\n","import calf from '../support/calf';\r\nimport getValue from '../system/getValue';\r\nimport isChecked from '../system/isChecked';\r\nimport isSelected from '../system/isSelected';\r\nimport {\r\n  helpLink,\r\n  justCheckbox,\r\n  justLabel,\r\n  simpleCheckbox\r\n} from './simpleCheckbox';\r\n\r\nfunction worldGroup() {\r\n  // World Screen\r\n  return '<tr><td class=\"fshRight\">Hide Create Group Button' +\r\n    helpLink('Hide Create Group Button',\r\n      'Enabling this option will hide the Create Group button') +\r\n    ':</td><td>' +\r\n    '<input name=\"hideChampionsGroup\" type=\"checkbox\" value=\"on\"' +\r\n      isChecked(getValue('hideChampionsGroup')) + '>' +\r\n    '&nbsp;Champions&nbsp;&nbsp;' +\r\n    '<input name=\"hideElitesGroup\" type=\"checkbox\" value=\"on\"' +\r\n      isChecked(getValue('hideElitesGroup')) + '>' +\r\n    '&nbsp;Elites&nbsp;&nbsp;' +\r\n    '<input name=\"hideSEGroup\" type=\"checkbox\" value=\"on\"' +\r\n      isChecked(getValue('hideSEGroup')) + '>' +\r\n    '&nbsp;Super Elite&nbsp;&nbsp;' +\r\n    '<input name=\"hideTitanGroup\" type=\"checkbox\" value=\"on\"' +\r\n      isChecked(getValue('hideTitanGroup')) + '>' +\r\n    '&nbsp;Titan&nbsp;&nbsp;' +\r\n    '<input name=\"hideLegendaryGroup\" type=\"checkbox\" value=\"on\"' +\r\n      isChecked(getValue('hideLegendaryGroup')) + '>' +\r\n    '&nbsp;Legendary' +\r\n    '</td></tr>';\r\n}\r\n\r\nfunction keepCombatLogs() {\r\n  return '<tr><td class=\"fshRight\">Keep Combat Logs' +\r\n    helpLink('Keep Combat Logs',\r\n      'Save combat logs to a temporary variable. ' +\r\n      'Press <u>Show logs</u> on the right to display and copy them') +\r\n    ':</td><td><input name=\"keepLogs\" type=\"checkbox\" value=\"on\"' +\r\n    isChecked(getValue('keepLogs')) + '>&nbsp;&nbsp;' +\r\n    '<input type=\"button\" class=\"custombutton\" value=\"Show Logs\" ' +\r\n    'id=\"Helper:ShowLogs\"></td></tr>';\r\n}\r\n\r\nfunction combatEvalBias() {\r\n  return '<tr><td class=\"fshRight\">Combat Evaluator Bias' +\r\n    helpLink('Combat Evaluator Bias',\r\n      'This changes the bias of the combat evaluator for the damage and ' +\r\n      'HP evaluation. It will not change the attack bias (1.1053).' +\r\n      '<br>Conservative = 1.1053 and 1.1 (Safest)' +\r\n      '<br>Semi-Conservative = 1.1 and 1.053' +\r\n      '<br>Adventurous = 1.053 and 1 (Bleeding Edge)' +\r\n      '<br>Conservative+ = 1.1053 and 1 with the attack calculation ' +\r\n      'changed to +-48 per RJEM') +\r\n    ':</td><td><select name=\"combatEvaluatorBias\">' +\r\n    '<option value=\"0\"' +\r\n    isSelected(calf.combatEvaluatorBias, 0) +\r\n    '>Conservative</option>' +\r\n    '<option value=\"1\"' +\r\n    isSelected(calf.combatEvaluatorBias, 1) +\r\n    '>Semi-Conservative</option>' +\r\n    '<option value=\"2\"' +\r\n    isSelected(calf.combatEvaluatorBias, 2) +\r\n    '>Adventurous</option>' +\r\n    '<option value=\"3\"' +\r\n    isSelected(calf.combatEvaluatorBias, 3) +\r\n    '>Conservative+</option></select></td></tr>';\r\n}\r\n\r\nfunction keepCreatureLog() {\r\n  return '<tr><td class=\"fshRight\">' + justLabel('showMonsterLog') +\r\n    '</td><td>' + justCheckbox('showMonsterLog') +\r\n    '&nbsp;&nbsp;<input type=\"button\" class=\"custombutton\" ' +\r\n    'value=\"Show\" id=\"Helper:ShowMonsterLogs\"></td></tr>';\r\n}\r\n\r\nfunction showSendGold() {\r\n  return '<tr><td class=\"fshRight\">Show Send Gold' +\r\n    helpLink('Show Gold on World Screen',\r\n      'This will show an icon below the world map to allow you to ' +\r\n      'quickly send gold to a Friend.') +\r\n    ':</td><td><input name=\"sendGoldonWorld\" type=\"checkbox\" value=\"on\"' +\r\n    isChecked(getValue('sendGoldonWorld')) + '>' +\r\n    '&nbsp;&nbsp;Send <input name=\"goldAmount\" size=\"5\" value=\"' +\r\n    getValue('goldAmount') + '\"> ' +\r\n    'gold to <input name=\"goldRecipient\" size=\"10\" value=\"' +\r\n    getValue('goldRecipient') + '\">' +\r\n    ' Current total: <input name=\"currentGoldSentTotal\" size=\"5\" value=\"' +\r\n    getValue('currentGoldSentTotal') + '\"></td></tr>';\r\n}\r\n\r\nfunction theDoNotKillList() {\r\n  return '<tr><td class=\"fshRight\">Do Not Kill List' +\r\n    helpLink('Do Not Kill List',\r\n      'List of creatures that will not be killed by quick kill. ' +\r\n      'You must type the full name of each creature, separated by commas. ' +\r\n      'Creature name will show up in red color on world screen and will ' +\r\n      'not be killed by keyboard entry (but can still be killed by ' +\r\n      'mouseclick). Quick kill must be enabled for this function to work.') +\r\n    ':</td><td colspan=\"3\"><input name=\"doNotKillList\" size=\"60\" value=\"' +\r\n    calf.doNotKillList + '\"></td></tr>';\r\n}\r\n\r\nfunction huntBuff() {\r\n  return 'Hunting Buffs' + helpLink('Hunting Buffs',\r\n    'Customize which buffs are designated as hunting buffs. ' +\r\n    'You must type the full name of each buff, separated by commas. ' +\r\n    'Use the checkbox to enable/disable them.') + ':';\r\n}\r\n\r\nfunction huntBuffCheck() {\r\n  return '<input name=\"showHuntingBuffs\" ' +\r\n    'class=\"fshVMid\" type=\"checkbox\" value=\"on\"' +\r\n    isChecked(calf.showBuffs) + '>';\r\n}\r\n\r\nexport function huntMode() {\r\n  return 'Enabled Hunting Mode' +\r\n    helpLink('Enabled Hunting Mode',\r\n      'This will determine which list of buffs gets checked ' +\r\n      'on the world screen.') +\r\n    ':<select name=\"enabledHuntingMode\">' +\r\n    '<option value=\"1\"' + isSelected(calf.enabledHuntingMode, '1') +\r\n    '>' + calf.buffsName + '</option>' +\r\n    '<option value=\"2\"' + isSelected(calf.enabledHuntingMode, '2') +\r\n    '>' + calf.buffs2Name + '</option>' +\r\n    '<option value=\"3\"' + isSelected(calf.enabledHuntingMode, '3') +\r\n    '>' + calf.buffs3Name + '</option>' +\r\n    '</select>';\r\n}\r\n\r\nexport function huntingBuffsHtml() {\r\n  return huntBuff() + huntBuffCheck() + ' ' + huntMode();\r\n}\r\n\r\nfunction huntingBuffs() {\r\n  return '<tr><td class=\"fshRight\">' + huntBuff() + '</td><td colspan=\"3\">' +\r\n    huntBuffCheck() + ' ' + huntMode() + '</td></tr>';\r\n}\r\n\r\nfunction huntingBuffsList(modeLabel, modeName, buffsName, buffs) {\r\n  return '<tr><td class=\"fshRight\">' + modeLabel + ' Hunting Buff List' +\r\n    helpLink(modeLabel + ' Hunting Buff List',\r\n      modeLabel + ' list of hunting buffs.') +\r\n    ':</td><td colspan=\"3\"><input name=\"' + modeName +\r\n    '\" title=\"Hunting mode name\" size=\"7\" value=\"' + modeLabel +\r\n    '\"><input name=\"' + buffsName + '\" size=\"49\" value=\"' + buffs +\r\n    '\"></td></tr>';\r\n}\r\n\r\nexport function prefs() {\r\n  // World Screen\r\n  return '<tr><th colspan=\"2\"><b>' +\r\n    'World screen/Hunting preferences</b></th></tr>' +\r\n\r\n    worldGroup() +\r\n    keepCombatLogs() +\r\n\r\n    simpleCheckbox('showCombatLog') +\r\n    simpleCheckbox('enableCreatureColoring') +\r\n    simpleCheckbox('showCreatureInfo') +\r\n\r\n    combatEvalBias() +\r\n    keepCreatureLog() +\r\n    showSendGold() +\r\n    theDoNotKillList() +\r\n    huntingBuffs() +\r\n\r\n    huntingBuffsList(calf.buffsName, 'huntingBuffsName', 'huntingBuffs',\r\n      calf.buffs) +\r\n    huntingBuffsList(calf.buffs2Name, 'huntingBuffs2Name', 'huntingBuffs2',\r\n      calf.buffs2) +\r\n    huntingBuffsList(calf.buffs3Name, 'huntingBuffs3Name', 'huntingBuffs3',\r\n      calf.buffs3) +\r\n\r\n    simpleCheckbox('huntingMode');\r\n}\r\n","import bountyPrefs from './bountyPrefs';\r\nimport calf from '../support/calf';\r\nimport equipPrefs from './equipPrefs';\r\nimport generalPrefs from './generalPrefs';\r\nimport guildPrefs from './guildPrefs';\r\nimport logPrefs from './logPrefs';\r\nimport otherPrefs from './otherPrefs';\r\nimport {prefs} from './worldPrefs';\r\nimport profilePrefs from './profilePrefs';\r\nimport questPrefs from './questPrefs';\r\n\r\nfunction storageDetails() {\r\n  return '<tr><td align=center><input id=\"fshClearStorage\" type=\"button\" ' +\r\n    'class=\"awesome magenta tip-static\" value=\"Clear Storage\" ' +\r\n    'data-tipped=\"<span class=\\'fshHelpTitle\\'>Clear Storage' +\r\n    '</span><br><br>This will clear all localStorage related to ' +\r\n    'fallensword.com<br>It will reset all your Helper settings to ' +\r\n    'defaults<br>Use it if your storage has overflowed or become ' +\r\n    'corrupt\"></td><td align=center>' +\r\n    '<span style=\"font-size:x-small\">(Current version: ' +\r\n    FSH.version + '(' + FSH.calf + ')) (Storage Used: ' +\r\n    calf.storage + '% Remaining: ' +\r\n    (100 - calf.storage).toFixed(2) + '%)</span></td></tr>';\r\n}\r\n\r\nfunction linkToWebsite() {\r\n  return '<tr><td colspan=\"2\" align=center>' +\r\n  '<span style=\"font-weight:bold;\">Visit the ' +\r\n  '<a href=\"https://github.com/fallenswordhelper/fallenswordhelper\">' +\r\n  'Fallen Sword Helper web site</a> ' +\r\n  'for any suggestions, requests or bug reports</span></td></tr>';\r\n}\r\n\r\nfunction coderLink(prev, curr, ind, ary) {\r\n  var ret = prev + '<a href=\"index.php?cmd=profile&player_id=' + curr[0] +\r\n    '\">' + curr[1] + '</a>';\r\n  if (ind === ary.length - 2) {\r\n    ret += ' and ';\r\n  } else if (ind !== ary.length - 1) {ret += ', ';}\r\n  return ret;\r\n}\r\n\r\nfunction listOfCoders(ary) {\r\n  return ary.reduce(coderLink, '');\r\n}\r\n\r\nfunction codedBy() {\r\n  return '<tr><td colspan=\"2\" align=center>' +\r\n    '<span class=\"fshXXSmall\">Fallen Sword Helper was coded by ' +\r\n    listOfCoders([['1393340', 'Coccinella'], ['1599987', 'yuuzhan'],\r\n      ['1963510', 'PointyHair'], ['1346893', 'Tangtop'],\r\n      ['2536682', 'dkwizard'], ['1570854', 'jesiegel'],\r\n      ['2156859', 'ByteBoy'], ['2169401', 'McBush']]) +\r\n    ', with valuable contributions by ' +\r\n    listOfCoders([['524660', 'Nabalac'], ['37905', 'Ananasii']]) +\r\n    '</span></td></tr>';\r\n}\r\n\r\nexport default function setupConfigData() {\r\n  calf.configData =\r\n    '<form><table id=\"fshSettingsTable\">' +\r\n    '<thead><th colspan=\"2\"><b>Fallen Sword Helper configuration ' +\r\n      'Settings</b></th></thead>' +\r\n    storageDetails() +\r\n    linkToWebsite() +\r\n    // General Prefs\r\n    generalPrefs() +\r\n    // Guild Manage\r\n    guildPrefs() +\r\n    // World Screen\r\n    prefs() +\r\n    // Log screen prefs\r\n    logPrefs() +\r\n    // Equipment screen prefs\r\n    equipPrefs() +\r\n    // Quest Preferences\r\n    questPrefs() +\r\n    // profile prefs\r\n    profilePrefs() +\r\n    // Bounty hunting prefs\r\n    bountyPrefs() +\r\n    // Other prefs\r\n    otherPrefs() +\r\n    // save button\r\n    '<tr><td colspan=\"2\" align=center><input type=\"button\" class=' +\r\n      '\"custombutton\" value=\"Save\" id=\"Helper:SaveOptions\"></td></tr>' +\r\n    // Export or Load Settings\r\n    // http://www.fallensword.com/index.php?cmd=notepad&blank=1&subcmd=savesettings\r\n    '<tr><td colspan=\"2\" align=center>' +\r\n      '<a href=\"index.php?cmd=notepad&blank=1&subcmd=savesettings\">' +\r\n      'Export or Load Settings!</a></td></tr>' +\r\n    codedBy() +\r\n    '</table></form>';\r\n}\r\n","import getValue from '../system/getValue';\r\nimport isChecked from '../system/isChecked';\r\nimport {helpLink, simpleCheckbox} from './simpleCheckbox';\r\n\r\nexport default function logPrefs() {\r\n  // Log screen prefs\r\n  return '<tr><th colspan=\"2\"><b>Log screen preferences' +\r\n      '</b></th></tr>' +\r\n\r\n    simpleCheckbox('hideNonPlayerGuildLogMessages') +\r\n    simpleCheckbox('useNewGuildLog') +\r\n\r\n    '<tr><td class=\"fshRight\">New Guild Log History' +\r\n      helpLink('New Guild Log History (pages)',\r\n        'This is the number of pages that the new guild log ' +\r\n        'screen will go back in history.') +\r\n      ':</td><td><input name=\"newGuildLogHistoryPages\" size=\"3\" value=\"' +\r\n      getValue('newGuildLogHistoryPages') + '\"></td></td></tr>' +\r\n\r\n    simpleCheckbox('enableLogColoring') +\r\n\r\n    '<tr><td class=\"fshRight\">New Log Message Sound' +\r\n      helpLink('New Log Message Sound',\r\n        'The .wav or .ogg file to play when you have unread log messages. ' +\r\n        'This must be a .wav or .ogg file. This option can be turned on/off ' +\r\n        'on the world page. Only works in Firefox 3.5+') +\r\n      ':</td><td colspan=\"3\"><input name=\"defaultMessageSound\" size=\"60\" ' +\r\n      'value=\"' + getValue('defaultMessageSound') +\r\n      '\"></td></tr>' +\r\n\r\n    '<tr><td class=\"fshRight\">Play sound on unread log' +\r\n      helpLink('Play sound on unread log',\r\n        'Should the above sound play when you have unread log messages? ' +\r\n        '(will work on Firefox 3.5+ only)') +\r\n      ':</td><td><input name=\"playNewMessageSound\" type=\"checkbox\" ' +\r\n      'value=\"on\"' +\r\n      isChecked(getValue('playNewMessageSound')) + '>' +\r\n      ' Show speaker on world' +\r\n      helpLink('Show speaker on world',\r\n        'Should the toggle play sound speaker show on the world map? ' +\r\n        '(This icon is next to the Fallensword wiki icon and will only ' +\r\n        'display on Firefox 3.5+)') +\r\n      ':<input name=\"showSpeakerOnWorld\" type=\"checkbox\" value=\"on\"' +\r\n      isChecked(getValue('showSpeakerOnWorld')) +\r\n      '></tr></td>' +\r\n\r\n    simpleCheckbox('enableChatParsing') +\r\n    simpleCheckbox('keepBuffLog') +\r\n    simpleCheckbox('addAttackLinkToLog') +\r\n    simpleCheckbox('enhanceChatTextEntry');\r\n}\r\n","import escapeHtml from '../system/escapeHtml';\r\nimport getValue from '../system/getValue';\r\nimport isChecked from '../system/isChecked';\r\nimport {helpLink, simpleCheckbox} from './simpleCheckbox';\r\n\r\nexport default function equipPrefs() {\r\n  // Equipment screen prefs\r\n  return '<tr><th colspan=\"2\"><b>Equipment screen preferences' +\r\n      '</b></th></tr>' +\r\n\r\n    simpleCheckbox('showExtraLinks') +\r\n    simpleCheckbox('disableItemColoring') +\r\n\r\n    '<tr><td class=\"fshRight\">Show Quick Send Item' +\r\n      helpLink('Show Quick Send on Manage Backpack',\r\n        'This will show a link beside each item which gives the option to ' +\r\n        'quick send the item to this person') +\r\n      ':</td><td><input name=\"showQuickSendLinks\" type=\"checkbox\" ' +\r\n      'value=\"on\"' +\r\n      isChecked(getValue('showQuickSendLinks')) + '>' +\r\n      '&nbsp;&nbsp;Send Items To ' +\r\n      '<input name=\"itemRecipient\" size=\"10\" value=\"' +\r\n      getValue('itemRecipient') + '\">' +\r\n\r\n    simpleCheckbox('showQuickDropLinks') +\r\n\r\n    '<tr><td class=\"fshRight\">Quick Select all of type in Send Screen' +\r\n      helpLink('Quick Select all of type in Send Screen',\r\n        'This allows you to customize what quick links you would like ' +\r\n        'displayed in your send item screen.<br>Use the format ' +\r\n        '[&quot;name&quot;,&quot;itemid&quot;],[&quot;othername&quot;,' +\r\n        '&quot;itemid2&quot;].<br>WARNING: NO REFUNDS ON ERROR') +\r\n      ':</td><td><input name=\"sendClasses\" size=\"60\" value=\"' +\r\n      escapeHtml(getValue('sendClasses')) + '\">';\r\n}\r\n","import getValue from '../system/getValue';\r\nimport isChecked from '../system/isChecked';\r\nimport {helpLink, simpleCheckbox} from './simpleCheckbox';\r\n\r\nexport default function questPrefs() {\r\n  // Quest Preferences\r\n  return '<tr><th colspan=\"2\"><b>Quest preferences</b></th></tr>' +\r\n\r\n    '<tr><td class=\"fshRight\">Hide Specific Quests' +\r\n      helpLink('Hide Specific Quests',\r\n        'If enabled, this hides quests whose name matches the list ' +\r\n        '(separated by commas). This works on Quest Manager and Quest Book.') +\r\n      ':</td><td colspan=\"3\"><input name=\"hideQuests\" type=\"checkbox\" ' +\r\n      'value=\"on\"' +\r\n      isChecked(getValue('hideQuests')) + '>' +\r\n      '&nbsp;<input name=\"hideQuestNames\" size=\"60\" value=\"' +\r\n      getValue('hideQuestNames') + '\"></td></tr>' +\r\n\r\n    simpleCheckbox('storeLastQuestPage') +\r\n    simpleCheckbox('showNextQuestSteps');\r\n}\r\n","import getValue from '../system/getValue';\r\nimport isChecked from '../system/isChecked';\r\nimport {helpLink, simpleCheckbox} from './simpleCheckbox';\r\n\r\nexport default function profilePrefs() {\r\n  // profile prefs\r\n  return '<tr><th colspan=\"2\"><b>Profile preferences</b></th></tr>' +\r\n\r\n    simpleCheckbox('renderSelfBio') +\r\n    simpleCheckbox('renderOtherBios') +\r\n\r\n    '<tr><td class=\"fshRight\">Enable Bio Compressor' +\r\n      helpLink('Enable Bio Compressor',\r\n        'This will compress long bios according to settings and provide a ' +\r\n        'link to expand the compressed section.') +\r\n      ':</td><td><input name=\"enableBioCompressor\" type=\"checkbox\" ' +\r\n      'value=\"on\"' +\r\n      isChecked(getValue('enableBioCompressor')) +\r\n      '> Max Characters:<input name=\"maxCompressedCharacters\" size=\"4\" ' +\r\n      'value=\"' + getValue('maxCompressedCharacters') + '\" />' +\r\n      ' Max Lines:<input name=\"maxCompressedLines\" size=\"3\" value=\"' +\r\n      getValue('maxCompressedLines') + '\"></td></tr>' +\r\n\r\n    '<tr><td class=\"fshRight\">Buy Buffs Greeting' +\r\n      helpLink('Buy Buffs Greeting',\r\n        'This is the default text to open a message with when asking to ' +\r\n        'buy buffs. You can use {playername} to insert the target players ' +\r\n        'name. You can also use {buffs} to insert the list of buffs. You ' +\r\n        'can use {cost} to insert the total cost of the buffs.') +\r\n      ':</td><td colspan=\"3\"><input name=\"buyBuffsGreeting\" size=\"60\" ' +\r\n      'value=\"' + getValue('buyBuffsGreeting') + '\"></td></tr>' +\r\n\r\n    simpleCheckbox('showStatBonusTotal') +\r\n    simpleCheckbox('enableQuickDrink') +\r\n    simpleCheckbox('disableDeactivatePrompts');\r\n}\r\n","import calf from '../support/calf';\r\nimport isChecked from '../system/isChecked';\r\nimport {networkIcon} from './settingObj';\r\nimport {helpLink, simpleCheckbox} from './simpleCheckbox';\r\n\r\nexport default function bountyPrefs() {\r\n  // Bounty hunting prefs\r\n  return '<tr><th colspan=\"2\"><b>Bounty hunting preferences' +\r\n      '</b></th></tr>' +\r\n\r\n    '<tr><td align= \"right\">' + networkIcon +\r\n      'Show Active Bounties' +\r\n      helpLink('Show Active Bounties',\r\n        'This will show your active bounties on the right hand side') +\r\n      ':</td><td colspan=\"3\"><input name=\"enableActiveBountyList\" ' +\r\n      'type = \"checkbox\" value = \"on\"' +\r\n      isChecked(calf.enableActiveBountyList) + '>&nbsp;' +\r\n      '<input name=\"bountyListRefreshTime\" size=\"3\" value=\"' +\r\n      calf.bountyListRefreshTime + '\"> seconds refresh</td></tr>' +\r\n\r\n    '<tr><td align= \"right\">' + networkIcon +\r\n      'Show Wanted Bounties' +\r\n      helpLink('Show Wanted Bounties',\r\n        'This will show when someone you want is on the bounty board, ' +\r\n        'the list is displayed on the right hand side') +\r\n      ':</td><td colspan=\"3\"><input name=\"enableWantedList\" ' +\r\n      'type=\"checkbox\" value=\"on\"' +\r\n      isChecked(calf.enableWantedList) +\r\n      '> Refresh time is same as Active Bounties' +\r\n\r\n    '<tr><td align= \"right\">Wanted Names' +\r\n      helpLink('Wanted Names',\r\n        'The names of the people you want to see on the bounty board ' +\r\n        'separated by commas (or * for all)') + ':</td><td colspan=\"3\">' +\r\n      '<input name=\"wantedNames\" size=\"60\" value=\"' + calf.wantedNames +\r\n      '\"></td></tr>' +\r\n\r\n    simpleCheckbox('wantedGuildMembers') +\r\n    simpleCheckbox('enableAttackHelper') +\r\n    simpleCheckbox('showPvPSummaryInLog');\r\n}\r\n","import getValue from '../system/getValue';\r\nimport isChecked from '../system/isChecked';\r\nimport {helpLink, simpleCheckbox} from './simpleCheckbox';\r\n\r\nexport default function otherPrefs() {\r\n  // Other prefs\r\n  return '<tr><th colspan=\"2\"><b>Other preferences</b></th></tr>' +\r\n\r\n    simpleCheckbox('autoFillMinBidPrice') +\r\n\r\n    '<tr><td class=\"fshRight\">Hide Specific Recipes' +\r\n      helpLink('Hide Specific Recipes',\r\n        'If enabled, this hides recipes whose name matches the list ' +\r\n        '(separated by commas). This works on Recipe Manager') +\r\n      ':</td><td colspan=\"3\"><input name=\"hideRecipes\" ' +\r\n      'type=\"checkbox\" value=\"on\"' +\r\n      isChecked(getValue('hideRecipes')) + '>' +\r\n      '&nbsp;<input name=\"hideRecipeNames\" size=\"60\" value=\"' +\r\n      getValue('hideRecipeNames') + '\"></td></tr>' +\r\n\r\n    simpleCheckbox('hideRelicOffline') +\r\n    simpleCheckbox('enterForSendMessage') +\r\n    simpleCheckbox('navigateToLogAfterMsg') +\r\n\r\n    '<tr><td align= \"right\">Max Group Size to Join' +\r\n      helpLink('Max Group Size to Join',\r\n        'This will disable HCSs Join All functionality and will only join ' +\r\n        'groups less than a set size. ') +\r\n      ':</td><td colspan=\"3\"><input name=\"enableMaxGroupSizeToJoin\" ' +\r\n      'type = \"checkbox\" value = \"on\"' +\r\n      isChecked(getValue('enableMaxGroupSizeToJoin')) +\r\n      '>&nbsp;&nbsp;Max Size: ' +\r\n      '<input name=\"maxGroupSizeToJoin\" size=\"3\" value=\"' +\r\n      getValue('maxGroupSizeToJoin') + '\"></td></tr>' +\r\n\r\n    simpleCheckbox('moveComposingButtons');\r\n}\r\n","import calf from '../support/calf';\r\nimport findNode from '../system/findNode';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport injectMonsterLog from '../monstorLog';\r\nimport injectNotepadShowLogs from '../combatLog';\r\nimport jConfirm from '../common/jConfirm';\r\nimport jQueryDialog from '../chrome/jQueryDialog';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {saveBoxes} from './settingObj';\r\nimport {sendEvent} from '../support/fshGa';\r\nimport setValue from '../system/setValue';\r\nimport setupConfigData from './configData';\r\nimport toggleVisibilty from '../common/toggleVisibilty';\r\nimport {createBr, createSpan} from '../common/cElement';\r\n\r\nfunction getVars() {\r\n  calf.showBuffs = getValue('showHuntingBuffs');\r\n  calf.buffs = getValue('huntingBuffs');\r\n  calf.buffsName = getValue('huntingBuffsName');\r\n  calf.buffs2 = getValue('huntingBuffs2');\r\n  calf.buffs2Name = getValue('huntingBuffs2Name');\r\n  calf.buffs3 = getValue('huntingBuffs3');\r\n  calf.buffs3Name = getValue('huntingBuffs3Name');\r\n  calf.doNotKillList = getValue('doNotKillList');\r\n\r\n  calf.bountyListRefreshTime = getValue('bountyListRefreshTime');\r\n  calf.wantedNames = getValue('wantedNames');\r\n  calf.combatEvaluatorBias = getValue('combatEvaluatorBias');\r\n  calf.enabledHuntingMode = getValue('enabledHuntingMode');\r\n  calf.storage = (JSON.stringify(localStorage).length /\r\n    (5 * 1024 * 1024) * 100).toFixed(2);\r\n}\r\n\r\nfunction toggleTickAllBuffs(e) { // jQuery\r\n  var allItems = $('input[name^=\"blockedSkillList\"]:visible',\r\n    '#settingsTabs-4');\r\n  var tckTxt = $(e.target);\r\n  allItems.prop('checked', tckTxt.text() === 'Tick all buffs');\r\n  if (tckTxt.text() === 'Tick all buffs') {\r\n    tckTxt.text('Untick all buffs');\r\n  } else {\r\n    tckTxt.text('Tick all buffs');\r\n  }\r\n}\r\n\r\nfunction clearStorage() {\r\n  jConfirm('Clear localStorage',\r\n    'Are you sure you want to clear you localStorage?',\r\n    function() {localStorage.clear();}\r\n  );\r\n}\r\n\r\nfunction saveValueForm(oForm, name) { // Legacy\r\n  var formElement =\r\n    findNode('//input[@name=\"' + name + '\"]', oForm);\r\n  if (formElement.getAttribute('type') === 'checkbox') {\r\n    setValue(name, formElement.checked);\r\n  } else {\r\n    setValue(name, formElement.value);\r\n  }\r\n}\r\n\r\nfunction setMaxCompressedCharacters(oForm) { // Legacy\r\n  var maxCompressedCharacters =\r\n    findNode('//input[@name=\"maxCompressedCharacters\"]', oForm);\r\n  var maxCompressedCharactersValue = Number(maxCompressedCharacters.value);\r\n  if (isNaN(maxCompressedCharactersValue) ||\r\n      maxCompressedCharactersValue <= 50) {\r\n    maxCompressedCharacters.value = 1500;\r\n  }\r\n}\r\n\r\nfunction setMaxCompressedLines(oForm) { // Legacy\r\n  var maxCompressedLines =\r\n    findNode('//input[@name=\"maxCompressedLines\"]', oForm);\r\n  var maxCompressedLinesValue = Number(maxCompressedLines.value);\r\n  if (isNaN(maxCompressedLinesValue) || maxCompressedLinesValue <= 1) {\r\n    maxCompressedLines.value = 25;\r\n  }\r\n}\r\n\r\nfunction setGuildLogHistoryPages(oForm) { // Legacy\r\n  var newGuildLogHistoryPages =\r\n    findNode('//input[@name=\"newGuildLogHistoryPages\"]', oForm);\r\n  var newGuildLogHistoryPagesValue = Number(newGuildLogHistoryPages.value);\r\n  if (isNaN(newGuildLogHistoryPagesValue) ||\r\n      newGuildLogHistoryPagesValue <= 1) {\r\n    newGuildLogHistoryPages.value = 25;\r\n  }\r\n}\r\n\r\nfunction setMaxGroupSizeToJoin(oForm) { // Legacy\r\n  var maxGroupSizeToJoin =\r\n    findNode('//input[@name=\"maxGroupSizeToJoin\"]', oForm);\r\n  var maxGroupSizeToJoinValue = Number(maxGroupSizeToJoin.value);\r\n  if (isNaN(maxGroupSizeToJoinValue) || maxGroupSizeToJoinValue <= 1) {\r\n    maxGroupSizeToJoin.value = 11;\r\n  }\r\n}\r\n\r\nfunction saveConfig(evt) { // Legacy\r\n  var oForm = evt.target.form;\r\n  // bio compressor validation logic\r\n  setMaxCompressedCharacters(oForm);\r\n  setMaxCompressedLines(oForm);\r\n  setGuildLogHistoryPages(oForm);\r\n  setMaxGroupSizeToJoin(oForm);\r\n  var combatEvaluatorBiasElement =\r\n    findNode('//select[@name=\"combatEvaluatorBias\"]', oForm);\r\n  var combatEvaluatorBias = Number(combatEvaluatorBiasElement.value);\r\n  setValue('combatEvaluatorBias', combatEvaluatorBias);\r\n  var enabledHuntingModeElement =\r\n    findNode('//select[@name=\"enabledHuntingMode\"]', oForm);\r\n  var enabledHuntingMode = enabledHuntingModeElement.value;\r\n  setValue('enabledHuntingMode', enabledHuntingMode);\r\n\r\n  saveBoxes.forEach(saveValueForm.bind(null, oForm));\r\n\r\n  $('#dialog_msg').text('FS Helper Settings Saved').dialog('open');\r\n}\r\n\r\nfunction showLogs() {\r\n  sendEvent('settingsPage', 'injectNotepadShowLogs');\r\n  jQueryDialog(injectNotepadShowLogs);\r\n}\r\n\r\nfunction showMonsterLogs() {\r\n  sendEvent('settingsPage', 'injectMonsterLog');\r\n  jQueryDialog(injectMonsterLog);\r\n}\r\n\r\nfunction createEventListeners() {\r\n  var tickAll = createSpan({\r\n    id: 'fshAllBuffs',\r\n    className: 'fshLink',\r\n    textContent: 'Tick all buffs'\r\n  });\r\n  tickAll.addEventListener('click', toggleTickAllBuffs);\r\n  var inject = getElementById('settingsTabs-4').firstElementChild\r\n    .rows[0].cells[0];\r\n  inject.appendChild(createBr());\r\n  inject.appendChild(tickAll);\r\n\r\n  getElementById('fshClearStorage')\r\n    .addEventListener('click', clearStorage);\r\n\r\n  getElementById('Helper:SaveOptions')\r\n    .addEventListener('click', saveConfig);\r\n  getElementById('Helper:ShowLogs')\r\n    .addEventListener('click', showLogs);\r\n  getElementById('Helper:ShowMonsterLogs')\r\n    .addEventListener('click', showMonsterLogs);\r\n\r\n  getElementById('toggleShowGuildSelfMessage')\r\n    .addEventListener('click', toggleVisibilty);\r\n  getElementById('toggleShowGuildFrndMessage')\r\n    .addEventListener('click', toggleVisibilty);\r\n  getElementById('toggleShowGuildPastMessage')\r\n    .addEventListener('click', toggleVisibilty);\r\n  getElementById('toggleShowGuildEnmyMessage')\r\n    .addEventListener('click', toggleVisibilty);\r\n}\r\n\r\nexport default function injectSettings() { // jQuery.min\r\n  if (jQueryNotPresent()) {return;}\r\n  getVars();\r\n  setupConfigData();\r\n  var settingsTabs = getElementById('settingsTabs');\r\n  settingsTabs.insertAdjacentHTML('beforeend', '<div id=\"fshSettings\">' +\r\n    calf.configData + '</div>');\r\n  if ($(settingsTabs).tabs('length') > 0) {\r\n    $(settingsTabs).tabs('add', '#fshSettings', 'FSH Settings');\r\n  }\r\n  createEventListeners();\r\n  setValue('minGroupLevel', getElementById('settingsTabs-1')\r\n    .firstElementChild.lastElementChild.rows[1].cells[1].firstElementChild\r\n    .value);\r\n}\r\n","import createDocument from '../system/createDocument';\r\nimport fallback from '../system/fallback';\r\nimport intValue from '../system/intValue';\r\nimport reduceBuffArray from './reduceBuffArray';\r\n\r\nfunction getStat(stat, doc) { // jQuery\r\n  // 'Hidden' returns NaN\r\n  return intValue(\r\n    $(stat, doc)\r\n      .contents()\r\n      .filter(function(i, e) {\r\n        return e.nodeType === 3;\r\n      })[0].nodeValue\r\n  );\r\n}\r\n\r\nfunction getBuffLevel(doc, buff) { // jQuery\r\n  var hasBuff = $('img.tip-static[data-tipped*=\"b>' + buff + '</b\"]', doc)\r\n    .data('tipped');\r\n  // var re = new RegExp('</b> \\\\(Level: (\\\\d+)\\\\)');\r\n  var test = /<\\/b> \\(Level: (\\d+)\\)/.exec(hasBuff);\r\n  if (test) {return intValue(test[1]);}\r\n  return 0;\r\n}\r\n\r\nfunction getBonus(stat, doc) { // jQuery\r\n  var target = $(stat, doc);\r\n  var children = target.children();\r\n  if (children.length === 0) {\r\n    children = target.next();\r\n  }\r\n  return intValue(children.text().slice(2, -1));\r\n}\r\n\r\nfunction cloakGuess(bonus, level) {\r\n  if (bonus > level * 10 ||\r\n      bonus < level) {\r\n    return bonus;\r\n  }\r\n  return level * 10;\r\n}\r\n\r\nfunction updateForCloak(obj) {\r\n  obj.attackValue = cloakGuess(obj.attackBonus, obj.levelValue);\r\n  obj.defenseValue = cloakGuess(obj.defenseBonus, obj.levelValue);\r\n  obj.armorValue = cloakGuess(obj.armorBonus, obj.levelValue);\r\n  obj.damageValue = cloakGuess(obj.damageBonus, obj.levelValue);\r\n  obj.hpValue = obj.hpBonus;\r\n}\r\n\r\nfunction attackValueIsNumber(atk) {\r\n  return typeof atk === 'number' && !isNaN(atk);\r\n}\r\n\r\nexport function playerDataString(responseText) {\r\n  var doc = createDocument(responseText);\r\n  var obj = {\r\n    levelValue: getStat('#stat-vl', doc),\r\n    attackValue: getStat('#stat-attack', doc),\r\n    attackBonus: getBonus('#stat-attack', doc),\r\n    defenseValue: getStat('#stat-defense', doc),\r\n    defenseBonus: getBonus('#stat-defense', doc),\r\n    armorValue: getStat('#stat-armor', doc),\r\n    armorBonus: getBonus('#stat-armor', doc),\r\n    damageValue: getStat('#stat-damage', doc),\r\n    damageBonus: getBonus('#stat-damage', doc),\r\n    hpValue: getStat('#stat-hp', doc),\r\n    hpBonus: getBonus('#stat-hp', doc),\r\n    killStreakValue: getStat('#stat-kill-streak', doc),\r\n    // get buffs here later ... DD, CA, DC, Constitution, etc\r\n    counterAttackLevel: getBuffLevel(doc, 'Counter Attack'),\r\n    doublerLevel: getBuffLevel(doc, 'Doubler'),\r\n    deathDealerLevel: getBuffLevel(doc, 'Death Dealer'),\r\n    darkCurseLevel: getBuffLevel(doc, 'Dark Curse'),\r\n    holyFlameLevel: getBuffLevel(doc, 'Holy Flame'),\r\n    constitutionLevel: getBuffLevel(doc, 'Constitution'),\r\n    sanctuaryLevel: getBuffLevel(doc, 'Sanctuary'),\r\n    flinchLevel: getBuffLevel(doc, 'Flinch'),\r\n    nightmareVisageLevel: getBuffLevel(doc, 'Nightmare Visage'),\r\n    superEliteSlayerLevel: getBuffLevel(doc, 'Super Elite Slayer'),\r\n    fortitudeLevel: getBuffLevel(doc, 'Fortitude'),\r\n    chiStrikeLevel: getBuffLevel(doc, 'Chi Strike'),\r\n    terrorizeLevel: getBuffLevel(doc, 'Terrorize'),\r\n    barricadeLevel: getBuffLevel(doc, 'Barricade'),\r\n    reignOfTerrorLevel: getBuffLevel(doc, 'Reign Of Terror'),\r\n    anchoredLevel: getBuffLevel(doc, 'Anchored'),\r\n    severeConditionLevel: getBuffLevel(doc, 'Severe Condition'),\r\n    entrenchLevel: getBuffLevel(doc, 'Entrench'),\r\n    cloakLevel: getBuffLevel(doc, 'Cloak')\r\n  };\r\n  obj.superEliteSlayerMultiplier = Math.round(0.002 *\r\n    obj.superEliteSlayerLevel * 100) / 100;\r\n\r\n  if (obj.cloakLevel === 0 ||\r\n      attackValueIsNumber(obj.attackValue)) {\r\n    return obj;\r\n  }\r\n\r\n  updateForCloak(obj);\r\n  return obj;\r\n}\r\n\r\nfunction getBuffLvl(buffs, buff) {\r\n  return fallback(buffs[buff], 0);\r\n}\r\n\r\nexport function playerDataObject(json) {\r\n  var buffs = reduceBuffArray(json._skills);\r\n  var obj = {\r\n    levelValue: json.level,\r\n    attackValue: json.attack,\r\n    attackBonus: json.bonus_attack,\r\n    defenseValue: json.defense,\r\n    defenseBonus: json.bonus_defense,\r\n    armorValue: json.armor,\r\n    armorBonus: json.bonus_armor,\r\n    damageValue: json.damage,\r\n    damageBonus: json.bonus_damage,\r\n    hpValue: json.hp,\r\n    hpBonus: json.bonus_hp,\r\n    killStreakValue: intValue(json.killstreak),\r\n    // get buffs here later ... DD, CA, DC, Constitution, etc\r\n    counterAttackLevel: getBuffLvl(buffs, 'Counter Attack'),\r\n    doublerLevel: getBuffLvl(buffs, 'Doubler'),\r\n    deathDealerLevel: getBuffLvl(buffs, 'Death Dealer'),\r\n    darkCurseLevel: getBuffLvl(buffs, 'Dark Curse'),\r\n    holyFlameLevel: getBuffLvl(buffs, 'Holy Flame'),\r\n    constitutionLevel: getBuffLvl(buffs, 'Constitution'),\r\n    sanctuaryLevel: getBuffLvl(buffs, 'Sanctuary'),\r\n    flinchLevel: getBuffLvl(buffs, 'Flinch'),\r\n    nightmareVisageLevel: getBuffLvl(buffs, 'Nightmare Visage'),\r\n    superEliteSlayerLevel: getBuffLvl(buffs, 'Super Elite Slayer'),\r\n    fortitudeLevel: getBuffLvl(buffs, 'Fortitude'),\r\n    chiStrikeLevel: getBuffLvl(buffs, 'Chi Strike'),\r\n    terrorizeLevel: getBuffLvl(buffs, 'Terrorize'),\r\n    barricadeLevel: getBuffLvl(buffs, 'Barricade'),\r\n    reignOfTerrorLevel: getBuffLvl(buffs, 'Reign Of Terror'),\r\n    anchoredLevel: getBuffLvl(buffs, 'Anchored'),\r\n    severeConditionLevel: getBuffLvl(buffs, 'Severe Condition'),\r\n    entrenchLevel: getBuffLvl(buffs, 'Entrench'),\r\n    cloakLevel: getBuffLvl(buffs, 'Cloak')\r\n  };\r\n  if (obj.cloakLevel !== 0) {updateForCloak(obj);}\r\n  return obj;\r\n}\r\n","import callApp from '../callApp';\r\n\r\nexport default function guildView(guildId) {\r\n  return callApp({cmd: 'guild', subcmd: 'view', guild_id: guildId});\r\n}\r\n","import add from '../support/task';\r\nimport fallback from '../system/fallback';\r\nimport {getElementById} from '../common/getElement';\r\nimport getInventoryById from '../ajax/getInventoryById';\r\nimport insertElementBefore from '../common/insertElementBefore';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {createDiv, createTr} from '../common/cElement';\r\nimport {time, timeEnd} from '../support/debug';\r\n\r\nvar invItems;\r\n\r\nfunction getItemDiv() {\r\n  var itemDiv = getElementById('item-div');\r\n  if (!itemDiv) {\r\n    itemDiv = createDiv({id: 'item-div', className: 'itemDiv'});\r\n    var itemList = getElementById('item-list');\r\n    var oldItems = itemList.getElementsByTagName('table');\r\n    while (oldItems.length) {\r\n      oldItems[0].classList.add('fshBlock');\r\n      itemDiv.appendChild(oldItems[0]);\r\n    }\r\n    itemList.parentNode.insertBefore(itemDiv, itemList);\r\n  }\r\n  return itemDiv;\r\n}\r\n\r\nfunction shouldShow(hidden, all, hasFolder) {\r\n  return hidden && fallback(all, hasFolder);\r\n}\r\n\r\nfunction shouldHide(hidden, all, hasFolder) {\r\n  return !hidden && !all && !hasFolder;\r\n}\r\n\r\nfunction doHideFolder(evt) {\r\n  var folderid = evt.target.id;\r\n  var itemDiv = getItemDiv();\r\n  var items = itemDiv.getElementsByTagName('table');\r\n  Array.prototype.forEach.call(items, function(el) {\r\n    el.firstElementChild.lastElementChild.firstElementChild\r\n      .firstElementChild.checked = false;\r\n    var hidden = el.classList.contains('fshHide');\r\n    var all = folderid === 'folderid0';\r\n    var hasFolder = el.classList.contains(folderid);\r\n    if (shouldShow(hidden, all, hasFolder)) {\r\n      el.classList.remove('fshHide');\r\n      el.classList.add('fshBlock'); // show()\r\n    }\r\n    if (shouldHide(hidden, all, hasFolder)) {\r\n      el.classList.remove('fshBlock');\r\n      el.classList.add('fshHide'); // hide()\r\n    }\r\n  });\r\n}\r\n\r\nfunction hideFolder(evt) {\r\n  if (evt.target.nodeName === 'SPAN' &&\r\n      evt.target.id.indexOf('folderid') !== -1) {doHideFolder(evt);}\r\n}\r\n\r\nfunction doFolderHeaders(folders) {\r\n  var folderCell = '<td colspan=6>';\r\n  // append main folder\r\n  folderCell += '<span id=\"folderid0\" class=\"fshLink\" fid=0>All</span>' +\r\n    ' &ensp;<span id=\"folderid-1\" class=\"fshLink\" fid=\"-1\">Main</span>';\r\n  Object.keys(folders).forEach(function(key) {\r\n    folderCell += ' &ensp;<span id=\"folderid' + key +\r\n      '\" class=\"fshLink fshNoWrap\" fid=' + key + '>' +\r\n      folders[key] + '</span> ';\r\n  });\r\n  var foldersRow = createTr({\r\n    id: 'fshFolderSelect',\r\n    innerHTML: folderCell\r\n  });\r\n  foldersRow.addEventListener('click', hideFolder);\r\n  var el = getElementById('item-list').parentNode.parentNode;\r\n  el.insertAdjacentHTML('beforebegin', '<tr id=\"fshShowSTs\">' +\r\n    '<td align=\"center\" colspan=6>' +\r\n    '<label><input type=\"checkbox\" id=\"itemsInSt\" checked> ' +\r\n    'Select items in ST</label></td></tr>');\r\n  insertElementBefore(foldersRow, el);\r\n}\r\n\r\nfunction stColor(el, item) {\r\n  if (item.is_in_st) {\r\n    el.classList.add('isInST');\r\n  } else {el.classList.add('tradeItemMargin');}\r\n}\r\n\r\nfunction forEachInvItem(el) {\r\n  var checkbox = el.firstElementChild.lastElementChild.firstElementChild\r\n    .firstElementChild;\r\n  var item = invItems[checkbox.getAttribute('value')];\r\n  el.classList.add('folderid' + item.folder_id);\r\n  if (invItems.fshHasST) {stColor(el, item);}\r\n  checkbox.classList.add('itemid' + item.item_id);\r\n  checkbox.classList.add('itemtype' + item.type);\r\n}\r\n\r\nfunction processTrade(data) {\r\n\r\n  time('trade.processTrade');\r\n\r\n  invItems = data.items;\r\n  /* Highlight items in ST */\r\n  var nodeList = getElementById('item-list')\r\n    .getElementsByTagName('table');\r\n  Array.prototype.forEach.call(nodeList, forEachInvItem);\r\n  doFolderHeaders(data.folders);\r\n\r\n  timeEnd('trade.processTrade');\r\n\r\n}\r\n\r\nexport default function doFolders() { // jQuery.min // jQuery\r\n  if (jQueryNotPresent()) {return;}\r\n  getInventoryById().done(function(data) {\r\n    add(3, processTrade, [data]);\r\n  });\r\n}\r\n","import add from '../support/task';\r\nimport {colouredDots} from '../common/colouredDots';\r\nimport currentGuildId from '../common/currentGuildId';\r\nimport getUrlParameter from '../system/getUrlParameter';\r\nimport getValue from '../system/getValue';\r\nimport {lastActivityRE} from '../support/dataObj';\r\nimport {\r\n  calculateBoundaries,\r\n  gvgLowerLevel,\r\n  gvgUpperLevel,\r\n  pvpLowerLevel,\r\n  pvpUpperLevel\r\n} from '../common/levelHighlight';\r\nimport {guildXPLock, removeGuildAvyImgBorder} from './guildUtils';\r\n\r\nvar highlightPlayersNearMyLvl;\r\nvar highlightGvGPlayersNearMyLvl;\r\n\r\nfunction isPvpTarget(vlevel) {\r\n  return highlightPlayersNearMyLvl &&\r\n    vlevel >= pvpLowerLevel &&\r\n    vlevel <= pvpUpperLevel;\r\n}\r\n\r\nfunction isGvgTarget(vlevel) {\r\n  return highlightGvGPlayersNearMyLvl &&\r\n    vlevel >= gvgLowerLevel &&\r\n    vlevel <= gvgUpperLevel;\r\n}\r\n\r\nfunction isActive(el, tipped) {\r\n  var vlevel = Number(/VL:.+?(\\d+)/.exec(tipped)[1]);\r\n  var aRow = el.parentNode.parentNode;\r\n  if (isPvpTarget(vlevel)) {\r\n    aRow.classList.add('lvlHighlight');\r\n  } else if (isGvgTarget(vlevel)) {\r\n    aRow.classList.add('lvlGvGHighlight');\r\n  }\r\n}\r\n\r\nfunction highlightMembers(el) {\r\n  var tipped = el.dataset.tipped;\r\n  var lastActDays = lastActivityRE.exec(tipped)[1];\r\n  if (lastActDays < 7) {isActive(el, tipped);}\r\n}\r\n\r\nfunction dontHighlight() {\r\n  return Number(getUrlParameter('guild_id')) === currentGuildId() ||\r\n    !highlightPlayersNearMyLvl && !highlightGvGPlayersNearMyLvl;\r\n}\r\n\r\nexport default function injectViewGuild() {\r\n  add(3, colouredDots);\r\n  removeGuildAvyImgBorder();\r\n  guildXPLock();\r\n  highlightPlayersNearMyLvl = getValue('highlightPlayersNearMyLvl');\r\n  highlightGvGPlayersNearMyLvl = getValue('highlightGvGPlayersNearMyLvl');\r\n  if (dontHighlight()) {return;}\r\n  calculateBoundaries();\r\n  var memList = document.querySelectorAll(\r\n    '#pCC a[data-tipped*=\"<td>VL:</td>\"]');\r\n  Array.prototype.forEach.call(memList, highlightMembers);\r\n}\r\n","import add from '../support/task';\r\nimport calf from '../support/calf';\r\nimport {createTr} from '../common/cElement';\r\nimport {defaults} from '../support/dataObj';\r\nimport doFolders from './doFolders';\r\nimport fallback from '../system/fallback';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport jsonParse from '../common/jsonParse';\r\n\r\nfunction getHowMany(itemTables) {\r\n  var howMany = parseInt(getElementById('fshSendHowMany').value, 10);\r\n  if (isNaN(howMany)) {return itemTables.length;}\r\n  // maximum of 100 items in an ST\r\n  if (calf.subcmd !== '-') {return Math.min(100, howMany);}\r\n  return howMany;\r\n}\r\n\r\nfunction itemType(itemid, checkbox) {\r\n  return itemid === 'itemid-2' && checkbox.classList.contains('itemtype12');\r\n}\r\n\r\nfunction shouldBeChecked(itemid, checkbox) {\r\n  return itemid === 'itemid-1' ||\r\n    itemType(itemid, checkbox) ||\r\n    checkbox.classList.contains(itemid);\r\n}\r\n\r\nfunction canBeChecked(howMany, itemsInSt, el, itemid, checkbox) {\r\n  return howMany &&\r\n    fallback(itemsInSt, !el.classList.contains('isInST')) &&\r\n    shouldBeChecked(itemid, checkbox);\r\n}\r\n\r\nfunction doCheckAll(evt) {\r\n  var itemid = evt.target.id;\r\n  var itemList = getElementById('item-div') ||\r\n    getElementById('item-list');\r\n  var itemTables = itemList.querySelectorAll('table:not(.fshHide)');\r\n  //#if _BETA  //  sendClasses\r\n  console.log('itemTables', itemTables); // eslint-disable-line no-console\r\n  //#endif\r\n  var howMany = getHowMany(itemTables);\r\n  var itemsInSt = getElementById('itemsInSt').checked;\r\n  Array.prototype.forEach.call(itemTables, function(el) {\r\n    var checkbox = el.firstElementChild.lastElementChild.firstElementChild\r\n      .firstElementChild;\r\n    if (canBeChecked(howMany, itemsInSt, el, itemid, checkbox)) {\r\n      checkbox.checked = true;\r\n      howMany -= 1;\r\n      return;\r\n    }\r\n    checkbox.checked = false;\r\n  });\r\n}\r\n\r\nfunction toggleAllPlants(evt) {\r\n  //#if _BETA  //  sendClasses\r\n  console.log('toggleAllPlants', evt.target.className); // eslint-disable-line no-console\r\n  //#endif\r\n  if (evt.target.classList.contains('fshCheckAll')) {doCheckAll(evt);}\r\n}\r\n\r\nfunction getItemList() {\r\n  var sendClasses = getValue('sendClasses');\r\n  var itemList = jsonParse('[' + sendClasses + ']');\r\n  if (itemList) {return itemList;}\r\n  return jsonParse('[' + defaults.sendClasses + ']');\r\n}\r\n\r\nfunction injectTradeOld() {\r\n  var myTd = '<td colspan=6>Select:&ensp;<span id=\"itemid-1\" ' +\r\n    'class=\"fshCheckAll fshLink fshNoWrap\">All Items</span> &ensp;' +\r\n    '<span id=\"itemid-2\" ' +\r\n    'class=\"fshCheckAll fshLink fshNoWrap\">All Resources</span>';\r\n  var itemList = getItemList();\r\n  itemList.forEach(function(el) {\r\n    myTd += ' &ensp;<span id=\"itemid' + el[1] +\r\n      '\" class=\"fshCheckAll fshLink fshNoWrap\">' + el[0] + '</span>';\r\n  });\r\n  myTd += ' &ensp;How&nbsp;many:<input id=\"fshSendHowMany\" type=\"text\" ' +\r\n    'class=\"custominput\" value=\"all\" size=3></td>';\r\n  var multiple = createTr({\r\n    id: 'fshSelectMultiple',\r\n    innerHTML: myTd\r\n  });\r\n  multiple.addEventListener('click', toggleAllPlants);\r\n  var el = getElementById('item-list').parentNode.parentNode;\r\n  el.parentNode.insertBefore(multiple, el);\r\n}\r\n\r\nexport default function injectTrade() {\r\n  add(3, doFolders);\r\n  add(3, injectTradeOld);\r\n}\r\n","import {def_suffixSuccessActionResponse} from '../support/dataObj';\r\nimport getForage from '../ajax/getForage';\r\nimport getValue from '../system/getValue';\r\nimport setForage from '../ajax/setForage';\r\n\r\n// Taking the Not Save in case they add new enhancements.\r\nvar notSave = ['Breaker', 'Protection', 'Master Thief', 'Protect Gold',\r\n  'Disarm', 'Duelist', 'Thievery', 'Master Blacksmith', 'Master Crafter',\r\n  'Fury Caster', 'Master Inventor', 'Sustain'];\r\nvar combatLog = [];\r\nvar combatData;\r\n\r\nfunction storeBuffs(buff) {\r\n  if (buff.id === 54 || buff.id === 26) {\r\n    combatData.player.buffs[buff.id] = parseInt(buff.level, 10);\r\n  }\r\n}\r\n\r\nfunction storeEnhancements(enh) {\r\n  if (notSave.indexOf(enh.name) === -1) {\r\n    combatData.player.enhancements[enh.name] = enh.value;\r\n  }\r\n}\r\n\r\nfunction hazBuffs(data) {\r\n  if (data.player.buffs) {\r\n    data.player.buffs.forEach(storeBuffs); // loop through buffs, only need to keep CA and Doubler 54 = ca, 26 = doubler\r\n  }\r\n}\r\n\r\nfunction hazEnhancements(data) {\r\n  if (data.player.enhancements) {\r\n    data.player.enhancements.forEach(storeEnhancements); // loop through enhancements\r\n  }\r\n}\r\n\r\nfunction processCombatResponse(e, data) {\r\n  combatData = {};\r\n  combatData.combat = data.response.data;\r\n  if (combatData.combat.inventory_id) {\r\n    combatData.combat.drop = combatData.combat.item.id;\r\n  }\r\n\r\n  combatData.player = {};\r\n  combatData.player.buffs = {};\r\n  combatData.player.enhancements = {};\r\n  hazBuffs(data);\r\n  hazEnhancements(data);\r\n  combatData.time = data.time;\r\n  combatLog.push(combatData);\r\n  setForage('fsh_combatLog', combatLog);\r\n}\r\n\r\nfunction combatResponse(e, data) {\r\n  // If bad response do nothing.\r\n  if (data.response.response === 0) {processCombatResponse(e, data);}\r\n}\r\n\r\nfunction gotCombatLog(data) { // jQuery.min\r\n  if (data) {combatLog = data;}\r\n  $.subscribe('2' + def_suffixSuccessActionResponse, combatResponse);\r\n}\r\n\r\nexport default function combatLogger() { // jQuery.min\r\n  if (getValue('keepLogs')) {\r\n    getForage('fsh_combatLog').done(gotCombatLog);\r\n  }\r\n}\r\n","import calf from '../support/calf';\r\nimport {def_afterUpdateActionlist} from '../support/dataObj';\r\nimport {getElementById} from '../common/getElement';\r\n\r\nvar oldDoAction;\r\n\r\nexport function afterUpdateActionList() {\r\n  // color the critters in the do no kill list blue\r\n  var act = getElementById('actionList');\r\n  var creatures = act.getElementsByClassName('creature');\r\n  Array.prototype.forEach.call(creatures, function(el) {\r\n    el.classList.toggle('fshBlue',\r\n      calf.doNotKillList.indexOf(el.textContent) !== -1);\r\n  });\r\n}\r\n\r\nvar actionsToIntercept = {\r\n  // def_creatureCombat\r\n  '2': function(action, fetch, data, attempts) {\r\n    // Do custom stuff e.g. do not kill list\r\n    var creatureName = GameData.actions()[data.passback].data.name;\r\n    if (calf.doNotKillList.indexOf(creatureName) !== -1) {\r\n      $('#actionList div.header').eq(data.passback)\r\n        .find('a.icon').removeClass('loading');\r\n      return;\r\n    }\r\n    // Call standard action\r\n    oldDoAction(action, fetch, data, attempts);\r\n  }\r\n};\r\n\r\nfunction firstAttempt(attempts) {\r\n  return typeof attempts === 'undefined' || attempts === 0;\r\n}\r\n\r\nfunction goodInterceptFunction(interceptFunction) {\r\n  return interceptFunction && typeof interceptFunction === 'function';\r\n}\r\n\r\nfunction maybeIntercept(action, fetch, data, attempts) {\r\n  var interceptFunction = actionsToIntercept[action];\r\n  if (goodInterceptFunction(interceptFunction) && firstAttempt(attempts)) {\r\n    interceptFunction(action, fetch, data, attempts);\r\n  } else {\r\n    oldDoAction(action, fetch, data, attempts);\r\n  }\r\n}\r\n\r\nfunction interceptDoAction() {\r\n  oldDoAction = GameData.doAction;\r\n  GameData.doAction = maybeIntercept;\r\n}\r\n\r\nexport default function doNotKill() {\r\n  $.subscribe(def_afterUpdateActionlist, afterUpdateActionList);\r\n  afterUpdateActionList();\r\n  // then intercept the action call\r\n  interceptDoAction();\r\n}\r\n","export var atkStats = '<table class=\"relicT relicS\"><thead>' +\r\n  '<tr><th colspan=\"2\">Adjusted defense values</th></tr></thead><tbody>' +\r\n  '<tr><td>DC225:</td><td id=\"DC225\">0</td></tr>' +\r\n  '<tr><td>DC175:</td><td id=\"DC175\">0</td></tr>' +\r\n  '<tr><td colspan=\"2\">&nbsp;</td></tr></tbody><thead>' +\r\n  '<tr><th colspan=\"2\">Attacking Group Stats</th></tr></thead><tbody>' +\r\n  '<tr><td>Raw Group Attack:</td>' +\r\n    '<td class=\"fshGrey\" id=\"GroupAttack\"></td></tr>' +\r\n  '<tr><td>Group Attack w/ buffs:</td><td id=\"GroupAttackBuffed\"></td></tr>' +\r\n  '<tr><td>Raw Group Defense:</td>' +\r\n    '<td class=\"fshGrey\" id=\"GroupDefense\"></td></tr>' +\r\n  '<tr><td>Group Defense w/ buffs:</td>' +\r\n    '<td id=\"GroupDefenseBuffed\"></td></tr>' +\r\n  '<tr><td>Raw Group Armor:</td>' +\r\n    '<td class=\"fshGrey\" id=\"GroupArmor\"></td></tr>' +\r\n  '<tr><td>Group Armor w/ buffs:</td><td id=\"GroupArmorBuffed\"></td></tr>' +\r\n  '<tr><td>Raw Group Damage:</td>' +\r\n    '<td class=\"fshGrey\" id=\"GroupDamage\"></td></tr>' +\r\n  '<tr><td>Group Damage w/ buffs:</td><td id=\"GroupDamageBuffed\"></td></tr>' +\r\n  '<tr><td>Raw Group HP:</td><td class=\"fshGrey\" id=\"GroupHP\"></td></tr>' +\r\n  '<tr><td>Group HP w/ buffs:</td><td id=\"GroupHPBuffed\"></td></tr>' +\r\n  '</tbody></table>';\r\nexport var defStats = '<table class=\"relicT relicS\"><thead>' +\r\n  '<tr><th colspan=\"2\">Defending Guild Stats</th></tr></thead><tbody>' +\r\n  '<tr><td>Relic Count:</td><td id=\"relicCount\">0</td></tr>' +\r\n  '<tr><td>Lead Defender Bonus:</td><td id=\"LDPercentage\">0</td></tr>' +\r\n  '<tr><td>Lead Defender Cloaked:</td><td id=\"LDCloaked\">No</td></tr>' +\r\n  '</tbody><thead><tr><th colspan=\"2\">Other Defender Stats</th></tr>' +\r\n  '</thead><tbody>' +\r\n  '<tr><td>Raw Attack:</td><td class=\"fshGrey\" id=\"attackValue\">0</td></tr>' +\r\n  '<tr><td>Attack w/ buffs:</td><td id=\"attackValueBuffed\">0</td></tr>' +\r\n  '<tr><td>Raw Defense:</td>' +\r\n    '<td class=\"fshGrey\" id=\"defenseValue\">0</td></tr>' +\r\n  '<tr><td>Defense w/buffs:</td><td id=\"defenseValueBuffed\">0</td></tr>' +\r\n  '<tr><td>Raw Armor:</td><td class=\"fshGrey\" id=\"armorValue\">0</td></tr>' +\r\n  '<tr><td>Armor w/ buffs:</td><td id=\"armorValueBuffed\">0</td></tr>' +\r\n  '<tr><td>Raw Damage:</td><td class=\"fshGrey\" id=\"damageValue\">0</td></tr>' +\r\n  '<tr><td>Damage w/ buffs:</td><td id=\"damageValueBuffed\">0</td></tr>' +\r\n  '<tr><td>Raw HP:</td><td class=\"fshGrey\" id=\"hpValue\">0</td></tr>' +\r\n  '<tr><td>HP w/ buffs:</td><td id=\"hpValueBuffed\">0</td></tr>' +\r\n  '<tr><td>Cloaked:</td><td id=\"defendersCloaked\">0</td></tr>' +\r\n  '<tr><td>Processed:</td><td id=\"defendersProcessed\">0</td></tr>' +\r\n  '</tbody></table>';\r\nexport var proc = '<table class=\"relicT\">' +\r\n  '<thead><tr><th colspan=\"2\">Processing</th></tr></thead><tbody>' +\r\n  '<tr><td class=\"fshGreen\" colspan=\"2\" id=\"ProcessingStatus\">' +\r\n    'Parsing defending guild stats ...</td></tr>' +\r\n  '</tbody><thead><tr><th colspan=\"2\">Assumptions</th></tr></thead><tbody>' +\r\n  '<tr><td colspan=\"2\" class=\"fshGrey\">Above calculations include ' +\r\n    'Constitution, Fortitude, Nightmare Visage, Chi Strike, Sanctuary, ' +\r\n    'Terrorize and Flinch bonus calculations (in that order) on both the ' +\r\n    'defending group and attacking group.</td></tr>' +\r\n  '</tbody></table>';\r\n","import doBuffLinks from '../../common/doBuffLinks';\r\nimport {getElementById} from '../../common/getElement';\r\nimport {createButton, createDiv} from '../../common/cElement';\r\n\r\nexport var containerDiv;\r\nexport var leftDiv;\r\nexport var fetchStatsBtn;\r\nexport var myDefenders;\r\n\r\nexport function defendersSetup(relicData) {\r\n  myDefenders = relicData.defenders.map(function(x) {\r\n    return x.player_name;\r\n  });\r\n}\r\n\r\nexport function primaryElementsSetup(relicData) {\r\n  defendersSetup(relicData);\r\n  if (containerDiv) {\r\n    containerDiv.innerHTML = '';\r\n  } else {\r\n    containerDiv = createDiv({className: 'body'});\r\n  }\r\n  leftDiv = createDiv({className: 'fshFloatLeft fshRelicLeftDiv'});\r\n  containerDiv.appendChild(leftDiv);\r\n  if (relicData.is_owner) {\r\n    leftDiv.appendChild(doBuffLinks(myDefenders));\r\n  }\r\n  fetchStatsBtn = createButton({\r\n    className: 'custombutton',\r\n    textContent: 'Fetch Stats'\r\n  });\r\n  leftDiv.appendChild(fetchStatsBtn);\r\n  var dialogRelic = getElementById('dialog-relic');\r\n  dialogRelic.appendChild(containerDiv);\r\n}\r\n","import {createDiv} from '../../common/cElement';\r\nimport {getElementById} from '../../common/getElement';\r\nimport getMembrList from '../../ajax/getMembrList';\r\nimport getValue from '../../system/getValue';\r\nimport {nowSecs} from '../../support/dataObj';\r\nimport {atkStats, defStats, proc} from './assets';\r\nimport {\r\n  containerDiv,\r\n  fetchStatsBtn,\r\n  leftDiv,\r\n  myDefenders\r\n} from './primaryElements';\r\n\r\nvar guildMemberList;\r\nvar twoMinutes;\r\nvar sevenDays;\r\nvar memberExclusions = [\r\n  function(key) {return key === 'lastUpdate';},\r\n  function(key) {return myDefenders.indexOf(key) !== -1;},\r\n  function(key) {return !guildMemberList[key].last_login;},\r\n  function(key) {return Number(guildMemberList[key].last_login) >= twoMinutes;},\r\n  function(key) {return Number(guildMemberList[key].last_login) <= sevenDays;},\r\n  function(key) {\r\n    return guildMemberList[key].level >= 400 &&\r\n      guildMemberList[key].level <= 421;\r\n  },\r\n  function(key) {\r\n    return guildMemberList[key].level >= 441 &&\r\n      guildMemberList[key].level <= 450;\r\n  }\r\n];\r\nexport var relicCountElement;\r\nexport var lDPercentageElement;\r\nexport var lDCloakedElement;\r\nexport var attackElement;\r\nexport var attackBuffedElement;\r\nexport var defenseElement;\r\nexport var defenseBuffedElement;\r\nexport var armorElement;\r\nexport var armorBuffedElement;\r\nexport var damageElement;\r\nexport var damageBuffedElement;\r\nexport var hpElement;\r\nexport var hpBuffedElement;\r\nexport var defCloakedElement;\r\nexport var defProcessedElement;\r\nexport var dc225Element;\r\nexport var dc175Element;\r\nexport var groupAttackElement;\r\nexport var groupAttackBuffedElement;\r\nexport var groupDefenseElement;\r\nexport var groupDefenseBuffedElement;\r\nexport var groupArmorElement;\r\nexport var groupArmorBuffedElement;\r\nexport var groupDamageElement;\r\nexport var groupDamageBuffedElement;\r\nexport var groupHPElement;\r\nexport var groupHPBuffedElement;\r\nexport var processingStatus;\r\n\r\nfunction missingMembers(membrList) {\r\n  guildMemberList = membrList;\r\n  var myMembers = Object.keys(guildMemberList);\r\n  twoMinutes = nowSecs - 120;\r\n  sevenDays = nowSecs - 604800;\r\n  var filtered = myMembers.reduce(function(prev, key) {\r\n    for (var i = 0; i < memberExclusions.length; i += 1) {\r\n      if (memberExclusions[i](key)) {return prev;}\r\n    }\r\n    prev.push('<a href=\"index.php?cmd=profile&player_id=' +\r\n      guildMemberList[key].id + '\">' + key + '</a>');\r\n    return prev;\r\n  }, []);\r\n  containerDiv.insertAdjacentHTML('beforeend',\r\n    '<div class=\"fshFloatLeft fshRelicLowDiv\"><table class=\"relicT\">' +\r\n    '<thead><tr><th>Offline guild members not at relic:</th></tr></thead>' +\r\n    '<tbody><tr><td>' + filtered.join(' ') + '</td></tr></tbody>' +\r\n    '</table></div>');\r\n}\r\n\r\nfunction setDefVars() {\r\n  relicCountElement = getElementById('relicCount');\r\n  lDPercentageElement = getElementById('LDPercentage');\r\n  lDCloakedElement = getElementById('LDCloaked');\r\n  attackElement = getElementById('attackValue');\r\n  attackBuffedElement = getElementById('attackValueBuffed');\r\n  defenseElement = getElementById('defenseValue');\r\n  defenseBuffedElement = getElementById('defenseValueBuffed');\r\n  armorElement = getElementById('armorValue');\r\n  armorBuffedElement = getElementById('armorValueBuffed');\r\n  damageElement = getElementById('damageValue');\r\n  damageBuffedElement = getElementById('damageValueBuffed');\r\n  hpElement = getElementById('hpValue');\r\n  hpBuffedElement = getElementById('hpValueBuffed');\r\n  defCloakedElement = getElementById('defendersCloaked');\r\n  defProcessedElement = getElementById('defendersProcessed');\r\n}\r\n\r\nfunction setAtkVars() {\r\n  dc225Element = getElementById('DC225');\r\n  dc175Element = getElementById('DC175');\r\n  groupAttackElement = getElementById('GroupAttack');\r\n  groupAttackBuffedElement = getElementById('GroupAttackBuffed');\r\n  groupDefenseElement = getElementById('GroupDefense');\r\n  groupDefenseBuffedElement = getElementById('GroupDefenseBuffed');\r\n  groupArmorElement = getElementById('GroupArmor');\r\n  groupArmorBuffedElement = getElementById('GroupArmorBuffed');\r\n  groupDamageElement = getElementById('GroupDamage');\r\n  groupDamageBuffedElement = getElementById('GroupDamageBuffed');\r\n  groupHPElement = getElementById('GroupHP');\r\n  groupHPBuffedElement = getElementById('GroupHPBuffed');\r\n}\r\n\r\nexport function prepareSecondaryDivs(relicData) {\r\n  fetchStatsBtn.classList.add('fshHide');\r\n  var hideRelicOffline = getValue('hideRelicOffline');\r\n  if (relicData.is_owner && !hideRelicOffline) {\r\n    getMembrList(false).done(missingMembers);\r\n  }\r\n  leftDiv.insertAdjacentHTML('beforeend', proc);\r\n  processingStatus = getElementById('ProcessingStatus');\r\n  var midDiv = createDiv({\r\n    className: 'fshFloatLeft fshRelicMidDiv',\r\n    innerHTML: defStats\r\n  });\r\n  containerDiv.appendChild(midDiv);\r\n  setDefVars();\r\n  var rightDiv = createDiv({\r\n    className: 'fshFloatLeft fshRelicRightDiv',\r\n    innerHTML: atkStats\r\n  });\r\n  containerDiv.appendChild(rightDiv);\r\n  setAtkVars();\r\n}\r\n","import createDocument from '../../system/createDocument';\r\nimport {lDPercentageElement, relicCountElement} from './secondaryElements';\r\n\r\nexport var relicMultiplier;\r\n\r\nfunction calcRelicMultiplier(rels) {\r\n  if (rels === 1) {return 1.5;}\r\n  return Math.round((1 - rels / 10) * 100) / 100;\r\n}\r\n\r\nexport function parseGuild(html) {\r\n  var doc = createDocument(html);\r\n  var nodeList = doc.querySelectorAll('#pCC img[src*=\"/relics/\"]');\r\n  var relicCount = nodeList.length;\r\n  relicCountElement.textContent = relicCount.toString();\r\n  relicMultiplier = calcRelicMultiplier(relicCount);\r\n  lDPercentageElement.textContent = (relicMultiplier * 100).toString() + '%';\r\n}\r\n","import addCommas from '../../system/addCommas';\r\nimport {defenderMultiplier} from '../../support/dataObj';\r\nimport fallback from '../../system/fallback';\r\nimport {playerDataObject} from '../../common/common';\r\nimport reduceBuffArray from '../../common/reduceBuffArray';\r\nimport {relicMultiplier} from './parseGuild';\r\nimport {\r\n  armorBuffedElement,\r\n  armorElement,\r\n  attackBuffedElement,\r\n  attackElement,\r\n  damageBuffedElement,\r\n  damageElement,\r\n  dc175Element,\r\n  dc225Element,\r\n  defCloakedElement,\r\n  defProcessedElement,\r\n  defenseBuffedElement,\r\n  defenseElement,\r\n  groupArmorBuffedElement,\r\n  groupArmorElement,\r\n  groupAttackBuffedElement,\r\n  groupAttackElement,\r\n  groupDamageBuffedElement,\r\n  groupDamageElement,\r\n  groupDefenseBuffedElement,\r\n  groupDefenseElement,\r\n  groupHPBuffedElement,\r\n  groupHPElement,\r\n  hpBuffedElement,\r\n  hpElement,\r\n  lDCloakedElement,\r\n  processingStatus\r\n} from './secondaryElements';\r\n\r\nvar defRawAttack;\r\nvar defBuffedAttack;\r\nvar defRawDefense;\r\nvar defRawArmor;\r\nvar defRawDamage;\r\nvar defBuffedDamage;\r\nvar defRawHp;\r\nvar defCloaked;\r\nvar defProcessed;\r\nvar leadDefender;\r\nvar groupStats;\r\nvar mercStats;\r\n\r\nfunction deductMercStats() {\r\n  groupStats.attack -= mercStats.attack;\r\n  groupStats.defense -= mercStats.defense;\r\n  groupStats.armor -= mercStats.armor;\r\n  groupStats.damage -= mercStats.damage;\r\n  groupStats.hp -= mercStats.hp;\r\n}\r\n\r\nfunction updateDefValues() {\r\n  attackElement.textContent = addCommas(defRawAttack);\r\n  defenseElement.textContent = addCommas(defRawDefense);\r\n  armorElement.textContent = addCommas(defRawArmor);\r\n  damageElement.textContent = addCommas(defRawDamage);\r\n  hpElement.textContent = addCommas(defRawHp);\r\n  defCloakedElement.textContent = defCloaked.toString();\r\n  defProcessed += 1;\r\n  defProcessedElement.textContent = defProcessed.toString();\r\n}\r\n\r\nfunction calculateGroup() {\r\n  processingStatus.textContent = 'Processing attacking group stats ... ';\r\n  if (mercStats) {deductMercStats();}\r\n  groupAttackElement.textContent = addCommas(groupStats.attack);\r\n  groupDefenseElement.textContent = addCommas(groupStats.defense);\r\n  groupArmorElement.textContent = addCommas(groupStats.armor);\r\n  groupDamageElement.textContent = addCommas(groupStats.damage);\r\n  groupHPElement.textContent = addCommas(groupStats.hp);\r\n\r\n  var buffs = reduceBuffArray(GameData.player().buffs);\r\n\r\n  var nightmareVisageEffect = Math.ceil(groupStats.attack *\r\n    (fallback(buffs['Nightmare Visage'], 0) * 0.0025));\r\n  groupStats.attack -= nightmareVisageEffect;\r\n\r\n  var storedFlinchEffectValue = Math.ceil(groupStats.attack *\r\n    leadDefender.flinchLevel * 0.001);\r\n  groupAttackBuffedElement.textContent = addCommas(groupStats.attack -\r\n    storedFlinchEffectValue);\r\n\r\n  var defenseWithConstitution = Math.ceil(groupStats.defense *\r\n    (1 + fallback(buffs.Constitution, 0) * 0.001));\r\n  var totalDefense = defenseWithConstitution + nightmareVisageEffect;\r\n  groupDefenseBuffedElement.textContent = addCommas(totalDefense);\r\n\r\n  groupArmorBuffedElement.textContent = addCommas(groupStats.armor +\r\n    Math.floor(groupStats.armor * fallback(buffs.Sanctuary, 0) * 0.001));\r\n\r\n  var fortitudeBonusHP = Math.ceil(defenseWithConstitution *\r\n    fallback(buffs.Fortitude, 0) * 0.001);\r\n  var chiStrikeBonusDamage = Math.ceil((groupStats.hp + fortitudeBonusHP) *\r\n    fallback(buffs['Chi Strike'], 0) * 0.001);\r\n  var storedTerrorizeEffectValue = Math.ceil(\r\n    groupStats.damage * leadDefender.terrorizeLevel * 0.001);\r\n  groupDamageBuffedElement.textContent = addCommas(groupStats.damage +\r\n    chiStrikeBonusDamage - storedTerrorizeEffectValue);\r\n  groupHPBuffedElement.textContent = addCommas(groupStats.hp +\r\n    fortitudeBonusHP);\r\n\r\n  // Effect on defending group from Flinch on attacking group.\r\n  var flinchEffectValue = Math.ceil(defBuffedAttack *\r\n    fallback(buffs.Flinch, 0) * 0.001);\r\n  defenseBuffedElement.textContent = addCommas(defBuffedAttack -\r\n    flinchEffectValue);\r\n  var terrorizeEffectValue = Math.ceil(defBuffedDamage *\r\n    fallback(buffs.Terrorize, 0) * 0.001);\r\n  damageBuffedElement.textContent = addCommas(defBuffedDamage -\r\n    terrorizeEffectValue);\r\n\r\n  processingStatus.textContent = 'Done.';\r\n}\r\n\r\nexport function doCalculations() {\r\n  processingStatus.textContent = 'Processing defending guild stats ... ';\r\n\r\n  defRawAttack += Math.round(leadDefender.attackValue * relicMultiplier);\r\n  var nightmareVisageEffect = Math.ceil(defRawAttack *\r\n    (leadDefender.nightmareVisageLevel * 0.0025));\r\n\r\n  defRawDefense += Math.round(leadDefender.defenseValue * relicMultiplier);\r\n  var defenseWithConstitution = Math.ceil(defRawDefense *\r\n    (1 + leadDefender.constitutionLevel * 0.001));\r\n  var defBuffedDefense = defenseWithConstitution + nightmareVisageEffect;\r\n\r\n  defRawArmor += Math.round(leadDefender.armorValue * relicMultiplier);\r\n\r\n  defRawDamage += Math.round(leadDefender.damageValue * relicMultiplier);\r\n  defRawHp += Math.round(leadDefender.hpValue * relicMultiplier);\r\n  var fortitudeBonusHP = Math.ceil(defenseWithConstitution *\r\n    leadDefender.fortitudeLevel * 0.001);\r\n  var defBuffedHp = defRawHp + fortitudeBonusHP;\r\n  var chiStrikeBonusDamage = Math.ceil(defBuffedHp *\r\n    leadDefender.chiStrikeLevel * 0.001);\r\n\r\n  updateDefValues();\r\n\r\n  defBuffedAttack = defRawAttack - nightmareVisageEffect;\r\n  attackBuffedElement.textContent = addCommas(defBuffedAttack);\r\n  defenseBuffedElement.textContent = addCommas(defBuffedDefense);\r\n  dc225Element.textContent = addCommas(Math.ceil(\r\n    defBuffedDefense * 0.55));\r\n  dc175Element.textContent = addCommas(Math.ceil(\r\n    defBuffedDefense * 0.65));\r\n  armorBuffedElement.textContent = addCommas(defRawArmor +\r\n    Math.floor(defRawArmor * leadDefender.sanctuaryLevel * 0.001));\r\n  defBuffedDamage = defRawDamage + chiStrikeBonusDamage;\r\n  damageBuffedElement.textContent = addCommas(defBuffedDamage);\r\n  hpBuffedElement.textContent = addCommas(defBuffedHp);\r\n\r\n  if (leadDefender.cloakLevel !== 0) {\r\n    lDCloakedElement.textContent = 'Yes';\r\n  }\r\n\r\n  if (GameData.player().hasGroup) {\r\n    calculateGroup();\r\n  } else {\r\n    processingStatus.textContent = 'Done.';\r\n  }\r\n\r\n}\r\n\r\nexport function parseDefender(json) {\r\n  var defender = playerDataObject(json);\r\n  defRawAttack += Math.round(defender.attackValue * defenderMultiplier);\r\n  defRawDefense += Math.round(defender.defenseValue *\r\n    defenderMultiplier);\r\n  defRawArmor += Math.round(defender.armorValue * defenderMultiplier);\r\n  defRawDamage += Math.round(defender.damageValue * defenderMultiplier);\r\n  defRawHp += Math.round(defender.hpValue * defenderMultiplier);\r\n  if (defender.cloakLevel !== 0) {defCloaked += 1;}\r\n  updateDefValues();\r\n}\r\n\r\nexport function storeLeadDefender(json) {\r\n  leadDefender = playerDataObject(json);\r\n}\r\n\r\nexport function storeGroupStats(obj) {\r\n  groupStats = obj;\r\n}\r\n\r\nexport function storeMercStats(obj) {\r\n  mercStats = obj;\r\n}\r\n\r\nexport function resetCounters() {\r\n  defRawAttack = 0;\r\n  defRawDefense = 0;\r\n  defRawArmor = 0;\r\n  defRawDamage = 0;\r\n  defRawHp = 0;\r\n  defCloaked = 0;\r\n  defProcessed = 0;\r\n}\r\n","import createDocument from '../../system/createDocument';\r\nimport {def_suffixSuccessActionResponse} from '../../support/dataObj';\r\nimport getGroupStats from '../../ajax/getGroupStats';\r\nimport getMercStats from '../../ajax/getMercStats';\r\nimport getProfile from '../../ajax/getProfile';\r\nimport {parseGuild} from './parseGuild';\r\nimport retryAjax from '../../ajax/retryAjax';\r\nimport {\r\n  doCalculations,\r\n  parseDefender,\r\n  resetCounters,\r\n  storeGroupStats,\r\n  storeLeadDefender,\r\n  storeMercStats\r\n} from './calcs';\r\nimport {\r\n  fetchStatsBtn,\r\n  myDefenders,\r\n  primaryElementsSetup\r\n} from './primaryElements';\r\nimport {\r\n  prepareSecondaryDivs,\r\n  processingStatus\r\n} from './secondaryElements';\r\n\r\nvar relicData;\r\n\r\nfunction ajaxFailure(jqXHR) {\r\n  processingStatus.textContent = jqXHR.status.toString() + ' ' +\r\n    jqXHR.statusText;\r\n}\r\n\r\nfunction getGuild() {\r\n  return retryAjax({\r\n    url: 'index.php',\r\n    data: {\r\n      no_mobile: 1,\r\n      cmd: 'guild',\r\n      subcmd: 'view',\r\n      guild_id: relicData.controlled_by.guild_id\r\n    }\r\n  });\r\n}\r\n\r\nfunction getGroups() {\r\n  return retryAjax({\r\n    url: 'index.php',\r\n    data: {\r\n      no_mobile: 1,\r\n      cmd: 'guild',\r\n      subcmd: 'groups'\r\n    }\r\n  });\r\n}\r\n\r\nfunction parseGroups(html) {\r\n  var doc = createDocument(html);\r\n  var disband = doc.querySelector('#pCC a[href*=\"confirmDisband\"]');\r\n  var viewStats = disband.previousElementSibling.href;\r\n  var prm = [getGroupStats(viewStats).done(storeGroupStats)];\r\n  var hasMerc = disband.parentNode.parentNode.previousElementSibling\r\n    .previousElementSibling.innerHTML.indexOf('\"#000099\"') !== -1;\r\n  if (hasMerc) {\r\n    prm.push(getMercStats().done(storeMercStats));\r\n  }\r\n  return $.when.apply($, prm);\r\n}\r\n\r\nexport function getStats() {\r\n  prepareSecondaryDivs(relicData);\r\n  resetCounters();\r\n  var prm = [];\r\n  prm.push(getGuild().done(parseGuild));\r\n  if (GameData.player().hasGroup) {\r\n    prm.push(getGroups().pipe(parseGroups));\r\n  }\r\n  for (var i = 1; i < myDefenders.length; i += 1) {\r\n    prm.push(getProfile(myDefenders[i]).done(parseDefender)\r\n      .fail(ajaxFailure));\r\n  }\r\n  prm.push(getProfile(myDefenders[0]).done(storeLeadDefender));\r\n  $.when.apply($, prm).done(doCalculations);\r\n}\r\n\r\nfunction viewRelic(e, data) {\r\n  relicData = data.response.data;\r\n  if (relicData.defenders.length > 0) {\r\n    primaryElementsSetup(relicData);\r\n    fetchStatsBtn.addEventListener('click', getStats);\r\n  }\r\n}\r\n\r\nexport default function injectRelic() {\r\n  $.subscribe('9' + def_suffixSuccessActionResponse, viewRelic);\r\n}\r\n","export var colorHash = {\r\n  '0': 'red', // Should never see this.\r\n  '1': 'orange',\r\n  '2': 'yellow'\r\n};\r\n\r\nexport var bias = {\r\n  '0': {generalVariable: 1.1053, hpVariable: 1.1},\r\n  '1': {generalVariable: 1.1, hpVariable: 1.053},\r\n  '2': {generalVariable: 1.053, hpVariable: 1},\r\n  '3': {generalVariable: 1.1053, hpVariable: 1}\r\n};\r\n","export var realmName;\r\n\r\nexport function setRealm(data) {\r\n  realmName = data;\r\n}\r\n","import {createSpan} from '../../common/cElement';\r\n\r\nexport var currentHp;\r\nexport var maxHp;\r\nexport var guildKills;\r\nexport var currentPct;\r\nexport var totalPct;\r\nexport var statusText;\r\nexport var cooldownText;\r\n\r\nexport function initVars() {\r\n  currentHp = createSpan();\r\n  maxHp = createSpan();\r\n  guildKills = createSpan();\r\n  currentPct = createSpan();\r\n  totalPct = createSpan();\r\n  statusText = createSpan();\r\n  cooldownText = createSpan();\r\n}\r\n\r\nexport function clearTitanDiv() {\r\n  currentHp.textContent = '';\r\n  maxHp.textContent = '';\r\n  guildKills.textContent = '';\r\n  currentPct.textContent = '';\r\n  totalPct.textContent = '';\r\n  statusText.innerHTML = '';\r\n  cooldownText.innerHTML = '';\r\n}\r\n","import {addRows} from './common';\r\nimport insertElement from '../../common/insertElement';\r\nimport insertTextBeforeEnd from '../../common/insertTextBeforeEnd';\r\nimport {\r\n  cooldownText,\r\n  currentHp,\r\n  currentPct,\r\n  guildKills,\r\n  maxHp,\r\n  statusText,\r\n  totalPct\r\n} from './placeholders';\r\nimport {createSpan, createTable, textSpan} from '../../common/cElement';\r\n\r\nexport var titanTbl;\r\n\r\nexport function clearMemberRows() {\r\n  if (titanTbl.rows.length > 7) {\r\n    for (var i = 7; i < titanTbl.rows.length; i += 1) {\r\n      titanTbl.deleteRow(i);\r\n    }\r\n  }\r\n}\r\n\r\nfunction makeTitanHpWrapper() {\r\n  var titanHpWrapper = createSpan();\r\n  insertElement(titanHpWrapper, currentHp);\r\n  insertTextBeforeEnd(titanHpWrapper, '/');\r\n  insertElement(titanHpWrapper, maxHp);\r\n  return titanHpWrapper;\r\n}\r\n\r\nfunction makePctWrapper(pct) {\r\n  var pctWrapper = createSpan();\r\n  insertElement(pctWrapper, pct);\r\n  insertTextBeforeEnd(pctWrapper, '%');\r\n  return pctWrapper;\r\n}\r\n\r\nexport function buildTitanInfoTable() {\r\n  titanTbl = createTable({className: 'fshCenter'});\r\n  addRows(titanTbl, [\r\n    [[[2, textSpan('Titan HP'), true], [4, textSpan('Your Guild'), true]]],\r\n    [[[2, makeTitanHpWrapper()], [4, guildKills]]],\r\n    [[[2, textSpan('Current'), true], [4, makePctWrapper(currentPct)]], true],\r\n    [[[2, textSpan('Total'), true], [4, makePctWrapper(totalPct)]], true],\r\n    [[[2, textSpan('Status'), true], [4, statusText]], true],\r\n    [[[6, cooldownText]]],\r\n    [[[2, textSpan('Member'), true], [2, textSpan('Kills'), true],\r\n      [2, textSpan('% of Total'), true]]]\r\n  ]);\r\n}\r\n","import {createDiv} from '../../common/cElement';\r\nimport {getElementById} from '../../common/getElement';\r\nimport insertElement from '../../common/insertElement';\r\nimport toggleForce from '../../common/toggleForce';\r\nimport {\r\n  buildTitanInfoTable,\r\n  clearMemberRows,\r\n  titanTbl\r\n} from './buildTitanInfoTable';\r\nimport {clearTitanDiv, initVars} from './placeholders';\r\n\r\nexport var titanDiv;\r\nexport var titanId;\r\n\r\nexport function hideTitanDiv() {\r\n  titanId = null;\r\n  if (titanDiv && !titanDiv.classList.contains('fshHide')) {\r\n    toggleForce(titanDiv, true);\r\n    clearTitanDiv();\r\n    clearMemberRows();\r\n  }\r\n}\r\n\r\nexport function hasTitan(el) {\r\n  if (el.type === 0) {\r\n    titanId = el.base_creature_id;\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\nexport function setupTitanDiv() {\r\n  if (titanDiv) {\r\n    toggleForce(titanDiv, false);\r\n  } else {\r\n    var actCont = getElementById('actionContainer');\r\n    titanDiv = createDiv({className: 'titanInfo'});\r\n    initVars();\r\n    buildTitanInfoTable();\r\n    insertElement(titanDiv, titanTbl);\r\n    insertElement(actCont, titanDiv);\r\n  }\r\n}\r\n","import calf from '../../support/calf';\r\nimport {processTitans} from './processTitans';\r\nimport scouttower from '../../app/guild/scouttower';\r\nimport {setRealm} from './realm';\r\nimport setValue from '../../system/setValue';\r\nimport {hasTitan, hideTitanDiv, setupTitanDiv} from './hasTitan';\r\n\r\nvar timeoutId;\r\n\r\nfunction clearTheTimeout() {\r\n  if (timeoutId) {\r\n    window.clearTimeout(timeoutId);\r\n    timeoutId = null;\r\n  }\r\n}\r\n\r\nfunction goodData(data) {\r\n  return data.s && Array.isArray(data.r);\r\n}\r\n\r\nfunction titanToShow(dynamic) {\r\n  return calf.showTitanInfo && Array.isArray(dynamic) && dynamic.some(hasTitan);\r\n}\r\n\r\nfunction ajaxScoutTower() {\r\n  scouttower().done(function processScoutTower(data) {\r\n    if (goodData(data)) {\r\n      processTitans(data.r);\r\n      if (titanToShow(GameData.realm().dynamic)) {\r\n        timeoutId = window.setTimeout(ajaxScoutTower, 30000);\r\n      } else {\r\n        hideTitanDiv();\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\nfunction testDynamics(dynamic) {\r\n  clearTheTimeout();\r\n  if (titanToShow(dynamic)) {\r\n    setupTitanDiv();\r\n    ajaxScoutTower();\r\n  } else {\r\n    hideTitanDiv();\r\n  }\r\n}\r\n\r\nexport function titanStats(data) {\r\n  if (data.realm.dynamic) {\r\n    setRealm(data.realm.name);\r\n    testDynamics(data.realm.dynamic);\r\n  }\r\n}\r\n\r\nexport function toggleShowTitanInfo() {\r\n  calf.showTitanInfo = !calf.showTitanInfo;\r\n  setValue('showTitanInfo', calf.showTitanInfo);\r\n  testDynamics(GameData.realm().dynamic);\r\n}\r\n","import calf from '../support/calf';\r\nimport eventHandler from '../common/eventHandler';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport {guideUrl} from '../support/dataObj';\r\nimport openQuickBuffByName from '../common/openQuickBuffByName';\r\nimport {playerName} from '../support/layout';\r\nimport setValue from '../system/setValue';\r\nimport {\r\n  createButton,\r\n  createDiv,\r\n  createInput,\r\n  createLabel,\r\n  textSpan\r\n} from '../common/cElement';\r\n\r\nvar buttonContainer;\r\nvar yourLvl;\r\nvar formGroup;\r\nvar quickBuff;\r\nvar realmMap;\r\nvar ufsgMap;\r\nvar soundCheck;\r\nvar huntCheck;\r\n\r\nfunction doFormGroup(self) { // jQuery.min\r\n  $(self).qtip('hide');\r\n  GameData.doAction(12, 401, {}, 0);\r\n}\r\n\r\nfunction openQuickBuff() {\r\n  openQuickBuffByName(playerName());\r\n}\r\n\r\nfunction openRealmMap() {\r\n  window.open('index.php?cmd=world&subcmd=map', 'fsMap');\r\n}\r\n\r\nfunction openUfsgMap() {\r\n  var gameRealm = GameData.realm();\r\n  window.open(guideUrl + 'realms&subcmd=view&realm_id=' + gameRealm.id,\r\n    'mapUfsg');\r\n}\r\n\r\nfunction toggleSound() {\r\n  // Doesn't actually work in New World...\r\n  setValue('playNewMessageSound', !getValue('playNewMessageSound'));\r\n}\r\n\r\nfunction toggleHuntMode() {\r\n  calf.huntingMode = !calf.huntingMode;\r\n  setValue('huntingMode', calf.huntingMode);\r\n}\r\n\r\nvar changeHdl = [\r\n  {\r\n    test: function(self) {return self === soundCheck;},\r\n    act: toggleSound\r\n  },\r\n  {\r\n    test: function(self) {return self === huntCheck;},\r\n    act: toggleHuntMode\r\n  }\r\n];\r\n\r\nvar clickHdl = [\r\n  {\r\n    test: function(self) {return self === formGroup;},\r\n    act: doFormGroup\r\n  },\r\n  {\r\n    test: function(self) {return self === quickBuff;},\r\n    act: openQuickBuff\r\n  },\r\n  {\r\n    test: function(self) {return self === realmMap;},\r\n    act: openRealmMap\r\n  },\r\n  {\r\n    test: function(self) {return self === ufsgMap;},\r\n    act: openUfsgMap\r\n  }\r\n];\r\n\r\nfunction fixTeleport() {\r\n  if (GameController && GameController.Realm) {\r\n    GameController.Realm.footprintTileList = []; // BUGFIX - in case of teleporting in new realm with footprints turned on\r\n  }\r\n}\r\n\r\nfunction makeButtonContainer() {\r\n  if (buttonContainer) {buttonContainer.remove();}\r\n  return createDiv({\r\n    className: 'fshCurveContainer',\r\n    id: 'fshWorldButtonContainer'\r\n  });\r\n}\r\n\r\nfunction doLevels(data, worldName) {\r\n  var lvlDiv = createDiv({\r\n    className: 'fshFsty',\r\n    innerHTML: '<div>Min Lvl: ' + data.realm.minlevel + '</div>'\r\n  });\r\n  var btmDiv = createDiv({textContent: 'Your Lvl: '});\r\n  yourLvl = textSpan(data.player.level.toString());\r\n  lvlDiv.appendChild(btmDiv).appendChild(yourLvl);\r\n  worldName.appendChild(lvlDiv);\r\n}\r\n\r\nfunction doBtn(className, tip, worldName) {\r\n  var btn = createButton({\r\n    className: 'fshCurveEle fshCurveBtn fshPoint tip-static ' + className,\r\n    dataset: {tipped: tip}\r\n  });\r\n  worldName.appendChild(btn);\r\n  return btn;\r\n}\r\n\r\nfunction showQuickLinks(worldName, data) {\r\n  doLevels(data, worldName);\r\n  formGroup = doBtn('fshFormGroup', 'Quick Create Attack Group', worldName);\r\n  quickBuff = doBtn('fshQuickBuff', 'Open Quick Buff Popup', worldName);\r\n  realmMap = doBtn('fshRealmMap', 'Open Realm Map', worldName);\r\n  ufsgMap = doBtn('fshTempleOne', 'Search map in Ultimate FSG', worldName);\r\n}\r\n\r\nfunction createLbl(className, tip, htmlFor) {\r\n  return createLabel({\r\n    className: 'fshCurveEle fshCurveLbl fshPoint tip-static ' + className,\r\n    dataset: {tipped: tip},\r\n    htmlFor: htmlFor\r\n  });\r\n}\r\n\r\nfunction makeToggleBtn(o) {\r\n  var btnDiv = createDiv({className: 'fshToggle'});\r\n  var btnCheck = createInput({\r\n    checked: o.prefVal,\r\n    id: o.checkId,\r\n    type: 'checkbox'\r\n  });\r\n  btnDiv.appendChild(btnCheck);\r\n  var onLbl = createLbl(o.onClass, o.onTip, o.checkId);\r\n  btnDiv.appendChild(onLbl);\r\n  var offLbl = createLbl(o.offClass, o.offTip, o.checkId);\r\n  btnDiv.appendChild(offLbl);\r\n  o.worldName.appendChild(btnDiv);\r\n  return btnCheck;\r\n}\r\n\r\nfunction showSpeakerOnWorld(worldName) {\r\n  if (getValue('showSpeakerOnWorld')) {\r\n    var msgSounds = getValue('playNewMessageSound');\r\n    soundCheck = makeToggleBtn({\r\n      prefVal: msgSounds,\r\n      checkId: 'fshSoundCheck',\r\n      onClass: 'soundOn',\r\n      onTip: 'Turn Off Sound when you have a new log message',\r\n      offClass: 'soundOff',\r\n      offTip: 'Turn On Sound when you have a new log message',\r\n      worldName: worldName\r\n    });\r\n  }\r\n}\r\n\r\nfunction showHuntMode(worldName) {\r\n  var inHuntMode = calf.huntingMode;\r\n  huntCheck = makeToggleBtn({\r\n    prefVal: inHuntMode,\r\n    checkId: 'fshHuntCheck',\r\n    onClass: 'huntOn',\r\n    onTip: 'Hunting mode is ON',\r\n    offClass: 'huntOff',\r\n    offTip: 'Hunting mode is OFF',\r\n    worldName: worldName\r\n  });\r\n}\r\n\r\nexport function injectButtons(data) {\r\n  fixTeleport();\r\n  buttonContainer = makeButtonContainer();\r\n  showQuickLinks(buttonContainer, data);\r\n  showSpeakerOnWorld(buttonContainer);\r\n  showHuntMode(buttonContainer);\r\n  buttonContainer.addEventListener('click', eventHandler(clickHdl));\r\n  buttonContainer.addEventListener('change', eventHandler(changeHdl));\r\n  getElementById('worldContainer')\r\n    .insertBefore(buttonContainer, getElementById('worldCoord'));\r\n}\r\n\r\nexport function levelStats(e, data) {\r\n  //#if _DEV  //  \"Your Lvl\" does not update during combat #155\r\n  console.log('level.stats-player data', data); // eslint-disable-line no-console\r\n  // level.stats-player data Object { a: 3381, b: 3382 }\r\n  //#endif\r\n  if (yourLvl) {\r\n    yourLvl.textContent = data.b;\r\n  }\r\n}\r\n","import insertElement from '../../common/insertElement';\r\n\r\n/*\r\n  colSpan = attributes[0]\r\n  anElement = attributes[1]\r\n  isHeader = attributes[2]\r\n*/\r\nfunction addNextCell(row, attributes) {\r\n  var aCell = row.insertCell(-1);\r\n  aCell.colSpan = attributes[0];\r\n  if (attributes[2]) {aCell.className = 'header';}\r\n  insertElement(aCell, attributes[1]);\r\n  return aCell;\r\n}\r\n\r\nfunction addRowCells(aRow, someCells) {\r\n  someCells.forEach(function(cell) {\r\n    addNextCell(aRow, cell);\r\n  });\r\n}\r\n\r\nfunction addNextRow(tbl, cells, isBlue) {\r\n  var aRow = tbl.insertRow(-1);\r\n  if (isBlue) {aRow.className = 'fshBlue';}\r\n  addRowCells(aRow, cells);\r\n  return aRow;\r\n}\r\n\r\nexport function addRows(tbl, rows) {\r\n  rows.forEach(function(row) {\r\n    addNextRow(tbl, row[0], row[1]);\r\n  });\r\n}\r\n","import {addRows} from './common';\r\nimport padZ from '../../system/padZ';\r\nimport {realmName} from './realm';\r\nimport roundToString from '../../common/roundToString';\r\nimport {textSpan} from '../../common/cElement';\r\nimport {titanId} from './hasTitan';\r\nimport {clearMemberRows, titanTbl} from './buildTitanInfoTable';\r\nimport {\r\n  cooldownText,\r\n  currentHp,\r\n  currentPct,\r\n  guildKills,\r\n  maxHp,\r\n  statusText,\r\n  totalPct\r\n} from './placeholders';\r\nimport {getKillsPct, getTitanString} from '../../scoutTower/injectScouttower';\r\nimport {months, now} from '../../support/dataObj';\r\n\r\nfunction formatOffset(secs) {\r\n  var aDate = new Date(now + secs * 1000);\r\n  var yyyy = aDate.getFullYear();\r\n  var dd = padZ(aDate.getDate());\r\n  var month = months[aDate.getMonth()];\r\n  var hh = padZ(aDate.getHours());\r\n  var mm = padZ(aDate.getMinutes());\r\n  return hh + ':' + mm + ' ' + dd + '/' + month + '/' + yyyy;\r\n}\r\n\r\nfunction getCooldownHtml(cooldown) {\r\n  if (cooldown <= 0) {\r\n    return '<span class=\"fshGreen cooldown\">No active cooldown</span>';\r\n  }\r\n  return '<span class=\"fshMaroon cooldown\">Cooldown until: ' +\r\n    formatOffset(cooldown) +\r\n    '</span>';\r\n}\r\n\r\nfunction doTopLabels(ourTitan) {\r\n  currentHp.textContent = ourTitan.current_hp.toString();\r\n  maxHp.textContent = ourTitan.max_hp.toString();\r\n  guildKills.textContent = ourTitan.kills.toString();\r\n  currentPct.textContent = roundToString(getKillsPct(ourTitan.max_hp -\r\n    ourTitan.current_hp, ourTitan.kills), 2);\r\n  totalPct.textContent = roundToString(ourTitan.kills * 100 / ourTitan.max_hp,\r\n    2);\r\n  statusText.innerHTML = getTitanString(ourTitan.kills, ourTitan.max_hp,\r\n    ourTitan.current_hp);\r\n  cooldownText.innerHTML = getCooldownHtml(ourTitan.cooldown);\r\n}\r\n\r\nfunction doMemberRows(ourTitan) {\r\n  clearMemberRows();\r\n  var memberRows = ourTitan.members.map(function(member) {\r\n    return [[\r\n      [2, textSpan(member.player.name)],\r\n      [2, textSpan(member.kills.toString())],\r\n      [2, textSpan(roundToString(member.kills * 100 / ourTitan.kills, 2) + '%')]\r\n    ]];\r\n  });\r\n  addRows(titanTbl, memberRows);\r\n}\r\n\r\nfunction currentTitan(el) {\r\n  return el.alive && el.id === titanId && el.realm === realmName;\r\n}\r\n\r\nexport function processTitans(r) {\r\n  var ourTitan = r.find(currentTitan);\r\n  if (ourTitan) {\r\n    doTopLabels(ourTitan);\r\n    doMemberRows(ourTitan);\r\n  }\r\n}\r\n","import callApp from '../callApp';\r\n\r\nexport default function scouttower() {\r\n  return callApp({cmd: 'guild', subcmd: 'scouttower'});\r\n}\r\n","import addCommas from '../system/addCommas';\r\nimport fallback from '../system/fallback';\r\nimport {getElementById} from '../common/getElement';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport rnd from '../system/rnd';\r\nimport testQuant from '../system/testQuant';\r\nimport {createButton, createDiv, createInput} from '../common/cElement';\r\n\r\nvar shoppingData;\r\nvar dialog;\r\nvar jDialog;\r\nvar fshDiv;\r\nvar numInput;\r\nvar qbBtn;\r\nvar resultDiv;\r\n\r\nfunction quickBuy() {\r\n  return retryAjax({\r\n    cache: false,\r\n    url: 'fetchdata.php',\r\n    data: {\r\n      a: 14,\r\n      d: 0,\r\n      id: shoppingData.id,\r\n      item_id: shoppingData.itemId,\r\n      _rnd: rnd()\r\n    },\r\n    dataType: 'json'\r\n  });\r\n}\r\n\r\nfunction quickDone(data) {\r\n  var resp = data.response.response;\r\n  var rmsg = data.response.msg;\r\n  var msg;\r\n  if (resp !== 0) {\r\n    var firstTag = rmsg.indexOf('<');\r\n    if (firstTag !== -1) {\r\n      msg = rmsg.substring(0, firstTag);\r\n    } else {\r\n      msg = rmsg;\r\n    }\r\n  } else {\r\n    msg = 'You purchased ' + data.response.data.name +\r\n      ' for ' + addCommas(data.response.data.cost) + ' gold.';\r\n  }\r\n  resultDiv.insertAdjacentHTML('beforeend', msg + '<br>');\r\n}\r\n\r\nfunction normalBuy() {\r\n  GameData.doAction(14, 3, {\r\n    id: shoppingData.id,\r\n    item_id: shoppingData.itemId\r\n  }, 0);\r\n  jDialog.close();\r\n}\r\n\r\nfunction qBuy() {\r\n  var theValue = testQuant(numInput.value);\r\n  if (!theValue) {return;}\r\n  var prm = [];\r\n  for (var i = 1; i < theValue; i += 1) {\r\n    prm.push(quickBuy().done(quickDone));\r\n  }\r\n  $.when.apply($, prm).done(normalBuy);\r\n}\r\n\r\nfunction injectQuickBuy() {\r\n  fshDiv = createDiv({\r\n    className: 'fshClear',\r\n    textContent: 'Select how many to quick-buy:'\r\n  });\r\n  numInput = createInput({\r\n    id: 'buyAmount',\r\n    className: 'fshNumberInput',\r\n    min: 1,\r\n    max: 99,\r\n    value: 1,\r\n    type: 'number'\r\n  });\r\n  fshDiv.appendChild(numInput);\r\n  qbBtn = createButton({textContent: 'Quick-buy'});\r\n  qbBtn.addEventListener('click', qBuy);\r\n  fshDiv.appendChild(qbBtn);\r\n  resultDiv = createDiv();\r\n  fshDiv.appendChild(resultDiv);\r\n  dialog.appendChild(fshDiv);\r\n}\r\n\r\nfunction worldDialogShop(e, data) {\r\n  shoppingData = data;\r\n  dialog = fallback(dialog,\r\n    getElementById('shopDialogConfirm'));\r\n  if (!dialog) {return;}\r\n  jDialog = fallback(jDialog, $(dialog).data('worldDialogShopConfirm'));\r\n  if (!fshDiv) {injectQuickBuy();} else {resultDiv.textContent = '';}\r\n}\r\n\r\nexport default function prepareShop() {\r\n  $.subscribe('prompt.worldDialogShop', worldDialogShop);\r\n}\r\n","import calf from '../support/calf';\r\nimport {colorHash} from './assets';\r\nimport {getElementById} from '../common/getElement';\r\nimport {titanStats} from './titanStats/titanStats';\r\nimport {\r\n  def_playerBuffs,\r\n  def_suffixSuccessActionResponse\r\n} from '../support/dataObj';\r\nimport {injectButtons, levelStats} from './buttons';\r\nimport {injectSendGoldOnWorld, updateSendGoldOnWorld} from './sendGold';\r\n\r\nfunction fixDebuffQTip(e) { // jQuery.min\r\n  $(e.target).qtip('hide');\r\n}\r\n\r\nfunction hazRealm(data) {\r\n  return data.realm && data.realm.name;\r\n}\r\n\r\nfunction injectWorldNewMap(data) {\r\n  updateSendGoldOnWorld(data);\r\n  if (hazRealm(data)) {\r\n    injectButtons(data);\r\n    titanStats(data);\r\n    getElementById('buffList')\r\n      .addEventListener('click', fixDebuffQTip);\r\n    if (calf.hideSubLvlCreature) {GameData.fetch(256);}\r\n  }\r\n}\r\n\r\nfunction impIconColour() { // jQuery\r\n  var imp = $('#actionlist-shield-imp');\r\n  if (imp.length === 1) {\r\n    imp.css('background-color',\r\n      colorHash[imp.text()] || '#ad8043');\r\n  }\r\n}\r\n\r\nexport default function onWorld() {\r\n  injectSendGoldOnWorld();\r\n  if (window.initialGameData) {// HCS initial data\r\n    injectWorldNewMap(window.initialGameData);\r\n    impIconColour(null,\r\n      {b: window.initialGameData.player.buffs});\r\n  }\r\n  $.subscribe('-1' + def_suffixSuccessActionResponse +\r\n              ' 5' + def_suffixSuccessActionResponse,\r\n  function(e, data) { // change of information\r\n    injectWorldNewMap(data);\r\n  });\r\n  $.subscribe(def_playerBuffs, impIconColour);\r\n  $.subscribe('level.stats-player', levelStats);\r\n}\r\n","\r\nfunction evalMiss(combat) {\r\n  if (combat.numberOfCreatureHitsTillDead - combat.numberOfHitsRequired <= 1) {\r\n    return ', dies on miss';\r\n  }\r\n  return ', survives a miss';\r\n}\r\n\r\nfunction canIHit(combat) {\r\n  return combat.numberOfHitsRequired === '-' ||\r\n    combat.numberOfHitsRequired > combat.numberOfCreatureHitsTillDead;\r\n}\r\n\r\nfunction evalPlayerHits(combat) {\r\n  if (combat.numberOfCreatureHitsTillDead === '-') {\r\n    return combat.numberOfHitsRequired;\r\n  } else if (canIHit(combat)) {\r\n    return '-';\r\n  }\r\n  return combat.numberOfHitsRequired;\r\n}\r\n\r\nfunction canCreatureHit(combat) {\r\n  return combat.numberOfCreatureHitsTillDead === '-' ||\r\n    combat.numberOfCreatureHitsTillDead > combat.numberOfHitsRequired;\r\n}\r\n\r\nfunction evalCreatureHits(combat) {\r\n  if (combat.numberOfHitsRequired === '-') {\r\n    return combat.numberOfCreatureHitsTillDead;\r\n  } else if (canCreatureHit(combat)) {\r\n    return '-';\r\n  }\r\n  return combat.numberOfCreatureHitsTillDead;\r\n}\r\n\r\nvar evalFightStatus = [\r\n  {\r\n    test: function(combat) {\r\n      return combat.playerHits === '-' && combat.creatureHits === '-';\r\n    },\r\n    fStatus: function() {return 'Unresolved';}\r\n  },\r\n  {\r\n    test: function(combat) {return combat.playerHits === '-';},\r\n    fStatus: function() {return 'Player dies';}\r\n  },\r\n  {\r\n    test: function(combat) {return combat.playerHits === 1;},\r\n    fStatus: function(combat) {return 'Player 1 hits' + evalMiss(combat);}\r\n  },\r\n  {\r\n    test: function(combat) {return combat.playerHits > 1;},\r\n    fStatus: function(combat) {return 'Player > 1 hits' + evalMiss(combat);}\r\n  }\r\n];\r\n\r\nexport default function evalAnalysis(combat) {\r\n  // Analysis:\r\n  combat.playerHits = evalPlayerHits(combat);\r\n  combat.creatureHits = evalCreatureHits(combat);\r\n  for (var i = 0; i < evalFightStatus.length; i += 1) {\r\n    if (evalFightStatus[i].test(combat)) {\r\n      combat.fightStatus = evalFightStatus[i].fStatus(combat);\r\n      return combat;\r\n    }\r\n  }\r\n  combat.fightStatus = 'Unknown';\r\n  return combat;\r\n}\r\n","import {bias} from '../assets';\r\nimport {getElementById} from '../../common/getElement';\r\nimport getValue from '../../system/getValue';\r\nimport intValue from '../../system/intValue';\r\nimport setValue from '../../system/setValue';\r\n\r\nexport var showCreatureInfo;\r\nvar generalVariable = 1.1053;\r\nvar hpVariable = 1.1;\r\nvar statLevel;\r\nvar statDefense;\r\nvar statAttack;\r\nvar statDamage;\r\nvar statArmor;\r\nvar statHp;\r\n\r\nexport function toggleShowCreatureInfo() {\r\n  showCreatureInfo = !showCreatureInfo;\r\n  setValue('showCreatureInfo', showCreatureInfo);\r\n}\r\n\r\nfunction biasIsValid(combatEvaluatorBias) {\r\n  return combatEvaluatorBias &&\r\n    combatEvaluatorBias >= 0 && combatEvaluatorBias <= 3;\r\n}\r\n\r\nexport function getBias() {\r\n  var combatEvaluatorBias = getValue('combatEvaluatorBias');\r\n  if (biasIsValid(combatEvaluatorBias)) {\r\n    generalVariable = bias[combatEvaluatorBias].generalVariable;\r\n    hpVariable = bias[combatEvaluatorBias].hpVariable;\r\n  }\r\n}\r\n\r\nfunction getStatText(statTooltip, statClassName) {\r\n  return statTooltip.getElementsByClassName(statClassName)[0]\r\n    .nextElementSibling.textContent;\r\n}\r\n\r\nexport function getMyStats() {\r\n  statLevel = intValue(getStatText(\r\n    getElementById('statbar-level-tooltip-general'), 'stat-level'));\r\n  var statTooltip = getElementById('statbar-character-tooltip-stats');\r\n  statDefense = getStatText(statTooltip, 'stat-defense');\r\n  statAttack = getStatText(statTooltip, 'stat-attack');\r\n  statDamage = getStatText(statTooltip, 'stat-damage');\r\n  statArmor = getStatText(statTooltip, 'stat-armor');\r\n  statHp = getStatText(statTooltip, 'stat-hp');\r\n}\r\n\r\nfunction doMouseOver(creature, monster) {\r\n  var oneHitNumber = Math.ceil(creature.hp * hpVariable + creature.armor *\r\n    generalVariable);\r\n  var myLvlClas = 'fshYellow';\r\n  if (statLevel > creature.level) {myLvlClas = 'fshRed';}\r\n  var monsterTip = '<table><tr><td>' +\r\n    '<img src=\"https://cdn.fallensword.com/creatures/' + creature.image_id +\r\n    '.jpg\" height=\"200\" width=\"200\"></td><td rowspan=\"2\">' +\r\n    '<table width=\"400\"><tr>' +\r\n    '<td class=\"header\" colspan=\"4\" class=\"fshCenter\">Statistics</td></tr>' +\r\n    '<tr><td>Class:&nbsp;</td><td width=\"40%\">' + creature.creature_class +\r\n    '</td><td>Level:&nbsp;</td><td width=\"40%\">' + creature.level +\r\n    ' (your level:<span class=\"' + myLvlClas + '\">' +\r\n    statLevel + '</span>)</td>' +\r\n    '</tr><tr><td>Attack:&nbsp;</td><td width=\"40%\">' + creature.attack +\r\n    ' (your defense:<span class=\"fshYellow\">' + statDefense + '</span>)</td>' +\r\n    '<td>Defense:&nbsp;</td><td width=\"40%\">' + creature.defense +\r\n    ' (your attack:<span class=\"fshYellow\">' + statAttack + '</span>)</td>' +\r\n    '</tr><tr><td>Armor:&nbsp;</td><td width=\"40%\">' + creature.armor +\r\n    ' (your damage:<span class=\"fshYellow\">' + statDamage + '</span>)</td>' +\r\n    '<td>Damage:&nbsp;</td><td width=\"40%\">' + creature.damage +\r\n    ' (your armor:<span class=\"fshYellow\">' + statArmor + '</span>)</td>' +\r\n    '</tr><tr><td>HP:&nbsp;</td><td width=\"40%\">' + creature.hp +\r\n    ' (your HP:<span class=\"fshYellow\">' + statHp + '</span>)' +\r\n    '(1H: <span class=\"fshRed\">' + oneHitNumber + '</span>)</td>' +\r\n    '<td>Gold:&nbsp;</td><td width=\"40%\">' + creature.gold + '</td></tr>' +\r\n    '<tr><td colspan=\"4\" height=\"5\"></td></tr><tr>' +\r\n    '<td class=\"header\" colspan=\"4\" class=\"fshCenter\">Enhancements</td></tr>';\r\n\r\n  if (!creature.enhancements) {\r\n    monsterTip += '<tr><td colspan=\"4\">[no enhancements]</td></tr>';\r\n  } else {\r\n    creature.enhancements.forEach(function(e) {\r\n      monsterTip += '<tr><td colspan=\"2\">' + e.name +\r\n        ':</td><td colspan=\"2\">' + e.value + '</td></tr>';\r\n    });\r\n  }\r\n\r\n  monsterTip += '<tr><td colspan=\"4\" height=\"5\"></td></tr><tr>' +\r\n    '<td class=\"header\" colspan=\"4\" class=\"fshCenter\">Description</td>' +\r\n    '</tr><tr><td colspan=\"4\">' + creature.description + '</td></tr>' +\r\n    '<tr><td colspan=\"4\" height=\"5\"></td></tr></table></td></tr>' +\r\n    '<tr><td class=\"fshCenter\"><b>' + creature.name + '</b></td></tr>' +\r\n    '</table>';\r\n\r\n  monster.dataset.tipped = monsterTip;\r\n}\r\n\r\nvar bailOut = [\r\n  function(data, actions) {\r\n    return actions.length === 1 &&\r\n      actions[0].classList.contains('hcs-state-disabled'); // In motion\r\n  },\r\n  function(data, actions) {\r\n    return actions.length - 1 < data.passback; // Not enough actions\r\n  },\r\n  function(data) {\r\n    return data.response.data.id !==\r\n      GameData.actions()[data.passback].data.id.toString(); // Different action list\r\n  }\r\n];\r\n\r\nfunction doCreatureInfo(data) {\r\n  var actions = getElementById('actionList').children;\r\n  for (var i = 0; i < bailOut.length; i += 1) {\r\n    if (bailOut[i](data, actions)) {return;}\r\n  }\r\n  // monster = 0;\r\n  doMouseOver(data.response.data, actions[data.passback].firstElementChild\r\n    .firstElementChild.firstElementChild);\r\n}\r\n\r\nexport function processMouseOver(data) {\r\n  if (showCreatureInfo) {doCreatureInfo(data);}\r\n}\r\n\r\nexport function getCreaturePrefs() {\r\n  showCreatureInfo = getValue('showCreatureInfo');\r\n}\r\n","\r\nfunction calcArm(combat) {\r\n  if (combat.callback.groupExists) {\r\n    return combat.callback.groupArmorValue;\r\n  }\r\n  return combat.player.armorValue;\r\n}\r\n\r\nfunction evalSanctuary(combat) {\r\n  if (combat.player.sanctuaryLevel > 0) {\r\n    combat.extraNotes += 'Sanc Bonus Armor = ' +\r\n      Math.floor(combat.player.armorValue *\r\n      combat.player.sanctuaryLevel * 0.001) + '<br>';\r\n  }\r\n}\r\n\r\nfunction evalTerrorize(combat) {\r\n  if (combat.player.terrorizeLevel > 0) {\r\n    combat.extraNotes += 'Terrorize Creature Damage Effect = ' +\r\n      combat.terrorizeEffect * -1 + '<br>';\r\n  }\r\n}\r\n\r\nexport default function evalArmour(combat) {\r\n  var armorVal = calcArm(combat);\r\n  combat.overallArmorValue = armorVal +\r\n    Math.floor(combat.player.armorValue *\r\n    combat.player.sanctuaryLevel * 0.001);\r\n\r\n  evalSanctuary(combat);\r\n\r\n  combat.terrorizeEffect = Math.floor(combat.creature.damage *\r\n    combat.player.terrorizeLevel * 0.001);\r\n\r\n  evalTerrorize(combat);\r\n\r\n  combat.creature.damage -= combat.terrorizeEffect;\r\n  combat.creatureDamageDone = Math.ceil(combat.generalVariable *\r\n    combat.creature.damage - combat.overallArmorValue +\r\n    combat.overallHPValue);\r\n\r\n  if (combat.creatureHitByHowMuch >= 0) {\r\n    var approxDmg = combat.generalVariable * combat.creature.damage;\r\n    if (approxDmg < combat.overallArmorValue) {\r\n      combat.numberOfCreatureHitsTillDead = combat.overallHPValue;\r\n    } else {\r\n      combat.numberOfCreatureHitsTillDead = Math.ceil(\r\n        combat.overallHPValue / (approxDmg - combat.overallArmorValue));\r\n    }\r\n  } else {\r\n    combat.numberOfCreatureHitsTillDead = '-';\r\n  }\r\n\r\n  return combat;\r\n}\r\n","\r\nfunction calcAttack(combat) {\r\n  if (combat.callback.groupExists) {\r\n    return combat.callback.groupAttackValue;\r\n  }\r\n  return combat.player.attackValue;\r\n}\r\n\r\nfunction calcHitByHowMuch(combat) {\r\n  var remainingDef = combat.creature.defense - combat.creature.defense *\r\n    combat.player.darkCurseLevel * 0.002;\r\n  if (combat.combatEvaluatorBias === 3) {\r\n    return combat.overallAttackValue - Math.ceil(remainingDef) - 50;\r\n  }\r\n  return combat.overallAttackValue -\r\n    Math.ceil(combat.attackVariable * remainingDef);\r\n}\r\n\r\nexport default function evalAttack(combat) {\r\n  var atkValue = calcAttack(combat);\r\n  // Attack:\r\n  if (combat.player.darkCurseLevel > 0) {\r\n    combat.extraNotes += 'DC Bonus Attack = ' +\r\n      Math.floor(combat.creature.defense *\r\n      combat.player.darkCurseLevel * 0.002) + '<br>';\r\n  }\r\n  combat.nightmareVisageAttackMovedToDefense =\r\n    Math.floor((atkValue +\r\n    combat.counterAttackBonusAttack) *\r\n    combat.player.nightmareVisageLevel * 0.0025);\r\n  if (combat.player.nightmareVisageLevel > 0) {\r\n    combat.extraNotes += 'NMV Attack moved to Defense = ' +\r\n      combat.nightmareVisageAttackMovedToDefense + '<br>';\r\n  }\r\n  combat.overallAttackValue = atkValue +\r\n    combat.counterAttackBonusAttack -\r\n    combat.nightmareVisageAttackMovedToDefense;\r\n  combat.hitByHowMuch = calcHitByHowMuch(combat);\r\n  return combat;\r\n}\r\n","function caIsRunning(combat) {\r\n  return combat.player.counterAttackLevel > 0 &&\r\n    combat.numberOfHitsRequired === 1;\r\n}\r\n\r\nfunction calcLowest(combat) {\r\n  combat.lowestCALevelToStillHit = Math.max(Math.ceil((\r\n    combat.counterAttackBonusAttack - combat.hitByHowMuch + 1) /\r\n    combat.player.attackValue / 0.0025), 0);\r\n  combat.lowestCALevelToStillKill = Math.max(Math.ceil((\r\n    combat.counterAttackBonusDamage - combat.damageDone + 1) /\r\n    combat.player.damageValue / 0.0025), 0);\r\n}\r\n\r\nfunction stamAtLowestCa(combat) {\r\n  if (combat.player.counterAttackLevel > 0) {\r\n    return Math.ceil((1 + combat.player.doublerLevel / 50) * 0.0025 *\r\n      combat.lowestFeasibleCALevel);\r\n  }\r\n  return 0;\r\n}\r\n\r\nfunction caRunning(combat) {\r\n  calcLowest(combat);\r\n  combat.lowestFeasibleCALevel =\r\n    Math.max(combat.lowestCALevelToStillHit,\r\n      combat.lowestCALevelToStillKill);\r\n  combat.extraNotes += 'Lowest CA to still 1-hit this creature = ' +\r\n    combat.lowestFeasibleCALevel + '<br>';\r\n  if (combat.lowestFeasibleCALevel !== 0) {\r\n    combat.extraAttackAtLowestFeasibleCALevel =\r\n      Math.floor(combat.player.attackValue * 0.0025 *\r\n      combat.lowestFeasibleCALevel);\r\n    combat.extraDamageAtLowestFeasibleCALevel =\r\n      Math.floor(combat.player.damageValue * 0.0025 *\r\n      combat.lowestFeasibleCALevel);\r\n    combat.extraNotes +=\r\n      'Extra CA Att/Dam at this lowered CA level = ' +\r\n      combat.extraAttackAtLowestFeasibleCALevel + ' / ' +\r\n      combat.extraDamageAtLowestFeasibleCALevel + '<br>';\r\n  }\r\n  combat.extraStaminaPerHitAtLowestFeasibleCALevel = stamAtLowestCa(combat);\r\n  if (combat.extraStaminaPerHitAtLowestFeasibleCALevel <\r\n    combat.extraStaminaPerHit) {\r\n    combat.extraNotes +=\r\n      'Extra Stam Used at this lowered CA level = ' +\r\n      combat.extraStaminaPerHitAtLowestFeasibleCALevel + '<br>';\r\n  } else {\r\n    combat.extraNotes +=\r\n      'No reduction of stam used at the lower CA level<br>';\r\n  }\r\n}\r\n\r\nfunction needCa(combat) {\r\n  return combat.numberOfHitsRequired === '-' ||\r\n    combat.numberOfHitsRequired !== 1;\r\n}\r\n\r\nfunction evalCaKill(combat) {\r\n  if (combat.lowestCALevelToStillHit > 175) {\r\n    combat.extraNotes +=\r\n      'Even with CA175 you cannot hit this creature<br>';\r\n  } else if (combat.lowestCALevelToStillHit !== 0) {\r\n    combat.extraNotes += 'You need a minimum of CA' +\r\n      combat.lowestCALevelToStillHit +\r\n      ' to hit this creature<br>';\r\n  }\r\n}\r\n\r\nfunction evalCaOneHit(combat) {\r\n  if (combat.lowestCALevelToStillKill > 175) {\r\n    combat.extraNotes +=\r\n      'Even with CA175 you cannot 1-hit kill this creature<br>';\r\n  } else if (combat.lowestCALevelToStillKill !== 0) {\r\n    combat.extraNotes += 'You need a minimum of CA' +\r\n      combat.lowestCALevelToStillKill +\r\n      ' to 1-hit kill this creature<br>';\r\n  }\r\n}\r\n\r\nfunction caResult(combat) {\r\n  calcLowest(combat);\r\n  evalCaKill(combat);\r\n  evalCaOneHit(combat);\r\n}\r\n\r\nexport default function evalCA(combat) {\r\n  if (caIsRunning(combat)) {\r\n    caRunning(combat);\r\n  }\r\n  if (needCa(combat)) {\r\n    caResult(combat);\r\n  }\r\n  return combat;\r\n}\r\n","\r\nfunction calcHp(combat) {\r\n  if (combat.callback.groupExists) {\r\n    return combat.callback.groupHPValue;\r\n  }\r\n  return combat.player.hpValue;\r\n}\r\n\r\nfunction calcDmg(combat) {\r\n  if (combat.callback.groupExists) {\r\n    return combat.callback.groupDamageValue;\r\n  }\r\n  return combat.player.damageValue;\r\n}\r\n\r\nfunction evalFortitude(combat) {\r\n  var hpValue = calcHp(combat);\r\n  var fortitudeLevel = combat.player.fortitudeLevel;\r\n  combat.fortitudeExtraHPs = Math.floor(hpValue * fortitudeLevel * 0.001);\r\n  if (fortitudeLevel > 0) {\r\n    combat.extraNotes += 'Fortitude Bonus HP = ' + combat.fortitudeExtraHPs +\r\n      '<br>';\r\n  }\r\n  combat.overallHPValue = hpValue + combat.fortitudeExtraHPs;\r\n}\r\n\r\nfunction evalChiStrike(combat) {\r\n  var chiStrikeLevel = combat.player.chiStrikeLevel;\r\n  combat.chiStrikeExtraDamage = Math.floor(combat.overallHPValue *\r\n    chiStrikeLevel * 0.001);\r\n  if (chiStrikeLevel > 0) {\r\n    combat.extraNotes += 'Chi Strike Bonus Damage = ' +\r\n      combat.chiStrikeExtraDamage + '<br>';\r\n  }\r\n}\r\n\r\nexport default function evalDamage(combat) {\r\n  // Damage:\r\n  evalFortitude(combat);\r\n  evalChiStrike(combat);\r\n\r\n  var damageValue = calcDmg(combat);\r\n  combat.overallDamageValue = damageValue +\r\n    combat.deathDealerBonusDamage + combat.counterAttackBonusDamage +\r\n    combat.holyFlameBonusDamage + combat.chiStrikeExtraDamage;\r\n  combat.damageDone = Math.floor(combat.overallDamageValue - (\r\n    combat.generalVariable * combat.creature.armor +\r\n    combat.hpVariable * combat.creature.hp));\r\n\r\n  if (combat.hitByHowMuch > 0) {\r\n    var dmgLessArmor = 1;\r\n    if (combat.overallDamageValue >=\r\n        combat.generalVariable * combat.creature.armor) {\r\n      dmgLessArmor = combat.overallDamageValue - combat.generalVariable *\r\n        combat.creature.armor;\r\n    }\r\n    combat.numberOfHitsRequired = Math.ceil(combat.hpVariable *\r\n      combat.creature.hp / dmgLessArmor);\r\n  } else {\r\n    combat.numberOfHitsRequired = '-';\r\n  }\r\n  return combat;\r\n}\r\n","function calcDef(combat) {\r\n  if (combat.callback.groupExists) {\r\n    return combat.callback.groupDefenseValue;\r\n  }\r\n  return combat.player.defenseValue;\r\n}\r\n\r\nfunction evalConstitution(combat) {\r\n  if (combat.player.constitutionLevel > 0) {\r\n    combat.extraNotes += 'Constitution Bonus Defense = ' +\r\n    Math.floor(calcDef(combat) *\r\n    combat.player.constitutionLevel * 0.001) + '<br>';\r\n  }\r\n}\r\n\r\nfunction evalFlinch(combat) {\r\n  if (combat.player.flinchLevel > 0) {\r\n    combat.extraNotes += 'Flinch Bonus Attack Reduction = ' +\r\n    Math.floor(combat.creature.attack * combat.player.flinchLevel *\r\n    0.001) + '<br>';\r\n  }\r\n}\r\n\r\nexport default function evalDefence(combat) {\r\n  combat.overallDefenseValue = calcDef(combat) +\r\n    Math.floor(calcDef(combat) *\r\n    combat.player.constitutionLevel * 0.001) +\r\n    combat.nightmareVisageAttackMovedToDefense;\r\n\r\n  evalConstitution(combat);\r\n  evalFlinch(combat);\r\n\r\n  combat.creatureHitByHowMuch = Math.floor(combat.attackVariable *\r\n    combat.creature.attack - combat.creature.attack *\r\n    combat.player.flinchLevel * 0.001 - combat.overallDefenseValue);\r\n\r\n  if (combat.combatEvaluatorBias === 3) {\r\n    combat.creatureHitByHowMuch = Math.floor(combat.creature.attack -\r\n      combat.creature.attack * combat.player.flinchLevel * 0.001 -\r\n      combat.overallDefenseValue - 50);\r\n  }\r\n\r\n  return combat;\r\n}\r\n","\r\nfunction evalSes(combat) {\r\n  if (combat.player.superEliteSlayerLevel > 0) {\r\n    combat.extraNotes += 'SES Stat Reduction Multiplier = ' +\r\n    combat.player.superEliteSlayerMultiplier + '<br>';\r\n  }\r\n}\r\n\r\nfunction evalHolyFlame(combat) {\r\n  combat.holyFlameBonusDamage = 0;\r\n  if (combat.creature.class !== 'Undead') {return;}\r\n  combat.holyFlameBonusDamage = Math.max(Math.floor(\r\n    (combat.player.damageValue - combat.creature.armor) *\r\n    combat.player.holyFlameLevel * 0.002), 0);\r\n  if (combat.player.holyFlameLevel > 0) {\r\n    combat.extraNotes += 'HF Bonus Damage = ' + combat.holyFlameBonusDamage +\r\n    '<br>';\r\n  }\r\n}\r\n\r\nfunction evalExtraStam(combat) {\r\n  combat.extraStaminaPerHit = 0;\r\n  if (combat.player.counterAttackLevel > 0) {\r\n    combat.extraStaminaPerHit = Math.ceil(\r\n      (1 + combat.player.doublerLevel / 50) *\r\n      0.0025 * combat.player.counterAttackLevel\r\n    );\r\n  }\r\n}\r\n\r\nfunction evalDeathDealer(combat) {\r\n  if (combat.player.deathDealerLevel > 0) {\r\n    combat.extraNotes += 'DD Bonus Damage = ' +\r\n      combat.deathDealerBonusDamage + '<br>';\r\n  }\r\n}\r\n\r\nfunction evalCounterAttack(combat) {\r\n  if (combat.player.counterAttackLevel > 0) {\r\n    combat.extraNotes += 'CA Bonus Attack/Damage = ' +\r\n      combat.counterAttackBonusAttack + ' / ' +\r\n      combat.counterAttackBonusDamage + '<br>' +\r\n      'CA Extra Stam Used = ' + combat.extraStaminaPerHit + '<br>';\r\n  }\r\n}\r\n\r\nexport default function evalExtraBuffs(combat) {\r\n  combat.extraNotes = '';\r\n  evalSes(combat);\r\n  // math section ... analysis\r\n  // Holy Flame adds its bonus after the\r\n  // armor of the creature has been taken off.\r\n  evalHolyFlame(combat);\r\n  // Death Dealer and Counter Attack both applied at the same time\r\n  combat.deathDealerBonusDamage =\r\n    Math.floor(combat.player.damageValue * (Math.min(Math.floor(\r\n      combat.player.killStreakValue / 5) * 0.01 *\r\n      combat.player.deathDealerLevel, 20) / 100));\r\n  combat.counterAttackBonusAttack =\r\n    Math.floor(combat.player.attackValue * 0.0025 *\r\n    combat.player.counterAttackLevel);\r\n  combat.counterAttackBonusDamage =\r\n    Math.floor(combat.player.damageValue * 0.0025 *\r\n    combat.player.counterAttackLevel);\r\n  evalExtraStam(combat);\r\n  evalDeathDealer(combat);\r\n  evalCounterAttack(combat);\r\n  return combat;\r\n}\r\n","import {afterUpdateActionList} from '../doNotKill';\r\nimport {bias} from '../assets';\r\nimport calf from '../../support/calf';\r\nimport createDocument from '../../system/createDocument';\r\nimport evalAnalysis from './evalAnalysis';\r\nimport evalArmour from './evalArmour';\r\nimport evalAttack from './evalAttack';\r\nimport evalCa from './evalCa';\r\nimport evalDamage from './evalDamage';\r\nimport evalDefence from './evalDefence';\r\nimport evalExtraBuffs from './evalExtraBuffs';\r\nimport evalHtml from './evalHtml';\r\nimport findNode from '../../system/findNode';\r\nimport {getElementById} from '../../common/getElement';\r\nimport getValue from '../../system/getValue';\r\nimport intValue from '../../system/intValue';\r\nimport {playerDataString} from '../../common/common';\r\nimport retryAjax from '../../ajax/retryAjax';\r\nimport setValue from '../../system/setValue';\r\n\r\nfunction getBiasGeneral(combat) {\r\n  if (bias[combat.combatEvaluatorBias]) {\r\n    return bias[combat.combatEvaluatorBias].generalVariable;\r\n  }\r\n  return 1.1053;\r\n}\r\n\r\nfunction getBiasHp(combat) {\r\n  if (bias[combat.combatEvaluatorBias]) {\r\n    return bias[combat.combatEvaluatorBias].hpVariable;\r\n  }\r\n  return 1.1;\r\n}\r\n\r\nfunction creatureData(ses) { // jQuery\r\n  var obj = {};\r\n  obj.name = $('#dialog-viewcreature').find('h2.name').text();\r\n  obj.class = $('#dialog-viewcreature')\r\n    .find('span.classification')\r\n    .text();\r\n  obj.attack = intValue($('#dialog-viewcreature')\r\n    .find('dd.attribute-atk').text());\r\n  obj.defense = intValue($('#dialog-viewcreature')\r\n    .find('dd.attribute-def').text());\r\n  obj.armor = intValue($('#dialog-viewcreature')\r\n    .find('dd.attribute-arm').text());\r\n  obj.damage = intValue($('#dialog-viewcreature')\r\n    .find('dd.attribute-dmg').text());\r\n  obj.hp = intValue($('#dialog-viewcreature')\r\n    .find('p.health-max').text());\r\n  // reduce stats if critter is a SE and player has SES cast on them.\r\n  if (obj.name.search('Super Elite') !== -1) {\r\n    obj.attack -= Math.ceil(obj.attack * ses);\r\n    obj.defense -= Math.ceil(obj.defense * ses);\r\n    obj.armor -= Math.ceil(obj.armor * ses);\r\n    obj.damage -= Math.ceil(obj.damage * ses);\r\n    obj.hp -= Math.ceil(obj.hp * ses);\r\n  }\r\n  return obj;\r\n}\r\n\r\nfunction checkForCreatureEvaluatorGroup() { // Legacy\r\n  if ($('#creatureEvaluatorGroup').length === 0) {\r\n    $('#dialog-viewcreature')\r\n      .append('<div id=\"creatureEvaluatorGroup\" ' +\r\n        'style=\"clear:both;\"></div>');\r\n  }\r\n}\r\n\r\nfunction checkForCreatureEvaluator() { // Legacy\r\n  if ($('#creatureEvaluator').length === 0) {\r\n    $('#dialog-viewcreature')\r\n      .append('<div id=\"creatureEvaluator\" ' +\r\n        'style=\"clear:both;\"></div>');\r\n  }\r\n}\r\n\r\nfunction getCreaturePlayerData(responseText, callback) { // Legacy\r\n  var combat = {};\r\n  combat.callback = callback;\r\n  // playerdata\r\n  combat.player = playerDataString(responseText);\r\n  combat.combatEvaluatorBias = getValue('combatEvaluatorBias');\r\n  combat.attackVariable = 1.1053;\r\n  combat.generalVariable = getBiasGeneral(combat);\r\n  combat.hpVariable = getBiasHp(combat);\r\n  combat.creature =\r\n    creatureData(combat.player.superEliteSlayerMultiplier);\r\n  combat = evalExtraBuffs(combat);\r\n  combat = evalAttack(combat);\r\n  combat = evalDamage(combat);\r\n  combat = evalDefence(combat);\r\n  combat = evalArmour(combat);\r\n  combat = evalAnalysis(combat);\r\n  combat = evalCa(combat);\r\n  combat.evaluatorHTML = evalHtml(combat);\r\n  var tempdata;\r\n  if (callback.groupEvaluation) {\r\n    checkForCreatureEvaluatorGroup();\r\n    tempdata = combat.evaluatorHTML.replace(/'/g, '\\\\\\'');\r\n    $('#creatureEvaluatorGroup').html(tempdata);\r\n  } else {\r\n    checkForCreatureEvaluator();\r\n    tempdata = combat.evaluatorHTML.replace(/'/g, '\\\\\\'');\r\n    $('#creatureEvaluator').html(tempdata);\r\n  }\r\n}\r\n\r\nfunction getCreatureGroupData(responseText) { // Legacy\r\n  var doc = createDocument(responseText);\r\n  var groupAttackValue = Number(findNode('//table[@width=\"400\"]/tbody' +\r\n    '/tr/td[contains(.,\"Attack:\")]', doc).nextSibling.textContent\r\n    .replace(/,/, ''));\r\n  var groupDefenseValue = Number(findNode('//table[@width=\"400\"]/tbody' +\r\n    '/tr/td[contains(.,\"Defense:\")]', doc).nextSibling.textContent\r\n    .replace(/,/, ''));\r\n  var groupArmorValue = Number(findNode('//table[@width=\"400\"]/tbody' +\r\n    '/tr/td[contains(.,\"Armor:\")]', doc).nextSibling.textContent\r\n    .replace(/,/, ''));\r\n  var groupDamageValue = Number(findNode('//table[@width=\"400\"]/tbody' +\r\n    '/tr/td[contains(.,\"Damage:\")]', doc).nextSibling.textContent\r\n    .replace(/,/, ''));\r\n  var groupHPValue = Number(findNode('//table[@width=\"400\"]/tbody' +\r\n    '/tr/td[contains(.,\"HP:\")]', doc).nextSibling.textContent\r\n    .replace(/,/, ''));\r\n  retryAjax('index.php?no_mobile=1&cmd=profile').done(function(html) {\r\n    getCreaturePlayerData(html, {\r\n      groupExists: true,\r\n      groupAttackValue: groupAttackValue,\r\n      groupDefenseValue: groupDefenseValue,\r\n      groupArmorValue: groupArmorValue,\r\n      groupDamageValue: groupDamageValue,\r\n      groupHPValue: groupHPValue,\r\n      groupEvaluation: true\r\n    });\r\n  });\r\n}\r\n\r\nfunction checkIfGroupExists(responseText) { // Hybrid\r\n  var doc = createDocument(responseText);\r\n  var groupExistsIMG = $(doc)\r\n    .find('img[title=\"Disband Group (Cancel Attack)\"]');\r\n  if (groupExistsIMG.length > 0) {\r\n    var groupHref = groupExistsIMG.parents('td:first').find('a:first')\r\n      .attr('href');\r\n    retryAjax(groupHref).done(getCreatureGroupData);\r\n  }\r\n}\r\n\r\nfunction addRemoveCreatureToDoNotKillList(evt) {\r\n  var creatureName = evt.target.getAttribute('creatureName');\r\n  var ind = calf.doNotKillList.indexOf(creatureName);\r\n  if (ind !== -1) {\r\n    calf.doNotKillList.splice(ind, 1);\r\n    evt.target.innerHTML = 'Add to the do not kill list';\r\n  } else {\r\n    calf.doNotKillList.push(creatureName);\r\n    evt.target.innerHTML = 'Remove from do not kill list';\r\n  }\r\n  setValue('doNotKillList', calf.doNotKillList.join());\r\n  // refresh the action list\r\n  afterUpdateActionList();\r\n}\r\n\r\nexport default function readyViewCreature() { // Hybrid\r\n  $('#creatureEvaluator').html('');\r\n  $('#creatureEvaluatorGroup').html('');\r\n\r\n  retryAjax('index.php?no_mobile=1&cmd=profile').done(function(html) {\r\n    getCreaturePlayerData(html, {\r\n      groupExists: false,\r\n      groupAttackValue: 0,\r\n      groupDefenseValue: 0,\r\n      groupArmorValue: 0,\r\n      groupDamageValue: 0,\r\n      groupHPValue: 0,\r\n      groupEvaluation: false\r\n    });\r\n  });\r\n  retryAjax('index.php?no_mobile=1&cmd=guild&subcmd=groups')\r\n    .done(checkIfGroupExists);\r\n\r\n  $('#addRemoveCreatureToDoNotKillList').html('');\r\n  if ($('#addRemoveCreatureToDoNotKillList').length === 0) {\r\n    var doNotKillElement = '<div id=\"addRemoveCreatureToDo' +\r\n      'NotKillList\"\" class=\"description\" style=\"cursor:' +\r\n      'pointer;text-decoration:underline;color:blue;\"></div>';\r\n    $(doNotKillElement).insertAfter($('#dialog-viewcreature')\r\n      .find('p.description'));\r\n  }\r\n  var creatureName = $('#dialog-viewcreature').find('h2.name')\r\n    .text();\r\n  $('#addRemoveCreatureToDoNotKillList')\r\n    .attr('creatureName', creatureName);\r\n  var extraText = 'Add to the do not kill list';\r\n  if (calf.doNotKillList.indexOf(creatureName) !== -1) {\r\n    extraText = 'Remove from do not kill list';\r\n  }\r\n  $('#addRemoveCreatureToDoNotKillList').html(extraText);\r\n  getElementById('addRemoveCreatureToDoNotKillList')\r\n    .addEventListener('click',\r\n      addRemoveCreatureToDoNotKillList, true);\r\n}\r\n","function doesGroupExist(combat) {\r\n  if (combat.callback.groupExists) {return 'Group ';}\r\n  return '';\r\n}\r\n\r\nfunction canIHitIt(combat) {\r\n  if (combat.hitByHowMuch > 0) {return 'Yes';}\r\n  return 'No';\r\n}\r\n\r\nfunction willIBeHit(combat) {\r\n  if (combat.creatureHitByHowMuch >= 0) {return 'Yes';}\r\n  return 'No';\r\n}\r\n\r\nexport default function evalHTML(combat) {\r\n  return '<table width=\"100%\"><tbody>' +\r\n    '<tr><td bgcolor=\"#CD9E4B\" colspan=\"4\" align=\"center\">' +\r\n    doesGroupExist(combat) +\r\n    'Combat Evaluation</td></tr>' +\r\n    '<tr><td align=\"right\"><span style=\"color:#333333\">' +\r\n    'Will I hit it? </td><td align=\"left\">' +\r\n    canIHitIt(combat) +\r\n    '</td><td align=\"right\"><span style=\"color:#333333\">' +\r\n    'Extra Attack: </td><td align=\"left\">( ' +\r\n    combat.hitByHowMuch + ' )</td></tr>' +\r\n    '<tr><td align=\"right\"><span style=\"color:#333333\">' +\r\n    '# Hits to kill it? </td><td align=\"left\">' +\r\n    combat.numberOfHitsRequired +\r\n    '</td><td align=\"right\"><span style=\"color:#333333\">' +\r\n    'Extra Damage: </td><td align=\"left\">( ' + combat.damageDone +\r\n    ' )</td></tr>' +\r\n    '<tr><td align=\"right\"><span style=\"color:#333333\">' +\r\n    'Will I be hit? </td><td align=\"left\">' +\r\n    willIBeHit(combat) +\r\n    '</td><td align=\"right\"><span style=\"color:#333333\">' +\r\n    'Extra Defense: </td><td align=\"left\">( ' + -1 *\r\n    combat.creatureHitByHowMuch + ' )</td></tr>' +\r\n    '<tr><td align=\"right\"><span style=\"color:#333333\">' +\r\n    '# Hits to kill me? </td><td align=\"left\">' +\r\n    combat.numberOfCreatureHitsTillDead +\r\n    '</td><td align=\"right\"><span style=\"color:#333333\">' +\r\n    'Extra Armor + HP: </td><td align=\"left\">( ' + -1 *\r\n    combat.creatureDamageDone + ' )</td></tr>' +\r\n    '<tr><td align=\"right\"><span style=\"color:#333333\">' +\r\n    '# Player Hits? </td><td align=\"left\">' + combat.playerHits +\r\n    '</td><td align=\"right\"><span style=\"color:#333333\">' +\r\n    '# Creature Hits? </td><td align=\"left\">' + combat.creatureHits +\r\n    '</td></tr>' +\r\n    '<tr><td align=\"right\"><span style=\"color:#333333\">' +\r\n    'Fight Status: </span></td><td align=\"left\" colspan=\"3\"><span>' +\r\n    combat.fightStatus + '</span></td></tr>' +\r\n    '<tr><td align=\"right\"><span style=\"color:#333333\">' +\r\n    'Notes: </span></td><td align=\"left\" colspan=\"3\">' +\r\n    '<span style=\"font-size:x-small;\">' + combat.extraNotes +\r\n    '</span></td></tr>' +\r\n    '<tr><td colspan=\"4\"><span style=\"font-size:x-small; ' +\r\n    'color:gray\">*Does include CA, DD, HF, DC, Flinch, Super Elite ' +\r\n    'Slayer, NMV, Sanctuary, Constitution, Fortitude, Chi Strike ' +\r\n    'and Terrorize (if active) and allow for randomness (1.1053). ' +\r\n    'Constitution, NMV, Fortitude and Chi Strike apply to group ' +\r\n    'stats.</span></td></tr>' +\r\n    '</tbody></table>';\r\n}\r\n","import fallback from '../../system/fallback';\r\nimport getForage from '../../ajax/getForage';\r\nimport getValue from '../../system/getValue';\r\nimport setForage from '../../ajax/setForage';\r\nimport setValue from '../../system/setValue';\r\n\r\nexport var showMonsterLog;\r\nvar monsterLog;\r\n\r\nexport function toggleShowMonsterLog() {\r\n  showMonsterLog = !showMonsterLog;\r\n  setValue('showMonsterLog', showMonsterLog);\r\n}\r\n\r\nfunction updateMinMax(_logStat, creatureStat) {\r\n  var logStat = fallback(_logStat, {});\r\n  if (logStat.min) {\r\n    logStat.min = Math.min(logStat.min, creatureStat);\r\n  } else {\r\n    logStat.min = creatureStat;\r\n  }\r\n  if (logStat.max) {\r\n    logStat.max = Math.max(logStat.max, creatureStat);\r\n  } else {\r\n    logStat.max = creatureStat;\r\n  }\r\n  return logStat;\r\n}\r\n\r\nfunction creatureHazEnhancements(creature) {\r\n  return creature.enhancements && creature.enhancements.length > 0;\r\n}\r\n\r\nfunction doMonsterLog(creature) {\r\n  monsterLog[creature.name] = fallback(monsterLog[creature.name], {});\r\n  var logCreature = monsterLog[creature.name];\r\n  logCreature.creature_class = fallback(logCreature.creature_class,\r\n    creature.creature_class);\r\n  logCreature.image_id = fallback(logCreature.image_id,\r\n    creature.image_id);\r\n  logCreature.level = fallback(logCreature.level,\r\n    Number(creature.level));\r\n  logCreature.type = fallback(logCreature.type, creature.type);\r\n  logCreature.armor = updateMinMax(logCreature.armor,\r\n    Number(creature.armor));\r\n  logCreature.attack = updateMinMax(logCreature.attack,\r\n    Number(creature.attack));\r\n  logCreature.damage = updateMinMax(logCreature.damage,\r\n    Number(creature.damage));\r\n  logCreature.defense = updateMinMax(logCreature.defense,\r\n    Number(creature.defense));\r\n  logCreature.hp = updateMinMax(logCreature.hp,\r\n    Number(creature.hp));\r\n  if (creatureHazEnhancements(creature)) {\r\n    logCreature.enhancements = fallback(logCreature.enhancements, {});\r\n    var logEnh = logCreature.enhancements;\r\n    creature.enhancements.forEach(function(e) {\r\n      logEnh[e.name] = updateMinMax(logEnh[e.name], Number(e.value));\r\n    });\r\n  }\r\n  setForage('fsh_monsterLog', monsterLog);\r\n}\r\n\r\nexport function processMonsterLog(creature) {\r\n  if (showMonsterLog) {doMonsterLog(creature);}\r\n}\r\n\r\nexport function getMonsterPrefs() {\r\n  showMonsterLog = getValue('showMonsterLog');\r\n  getForage('fsh_monsterLog').done(function(data) {\r\n    monsterLog = data || {};\r\n  });\r\n}\r\n","import calf from '../../support/calf';\r\n\r\nexport var huntingBuffs;\r\nexport var huntingBuffsName;\r\nvar buffLookup = {\r\n  '1': function() {\r\n    huntingBuffs = calf.buffs;\r\n    huntingBuffsName = calf.buffsName;\r\n  },\r\n  '2': function() {\r\n    huntingBuffs = calf.buffs2;\r\n    huntingBuffsName = calf.buffs2Name;\r\n  },\r\n  '3': function() {\r\n    huntingBuffs = calf.buffs3;\r\n    huntingBuffsName = calf.buffs3Name;\r\n  }\r\n};\r\n\r\nexport function setCurrentBuffList() {\r\n  var tmpFn = buffLookup[calf.enabledHuntingMode];\r\n  if (typeof tmpFn === 'function') {\r\n    tmpFn();\r\n  }\r\n}\r\n","import {def_afterUpdateActionlist} from '../../support/dataObj';\r\nimport retryAjax from '../../ajax/retryAjax';\r\nimport {\r\n  getBias,\r\n  getCreaturePrefs,\r\n  getMyStats,\r\n  processMouseOver,\r\n  showCreatureInfo\r\n} from './creatureInfo';\r\nimport {\r\n  getMonsterPrefs,\r\n  processMonsterLog,\r\n  showMonsterLog\r\n} from './processMonsterLog';\r\n\r\nfunction processMonster(data) {\r\n  if (!data.response.data) {return;} // creature is null\r\n  processMouseOver(data);\r\n  processMonsterLog(data.response.data);\r\n}\r\n\r\nfunction loopActions(e, i) { // jQuery.min\r\n  if (e.type !== 6) {return;}\r\n  retryAjax({\r\n    url: 'fetchdata.php?a=1&id=' + e.data.id + '&passback=' + i,\r\n    dataType: 'json'\r\n  }).done(processMonster);\r\n}\r\n\r\nfunction getCreatures() {\r\n  if (showCreatureInfo) {getMyStats();}\r\n  GameData.actions().forEach(loopActions);\r\n}\r\n\r\nfunction initMonsterLog() {\r\n  // if (!showCreatureInfo && !showMonsterLog) {return;}\r\n  if (showCreatureInfo || showMonsterLog) {\r\n    getCreatures();\r\n  }\r\n}\r\n\r\nexport default function startMonsterLog() { // jQuery.min\r\n  getCreaturePrefs();\r\n  getMonsterPrefs();\r\n  getBias();\r\n  $.subscribe(def_afterUpdateActionlist, initMonsterLog);\r\n  initMonsterLog();\r\n}\r\n","import {def_afterUpdateActionlist} from '../support/dataObj';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport setValue from '../system/setValue';\r\n\r\nvar hidePlayerActions;\r\n\r\nexport function toggleHidePlayerActions() {\r\n  hidePlayerActions = !hidePlayerActions;\r\n  setValue('hidePlayerActions', hidePlayerActions);\r\n  GameData.fetch(256);\r\n}\r\n\r\nfunction doHidePlayerActions() {\r\n  if (!hidePlayerActions) {return;}\r\n  var act = getElementById('actionList');\r\n  var players = act.getElementsByClassName('player');\r\n  Array.prototype.forEach.call(players, function(el) {\r\n    var verbs = el.getElementsByClassName('verbs');\r\n    if (verbs && verbs.length === 1) {\r\n      verbs[0].classList.add('fshHide');\r\n    }\r\n  });\r\n}\r\n\r\nexport function prepareHidePlayerActions() {\r\n  hidePlayerActions = getValue('hidePlayerActions');\r\n  $.subscribe(def_afterUpdateActionlist, doHidePlayerActions);\r\n  doHidePlayerActions();\r\n}\r\n","import calf from '../../support/calf';\r\nimport {setCurrentBuffList} from './setCurrentBuffList';\r\nimport setValue from '../../system/setValue';\r\n\r\nexport default function toggleEnabledHuntingMode(e) {\r\n  if (e.target.name !== 'enabledHuntingMode') {return;}\r\n  calf.enabledHuntingMode = e.target.value;\r\n  setValue('enabledHuntingMode', calf.enabledHuntingMode);\r\n  setCurrentBuffList();\r\n  GameData.fetch(16);\r\n}\r\n","import bitwiseAnd from '../common/bitwiseAnd';\r\nimport calf from '../support/calf';\r\nimport {def_fetch_worldRealmActions} from '../support/dataObj';\r\nimport jsonParse from '../common/jsonParse';\r\nimport setValue from '../system/setValue';\r\n\r\nexport function toggleSubLvlCreature() {\r\n  calf.hideSubLvlCreature = !calf.hideSubLvlCreature;\r\n  setValue('hideSubLvlCreature', calf.hideSubLvlCreature);\r\n  GameData.fetch(256);\r\n}\r\n\r\nvar testActions = [\r\n  function(myData) {return !myData;},\r\n  function(myData) {return !myData.actions;},\r\n  function(myData) {return myData.actions.length === 0;}\r\n];\r\n\r\nfunction xhrDataFilter(data) {\r\n  var myData = jsonParse(data);\r\n  if (testActions.some(function(el) {return el();})) {return data;}\r\n  var realm = GameData.realm();\r\n  myData.actions = myData.actions.filter(function(el) {\r\n    if (el.type === 6) {\r\n      return el.data.creature_type !== 0 || el.data.level >= realm.minlevel;\r\n    }\r\n    return true;\r\n  });\r\n  var ret = JSON.stringify(myData);\r\n  return ret;\r\n}\r\n\r\nfunction isActionList(originalOptions) {\r\n  return originalOptions.data &&\r\n    originalOptions.data.d &&\r\n    bitwiseAnd(originalOptions.data.d, def_fetch_worldRealmActions);\r\n}\r\n\r\nfunction xhrPreFilter(options, originalOptions) {\r\n  if (calf.hideSubLvlCreature && isActionList(originalOptions)) {\r\n    options.dataFilter = xhrDataFilter;\r\n  }\r\n}\r\n\r\nexport function interceptXHR() { // jQuery.min\r\n  $.ajaxPrefilter('JSON', xhrPreFilter);\r\n}\r\n","import {createDiv} from '../../common/cElement';\r\nimport {getElementById} from '../../common/getElement';\r\nimport {huntingBuffsHtml} from '../../settings/worldPrefs';\r\nimport insertElement from '../../common/insertElement';\r\nimport insertElementBefore from '../../common/insertElementBefore';\r\nimport {simpleCheckboxHtml} from '../../settings/simpleCheckbox';\r\nimport toggleEnabledHuntingMode from './toggleEnabledHuntingMode';\r\nimport {toggleHidePlayerActions} from '../prepareHidePlayerActions';\r\nimport {toggleShowCreatureInfo} from '../monsterLog/creatureInfo';\r\nimport toggleShowHuntingBuffs from './toggleShowHuntingBuffs';\r\nimport {toggleShowMonsterLog} from '../monsterLog/processMonsterLog';\r\nimport {toggleShowTitanInfo} from '../titanStats/titanStats';\r\nimport {toggleSubLvlCreature} from '../interceptXHR';\r\n\r\nexport var missingBuffsDiv;\r\n\r\nvar fshEvents = {\r\n  hideSubLvlCreature: toggleSubLvlCreature,\r\n  hidePlayerActions: toggleHidePlayerActions,\r\n  showCreatureInfo: toggleShowCreatureInfo,\r\n  showHuntingBuffs: toggleShowHuntingBuffs,\r\n  showMonsterLog: toggleShowMonsterLog,\r\n  showTitanInfo: toggleShowTitanInfo\r\n};\r\n\r\nfunction prefsClickEvent(e) {\r\n  var tmpFn = fshEvents[e.target.name];\r\n  if (typeof tmpFn === 'function') {\r\n    e.target.blur();\r\n    tmpFn(e);\r\n  }\r\n}\r\n\r\nexport function buildFshDivs() {\r\n  var fshDiv = createDiv({className: 'fshCenter fshFten'});\r\n  var prefsDiv = createDiv({\r\n    id: 'fshWorldPrefs',\r\n    innerHTML: simpleCheckboxHtml('showCreatureInfo') + '&nbsp;&nbsp;' +\r\n      simpleCheckboxHtml('showMonsterLog') + '&nbsp;&nbsp;' +\r\n      simpleCheckboxHtml('showTitanInfo') + '&nbsp;&nbsp;' +\r\n      '<br>' +\r\n      simpleCheckboxHtml('hideSubLvlCreature') + '&nbsp;&nbsp;' +\r\n      simpleCheckboxHtml('hidePlayerActions') + '&nbsp;&nbsp;' +\r\n      huntingBuffsHtml()\r\n  });\r\n  prefsDiv.addEventListener('click', prefsClickEvent);\r\n  prefsDiv.addEventListener('change', toggleEnabledHuntingMode);\r\n  insertElementBefore(fshDiv, prefsDiv);\r\n  missingBuffsDiv = createDiv();\r\n  insertElement(fshDiv, missingBuffsDiv);\r\n  var tempWorldButtons = getElementById('worldContainerBelow').children[0];\r\n  insertElementBefore(fshDiv, tempWorldButtons);\r\n}\r\n","import calf from '../../support/calf';\r\nimport setValue from '../../system/setValue';\r\n\r\nexport default function toggleShowHuntingBuffs() {\r\n  calf.showBuffs = !calf.showBuffs;\r\n  setValue('showHuntingBuffs', calf.showBuffs);\r\n  GameData.fetch(16);\r\n}\r\n","import calf from '../../support/calf';\r\nimport {def_playerBuffs} from '../../support/dataObj';\r\nimport {missingBuffsDiv} from './buildFshDivs';\r\nimport {\r\n  huntingBuffs,\r\n  huntingBuffsName,\r\n  setCurrentBuffList\r\n} from './setCurrentBuffList';\r\n\r\nfunction huntingBuffsEnabled(evt, data) {\r\n  if (!calf.showBuffs) {\r\n    missingBuffsDiv.innerHTML = '';\r\n    return;\r\n  }\r\n  var buffHash = data.b.reduce(function(prev, curr) {\r\n    prev[curr.name] = true;\r\n    return prev;\r\n  }, {});\r\n  var missingBuffs = huntingBuffs.reduce(function(prev, curr) {\r\n    if (!buffHash[curr.trim()]) {prev.push(curr);}\r\n    return prev;\r\n  }, []);\r\n  if (missingBuffs.length > 0) {\r\n    missingBuffsDiv.innerHTML = 'You are missing some ' +\r\n      huntingBuffsName + ' hunting buffs<br>(' +\r\n      missingBuffs.join(', ') + ')';\r\n  } else {missingBuffsDiv.innerHTML = '';}\r\n}\r\n\r\nfunction dataEventsPlayerBuffs(evt, data) {\r\n  if (huntingBuffs) {huntingBuffsEnabled(evt, data);}\r\n}\r\n\r\nexport function doHuntingBuffs() { // jQuery.min\r\n  setCurrentBuffList();\r\n  $.subscribe(def_playerBuffs, dataEventsPlayerBuffs);\r\n  if (calf.showBuffs && window.initialGameData) { // HCS initial data\r\n    dataEventsPlayerBuffs(null,\r\n      {b: window.initialGameData.player.buffs});\r\n  }\r\n}\r\n","import {buildFshDivs} from './buildFshDivs';\r\nimport calf from '../../support/calf';\r\nimport {doHuntingBuffs} from './doHuntingBuffs';\r\nimport getValue from '../../system/getValue';\r\nimport {interceptXHR} from '../interceptXHR';\r\nimport {prepareHidePlayerActions} from '../prepareHidePlayerActions';\r\nimport shouldBeArray from '../../system/shouldBeArray';\r\n\r\nfunction getPrefs() {\r\n  calf.buffs = shouldBeArray('huntingBuffs');\r\n  calf.buffsName = getValue('huntingBuffsName');\r\n  calf.buffs2 = shouldBeArray('huntingBuffs2');\r\n  calf.buffs2Name = getValue('huntingBuffs2Name');\r\n  calf.buffs3 = shouldBeArray('huntingBuffs3');\r\n  calf.buffs3Name = getValue('huntingBuffs3Name');\r\n  calf.doNotKillList = shouldBeArray('doNotKillList');\r\n  calf.enabledHuntingMode = getValue('enabledHuntingMode');\r\n  calf.hideSubLvlCreature = getValue('hideSubLvlCreature');\r\n  calf.showBuffs = getValue('showHuntingBuffs');\r\n  calf.showTitanInfo = getValue('showTitanInfo');\r\n}\r\n\r\nexport default function worldPrefs() {\r\n  getPrefs();\r\n  buildFshDivs();\r\n  interceptXHR();\r\n  doHuntingBuffs();\r\n  prepareHidePlayerActions();\r\n}\r\n","import combatLogger from './combatLogger';\r\nimport {def_afterUpdateActionlist} from '../support/dataObj';\r\nimport doNotKill from './doNotKill';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport injectRelic from './relic/relic';\r\nimport onWorld from './onWorld';\r\nimport prepareShop from './shop';\r\nimport readyViewCreature from './viewCreature/viewCreature';\r\nimport startMonsterLog from './monsterLog/monsterLog';\r\nimport worldPrefs from './worldPrefs/worldPrefs';\r\n\r\nfunction hideGroupByType(type) { // jQuery\r\n  $('#actionList li.creature-' + type.toString() + ' a.create-group').hide();\r\n}\r\n\r\nfunction hideGroupSubscribe(type) { // jQuery.min\r\n  $.subscribe(def_afterUpdateActionlist, hideGroupByType.bind(null, type));\r\n}\r\n\r\nvar hideGroupTypes = [\r\n  'hideChampionsGroup',\r\n  'hideElitesGroup',\r\n  'hideSEGroup',\r\n  'hideTitanGroup',\r\n  'hideLegendaryGroup'\r\n];\r\n\r\nfunction hideGroupButton() {\r\n  hideGroupTypes.forEach(function(el, i) {\r\n    if (getValue(el)) {\r\n      hideGroupSubscribe(i + 1);\r\n      hideGroupByType(i + 1);\r\n    }\r\n  });\r\n}\r\n\r\nfunction colorType(actionList, creatureClass, colorClass) {\r\n  var creatures = actionList.getElementsByClassName(creatureClass);\r\n  Array.prototype.forEach.call(creatures, function(el) {\r\n    el.classList.add(colorClass);\r\n  });\r\n}\r\n\r\nfunction colorMonsters() {\r\n  var act = getElementById('actionList');\r\n  colorType(act, 'creature-1', 'fshGreen');\r\n  colorType(act, 'creature-2', 'fshYellow');\r\n  colorType(act, 'creature-3', 'fshRed');\r\n}\r\n\r\nfunction doMonsterColors() { // jQuery.min\r\n  if (getValue('enableCreatureColoring')) {\r\n    $.subscribe(def_afterUpdateActionlist, colorMonsters);\r\n    colorMonsters();\r\n  }\r\n}\r\n\r\nfunction doRepair(e, key) {\r\n  if (key === 'ACT_REPAIR') {GameData.fetch(402);}\r\n}\r\n\r\nexport default function subscribes() { // jQuery.min\r\n  worldPrefs();\r\n  // subscribe to view creature events on the new map.\r\n  $.subscribe('ready.view-creature', readyViewCreature);\r\n  hideGroupButton(); // Hide Create Group button\r\n  doMonsterColors();\r\n  doNotKill(); // add do-not-kill list functionality\r\n  startMonsterLog(); // add monster log functionality\r\n  $.subscribe('keydown.controls', doRepair);\r\n  combatLogger();\r\n  onWorld(); // on world\r\n  // somewhere near here will be multi buy on shop\r\n  prepareShop();\r\n  injectRelic();\r\n  $('#messageCenter').worldMessageCenter({offset: '0 60'});\r\n  $('#mapTooltip').qtip('hide');\r\n}\r\n","import addCommas from './system/addCommas';\r\nimport calf from './support/calf';\r\nimport {createDiv} from './common/cElement';\r\nimport createDocument from './system/createDocument';\r\nimport findNode from './system/findNode';\r\nimport {getElementById} from './common/getElement';\r\nimport getValue from './system/getValue';\r\nimport {imageServer} from './system/system';\r\nimport intValue from './system/intValue';\r\nimport jQueryNotPresent from './common/jQueryNotPresent';\r\nimport {log} from './support/debug';\r\nimport retryAjax from './ajax/retryAjax';\r\nimport setValue from './system/setValue';\r\nimport subscribes from './newMap/newMap';\r\n\r\nvar impStyles = [\r\n  ' style=\"color:red; font-size:large; font-weight:bold\"',\r\n  ' style=\"color:Orangered; font-size:large; font-weight:bold\"',\r\n  ' style=\"color:Orangered; font-size:medium; font-weight:bold;\"'\r\n];\r\n\r\nfunction getImpWarningStyle(impsRemaining) { // Legacy\r\n  if (impsRemaining >= 0 && impsRemaining <= 2) {\r\n    return impStyles[impsRemaining];\r\n  }\r\n  return ' style=\"color:green; font-size:medium;\"';\r\n}\r\n\r\nfunction impWarning(impsRemaining) { // Legacy\r\n  var applyImpWarningColor = getImpWarningStyle(impsRemaining);\r\n  var recastButton = '';\r\n  if (impsRemaining === 0) {\r\n    recastButton = '&nbsp;<span id=\"Helper:recastImpAndRefresh\" ' +\r\n      'style=\"color: blue; cursor: pointer; text-decoration: underline; ' +\r\n      'font-size: xx-small;\">Recast</span>';\r\n  }\r\n  return '<tr><td' + applyImpWarningColor + '>Shield Imps Remaining: ' +\r\n    impsRemaining + recastButton + '</td></tr>';\r\n}\r\n\r\nfunction getCaLvl(hasCounterAttack) { // Legacy\r\n  var counterAttackLevel;\r\n  if (hasCounterAttack.getAttribute('src').search('/skills/') !== -1) {\r\n    var onmouseover = $(hasCounterAttack).data('tipped');\r\n    var counterAttackRE = /<b>Counter Attack<\\/b> \\(Level: (\\d+)\\)/;\r\n    var counterAttack = counterAttackRE.exec(onmouseover);\r\n    if (counterAttack) {\r\n      counterAttackLevel = counterAttack[1];\r\n    }\r\n  }\r\n  return '<tr><td style=\"font-size:small; color:' +\r\n    'blue\">CA' + counterAttackLevel + ' active</td></tr>';\r\n}\r\n\r\nfunction hasCA() { // Legacy\r\n  var replacementText = '';\r\n  var hasCounterAttack = findNode('//img[contains(@src,\"/54_sm.gif\")]');\r\n  if (hasCounterAttack) {\r\n    replacementText += getCaLvl(hasCounterAttack);\r\n  }\r\n  return replacementText;\r\n}\r\n\r\nvar doublerRE = /<b>Doubler<\\/b> \\(Level: (\\d+)\\)/;\r\n\r\nfunction doublerLvl(onmouseover) { // Legacy\r\n  var doubler = doublerRE.exec(onmouseover);\r\n  if (doubler) {return doubler[1];}\r\n}\r\n\r\nfunction getDoublerLevel(hasDoubler) { // Legacy\r\n  var doublerLevel;\r\n  if (hasDoubler.getAttribute('src').search('/skills/') !== -1) {\r\n    var onmouseover = $(hasDoubler).data('tipped');\r\n    doublerLevel = doublerLvl(onmouseover);\r\n  }\r\n  if (doublerLevel === 200) { // ???\r\n    return '<tr><td style=\"font-size:small; color:' +\r\n      'red\">Doubler ' + doublerLevel + ' active</td></tr>';\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction hasDblr() { // Legacy\r\n  var hasDoubler = findNode('//img[contains(@src,\"/26_sm.gif\")]');\r\n  if (hasDoubler) {\r\n    return getDoublerLevel(hasDoubler);\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction getKillStreak(responseText) { // Hybrid\r\n  var doc = createDocument(responseText);\r\n  var killStreakLocation = $(doc).find('td:contains(\"Streak:\"):last').next();\r\n  log('killStreakLocation', killStreakLocation); // TODO WTF?\r\n  var playerKillStreakValue;\r\n  if (killStreakLocation.length > 0) {\r\n    playerKillStreakValue = intValue(killStreakLocation.text());\r\n  }\r\n  var killStreakElement = findNode('//span[@findme=\"killstreak\"]');\r\n  killStreakElement.innerHTML = addCommas(playerKillStreakValue);\r\n  setValue('lastKillStreak', playerKillStreakValue);\r\n  var deathDealerBuff =\r\n    findNode('//img[contains(@data-tipped,\"Death Dealer\")]');\r\n  var deathDealerRE = /<b>Death Dealer<\\/b> \\(Level: (\\d+)\\)/;\r\n  var deathDealer = deathDealerRE.exec($(deathDealerBuff).data('tipped'));\r\n  var deathDealerPercentage;\r\n  if (deathDealer) {\r\n    var deathDealerLevel = deathDealer[1];\r\n    deathDealerPercentage = Math.min(Math.round(\r\n      Math.floor(playerKillStreakValue / 5) * deathDealerLevel\r\n    ) * 0.01, 20);\r\n  }\r\n  var deathDealerPercentageElement =\r\n    findNode('//span[@findme=\"damagebonus\"]');\r\n  deathDealerPercentageElement.innerHTML = deathDealerPercentage;\r\n  setValue('lastDeathDealerPercentage', deathDealerPercentage);\r\n}\r\n\r\nfunction getLastValue(pref) {\r\n  var val = getValue(pref);\r\n  if (typeof val === 'undefined') {\r\n    setValue(pref, 0);\r\n    val = 0;\r\n  }\r\n  return val;\r\n}\r\n\r\nfunction getTrackText(trackKillStreak) { // Legacy\r\n  if (trackKillStreak) {return 'ON';}\r\n  return 'off';\r\n}\r\n\r\nfunction notMaxDd(lastDeathDealerPercentage, lastKillStreak) {\r\n  var trackKillStreak = getValue('trackKillStreak');\r\n  var trackText = getTrackText(trackKillStreak);\r\n  if (!trackKillStreak) {\r\n    return '<tr><td style=\"font-size:small; color:' +\r\n      'navy\" nowrap>KillStreak tracker disabled. <span style=\"' +\r\n      'font-size:xx-small\">Track: <span id=Helper:toggleKS' +\r\n      'tracker style=\"color:navy;cursor:pointer;text-' +\r\n      'decoration:underline;\" title=\"Click to toggle\">' +\r\n      trackText + '</span></span></td></tr>';\r\n  }\r\n  retryAjax('index.php?no_mobile=1&cmd=profile').done(getKillStreak);\r\n  return '<tr><td style=\"font-size:small; color:' +\r\n    'navy\" nowrap>KillStreak: <span findme=\"killstreak\">' +\r\n    addCommas(lastKillStreak) + '</span> Damage bonus' +\r\n    ': <span findme=\"damagebonus\">' +\r\n    Math.round(lastDeathDealerPercentage * 100) / 100 +\r\n    '</span>%&nbsp;<span style=\"font-size:xx-small\">Track: ' +\r\n    '<span id=Helper:toggleKStracker style=\"color:navy;' +\r\n    'cursor:pointer;text-decoration:underline;\" title=\"Click' +\r\n    ' to toggle\">' + trackText + '</span></span></td></tr>';\r\n}\r\n\r\nfunction doDeathDealer(impsRemaining) { // Legacy\r\n  var lastDeathDealerPercentage = getLastValue('lastDeathDealerPercentage');\r\n  var lastKillStreak = getLastValue('lastKillStreak');\r\n  if (impsRemaining > 0 && lastDeathDealerPercentage === 20) {\r\n    return '<tr><td style=\"font-size:small; color:black\"' +\r\n      '>Kill Streak: <span findme=\"killstreak\">&gt;' +\r\n      addCommas(lastKillStreak) + '</span> Damage bonus: <' +\r\n      'span findme=\"damagebonus\">20</span>%</td></tr>';\r\n  }\r\n  return notMaxDd(lastDeathDealerPercentage, lastKillStreak);\r\n}\r\n\r\nfunction recastImpAndRefresh(responseText) { // Legacy\r\n  var doc = createDocument(responseText);\r\n  if (doc) {\r\n    location.reload();\r\n  }\r\n}\r\n\r\nfunction toggleKsTracker() { // Legacy\r\n  var trackKS = getElementById('Helper:toggleKStracker');\r\n  if (trackKS) {\r\n    trackKS.addEventListener('click', function() {\r\n      setValue('trackKillStreak',\r\n        !getValue('trackKillStreak'));\r\n      location.reload();\r\n    }, true);\r\n  }\r\n}\r\n\r\nvar hasShieldImp;\r\nvar hasDeathDealer;\r\nvar impsRemaining;\r\nvar re = /(\\d+) HP remaining/;\r\n\r\nfunction getImpHp() { // Legacy - Old Map\r\n  impsRemaining = 0;\r\n  if (hasShieldImp) {\r\n    var textToTest = $(hasShieldImp).data('tipped');\r\n    var impsRemainingRE = re.exec(textToTest);\r\n    impsRemaining = impsRemainingRE[1];\r\n  }\r\n  var ret = impWarning(impsRemaining);\r\n  if (hasDeathDealer) {\r\n    ret += doDeathDealer(impsRemaining);\r\n  }\r\n  return ret;\r\n}\r\n\r\nfunction findImps() { // Legacy - Old Map\r\n  if (hasDeathDealer || hasShieldImp) {\r\n    return getImpHp();\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction canRecast() {\r\n  return (hasDeathDealer || hasShieldImp) && impsRemaining === 0;\r\n}\r\n\r\nfunction impRecast() { // Legacy - Old Map\r\n  if (canRecast()) {\r\n    var _recastImpAndRefresh = getElementById('Helper:recastImpAndRefresh');\r\n    var impHref = 'index.php?no_mobile=1&cmd=quickbuff&subcmd=activate&target' +\r\n      'Players=' +\r\n      $('dt.stat-name:first').next().text().replace(/,/g, '') +\r\n      '&skills%5B%5D=55';\r\n    _recastImpAndRefresh.addEventListener('click', function() {\r\n      retryAjax(impHref).done(recastImpAndRefresh);\r\n    }, true);\r\n  }\r\n}\r\n\r\nfunction checkBuffs() { // Legacy - Old Map\r\n  // extra world screen text\r\n  var replacementText = '<td background=\"' + imageServer +\r\n    '/skin/realm_right_bg.jpg\"><table align=\"right\" cellpadding=\"1\" ' +\r\n    'style=\"width:270px;margin-left:38px;margin-right:38px;font-size' +\r\n    ':medium; border-spacing: 1px; border-collapse: collapse;\"><tr><' +\r\n    'td colspan=\"2\" height=\"10\"></td></tr><tr>';\r\n  hasShieldImp = findNode('//img[contains(@src,\"/55_sm.gif\")]');\r\n  hasDeathDealer = findNode('//img[contains(@src,\"/50_sm.gif\")]');\r\n  replacementText += findImps();\r\n  replacementText += hasCA();\r\n  replacementText += hasDblr();\r\n  if (calf.huntingMode) {\r\n    replacementText += '<tr><td style=\"font-size: small; color:red\">' +\r\n      'Hunting mode enabled</td></tr>';\r\n  }\r\n  replacementText += '<tr><td colspan=\"2\" height=\"10\"></td></tr>';\r\n  replacementText += '</td>';\r\n\r\n  var injectHere = findNode('//div[table[@class=\"centered\" ' +\r\n    'and @style=\"width: 270px;\"]]');\r\n  if (!injectHere) {return;}\r\n  // insert after kill all monsters image and text\r\n  var newSpan = createDiv({innerHTML: replacementText});\r\n  injectHere.appendChild(newSpan);\r\n\r\n  impRecast();\r\n  toggleKsTracker();\r\n}\r\n\r\nfunction injectOldMap() {\r\n  checkBuffs();\r\n}\r\n\r\nexport default function injectWorld() {\r\n  if (jQueryNotPresent()) {return;}\r\n  // -1 = world page\r\n  // 0 = quest responce\r\n  // 1 = view creature\r\n  // 2 = attack creature\r\n  // 3 = attack player\r\n  // 4 = move\r\n  // 5 = use stair\r\n  // 6 = use chest\r\n  // 7 = take portal\r\n  // 10 = problaby view relic\r\n  // 11 = take relic\r\n  // 12 = create group\r\n  // 13 = view shop\r\n  // 14 = purchase item\r\n  // 15 = repair\r\n  // 17 = login\r\n  // 18 = username not found\r\n  if (getElementById('worldPage')) { // new map\r\n    subscribes();\r\n  } else {\r\n    // not new map.\r\n    injectOldMap();\r\n  }\r\n}\r\n","import {createTd} from './common/cElement';\r\nimport doinvent from './app/inventing/doinvent';\r\nimport fallback from './system/fallback';\r\nimport findNode from './system/findNode';\r\nimport findNodes from './system/findNodes';\r\nimport {getElementById} from './common/getElement';\r\nimport {guideUrl} from './support/dataObj';\r\nimport jQueryPresent from './common/jQueryPresent';\r\nimport jsonFail from './common/jsonFail';\r\nimport outputResult from './common/outputResult';\r\nimport retryAjax from './ajax/retryAjax';\r\nimport {server} from './system/system';\r\n\r\nvar itemRE = /<b>([^<]+)<\\/b>/i;\r\nvar plantFromComponentHash = {\r\n  'Amber Essense': 'Amber Plant',\r\n  'Blood Bloom Flower': 'Blood Bloom Plant',\r\n  'Dark Shade ': 'Dark Shade Plant',\r\n  'Snake Eye': 'Elya Snake Head',\r\n  'Snake Venom Fang': 'Elya Snake Head',\r\n  'Heffle Wart': 'Heffle Wart Plant',\r\n  'Jademare Blossom': 'Jademare Plant',\r\n  'Trinettle Leaf': 'Trinettle Plant',\r\n  'Purplet Flower': 'Purplet Plant',\r\n};\r\n\r\nfunction quickInventDone(json) {\r\n  var inventResult = getElementById('invent_Result');\r\n  if (jsonFail(json, inventResult)) {return;}\r\n  if (json.r.success) {\r\n    outputResult('<span class=\"fshGreen\">' +\r\n      'You successfully invented the item!</span>', inventResult);\r\n  } else {\r\n    outputResult('<span class=\"fshRed\">' +\r\n      'You have failed to invent the item.</span>', inventResult);\r\n  }\r\n}\r\n\r\nfunction quickInvent() { // Legacy\r\n  var amountToInvent = $('#invent_amount').attr('value');\r\n  var recipeID = $('input[name=\"recipe_id\"]').attr('value');\r\n  $('#invet_Result_label').html('Inventing ' + amountToInvent + ' Items');\r\n  for (var i = 0; i < amountToInvent; i += 1) {\r\n    doinvent(recipeID).done(quickInventDone);\r\n  }\r\n}\r\n\r\nfunction injectInvent() { // Bad jQuery\r\n  var selector = '<tr><td align=\"center\">Select how many to quick ' +\r\n    'invent<input value=1 id=\"invent_amount\" name=\"invent_amount\" ' +\r\n    'size=3 class=\"custominput\"></td></tr>' +\r\n    '<tr><td align=\"center\"><input id=\"quickInvent\" value=\"Quick ' +\r\n    'invent items\" class=\"custombutton\" type=\"submit\"></td></tr>' + // button to invent\r\n    '<tr><td colspan=6 align=\"center\"><span id=\"invet_Result_label\">' +\r\n    '</span><ol id=\"invent_Result\"></ol></td></tr>';\r\n  $('input[name=\"recipe_id\"]').closest('tbody').append(selector);\r\n  getElementById('quickInvent').addEventListener('click',\r\n    quickInvent, true);\r\n\r\n}\r\n\r\nfunction getItemName(responseText) { // Legacy\r\n  var itemName = itemRE.exec(responseText);\r\n  if (itemName) {return itemName[1];}\r\n}\r\n\r\nfunction injectViewRecipeLinks(responseText, callback) { // Legacy\r\n  var itemName = getItemName(responseText);\r\n  var plantFromComponent = fallback(plantFromComponentHash[itemName],\r\n    itemName);\r\n  if (itemName !== plantFromComponent) {\r\n    var itemLinks = createTd({\r\n      innerHTML: '<a href=\"' + server +\r\n        '?cmd=auctionhouse&search_text=' +\r\n        encodeURI(plantFromComponent) + '\">AH</a>'\r\n    });\r\n    var counter = findNode('../../../../tr[2]/td', callback);\r\n    counter.setAttribute('colspan', '2');\r\n    callback.parentNode.parentNode.parentNode.appendChild(itemLinks);\r\n  }\r\n}\r\n\r\nfunction linkFromMouseoverCustom(mouseOver) { // Legacy\r\n  var reParams =\r\n    /item_id=(\\d+)&inv_id=([-0-9]*)&t=(\\d+)&p=(\\d+)&vcode=([a-z0-9]*)/i;\r\n  var reResult = reParams.exec(mouseOver);\r\n  if (reResult === null) {\r\n    return null;\r\n  }\r\n  var itemId = reResult[1];\r\n  var invId = reResult[2];\r\n  var type = reResult[3];\r\n  var pid = reResult[4];\r\n  var vcode = reResult[5];\r\n  var theUrl = 'fetchitem.php?item_id=' + itemId + '&inv_id=' + invId +\r\n    '&t=' + type + '&p=' + pid + '&vcode=' + vcode;\r\n  theUrl = server + theUrl;\r\n  return theUrl;\r\n}\r\n\r\nfunction injectViewRecipe() { // Legacy\r\n  var recipe = $('#pCC table table b').first();\r\n  var name = recipe.html();\r\n  var searchName = recipe.html().replace(/ /g, '%20');\r\n  recipe.html('<a href=\"' + guideUrl +\r\n    'items&subcmd=view&search_name=' + searchName + '\">' + name +\r\n    '</a>');\r\n\r\n  var components = findNodes(\r\n    '//b[.=\"Components Required\"]/../../following-sibling::tr[2]//img');\r\n  if (components) {\r\n    components.forEach(function(compI) {\r\n      var mo = compI.dataset.tipped;\r\n      retryAjax(linkFromMouseoverCustom(mo)).done(function(html) {\r\n        injectViewRecipeLinks(html, compI);\r\n      });\r\n      var componentCountElement = compI.parentNode.parentNode\r\n        .parentNode.nextSibling.firstChild;\r\n      componentCountElement.innerHTML = '<nobr>' +\r\n        componentCountElement.innerHTML + '</nobr>';\r\n    });\r\n  }\r\n}\r\n\r\nexport default function inventing() {\r\n  if (jQueryPresent()) {\r\n    injectViewRecipe();\r\n    injectInvent();\r\n  }\r\n}\r\n","import addCommas from './system/addCommas';\r\nimport {closestTable} from './common/closest';\r\nimport {getElementById} from './common/getElement';\r\nimport {pCC} from './support/layout';\r\n\r\nvar amt;\r\nvar prc;\r\nvar warn;\r\n\r\nfunction getAmount() {\r\n  if (!amt) {amt = getElementById('amount');}\r\n  return amt;\r\n}\r\n\r\nfunction getPrice() {\r\n  if (!prc) {prc = getElementById('price');}\r\n  return prc;\r\n}\r\n\r\nfunction getWarning() {\r\n  if (!warn) {\r\n    var requestTable = closestTable(getAmount());\r\n    var newRow = requestTable.insertRow(2);\r\n    warn = newRow.insertCell(0);\r\n    warn.colSpan = '2';\r\n    warn.className = 'fshCenter';\r\n  }\r\n  return warn;\r\n}\r\n\r\nfunction totalPrice(amount, sellPrice) {\r\n  var gross = amount * sellPrice;\r\n  return gross + Math.ceil(gross / 200);\r\n}\r\n\r\nfunction marketplaceWarning(sellPrice) {\r\n  var amount = getAmount().value;\r\n  getWarning().innerHTML = '<span class=\"fshBlue\">You are offering to buy ' +\r\n    '<b>' + amount + '</b> FSP for >> <b>' + addCommas(sellPrice) +\r\n    '</b> (Total: ' + addCommas(totalPrice(amount, sellPrice)) + ')</span>';\r\n}\r\n\r\nfunction clearWarning() {\r\n  if (warn && warn.innerHTML !== '') {warn.innerHTML = '';}\r\n}\r\n\r\nfunction addMarketplaceWarning() {\r\n  var sellPrice = getPrice().value;\r\n  if (sellPrice.search(/^[0-9]+$/) !== -1) {\r\n    marketplaceWarning(sellPrice);\r\n  } else {clearWarning();}\r\n}\r\n\r\nexport default function marketplace() {\r\n  pCC.addEventListener('keyup', addMarketplaceWarning);\r\n}\r\n","import callApp from '../callApp';\r\n\r\nexport default function doinvent(recipe) {\r\n  return callApp({\r\n    cmd: 'inventing',\r\n    subcmd: 'doinvent',\r\n    recipe_id: recipe\r\n  });\r\n}\r\n","import {createTr} from './common/cElement';\r\nimport getValue from './system/getValue';\r\nimport {now} from './support/dataObj';\r\nimport outputFormat from './system/outputFormat';\r\n\r\nfunction dontPost() {\r\n  var submitButton = document.querySelector('#pCC input[type=\"submit\"]');\r\n  if (submitButton) {\r\n    submitButton.addEventListener('click', function(e) {\r\n      e.preventDefault();\r\n      window.location = 'index.php?cmd=pvpladder&viewing_band_id=' +\r\n        document.querySelector('#pCC select[name=\"viewing_band_id\"]').value;\r\n    });\r\n  }\r\n}\r\n\r\nfunction formatLastReset(lastLadderReset) {\r\n  var m = Math.floor((now - lastLadderReset) / 60000);\r\n  var h = Math.floor(m / 60);\r\n  m %= 60;\r\n  return outputFormat(h, ' hours, ') + m + ' mins';\r\n}\r\n\r\nfunction formatTime() {\r\n  var lastLadderReset = getValue('lastLadderReset');\r\n  if (lastLadderReset < now - 48 * 60 * 60 * 1000) {\r\n    return '<span class=\"fshLink tip-static\" data-tipped=\"FSH has not seen ' +\r\n      'the last ladder reset.<br>You can find it in your log if you ' +\r\n      'qualified<br>or Tavern Rumours.\">???</span>';\r\n  }\r\n  return formatLastReset(lastLadderReset);\r\n}\r\n\r\nfunction lastReset() {\r\n  var topTable = document.querySelector('#pCC table');\r\n  var newRow = createTr();\r\n  var leftCell = newRow.insertCell(-1);\r\n  leftCell.height = 25;\r\n  leftCell.textContent = 'Last Reset:';\r\n  var rightCell = newRow.insertCell(-1);\r\n  rightCell.align = 'right';\r\n  rightCell.innerHTML = formatTime();\r\n  topTable.appendChild(newRow);\r\n}\r\n\r\nexport default function ladder() {\r\n  dontPost();\r\n  lastReset();\r\n}\r\n","import {imageServer} from '../system/system';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {moveOptions} from './assets';\r\nimport retryAjax from '../ajax/retryAjax';\r\n\r\nvar oldMoves = [];\r\nvar nodes;\r\nvar selectRow;\r\n\r\nfunction doPickMove(moveId, slotId) {\r\n  return retryAjax({\r\n    url: 'index.php',\r\n    data: {\r\n      no_mobile: 1,\r\n      cmd: 'arena',\r\n      subcmd: 'dopickmove',\r\n      move_id: moveId,\r\n      slot_id: slotId\r\n    }\r\n  });\r\n}\r\n\r\nfunction updateMoves() { // jQuery\r\n  var newMoves = [];\r\n  $('select', selectRow).each(function(i, e) {\r\n    newMoves.push($(e).val());\r\n  });\r\n  var prm = [];\r\n  newMoves.forEach(function(val, ind) {\r\n    if (val === oldMoves[ind]) {return;}\r\n    prm.push(doPickMove('x', ind));\r\n    nodes.eq(ind).attr({\r\n      src: imageServer + '/world/actionLoadingSpinner.gif',\r\n      width: '25',\r\n      height: '25'\r\n    });\r\n  });\r\n  $.when.apply($, prm).done(function() {\r\n    newMoves.forEach(function(val, ind) {\r\n      if (val === 'x' || val === oldMoves[ind]) {return;}\r\n      prm.push(doPickMove(val, ind));\r\n    });\r\n    $.when.apply($, prm).done(function() {\r\n      window.location = 'index.php?cmd=arena&subcmd=setup';\r\n    });\r\n  });\r\n}\r\n\r\nfunction selectMoves(evt) { // jQuery\r\n  $(evt.target).off();\r\n\r\n  nodes =\r\n    $('#pCC a[href^=\"index.php?cmd=arena&subcmd=pickmove&slot_id=\"] img');\r\n  var table = nodes.eq(0).closest('table').parent().closest('table');\r\n\r\n  var row = $('<tr/>');\r\n  selectRow = row;\r\n  row.append('<td/>');\r\n  nodes.each(function(i, e) {\r\n    var move = $(e).attr('src');\r\n    if (move.indexOf('bar_icon_holder.jpg') > 0) {\r\n      move = 'x';\r\n    } else {\r\n      move = move.match(/pvp\\/(\\d+).gif$/)[1];\r\n    }\r\n    var html = $(moveOptions);\r\n    $('option[value=' + move + ']', html).prop('selected', true);\r\n    row.append(html);\r\n  });\r\n  table.append(row);\r\n\r\n  $('img[src$=\"pvp/bar_spacer.jpg\"]', table)\r\n    .attr({width: '15', height: '50'});\r\n\r\n  row = $('<tr><td colspan=32 align=center ' +\r\n    'style=\"padding-top: 2px;padding-bottom: 2px;\">' +\r\n    '<input class=\"custombutton\" value=\"Update\" type=\"button\">' +\r\n    '</td></tr>');\r\n  $('input', row).click(updateMoves);\r\n  table.append(row);\r\n}\r\n\r\nexport default function setupMoves() { // jQuery\r\n  if (jQueryNotPresent()) {return;}\r\n  var node = $('#pCC b:contains(\"Setup Combat Moves\")');\r\n  if (node.length !== 1) {return;}\r\n  node.addClass('fshLink fshGreen');\r\n  node.click(selectMoves);\r\n}\r\n","import {createSpan} from './common/cElement';\r\nimport {getElementById} from './common/getElement';\r\nimport insertElement from './common/insertElement';\r\nimport insertTextBeforeEnd from './common/insertTextBeforeEnd';\r\nimport intValue from './system/intValue';\r\nimport isNaN from './common/isNaN';\r\nimport {server} from './system/system';\r\nimport setValue from './system/setValue';\r\n\r\nvar upgrades;\r\nvar currentFSP;\r\nvar warehouse = {};\r\n\r\nfunction findText(text) {\r\n  return Array.prototype.find.call(upgrades, function(el) {\r\n    return el.textContent.indexOf(text) !== -1;\r\n  });\r\n}\r\n\r\nfunction getInputCell(label) {\r\n  return findText(label).nextElementSibling.nextElementSibling\r\n    .nextElementSibling;\r\n}\r\n\r\nfunction getInputElement(el) {\r\n  return el.nextElementSibling.nextElementSibling\r\n    .nextElementSibling.children[0].rows[0].cells[0].children[0];\r\n}\r\n\r\nfunction getRe(type, label) {\r\n  if (label === 'amount') {\r\n    return new RegExp('\\\\+(\\\\d+) ' + type);\r\n  }\r\n  return /(\\d+)\\xA0/;\r\n}\r\n\r\nfunction getValue(type, element, label) {\r\n  if (!warehouse[type][label]) {\r\n    var valRe = getRe(type, label);\r\n    var value = element.textContent.match(valRe)[1];\r\n    warehouse[type][label] = value;\r\n  }\r\n  return warehouse[type][label];\r\n}\r\n\r\nfunction getAmount(type, upgrade) {\r\n  return getValue(type, upgrade, 'amount');\r\n}\r\n\r\nfunction getCost(type, upgrade) {\r\n  return getValue(type, upgrade.nextElementSibling, 'cost');\r\n}\r\n\r\nfunction getCell(type, upgrade) {\r\n  if (!warehouse[type]) {warehouse[type] = {};}\r\n  if (!warehouse[type].span) {\r\n    var span = createSpan();\r\n    insertTextBeforeEnd(upgrade, ' ');\r\n    insertElement(upgrade, span);\r\n    warehouse[type].span = span;\r\n  }\r\n  return warehouse[type].span;\r\n}\r\n\r\nfunction doStamCount(type, upgrade, quantity, cell) {\r\n  var amount = getAmount(type, upgrade);\r\n  var cost = getCost(type, upgrade);\r\n  // cap the value if the user goes over his current FSP\r\n  var extraStam;\r\n  if (quantity * cost <= currentFSP) {\r\n    extraStam = quantity * amount;\r\n    cell.className = 'fshBlue';\r\n  } else {\r\n    extraStam = Math.floor(currentFSP / cost) * amount;\r\n    cell.className = 'fshRed';\r\n  }\r\n  cell.textContent = '(+' + extraStam + ' stamina)';\r\n}\r\n\r\nfunction updateStamCount(type, upgrade, evt) {\r\n  var self = evt.target;\r\n  var quantity = Number(self.value);\r\n  var cell = getCell(type, upgrade);\r\n  if (isNaN(quantity) || quantity === 0) {\r\n    cell.className = 'fshHide';\r\n    return;\r\n  }\r\n  doStamCount(type, upgrade, quantity, cell);\r\n}\r\n\r\nfunction injectUpgradeHelper(type) {\r\n  var upgrade = findText(type);\r\n  getInputElement(upgrade).addEventListener('keyup',\r\n    updateStamCount.bind(null, type, upgrade));\r\n}\r\n\r\nfunction injectPoints() {\r\n  currentFSP = intValue(getElementById('statbar-fsp').textContent);\r\n  injectUpgradeHelper('Current');\r\n  injectUpgradeHelper('Maximum');\r\n  getInputCell('Gold').innerHTML = '<a href=\"' + server +\r\n    'index.php?cmd=marketplace\">Sell at Marketplace</a>';\r\n}\r\n\r\nfunction saveUpgradeValue(upgrade, key) {\r\n  var text = findText(upgrade);\r\n  var ratio = text.nextElementSibling.nextElementSibling;\r\n  if (ratio) {\r\n    var valueRE = /(\\d+) \\/ 115/;\r\n    var value = Number(valueRE.exec(ratio.innerHTML)[1]);\r\n    setValue(key, value + 5);\r\n  }\r\n}\r\n\r\nexport default function storePlayerUpgrades() {\r\n  upgrades = document.querySelectorAll('#pCC > table:last-of-type > tbody > ' +\r\n    'tr:nth-child(even) > td:first-child');\r\n  saveUpgradeValue('+1 Max Allies', 'alliestotal');\r\n  saveUpgradeValue('+1 Max Enemies', 'enemiestotal');\r\n  injectPoints();\r\n}\r\n","import getForage from '../ajax/getForage';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport setForage from '../ajax/setForage';\r\n\r\nfunction gotMoves(_arena) { // jQuery\r\n  var arena = _arena || {};\r\n  arena.moves = {};\r\n  var arenaMoves = $('#pCC img[vspace=\"4\"]').slice(1);\r\n  arenaMoves.each(function(i, e) {\r\n    var self = $(e);\r\n    var src = self.attr('src');\r\n    var moveId = /(\\d+)\\.gif/.exec(src)[1];\r\n    arena.moves[moveId] = {};\r\n    arena.moves[moveId].count = Number(/(\\d)$/\r\n      .exec(self.closest('td').html())[1]);\r\n    arena.moves[moveId].href = src;\r\n  });\r\n  setForage('fsh_arena', arena);\r\n}\r\n\r\nexport default function storeMoves() { // jQuery.min\r\n  if (jQueryNotPresent()) {return;}\r\n  getForage('fsh_arena').done(gotMoves);\r\n}\r\n","import calf from '../support/calf';\r\nimport formatUtcDateTime from '../common/formatUtcDateTime';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {pCC} from '../support/layout';\r\nimport setValue from '../system/setValue';\r\nimport {simpleCheckboxHtml} from '../settings/simpleCheckbox';\r\nimport {createTBody, createTable} from '../common/cElement';\r\nimport {\r\n  disableBackgroundChecks,\r\n  doBackgroundCheck,\r\n  getFshSeLog,\r\n  oldLog\r\n} from './seLog';\r\n\r\nvar enableSeTracker = 'enableSeTracker';\r\nvar trackerCell;\r\n\r\nfunction addRow(trackerTable, se) {\r\n  trackerTable.insertAdjacentHTML('beforeend',\r\n    '<tr><td class=\"fshCenter\">' + se[0] + '</td>' +\r\n    '<td class=\"fshBold fshCenter fshCooldown\">' +\r\n    formatUtcDateTime(new Date(se[1] * 1000)) + '</td></tr>');\r\n}\r\n\r\nfunction buildTrackerTable(seAry) {\r\n  var trackerTable = createTable({className: 'fshTTracker'});\r\n  var tBody = createTBody({\r\n    innerHTML: '<tr><td class=\"header fshCenter\">Creature</td>' +\r\n      '<td class=\"header fshCenter\">Last Kill</td></tr>'\r\n  });\r\n  trackerTable.appendChild(tBody);\r\n  seAry.forEach(addRow.bind(null, tBody));\r\n  return trackerTable;\r\n}\r\n\r\nfunction insertNewRow() {\r\n  var newRow = pCC.lastElementChild.insertRow(-1);\r\n  var newCell = newRow.insertCell(-1);\r\n  newCell.colSpan = 3;\r\n  return newCell;\r\n}\r\n\r\nfunction displayTracker(seAry) {\r\n  var trackerTable = buildTrackerTable(seAry);\r\n  trackerCell = insertNewRow();\r\n  trackerCell.appendChild(trackerTable);\r\n}\r\n\r\nfunction gotSeLog() {\r\n  if (oldLog && oldLog.se) {\r\n    var seAry = Object.keys(oldLog.se).map(function(key) {\r\n      return [key, oldLog.se[key]];\r\n    }).sort(function(a, b) {\r\n      return a[1] - b[1];\r\n    });\r\n    displayTracker(seAry);\r\n  }\r\n}\r\n\r\nfunction killTable() {\r\n  if (!calf.enableSeTracker) {\r\n    if (trackerCell) {\r\n      trackerCell.parentNode.remove();\r\n      trackerCell = false;\r\n    }\r\n    disableBackgroundChecks();\r\n  } else {\r\n    doBackgroundCheck().always(gotSeLog);\r\n  }\r\n}\r\n\r\nfunction togglePref(evt) {\r\n  if (evt.target.id === enableSeTracker) {\r\n    calf.enableSeTracker = !calf.enableSeTracker;\r\n    setValue(enableSeTracker, calf.enableSeTracker);\r\n    killTable();\r\n  }\r\n}\r\n\r\nfunction waitForLog() {\r\n  doBackgroundCheck().always(gotSeLog);\r\n}\r\n\r\nexport default function superelite() {\r\n  if (jQueryNotPresent) {return;}\r\n  var newCell = insertNewRow();\r\n  newCell.height = 20;\r\n  newCell = insertNewRow();\r\n  newCell.className = 'fshCenter';\r\n  newCell.innerHTML = simpleCheckboxHtml(enableSeTracker);\r\n  newCell.addEventListener('change', togglePref);\r\n  if (calf.enableSeTracker) {\r\n    getFshSeLog().done(waitForLog);\r\n  }\r\n}\r\n","import getUrlParameter from './system/getUrlParameter';\r\nimport getValue from './system/getValue';\r\nimport {guideUrl} from './support/dataObj';\r\nimport {imageServer} from './system/system';\r\nimport {pCC} from './support/layout';\r\nimport setValue from './system/setValue';\r\n\r\nvar normalLink;\r\nvar seasonLink;\r\nvar activeLink;\r\nvar completeLink;\r\nvar notStartedLink;\r\nvar currentPageValue;\r\n\r\nfunction dontPost(e) {\r\n  if (e.target.type !== 'submit') {return;}\r\n  e.preventDefault();\r\n  var form = e.target.form;\r\n  var mode = form[1].value;\r\n  var type = form[2].value;\r\n  var letter = form[3].value;\r\n  var sortby = form[4].value;\r\n  var sortbydir = form[5].value;\r\n  var page = form[6].value;\r\n  window.location = 'index.php?cmd=questbook&type=' + type + '&mode=' + mode +\r\n    '&page=' + page + '&letter=' + letter + '&sortby=' + sortby +\r\n    '&sortbydir=' + sortbydir;\r\n}\r\n\r\nvar currentLocationValue = [\r\n  {value: 0},\r\n  {value: 3},\r\n  {value: 0},\r\n  {value: 1},\r\n  {value: 2}\r\n];\r\n\r\nvar savePrefKey = [\r\n  'lastNormalActiveQuestPage',\r\n  'lastNormalCompletedQuestPage',\r\n  'lastNormalNotStartedQuestPage',\r\n  'lastSeasonalActiveQuestPage',\r\n  'lastSeasonalCompletedQuestPage',\r\n  'lastSeasonalNotStartedQuestPage'\r\n];\r\n\r\nfunction whereAmI() {\r\n  var aLinks = pCC.getElementsByTagName('a');\r\n  normalLink = aLinks[0];\r\n  seasonLink = aLinks[1];\r\n  activeLink = aLinks[2];\r\n  completeLink = aLinks[3];\r\n  notStartedLink = aLinks[4];\r\n  currentPageValue = currentLocationValue.reduce(function(prev, curr, i) {\r\n    var ret = prev;\r\n    if (aLinks[i].firstElementChild.getAttribute('color') === '#FF0000') {\r\n      ret += curr.value;\r\n    }\r\n    return ret;\r\n  }, 0);\r\n}\r\n\r\nfunction storeLoc() {\r\n  var lastQBPage = location.search;\r\n  setValue('lastActiveQuestPage', lastQBPage);\r\n  setValue(savePrefKey[currentPageValue], lastQBPage);\r\n}\r\n\r\nfunction setLink(aLink, url) {\r\n  if (url.length > 0) {\r\n    aLink.setAttribute('href', url);\r\n  }\r\n}\r\n\r\nfunction updateLinks() {\r\n  var lastNormalActiveQuestPage = getValue(savePrefKey[0]);\r\n  var lastNormalCompletedQuestPage = getValue(savePrefKey[1]);\r\n  var lastNormalNotStartedQuestPage = getValue(savePrefKey[2]);\r\n  var lastSeasonalActiveQuestPage = getValue(savePrefKey[3]);\r\n  var lastSeasonalCompletedQuestPage = getValue(savePrefKey[4]);\r\n  var lastSeasonalNotStartedQuestPage = getValue(savePrefKey[5]);\r\n\r\n  var oppositeTypeUrl = [\r\n    lastSeasonalActiveQuestPage,\r\n    lastSeasonalCompletedQuestPage,\r\n    lastSeasonalNotStartedQuestPage,\r\n    lastNormalActiveQuestPage,\r\n    lastNormalCompletedQuestPage,\r\n    lastNormalNotStartedQuestPage\r\n  ];\r\n\r\n  if (currentPageValue < 3) {\r\n    setLink(seasonLink, oppositeTypeUrl[currentPageValue]);\r\n    setLink(activeLink, lastNormalActiveQuestPage);\r\n    setLink(completeLink, lastNormalCompletedQuestPage);\r\n    setLink(notStartedLink, lastNormalNotStartedQuestPage);\r\n  } else {\r\n    setLink(normalLink, oppositeTypeUrl[currentPageValue]);\r\n    setLink(activeLink, lastSeasonalActiveQuestPage);\r\n    setLink(completeLink, lastSeasonalCompletedQuestPage);\r\n    setLink(notStartedLink, lastSeasonalNotStartedQuestPage);\r\n  }\r\n}\r\n\r\nfunction storeQuestPage() {\r\n  if (getValue('storeLastQuestPage')) {\r\n    whereAmI();\r\n    storeLoc();\r\n    updateLinks();\r\n  }\r\n}\r\n\r\nfunction guideButtons(questID, questName) {\r\n  return '<div class=\"parent\">' +\r\n    '<a href=\"' + guideUrl + 'quests&' +\r\n    'subcmd=view&quest_id=' + questID + '\" class=\"tip-static\" ' +\r\n    'data-tipped=\"Search for this quest on the Ultimate Fallen Sword Guide\" ' +\r\n    'style=\"background-image: url(\\'' + imageServer +\r\n    '/temple/1.gif\\');\" target=\"_blank\"></a>&nbsp;' +\r\n    '<a href=\"https://wiki.fallensword.com/index.php?title=' +\r\n    questName.replace(/ /g, '_') + '\" class=\"tip-static\" ' +\r\n    'data-tipped=\"Search for this quest on the Wiki\" ' +\r\n    'style=\"background-image: url(\\'' + imageServer +\r\n    '/skin/fs_wiki.gif\\');\" target=\"_blank\"></a></div>';\r\n}\r\n\r\nfunction isHideQuests() {\r\n  if (getValue('hideQuests')) {\r\n    return getValue('hideQuestNames').split(',');\r\n  }\r\n  return [];\r\n}\r\n\r\nfunction doHideQuests(hideQuests, questName, aRow) {\r\n  if (hideQuests.indexOf(questName) >= 0) {\r\n    aRow.classList.add('fshHide');\r\n    aRow.nextElementSibling.classList.add('fshHide');\r\n    aRow.nextElementSibling.nextElementSibling.classList.add('fshHide');\r\n    aRow.nextElementSibling.nextElementSibling.nextElementSibling\r\n      .classList.add('fshHide');\r\n  }\r\n}\r\n\r\nexport function injectQuestBookFull() {\r\n  pCC.addEventListener('click', dontPost);\r\n  storeQuestPage();\r\n  var questTable = pCC.getElementsByTagName('table')[5];\r\n  if (!questTable) {return;}\r\n  var hideQuests = isHideQuests();\r\n  for (var i = 2; i < questTable.rows.length; i += 4) {\r\n    var aRow = questTable.rows[i];\r\n    var questName = aRow.cells[0].textContent.replace(/ {2}/g, ' ').trim();\r\n    doHideQuests(hideQuests, questName, aRow);\r\n    var questID = /quest_id=(\\d+)/.exec(aRow.cells[4].innerHTML)[1];\r\n    aRow.cells[4].innerHTML = guideButtons(questID, questName);\r\n  }\r\n}\r\n\r\nexport function injectQuestTracker() {\r\n  var lastActiveQuestPage = getValue('lastActiveQuestPage');\r\n  if (lastActiveQuestPage.length > 0) {\r\n    pCC.getElementsByTagName('a')[0]\r\n      .setAttribute('href', lastActiveQuestPage);\r\n  }\r\n  var questID = getUrlParameter('quest_id');\r\n  var injectHere = pCC.getElementsByTagName('td')[0];\r\n  var questName = injectHere.getElementsByTagName('font')[1].textContent\r\n    .replace(/\"/g, '');\r\n  injectHere.insertAdjacentHTML('beforeend', guideButtons(questID, questName));\r\n}\r\n","import padZ from '../system/padZ';\r\n\r\nexport default function formatUtcDateTime(aDate) {\r\n  if (Object.prototype.toString.call(aDate) === '[object Date]' &&\r\n      !isNaN(aDate.getTime())) {\r\n    var yyyy = aDate.getUTCFullYear().toString();\r\n    var mon = padZ(aDate.getUTCMonth() + 1);\r\n    var dd = padZ(aDate.getUTCDate());\r\n    var hh = padZ(aDate.getUTCHours());\r\n    var mm = padZ(aDate.getUTCMinutes());\r\n    var ss = padZ(aDate.getUTCSeconds());\r\n    return yyyy + '-' + mon + '-' + dd + ' ' + hh + ':' + mm + ':' + ss;\r\n  }\r\n}\r\n","import buffList from '../support/buffObj';\r\nimport formatLocalDateTime from '../common/formatLocalDateTime';\r\nimport {getElementById} from '../common/getElement';\r\nimport getForage from '../ajax/getForage';\r\nimport getValue from '../system/getValue';\r\nimport setForage from '../ajax/setForage';\r\n\r\nfunction rejected(timeStamp, buffsNotCast, buffLog) {\r\n  if (buffsNotCast) {\r\n    return timeStamp + ' <span style=\"color: red;\">' +\r\n      buffsNotCast[0] + '</span><br>' + buffLog;\r\n  }\r\n  return buffLog;\r\n}\r\n\r\nfunction getStamUsed(buffCast) {\r\n  for (var j = 0; j < buffList.length; j += 1) {\r\n    if (buffList[j].name === buffCast[1]) {\r\n      return buffList[j].stam.toString();\r\n    }\r\n  }\r\n  return '-';\r\n}\r\n\r\nfunction successfull(timeStamp, buffCast, buffLog) {\r\n  if (buffCast) {\r\n    return timeStamp + ' ' + buffCast[0] + ' (' + getStamUsed(buffCast) +\r\n      ' stamina) <br>' + buffLog;\r\n  }\r\n  return buffLog;\r\n}\r\n\r\nfunction buffResult(_buffLog) {\r\n  var buffLog = _buffLog;\r\n  if (!buffLog) {buffLog = '';}\r\n  var timeStamp = formatLocalDateTime(new Date());\r\n  var buffsAttempted = getElementById('quickbuff-report')\r\n    .innerHTML.split('<p>');\r\n  var buffsNotCastRE = new RegExp('The skill ([\\\\w ]*) of current or' +\r\n    ' higher level is currently active on \\'(\\\\w*)\\'');\r\n  var buffsCastRE = new RegExp('Skill ([\\\\w ]*) level (\\\\d*) was ' +\r\n    'activated on \\'(\\\\w*)\\'');\r\n  for (var i = 0; i < buffsAttempted.length; i += 1) {\r\n    var buffCast = buffsCastRE.exec(buffsAttempted[i]);\r\n    var buffNotCast = buffsNotCastRE.exec(buffsAttempted[i]);\r\n    buffLog = successfull(timeStamp, buffCast, buffLog);\r\n    buffLog = rejected(timeStamp, buffNotCast, buffLog);\r\n  }\r\n  setForage('fsh_buffLog', buffLog);\r\n}\r\n\r\nexport default function updateBuffLog() {\r\n  if (!getValue('keepBuffLog')) {return;}\r\n  getForage('fsh_buffLog').done(buffResult);\r\n}\r\n","import findNode from '../system/findNode';\r\nimport {getElementById} from '../common/getElement';\r\nimport injectAdvisor from '../guildAdvisor';\r\nimport {injectQuestBookFull} from '../questBook';\r\nimport inventing from '../recipes';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {screenview} from '../support/fshGa';\r\nimport updateBuffLog from '../buffLog/updateBuffLog';\r\n\r\nvar unknown = [\r\n  {\r\n    condition: function() {\r\n      return getElementById('quickbuff-report');\r\n    },\r\n    result: function() {\r\n      screenview('unknown.buffLog.updateBuffLog');\r\n      updateBuffLog();\r\n    }\r\n  },\r\n  {\r\n    condition: function() {\r\n      return findNode('//td[.=\"Quest Name\"]');\r\n    },\r\n    result: function() {\r\n      screenview('unknown.questBook.injectQuestBookFull');\r\n      injectQuestBookFull();\r\n    }\r\n  },\r\n  {\r\n    condition: function() {\r\n      return findNode('//font[@size=2 and .=\"Advisor\"]') &&\r\n        findNode('//a[@href=\"index.php?cmd=guild&amp;subcmd=manage\" ' +\r\n          'and .=\"Back to Guild Management\"]');\r\n    },\r\n    result: function() {\r\n      screenview('unknown.guildAdvisor.injectAdvisor');\r\n      injectAdvisor();\r\n    }\r\n  },\r\n  // {\r\n  //   condition: function() {\r\n  //     return findNode('//a[.=\"Back to Scavenging\"]');\r\n  //   },\r\n  //   result: function() {\r\n  //     screenview('unknown.scavenging.injectScavenging');\r\n  //     FSH.scavenging.injectScavenging(); // Is this used???\r\n  //   }\r\n  // },\r\n  {\r\n    condition: function() {\r\n      return $('#pCC img[title=\"Inventing\"]').length > 0;\r\n    },\r\n    result: function() {\r\n      screenview('unknown.recipes.inventing');\r\n      inventing();\r\n    }\r\n  //#if _DEV  //  Fell through!\r\n  },\r\n  {\r\n    condition: function() {return true;},\r\n    result: function() {console.log('Fell through!');} // eslint-disable-line no-console\r\n  //#endif\r\n  }\r\n];\r\n\r\nexport default function unknownPage() { // Legacy\r\n  if (jQueryNotPresent) {return;}\r\n  //#if _DEV  //  unknownPage\r\n  console.log('unknownPage'); // eslint-disable-line no-console\r\n  //#endif\r\n  unknown.some(function(el) {\r\n    if (el.condition()) {\r\n      el.result();\r\n      return true;\r\n    }\r\n    return false;\r\n  });\r\n}\r\n","import collapse from '../common/collapse';\r\nimport getValue from '../system/getValue';\r\nimport {pCC} from '../support/layout';\r\nimport parseDateAsTimestamp from '../system/parseDateAsTimestamp';\r\nimport setValue from '../system/setValue';\r\nimport {simpleCheckbox} from '../settings/simpleCheckbox';\r\n\r\nvar ladderResetPref = 'lastLadderReset';\r\nvar lastLadderReset;\r\n\r\nfunction checkForPvPLadder(row) {\r\n  if (row.children[1].children[0].textContent === 'PvP Ladder') {\r\n    var logTime = parseDateAsTimestamp(\r\n      row.children[1].children[2].textContent.replace('Posted: ', ''));\r\n    if (logTime > lastLadderReset) {\r\n      setValue(ladderResetPref, logTime);\r\n      lastLadderReset = logTime;\r\n    }\r\n  }\r\n}\r\n\r\nfunction testArticle(rowType) {return rowType > 1;}\r\n\r\nfunction setupPref(prefName, rowInjector) {\r\n  rowInjector.insertAdjacentHTML('afterend', simpleCheckbox(prefName));\r\n}\r\n\r\nexport default function viewArchive() {\r\n  lastLadderReset = getValue(ladderResetPref);\r\n  var prefName = 'collapseNewsArchive';\r\n  var theTables = pCC.getElementsByTagName('table');\r\n  setupPref(prefName, theTables[0].rows[2]);\r\n  collapse({\r\n    prefName: prefName,\r\n    theTable: theTables[2],\r\n    headInd: 6,\r\n    articleTest: testArticle,\r\n    extraFn: checkForPvPLadder\r\n  });\r\n}\r\n","import getValue from '../system/getValue';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {pCC} from '../support/layout';\r\n\r\nfunction hasTextEntry() { // jQuery\r\n  $('#pCC form').first().attr('id', 'dochat');\r\n  $('#pCC input').slice(0, 7).each(function(i, e) {\r\n    $(e).attr('form', 'dochat');\r\n  });\r\n  var theTable = $('#pCC table table').first();\r\n  theTable.append('<tr id=\"fshMass\"></tr>');\r\n  $('td', theTable).eq(0).remove();\r\n  var btnMass = $('input[value=\"Send As Mass\"]', theTable);\r\n  if (btnMass.length === 1) {\r\n    btnMass.appendTo('#fshMass', theTable);\r\n  }\r\n  var ourTd = $('td', theTable).eq(0);\r\n  ourTd.attr('rowspan', '2');\r\n  $('input', ourTd).replaceWith('<textarea id=\"fshTxt\" name=\"msg\" cols' +\r\n    '=\"72\" rows=\"2\" form=\"dochat\" style=\"resize: none\"></textarea>');\r\n  var fshTxt = $('#fshTxt', ourTd);\r\n  fshTxt.keydown(function(e) {\r\n    if (e.keyCode === 13 && fshTxt.val() !== '') {\r\n      $('input[value=Send]', theTable).click();\r\n      return false;\r\n    }\r\n  });\r\n}\r\n\r\nvar tests = [\r\n  function() {return !getValue('enhanceChatTextEntry');},\r\n  function() {return !pCC;},\r\n  function() {return jQueryNotPresent();}\r\n];\r\n\r\nexport default function addChatTextArea() {\r\n  if (tests.some(function(el) {return el();})) {return;}\r\n  hasTextEntry();\r\n}\r\n","import calf from '../support/calf';\r\nimport parseDateAsTimestamp from '../system/parseDateAsTimestamp';\r\nimport setValue from '../system/setValue';\r\n\r\nfunction isLadderReset(aRow) {\r\n  return aRow.cells[2].firstElementChild &&\r\n    aRow.cells[2].firstElementChild.tagName === 'IMG' &&\r\n    aRow.cells[2].firstElementChild.src.indexOf('pvp_icon.gif') !== -1;\r\n}\r\n\r\nfunction saveLastResetTime(aRow) {\r\n  var logTime = parseDateAsTimestamp(aRow.cells[1].textContent);\r\n  if (logTime > calf.lastLadderReset) {\r\n    setValue('lastLadderReset', logTime);\r\n    calf.lastLadderReset = logTime;\r\n  }\r\n}\r\n\r\nexport default function processLadder(aRow, messageType) {\r\n  if (messageType === 'Notification' && isLadderReset(aRow)) {\r\n    saveLastResetTime(aRow);\r\n  }\r\n}\r\n","/* eslint-disable max-len */\r\nexport var specials = {\r\n  '0': 'Dull Edge was activated.',\r\n  '1': '@0 was afflicted by Super Elite Slayer.',\r\n  '2': '@0 was withered.',\r\n  '3': '@0\\'s armor was shattered.',\r\n  '4': '@0 was infused with extra defense (Constitution).',\r\n  '5': '@0 was infused with extra armor (Sanctuary).',\r\n  '7': '@0 activated Spectral Knight reducing targets armor to zero.',\r\n  '8': '@0 activated Savagery.',\r\n  '9': '@0 activated Shield Strike.',\r\n  '13': '@0 activated Conserve.',\r\n  '18': '@0 leeched the buff \\'@1\\'.',\r\n  '17': '@0 activated Four Leaf.',\r\n  '19': '@0\\'s demoralize skill reduced the effectiveness of @1\\'s enhancements.',\r\n  '20': '@0\\'s reckoning has improved their skill \\'@1\\'',\r\n  '21': '@0 was mesmerized by Spell Breaker, losing the \\'@1\\' buff.',\r\n  '22': '@0 was turned Undead by Necrosis.',\r\n  '23': '@0 activated High Guard.',\r\n  '24': '@0 was smote.',\r\n  '25': '@0 activated Barricade.',\r\n  '26': '@0 activated Ageless.',\r\n  '27': '@0 activated Severe Condition.',\r\n  '28': '@0 activated Golden Shield.',\r\n  '29': '@0 activated Anti Deflect.',\r\n  '30': '@0 activated Sealed. (Negated @1)',\r\n  '31': '@0 activated Fist Fight.',\r\n  '33': '@0 activated Dispel Curse.',\r\n  '35': '@0 activated Heavy Weight.',\r\n  '37': '@0 had their armor and defence Inverted.',\r\n  '38': '@0 had their attack reduced by Fumble.'\r\n};\r\n","import addCommas from '../system/addCommas';\r\nimport calf from '../support/calf';\r\nimport createDocument from '../system/createDocument';\r\nimport getForage from '../ajax/getForage';\r\nimport {nowSecs} from '../support/dataObj';\r\nimport parseDateAsTimestamp from '../system/parseDateAsTimestamp';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport {sendEvent} from '../support/fshGa';\r\nimport setForage from '../ajax/setForage';\r\nimport {specials} from '../support/specials';\r\nimport viewCombat from '../app/combat/view';\r\nimport {createDiv, createSpan} from '../common/cElement';\r\n\r\nvar combatCache = {};\r\n\r\nfunction result(stat, desc, color) {\r\n  if (stat !== 0) {\r\n    return desc + ':<span class=\"' + color + '\">' +\r\n      addCommas(stat) + ' </span>';\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction iDefended(json) {\r\n  return json.r.is_defender && json.r.winner === 1;\r\n}\r\n\r\nfunction iAttacked(json) {\r\n  return !json.r.is_defender && json.r.winner === 0;\r\n}\r\n\r\nfunction iWon(json) {\r\n  if (iDefended(json) || iAttacked(json)) {\r\n    return 'fshGreen';\r\n  }\r\n  return 'fshRed';\r\n}\r\n\r\nfunction highlightSpecials(prev, el) {\r\n  if (el.id === 18) {\r\n    return prev + '<br><span class=\"fshRed fshBold\">' + el.params[0] +\r\n      ' leeched the buff \\'' + el.params[1] + '\\'.</span>';\r\n  }\r\n  if (el.id === 21) {\r\n    return prev + '<br><span class=\"fshRed fshBold\">' + el.params[0] +\r\n      ' was mesmerized by Spell Breaker, losing the \\'' + el.params[1] +\r\n      '\\' buff.</span>';\r\n  }\r\n  return prev;\r\n}\r\n\r\nfunction parseCombat(combatSummary, json) {\r\n  if (!json.s) {return;}\r\n  var color = iWon(json);\r\n  combatSummary.innerHTML = result(json.r.xp_gain, 'XP stolen', color) +\r\n    result(json.r.gold_gain, 'Gold lost', color) +\r\n    result(json.r.gold_stolen, 'Gold stolen', color) +\r\n    result(json.r.pvp_prestige_gain, 'Prestige gain', color) +\r\n    result(json.r.pvp_rating_change, 'PvP change', color) +\r\n    json.r.specials.reduce(highlightSpecials, '');\r\n}\r\n\r\nfunction inSpecialsList(el) {\r\n  return el.id in specials;\r\n}\r\n\r\nfunction whatsMissing(json, html) {\r\n  var specialHtml = createDocument(html).querySelectorAll('#specialsDiv');\r\n  json.r.specials.forEach(function(el, i) {\r\n    if (!inSpecialsList(el)) {\r\n      //#if _DEV  //  PvP missing Special\r\n      console.log(JSON.stringify(el) + ' ' + specialHtml[i].textContent); // eslint-disable-line no-console\r\n      //#endif\r\n      sendEvent('Logs', 'Missing PvP Special',\r\n        JSON.stringify(el) + ' ' + specialHtml[i].textContent);\r\n    }\r\n  });\r\n}\r\n\r\nfunction unknownSpecials(json) {\r\n  if (!json.r.specials.every(inSpecialsList)) {\r\n    retryAjax('index.php?cmd=combat&subcmd=view&combat_id=' + json.r.id)\r\n      .done(whatsMissing.bind(null, json));\r\n  }\r\n}\r\n\r\nfunction cacheCombat(aRow, json) {\r\n  if (!json.s) {return;}\r\n  var cellContents = aRow.cells[1].textContent;\r\n  json.logTime = parseDateAsTimestamp(cellContents) / 1000;\r\n  combatCache[json.r.id] = json;\r\n  setForage('fsh_pvpCombat', combatCache);\r\n  unknownSpecials(json);\r\n}\r\n\r\nfunction processCombat(aRow) {\r\n  var combatID = /combat_id=(\\d+)/.exec(aRow.cells[2].innerHTML)[1];\r\n  var combatSummary = createDiv({style: {color: 'gray'}});\r\n  aRow.cells[2].appendChild(combatSummary);\r\n  if (combatCache[combatID] && combatCache[combatID].logTime) {\r\n    parseCombat(combatSummary, combatCache[combatID]);\r\n  } else {\r\n    viewCombat(combatID).done(cacheCombat.bind(null, aRow))\r\n      .done(parseCombat.bind(null, combatSummary));\r\n  }\r\n}\r\n\r\nfunction replaceLeadingText(msgCell, newHtml) {\r\n  var replaceText = createSpan({innerHTML: newHtml});\r\n  msgCell.replaceChild(replaceText, msgCell.firstChild);\r\n}\r\n\r\nfunction parseCombatWinner(msgCell) {\r\n  var victory = /You were victorious over/.test(msgCell.innerHTML);\r\n  if (victory) {\r\n    replaceLeadingText(msgCell,\r\n      'You were <span class=\"fshGreen\">victorious</span> over ');\r\n    return 1;\r\n  }\r\n  var defeat = /You were defeated by/.test(msgCell.innerHTML);\r\n  if (defeat) {\r\n    replaceLeadingText(msgCell,\r\n      'You were <span class=\"fshRed\">defeated</span> by ');\r\n    return 0;\r\n  }\r\n}\r\n\r\nfunction processCombatRow(aRow) {\r\n  var winner = parseCombatWinner(aRow.cells[2]);\r\n  if ([0, 1].includes(winner)) {processCombat(aRow);}\r\n}\r\n\r\nvar combatRowTests = [\r\n  function(aRow, messageType) {return messageType === 'Combat';},\r\n  function() {return calf.showPvPSummaryInLog;},\r\n  function(aRow) {\r\n    return aRow.cells[2] && /combat_id=/.test(aRow.cells[2].innerHTML);\r\n  },\r\n  function(aRow) {\r\n    return !/\\(Guild Conflict\\)/.test(aRow.cells[2].textContent);\r\n  }\r\n];\r\n\r\nfunction isCombatRow(aRow, messageType) {\r\n  return combatRowTests.every(function(e) {return e(aRow, messageType);});\r\n}\r\n\r\nexport function addPvpSummary(aRow, messageType) {\r\n  // add PvP combat log summary\r\n  if (isCombatRow(aRow, messageType)) {processCombatRow(aRow);}\r\n}\r\n\r\nfunction currentCombatRecord(data, combatId, sevenDays) {\r\n  return combatId === 'lastCheck' || data[combatId].logTime &&\r\n    data[combatId].logTime > sevenDays;\r\n}\r\n\r\nfunction cleanCache(data) {\r\n  var sevenDays = nowSecs - 7 * 24 * 60 * 60;\r\n  combatCache = Object.keys(data).reduce(function(prev, combatId) {\r\n    if (currentCombatRecord(data, combatId, sevenDays)) {\r\n      prev[combatId] = data[combatId];\r\n    }\r\n    return prev;\r\n  }, {});\r\n  combatCache.lastCheck = nowSecs;\r\n  setForage('fsh_pvpCombat', combatCache);\r\n}\r\n\r\nfunction prepareCache(data) {\r\n  var oneDay = nowSecs - 24 * 60 * 60;\r\n  if (!data.lastCheck || data.lastCheck < oneDay) {\r\n    cleanCache(data);\r\n  } else {\r\n    combatCache = data;\r\n  }\r\n}\r\n\r\nfunction checkCache(data) {\r\n  if (data) {prepareCache(data);}\r\n}\r\n\r\nexport function initCache() {\r\n  return getForage('fsh_pvpCombat').done(checkCache);\r\n}\r\n","import callApp from '../callApp';\r\n\r\nexport default function viewCombat(id) {\r\n  return callApp({\r\n    cmd: 'combat',\r\n    subcmd: 'view',\r\n    combat_id: id\r\n  });\r\n}\r\n","import buffList from '../support/buffObj';\r\nimport calf from '../support/calf';\r\nimport fallback from '../system/fallback';\r\nimport findNode from '../system/findNode';\r\nimport getMembrList from '../ajax/getMembrList';\r\nimport getValue from '../system/getValue';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport myStats from '../ajax/myStats';\r\nimport processLadder from './processLadder';\r\nimport {quickBuffHref} from '../support/layout';\r\nimport {addPvpSummary, initCache} from './addPvpSummary';\r\n\r\nvar myPlayer = {};\r\nvar addAttackLinkToLog;\r\nvar memberNameString;\r\nvar listOfAllies;\r\nvar listOfEnemies;\r\nvar nickList;\r\nvar enableChatParsing;\r\n\r\nfunction removeHTML(buffName) {\r\n  return buffName.replace(/<\\/?[^>]+(>|$)/g, '');\r\n}\r\n\r\nfunction reportIgnore(aRow, isGuildMate, playerName) { // Legacy\r\n  var extraPart = '';\r\n  var dateHTML = aRow.cells[1].innerHTML;\r\n  var dateFirstPart = dateHTML\r\n    .substring(0, dateHTML.indexOf('>Report') + 7);\r\n  var dateLastPart = dateHTML\r\n    .substring(dateHTML.indexOf('Message</a>') + 11, dateHTML.length);\r\n  if (!isGuildMate) {\r\n    extraPart = ' | <a title=\"Add to Ignore List\" href=\"index.php?cmd' +\r\n      '=log&subcmd=doaddignore&ignore_username=' + playerName +\r\n      '\">Ignore</a>';\r\n  }\r\n  aRow.cells[1].innerHTML = dateFirstPart + '</a>' + extraPart +\r\n    dateLastPart;\r\n}\r\n\r\nfunction buildNickList() {// Native\r\n  nickList = buffList.reduce(function(prev, curr) {\r\n    var ret = prev;\r\n    var nicks = curr.nicks.split(',');\r\n    nicks.forEach(function(el) {\r\n      var nick = el.toLowerCase();\r\n      ret[nick] = curr.id;\r\n    });\r\n    return ret;\r\n  }, {});\r\n}\r\n\r\nfunction doBuffLink(_buffsSent, targetPlayerID) { // Legacy\r\n  var quickBuff = '';\r\n  var buffsSent = _buffsSent[0].replace('`~', '').replace('~`', '')\r\n    .split(/\\s*,\\s*/);\r\n  buffsSent.reduce(function(prev, el) {\r\n    var ret = prev;\r\n    var nick = el.toLowerCase();\r\n    if (nickList[nick]) {\r\n      ret += nickList[nick].toString() + ';';\r\n    }\r\n    return ret;\r\n  }, '');\r\n  return ' | <a ' + quickBuffHref(targetPlayerID, quickBuff) +\r\n      '>Buff</a></span>';\r\n}\r\n\r\nfunction getAttackPart(playerName) { // Legacy\r\n  if (addAttackLinkToLog) {\r\n    return ' | <a href=\"index.php?cmd=attackplayer&target_username=' +\r\n      playerName + '\">Attack</a>';\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction isChat(aRow, isGuildMate, playerName) { // Legacy\r\n  var extraPart = '';\r\n  reportIgnore(aRow, isGuildMate, playerName);\r\n  var messageHTML = aRow.cells[2].innerHTML;\r\n  var firstPart = messageHTML.substring(0, messageHTML.indexOf('<small>') + 7);\r\n  var thirdPart = messageHTML.substring(messageHTML.indexOf('>Reply</a>') + 10,\r\n    messageHTML.indexOf('>Buff</a>') + 9);\r\n  var targetPlayerID = /quickBuff\\((\\d+)\\)/.exec(thirdPart)[1];\r\n  thirdPart = ' | <a ' + quickBuffHref(targetPlayerID) +\r\n    '>Buff</a></span>';\r\n  var fourthPart = messageHTML.substring(messageHTML\r\n    .indexOf('>Trade</a>') + 10, messageHTML.indexOf('</small>'));\r\n  var lastPart = messageHTML.substring(messageHTML.indexOf('</small>'),\r\n    messageHTML.length);\r\n  extraPart = ' | <a href=\"index.php?cmd=trade&target_player=' + playerName +\r\n    '\">Trade</a> | <a title=\"Secure Trade\" href=\"index.php?cmd=trade' +\r\n    '&subcmd=createsecure&target_username=' + playerName + '\">ST</a>';\r\n  var attackPart = getAttackPart(playerName);\r\n  var buffsSent = aRow.cells[2].innerHTML.match(/`~.*?~`/);\r\n  if (buffsSent) {\r\n    thirdPart = doBuffLink(buffsSent, targetPlayerID);\r\n  }\r\n  var replyTo = '';\r\n  if (enableChatParsing) {\r\n    replyTo = removeHTML(firstPart.replace(/&nbsp;/g, ' ')).substr(0, 140);\r\n  }\r\n  var msgReplyTo = '[ <span style=\"cursor:pointer;text-' +\r\n    'decoration:underline\"class=\"a-reply\" target_player=\"' + playerName +\r\n    '\" replyTo=\"' + replyTo + '...\">Reply</span>';\r\n  aRow.cells[2].innerHTML = firstPart + '<nobr>' + msgReplyTo +\r\n    extraPart + thirdPart + attackPart + fourthPart +\r\n    '</nobr>' + lastPart;\r\n}\r\n\r\nfunction doChat(messageType, aRow, isGuildMate, playerName) { // Legacy\r\n  if (messageType === 'Chat') {isChat(aRow, isGuildMate, playerName);}\r\n}\r\n\r\nfunction isEnemy(playerName, playerElement) { // Legacy\r\n  if (listOfEnemies.indexOf(playerName) !== -1) {\r\n    playerElement.style.color = 'red';\r\n  }\r\n}\r\n\r\nfunction isAlly(playerName, playerElement) { // Legacy\r\n  if (listOfAllies.indexOf(playerName) !== -1) {\r\n    playerElement.style.color = 'blue';\r\n  }\r\n}\r\n\r\nfunction playerColor(colorPlayerName, playerName, playerElement) { // Legacy\r\n  if (!colorPlayerName) {return false;}\r\n  if (memberNameString.indexOf(playerName) !== -1) {\r\n    playerElement.style.color = 'green';\r\n    return true;\r\n  }\r\n  isEnemy(playerName, playerElement);\r\n  isAlly(playerName, playerElement);\r\n  return false;\r\n}\r\n\r\nfunction addExtraStuff(aRow, playerName, isGuildMate) { // Legacy\r\n  if (!isGuildMate) {\r\n    var dateExtraText = '<nobr><span style=\"font-size:x-small;\">' +\r\n      '[ <a title=\"Add to Ignore List\" href=\"index.php?cmd=log' +\r\n      '&subcmd=doaddignore&ignore_username=' + playerName +\r\n      '\">Ignore</a> ]</span></nobr>';\r\n    aRow.cells[1].innerHTML = aRow.cells[1].innerHTML + '<br>' +\r\n      dateExtraText;\r\n  }\r\n  var buffingPlayerIDRE = /player_id=(\\d+)/;\r\n  var buffingPlayerID = buffingPlayerIDRE\r\n    .exec(aRow.cells[2].innerHTML)[1];\r\n  var buffingPlayerName = aRow.cells[2].firstChild.nextSibling\r\n    .innerHTML;\r\n  var extraText = ' <span style=\"font-size:x-small;\"><nobr>' +\r\n    '[ <span style=\"cursor:pointer;text-decoration:underline\" ' +\r\n    'class=\"a-reply\" target_player=\"' + buffingPlayerName +\r\n    '\">Reply</span> | <a href=\"index.php?cmd=trade&target_player=' +\r\n    buffingPlayerName + '\">Trade</a> | <a title=\"Secure Trade\" ' +\r\n    'href=\"index.php?cmd=trade&subcmd=createsecure&target_username=' +\r\n    buffingPlayerName + '\">ST</a>';\r\n  extraText += ' | <a ' + quickBuffHref(buffingPlayerID) +\r\n    '>Buff</a>';\r\n  if (addAttackLinkToLog) {\r\n    extraText += ' | <a href=\"index.php?cmd=attackplayer' +\r\n      '&target_username=' + buffingPlayerName + '\">Attack</a>';\r\n  }\r\n  extraText += ' ]</nobr></span>';\r\n\r\n  aRow.cells[2].innerHTML += extraText;\r\n}\r\n\r\nfunction hasPlayerLink(aRow) {\r\n  return aRow.cells[2].firstChild.nextSibling &&\r\n    aRow.cells[2].firstChild.nextSibling.nodeName === 'A' &&\r\n    /player_id/.test(aRow.cells[2].firstChild.nextSibling.href);\r\n}\r\n\r\nfunction otherMsgType(aRow, messageType) {\r\n  return fallback(messageType === 'General', messageType === 'Notification') &&\r\n    hasPlayerLink(aRow);\r\n}\r\n\r\nfunction doExtraStuff(aRow, messageType, playerName, isGuildMate) {\r\n  if (messageType === 'Notification' &&\r\n      hasPlayerLink(aRow)) {\r\n    addExtraStuff(aRow, playerName, isGuildMate);\r\n  }\r\n}\r\n\r\nfunction doLogWidgetRow(aRow, messageType) { // Legacy\r\n  var playerElement;\r\n  var playerName;\r\n  var colorPlayerName = false;\r\n  if (messageType === 'Chat') {\r\n    playerElement = aRow.cells[2].firstChild;\r\n    playerName = playerElement.innerHTML;\r\n    colorPlayerName = true;\r\n  }\r\n  if (otherMsgType(aRow, messageType)) {\r\n    playerElement = aRow.cells[2].firstChild.nextSibling;\r\n    playerName = playerElement.innerHTML;\r\n    colorPlayerName = true;\r\n  }\r\n  var isGuildMate = playerColor(colorPlayerName, playerName, playerElement);\r\n  doChat(messageType, aRow, isGuildMate, playerName);\r\n  doExtraStuff(aRow, messageType, playerName, isGuildMate);\r\n  addPvpSummary(aRow, messageType);\r\n  processLadder(aRow, messageType);\r\n}\r\n\r\nfunction processLogWidgetRow(aRow) { // Legacy\r\n  // Valid Types: General, Chat, Guild\r\n  var messageType = aRow.cells[0].firstChild.getAttribute('oldtitle');\r\n  if (messageType) {doLogWidgetRow(aRow, messageType);}\r\n}\r\n\r\nfunction foundLogTable(logTable) { // Legacy\r\n  memberNameString = Object.keys(calf.membrList);\r\n  listOfAllies = myPlayer._allies.map(function(obj) {\r\n    return obj.username;\r\n  });\r\n  listOfEnemies = myPlayer._enemies.map(function(obj) {\r\n    return obj.username;\r\n  });\r\n  calf.showPvPSummaryInLog = getValue('showPvPSummaryInLog');\r\n  calf.lastLadderReset = getValue('lastLadderReset');\r\n  enableChatParsing = getValue('enableChatParsing');\r\n  var messageHeader = logTable.rows[0].cells[2];\r\n  if (messageHeader) {\r\n    messageHeader.insertAdjacentHTML('beforeend', '&nbsp;&nbsp;' +\r\n      '<span class=\"fshWhite\">(Guild mates show up in ' +\r\n      '<span class=\"fshGreen\">green</span>)</span>');\r\n  }\r\n  for (var i = 1; i < logTable.rows.length; i += 2) {\r\n    processLogWidgetRow(logTable.rows[i]);\r\n  }\r\n  $('.a-reply').click(function(evt) {\r\n    window.openQuickMsgDialog(evt.target.getAttribute('target_player'),\r\n      '', evt.target.getAttribute('replyTo'));\r\n  });\r\n}\r\n\r\nfunction addLogWidgetsOld() { // Legacy\r\n  buildNickList();\r\n  addAttackLinkToLog = getValue('addAttackLinkToLog');\r\n  var logTable = findNode('//table[tbody/tr/td/span[contains' +\r\n    '(.,\"Currently showing:\")]]');\r\n  if (logTable) {foundLogTable(logTable);}\r\n}\r\n\r\nexport default function addLogWidgets() { // jQuery.min\r\n  if (jQueryNotPresent()) {return;}\r\n  $.when(\r\n    getMembrList(false),\r\n    myStats(false).done(function(data) {\r\n      myPlayer = data;\r\n    }),\r\n    initCache()\r\n  ).done(addLogWidgetsOld);\r\n}\r\n","import afterBegin from './common/afterBegin';\r\nimport {createSpan} from './common/cElement';\r\nimport {getElementById} from './common/getElement';\r\nimport getValue from './system/getValue';\r\nimport {imageServer} from './system/system';\r\nimport jQueryNotPresent from './common/jQueryNotPresent';\r\nimport {pCC} from './support/layout';\r\nimport perfFilter from './common/perfFilter';\r\nimport retryAjax from './ajax/retryAjax';\r\n\r\nfunction cancelAllAH() { // jQuery\r\n  var cancelButtons = getElementById('resultRows')\r\n    .getElementsByClassName('auctionCancel');\r\n  if (cancelButtons.length === 0) {return;}\r\n  var prm = [];\r\n  for (var i = cancelButtons.length - 1; i >= 0; i -= 1) {\r\n    var cancelButton = cancelButtons[i];\r\n    var itemImage = cancelButton.parentNode.parentNode.firstElementChild\r\n      .firstElementChild;\r\n    cancelButton.outerHTML = '<img src=\"' + imageServer +\r\n      '/skin/loading.gif\" width=\"14\" height=\"14\">';\r\n    prm.push(\r\n      retryAjax({\r\n        url: 'index.php?no_mobile=1&cmd=auctionhouse&subcmd=cancel',\r\n        data: {auction_id: /inv_id=(\\d+)/.exec(itemImage.dataset.tipped)[1]}\r\n      })\r\n    );\r\n  }\r\n  $.when.apply($, prm).done(function() {\r\n    getElementById('refresh').click();\r\n  });\r\n}\r\n\r\nfunction makeCancelAll() {\r\n  var cancelAll = createSpan({\r\n    className: 'smallLink',\r\n    textContent: 'Cancel All'\r\n  });\r\n  var fill = getElementById('fill').parentNode.parentNode\r\n    .nextElementSibling.firstElementChild;\r\n  fill.classList.add('fshCenter');\r\n  fill.insertAdjacentHTML('afterbegin', ']');\r\n  afterBegin(fill, cancelAll);\r\n  fill.insertAdjacentHTML('afterbegin', '[');\r\n  cancelAll.addEventListener('click', cancelAllAH);\r\n}\r\n\r\nfunction autoFill() {\r\n  if (getValue('autoFillMinBidPrice')) {\r\n    getElementById('auto-fill').checked = true;\r\n  }\r\n}\r\n\r\nexport function injectAuctionHouse() {\r\n  if (jQueryNotPresent() || !pCC) {return;}\r\n  makeCancelAll();\r\n  autoFill();\r\n  getElementById('sort0').click();\r\n}\r\n\r\nexport function quickCreate() {\r\n  perfFilter('auction');\r\n}\r\n","import createDocument from './system/createDocument';\r\nimport jQueryPresent from './common/jQueryPresent';\r\nimport retryAjax from './ajax/retryAjax';\r\n\r\nvar playerBank = {\r\n  headText: 'Bank',\r\n  appLink: true,\r\n  depoPos: 2,\r\n  balPos: 1,\r\n  data: {\r\n    no_mobile: 1,\r\n    cmd: 'bank',\r\n    subcmd: 'transaction'\r\n  },\r\n  initWithdraw: ''\r\n};\r\nvar guildBank = {\r\n  headText: 'Guild Bank',\r\n  appLink: false,\r\n  depoPos: 3,\r\n  balPos: 2,\r\n  data: {\r\n    no_mobile: 1,\r\n    cmd: 'guild',\r\n    subcmd: 'bank',\r\n    subcmd2: 'transaction'\r\n  },\r\n  initWithdraw: '1'\r\n};\r\nvar bankSettings;\r\n\r\nfunction doInfoBox(infoBox) { // jQuery\r\n  var target = $('#pCC #info-msg');\r\n  if (target.length === 0) {\r\n    $('#pCC').prepend(infoBox.closest('table'));\r\n  } else {\r\n    target.closest('table').replaceWith(infoBox.closest('table'));\r\n  }\r\n}\r\n\r\nfunction disableDepo(o) { // jQuery\r\n  if ($('#pCC b').eq(o.depoPos).text() === '0') {\r\n    $('#pCC input[value=\"Deposit\"]').prop('disabled', true);\r\n  }\r\n}\r\n\r\nfunction updateDepoAmount(o, doc) { // jQuery\r\n  if (o.data.deposit_amount !== '1') {\r\n    $('#pCC #deposit_amount').val($('#pCC #deposit_amount', doc).val());\r\n  } else {\r\n    $('#pCC #deposit_amount').val('1');\r\n  }\r\n}\r\n\r\nfunction transResponse(response) { // jQuery\r\n  var doc = createDocument(response);\r\n  var infoBox = $('#pCC #info-msg', doc);\r\n  if (infoBox.length === 0) {return;}\r\n  doInfoBox(infoBox);\r\n  $('#pH #statbar-gold').text($('#pH #statbar-gold', doc).text());\r\n  $('#pH #statbar-gold-tooltip-general dd').text(function(index) {\r\n    return $('#pH #statbar-gold-tooltip-general dd', doc).eq(index).text();\r\n  });\r\n  var o = bankSettings;\r\n  $('#pCC b').slice(o.balPos).text(function(index) {\r\n    return $('#pCC b', doc).slice(o.balPos).eq(index).text();\r\n  });\r\n  disableDepo(o);\r\n  updateDepoAmount(o, doc);\r\n  $('#pCC #withdraw_amount').val(o.initWithdraw);\r\n}\r\n\r\nfunction invalidAmount(o, amount) { // jQuery\r\n  return $('#pCC b').eq(o.depoPos).text() === '0' ||\r\n    !$.isNumeric(amount) || amount < 1;\r\n}\r\n\r\nfunction doAjax(oData) {\r\n  retryAjax({url: 'index.php', data: oData}).done(transResponse);\r\n}\r\n\r\nfunction bankDeposit(e) { // jQuery\r\n  e.preventDefault();\r\n  var o = bankSettings;\r\n  var amount = $('#pCC #deposit_amount').val();\r\n  if (invalidAmount(o, amount)) {return;}\r\n  o.data.mode = 'deposit';\r\n  o.data.deposit_amount = amount;\r\n  doAjax(o.data);\r\n}\r\n\r\nfunction bankWithdrawal(e) { // jQuery\r\n  e.preventDefault();\r\n  var o = bankSettings;\r\n  var amount = $('#pCC #withdraw_amount').val();\r\n  if (!$.isNumeric(amount) || amount < 1) {return;}\r\n  o.data.mode = 'withdraw';\r\n  o.data.withdraw_amount = amount;\r\n  doAjax(o.data);\r\n}\r\n\r\nfunction linkToGuildBank(o, bank) { // jQuery\r\n  if (o.appLink) {\r\n    bank.eq(0).closest('tr').after('<tr><td colspan=\"3\" align=\"center\">' +\r\n      '<a href=\"/index.php?cmd=guild&subcmd=bank\">Go to Guild Bank</a>' +\r\n      '</td></tr>');\r\n  }\r\n}\r\n\r\nfunction captureButtons(o, depo, withdraw) { // jQuery\r\n  if ($('#pCC b').eq(o.depoPos).text() === '0') { // Check Deposits Available\r\n    depo.prop('disabled', true);\r\n  } else {\r\n    depo.click(bankDeposit);\r\n  }\r\n  withdraw.click(bankWithdrawal);\r\n}\r\n\r\nfunction appLink(o, bank) { // jQuery\r\n  linkToGuildBank(o, bank);\r\n  var depo = $('#pCC input[value=\"Deposit\"]');\r\n  if (depo.length !== 1) {return;}\r\n  var withdraw = $('#pCC input[value=\"Withdraw\"]');\r\n  if (withdraw.length !== 1) {return;}\r\n  captureButtons(o, depo, withdraw);\r\n}\r\n\r\nfunction hasJquery() { // jQuery\r\n  var o = bankSettings;\r\n  var bank = $('#pCC b');\r\n  if (bank.length !== 0 && bank.eq(0).text() === o.headText) {\r\n    appLink(o, bank);\r\n  }\r\n}\r\n\r\nfunction ajaxifyBank() {\r\n  if (jQueryPresent()) {hasJquery();}\r\n}\r\n\r\nexport function injectGuildBank() {\r\n  bankSettings = guildBank;\r\n  ajaxifyBank();\r\n}\r\n\r\nexport function injectBank() {\r\n  bankSettings = playerBank;\r\n  ajaxifyBank();\r\n}\r\n","var invItems;\r\nvar type;\r\nvar itemId;\r\n\r\nfunction tickElement(o, el) {\r\n  el.checked = !el.disabled && !el.checked;\r\n}\r\n\r\nvar types = [\r\n  {\r\n    c: function() {return type === 'guild';},\r\n    r: function(o, el) {\r\n      el.checked = !el.disabled && invItems[o.invid].guild_tag !== '-1';\r\n    }\r\n  },\r\n  {\r\n    c: function(o) {\r\n      return type === 'item' && invItems[o.invid].item_id === itemId;\r\n    },\r\n    r: tickElement\r\n  },\r\n  {\r\n    c: function() {return type === 'checkAll';},\r\n    r: tickElement\r\n  }\r\n];\r\n\r\nfunction testType(o, el) {\r\n  types.some(function(test) {\r\n    if (test.c(o)) {\r\n      test.r(o, el);\r\n      return true;\r\n    }\r\n    return false;\r\n  });\r\n}\r\n\r\nexport default function doCheckboxes(itemsAry, invItems_, type_, itemId_) {\r\n  invItems = invItems_;\r\n  type = type_;\r\n  itemId = itemId_;\r\n  itemsAry.forEach(function(o) {\r\n    var tr = o.injectHere.parentNode;\r\n    if (tr.classList.contains('fshHide')) {return;}\r\n    var el = o.el.parentNode.parentNode.previousElementSibling\r\n      .firstElementChild;\r\n    testType(o, el);\r\n  });\r\n}\r\n","import calf from '../support/calf';\r\nimport {pCC} from '../support/layout';\r\n\r\nvar insertHere;\r\n\r\nfunction showHideLabel(pref) {\r\n  if (pref) {return 'Hide';}\r\n  return 'Show';\r\n}\r\n\r\nexport default function doToggleButtons(showExtraLinks, showQuickDropLinks) {\r\n  // Option toggle buttons for both screens\r\n  if (!insertHere) {\r\n    insertHere = pCC.getElementsByTagName('form')[0]\r\n      .previousElementSibling.firstElementChild;\r\n  }\r\n  var inject = '[<span id=\"fshShowExtraLinks\" class=\"sendLink\">' +\r\n    showHideLabel(showExtraLinks) +\r\n    ' AH and UFSG links</span>]&nbsp;' +\r\n    '[<span id=\"fshShowQuickDropLinks\" class=\"sendLink\">' +\r\n    showHideLabel(showQuickDropLinks) +\r\n    ' Quick Drop links</span>]&nbsp;';\r\n  if (calf.subcmd2 === 'storeitems') {\r\n    inject += '[<span id=\"fshSelectAllGuildLocked\" class=\"sendLink\">' +\r\n      ' Select All Guild Locked</span>]&nbsp;';\r\n  }\r\n  insertHere.innerHTML = inject;\r\n}\r\n","import add from '../support/task';\r\nimport addStatTotalToMouseover from '../common/addStatTotalToMouseover';\r\nimport doCheckboxes from './doCheckboxes';\r\nimport doFolderButtons from './doFolderButtons';\r\nimport doToggleButtons from './doToggleButtons';\r\nimport dropItem from '../ajax/dropItem';\r\nimport eventHandler from '../common/eventHandler';\r\nimport fallback from '../system/fallback';\r\nimport getInventoryById from '../ajax/getInventoryById';\r\nimport getValue from '../system/getValue';\r\nimport hideFolders from './hideFolders';\r\nimport injectMoveItems from './injectMoveItems';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport moreToDo from '../common/moreToDo';\r\nimport moveItemsToFolder from './moveItemsToFolder';\r\nimport {pCC} from '../support/layout';\r\nimport quickAction from './quickAction';\r\nimport sendItem from '../ajax/sendItem';\r\nimport setValue from '../system/setValue';\r\nimport toggleForce from '../common/toggleForce';\r\nimport {guideUrl, itemRE, rarity} from '../support/dataObj';\r\n\r\nvar disableItemColoring;\r\nvar showExtraLinks;\r\nvar showQuickDropLinks;\r\nvar showQuickSendLinks;\r\nvar extraLinks;\r\nvar paintCount;\r\nvar itemsAry;\r\nvar checkAll;\r\nvar itemsHash;\r\nvar dropLinks;\r\nvar invItems;\r\nvar colouring;\r\nvar sendLinks;\r\n\r\nfunction getItemImg() {\r\n  var allTables = pCC.getElementsByTagName('table');\r\n  var lastTable = allTables[allTables.length - 1];\r\n  return lastTable.getElementsByTagName('img');\r\n}\r\n\r\nfunction afterbegin(o, item) {\r\n  if (fallback(extraLinks, !showExtraLinks)) {\r\n    return;\r\n  }\r\n  var pattern = '<span><span class=\"aHLink\">';\r\n  if (!item.bound) {\r\n    pattern += '[<a href=\"index.php?cmd=auctionhouse&search_text=' +\r\n      encodeURIComponent(item.item_name) + '\">AH</a>]';\r\n  }\r\n  pattern += '</span>[<a href=\"' + guideUrl +\r\n    'items&subcmd=view&item_id=' + item.item_id +\r\n    '\" target=\"_blank\">UFSG</a>]</span>';\r\n  o.injectHere.insertAdjacentHTML('afterbegin', pattern);\r\n}\r\n\r\nfunction itemColouring(o, item) {\r\n  if (!colouring && !disableItemColoring) {\r\n    o.injectHere.classList.add(rarity[item.rarity].clas);\r\n  }\r\n}\r\n\r\nvar buildTrailer = [\r\n  {\r\n    test: function(item) {\r\n      return !checkAll && itemsHash[item.item_id] !== 1;\r\n    },\r\n    act: function(o, item) {\r\n      return ' [<span linkto=\"' + item.item_id +\r\n        '\" class=\"fshLink\">Check all</span>]';\r\n    }\r\n  },\r\n  {\r\n    test: function(item) {\r\n      return !sendLinks && showQuickSendLinks &&\r\n        !item.bound;\r\n    },\r\n    act: function(o) {\r\n      return ' <span class=\"quickAction sendLink tip-static\" ' +\r\n        'itemInvId=\"' + o.invid + '\" data-tipped=\"INSTANTLY SENDS THE ' +\r\n        'ITEM. NO REFUNDS OR DO-OVERS! Use at own risk.\">[Quick Send]</span>';\r\n    }\r\n  },\r\n  {\r\n    test: function(item) {\r\n      return !dropLinks && showQuickDropLinks &&\r\n        item.guild_tag === '-1';\r\n    },\r\n    act: function(o) {\r\n      return ' <span class=\"quickAction dropLink tip-static\" itemInvId=\"' +\r\n        o.invid + '\" data-tipped=\"INSTANTLY DROP THE ITEM. NO REFUNDS ' +\r\n        'OR DO-OVERS! Use at own risk.\">[Quick Drop]</span>';\r\n    }\r\n  }\r\n];\r\n\r\nfunction beforeend(o, item) {\r\n  itemColouring(o, item);\r\n  var pattern = buildTrailer.reduce(function(prev, el) {\r\n    var ret = prev;\r\n    if (el.test(item)) {\r\n      ret += el.act(o, item);\r\n    }\r\n    return ret;\r\n  }, '');\r\n  if (pattern !== '') {o.injectHere.insertAdjacentHTML('beforeend', pattern);}\r\n}\r\n\r\nfunction doneInvPaint() {\r\n  if (showExtraLinks) {extraLinks = true;}\r\n  checkAll = true;\r\n  colouring = true;\r\n  if (showQuickDropLinks) {dropLinks = true;}\r\n  sendLinks = true;\r\n}\r\n\r\nfunction invPaint() { // Native - abstract this pattern\r\n  var limit = performance.now() + 5;\r\n  while (moreToDo(limit, paintCount, itemsAry)) {\r\n    var o = itemsAry[paintCount];\r\n    var item = invItems[o.invid];\r\n    afterbegin(o, item);\r\n    beforeend(o, item);\r\n    paintCount += 1;\r\n  }\r\n  if (paintCount < itemsAry.length) {\r\n    add(3, invPaint);\r\n  } else {\r\n    doneInvPaint();\r\n  }\r\n}\r\n\r\nfunction toggleShowExtraLinks() {\r\n  showExtraLinks = !showExtraLinks;\r\n  setValue('showExtraLinks', showExtraLinks);\r\n  doToggleButtons(showExtraLinks, showQuickDropLinks);\r\n  if (!extraLinks) {\r\n    paintCount = 0;\r\n    add(3, invPaint);\r\n  } else {\r\n    itemsAry.forEach(function(o) {\r\n      var el = o.injectHere.firstElementChild;\r\n      toggleForce(el, !showExtraLinks);\r\n    });\r\n  }\r\n}\r\n\r\nfunction toggleShowQuickDropLinks() {\r\n  showQuickDropLinks = !showQuickDropLinks;\r\n  setValue('showQuickDropLinks', showQuickDropLinks);\r\n  doToggleButtons(showExtraLinks, showQuickDropLinks);\r\n  if (!dropLinks) {\r\n    paintCount = 0;\r\n    add(3, invPaint);\r\n  } else {\r\n    itemsAry.forEach(function(o) {\r\n      var el = o.injectHere.querySelector('.dropLink');\r\n      toggleForce(el, !showQuickDropLinks);\r\n    });\r\n  }\r\n}\r\n\r\nvar evts = [\r\n  {\r\n    test: function(self) {return self.id === 'fshShowExtraLinks';},\r\n    act: toggleShowExtraLinks\r\n  },\r\n  {\r\n    test: function(self) {return self.id === 'fshShowQuickDropLinks';},\r\n    act: toggleShowQuickDropLinks\r\n  },\r\n  {\r\n    test: function(self) {return self.id === 'fshSelectAllGuildLocked';},\r\n    act: function() {doCheckboxes(itemsAry, invItems, 'guild');}\r\n  },\r\n  {\r\n    test: function(self) {return self.id === 'fshMove';},\r\n    act: function() {moveItemsToFolder(itemsAry);}\r\n  },\r\n  {\r\n    test: function(self) {return self.hasAttribute('linkto');},\r\n    act: function(self) {\r\n      doCheckboxes(itemsAry, invItems, 'item', self.getAttribute('linkto'));\r\n    }\r\n  },\r\n  {\r\n    test: function(self) {return self.classList.contains('sendLink');},\r\n    act: function(self) {\r\n      quickAction(self, sendItem, 'Sent', '.dropLink');\r\n    }\r\n  },\r\n  {\r\n    test: function(self) {return self.classList.contains('dropLink');},\r\n    act: function(self) {\r\n      quickAction(self, dropItem, 'Dropped', '.sendLink');\r\n    }\r\n  },\r\n  {\r\n    test: function(self) {return self.classList.contains('fshFolder');},\r\n    act: function(self) {\r\n      hideFolders(itemsAry, invItems, self);\r\n    }\r\n  },\r\n  {\r\n    test: function(self) {return self.id === 'fshChkAll';},\r\n    act: function() {\r\n      doCheckboxes(itemsAry, invItems, 'checkAll');\r\n    }\r\n  }\r\n];\r\n\r\nfunction getItems() {\r\n  addStatTotalToMouseover();\r\n  disableItemColoring = getValue('disableItemColoring');\r\n  showExtraLinks = getValue('showExtraLinks');\r\n  showQuickDropLinks = getValue('showQuickDropLinks');\r\n  showQuickSendLinks = getValue('showQuickSendLinks');\r\n  doToggleButtons(showExtraLinks, showQuickDropLinks);\r\n  pCC.addEventListener('click', eventHandler(evts));\r\n  var imgList = getItemImg();\r\n  itemsAry = [];\r\n  itemsHash = {};\r\n  Array.prototype.forEach.call(imgList, function(el) {\r\n    var tipped = el.dataset.tipped;\r\n    var matches = tipped.match(itemRE);\r\n    itemsHash[matches[1]] = (itemsHash[matches[1]] || 0) + 1;\r\n    var injectHere = el.parentNode.parentNode.nextElementSibling;\r\n    itemsAry.push({\r\n      el: el,\r\n      invid: matches[2],\r\n      injectHere: injectHere\r\n    });\r\n  });\r\n  // Exclude composed pots\r\n  itemsHash[13699] = 1;\r\n}\r\n\r\nfunction inventory(data) {\r\n  extraLinks = false;\r\n  checkAll = false;\r\n  invItems = data.items;\r\n  colouring = false;\r\n  dropLinks = false;\r\n  sendLinks = false;\r\n  paintCount = 0;\r\n  add(3, invPaint);\r\n  doFolderButtons(data.folders);\r\n}\r\n\r\nexport function injectStoreItems() {\r\n  if (jQueryNotPresent()) {return;}\r\n  getInventoryById().done(inventory);\r\n  add(3, getItems);\r\n}\r\n\r\nexport function injectProfileDropItems() {\r\n  injectStoreItems();\r\n  injectMoveItems();\r\n}\r\n","import calf from '../support/calf';\r\nimport makeFolderSpans from '../common/makeFolderSpans';\r\nimport {pCC} from '../support/layout';\r\nimport {createTd, createTr} from '../common/cElement';\r\n\r\nfunction extraButtons() {\r\n  var tRows = pCC.getElementsByTagName('table')[0].rows;\r\n  tRows[tRows.length - 2].cells[0].insertAdjacentHTML('afterbegin',\r\n    '<input id=\"fshChkAll\" value=\"Check All\" type=\"button\">&nbsp;');\r\n}\r\n\r\nexport default function doFolderButtons(folders) {\r\n  if (calf.subcmd2 === 'storeitems') {\r\n    var formNode = pCC.getElementsByTagName('form')[0];\r\n    var tr = createTr({className: 'fshCenter'});\r\n    var insertHere = createTd({colSpan: 3});\r\n    tr.appendChild(insertHere);\r\n    formNode.parentNode.insertBefore(tr, formNode);\r\n    insertHere.innerHTML = makeFolderSpans(folders);\r\n    extraButtons();\r\n  }\r\n}\r\n","import {imageServer} from '../system/system';\r\n\r\nfunction anotherSpinner(self) {\r\n  self.innerHTML = '<img class=\"quickActionSpinner\" src=\"' +\r\n    imageServer +\r\n    '/skin/loading.gif\" width=\"15\" height=\"15\">';\r\n}\r\n\r\nexport default function quickAction(self, fn, success, otherClass) { // jQuery.min\r\n  self.className = 'quickAction';\r\n  var itemInvId = self.getAttribute('itemInvId');\r\n  fn([itemInvId]).done(function(data) {\r\n    if (data.r === 1) {return;}\r\n    self.style.color = 'green';\r\n    self.innerHTML = success;\r\n  });\r\n  $(self).qtip('hide');\r\n  anotherSpinner(self);\r\n  var theTd = self.parentNode;\r\n  var otherButton = theTd.querySelector(otherClass);\r\n  if (otherButton) {\r\n    otherButton.className = 'quickAction';\r\n    otherButton.innerHTML = '';\r\n  }\r\n  var checkbox = theTd.parentNode.firstElementChild.firstElementChild;\r\n  checkbox.checked = false;\r\n  checkbox.disabled = true;\r\n}\r\n","import {getElementById} from '../common/getElement';\r\n\r\nvar maxcharacters;\r\nvar textArea;\r\nvar shoutboxPreview;\r\n\r\nfunction updateShoutboxPreview() {\r\n  var textContent = textArea.value;\r\n  var chars = textContent.length;\r\n  if (chars > maxcharacters) {\r\n    textContent = textContent.substring(0, maxcharacters);\r\n    textArea.value = textContent;\r\n    chars = maxcharacters;\r\n  }\r\n  if (!shoutboxPreview) {\r\n    shoutboxPreview = textArea.parentNode.parentNode.parentNode.parentNode\r\n      .insertRow().insertCell();\r\n  }\r\n  shoutboxPreview.innerHTML = '<table class=\"sbpTbl\"><tbody><tr>' +\r\n    '<td class=\"sbpHdr\">Preview (' + chars + '/' + maxcharacters +\r\n    ' characters)</td></tr><tr><td class=\"sbpMsg\"><span>' + textContent +\r\n    '</span></td></tr></tbody></table>';\r\n}\r\n\r\nfunction injectShoutboxWidgets() {\r\n  textArea = getElementById('textInputBox');\r\n  textArea.addEventListener('keyup', updateShoutboxPreview);\r\n}\r\n\r\nexport function newsFsbox() {\r\n  maxcharacters = 100;\r\n  injectShoutboxWidgets();\r\n}\r\n\r\nexport function newsShoutbox() {\r\n  maxcharacters = 150;\r\n  injectShoutboxWidgets();\r\n}\r\n","import fallback from '../system/fallback';\r\nimport {getElementById} from '../common/getElement';\r\nimport moveItem from '../ajax/moveItem';\r\n\r\nexport default function moveItemsToFolder(itemsAry) { // jQuery.min\r\n  var folderId = getElementById('selectFolderId').value;\r\n  var batchNo;\r\n  var counter = 0;\r\n  var invList = [];\r\n  var prm = [];\r\n  itemsAry.forEach(function(o) {\r\n    var el = o.injectHere.previousElementSibling.previousElementSibling\r\n      .firstElementChild;\r\n    if (el.checked) {\r\n      batchNo = Math.floor(counter / 50);\r\n      invList[batchNo] = fallback(invList[batchNo], []);\r\n      invList[batchNo].push(o.invid);\r\n      counter += 1;\r\n      if (counter % 50 === 0) {\r\n        prm.push(moveItem(invList[batchNo], folderId));\r\n      }\r\n    }\r\n  });\r\n  if (counter % 50 !== 0) {\r\n    prm.push(moveItem(invList[batchNo], folderId));\r\n  }\r\n  $.when.apply($, prm).done(function() {location.reload();}); // TODO ajaxify this\r\n}\r\n","import toggleForce from '../common/toggleForce';\r\n\r\nexport default function hideFolders(itemsAry, invItems, self) {\r\n  var folderId = self.dataset.folder;\r\n  itemsAry.forEach(function(o) {\r\n    o.el.parentNode.parentNode.previousElementSibling.firstElementChild\r\n      .checked = false;\r\n    var tr = o.injectHere.parentNode;\r\n    var separator = tr.nextElementSibling;\r\n    if (folderId === '0') {\r\n      tr.classList.remove('fshHide');\r\n      separator.classList.remove('fshHide');\r\n    } else {\r\n      var folder = invItems[o.invid].folder_id;\r\n      var force = folderId !== folder;\r\n      toggleForce(tr, force);\r\n      toggleForce(separator, force);\r\n    }\r\n  });\r\n}\r\n","import allowBack from '../guide/allowBack';\r\nimport completedArenas from '../arena/completedArenas';\r\nimport composingBreakdown from '../composing/breakdown';\r\nimport craftForge from '../craftForge/craftForge';\r\nimport globalQuest from '../topRated/globalQuest';\r\nimport guildHall from '../guild/hall';\r\nimport guildMailbox from '../mailbox/guildMailbox';\r\nimport injectAdvisor from '../guildAdvisor';\r\nimport injectArena from '../arena/arena';\r\nimport injectBazaar from '../bazaar';\r\nimport injectBioWidgets from '../profile/bio/bioWidgets';\r\nimport injectBuffLog from '../buffLog/injectBuffLog';\r\nimport injectGroupStats from '../groups/injectGroupStats';\r\nimport injectGroups from '../groups/groups';\r\nimport injectGuild from '../guild/guild';\r\nimport injectGuildAddTagsWidgets from '../guild/injectGuildAddTagsWidgets';\r\nimport injectGuildRanks from '../rank';\r\nimport {injectInventoryManagerNew} from '../inventory/inventory';\r\nimport injectMailbox from '../mailbox/mailbox';\r\nimport injectMonsterLog from '../monstorLog';\r\nimport injectNewGuildLog from '../newGuildLog/newGuildLog';\r\nimport injectNotepadShowLogs from '../combatLog';\r\nimport injectOnlinePlayers from '../onlinePlayers';\r\nimport injectProfile from '../profile/profile';\r\nimport injectQuickBuff from '../quickBuff';\r\nimport injectRPUpgrades from '../guild/injectRPUpgrades';\r\nimport injectRecipeManager from '../recipeMgr/recipeMgr';\r\nimport injectReportPaint from '../guildReport/guildReport';\r\nimport injectSaveSettings from '../settings/load';\r\nimport injectScavenging from '../scavenging';\r\nimport injectScouttower from '../scoutTower/injectScouttower';\r\nimport injectSettings from '../settings/injectSettings';\r\nimport injectTitan from '../scoutTower/injectTitan';\r\nimport injectTopRated from '../topRated/toprated';\r\nimport injectTrade from '../trade/trade';\r\nimport injectViewGuild from '../guild/injectViewGuild';\r\nimport injectWorld from '../legacy';\r\nimport insertQuickExtract from '../quickExtract';\r\nimport insertQuickWear from '../quickWear/quickWear';\r\nimport inventing from '../recipes';\r\nimport ladder from '../ladder';\r\nimport marketplace from '../marketplace';\r\nimport parseGoldUpgrades from '../notification/parseGoldUpgrades';\r\nimport {parseTemplePage} from '../notification/parseTemplePage';\r\nimport setupMoves from '../arena/setup';\r\nimport showAllQuestSteps from '../guide/showAllQuestSteps';\r\nimport storeMoves from '../arena/store';\r\nimport storePlayerUpgrades from '../upgrades';\r\nimport superelite from '../seLog/superelite';\r\nimport unknownPage from './unknownPage';\r\nimport viewArchive from '../news/viewArchive';\r\nimport {composingCreate, injectComposing} from '../composing/composing';\r\nimport {guildChat, guildLog, outbox, playerLog} from '../logs/logs';\r\nimport {injectAuctionHouse, quickCreate} from '../auctionHouse';\r\nimport {injectAuctionSearch, injectQuickLinkManager} from '../lists/lists';\r\nimport {injectBank, injectGuildBank} from '../bank';\r\nimport {injectFindBuffs, injectFindOther} from '../findBuffs/findBuffs';\r\nimport {\r\n  injectFindPlayer,\r\n  injectFsBoxContent,\r\n  injectNotepad\r\n} from '../misc';\r\nimport {injectProfileDropItems, injectStoreItems} from '../dropItems/dropItems';\r\nimport {injectQuestBookFull, injectQuestTracker} from '../questBook';\r\nimport {newsFsbox, newsShoutbox} from '../news/news';\r\n\r\nexport default {\r\n  settings: {'-': {'-': {'-': {'-': injectSettings}}}},\r\n  world: {'-': {'-': {'-': {'-': injectWorld}}}},\r\n  news: {\r\n    fsbox: {'-': {'-': {'-': newsFsbox}}},\r\n    shoutbox: {'-': {'-': {'-': newsShoutbox}}}\r\n  },\r\n  blacksmith: {repairall: {'-': {'-': {'1': injectWorld}}}},\r\n  arena: {\r\n    '-': {'-': {'-': {'-': injectArena}}},\r\n    join: {'-': {'-': {'-': injectArena}}},\r\n    completed: {'-': {'-': {'-': completedArenas}}},\r\n    pickmove: {'-': {'-': {'-': storeMoves}}},\r\n    setup: {'-': {'-': {'-': setupMoves}}}\r\n  },\r\n  questbook: {\r\n    '-': {'-': {'-': {'-': injectQuestBookFull}}},\r\n    atoz: {'-': {'-': {'-': injectQuestBookFull}}},\r\n    viewquest: {'-': {'-': {'-': injectQuestTracker}}}\r\n  },\r\n  profile: {\r\n    '-': {'-': {'-': {'-': injectProfile}}},\r\n    managecombatset: {'-': {'-': {'-': injectProfile}}},\r\n    report: {'-': {'-': {'-': injectProfile}}},\r\n    equipitem: {'-': {'-': {'-': injectProfile}}},\r\n    useitem: {'-': {'-': {'-': injectProfile}}},\r\n    changebio: {'-': {'-': {'-': injectBioWidgets}}},\r\n    dropitems: {'-': {'-': {'-': injectProfileDropItems}}}\r\n  },\r\n  auctionhouse: {\r\n    '-': {'-': {'-': {'-': injectAuctionHouse}}},\r\n    quickcreate: {'-': {'-': {'-': quickCreate}}}\r\n  },\r\n  guild: {\r\n    inventory: {\r\n      report: {'-': {'-': injectReportPaint}},\r\n      addtags: {'-': {'-': injectGuildAddTagsWidgets}},\r\n      removetags: {'-': {'-': injectGuildAddTagsWidgets}},\r\n      storeitems: {'-': {'-': injectStoreItems}}\r\n    },\r\n    chat: {'-': {'-': {'-': guildChat}}},\r\n    log: {'-': {'-': {'-': guildLog}}},\r\n    groups: {\r\n      viewstats: {'-': {'-': injectGroupStats}},\r\n      joinallgroupsundersize: {'-': {'-': injectGroups}},\r\n      joinall: {'-': {'-': injectGroups}},\r\n      '-': {'-': {'-': injectGroups}}\r\n    },\r\n    manage: {'-': {'-': {'-': injectGuild}}},\r\n    advisor: {\r\n      '-': {'-': {'-': injectAdvisor}},\r\n      weekly: {'-': {'-': injectAdvisor}}\r\n    },\r\n    history: {'-': {'-': {'-': injectBioWidgets}}},\r\n    view: {'-': {'-': {'-': injectViewGuild}}},\r\n    scouttower: {'-': {'-': {'-': injectScouttower}}},\r\n    mailbox: {'-': {'-': {'-': guildMailbox}}},\r\n    ranks: {'-': {'-': {'-': injectGuildRanks}}},\r\n    conflicts: {rpupgrades: {'-': {'-': injectRPUpgrades}}},\r\n    bank: {'-': {'-': {'-': injectGuildBank}}},\r\n    hall: {'-': {'-': {'-': guildHall}}}\r\n  },\r\n  bank: {'-': {'-': {'-': {'-': injectBank}}}},\r\n  log: {\r\n    '-': {'-': {'-': {'-': playerLog}}},\r\n    outbox: {'-': {'-': {'-': outbox}}}\r\n  },\r\n  potionbazaar: {'-': {'-': {'-': {'-': injectBazaar}}}},\r\n  marketplace: {createreq: {'-': {'-': {'-': marketplace}}}},\r\n  quickbuff: {'-': {'-': {'-': {'-': injectQuickBuff}}}}, // No ga\r\n  notepad: {\r\n    showlogs: {'-': {'-': {'-': injectNotepadShowLogs}}}, // done\r\n    invmanagernew: {'-': {'-': {'-': injectInventoryManagerNew}}},\r\n    guildinvmgr: {'-': {'-': {'-': injectInventoryManagerNew}}},\r\n    recipemanager: {'-': {'-': {'-': injectRecipeManager}}}, // done\r\n    auctionsearch: {'-': {'-': {'-': injectAuctionSearch}}},\r\n    onlineplayers: {'-': {'-': {'-': injectOnlinePlayers}}}, // done\r\n    quicklinkmanager: {'-': {'-': {'-': injectQuickLinkManager}}}, // done\r\n    monsterlog: {'-': {'-': {'-': injectMonsterLog}}}, // done\r\n    quickextract: {'-': {'-': {'-': insertQuickExtract}}}, // done\r\n    quickwear: {'-': {'-': {'-': insertQuickWear}}}, // done\r\n    fsboxcontent: {'-': {'-': {'-': injectFsBoxContent}}}, // done\r\n    bufflogcontent: {'-': {'-': {'-': injectBuffLog}}}, // done\r\n    newguildlog: {'-': {'-': {'-': injectNewGuildLog}}},\r\n    findbuffs: {'-': {'-': {'-': injectFindBuffs}}}, // done\r\n    findother: {'-': {'-': {'-': injectFindOther}}}, // done\r\n    savesettings: {'-': {'-': {'-': injectSaveSettings}}},\r\n    '-': {'-': {'-': {'-': injectNotepad}}}\r\n  },\r\n  points: {\r\n    '-': {\r\n      '-': {\r\n        '-': {'-': storePlayerUpgrades},\r\n        '0': {'-': storePlayerUpgrades},\r\n        '1': {'-': parseGoldUpgrades}\r\n      }\r\n    }\r\n  },\r\n  trade: {\r\n    '-': {'-': {'-': {'-': injectTrade}}},\r\n    createsecure: {'-': {'-': {'-': injectTrade}}},\r\n    docreatesecure: {'-': {'-': {'-': injectTrade}}}\r\n  },\r\n  titan: {'-': {'-': {'-': {'-': injectTitan}}}},\r\n  toprated: {\r\n    xp: {'-': {'-': {'-': injectTopRated}}},\r\n    monthlyxp: {'-': {'-': {'-': injectTopRated}}},\r\n    gold: {'-': {'-': {'-': injectTopRated}}},\r\n    killstreak: {'-': {'-': {'-': injectTopRated}}},\r\n    bounties: {'-': {'-': {'-': injectTopRated}}},\r\n    risingstars: {'-': {'-': {'-': injectTopRated}}},\r\n    arena: {'-': {'-': {'-': injectTopRated}}},\r\n    superelites: {'-': {'-': {'-': injectTopRated}}},\r\n    smasher: {'-': {'-': {'-': injectTopRated}}},\r\n    globalquest: {'-': {'-': {'-': globalQuest}}}\r\n  },\r\n  inventing: {viewrecipe: {'-': {'-': {'-': inventing}}}},\r\n  tempinv: {'-': {'-': {'-': {'-': injectMailbox}}}},\r\n  findplayer: {'-': {'-': {'-': {'-': injectFindPlayer}}}},\r\n  quests: { // UFSG\r\n    '-': {'-': {'-': {'-': allowBack}}},\r\n    view: {'-': {'-': {'-': showAllQuestSteps}}}\r\n  },\r\n  items: {'-': {'-': {'-': {'-': allowBack}}}}, // UFSG\r\n  creatures: {'-': {'-': {'-': {'-': allowBack}}}}, // UFSG\r\n  masterrealms: {'-': {'-': {'-': {'-': allowBack}}}}, // UFSG\r\n  realms: {'-': {'-': {'-': {'-': allowBack}}}}, // UFSG\r\n  relics: {'-': {'-': {'-': {'-': allowBack}}}}, // UFSG\r\n  shops: {'-': {'-': {'-': {'-': allowBack}}}}, // UFSG\r\n  scavenging: {'-': {'-': {'-': {'-': injectScavenging}}}},\r\n  temple: {'-': {'-': {'-': {'-': parseTemplePage}}}},\r\n  composing: {\r\n    '-': {'-': {'-': {'-': injectComposing}}},\r\n    breakdown: {'-': {'-': {'-': composingBreakdown}}},\r\n    create: {'-': {'-': {'-': composingCreate}}}\r\n  },\r\n  pvpladder: {'-': {'-': {'-': {'-': ladder}}}},\r\n  crafting: {'-': {'-': {'-': {'-': craftForge}}}},\r\n  hellforge: {'-': {'-': {'-': {'-': craftForge}}}},\r\n  superelite: {'-': {'-': {'-': {'-': superelite}}}},\r\n  '-': {\r\n    viewupdatearchive: {'-': {'-': {'-': viewArchive}}},\r\n    viewarchive: {'-': {'-': {'-': viewArchive}}},\r\n    '-': {'-': {'-': {'-': unknownPage}}}\r\n  }\r\n};\r\n","import add from '../support/task';\r\nimport calf from '../support/calf';\r\nimport doQuickLinks from './doQuickLinks';\r\nimport fallback from '../system/fallback';\r\nimport getUrlParameter from '../system/getUrlParameter';\r\nimport isMessageSound from './isMessageSound';\r\nimport lookForHcsData from './lookForHcsData';\r\nimport pageSwitcher from './pageSwitcher';\r\nimport {end, screenview, setup, start} from '../support/fshGa';\r\n\r\nvar coreFunction;\r\nvar functionPath;\r\n\r\nfunction getType(cmd) {\r\n  var type = '-';\r\n  if (cmd === 'points') {\r\n    type = fallback(getUrlParameter('type'), '-');\r\n  }\r\n  return type;\r\n}\r\n\r\nfunction newSelector(selector) {\r\n  var test_cmd = document.querySelector(selector);\r\n  return test_cmd && test_cmd.value || '-';\r\n}\r\n\r\nvar isValid = [\r\n  function(cmd) {return pageSwitcher[cmd];},\r\n  function(cmd, subcmd) {return pageSwitcher[cmd][subcmd];},\r\n  function(cmd, subcmd, subcmd2) {return pageSwitcher[cmd][subcmd][subcmd2];},\r\n  function(cmd, subcmd, subcmd2, type) {\r\n    return pageSwitcher[cmd][subcmd][subcmd2][type];\r\n  }\r\n];\r\n\r\nfunction testCoreFunction(cmd, subcmd, subcmd2, type, fromWorld) {\r\n  if (isValid.every(function(e) {\r\n    return typeof e(cmd, subcmd, subcmd2, type) === 'object';\r\n  }) && pageSwitcher[cmd][subcmd][subcmd2][type][fromWorld]) {\r\n    return pageSwitcher[cmd][subcmd][subcmd2][type][fromWorld];\r\n  }\r\n}\r\n\r\nfunction getCoreFunction() {\r\n  var cmd;\r\n  var subcmd;\r\n  var subcmd2;\r\n  var type;\r\n  var fromWorld;\r\n  if (document.location.search !== '') {\r\n    cmd = fallback(getUrlParameter('cmd'), '-');\r\n    subcmd = fallback(getUrlParameter('subcmd'), '-');\r\n    subcmd2 = fallback(getUrlParameter('subcmd2'), '-');\r\n    type = getType(cmd);\r\n    fromWorld = fallback(getUrlParameter('fromworld'), '-');\r\n  } else {\r\n    cmd = newSelector('input[name=\"cmd\"]');\r\n    subcmd = newSelector('input[name=\"subcmd\"]');\r\n    if (subcmd === 'dochat') {\r\n      cmd = '-';\r\n      subcmd = '-';\r\n    }\r\n    subcmd2 = newSelector('input[name=\"subcmd2\"]');\r\n    type = '-';\r\n    fromWorld = '-';\r\n  }\r\n  calf.cmd = cmd;\r\n  calf.subcmd = subcmd;\r\n  calf.subcmd2 = subcmd2;\r\n  functionPath = cmd + '/' + subcmd + '/' + subcmd2 + '/' + type + '/' +\r\n    fromWorld;\r\n\r\n  coreFunction = testCoreFunction(cmd, subcmd, subcmd2, type, fromWorld);\r\n}\r\n\r\nfunction devHooks() {\r\n  /* eslint-disable no-console */\r\n  console.log('functionPath', functionPath);\r\n  if (!coreFunction) {\r\n    console.log('No Core Function.');\r\n  } else if (typeof coreFunction !== 'function') {\r\n    console.log('Not Core Function.');\r\n  }\r\n  /* eslint-enable no-console */\r\n}\r\n\r\nfunction asyncDispatcher() {\r\n  //#if _DEV  //  asyncDispatcher messages\r\n  devHooks();\r\n  //#endif\r\n  if (typeof coreFunction === 'function') {\r\n    screenview(functionPath);\r\n    start('JS Perf', functionPath);\r\n    coreFunction();\r\n    end('JS Perf', functionPath);\r\n  }\r\n}\r\n\r\nwindow.FSH = window.FSH || {};\r\nwindow.FSH.calf = '$_CALFVER';\r\n\r\n// main event dispatcher\r\nwindow.FSH.dispatch = function dispatch() {\r\n\r\n  setup();\r\n  start('JS Perf', 'FSH.dispatch');\r\n\r\n  getCoreFunction();\r\n  lookForHcsData();\r\n  add(3, asyncDispatcher);\r\n\r\n  if (typeof window.jQuery === 'undefined') {return;}\r\n\r\n  isMessageSound();\r\n\r\n  /* This must be at the end in order not to\r\n  screw up other findNode calls (Issue 351) */\r\n  doQuickLinks();\r\n\r\n  end('JS Perf', 'FSH.dispatch');\r\n\r\n};\r\n","import {pCC} from '../support/layout';\r\n\r\nexport default function injectMoveItems() {\r\n  var flrRow = pCC.getElementsByTagName('form')[0]\r\n    .nextElementSibling.nextElementSibling.nextElementSibling;\r\n  var folders = flrRow.getElementsByTagName('img');\r\n  var flrEnabled;\r\n  var oFlr;\r\n  var options = '<tr><td class=\"fshCenter\">Move selected items to: ' +\r\n    '<select name=\"folder\" id=\"selectFolderId\" class=\"customselect\">';\r\n  Array.prototype.forEach.call(folders, function(e) {\r\n    var src = e.getAttribute('src');\r\n    if (src.indexOf('/folder_on.gif') !== -1) {flrEnabled = true;}\r\n    if (src.indexOf('/folder.gif') !== -1) {\r\n      oFlr = true;\r\n      options += '<option value=' + e.parentNode.href\r\n        .match(/&folder_id=(-*\\d+)/i)[1] + '>' +\r\n        e.parentNode.parentNode.textContent + '</option>';\r\n    }\r\n  });\r\n  if (!flrEnabled || !oFlr) {return;}\r\n  options += '</select>&nbsp;<input type=\"button\" class=\"custombutton\" ' +\r\n    'id=\"fshMove\" value=\"Move\"></td></tr>';\r\n  flrRow.insertAdjacentHTML('afterend', options);\r\n}\r\n","import add from '../support/task';\r\nimport eventHandlers from './eventHandlers';\r\nimport getMembrList from '../ajax/getMembrList';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {pCC} from '../support/layout';\r\nimport prepareChildRows from './prepareChildRows';\r\nimport reportHeader from './reportHeader';\r\nimport searchUser from './searchUser';\r\n\r\nexport default function injectReportPaint() { // jQuery\r\n  if (jQueryNotPresent()) {return;}\r\n  getMembrList(false).done(function() {\r\n    add(3, reportHeader);\r\n  });\r\n  add(2, searchUser);\r\n  add(3, prepareChildRows);\r\n  pCC.getElementsByTagName('TABLE')[1]\r\n    .addEventListener('click', eventHandlers);\r\n}\r\n","import addChatTextArea from './addChatTextArea';\r\nimport addGuildLogWidgets from './addGuildLogWidgets';\r\nimport addLogColoring from './addLogColoring';\r\nimport addLogWidgets from './addLogWidgets';\r\n\r\nexport function guildChat() {\r\n  addChatTextArea();\r\n  addLogColoring('Chat', 0);\r\n}\r\n\r\nexport function guildLog() {\r\n  addLogColoring('GuildLog', 1);\r\n  addGuildLogWidgets();\r\n}\r\n\r\nexport function outbox() {\r\n  addLogColoring('OutBox', 1);\r\n}\r\n\r\nexport function playerLog() {\r\n  addLogColoring('PlayerLog', 1);\r\n  addLogWidgets();\r\n}\r\n","import {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport jsonParse from '../common/jsonParse';\r\nimport {pCC} from '../support/layout';\r\nimport setValue from '../system/setValue';\r\n\r\nexport default function injectSaveSettings() { // Hybrid\r\n  if (jQueryNotPresent()) {return;}\r\n  var content = pCC;\r\n  var fshSettings = {};\r\n  var list = GM_listValues();\r\n  for (var i = 0; i < list.length; i += 1) {\r\n    fshSettings[list[i]] = getValue(list[i]);\r\n  }\r\n  content.innerHTML = '<h1>FSH Settings</h1><br><center>The box below ' +\r\n    'is your current settings. Copy it to save your current settings<br>' +\r\n    'To load saved settings, simply replace the contents of the box with ' +\r\n    'your saved copy and press the button below.' +\r\n    '<textarea align=\"center\" cols=\"80\" rows=\"25\" style=\"' +\r\n    'background-color:white;' +\r\n    'font-family:Consolas,\\'Lucida Console\\',\\'Courier New\\',monospace;\" ' +\r\n    'id=\"HelperfshSettings\" name=\"fshSettings\">' +\r\n    JSON.stringify(fshSettings) + '</textarea>' +\r\n    '<br><input id=\"HelperLoadSettings\" class=\"custombutton\" ' +\r\n    'type=\"submit\" value=\"Load Settings!\" /></center>';\r\n  $('#HelperLoadSettings').click(function() {\r\n    var userInput = jsonParse(getElementById('HelperfshSettings').value);\r\n    if (typeof userInput === 'object') {\r\n      var settings = userInput;\r\n      Object.keys(settings).forEach(function(id) {\r\n        setValue(id, settings[id]);\r\n      });\r\n      $('#dialog_msg').text('Settings loaded successfully!').dialog('open');\r\n    }\r\n  });\r\n}\r\n","import {pCC} from '../support/layout';\r\n\r\nexport default function injectTitan() {\r\n  var titanTable = pCC.children[0];\r\n  var newRow = titanTable.insertRow(2);\r\n  newRow.insertAdjacentHTML('beforeend', '<br>');\r\n  newRow = titanTable.insertRow(3);\r\n  newRow.insertAdjacentHTML('beforeend', '<td class=\"fshCenter fshBold\">[ ' +\r\n    '<a href=\"index.php?cmd=guild&subcmd=scouttower\">Scout Tower</a> ]</td>');\r\n}\r\n","import {pCC} from '../support/layout';\r\n\r\nexport default function globalQuest() {\r\n  var topTable = pCC.getElementsByTagName('table')[3];\r\n  for (var i = 2; i < topTable.rows.length; i += 4) {\r\n    var aCell = topTable.rows[i].cells[1];\r\n    aCell.innerHTML = '<a href=\"index.php?cmd=findplayer' +\r\n      '&search_show_first=1&search_active=1&search_username=' +\r\n      aCell.textContent + '\">' + aCell.textContent + '</a>';\r\n  }\r\n}\r\n","import {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\n\r\nexport default function showAllQuestSteps() {\r\n  if (!getValue('showNextQuestSteps')) {return;}\r\n  Array.prototype.forEach.call(document.querySelectorAll('div[id^=\"stage\"]'),\r\n    function(e) {e.style.display = 'block';});\r\n  getElementById('next_stage_button').style.display = 'none';\r\n}\r\n"]}