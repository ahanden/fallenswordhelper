{"version":3,"sources":["modules/common/isType.js","modules/common/isUndefined.js","modules/common/getElement.js","modules/common/insertHtml.js","modules/common/insertHtmlBeforeEnd.js","modules/support/debug.js","modules/common/playerId.js","modules/support/fshGa.js","modules/support/gmApi.js","modules/system/fallback.js","modules/common/isFunction.js","modules/support/sch.js","modules/support/task.js","modules/support/calf.js","modules/common/dragStart.js","modules/system/escapeHtml.js","modules/support/defaultQuickSearchList.js","modules/support/dataObj.js","modules/system/getValue.js","modules/common/jsonParse.js","modules/system/getValueJSON.js","modules/system/system.js","modules/chrome/doQuickLinks.js","modules/system/getCustomUrlParameter.js","modules/system/getUrlParameter.js","modules/chrome/isMessageSound.js","modules/common/isObject.js","modules/common/jQueryNotPresent.js","modules/support/constants.js","modules/chrome/changeGuildLogHREF.js","modules/common/stringifyError.js","modules/ajax/getForage.js","modules/common/extend.js","modules/ajax/retryAjax.js","modules/app/callApp.js","modules/common/jQueryPresent.js","modules/common/cElement.js","modules/common/insertElement.js","modules/common/jConfirm.js","modules/ajax/setForage.js","modules/guild/guildTracker/indexConstants.js","modules/guild/guildActivity.js","modules/app/guild/manage.js","modules/system/createDocument.js","modules/system/getRandomInt.js","modules/common/insertElementBefore.js","modules/common/insertHtmlAfterBegin.js","modules/common/insertHtmlAfterEnd.js","modules/support/layout.js","modules/system/rnd.js","modules/system/setValue.js","modules/composing/composing.js","modules/common/levelHighlight.js","modules/lists/makePageHeader.js","modules/lists/makePageTemplate.js","modules/common/quickBuffHref.js","modules/system/intValue.js","modules/monstorLog.js","modules/combatLog.js","modules/misc.js","modules/chrome/jQueryDialog.js","modules/chrome/injectFSBoxLog.js","modules/buffLog/injectBuffLog.js","modules/system/addCommas.js","modules/common/doSortParams.js","modules/system/path.js","modules/system/sortDesc.js","modules/system/numberSort.js","modules/system/stringSort.js","modules/common/currentGuildId.js","modules/onlinePlayers.js","modules/recipeMgr/generateRecipeTable.js","modules/system/shouldBeArray.js","modules/recipeMgr/processFirstPage.js","modules/recipeMgr/parseInventing.js","modules/common/jsonFail.js","modules/quickExtract.js","modules/recipeMgr/recipeMgr.js","modules/common/eventHandler.js","modules/ajax/getInventory.js","modules/common/outputResult.js","modules/app/profile/useitem.js","modules/quickWear/createQuickWear.js","modules/ajax/dialog.js","modules/ajax/equipItem.js","modules/quickWear/showAHInvManager.js","modules/system/isChecked.js","modules/settings/simple.js","modules/quickWear/quickWear.js","modules/settings/settingObj.js","modules/settings/simpleCheckbox.js","modules/common/toggleForce.js","modules/app/errorDialog.js","modules/ajax/useItem.js","modules/lists/lists.js","modules/app/profile/loadInventory.js","modules/system/setValueJSON.js","modules/support/buffObj.js","modules/common/colouredDots.js","modules/findBuffs/pageLayout.js","modules/common/moreToDo.js","modules/findBuffs/parseProfileAndDisplay.js","modules/common/playerName.js","modules/findBuffs/assets.js","modules/findBuffs/findBuffs.js","modules/chrome/helperMenu.js","modules/chrome/accordion.js","modules/chrome/messaging.js","modules/system/parseDateAsTimestamp.js","modules/news/injectHomePageTwoLink.js","modules/notification/injectJoinAllLink.js","modules/common/insertElementAfter.js","modules/chrome/injectServerNode.js","modules/notification/displayDisconnectedFromGodsMessage.js","modules/notification/parseTemplePage.js","modules/notification/injectTempleAlert.js","modules/notification/displayUpgradeMsg.js","modules/notification/parseGoldUpgrades.js","modules/notification/injectUpgradeAlert.js","modules/common/insertElementAfterBegin.js","modules/chrome/interceptQuickBuff.js","modules/chrome/navMenu.js","modules/system/outputFormat.js","modules/system/formatLastActivity.js","modules/ajax/getProfile.js","modules/ajax/myStats.js","modules/common/openQuickBuffByName.js","modules/chrome/allyEnemy.js","modules/activeWantedBounties/lists.js","modules/activeWantedBounties/findTarget.js","modules/activeWantedBounties/createDivs.js","modules/activeWantedBounties/injectBountyList.js","modules/activeWantedBounties/injectWantedList.js","modules/activeWantedBounties/parseBountyPageForWorld.js","modules/activeWantedBounties/activeWantedBounties.js","modules/newMap/sendGold.js","modules/chrome/keyHandler.js","modules/common/infoBox.js","modules/system/findNodes.js","modules/system/findNode.js","modules/seLog/seLog.js","modules/chrome/scoutTowerLink.js","modules/app/superelite.js","modules/chrome/statBar.js","modules/chrome/widgets.js","modules/system/padZ.js","modules/chrome/calc.js","modules/chrome/lookForHcsData.js","modules/guide/allowBack.js","modules/arena/assets.js","modules/common/perfFilter.js","modules/composing/breakdown.js","modules/arena/completedArenas.js","modules/ajax/getInventoryById.js","modules/craftForge/craftForge.js","modules/common/makeFolderSpans.js","modules/common/collapse.js","modules/guild/hall.js","modules/common/closest.js","modules/mailbox/guildMailbox.js","modules/ajax/getMembrList.js","modules/guildAdvisor.js","modules/arena/arena.js","modules/bazaar.js","modules/system/testRange.js","modules/system/testQuant.js","modules/app/potionbazaar/buyitem.js","modules/profile/bio/bioEvtHdl.js","modules/profile/bio/bioWidgets.js","modules/groups/injectGroupStats.js","modules/groups/groups.js","modules/guild/guildTracker/trackerTable.js","modules/guild/guildTracker/rawData.js","modules/guild/guildTracker/guildTracker.js","modules/guild/guild.js","modules/rank.js","modules/common/insertTextBeforeEnd.js","modules/profile/bio/render.js","modules/ajax/getMercStats.js","modules/ajax/groupViewStats.js","modules/common/doBuffLinks.js","modules/ajax/getGroupStats.js","modules/common/alpha.js","modules/common/formatLocalDateTime.js","modules/common/toggleVisibilty.js","modules/system/getIntFromRegExp.js","modules/guild/guildUtils.js","modules/guild/injectGuildAddTagsWidgets.js","modules/app/guild/inventory/takeitem.js","modules/inventory/assets.js","modules/inventory/options.js","modules/inventory/render/craftRender.js","modules/inventory/render/createdRow.js","modules/inventory/render/gsRender.js","modules/inventory/render/wearUseRender.js","modules/inventory/render/whereData.js","modules/inventory/render/playerName.js","modules/system/isSelected.js","modules/inventory/table.js","modules/inventory/render/nameRender.js","modules/inventory/render/whereRender.js","modules/inventory/render/whereRenderDisplay.js","modules/inventory/render/whereRenderFilter.js","modules/inventory/render/durabilityRender.js","modules/inventory/render/bpRender.js","modules/inventory/render/dropRender.js","modules/inventory/render/sendRender.js","modules/inventory/setChecks.js","modules/inventory/eventHandlers/allChecks.js","modules/inventory/eventHandlers/changeLvls.js","modules/inventory/eventHandlers/clearChecks.js","modules/inventory/eventHandlers/doAction.js","modules/ajax/dropItem.js","modules/inventory/eventHandlers/getChecks.js","modules/ajax/moveItem.js","modules/inventory/eventHandlers/resetChecks.js","modules/inventory/eventHandlers/resetLvls.js","modules/ajax/sendItem.js","modules/ajaxQueue/queue.js","modules/ajax/takeItem.js","modules/ajax/backpack.js","modules/app/guild/inventory/recall.js","modules/inventory/eventHandlers/eventHandlers.js","modules/app/guild/inventory/dostoreitems.js","modules/inventory/filters.js","modules/logs/addGuildLogWidgets.js","modules/logs/addLogColoring.js","modules/inventory/inventory.js","modules/inventory/decorate.js","modules/inventory/headers.js","modules/inventory/setLvls.js","modules/inventory/clearButton.js","modules/mailbox/mailbox.js","modules/newGuildLog/profiler.js","modules/newGuildLog/assets.js","modules/newGuildLog/newGuildLog.js","modules/profile/ajaxifyProfileSections.js","modules/common/insertHtmlBeforeBegin.js","modules/common/addStatTotalToMouseover.js","modules/profile/debuff.js","modules/profile/nekidBtn.js","modules/profile/components.js","modules/profile/fastWear.js","modules/app/profile/unequipitem.js","modules/profile/profileInjectGuildRel.js","modules/dropItems/doCheckboxes.js","modules/profile/profileInjectQuickButton.js","modules/profile/profileAllyEnemy.js","modules/profile/bio/bio.js","modules/profile/selectAllLink.js","modules/profile/updateNmv.js","modules/profile/updateStatistics.js","modules/profile/profile.js","modules/profile/storeVL.js","modules/profile/quickWearLink.js","modules/dropItems/doToggleButtons.js","modules/dropItems/getPrefs.js","modules/dropItems/getItems.js","modules/dropItems/injectStoreItems.js","modules/dropItems/doFolderButtons.js","modules/dropItems/quickAction.js","modules/dropItems/moveItemsToFolder.js","modules/dropItems/hideFolders.js","modules/quickBuff.js","modules/common/reduceBuffArray.js","modules/guild/injectRPUpgrades.js","modules/guildReport/eventHandlers.js","modules/guildReport/potReport.js","modules/guildReport/prepareChildRows.js","modules/guildReport/reportHeader.js","modules/guildReport/searchUser.js","modules/topRated/toprated.js","modules/scavenging.js","modules/scoutTower/injectScouttowerBuffLinks.js","modules/common/isNaN.js","modules/common/roundToString.js","modules/common/round.js","modules/scoutTower/injectScouttower.js","modules/settings/generalPrefs.js","modules/settings/guildPrefs.js","modules/settings/worldPrefs.js","modules/settings/configData.js","modules/settings/logPrefs.js","modules/settings/equipPrefs.js","modules/settings/questPrefs.js","modules/settings/profilePrefs.js","modules/settings/bountyPrefs.js","modules/settings/otherPrefs.js","modules/settings/injectSettings.js","modules/common/common.js","modules/app/guild/view.js","modules/trade/doFolders.js","modules/guild/injectViewGuild.js","modules/trade/trade.js","modules/legacy/findImps.js","modules/legacy/getImpsRemaining.js","modules/legacy/hasCA.js","modules/legacy/hasDblr.js","modules/newMap/combatLogger.js","modules/newMap/doNotKill.js","modules/newMap/relic/assets.js","modules/newMap/relic/primaryElements.js","modules/newMap/relic/secondaryElements.js","modules/newMap/relic/parseGuild.js","modules/newMap/relic/calcs.js","modules/newMap/relic/relic.js","modules/newMap/assets.js","modules/newMap/titanStats/realm.js","modules/newMap/titanStats/placeholders.js","modules/newMap/titanStats/buildTitanInfoTable.js","modules/newMap/titanStats/hasTitan.js","modules/newMap/titanStats/titanStats.js","modules/newMap/buttons.js","modules/newMap/titanStats/common.js","modules/newMap/titanStats/processTitans.js","modules/app/guild/scouttower.js","modules/newMap/shop.js","modules/newMap/onWorld.js","modules/newMap/viewCreature/evalAnalysis.js","modules/newMap/monsterLog/creatureInfo.js","modules/newMap/viewCreature/evalArmour.js","modules/newMap/viewCreature/evalAttack.js","modules/newMap/viewCreature/evalCa.js","modules/newMap/viewCreature/evalDamage.js","modules/newMap/viewCreature/evalDefence.js","modules/newMap/viewCreature/evalExtraBuffs.js","modules/newMap/viewCreature/viewCreature.js","modules/newMap/viewCreature/evalHtml.js","modules/newMap/monsterLog/processMonsterLog.js","modules/newMap/worldPrefs/setCurrentBuffList.js","modules/newMap/monsterLog/monsterLog.js","modules/newMap/prepareHidePlayerActions.js","modules/newMap/worldPrefs/toggleEnabledHuntingMode.js","modules/newMap/interceptXHR.js","modules/newMap/worldPrefs/buildFshDivs.js","modules/newMap/worldPrefs/toggleShowHuntingBuffs.js","modules/newMap/worldPrefs/doHuntingBuffs.js","modules/newMap/worldPrefs/worldPrefs.js","modules/newMap/newMap.js","modules/legacy/legacy.js","modules/recipes.js","modules/marketplace.js","modules/app/inventing/doinvent.js","modules/ladder.js","modules/arena/setup.js","modules/upgrades.js","modules/arena/store.js","modules/seLog/superelite.js","modules/questBook.js","modules/common/formatUtcDateTime.js","modules/buffLog/updateBuffLog.js","modules/chrome/unknownPage.js","modules/news/viewArchive.js","modules/logs/addChatTextArea.js","modules/logs/doChat.js","modules/logs/processLadder.js","modules/support/specials.js","modules/logs/addPvpSummary.js","modules/app/combat/view.js","modules/logs/addLogWidgets.js","modules/auctionHouse.js","modules/bank.js","modules/news/news.js","modules/chrome/pageSwitcher.js","modules/chrome/environment.js","modules/dropItems/injectProfileDropItems.js","modules/dropItems/injectMoveItems.js","modules/guildReport/guildReport.js","modules/logs/logs.js","modules/settings/load.js","modules/scoutTower/injectTitan.js","modules/topRated/globalQuest.js","modules/guide/showAllQuestSteps.js"],"names":["isType","e","t","isUndefined","getElementById","id","doc","document","insertHtml","parent","where","html","Element","insertAdjacentHTML","insertHtmlBeforeEnd","thePlayerId","timers","footWrap","time","name","performance","now","timeEnd","text","value","Math","round","playerId","Number","textContent","match","times","refAry","noGa","docRef","referrer","includes","window","ga","start","category","variable","label","end","myTime","setup","page","userId","siteSpeedSampleRate","FSH","version","calf","location","pathname","search","replace","screenview","funcName","screenName","sendEvent","eventCategory","eventAction","eventLabel","sendException","desc","fatal","exDescription","exFatal","gvar","GMSTORAGE_PATH","storItem","type","localStorage","setItem","reviver","condition","result","substr","parseInt","cold","toString","indexOf","needApiUpgrade","navigator","appName","opera","isOpera","GM_log","postError","GM_setValue","gsv","isGreaseMonkey","isBuggedChrome","ws","uid","Date","getItem","removeItem","GM_getValue","defValue","i","length","test","retrieve","storType","temporarilyStorage","GM_listValues","list","reKey","RegExp","il","key","push","fallback","a","b","isFunction","heap","cmp","j","priority","swp","temp","pop","topVal","data","last","leftHigher","childIndex","sink","parentIndex","bubble","paused","message","taskRunner","postMessage","add","fn","args","scope","_scope","_args","bind","apply","concat","parseError","stack","concatStack","testPop","testFn","addEventListener","event","asyncTask","error","msg","dragTarget","dragOver","preventDefault","dragDrop","offset","dataTransfer","getData","split","style","left","clientX","top","clientY","body","removeEventListener","draggable","element","target","getComputedStyle","setData","getPropertyValue","escapeHtml","unsafe","thePlants","thePotions","defaults","lastActiveQuestPage","lastNormalActiveQuestPage","lastNormalCompletedQuestPage","lastNormalNotStartedQuestPage","lastSeasonalActiveQuestPage","lastSeasonalCompletedQuestPage","lastSeasonalNotStartedQuestPage","enableLogColoring","enableChatParsing","enableCreatureColoring","showCombatLog","showCreatureInfo","keepLogs","showExtraLinks","huntingBuffs","huntingBuffsName","huntingBuffs2","huntingBuffs2Name","huntingBuffs3","huntingBuffs3Name","showHuntingBuffs","moveFSBox","moveDailyQuest","guildSelf","guildSelfMessage","guildFrnd","guildFrndMessage","guildPast","guildPastMessage","guildEnmy","guildEnmyMessage","goldRecipient","goldAmount","sendGoldonWorld","hideQuests","hideQuestNames","hideRecipes","hideRecipeNames","enableGuildInfoWidgets","enableOnlineAlliesWidgets","guildOnlineRefreshTime","hideGuildInfoSecureTrade","hideGuildInfoTrade","hideGuildInfoMessage","hideGuildInfoBuff","buyBuffsGreeting","renderSelfBio","bioEditLines","renderOtherBios","playNewMessageSound","showSpeakerOnWorld","defaultMessageSound","highlightPlayersNearMyLvl","highlightGvGPlayersNearMyLvl","detailedConflictInfo","gameHelpLink","navigateToLogAfterMsg","enableAllyOnlineList","enableEnemyOnlineList","allyEnemyOnlineRefreshTime","moveGuildList","moveOnlineAlliesList","hideMatchesForCompletedMoves","doNotKillList","enableBioCompressor","maxCompressedCharacters","maxCompressedLines","currentGoldSentTotal","keepBuffLog","buffLog","enableActiveBountyList","bountyListRefreshTime","enableWantedList","wantedNames","wantedGuildMembers","bwNeedsRefresh","fsboxlog","fsboxcontent","itemRecipient","quickLinks","enableAttackHelper","minGroupLevel","combatEvaluatorBias","huntingMode","enabledHuntingMode","hideRelicOffline","enterForSendMessage","trackKillStreak","storeLastQuestPage","addAttackLinkToLog","showStatBonusTotal","newGuildLogHistoryPages","useNewGuildLog","enhanceChatTextEntry","ajaxifyRankControls","enableMaxGroupSizeToJoin","maxGroupSizeToJoin","enableTempleAlert","enableUpgradeAlert","enableComposingAlert","autoFillMinBidPrice","showPvPSummaryInLog","enableQuickDrink","enhanceOnlineDots","hideBuffSelected","hideHelperMenu","keepHelperMenuOnScreen","draggableHelperMenu","quickLinksTopPx","quickLinksLeftPx","draggableQuickLinks","showNextQuestSteps","showRecallMessages","showRelicMessages","showMercenaryMessages","showGroupCombatMessages","showDonationMessages","showRankingMessages","showGvGMessages","showTaggingMessages","showTitanMessages","showQuickDropLinks","onlinePlayerMinLvl","onlinePlayerMaxLvl","arenaMinLvl","arenaMaxLvl","showMonsterLog","lastTempleCheck","needToPray","lastChatCheck","lastGuildLogCheck","lastOutBoxCheck","lastPlayerLogCheck","showAdmin","alliestotal","enemiestotal","footprints","hideNonPlayerGuildLogMessages","listOfAllies","listOfEnemies","contactList","lastUpgradeCheck","needToDoUpgrade","characterVirtualLevel","guildLogoControl","statisticsControl","guildStructureControl","lastMembrListCheck","disableItemColoring","showQuickSendLinks","needToCompose","lastComposeCheck","lastOnlineCheck","bountyList","wantedList","lowestLevelInTop250","quickMsg","sendClasses","quickSearchList","JSON","stringify","map","el","searchname","nickname","displayOnAH","arenaMoves","arenaMatches","CombatLog","hideChampionsGroup","hideElitesGroup","hideSEGroup","hideTitanGroup","hideLegendaryGroup","disableDeactivatePrompts","moveComposingButtons","expandMenuOnKeyPress","disableBreakdownPrompts","collapseNewsArchive","collapseHallPosts","lastmyGuildLogCheck","hideSubLvlCreature","hidePlayerActions","extraProfile","textToSearchFor","lastLadderReset","disableQuickWearPrompts","enableGuildActivityTracker","enableSeTracker","showTitanInfo","getValue","jsonParse","str","parse","exec","UTC","getValueJSON","resultJSON","server","protocol","host","imageServer","HCS","defines","fileserver","slice","retBool","bool","ifTrue","ifFalse","haveNode","node","draggableQuickLinksClass","newWindow","url","injectQuickLinks","getCustomUrlParameter","sPageURL","sParam","sParameterName","param","sURLVariables","getUrlParameter","decodeURIComponent","substring","doMsgSound","soundLocation","$","each","after","isObject","jQueryNotPresent","rarity","colour","clas","places","months","mercRE","lastActivityRE","itemRE","defenderMultiplier","nowSecs","floor","newGuildLogLoc","newGuildLogUrl","beginFolderSpanElement","guideUrl","def_afterUpdateActionlist","def_playerBuffs","def_suffixSuccessActionResponse","def_fetch_worldRealmActions","hideGuildLogMsg","guildLogNode","parentNode","messageBox","classList","changeGuildLogHREF","guildLogNodes","querySelectorAll","href","gotGuildLogNodes","stringifyError","err","Object","getOwnPropertyNames","getPrototypeOf","getForage","forage","dfr","Deferred","localforage","then","resolve","catch","dialog","reject","promise","extend","obj","mixins","keys","forEach","constructor","queue","beforeSend","xhr","abort","doAjax","options","retries","opt","ajax","pipe","jqXhr","textStatus","errorThrown","status","setTimeout","active","opts","shift","retryAjax","callApp","app","dataType","jQueryPresent","cElement","props","createElement","mixin","createDiv","createSpan","createTable","createTBody","createTr","createTd","createUl","createLi","createButton","createBr","createAnchor","createInput","createLabel","textSpan","insertElement","child","Node","appendChild","jConfirm","title","msgText","fshMsg","autoOpen","dialogClass","modal","resizable","buttons","Yes","this","No","clearForage","clear","setForage","jQuery","ajaxComplete","oldArchive","act","cur","lvl","max","utc","vl","gxp","pushNewRecord","member","members","last_activity","current_stamina","level","max_stamina","guild_xp","type2tests","archive","current","processMemberRecord","newArchive","archiveMember","archiveRecord","some","gotGuild","r","lastUpdate","ranks","rank","gotActivity","cmd","subcmd","done","guildActivity","createDocument","details","DOMParser","parseFromString","getRandomInt","_min","_max","min","ceil","random","insertElementBefore","newNode","referenceNode","insertBefore","insertHtmlAfterBegin","insertHtmlAfterEnd","pCC","pCR","rnd","setValue","pvpLowerLevel","pvpUpperLevel","gvgLowerLevel","gvgUpperLevel","composeMsg","displayComposeMsg","parseComposing","timeRE","openSlots","getElementsByClassName","Array","prototype","call","timeArr","milli","eta","createPotion","cache","template_id","_rnd","potName","myParent","infoDiv","innerHTML","selectedIndex","previousElementSibling","children","backgroundImage","quickCreate","evt","self","tagName","className","composeAlert","injectComposeAlert","hasJQuery","buttonDiv","setAttribute","moveButtons","makePageHeader","comment","spanId","button","_comment","_span","makePageTemplate","o","divId","quickBuffHref","aPlayerId","buffList","passthru","intValue","theText","lowerPvpCalcs","levelToTest","content","monsterAry","lowerGvgCalcs","calculateBoundaries","modifier","nextElementSibling","find","injectFsBoxContent","injector","reload","jQueryDialog","display","width","position","my","at","collision","storeFSBox","_boxList","boxList","fsbox","injectFSBoxLog","nodediv","lastElementChild","playerName","getElementsByTagName","log","fSBoxExists","displayBuffLog","clearBuffLog","injectBuffLog","addCommas","x","doSortParams","headerClicked","sortAsc","sortBy","path","aPath","def","_obj","_path","len","getPath","sortDesc","intFromString","val","numberSort","valueA","valueB","stringSort","_a","_b","toLowerCase","noMobs","drawMobs","inject","image","creature_class","attack","defense","armor","damage","hp","enhancements","mobRows","sortCol","getAttribute","sortType","sort","doHandlers","contains","prepAry","reduce","prev","curr","tmpObj","image_id","tmp","_prev","_curr","injectMonsterLog","textArea","guildId","context","onlinePlayers","onlineData","onlinePages","lastPage","table","combatLog","notepadCopyLog","focus","select","clearCombatLog","notepadClearLog","gotCombatLog","injectNotepadShowLogs","currentGuildId","nodeList","saveVal","isNaN","lvlTests","dataTableSearch","_settings","currentPlayerId","highlightTests","guildNumber","gotOnlinePlayers","player","guildImage","append","addClass","dataTable","ext","pageLength","lengthMenu","columns","class","orderable","createdRow","row","every","eq","order","stateSave","stateDuration","api","getOnlinePlayers","input","first","thePage","attr","index","tds","changeLvl","draw","doOnlinePlayerEventHandlers","hide","injectOnlinePlayers","refreshButton","lastCheck","shouldBeArray","pref","stored","generateRecipeTable","output","recipebook","recipe","link","img","items","itm","verify","amountPresent","amountNeeded","components","comp","drawRecipeTable","lastMsg","extTbl","extractInv","selectST","selectMain","resourceList","buyResult","itmRE","reduceItemOrComponent","bgGif","background","mouseOverRX","dataset","tipped","amounts","resultAmounts","hasAmounts","parseRecipeItemOrComponent","tblCells","processFolderAnyPage","firstElementChild","rows","cells","prm","when","processFolderFirstPage","innerPcc","thisFolder","filter","pages","processFirstPage","folderName","firstChild","displayStuff","parseInventingStart","sortRecipeTable","rmEvtHdl","injectRecipeManager","eventHandler","evtAry","getInventory","outputResult","handle","jsonFail","json","s","useitem","item","inventory_id","quickDoneExtracted","invId","ary","inv_id","splice","checkFlags","folder_id","is_in_st","resources","item_id","invIDs","item_name","tableRows","res","showQuickExtract","prepInv","player_id","extractEvents","InventoryIDs","insertQuickExtract","alpha","n","tbl","newRow","insertRow","dom","ret","equipClass","useClass","extra","design","color","createQuickWear","appInv","folderObj","tbody","aFolder","qw","m","equipItem","backpackInvId","ahLink","buildHTML","invCount","quickSL","nicknameList","join","count","found","isChecked","itemList","mySimpleCheckboxes","helpTitle","helpText","network","networkIcon","saveBoxes","helpLink","justLabel","justCheckbox","simpleCheckboxHtml","simpleCheckbox","toggleForce","force","toggle","errorDialog","useItem","doAction","verb","remove","itemid","doUseItem","processFolder","folderId","tr","events","folder","showQuickWear","invTabs","listItem","im","showAHInvManager","hasJquery","insertQuickWear","setValueJSON","detailRow","itemField","tags","generateManageTable","headers","currentCategory","currentItems","categoryField","fields","itemRow","doInputs","gmname","listEvents","userInput","isArray","newItem","checked","buildNewItem","itemId","injectAuctionSearch","injectQuickLinkManager","dotList","dotCount","stam","nicks","pageLayout","header","what","control","cutoff","searched","potential","processed","progress","moreToDo","limit","cntr","redDot","getMins","day","hour","last_login","getDot","onlineDot","batchDots","contactLink","lastActivity","previousSibling","colouredDots","thisPlayerName","sustainLevelRE","parseProfileAndDisplay","responseText","callback","sustainLevel","aLinks","bioCellHtml","innerPlayerName","levelValue","virtualLevelValue","lastActivityElement","buffTable","textLineArray","findBuffNicks","runningTotalPosition","nextBR","prevBR","arr","removeBy","seen","buffPosition","startingPosition","bioTextToSearch","buffRE","lastIndexOf","textLine","getBioLines","sustainText","hasExtendBuff","querySelector","newCell","insertCell","verticalAlign","click","openQuickMsgDialog","sustain","playerInfo","processedBuffers","potentialBuffers","processedBuffersCount","bufferProgress","characterName","findBuffMinCastLevel","findBuffsLevel175Only","onlinePlayersSetting","profilePagesToSearch","profilePagesToSearchProcessed","buffCustom","otherCustom","findBuffsParsePlayersForBuffs","calcMinLvl","addPlayerToSearchList","onlinePlayer","onlinePlayerName","trim","playerRow","onlinePlayerLevel","minPlayerVirtualLevel","findBuffsParseOnlinePlayers","curPage","maxPage","playerRows","newPage","findBuffsParseOnlinePlayersStart","parsePlayerLink","lastActivityDays","lastActivityHours","vlevel","lastActivityMinutes","findBuffsParseProfilePage","profileAlliesEnemies","findBuffsParseGuildManagePage","memList","findBuffsClearResults","deleteRow","findAnyStart","progMsg","findBuffsStart","selectedBuff","findOtherStart","injectFindBuffs","injectFindOther","fshTemplate","sendMessage","helperMenuBlob","functionLookup","Buff Log","Combat Log","Creature Log","Recipe Manager","Quick Links","Find Buffs","Find Other","Online Players","AH Quick Search","Quick Extract","Quick Wear","FS Box Log","functionPath","showHelperMenu","helperMenu","helperMenuDiv","injectHelperMenu","parseDateAsTimestamp","textDate","dateAry","newsEvt","newsHead","newsBody","newsClass","closestHead","show","stopPropagation","injectHomePageTwoLink","newsCol","rumours","imgs","archiveLink","head","logTime","myName","encodeURIComponent","myLink","findNewGroup","groupJoinHTML","injectJoinAllLink","insertElementAfter","nextSibling","insertAdjElement","insertAfterParent","tgt","anchorButton","navLvl","li","al","navHeightExists","theNav","myNav","heights","state","height","navExists","injectMenu","showMsgTemplate","targetPlayer","prepend","selectable","stop","Manage","Cancel","keypress","code","shiftKey","tip","Template","removeAttr","injectQuickMsgDialogJQ","statBoxesExist","topbannerStats","gameStats","playersOnline","miniboxList","injectServerNode","hidden","h3coll","havePrayedMsg","godsNotification","havePrayed","outerHTML","setUTCHours","prayToGods","myGod","qtip","displayDisconnectedFromGodsMessage","parseTemplePage","doWeNeedToParse","templeAlertLastUpdate","injectTempleAlert","goldUpgradeMsg","displayUpgradeMsg","parseGoldUpgrades","checkDoneUpgrade","tables","notUpgradesPage","injectUpgradeAlert","insertElementAfterBegin","getPos","available","desired","fshOpen","w","_h","features","h","screen","availHeight","screenY","documentElement","clientWidth","screenX","open","interceptQuickBuff","openWindow","navMenu","oldSave","_saveState","_id","outputFormat","suffix","formatLastActivity","abs","d","getProfile","username","player_username","sendMyProfileToForage","addLastUpdateDate","getMyProfile","getProfileFromForage","myStats","openQuickBuffByName","aPlayerName","buffCheck","msgButton","buffButton","contactClass","ally","enemy","contactColor","addContact","noAlliesTests","allies","enemies","injectAllyEnemyList","_allies","_enemies","fshContactList","hazAllies","toggleBuffSelected","activeBountyListPosted","wantedArray","classEvt","handler","buffBalls","makeDiv","fshAllyEnemy","wrapper","prepareAllyEnemyList","thisBounty","bountyUrl","getActiveBountyList","activeTable","bounty","isRefreshed","theCells","reward","rewardType","posted","xpLoss","parseActiveBounty","testCacheInvalid","bountyListDiv","wantedListDiv","bountyListReset","wantedListReset","isWanted","theRow","wantedTarget","action","cell","offerer","tickets","accept","createMiniBox","injectBountyList","heading","injectWantedList","getWantedBountyList","findTarget","parseBountyPageForWorld","refreshConditions","retrieveBountyInfo","enableActiveList","resetList","prepareBountyData","infoBox","documentText","infoMsg","infoMatch","doSendGold","no_mobile","xc","ajaxXC","target_username","gold_amount","info","GameData","fetch","updateSendGoldOnWorld","gold","css","findNodes","xpath","_xpath","nodes","_doc","findQ","HTMLDocument","evaluate","XPathResult","UNORDERED_NODE_SNAPSHOT_TYPE","snapshotLength","snapshotItem","findNode","movePage","dir","dirButton","logPage","combatSetKey","itemIndex","allItems","combatSetId","submit","success","keyDict","33","arg","64","34","35","36","37","94","38","42","40","60","62","71","76","98","103","106","108","112","114","118","dialogIsClosed","121","163","oldLog","timeoutId","intervalId","bailOut","ctrlKey","metaKey","altKey","keyPress","charCode","replaceKeyHandler","onkeypress","scoutTowerLink","spoils","disableBackgroundChecks","clearTimeout","clearInterval","gotSe","serverTime","se","resultAry","mobName","creature","getSeLog","doBackgroundCheck","setInterval","setupBackgroundCheck","lastCheckSecs","gotLog","getFshSeLog","seLog","statbarWrapper","myWrapper","character","statWrapper","statbar","hideElement","hideNodeList","contactColour","onMouseOver","l1","l2","l3","guildColour","alliesColour","hideBtn","guildSelector","allySelector","doHideBtn","selector","addGuildInfoWidgets","guildMembrList","addOnlineAlliesWidgets","onlineAlliesList","padZ","days","timeBox","nextGainTime","hrsToGo","aDate","yyyy","dd","ddd","month","nextGain","getFullYear","getDate","getDay","getMonth","getHours","getMinutes","injectStaminaCalculator","staminaMouseover","stamVals","injectLevelupCalculator","conditional","moveRHSBoxUpOnRHS","box","moveRHSBoxToLHS","boxDiv","notHuntMode","lookForHcsData","hcsData","hcs","allowBack","inv","moveOptions","tableOpts","paging","columnDefs","targets","arenaFilter","dontPost","pvpId","gotoPage","pageId","rekeyInventory","fshHasST","getInventoryById","selectPerf","thisItem","craft","drawFilters","perfFilter","loc","itemTable","itemsAry","invItems","selectedList","fadeAway","disappear","animate","opacity","showComposingMessage","bgcolor","text-align","background-color","margin","padding","validBreakEvent","item_list[]","response","breakEvt","itemClick","myItem","itemPos","togglePref","makeFolderSpans","folders","needsWorn","wornSelector","perfBox","drawingNewItemTable","itemGrid","itemDiv","afn","reDrawGrid","doHideFolders","evtFid","enhanceWarehouse","invItem","equipped","inventory","perfLabel","doPerfSwitch","getItems","allTables","imgList","craftForge","prefValue","headerIndex","warehouse","collapseArt","article","collapseAll","expandArt","closestTr","rowIndex","isHeader","evtHdl","myRow","articleNo","evtEnabled","testRowType","rowType","thisArticle","articleTest","extraFn","prefName","collapse","prefEl","headInd","theTable","testArticle","closestTable","translateReturnInfo","_r","guildMailboxEvent","anchor","addMembrListToForage","membrList","oldMemList","getGuildMembers","guild_id","ele","testList","Boolean","guildMembers","getMembrList","tabs","theTables","oldIds","newSummary","advisorColumns","doTable","autoWidth","f","playerLevel","playerRank","rank_name","injectAdvisorNew","totalRow","totalCell","updateInput","tfoot","removeChild","td","removeAttribute","tdOne","getAdvisorPage","period","pcc","deposit","tax","total","fsp","skills","grpCrt","grpJoin","relics","contrib","displayAdvisor","addStats","addAdvisorPages","injectAdvisor","subcmd2","changeLvls","maxLvl","minLvl","DataTable","resetLvls","hideMoves","sortHandler","closest","myCol","classes","sortOrder","filterHeader","clone","insertAfter","fshHideMoves","fshMinLvl","fshMaxLvl","aTable","prop","keyup","ItemId","doLvlFilter","lvlFilter","hazOpts","boolData","matches","optsHazMoves","moves","checkTournamentId","orderData","redoHead","firstRow","contents","unwrap","process","arena","off","on","injectArena","testRange","aValue","theValue","testQuant","bazaarTable","bazaarItem","testBuyAmount","dupNode","cloneNode","selected","quantity","buy","buyAmount","buffCost","buffs","numRE","priceRE","formatBuffsToBuy","buffsToBuy","greetingText","hasBuffTag","hasCostTag","buffCostTotalText","previewArea","theBox","groupStats","actBody","selMember","tgCont","memberSelect","myMembers","ioText","saveBtn","resetBtn","io","trackerData","tracker","trDialog","acttab2","leftHandSideColumnTable","memCount","myRank","theRows","rankCount","characterRow","costFormatter","String","k","unknown","hazBuffs","buff","totalText","thisLine","nodeName","getBuffCost","buffNameNode","newtext","buffName","cost","price","priceBeforeName","parseFloat","toggleBuffsToBuy","bioEvtHdl","getBuffNameNode","insertTextBeforeEnd","renderBio","_bioContents","bioContents","cbString","changeHeight","boxVal","updateBioCharacters","inputText","injectBioWidgets","widthClass","previewContainer","bioPreview","bioEditLinesDiv","saveLines","bioHeight","addMercStats","merc","mouseover","stat","parseMercStats","mercElements","mercTotal","getMercStats","statAsNumber","groupViewStats","attackElement","defenseElement","armorElement","damageElement","hpElement","displayStat","groupStat","mercStat","mercStats","doBuffLinks","slot","theNames","modifierWord","btn","parseGroupStats","getGroupStats","viewStats","filterMercs","doJoinUnderSize","joinButton","groupJoinURL","joinAllGroupsUnderSize","joinButtons","fetchGroupData","aLink","linkElement","extraText","memberLevel","membrlist","doGroupRow","creator","td2","listArr","theDateCell","curYear","groupDate","setUTCDate","setUTCMonth","setUTCFullYear","setUTCMinutes","doGroupPaint","has","injectGroups","buttonElement","formatLocalDateTime","getTime","getSeconds","toText","toLocaleString","memberRows","outside","memberKey","inside","activity","drawRows","queueDrawRows","myChange","initTable","theMembers","ourMembers","makeTg","tg","hrow","createTHead","memberHead","drawRawData","doReset","doSave","newData","fail","customButton","makeInOut","isClosed","keydownHandler","updateRawData","makePopup","dialogPopup","hdl","container","openDialog","guildTracker","gs","oldTr","newTr","cellOne","cellTwo","replaceChild","toggleVisibilty","anItemId","anItem","currentVisibility","getIntFromRegExp","rxSearch","removeGuildAvyImgBorder","guildXPLock","xpLock","xpLockmouseover","xpLockXP","actualXP","gotConflictInfo","insertHere","conflictTable","hazConflict","conflictInfo","statCtrl","logoToggle","guildLogoElement","statToggle","statisticsControlElement","structureToggle","guildStructureControlElement","batchBuffLinks","buffLinks","selfRecallLink","getLi","fastBp","itmId","guildstore_id","evtHdlr","boxes","paintTable","doItemTable","injectGuildAddTagsWidgets","checkAll","formTags","privLookup","Bank Withdraw","Build/Upgrade/Demolish Structures","Can Un-Tag Items","Build/Upgrade Structures","Can Kick Members","Can Mass Messages","Take Items","Can Recall Tagged Items","Store Items","Can View Advisor","fetchRankData","targetNode","checkBoxes","checkbox","privName","taxRate","overrideUpDown","onclickHREF","thisRankRow","thisRankRowNum","targetRowNum","parentTable","injectRow","pxScroll","scrollBy","doButtons","addNewRank","weightButton","theTd","hasMembers","rankCell","rankName","writeMembers","paintRanks","getRanks","outerTable","findTheRows","theInv","defaultOptions","checkedElements","0","1","2","3","4","5","6","7","8","100","101","102","104","105","invManFilter","inventoryCheckAll","9","10","11","12","13","14","15","16","itemType","craftHash","Perfect","abbr","Excellent","Very Good","Good","Average","Poor","Very Poor","Uncrafted","storeTheInv","extendOptions","craftRender","gsRecall","gsStore","gsDisplayType","locations","current_player_id","c","wuRender","whereData","isSelected","tblCols","render","invPlayer","rowPlayer","guild","p","bold","_setName","stats","set_name","nameRenderDisplay","_","folderSelect","max_durability","durability","_data","guild_tag","bound","_type","visible","tag","setChecks","allChecks","clearChecks","newEle","removeClass","empty","dropItem","invIdList","removeIndex","getChecks","moveItem","inv_list","resetChecks","htmlResult","sendItem","sendItemList","deferred","takeItemStatus","queueTakeItem","recallItemStatus","bpData","lastBackpackItem","pipeRecallToQueue","mode","queueRecallItem","setName","takeItem","recallItem","wearItem","doMoveItem","doStoreItem","invIdAry","storeIndex","doDropItem","doSendItem","nowUtc","lastCheckUtc","setFilter","_row","_index","set_id","getInvMan","reportTitle","myHtml","defaultContent","orderSequence","column","injectInventoryManagerNew","wrap","clearButton","showError","$tempError","delay","failHndlr","jqXHR","statusText","quickDoneTaken","qtipId","temp_id","takeAllSimilar","invIds","toggleQuickTake","getPlayer","playerAry","findPlayers","aRow","messageHTML","secondPlayer","firstPlayer","firstPlayerID","secondPlayerID","guildInvite","hasInvited","charAt","firstPart","firstQuote","secondQuote","targetPlayerName","likeInvite","guildLogWidgetsEnabled","messageNameCell","getMessageHeader","logTable","addGuildLogWidgets","rowColor","logScreen","dateColumn","postDateUtc","addBuffTag","postAgeMins","playerID","chatRowBuffLink","doLogColoring","chatTable","setUTCSeconds","lastCheckScreen","increment","addLogColoring","lookup","rowProfile","isMatch","myIndex","findIndex","fshNewGuildLog","fshOutput","maxPagesToFetch","currPage","myTable","guildLogFilter","headerRow","defChecks","noChecks","tmpGuildLog","completeReload","getGuildLogPage","datatype","findPageInput","parsePage","inputList","pageInput","seenRowBefore","timestamp","myMsg","parseTable","tableList","myDate","getTableList","processPage","storeOptions","checks","gotOtherPages","setSeconds","sepRow","sep","colSpan","buildTable","getOtherPages","bpc","guildLogEvents","gotOptions","guildLog","insertHtmlBeforeBegin","reduceStatTable","ind","getVal","statTable","statObj","totalStats","Enhancements","fshDataFilter","bonus","fshPreFilter","dataFilter","addStatTotalToMouseover","ajaxPrefilter","elementTests","toggleTarget","hasAttribute","toggleSection","testForSection","profileCombatSetDiv","quickDelDiv","sumComp","delAllDiv","compDel","compSum","compDelAll","qe","thisInvTable","doDebuff","buffId","checkForPrompt","interceptDebuff","fastAction","theBackpack","_invId","srcData","fastWearLinks","theSpan","usable","toUse","myDiv","checkboxesEnabled","foundBackpack","backpackContainer","oldShow","_showPage","tabData","injectFastWear","bpBack","getNekid","usedCount","usedCountDom","totalCount","pageCount","componentList","getInvTables","retriveComponent","invTbl","src","onmouseover","del","tallyTableRow","displayComponentTally","tBody","totRow","totCell","gotComponentsPage","addDelBtn","updateUsedCount","currentGuildRelationship","compid","decorateButton","parentDiv","innerSpan","guildMessages","friendly","old","guildAry","guildRelationship","guildIdResult","thisGuildId","_txt","txt","scenario","relObj","externalRelationship","profileInjectGuildRel","profileInjectQuickButton","avyImg","playerid","playername","newhtml","totalAllyEnemy","numberOfContacts","contactsTotal","_c","findAllyEnemy","isAllies","isEnemies","expandBio","bioExpander","compressBio","bioCell","maxChar","lines","maxRows","maxCharactersToShow","maxRowsToShow","numberOfLines","_maxRowsToShow","startIndex","findStartPosition","breakPoint","lineBreak","bioStart","bioEnd","extraOpenHTML","extraCloseHTML","closeTagIndex","openTagIndex","doCompression","shouldRender","testForRender","profileSelectAll","checkboxes","gotImg","nmvImg","atkEl","atkStat","defStat","oldTipped","lvlAry","nmvLvl","nmvEffect","removeStatTable","tde","ifSelf","profileRightColumn","targetBr","nekidDiv","theBtn","virtualLevel","invTables","compDiv","cmDiv","qeDiv","profileComponents","quickWearLink","allSpan","selectAllLink","injectProfile","dodgyTables","tickElement","disabled","itemsHash","extraLinks","paintCount","dropLinks","colouring","sendLinks","types","invid","doCheckboxes","invItems_","type_","itemId_","injectHere","doFolderButtons","formNode","tRows","showHideLabel","doToggleButtons","cltn","setInsertHere","quickAction","otherClass","otherButton","buildTrailer","beforeend","pattern","itemWidgets","afterbegin","invPaint","evts","batchNo","counter","invList","separator","injectStoreItems","quickBuffHeader","excludeBuff","skill-50","skill-54","skill-55","skill-56","skill-60","skill-61","skill-98","skill-101","getEnhancement","enh","enhLevel","enhClass","timeUnit","unit","getBuff","_s","buffTimeToExpire","elem","quickActivate","trigger","addStatsQuickBuff","myPlayer","stamina","buffRunning","playerBuffLevel","playerSpan","lvlSpan","myLvl","fshPlayerSpan","newPlayerSpan","buffColor","addBuffLevels","playerData","foo","doLabels","nameSpan","dataTipped","haveTargets","getSustain","_enhancements","skl","_skills","duration","labels","reduceBuffArray","buffAry","packRE","parseProfile","myBuffs","packsRow","packBuffs","postWarnings","spinner","eventHandlers","potObj","potOpts","mapping","storeMap","defaultOpts","pottab1","pottab2","pottab3","myMap","minpoint","maxpoint","sortKeys","drawMapping","pot","pivotPotObj","makeRowsFromPivot","pivot","percent","perc","g","drawInventory","onChange","option","onInput","maybeValue","gotMap","panels","myCell","nodeArray","headerCount","findUser","foundUser","wearRE","paintChild","mySpan","secondHref","firstHref","itemName","addPotObj","makeSpan","prepareChildRows","paintHeader","oldhtml","reportHeader","hideOthers","searchUser","userNodes","buffEvent","titanTable","shortList","firstCell","buffAll","injectScouttowerBuffLinks","titanTables","gotTables","roundToString","number","precision","factor","pow","getTitanName","cooldownTracker","theTitans","cooldown","coolTime","cooldownText","displayTracker","trackerTable","titan","getTitanString","guildKills","totalHP","currentHP","numberOfKillsToSecure","remainingKills","getKillsPct","currentNumberOfKills","killsSummary","titanHP","titanHPArray","gotOldTitans","oldTitans","myImg","newTitans","oldTitan","generalPrefs","injectSettingsGuildData","guildType","huntBuff","huntBuffCheck","showBuffs","huntMode","buffsName","buffs2Name","buffs3Name","huntingBuffsList","modeLabel","modeName","prefs","buffs2","buffs3","coderLink","listOfCoders","setupConfigData","configData","storage","toFixed","toggleTickAllBuffs","tckTxt","clearStorage","saveConfig","maxCompressedCharactersValue","maxCompressedLinesValue","newGuildLogHistoryPagesValue","maxGroupSizeToJoinValue","oForm","form","combatEvaluatorBiasElement","formElement","showLogs","showMonsterLogs","getStat","nodeType","nodeValue","getBuffLevel","hasBuff","getBonus","next","cloakGuess","updateForCloak","attackValue","attackBonus","defenseValue","defenseBonus","armorValue","armorBonus","damageValue","damageBonus","hpValue","hpBonus","playerDataString","atk","killStreakValue","counterAttackLevel","doublerLevel","deathDealerLevel","darkCurseLevel","holyFlameLevel","constitutionLevel","sanctuaryLevel","flinchLevel","nightmareVisageLevel","superEliteSlayerLevel","fortitudeLevel","chiStrikeLevel","terrorizeLevel","barricadeLevel","reignOfTerrorLevel","anchoredLevel","severeConditionLevel","entrenchLevel","cloakLevel","superEliteSlayerMultiplier","getBuffLvl","playerDataObject","bonus_attack","bonus_defense","bonus_armor","bonus_damage","bonus_hp","killstreak","guilds","myGuildId","validPvP","virtual_level","doOnlineDot","failFilter","addPlayerToGuild","guildHRef","stackAjax","parseGuild","findOnlinePlayers","someTables","getMyVL","topRatedTests","injectTopRated","theCell","findBtn","looksLikeTopRated","doHideFolder","folderid","oldItems","getItemDiv","all","hasFolder","hideFolder","forEachInvItem","processTrade","folderCell","foldersRow","doFolderHeaders","doFolders","doCheckAll","itemTables","howMany","itemsInSt","cbox","findStCheck","toggleAllPlants","injectTradeOld","myTd","multiple","injectTrade","isActive","highlightMembers","impStyles","impWarning","impsRem","recastButton","getKillStreak","playerKillStreakValue","killStreakLocation","deathDealerPercentage","deathDealerBuff","deathDealer","getLastValue","doDeathDealer","lastDeathDealerPercentage","lastKillStreak","trackText","findImps","hasDd","hasSsi","re","hasCA","replacementText","hasCounterAttack","counterAttack","getCaLvl","doublerRE","getDoublerLevel","hasDoubler","doubler","doublerLvl","combatData","oldDoAction","notSave","storeBuffs","storeEnhancements","processCombatResponse","combat","drop","combatResponse","subscribe","afterUpdateActionList","creatures","actionsToIntercept","attempts","actions","passback","creatureName","maybeIntercept","interceptFunction","doNotKill","containerDiv","leftDiv","fetchStatsBtn","myDefenders","guildMemberList","twoMinutes","sevenDays","atkStats","defStats","proc","primaryElementsSetup","relicData","defenders","player_name","is_owner","relicCountElement","lDPercentageElement","lDCloakedElement","attackBuffedElement","defenseBuffedElement","armorBuffedElement","damageBuffedElement","hpBuffedElement","defCloakedElement","defProcessedElement","dc225Element","dc175Element","groupAttackElement","groupAttackBuffedElement","groupDefenseElement","groupDefenseBuffedElement","groupArmorElement","groupArmorBuffedElement","groupDamageElement","groupDamageBuffedElement","groupHPElement","groupHPBuffedElement","processingStatus","relicMultiplier","defRawAttack","defBuffedAttack","defRawDefense","defRawArmor","defRawDamage","defBuffedDamage","defRawHp","defCloaked","defProcessed","leadDefender","memberExclusions","missingMembers","filtered","prepareSecondaryDivs","midDiv","rightDiv","rels","relicCount","updateDefValues","calculateGroup","nightmareVisageEffect","storedFlinchEffectValue","defenseWithConstitution","Constitution","totalDefense","Sanctuary","fortitudeBonusHP","Fortitude","chiStrikeBonusDamage","storedTerrorizeEffectValue","flinchEffectValue","Flinch","terrorizeEffectValue","Terrorize","doCalculations","defBuffedDefense","defBuffedHp","hasGroup","parseDefender","defender","storeLeadDefender","storeGroupStats","storeMercStats","ajaxFailure","parseGroups","disband","getStats","controlled_by","viewRelic","realmName","currentHp","maxHp","currentPct","totalPct","titanTbl","titanDiv","titanId","buttonContainer","yourLvl","formGroup","quickBuff","realmMap","ufsgMap","soundCheck","huntCheck","colorHash","bias","generalVariable","hpVariable","addRowCells","someCells","attributes","aCell","addRows","isBlue","clearMemberRows","makePctWrapper","pct","pctWrapper","buildTitanInfoTable","titanHpWrapper","hideTitanDiv","hasTitan","base_creature_id","setupTitanDiv","actCont","getCooldownHtml","currentTitan","realm","base_id","processTitans","ourTitan","current_hp","max_hp","kills","contributors","doMemberRows","titanToShow","dynamic","ajaxScoutTower","testDynamics","titanStats","shoppingData","jDialog","fshDiv","numInput","qbBtn","resultDiv","changeHdl","clickHdl","gameRealm","doBtn","worldName","showQuickLinks","lvlDiv","btmDiv","minlevel","createLbl","htmlFor","makeToggleBtn","btnDiv","btnCheck","prefVal","checkId","onClass","onTip","offClass","offTip","injectButtons","inHuntMode","GameController","Realm","footprintTileList","msgSounds","levelStats","fixDebuffQTip","injectWorldNewMap","impIconColour","imp","onWorld","initialGameData","quickDone","resp","rmsg","firstTag","normalBuy","close","qBuy","worldDialogShop","evalMiss","numberOfCreatureHitsTillDead","numberOfHitsRequired","evalFightStatus","playerHits","creatureHits","fStatus","evalArmour","armorVal","groupExists","groupArmorValue","overallArmorValue","extraNotes","terrorizeEffect","creatureDamageDone","overallHPValue","creatureHitByHowMuch","approxDmg","evalAttack","remainingDef","atkValue","groupAttackValue","nightmareVisageAttackMovedToDefense","counterAttackBonusAttack","overallAttackValue","hitByHowMuch","attackVariable","calcLowest","lowestCALevelToStillHit","lowestCALevelToStillKill","counterAttackBonusDamage","damageDone","caRunning","lowestFeasibleCALevel","extraAttackAtLowestFeasibleCALevel","extraDamageAtLowestFeasibleCALevel","extraStaminaPerHitAtLowestFeasibleCALevel","extraStaminaPerHit","evalCA","evalDamage","groupHPValue","fortitudeExtraHPs","chiStrikeExtraDamage","groupDamageValue","overallDamageValue","deathDealerBonusDamage","holyFlameBonusDamage","dmgLessArmor","calcDef","groupDefenseValue","evalDefence","overallDefenseValue","evalExtraBuffs","getCreaturePlayerData","ses","tempdata","evalCa","fightStatus","evalAnalysis","evaluatorHTML","groupEvaluation","getStatValue","getCreatureGroupData","checkIfGroupExists","groupExistsIMG","parents","addRemoveCreatureToDoNotKillList","readyViewCreature","statLevel","statDefense","statAttack","statDamage","statArmor","statHp","getStatText","statTooltip","statClassName","monsterLog","doCreatureInfo","monster","oneHitNumber","myLvlClas","monsterTip","description","doMouseOver","updateMinMax","_logStat","creatureStat","logStat","processMonsterLog","logCreature","logEnh","doMonsterLog","processMonster","loopActions","getCreatures","getMyStats","initMonsterLog","startMonsterLog","buffLookup","setCurrentBuffList","tmpFn","toggleEnabledHuntingMode","doHidePlayerActions","players","verbs","missingBuffsDiv","testActions","myData","xhrDataFilter","creature_type","xhrPreFilter","originalOptions","fshEvents","prefsClickEvent","blur","buildFshDivs","prefsDiv","dataEventsPlayerBuffs","buffHash","missingBuffs","huntingBuffsEnabled","worldPrefs","hideGroupByType","hideGroupTypes","hideGroupButton","colorType","actionList","creatureClass","colorClass","colorMonsters","doRepair","subscribes","worldMessageCenter","recastImpAndRefresh","injectOldMap","hasShieldImp","hasDeathDealer","impsRemaining","textToTest","impsRemainingRE","getImpsRemaining","trackKS","_recastImpAndRefresh","impHref","impRecast","injectWorld","amt","prc","warn","plantFromComponentHash","Amber Essense","Blood Bloom Flower","Dark Shade ","Snake Eye","Snake Venom Fang","Heffle Wart","Jademare Blossom","Trinettle Leaf","Purplet Flower","quickInventDone","inventResult","quickInvent","amountToInvent","recipeID","recipe_id","injectViewRecipeLinks","getItemName","plantFromComponent","itemLinks","encodeURI","injectViewRecipe","searchName","compI","mouseOver","reResult","theUrl","linkFromMouseoverCustom","componentCountElement","inventing","formatTime","getAmount","marketplaceWarning","sellPrice","gross","amount","getWarning","addMarketplaceWarning","selectRow","upgrades","currentFSP","oldMoves","doPickMove","moveId","slotId","move_id","slot_id","updateMoves","newMoves","selectMoves","move","gotMoves","_arena","findText","valRe","doStamCount","upgrade","extraStam","updateStamCount","span","getCell","injectUpgradeHelper","injectPoints","saveUpgradeValue","ratio","storePlayerUpgrades","trackerCell","normalLink","seasonLink","activeLink","completeLink","notStartedLink","currentPageValue","addRow","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","formatUtcDateTime","insertNewRow","seAry","gotSeLog","always","waitForLog","letter","sortby","sortbydir","currentLocationValue","savePrefKey","setLink","storeQuestPage","oppositeTypeUrl","lastQBPage","guideButtons","questID","questName","injectQuestBookFull","questTable","successfull","timeStamp","buffCast","getStamUsed","buffResult","_buffLog","buffsNotCast","buffsAttempted","buffsNotCastRE","buffsCastRE","buffNotCast","ladderResetPref","checkForPvPLadder","viewArchive","tests","addChatTextArea","btnMass","appendTo","ourTd","replaceWith","fshTxt","keydown","keyCode","hasTextEntry","getThirdPart","targetPlayerID","thirdPart","targetPlayerRE","buffsSent","nick","nickList","isChat","isGuildMate","extraPart","dateHTML","dateFirstPart","dateLastPart","fourthPart","lastPart","attackPart","replyTo","msgReplyTo","processLadder","messageType","specials","18","17","19","20","21","22","23","24","25","26","27","28","29","30","31","combatCache","highlightSpecials","params","parseCombat","combatSummary","is_defender","winner","xp_gain","gold_gain","gold_stolen","pvp_prestige_gain","pvp_rating_change","inSpecialsList","unknownSpecials","specialHtml","processCombat","combatID","combat_id","cellContents","replaceLeadingText","msgCell","newHtml","replaceText","processCombatRow","combatRowTests","addPvpSummary","prepareCache","oneDay","combatId","checkCache","memberNameString","playerColor","colorPlayerName","playerElement","hasPlayerLink","doExtraStuff","dateExtraText","buffingPlayerID","buffingPlayerName","addExtraStuff","doLogWidgetRow","addLogWidgetsOld","messageHeader","foundLogTable","addLogWidgets","cancelAllAH","cancelButtons","cancelButton","itemImage","auction_id","bankSettings","maxcharacters","shoutboxPreview","playerBank","headText","appLink","depoPos","balPos","initWithdraw","guildBank","transResponse","deposit_amount","oData","bankDeposit","isNumeric","bankWithdrawal","withdraw_amount","bank","depo","withdraw","ajaxifyBank","updateShoutboxPreview","chars","injectShoutboxWidgets","coreFunction","pageSwitcher","settings","-","settingsTabs","tickAll","createEventListeners","world","news","shoutbox","blacksmith","repairall","completed","prevButton","nextButton","startButton","before","finishButton","overrideButtons","pickmove","questbook","atoz","viewquest","profile","managecombatset","report","equipitem","changebio","dropitems","flrEnabled","oFlr","flrRow","auctionhouse","cancelAll","fill","quickcreate","addtags","removetags","storeitems","chat","groups","viewstats","joinallgroupsundersize","joinall","manage","advisor","weekly","history","view","scouttower","mailbox","conflicts","rpupgrades","hall","flDiv","HTMLTableElement","post","outbox","potionbazaar","pbImg","potions","marketplace","createreq","quickbuff","quickbuffDiv","notepad","showlogs","invmanagernew","guildinvmgr","recipemanager","auctionsearch","onlineplayers","quicklinkmanager","monsterlog","quickextract","quickwear","bufflogcontent","newguildlog","findbuffs","findother","savesettings","fshSettings","points","trade","createsecure","docreatesecure","toprated","xp","monthlyxp","bounties","risingstars","superelites","smasher","globalquest","topTable","viewrecipe","tempinv","wrapInner","itemIDs","quickTakeTable","titem","findplayer","quests","masterrealms","realms","shops","scavenging","temple","composing","breakdown","create","pvpladder","submitButton","leftCell","rightCell","align","lastReset","crafting","hellforge","superelite","viewupdatearchive","viewarchive","newSelector","test_cmd","isValid","getCoreFunction","fromWorld","testCoreFunction","asyncDispatcher","dispatch"],"mappings":"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,UAAW,2BACXC,SAAU,gFAGZthB,kBAAmB,CACjBqhB,UAAW,sBACXC,SAAU,yCAEZlhB,wBAAyB,CACvBihB,UAAW,0BACXC,SAAU,uGAEVnY,MAAO,8BAET9I,2BAA4B,CAC1BghB,UAAW,gCACXC,SAAU,0DACVC,SAAS,EACTpY,MAAO,kBAET7I,gBAAiB,CACf+gB,UAAW,oBACXC,SAAU,6RAKVC,SAAS,GAEX/kB,eAAgB,CACd6kB,UAAW,oBACXC,SAAU,6EAEVC,SAAS,GAEXhhB,cAAe,CACb8gB,UAAW,kBACXC,SAAU,gDACVC,SAAS,GAEXnoB,mBAAoB,CAClBioB,UAAW,qBACXC,SAAU,mEEtTHE,GACT,6kBAaSC,GAAY,CACrB,wBACA,eACA,YACA,mBACA,YACA,mBACA,YACA,mBACA,YACA,mBACA,YACA,sBACA,uBACA,sBACA,oBACA,oBACA,yBACA,gCACA,mBACA,gBACA,kBACA,sBACA,qBACA,sBACA,4BACA,+BACA,gBACA,iBACA,mBACA,WACA,yBACA,4BACA,uBACA,oBACA,2BACA,qBACA,eACA,mBACA,gBACA,oBACA,gBACA,oBACA,mBACA,gBACA,uBACA,YACA,iBACA,aACA,iBACA,cACA,kBACA,gBACA,sBACA,0BACA,qBACA,kBACA,gBACA,aACA,cACA,qBACA,qBACA,cACA,gBACA,uBACA,uBACA,wBACA,6BACA,kBACA,mBACA,sBACA,yBACA,wBACA,mBACA,cACA,qBACA,WACA,cACA,qBACA,mBACA,sBACA,qBACA,qBACA,qBACA,0BACA,iBACA,uBACA,2BACA,qBACA,oBACA,qBACA,uBACA,sBACA,sBACA,mBACA,oBACA,mBACA,iBACA,yBACA,sBACA,qBACA,qBACA,kBACA,cACA,iBACA,qBACA,2BACA,uBACA,iBACA;ACrHK,SAASC,GAASvY,EAAOve,GAC9B,MAAO,2FAC6Bue,EAAQ,kBAC1Cve,EAAO,oBAYJ,SAAS+2B,GAAUn3B,GACxB,IAAI+lB,EAAI6Q,GAAmB52B;AAC3B,OAAkB+lB,EAVZgR,QAAiBC,GAChB,IAUL,eAAiBh3B,EAAO,KAAO8F,EAASigB,EAAEpH,MAAOoH,EAAE8Q,WACnDK,GAASnR,EAAE8Q,UAAW9Q,EAAE+Q,UACxB,YAGG,SAASM,GAAap3B,GAC3B,MAAO,cAAgBA,EAAO,WAAaA,EACzC,+CAbK02B,GAAU1gB,EAauChW,IAAQ,IAG3D,SAASq3B,GAAmBr3B,GACjC,OAAOm3B,GAAUn3B,GAAQo3B,GAAap3B,GAGjC,SAASs3B,GAAet3B,GAC7B,MAAO,yBAA2Bm3B,GAAUn3B,GAC1C,YAAco3B,GAAap3B,GAAQ,aCxCxB,SAASu3B,GAAYnjB,EAAIojB,GAClCpjB,aAAc3U,SAChB2U,EAAG6F,UAAUwd,OAAO,UAAWD,GCEpB,SAASE,GAAYtE,GAJpC,IAAqBA;AASnB,OAJKA,EAAKC,KALSD,EAKQA,GAJft0B,GAAKs0B,EAAKt0B,EAAEoI,UAKtBmR,EAAE,eAAe7Y,KAAK4zB,EAAKt0B,EAAEoI,SAASkU,OAAO,QAC7CgY,EAAKhS,EAAI,GACHgS,EAAKhS,EAAI,EACVgS,ECNM,SAASuE,GAAQ1B,GAC9B,OAAO3C,GAAQ2C,GAAe3Z,KAAKob,ILmBrC,SAASE,GAAS7S,EAAMzd,EAAIuwB,GAC1Br1B,EAAU,YAAa,YACvBuiB,EAAKrkB,YAAc,GACnBqkB,EAAK9K,UAAU6d,OAAO,aACtB/S,EAAK9K,UAAU5S,IAAI,aAAc,aACjCC,EAAGyd,EAAKqM,QAAQ2G,QAAQpW,KAAK,SAASjb,GACrB,IAAXA,EAAK0a,IACT2D,EAAKhL,WAAWyK,UAAY,0BAA4BqT,EAAO,aAInE,SAASG,GAAUjT,GACjB6S,GAAS7S,EAAM4S,GAAS,QA4B1B,SAASM,GAAcC,EAAUrC,GAC/B,IAAI1D,EAAa0D,EAAQ32B;AACzB22B,EAAQ7F,MAAMrU,QAZhB,SAAsBuc,EAAU/F,EAAYpM,GAC1C,IAAIoS,EAAKpS,EAAEmP;AACM,MAAbgD,EACFC,EAAGle,UAAU6d,OAAO,WAGpBP,GAAYY,EADAD,IAAa/F,EAAWtuB,aAOH8D,KAAK,KAAMuwB,EAAU/F,IAa1D,IMnEIra,GNmEAsgB,GAAS,CACX,CACEjzB,KAAM,SAAS4f,GACb,OAAOA,EAAK9K,UAAU+Q,SAAS,cAC7BjG,EAAK9K,UAAU+Q,SAAS,UAE5BpL,IAnCJ,SAAmCmF,GACjC6S,GAAS7S,EAAMiR,GAAW,UAoC1B,CACE7wB,KAAM,SAAS4f,GACb,OAAOA,EAAK9K,UAAU+Q,SAAS,cAC7BjG,EAAK9K,UAAU+Q,SAAS,WAE5BpL,IArDJ,SAAiCmF,GAC3BnP,GACFoiB,GAAUjT,GAEVrG,GAAS,mBACP,iDACAsZ,GAAUrwB,KAAK,KAAMod,MAiDzB,CACE5f,KAAM,SAAS4f,GAAO,OAAOA,EAAK9K,UAAU+Q,SAAS,cACrDpL,IA3BJ,SAAqBmF,GACnB,IAAImT,EAAWnT,EAAKqM,QAAQiH;AAC5B1B,GAASvV,EAAEzF,QAAQsc,GAActwB,KAAK,KAAMuwB,MA2B5C,CACE/yB,KAAM,SAAS4f,GAAO,MAAmB,4BAAZA,EAAK7lB,IAClC0gB,IA1BJ,WAEEoD,GAAS,0BADTpN,IAA2BA;AA+C7B,SAAS0iB,GAAc5C,GACrBiB,GAAWjB;AACX,IAAI6C,EAnBG/a,GAAU,CACfte,GAAI,UACJ+lB,UAAW,0CACXT,UAAW;AAkBblG,GAAcia,EADE9C,GAAgBC,IAEhCjP,GAAQjC,UAAY,GACpBlG,GAAcmI,GAAS8R,GACvBA,EAAQpwB,iBAAiB,QAAS2qB,GAAasF,KAC/C9Z,GAAcia,EH1CD,SAA0B5B,GACvC,IAAIP,EAAW,GACXC,EAAU/f,GAAa;AAE3BqgB,EAASvV,EAAEzF,QAAQ,SAASka,GAC1BA,EAAQ7F,MAAMrU,QAXlB,SAAsBya,EAAUC,EAAS9C,GACvC,IAzEoB6C,EAAUp2B,EAyE1BA,EAAOuzB,EAAKuB,GAzEIsB,EA0EPA,GA1EiBp2B,EA0EPA,GAxErBo2B,EAASp2B,GAAMw2B,OAAS,EAExBJ,EAASp2B,GAAQ,CAACw2B,MAAO,EAAGF,aAAc,IAuE5CD,EAAQ1a,QAZV,SAA2Bya,EAAUp2B,EAAMw4B,GACrCx4B,IAASw4B,EAASnkB,aACpBmkB,EAAS/B,OAAQ,EACbL,EAASp2B,GAAMs2B,aAAaxyB,QAAQ00B,EAASlkB,UAAY,GAC3D8hB,EAASp2B,GAAMs2B,aAAazwB,KAAK2yB,EAASlkB,YAQZ3M,KAAK,KAAMyuB,EAAUp2B,KAQlB2H,KAAK,KAAMyuB,EAAUC;AAE1D,IAAIoC,EAAKjb,GAAU,CACjBte,GAAI,aACJ+lB,UAAW;AAGb,OADAtlB,EAAoB84B,EAAItC,GAAUC,EAAUC,IACrCoC,EG8BgBC,CAAiBhD,IACxC/1B,EAAoBV,EAAe,aACjCo4B,GAAmB,4BAGvB,SAASsB,GAAU1R,IACjBR,GAAUQ,GAAYpE,MAEtBljB,EAAoB8mB,GAAS,sCOtItBzJ,GAAQ,CAACyE,IAAK,UAAWC,OAAQ,kBPuIxBC,KAAK2W,IACrB1iB,GAA0BI,EAAS,4BAGtB,SAAS4iB,GAAgB3R,GAClC9J,MAAkBwb,GAAU1R,GQ/InB,SAAS4R,GAAa74B,EAAMK,GACzCiE,YAAYtE,EAAMiU,KAAKC,UAAU7T,IFgBnC,SAASy4B,GAAU1yB,EAAG2yB,GACpB,MAAsB,aAAlBjhB,GAAMkhB,KAAK5yB,GACN,yBAA2BswB,GAAUqC,GAC1C,cAPU3yB,EAQIA,EAPX0R,GAAMN,KAAwB,KAAjBM,GAAMN,IAAIpR,GAQrB,YAAc0R,GAAMN,IAAIpR,GAAGhE,QAAQ,cAAe22B,GACvD,KAAOA,EAAY,OAEhBA;AAZT,IAAgB3yB,EAmChB,SAAS6yB,KACP,IAAIx1B,EAAS;AAEbA,GAAUqU,GAAMohB,QAAQhO,OAAO,SAASC,EAAMC,GAC5C,OAAOD,EAAO,OAASC,EAAO,SAC7B,IACH3nB,GAAU;AACV,IAAI01B,EAAkB;AACtBrhB,GAAMshB,aAAazd,QAAQ,SAAS4X,EAAMtuB,GACxCxB,GAAU,OACNqU,GAAMuhB,eACNF,IACA5F,EAAKzb,GAAMuhB,iBACbF,EAAkB5F,EAAKzb,GAAMuhB,eAC7B51B,GAAU,2BACR01B,EAAkB,6DAGtB11B,GAtCJ,SAAiB8vB,GAEf,IADA,IAAI9vB,EAAS,GACJ2C,EAAI,EAAGA,EAAI0R,GAAMwhB,OAAOp0B,OAAQkB,GAAK,EAAG,CAC/C3C,GAAU;AACV,IAAIs1B,EAAYxF,EAAKzb,GAAMwhB,OAAOlzB;AAC9B0R,GAAMwhB,OAAOlzB,KAAO0R,GAAMuhB,gBAC9B51B,GAAUq1B,GAAU1yB,EAAG2yB,GAAa,SAEtC,OAAOt1B,EA8BK81B,CAAQhG,GAClB9vB,GAAU,iDAAmDwB,EAC3D,eAAiBA,EAAI,6BAEzBxB,GA/BF,WAEE,IADA,IAAIA,EAAS,OACJwB,EAAI,EAAGA,EAAI6S,GAAMkhB,KAAK9zB,OAAQD,GAAK,EAC1CxB,GAAU,iCAAmCqU,GAAMkhB,KAAK/zB,GACtD,kCAAoC6S,GAAMwhB,OAAOr0B,GAAK;AAE1D,OAAOxB,EAyBG+1B,GACV/1B,GAAU,iKAIRwQ,KAAKC,UAAU4D,GAAMshB,cAAgB,4NAMvCn6B,EAAe6Y,GAAM5Y,IAAIslB,UAAY/gB,EACrCo1B,GAAa/gB,GAAM2hB,OAAQ3hB,GAAMshB,cAmDnC,IAAIM,GAAa,CACf,CAACv0B,KAAM,SAAS4f,GAAO,MAAmB,aAAZA,EAAK7lB,IAAqB0gB,IAT1D,WACmB,WAAb9H,GAAM5Y,GACR4Y,GAAMshB,aACJnjB,GAAUhM,EAAS+J,iBACf8D,GAAMshB,aAAe,GAC7BH,OAKA,CAAC9zB,KAAM,SAAS4f,GAAO,MAAmB,YAAZA,EAAK7lB,IAAoB0gB,IAlBzD,WACE,IAAI+Z,EAAY1jB,GAAUhX,EAAe,SAASoB;AAC9CsjB,MAAMiW,QAAQD,KAChB7hB,GAAMshB,aAAeO,EACrBV,QAeF,CAAC9zB,KAAM,SAAS4f,GAAO,MAAmB,WAAZA,EAAK7lB,IAAmB0gB,IA/BxD,WACE,IACIia,EAAU;AAEZA,EAHwC,IAAxB/hB,GAAMwhB,OAAOp0B,OAGnBjG,EAAe,UAAUoB,MAlBvC,WAEE,IADA,IAAIw5B,EAAU,GACL50B,EAAI,EAAGA,EAAI6S,GAAMwhB,OAAOp0B,OAAQD,GAAK,EACtB,aAAlB6S,GAAMkhB,KAAK/zB,GACb40B,EAAQ/hB,GAAMwhB,OAAOr0B,IACnBhG,EAAe,QAAU6Y,GAAMwhB,OAAOr0B,IAAI60B,QAE5CD,EAAQ/hB,GAAMwhB,OAAOr0B,IACnBhG,EAAe,QAAU6Y,GAAMwhB,OAAOr0B,IAAI5E;AAGhD,OAAOw5B,EASKE,GAEZjiB,GAAMshB,aAAavzB,KAAKg0B,GACxBZ,OAuBA,CACE9zB,KAAM,SAAS4f,GAAO,OAAqC,IAA9BA,EAAK7lB,GAAG4E,QAAQ,WAC7C8b,IAtDJ,SAAyBmF,GACvB,IAAIiV,EAASjV,EAAK6F,aAAa;AAC/B9S,GAAMshB,aAAavF,OAAOmG,EAAQ,GAClCf;AAuDK,SAASgB,GAAoBhT,GAClC,IAAIR,EAAUQ,GAAYpE;AAC1B4D,EAAQjC,UACNgB,GAAe,yBAA0B,GAAI,GAAI,IACjD,sgBAWF1N,GAAQ,CACN5Y,GAAI,SACJg6B,QAAS,CAAC,WAAY,WAAY,oBAChC,kBACFI,OAAQ,CAAC,WAAY,WAAY,aAAc,eAC/CN,KAAM,CAAC,OAAQ,OAAQ,OAAQ,YAC/BxhB,IAAK,CAAC,GAAI,GACR,gEAAiE,IACnE4hB,aAAc9iB,GAAa,mBAC3BmjB,OAAQ,kBACRJ,cAAe,YAEjBJ,KACAxS,EAAQte,iBAAiB,QAAS2qB,GAAa4G,KAG1C,SAASQ,GAAuBjT,GACrC,IAAIR,EAAUQ,GAAYpE;AAC1B4D,EAAQjC,UAAYsB,GAAiB,CACnCnH,MAAO,cACP8G,QAAS,GACTC,OAAQ,GACRC,OAAQ,GACRK,MAAO,QAITlO,GAAQ,CACN5Y,GAAI,MACJg6B,QAAS,CAAC,OAAQ,MAChB,2FAEFI,OAAQ,CAAC,OAAQ,MAAO,aACxBN,KAAM,CAAC,OAAQ,OAAQ,YACvBI,aAAc9iB,GAAa,cAC3BmjB,OAAQ,cAEVR,KACAxS,EAAQte,iBAAiB,QAAS2qB,GAAa4G,KGnMjD,ICIIS,GACAC,GDLJjU,GAAe,CACb,CAACnmB,KAAM,OAAuBq6B,KAAM,GAAIva,IAAK,EAAM5gB,GAAI,EAAKo7B,MAAO,QACnE,CAACt6B,KAAM,OAAuBq6B,KAAM,GAAIva,IAAK,EAAM5gB,GAAI,EAAKo7B,MAAO,WACnE,CAACt6B,KAAM,OAAuBq6B,KAAM,GAAIva,IAAK,GAAM5gB,GAAI,EAAKo7B,MAAO,QACnE,CAACt6B,KAAM,eAAuBq6B,KAAM,GAAIva,IAAK,GAAM5gB,GAAI,EAAKo7B,MAAO,+BACnE,CAACt6B,KAAM,iBAAuBq6B,KAAM,GAAIva,IAAK,GAAM5gB,GAAI,EAAKo7B,MAAO,qBACnE,CAACt6B,KAAM,UAAuBq6B,KAAM,GAAIva,IAAK,GAAM5gB,GAAI,EAAKo7B,MAAO,WACnE,CAACt6B,KAAM,aAAuBq6B,KAAM,GAAIva,IAAK,GAAM5gB,GAAI,EAAKo7B,MAAO,iBACnE,CAACt6B,KAAM,aAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,EAAKo7B,MAAO,iBACnE,CAACt6B,KAAM,YAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,sBACnE,CAACt6B,KAAM,SAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,cACnE,CAACt6B,KAAM,qBAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,oCACnE,CAACt6B,KAAM,SAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,eACnE,CAACt6B,KAAM,gBAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,oBACnE,CAACt6B,KAAM,aAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,kCACnE,CAACt6B,KAAM,gBAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,oBACnE,CAACt6B,KAAM,kBAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,kCACnE,CAACt6B,KAAM,YAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,gBACnE,CAACt6B,KAAM,kBAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,yCACnE,CAACt6B,KAAM,eAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,mBACnE,CAACt6B,KAAM,WAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,mBACnE,CAACt6B,KAAM,aAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,+BACnE,CAACt6B,KAAM,gBAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,2BACnE,CAACt6B,KAAM,aAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,kBACnE,CAACt6B,KAAM,SAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,cACnE,CAACt6B,KAAM,YAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,gBACnE,CAACt6B,KAAM,cAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,kBACnE,CAACt6B,KAAM,cAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,mBACnE,CAACt6B,KAAM,qBAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,IAAKo7B,MAAO,6BACnE,CAACt6B,KAAM,YAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,IAAKo7B,MAAO,gBACnE,CAACt6B,KAAM,cAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,qBACnE,CAACt6B,KAAM,eAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,IAAKo7B,MAAO,mBACnE,CAACt6B,KAAM,WAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,IAAKo7B,MAAO,eACnE,CAACt6B,KAAM,kBAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,IAAKo7B,MAAO,sBACnE,CAACt6B,KAAM,eAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,IAAKo7B,MAAO,mBACnE,CAACt6B,KAAM,aAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,IAAKo7B,MAAO,iBACnE,CAACt6B,KAAM,cAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,GAAKo7B,MAAO,qBACnE,CAACt6B,KAAM,UAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,IAAKo7B,MAAO,iBACnE,CAACt6B,KAAM,kBAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,IAAKo7B,MAAO,sBACnE,CAACt6B,KAAM,eAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,IAAKo7B,MAAO,oBACnE,CAACt6B,KAAM,iBAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,IAAKo7B,MAAO,0BACnE,CAACt6B,KAAM,SAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,IAAKo7B,MAAO,UACnE,CAACt6B,KAAM,kBAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,IAAKo7B,MAAO,mBACnE,CAACt6B,KAAM,kBAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,IAAKo7B,MAAO,mBACnE,CAACt6B,KAAM,cAAuBq6B,KAAM,GAAIva,IAAK,EAAM5gB,GAAI,GAAKo7B,MAAO,wBACnE,CAACt6B,KAAM,UAAuBq6B,KAAM,GAAIva,IAAK,GAAM5gB,GAAI,EAAKo7B,MAAO,WACnE,CAACt6B,KAAM,QAAuBq6B,KAAM,GAAIva,IAAK,GAAM5gB,GAAI,GAAKo7B,MAAO,SACnE,CAACt6B,KAAM,SAAuBq6B,KAAM,GAAIva,IAAK,GAAM5gB,GAAI,GAAKo7B,MAAO,cACnE,CAACt6B,KAAM,YAAuBq6B,KAAM,GAAIva,IAAK,GAAM5gB,GAAI,GAAKo7B,MAAO,gBACnE,CAACt6B,KAAM,kBAAuBq6B,KAAM,GAAIva,IAAK,GAAM5gB,GAAI,EAAKo7B,MAAO,wDACnE,CAACt6B,KAAM,qBAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,+BACnE,CAACt6B,KAAM,UAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,gBACnE,CAACt6B,KAAM,eAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,mBACnE,CAACt6B,KAAM,cAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,2BACnE,CAACt6B,KAAM,QAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,SACnE,CAACt6B,KAAM,SAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,cACnE,CAACt6B,KAAM,eAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,sBACnE,CAACt6B,KAAM,iBAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,qBACnE,CAACt6B,KAAM,oBAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,6BACnE,CAACt6B,KAAM,SAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,cACnE,CAACt6B,KAAM,YAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,kBACnE,CAACt6B,KAAM,SAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,UACnE,CAACt6B,KAAM,YAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,oBACnE,CAACt6B,KAAM,mBAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,8BACnE,CAACt6B,KAAM,YAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,kBACnE,CAACt6B,KAAM,YAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,gBACnE,CAACt6B,KAAM,UAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,eACnE,CAACt6B,KAAM,aAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,iBACnE,CAACt6B,KAAM,iBAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,qBACnE,CAACt6B,KAAM,QAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,YACnE,CAACt6B,KAAM,mBAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,IAAKo7B,MAAO,uBACnE,CAACt6B,KAAM,UAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,IAAKo7B,MAAO,gBACnE,CAACt6B,KAAM,YAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,mBACnE,CAACt6B,KAAM,aAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,GAAKo7B,MAAO,iBACnE,CAACt6B,KAAM,YAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,GAAKo7B,MAAO,iBACnE,CAACt6B,KAAM,sBAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,IAAKo7B,MAAO,0BACnE,CAACt6B,KAAM,UAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,IAAKo7B,MAAO,kBACnE,CAACt6B,KAAM,YAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,IAAKo7B,MAAO,iBACnE,CAACt6B,KAAM,QAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,IAAKo7B,MAAO,SACnE,CAACt6B,KAAM,eAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,IAAKo7B,MAAO,uBACnE,CAACt6B,KAAM,WAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,IAAKo7B,MAAO,0BACnE,CAACt6B,KAAM,WAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,IAAKo7B,MAAO,0BACnE,CAACt6B,KAAM,cAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,IAAKo7B,MAAO,sCACnE,CAACt6B,KAAM,cAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,IAAKo7B,MAAO,4BACnE,CAACt6B,KAAM,gBAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,IAAKo7B,MAAO,iBACnE,CAACt6B,KAAM,iBAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,IAAKo7B,MAAO,kBACnE,CAACt6B,KAAM,SAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,IAAKo7B,MAAO,UACnE,CAACt6B,KAAM,YAAuBq6B,KAAM,GAAIva,IAAK,EAAM5gB,GAAI,GAAKo7B,MAAO,gBACnE,CAACt6B,KAAM,kBAAuBq6B,KAAM,GAAIva,IAAK,EAAM5gB,GAAI,GAAKo7B,MAAO,mCACnE,CAACt6B,KAAM,eAAuBq6B,KAAM,GAAIva,IAAK,EAAM5gB,GAAI,GAAKo7B,MAAO,mBACnE,CAACt6B,KAAM,eAAuBq6B,KAAM,EAAIva,IAAK,EAAM5gB,GAAI,GAAKo7B,MAAO,mBACnE,CAACt6B,KAAM,gBAAuBq6B,KAAM,GAAIva,IAAK,GAAM5gB,GAAI,GAAKo7B,MAAO,oBACnE,CAACt6B,KAAM,WAAuBq6B,KAAM,GAAIva,IAAK,GAAM5gB,GAAI,GAAKo7B,MAAO,YACnE,CAACt6B,KAAM,YAAuBq6B,KAAM,GAAIva,IAAK,GAAM5gB,GAAI,GAAKo7B,MAAO,sBACnE,CAACt6B,KAAM,WAAuBq6B,KAAM,GAAIva,IAAK,GAAM5gB,GAAI,GAAKo7B,MAAO,uBACnE,CAACt6B,KAAM,aAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,iBACnE,CAACt6B,KAAM,mBAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,sCACnE,CAACt6B,KAAM,UAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,eACnE,CAACt6B,KAAM,UAAuBq6B,KAAM,EAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,mBACnE,CAACt6B,KAAM,WAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,2BACnE,CAACt6B,KAAM,iBAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,+BACnE,CAACt6B,KAAM,YAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,mBACnE,CAACt6B,KAAM,SAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,cACnE,CAACt6B,KAAM,WAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,sEACnE,CAACt6B,KAAM,YAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,kBACnE,CAACt6B,KAAM,cAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,6DACnE,CAACt6B,KAAM,cAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,yBACnE,CAACt6B,KAAM,aAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,+BACnE,CAACt6B,KAAM,eAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,IAAKo7B,MAAO,4BACnE,CAACt6B,KAAM,aAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,iBACnE,CAACt6B,KAAM,YAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,4BACnE,CAACt6B,KAAM,kBAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,sBACnE,CAACt6B,KAAM,eAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,IAAKo7B,MAAO,gBACnE,CAACt6B,KAAM,QAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,SACnE,CAACt6B,KAAM,YAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,iBACnE,CAACt6B,KAAM,YAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,GAAKo7B,MAAO,qBACnE,CAACt6B,KAAM,YAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,IAAKo7B,MAAO,kBACnE,CAACt6B,KAAM,YAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,IAAKo7B,MAAO,gBACnE,CAACt6B,KAAM,UAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,IAAKo7B,MAAO,eACnE,CAACt6B,KAAM,mBAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,IAAKo7B,MAAO,uBACnE,CAACt6B,KAAM,SAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,IAAKo7B,MAAO,eACnE,CAACt6B,KAAM,YAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,IAAKo7B,MAAO,mBACnE,CAACt6B,KAAM,aAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,IAAKo7B,MAAO,iBACnE,CAACt6B,KAAM,gBAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,IAAKo7B,MAAO,oBACnE,CAACt6B,KAAM,UAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,IAAKo7B,MAAO,iBACnE,CAACt6B,KAAM,UAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,IAAKo7B,MAAO,eACnE,CAACt6B,KAAM,eAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,IAAKo7B,MAAO,gEACnE,CAACt6B,KAAM,aAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,IAAKo7B,MAAO,qCACnE,CAACt6B,KAAM,YAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,IAAKo7B,MAAO,kCACnE,CAACt6B,KAAM,gBAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,IAAKo7B,MAAO,iBACnE,CAACt6B,KAAM,WAAuBq6B,KAAM,GAAIva,IAAK,KAAM5gB,GAAI,IAAKo7B,MAAO,YACnE,CAACt6B,KAAM,aAAuBq6B,KAAM,GAAIva,IAAK,IAAM5gB,GAAI,IAAKo7B,MAAO;AE9GtD,SAASC,GAAWxU,EAAGtQ,GACpC,MAAO,2FAESsQ,EAAEyU,OAAS,0CACSzU,EAAE0U,KAAO,2BAClC1U,EAAE2U,UAAY,6CACc3U,EAAE4U,OAAS,8FAEjB5U,EAAE6U,SACjC,kMAIiB7U,EAAE8U,UAAY,uGAG/B3D,GAAS,wBACP,0LAG8C,qLAI/CzhB,GAAgB,IAAM,2CACUsQ,EAAE+U,UAAY,mXASX/U,EAAEgV,SAAW,4TArD5C,qBA4DOhV,EA5DkB+U,UAAY,qNASrC,oaCZM,SAASE,GAASC,EAAOC,EAAM11B,GAC5C,OAAOA,GAAQvF,YAAYC,MAAQ+6B,GAASC,EAAO11B,EAAKN,OFM1D,IAAIi2B,GACF,uEAYEC,GAAU,CACZ,SAAS5f,EAAK4G,GACZ,OAAI5G,EAAI6f,IAAajZ,EAA8B,KAAxBze,SAAS6X,EAAI6f,IAAK,IACtCjZ,GAET,SAAS5G,EAAK4G,GACZ,OAAI5G,EAAI8f,KAAclZ,EAA+B,GAAzBze,SAAS6X,EAAI8f,KAAM,IACxClZ,GAET,SAAS5G,EAAK4G,GACZ,OAAI5G,EAAI4G,IAAaA,EAAMze,SAAS6X,EAAI4G,IAAK,IACtCA,GAET,SAAS5G,EAAK4G,GACZ,OAAI5G,EAAI+f,WACCj7B,KAAK8Y,OAAOD,GAAUqC,EAAI+f,YAAc,IAE1CnZ,GAET,SAAS5G,EAAK4G,GAEZ,MAAI,eAAgB5G,IAAQA,EAAI+f,WAAoB,MAC7CnZ,IAIPoZ,GAAS,CACX,CAACh4B,UAAW,EAAGC,OArCf,6EAsCA,CAACD,UAAW,EAAGC,OApCf,+EAqCA,CAACD,UAAW,GAAIC,OAnChB,+EAoCA,CAACD,UAAW,MAAOC,OAlCnB,4EAmCA,CAACD,UAAW,MAAOC,OAjCnB;AAoCK,SAASg4B,GAAUjgB,GAIxB,IAHA,IAAI4G,EAAMgZ,GAAQlQ,OAAO,SAASC,EAAMC,GACtC,OAAOA,EAAK5P,EAAK2P,IAChB,GACMlmB,EAAI,EAAGA,EAAIu2B,GAAOt2B,OAAQD,GAAK,EAAG,CACzC,IAAImP,EAAKonB,GAAOv2B;AAChB,GAAImd,EAAMhO,EAAG5Q,UAAY,OAAO4Q,EAAG3Q,OAErC,OAAO03B,GAcT,SAASO,KAEP,IADA,IAZuBC,EACnBC,EAWAX,EAAQh7B,YAAYC,MAAQ,EACzB86B,GAASC,EAAOb,GAAUD,KAbVwB,EAcLxB,GAAQC,SAbtBwB,EAAAA,EAAe5iB,GAChB5C,KAAKulB,EAAYvK,QAAQC,QAC5BsK,EAAY5hB,WAAW8hB,gBAAgBrX,UACrCiX,GAAU,CACRrZ,IAAKwZ,EAAa,GAClBN,KAAMM,EAAa,GACnBP,IAAKO,EAAa,KAQpBxB,IAAY;AAEVA,GAAWD,GAAQj1B,QACrBmC,EAAI,EAAGq0B,IAIJ,SAASI,KACT9lB,EAAS,uBACdmkB,GAAU/6B,SAASgb,iBACjB,wCACFggB,GAAW,EACX/yB,EAAI,EAAGq0B,KGtFT,ICJIK,GDIAC,GAAiB;AA6GN,SAASC,GAAuBC,EAAcC,GAC3D,IAlDIC,EAFAC,EAeYl9B,EAAKg9B,EAAUP,EAAcU,EACzCC,EAEAC,EAEAC,EAgCAt9B,EAAM0iB,GAAeqa,GAIrBQ,EAFWz9B,EAAe,MAAOE,GAEF+oB,qBAAqB,KAAK,GACzD0T,EAAe,yBAChBxlB,KAAKsmB,EAAoBh8B,aAExB47B,EAAcr9B,EAAe,cAAeE,GAAKqlB,UACjDmY,EAAY19B,EAAe,aAC3B29B,EAxFN,SAAqBN,EAAaO,GAQhC,IAPA,IATiBP,EAAaQ,EAC1BC,EAP0BD,EAC1BE,EAjBQC,EAAKC,EACbC,EA8BA7I,EAAM,GACN8I,EAAe,EACfC,EAAmB,EACnBP,EAAuB,EACvBQ,EAAkB,IAAMhB,EAAc,IACtCiB,EAAS,IAAI73B,OAAO,cACtBm3B,EAAcz6B,QAAQ,KAAM,OAAS,cAAe,MAC7B,IAAlBg7B,GAIL,IAAsB,KADtBA,GAFAE,EAAkBA,EAAgB55B,OAAO25B,EACvCC,EAAgBp4B,SACa/C,OAAOo7B,IACb,CACvBF,EAAmBD,EAAe;AAElC,IAAIJ,GA7BsBF,EA4B1BA,GAAwBM,GA1BZ,KADZJ,EA4BuBV,EA5BFkB,YAAY,OAAQV,EAAuB,IACzC,EACpBE,GA2BCD,GAxBsBD,EAwBUA,GAtBxB,KADZC,GADaT,EAwBUA,GAvBFx4B,QAAQ,OAAQg5B,MACa,IAAjCR,EAAYx4B,QAAQ,QAChCw4B,EAAYp3B,OAAS,EAEvB63B,GAoBCU,EAAWnB,EAAY54B,OAAOs5B,EAAS,EAAGD,EAASC;AACvDS,EAAWA,EAASr7B,QAAQ,+BAAgC,IAC5DkyB,EAAIzuB,KAAK43B,GAGb,OApDYR,EAoDA3I,EAnDR6I,EAAO,GACPD,EACKD,EAAI7K,OAAO,SAASmB,GACzB,OAAI4J,EAAK5J,EAAK2J,MACdC,EAAK5J,EAAK2J,KAAa,KAIpBD,EAAI7K,OAAO,SAASmB,GACzB,OAAI4J,EAAK5J,KACT4J,EAAK5J,IAAQ,KA2GKmK,CAAYpB,EAAaH,EAASU,eAElDT,GAhEAC,EAASp9B,EAAe,oBAgEEE,GA/D3B+oB,qBAAqB,KAExBvE,MAAMC,UAAU1C,KAAK2C,KAAKwY,EAAQ,SAASjoB,GACzC,GAAuB,YAAnBA,EAAG1T,YAA2B,CAChC,IAAIi9B,EAAcvpB,EAAG2F,WAAWA,WAAWA,WAAW+M,mBACnD8K,kBAAkBR,QAAQC;AAE7B,OADA+K,EAAez4B,SAASq4B,GAAe5lB,KAAKunB,GAAa,GAAI,KACtD,EAET,OAAO,IAEF73B,EAASs2B,GAAe,IAsD3BwB,EAAgBz+B,EAAI0+B,cACtB;AAGF,GAA2B,EAAvBjB,EAAc13B,OAAY,CAC5B,IAAI8vB,EAAS2H,EAAU1H,WAAW,GAE9B6I,EAAU9I,EAAO+I,WAAW;AAChCD,EAAQ90B,MAAMg1B,cAAgB,MAC9BF,EAAQtZ,WA5DW2X,EA4DeA,EA5DLP,EA4DeA,EA5DDU,EA4DeA,EA3DxDC,EAAkBt9B,EAAe,MADrBE,EA4DeA,GA1D5B+oB,qBAAqB,MAAM,GAAGxnB,YAC7B87B,EAAanW,GAASpnB,EAAe,oBAAqBE,GAC3DwlB,SAAS,GAAGA,SAAS,GAAGkN,KAAK,GAAGC,MAAM,GAAGpxB,aACxC+7B,EAAoB94B,SAAS1E,EAAe,UAAWE,GACxDuB,YAAa,IAKT,SAHe+6B,GAAU,CAACrZ,IADPze,SAASi4B,EAAa,GAAI,MAIhB,kBAFnBO,EAAS9hB,KAGX,kDAFFiiB,EAAYl6B,QAAQ,UAAW,IAKf,KAAOm6B,EAAkB,iFAEhCA,EAAkB,yEACQC,EAC9C,UAAYC,EAAoB,KA0ChCpkB,EAAE,YAAY4lB,MAAM,SAASnZ,GAC3B5jB,OAAOg9B,mBAAmBpZ,EAAIrb,OAAOmhB,aAAa,qBAIpDkT,EAAU9I,EAAO+I,WAAW,IACpBvZ,UA7CZ,SAAoBoX,EAAcQ,EAAcwB,GAC9C,IAAIO,EAAU;AACM,KAAhB/B,IAAsB+B,EAAU;AACpC,IAAI5iB,EAAS;AAEb,OADIqiB,IAAgBriB,EAAS,qCACtB,6FAEsBqgB,EAAa,GAAK,0EAEjBuC,EAAU,KAAO/B,EAAe,2DAEpC7gB,EAAS,aAkCb6iB,CAAWxC,EAAcQ,EAAcwB,GAC3DE,EAAQ90B,MAAMg1B,cAAgB,MAE9BF,EAAU9I,EAAO+I,WAAW,GAC5BnB,EAAcjhB,QAAQ,SAASvH,GAC7B0pB,EAAQtZ,WAAapQ,EAAK,SAG9B,IAAIiqB,EAAmBp/B,EAAe,oBAClCq/B,EACF36B,SAAS1E,EAAe,oBAAoByB,YAAa,IACvD69B,EAAwB56B,SAAS06B,EAAiB39B,YAAa;AACnE29B,EAAiB7Z,UAAY+Z,EAAwB,EACjDD,IAAqBC,EAAwB,IAC/CpC,EAASqC,eAAeha,UAAY,QACpC2X,EAASqC,eAAex1B,MAAMwsB,MAAQ,QC7J3B,SAASvN,KAItB,OAHK8T,KACHA,GAAiB98B,EAAe,qBAAqByB,aAEhDq7B,GCLF,ICaH0C,GACA5B,GACA6B,GACAC,GACA7S,GACA8S,GACOnpB,GACPopB,GACAC,GACAN,GDtBOO,GAAa,CACtBvE,OAAQ,OACRC,KAAM,OACNC,QAAS,WAEP,IADA,IAAIvF,EAAM,kDACD/uB,EAAI,EAAGA,EAAI+f,GAASjhB,OAAQkB,GAAK,EACxC+uB,GAAO,kBAAoBhP,GAAS/f,GAAGlH,GAAK,KAC1CinB,GAAS/f,GAAGpG,KAAO;AAGvB,OADAm1B,GAAO,aAGTwF,OAAQ,WACRC,SAAU,6BACVC,UAAW,OACXC,UAAW,OACXC,SAAU,WAEDiE,GAAc,CACvBxE,OAAQ,QACRC,KAAM,OACNC,QAAS,WAEP,MAAO,uHADe1kB,EAAS,oBAAsB,IAGjC,MAEtB2kB,OAAQ,YACRC,SAAU,oBACVC,UAAW,OACXC,UAAW,OACXC,SAAU;ACPZ,SAASkE,KAKP,GAFAhgC,EAAe,oBAAoBulB,UACjCsH,GAAc5mB,OACZ4mB,GAAc5mB,QAAU,EAG1B,OAFAs5B,GAAeha,UAAY,aAC3Bga,GAAex1B,MAAMwsB,MAAQ;AAG/BgJ,GAAeha,UAAY,0BAC3Bga,GAAex1B,MAAMwsB,MAAQ,QAM7B1J,GAAcnQ,QAAQ,SAASvV,GAC7B2W,GAAU3W,GAAGub,KAAK,SAASniB,GACzBy8B,GAAuBz8B,EAAM,CAC3B6a,KAAMyR,GAAc1lB,GACpBo4B,eAAgBA,GAChB3B,cAAeA,SAMvB,SAASqC,KACP,OAAIP,GAA+B,IAC5B,EAQT,SAASQ,GAAsBC,EAAcC,GAEvCZ,KAAkBY,EAAiBC,QACrCxT,GAAcjmB,KAAKu5B,GAIvB,SAASG,GAAUt6B,EAAGnG,GACpB,IAAIsgC,EAAe/mB,EAAEvZ,GAAGioB,KAAK,cAAc8H,KAAK,QAC5C2Q,EAAoB77B,SAAS0U,EAAEvZ,GAAGioB,KAAK,YAAY3mB,OACpDgC,QAAQ,KAAM,IAAK,IAClBi9B,EAAmBhnB,EAAEvZ,GAAGioB,KAAK,cAAc3mB,OAC3Cq/B,EAAwBP;AACHR,IAArBc,GACqBC,GAArBD,GACFL,GAAsBC,EAAcC,GAIxC,SAASK,GAA4BxD,GACnC,IAzBoByD,EAASC,EAyBzBzgC,EAAM0iB,GAAeqa,GACrB2D,EAAaxnB,EAAElZ,GAAK4nB,KAAK,iFAEzB6Y,EAAUj8B,SAAS0U,EAAElZ,GAAK4nB,KAAK,mCAChC3mB,OAAOgC,QAAQ,MAAO,IAAK,IAC1Bu9B,EAAUh8B,SAAS0U,EAAElZ,GAAK4nB,KAAK,2BAA2BwC,MAC3DnnB,QAAQ,MAAO,IAAK;AAIvB,GAHgB,IAAZu9B,GACFE,EAAWvnB,KAAKinB,IAEdI,EAAUC,EAAS,CACrB,IAAIE,GApCuBF,EAoCSA,EAnCtB,KADID,EAoCSA,GAnCFr/B,KAAKC,MAAMq+B,GAAuBgB,EAAU,IAChED,EAAU;AAmCfnB,GAAeha,UAAY,uBAAyBmb,EAAU,OAC9D5iB,GAAU,gDACR+iB,EAAQj8B,YAAY8d,KAAK+d,SAG3BT,KAIJ,SAASc,KAIsB,KAF7BnB,GACEj7B,SAAS1E,EAAe,iBAAiBoB,MAAO,KAEhD0c,GAAU,kDACP4E,KAAK+d,IAERT,KAgBJ,SAASe,GAAgB5rB,GACvB,IAbuBid,EACnBuK,EACAqE,EACAC,EAIsCC,EAAQV,EAM9CpO,EAASjd,EAAGgd,QAAQC,OACpB+O,GAdmB/O,EAcmBA,EAbtCuK,EAAe5iB,GAAe5C,KAAKib,GACnC4O,EAAmBt8B,SAASi4B,EAAa,GAAI,IAC7CsE,EAAoBv8B,SAASi4B,EAAa,GAAI,IAAyB,GAAnBqE,EACjDt8B,SAASi4B,EAAa,GAAI,IAA0B,GAApBsE,GAYnCC,EAAS1/B,OAAO,cAAc2V,KAAKib,GAAQ,IAC3CoO,EAAwBP;AAVciB,EAWHA,EAXWV,EAWHA,EAA7BW,EAVW,GAAe1B,IAAVyB,GACtBV,GAAVU,GAUAhB,GAAsB/qB,EAAGiG,KAAMjG,EAAG1T,aAItC,SAAS2/B,GAA0BnE,GACjC,IACIoE,EADMze,GAAeqa,GAEnB9hB,iBAAiB;AACvBuJ,MAAMC,UAAUjI,QAAQkI,KAAKyc,EAAsBN,KAEnDlB,IAAiC,KAE/BD,GAAqB35B,QACrB66B,KAwBJ,SAASQ,GAA8BrE,GACrC,IAAI/8B,EAAM0iB,GAAeqa;AACzB,GAAIj9B,EAAe,gBAAgB66B,QAAS,CAC1C,IAAI0G,EAAUrhC,EAAIib,iBAAiB;AACnCuJ,MAAMC,UAAUjI,QAAQkI,KAAK2c,EAASR,KAtBxCnB,GAAuB,IACFh5B,KAAK,yBACF4P,GAAa1M,MAAM,KACzB4S,QAAQ,SAASvH,GACjCyqB,GAAqBh5B,KAAK,gGAEFuO,EAAK,0BAE/B0qB,GAAgC,EAC5B7/B,EAAe,iBAAiB66B,QAClC+E,GAAqBljB,QAAQ,SAASvH,GACpC2I,GAAU3I,GAAIuN,KAAK0e,MAGrBN,KAcJ,SAASU,KAEP,IADA,IAAI9D,EAAY19B,EAAe,aACtBmH,EAAIu2B,EAAU9K,KAAK3sB,OAAY,EAAJkB,EAAOA,GAAK,EAC9Cu2B,EAAU+D,UAAUt6B,EAAI;AAE1BnH,EAAe,aAAaulB,UAAY,GAExCga,GAAeha,UAAY,QAC3Bga,GAAex1B,MAAMwsB,MAAQ,QAC7Bv2B,EAAe,oBAAoBulB,UAAY,GAC/CvlB,EAAe,oBAAoBulB,UAAY,EAGjD,SAASmc,GAAaC,GAChBnoB,OACJgmB,GAAgBxW,KAChBhpB,EAAe,aAAaulB,UAAYqY,IACxC2B,GAAiBv/B,EAAe,mBACjBulB,UAAY,qBAAuBoc,EAAU,OAC5DpC,GAAex1B,MAAMwsB,MAAQ,QAC7BmJ,GACE1/B,EAAe,YAAY66B,QAC7B76B,EAAe,oBAAoBulB,UAAY,EAC/CsH,GAAgB,GAEhB9I,GAAS,eADTvN,GAAexW,EAAe,gBAAgBoB,OAG9C0c,GAAU,iDACP4E,KAAK4e,KAGV,SAASM,KAEP,IADA,IAAIC,EAAen9B,SAAS0U,EAAE,iBAAiBkR,MAAO,IAC7CnjB,EAAI,EAAGA,EAAI+f,GAASjhB,OAAQkB,GAAK,EACxC,GAAI06B,IAAiB3a,GAAS/f,GAAGlH,GAAI,CACnC29B,GAAgB1W,GAAS/f,GAAGk0B,MAC5BoE,GAAuBvY,GAAS/f,GAAG0Z;AACnC,MAGJ6gB,GAAa,qBAGf,SAASI,KACP,IAAIrrB,EAAkB2C,EAAE,oBAAoBkR,MAAMnnB,QAAQ,UAAW;AACrE4gB,GAAS,kBAAmBtN,GAC5BmnB,GAAgBnnB,EAChBgpB,GAAuB,EACvBiC,GAAa,sBAGR,SAASK,GAAgB/Z,GAC9B,IAAIR,EAAUQ,GAAYpE;AAC1B7gB,EAAK6mB,OAAS,OACd7mB,EAAK4mB,SAAU,EACfzC,GAAS2E,KAAKnB,IACdlU,GAAeO,EAAS,gBACxByQ,EAAQjC,UAAY+V,GAAWwE,GAAYtpB,IAC3CxW,EAAe,mBACZkJ,iBAAiB,QAAS04B,IAAgB,GAC7C5hC,EAAe,sBACZkJ,iBAAiB,QAASs4B,IAAuB,GAG/C,SAASQ,GAAgBha,GAC9B,IAAIR,EAAUQ,GAAYpE;AAC1BpN,GAAeO,EAAS,gBACxByQ,EAAQjC,UAAY+V,GAAWyE,GAAavpB,IAC5CxW,EAAe,mBACZkJ,iBAAiB,QAAS44B,IAAgB,GAC7C9hC,EAAe,sBACZkJ,iBAAiB,QAASs4B,IAAuB,GCzOtD,ICFI7U,GCbApc,GACA0xB,GACAC,GFaAC,GACF,s+BAsBEC,GAAiB,CACnBC,WAAY/Y,GACZgZ,aAAc7U,GACd8U,eAAgB9V,GAChB+V,iBAAkB5O,GAClB6O,cAAexH,GACfyH,aAAcX,GACdY,aAAcX,GACdY,iBAAkBzS,GAClB0S,kBAAmB7H,GACnB8H,gBAAiBnN,GACjBoN,aAAcpJ,GACdqJ,aAAcjb;AAYhB,SAAS8L,GAAahO,GACpB,GAAIA,EAAIrb,OAAOwQ,UAAU+Q,SAAS,WAEhC,OAXEkX,EAUiBpd,EAVErb,OAAO/I,YAC1B4G,EAAK+5B,GAAea,QACpB/kB,MAAmBlX,EAAWqB,KAChC9E,EAAU,aAAc0/B,GACxB/a,GAAa7f;AALjB,IACM46B,EACA56B;AAYAwd,EAAIrb,OAAOwQ,UAAU+Q,SAAS,YAChC9pB,OAAOg9B,mBAAmBpZ,EAAIrb,OAAOmhB,aAAa,kBAItD,SAASuX,KACP,IAAIC,EAAanjC,EAAe;AAChCmjC,EAAW94B,oBAAoB,aAAc64B;AAE7C,IAAIE,EAAgB7kB,GAAU,CAC5Bte,GAAI,gBACJ+lB,UAAW,gBACXjc,MAAO,CACL4b,gBAAiB,OAASjO,GACxB;AAGNhX,EAAoB0iC,EAAejB,IACnC9iB,GAAc8jB,EAAYC,GAC1BD,EAAWj6B,iBAAiB,QAAS,SAAS2c,GACtB,eAAlBA,EAAIrb,OAAOvK,IACJ4lB,EAAIrb,OAAOmoB,kBACjB3X,UAAUwd,OAAO,iBAExB4K,EAAcl6B,iBAAiB,QAAS2qB,IAoB3B,SAASwP,KAEtB,IAnBgBjrB,EACZ+qB,EAkBA/qB,EAAOpY,EAAe;AACtBoY,IApBYA,EAoBIA,EAnBhB+qB,EAAa5kB,GAAU,CACzBte,GAAI,aACJ+lB,UAAW,aACXT,UAAW,qBAETxO,EAAS,2BACXosB,EAAWnoB,UAAU5S,IAAI,YAE3B+6B,EAAWj6B,iBAAiB,aAAcg6B,IACtCnsB,EAAS,yBACXosB,EAAWnoB,UAAU5S,IAAI,WACzBkC,EAAU64B,IAEZ/qB,EAAK0C,WAAW2I,aAAa0f,EAAY/qB,IGjH5B,SAASkrB,GAAqBC,GAC3C,IAAIC,EAAUD,EAASz5B,MAAM;AAC7B,OAAOnE,KAAKyR,IAAI5V,OAAOgiC,EAAQ,IAAK3pB,GAAOhV,QAAQ2+B,EAAQ,IACzDhiC,OAAOgiC,EAAQ,IAAKhiC,OAAOgiC,EAAQ,IAAKhiC,OAAOgiC,EAAQ,IAAK,GCsChE,SAASC,GAAQ5d,GACf,IAdmBA,EAAK6d,EACpBC,EACAC,EAYAF,EA7BN,SAASG,EAAY1uB,GACnB,OANwBA,EAMHA,GALX6F,UAAU+Q,SAAS,cAC3B5W,EAAG6F,UAAU+Q,SAAS,oBAKf5W,EAELA,EAAG6F,UAAU+Q,SAAS,yBAA1B,EACO8X,EAAY1uB,EAAG2F;AAVxB,IAA0B3F,EAkCT0uB,CAAYhe,EAAIrb;AAC3Bk5B,IAfe7d,EAeQA,EAdvB8d,GADoBD,EAeQA,GAdR7b,mBACpB+b,EAAyBF,EARhB1oB,UAAU+Q,SAAS,oBACvB,oBAEF,aAMF3S,EAAEuqB,GAAUl8B,KAAK,QAIY,MAAvBoe,EAAIrb,OAAOub,SACpB3M,EAAEuqB,GAAUzT,OAAOzoB,KAAK,QAAQ,IAJhCoe,EAAIpc,iBACJ2P,EAAEwqB,GAAW1T,OAAOzoB,KAAK,QAAQ,GACjC2R,EAAEuqB,GAAUG,OAAOr8B,KAAK,QAAQ,IAIlCoe,EAAIke,mBA0CS,SAASC,KACtB,IAlCIC,EAMAvtB,EACAwtB,EAaAC,EAcAC,EAAcjkC,SAASy+B,cACzB;AACGwF,IACLzgB,GAAmBygB,EAAa,gHAKhCzgB,GAFAygB,EAAcjkC,SAASy+B,cACrB,oDAC8B,uGA1C5BqF,EAAU9jC,SAASskB,uBAAuB,oBAC1CjL,MAAyC,IAAnByqB,EAAQh+B,QAClCg+B,EAAQ,GAAG/6B,iBAAiB,QAASu6B,IAAS,GAI1C/sB,EAAkBK,EAAS,mBAC3BmtB,EAAUtgB,GAAIa,uBAAuB,oBACzCC,MAAMC,UAAUjI,QAAQkI,KAAKsf,EAAS,SAASG,GAC7C,GAAqC,eAAjCA,EAAK3e,SAAS,GAAGjkB,YAA8B,CACjD,IAAI6iC,EAAUhB,GAAqBe,EAAK3e,SAAS,GAAGjkB;AACtCiV,EAAV4tB,IACFvgB,GAAS,kBAAmBugB,GAC5B5tB,EAAkB4tB,MAOpBH,EAAOhkC,SAASgb,iBAClB,iEACFuJ,MAAMC,UAAUjI,QAAQkI,KAAKuf,EAAM,SAASrT,GAC1C,IAAIyT,EAASC,mBAAmB1T,EAAInF,aAAa,aAC7C8Y,EAASxlB,GAAa,CACxB7D,KAAMb,GAAW,yBAA2BgqB,EAC5C/5B,OAAQ;AAEVsmB,EAAIhW,WAAW2I,aAAaghB,EAAQ3T,GACpCzR,GAAcolB,EAAQ3T,MC1E1B,SAAS4T,GAAavvB,GACpB,IAA6D,IAAzDA,EAAG1T,YAAYoD,QAAQ,6BAA3B,CACA,IAAI8/B,EAAgB;AACpB,GAAK5tB,EAAS,4BAMZ4tB,EAAgB,2LADS5tB,EAAS,sBAIS;KAR3C4tB,EAAgB;AAUlBhhB,GAAmBxO,EAAI,4BAA8BwvB,EAAgB,UAGxD,SAASC,KACtB,IAAIjX,EAAW3tB,EAAe,OAAOipB,qBAAqB;AAC1DvE,MAAMC,UAAUjI,QAAQkI,KAAK+I,EAAU+W,ICvB1B,SAASG,GAAmBthB,EAASC,GAClD,GAAIA,aAAyBjE,MACzBiE,EAAc1I,sBAAsByE,KACtC,OAAOiE,EAAc1I,WAAW2I,aAAaF,EAC3CC,EAAcshB,aL0BpB,SAASC,GAAiB1kC,EAAQk5B,GAChCsL,GAAmBtL,EAAUl5B,GAG/B,SAAS2kC,GAAkBx6B,EAAQnC,EAAIkxB,GACrC,IAAI0L,EAAMjlC,EAAewK;AACrBy6B,aAAe1lB,KAEjBlX,EADa48B,EAAInqB,WACNye,GACL51B,EAAc,IAAM6G,EAAS,kBAAkB,GAGzD,SAAS06B,GAAaC,EAAQhkC,EAAMkH,EAAImC,GACtC,IAAI46B,EAAKtmB,GAAS,CAACkH,UAAW,aAAemf,IACzCE,EAAKpmB,GAAa,CACpB+G,UAAW,oBACXvkB,YAAaN;AAEfkkC,EAAGn8B,iBAAiB,QAAS,WAC3B3F,EAAU,YAAapC,GACvB+mB,GAAa7f,KAEfgX,GAAc+lB,EAAIC,GAClBL,GAAkBx6B,EAAQu6B,GAAkBK,GAiE9C,SAASE,GAAgBC,EAAQC,GAvBjC,IAA2BD,EAAQC;AAwB7B9gB,MAAMiW,QAAQ6K,EAAMC,UAxBCF,EAyBLA,GAzBaC,EAyBLA,GAvBtBC,QAAU,CACd,KACA,KAGY,GADZzlC,EAAe,iBAAiB6nB,mBAAmBnC,SAChDzf,OACH,IAEyD,GAAzD9F,SAASgb,iBAAiB,sBAAsBlV,OAChD,IACA,IACA,IACA,MAEkB,OAAhBu/B,EAAME,QAAmC,IAAjBF,EAAME,QAEhCH,EAAO7f,SAAS8f,EAAME,OAAOhgB,SAAS,GAAG3b,MAAM47B,OAC7CH,EAAMC,QAAQD,EAAME,OAAS,OAQ/B/hC,EAAc,iDAAqD,GAYvE,SAASiiC,GAAUL,GACjB,IATqBA,EAAQC,EASzBA,EAAQpsB,EAAEmsB,GAAQ99B,KAAK;AACvB8R,GAASisB,IAVQD,EAWLA,EAVZ,YADyBC,EAWLA,GATtBF,GAAgBC,EAAQC,GAExB7hC,EAAc,gDAAoD,IASlEA,EAAc,0CAA8C,GAcjD,SAASkiC,KAnIxB,IACM56B,EA0HAs6B;AASCvlC,EAAe,SAAUwZ,OAC9BmT,GAAUe,KAnIuB,GAD7BziB,EAAsB8L,EAAS,wBACX9Q,QACtBjG,EAAe,2BACZqmB,aAAa,OAAQpb,GAoI1Bi6B,GAAa,IAAK,iBAAkBtR,GAAqB,qBACzDoR,GAAkB,oBAAqBrhB,GACrC,+SAvGE5M,EAAS,gBACXmuB,GAAa,IAAK,WAAY5b,GAAe,qBAK3CvS,EAAS,aACXmuB,GAAa,IAAK,cAAezX,GAC/B,yBAKA1W,EAAS,mBACXmuB,GAAa,IAAK,gBAAiBzY,GACjC,yBAiGJyY,GAAa,IAAK,cAAejK,GAC/B,yBAnFEtO,IACFqY,GAAkB,iCAAkCrhB,GAClD,+JAZAgJ,KAAY5V,EAAS,mBAEvBiuB,GAAkB,4BAA6BrhB,GAC7C,8DACoBtJ,GAAiB,4BA8FzC2qB,GAAkB,6BAA8BrhB,GAC9C,yIAIFuhB,GAAa,IAAK,kBAAmBlK,GACnC,kCACFkK,GAAa,IAAK,iBAAkB/U,GAClC,sCACF+U,GAAa,IAAK,aAAclD,GAC9B,sCACFkD,GAAa,IAAK,aAAcnD,GAC9B,uCA1CEwD,EAASvlC,EAAe,kBACNQ,QACpBolC,GAAUL,GAEV5hC,EAAc,0BAA0B,IC1I5C,SAASmiC,KACP,IAAIC,EAAe3sB,EAAE,kCAAkCjY;AACvDiY,EAAE,sBAAsByf;AAMxB,IAHA,IAAIt4B,EAAO,kLAGFyF,EAAI,EAAGA,EAAIi8B,GAAYh8B,OAAQD,GAAK,EAC3CzF,GAAQ,iCACN0hC,GAAYj8B,GAAG7C,QAAQ,kBAAmB4iC,GAAgB;AAE9DxlC,GAAQ,cACR6Y,EAAE,QAAQmV,OAAOhuB,GAGjB6Y,EAAE,mBAAmB4sB,QAAQ,yEAE7B5sB,EAAE,gBAAgBmV,OAAO,0IAGzBnV,EAAE,UAAW,gBAAgBsN,SAC7BtN,EAAE,eAAe4lB,MAAM,SAASnZ,GAC9Boc,GAAYrN,OAAOxb,EAAE,mBAClByW,MAAMhK,EAAIrb,OAAOsQ,YAAa,GACjC8e,GAAa,WAAYqI,IACzB7oB,EAAE,sBAAsB+C,OAAO,SAC/B2pB,OAEF1sB,EAAE,eAAe4lB,MAAM,WACO,KAAxB5lB,EAAE,YAAYkR,QAClB2X,GAAYr7B,KAAKwS,EAAE,YAAYkR,OAC/BsP,GAAa,WAAYqI,IACzB7oB,EAAE,sBAAsB+C,OAAO,SAC/B2pB,QAIF1sB,EAAE,gBAAgB6sB,WAAW,CAC3B9S,OAAQ,uBACR+S,KAAM,WACsC,EAAtC9sB,EAAE,2BAA2BnT,QACA,IAA7BmT,EAAE,gBAAgBnT,SACtBmT,EAAE,uBAAuBkR,IAAIlR,EAAE,uBAAuBkR,MACpDlR,EAAE,6BAA6BjY,OAAS,MAC1CiY,EAAE,sBAAsB+C,OAAO,aAKnC/C,EAAE,sBAAsB+C,OAAO,CAC7B8D,QAAS,CACPkmB,OAAQ,WACN/sB,EAAE,eAAeof,SACjBpf,EAAE,eAAeof,UAEnB4N,OAAQ,WACNhtB,EAAE,sBAAsB+C,OAAO,SAC/B/C,EAAE,sBAAsByf,aAMhC,SAASwN,GAASxgB,GACC,UAAbA,EAAIygB,MAAqBzgB,EAAI0gB,WAC/B1gB,EAAIpc,iBACJy4B,MAWJ,SAASjD,GAAmBl+B,EAAMuI,EAAKk9B,GACrC,IAAKvE,GAAa,CAChBA,GAAc5qB,GAAa;AAC3B,IAAI4I,EAAU7G,EAAE,uBAAuB+C,OAAO,SAAU;AACxD+lB,GAAcjiB,EAAQ,gBACtBA,EAAQwmB,SAAWX,GACnB1sB,EAAE,uBAAuB+C,OAAO,SAAU,UAAW8D,GAEvD7G,EAAE,kCAAkC7Y,KAAKQ,GACzCqY,EAAE,gCAAgCkR,IAAIvpB,GACtCqY,EAAE,uBAAuBkR,IAAIzjB,EAASyC,EAAK,KAC3C8P,EAAE,uBAAuBstB,WAAW,YAjBhCn2B,IACFvQ,EAAe,sBACZkJ,iBAAiB,WAAYm9B,IAiBlCjtB,EAAE,iBAAiBjY,KAAK0F,EAAS2/B,EAAK,KACtCptB,EAAE,uBAAuB+C,OAAO,QAGnB,SAASwqB,KAClBntB,OACJjJ,GAAsBwG,EAAS,uBAC/B9U,OAAOg9B,mBAAqBA,IKxF9B,SAAS2H,GAAeC,EAAgBC,GACtC,IAPuBD,EACnBE,EAMAC,EAAcF,EAAUjf,mBAAmBnC,SAAS;AACpB,IAAhCshB,EAAYthB,SAASzf,SAXzBoZ,GAYewnB,EAjBCtoB,GAAU,CACxByH,UAAW,aACXmM,QAAS,CAACC,OAAQ,UAClB3wB,YAAa,WAcgBulC,EAlBJthB,SAAS,GAAGjkB,eAShBolC,EAULA,EATdE,EAS8BC,EATFthB,SAAS,GAAGH,UACxBshB,EAAenhB,SAAS,GAC9BH,UAAY,WAAawhB,EAQrCzO,GAAYwO,EAAUhsB,YAAY,IASvB,SAASmsB,KACtB,IANsBJ,EAAgBC,EAClCI,EAKAL,EAAiB7mC,EAAe,mBAChCmnC,EAAShnC,SAASgb,iBAAiB,WACnC2rB,EAAYpiB,MAAMC,UAAUmD,KAAKlD,KAAKuiB,EAAQ,SAAShyB,GACzD,MAA0B,eAAnBA,EAAG1T;AAT0BqlC,EAWHA,EAV/BI,GADkBL,EAWHA,GAVS7rB,UAAU+Q,SAAS,0BACxC8a,IAAmBK,GAAUJ,GAUlCF,GAAeC,EAAgBC,GCpCnC,IAAIM,GACF,sHAEEC,GACF,oLAIoC3vB,GACpC,yIAEoCA,GACpC,mJAEoCA,GACpC,2IAEoCA,GACpC;AAKF,SAAS4vB,KACPtnC,EAAe,oBAAoBunC,UAAYH,GAC/CrjB,GAAS,cAAc,GACvBA,GAAS,mBAAmB,IAAIpe,MAC7B6hC,YAAY,GAAI,GAAI,GAAI,KAAO,GAGpC,SAASC,GAAW5nC,GAClB,IAAI6nC,EAAQ7nC,EAAE2K,OAAOmhB,aAAa;AAC7B+b,IACL1nC,EAAe,oBAAoBqK,oBAAoB,QACrDo9B,IACF3pB,GAAU,qDAAuD4pB,GAC9DhlB,KAAK4kB,IACRluB,EAAEvZ,EAAE2K,QAAQm9B,KAAK,SAGJ,SAASC,KACtBlkB,GAAqB1jB,EAAe,iBAAkBqnC,IACtDrnC,EAAe,oBAAoBkJ,iBAAiB,QAClDu+B,ICxBG,SAASI,GAAgB5K,GAnBhC,IAA4BA,EAStBhqB;AAWAlQ,EAAKmO,oBApBiB+rB,EAoBsBA,EAX5ChqB,GAAa,GANA,WAAblQ,EAAKyf,IACDI,GAAeqa,GAEf98B,UAEcy+B,cAAc,oCAGlCgJ,KACA30B,GAAa,GAEf8Q,GAAS,aAAc9Q,GACvB8Q,GAAS,mBAAmB,IAAIpe,MAC7B6hC,YAAY,GAAI,GAAI,GAAI,KAAO,ICTpC,SAASM,KAJT,IAAyBC;EAAAA,EAKHhxB,EAAS,qBAJUgxB,EAAN9mC,GAK/B6c,GAAU,oCAAoC4E,KAAKmlB,IAC1C9wB,EAAS,eAClB6wB,KAIW,SAASI,KAEL,WAAbjlC,EAAKyf,KAAoBhJ,MAC7BsuB,KCrBF,IAAIG,GACJ;AAIe,SAASC,MACgC,IAAlDllC,SAASE,OAAO2B,QAAQ,sBAC1B6e,GAAqB1jB,EAAe,iBAAkBioC,ICe3C,SAASE,GAAkB1gC,GACxC,GAAK1E,EAAKoO,mBAAV,CACA,IAtBe1J,EAQKu0B,EAChBoM,EAcAC,GAvBW5gC,EAsBGA,GArBoC,IAAlDzE,SAASE,OAAO2B,QAAQ,qBACnB+d,GAAenb,IAExBtH,SAASgb,iBAAiB,+BAA+B,GAAG/Z,MAAQ,KAC7DjB,WAkBUgb,iBAAiB;AAClC,GAAoB,EAAhBktB,EAAOpiC,OAAY,CACrB,IAAI+1B,EAAQqM,EAAOA,EAAOpiC,OAAS,GAAG2sB,KAAK,GAAGC,MAAM,IAhBlDuV,GADgBpM,EAkBLA,GAjBcv6B,YAAYqI,MAAM,QAC1B,KAAOs+B,EAAiB,IAC3CF,KACAnkB,GAAS,mBAAmB,KAE5BA,GAAS,mBAAmB,GAC5BA,GAAS,mBACPpe,KAAKuR,MAAM8kB,EAAMnU,mBAAmBpmB,YAAc,YCLxD,SAAS6mC,KART,IACMx0B;AAQAiD,EAAS,mBACXmxB,MATEp0B,EAAmBiD,EAAS,sBACR9V,GAAM6S,GAC9BgK,GAAU,2CAA2C4E,KAAK,SAASjb,GACjEW,EAAI,EAAG+/B,GAAmB,CAAC1gC,MAYhB,SAAS8gC,KAClBrqB,OAAqE,IAAlDlb,SAASE,OAAO2B,QAAQ,sBAC7CyjC,KC1BW,SAASE,GAAwB1tB,EAAYyI,GACtDzI,aAAsBta,SACxBsa,EAAW2I,aAAaF,EAASzI,EAAWyY,YCFhD,SAASkV,GAAOC,EAAWC,EAASh/B,GAClC,OAAOtI,KAAK8Y,MAAM9Y,KAAKyf,IAAI4nB,EAAYC,EAAS,GAAK,EAAIh/B,GAG3D,SAASi/B,GAAQrwB,EAAKmH,EAAOmpB,EAAGC,EAAIC,GAClC,IAAIC,EAAIF;AACG,MAAPA,IAAaE,EAAI;AACrB,IAAI9+B,EAAMu+B,GAAOxmC,OAAOgnC,OAAOC,YAAaF,EAAG/mC,OAAOknC,SAClDn/B,EAAOy+B,GAAOtoC,SAASipC,gBAAgBC,YAAaR,EAAG5mC,OAAOqnC;AAClErnC,OAAOsnC,KAAKhxB,EAAKmH,EAAO,SAAWmpB,EAAI,YAAcG,EAAI,UAAYh/B,EACnE,SAAWE,EAAM6+B,GAGN,SAASS,KACtBvnC,OAAOwnC,WAAab,GCZP,SAASc,KACtB,IAAIlwB,KAAJ,CACA,IAAIgsB,EAAQpsB,EAAE,QAAQ3R,KAAK;AAC3B,GAAK+9B,EAAL,CACA,IAAImE,EAAUnE,EAAMoE;AACpBpE,EAAMoE,WAAa,SAASC,GAC1B,IAAI5pC,EAAK4pC;AAEQ,IADFzwB,EAAE,iBAAkB,QAAQ+V,GAAGlvB,GAAI6nB,KAAK,MAAM6d,WACxC1lC,GAAM,GAC3B0pC,EAAQ/kB,KAAK4gB,EAAOvlC,MCXT,SAAS6pC,GAAa1oC,EAAO2oC,GAC1C,OAAc,IAAV3oC,EAAqB,GAClBA,EAAMwD,WAAamlC,ECCb,SAASC,GAAmB1N,GACzC,IAAIlI,EAAI/yB,KAAK4oC,IAAI/vB,GAAUoiB,GACvBxF,EAAIz1B,KAAK8Y,MAAMia,EAAI;AACvBA,GAAK;AACL,IAAI4U,EAAI3nC,KAAK8Y,MAAM2c,EAAI;AACvBA,GAAK;AACL,IAAIoT,EAAI7oC,KAAK8Y,MAAM6uB,EAAI;AAEvB,OADAA,GAAK,GACEc,GAAaI,EAAG,WAAaJ,GAAad,EAAG,YAClDc,GAAahT,EAAG,WAAa1C,EAAI,QCVtB,SAAS+V,GAAWC,GACjC,OAAOtsB,GAAU,CACfvF,IAAK,YACL9Q,KAAM,CACJ+a,IAAK,SACLC,OAAQ,UACR4nB,gBAAiBD,GAEnBnsB,SAAU,SCHd,SAASqsB,GAAsB7iC,GAC7B8Y,GAAU,kBAAmB9Y,GAG/B,SAAS8iC,GAAkB9iC,GAEzB,OADAA,EAAK2a,WAAanhB,GACXwG,EAGT,SAAS+iC,KACP,OAAOL,GAAWnhB,MACf3L,KAAKktB,IACL7nB,KAAK4nB,IAGV,SAASG,GAAqBhjC,GAC5B,OAAKA,GAAQA,EAAK2a,WAAanhB,GAC7B8B,EAAK6L,2BACE47B,KAEF/iC,EAGM,SAASijC,GAAQnS,GAC9B,OAAIA,EAAeiS,KAEZ7uB,GAAU,mBACd0B,KAAKotB,IClCK,SAASE,GAAoBC,GAC1C3oC,OAAOwnC,WAAW,6BAA+BmB,EAC/C,cAAe,IAAK,IAAM,eCY9B,IAAIC,GAAY,4CACZC,GAAY,sHAEZC,GAAa,iHAGbC,GAAe,CACjB,CACEzmC,UAAW,SAASsxB,GAAI,OAAOA,EAAI,KACnCoV,KAAM,gBACNC,MAAO,UAET,CACE3mC,UAAW,SAASsxB,GAAI,OAAOA,EAAI,KACnCoV,KAAM,gBACNC,MAAO,UAET,CACE3mC,UAAW,WAAY,OAAO,GAC9B0mC,KAAM,gBACNC,MAAO;AAmBX,SAASliB,GAAWsB,EAAKnmB,GACvB,MAAO,oCAXT,SAAsBm4B,EAAYn4B,GAChC,IAAK,IAAI6B,EAAI,EAAGA,EAAIglC,GAAa/kC,OAAQD,GAAK,EAAG,CAC/C,IAAIE,EAAO8kC,GAAahlC;AACxB,GAAIE,EAAK3B,UAAU2V,GAAUoiB,GAC3B,OATqBp2B,EASIA,EAAN/B,EARL+B,EAAK+kC,KAChB/kC,EAAKglC,MAFd,IAA2BhlC;AAYzB,MAAO,WAKLilC,CAAa7gB,EAAIgS,WAAYn4B,GAC7B,qBAAuBmmB,EAAI8f,SAAW,gDACd9f,EAAI/I,MAAQ,4CACbyoB,GAAmB1f,EAAIgS,YAC9C,qEACAhS,EAAIrqB,GAAK,KAAOqqB,EAAI8f,SAAW,OA4CnC,SAASgB,GAAWv3B,EAAa1P,GAC/B,IAAIusB,EAAS;AAab,OAZA7c,EAAY6I,QAAQ,SAAS4N,GAtB/B,IAAwBA,EAUDA;AAaY,KAA3BpQ,GAAUoQ,EAAIgS,aAClB5L,GAAU,8CACVA,GA7CG3tB,EAAK0O,iBAGH,GAFEo5B,GA6CPna,GAAU1H,GAAWsB,EAAKnmB,GAC1BusB,GAAU,4CACVA,GAzCG3tB,EAAK6K,qBAGH,GAFEk9B,GAyCPpa,GAnCG3tB,EAAK8K,kBAGH,GAFEk9B,GAmCPra,IA9BoBpG,EA8BKA,EA7BtBvnB,EAAK2K,yBAMH,GALE,+IAEqC4c,EAAI8f,SAC9C,qCA0BF1Z,IArBmBpG,EAqBKA,EApBrBvnB,EAAK4K,mBAMH,GALE,kHAEe2c,EAAI8f,SACxB,4CAiBF1Z,GAAU,iBAELA,EAGT,IAAI2a,GAAgB,CAClB,SAASC,EAAQC,GAAU,OAAOD,EAAOrlC,OAASslC,EAAQtlC,QAC1D,SAASqlC,EAAQC,GACf,IAAKxoC,EAAK2L,qBAAuB,OAAO68B,EAAQtlC,QAElD,SAASqlC,GACP,IAAKvoC,EAAK4L,sBAAwB,OAAO28B,EAAOrlC;AAqBpD,SAASulC,GAAoB/jC,GAC3B,IAlBgB6jC,EAAQC,EAkBpBD,EAASzkC,EAASY,EAAKgkC,QAAS,IAChCF,EAAU1kC,EAASY,EAAKikC,SAAU,KAnBtBJ,EAoBHA,EApBWC,EAoBHA,EAnBdF,GAAcnc,MAAM,SAASrvB,GAAI,OAA8B,IAAvBA,EAAEyrC,EAAQC,OAG3D,SAAmBD,EAAQC,GACzB,IAAI7a,EAAS;AACT3tB,EAAK2L,uBACPgiB,GAAU0a,GAAWE,GAAQ,IAE3BvoC,EAAK4L,wBACP+hB,GAAU0a,GAAWG,GAAS;AAEhC,IAAII,EAAiB3rC,EAAe;AACpC2rC,EAAepmB,UAAY,GAC3B7kB,EAAoBirC,EAAgBjb,GAOpCkb,CAAUN,EAAQC,GAOpB,SAASM,GAAmB/lB,GAC1BA,EAAK9K,UAAUwd,OAAO,uBACtB1S,EAAK9K,UAAUwd,OAAO,wBAwBxB,ICnLW9jB,GACAC,GACAm3B,GACPt8B,GACOI,GACPF,GACOq8B,GD6KPC,GAAW,CACb,CAAChmB,UAAW,sBAAuBimB,QAASJ,IAC5C,CAAC7lB,UAAW,uBAAwBimB,QAASJ,IAC7C,CAAC7lB,UAAW,qBAAsBimB,QAxBpC,SAAmBnmB,GACjB7jB,OAAOg9B,mBAAmBnZ,EAAKhL,WAAW2K,uBACvCsD,iBAAiBtnB,eAuBpB,CAACukB,UAAW,kBAAmBimB,QApBjC,SAAoBnmB,GAClB6kB,GAAoB7kB,EAAKhL,WACtB2K,uBAAuBsD,iBAAiBtnB,eAmB3C,CAACukB,UAAW,mBAAoBimB,QAhBlC,WACE,IAAIC,EAAYlsC,EAAe,kBAC5BykB,uBAAuB;AAM1BkmB,GALiBjmB,MAAMC,UAAUsH,OAAOrH,KAAKsnB,EAC3C,SAAShgB,EAAMC,GAEb,OADAD,EAAKtlB,KAAKulB,EAAKtE,mBAAmBpmB,aAC3ByqB,GACN,IAC0BoL;AAWjC,SAASzD,GAAahO,GACpB,IAAIC,EAAOD,EAAIrb;AACC,kBAAZsb,EAAK7lB,GAIT+rC,GAAS/pB,KAAK,SAAS/b,GACrB,QAAI4f,EAAK9K,UAAU+Q,SAAS7lB,EAAK8f,aAC/B9f,EAAK+lC,QAAQnmB,IACN,KA9CX4kB,IAAQ,GAAMhoB,KAAK8oB,IAoDrB,SAASW,GAAQ1kC,GACf,IAAI2kC,EAAe7tB,GAAU,CAC3Bte,GAAI,eACJ+lB,UAAW,YAETqmB,EAAU;AAGTtpC,EAAK0O,mBACR46B,GAAW,yDAGb3rC,EAAoB0rC,EADpBC,GAAW,gBAEX7D,GAAwB3kB,GAAKuoB,GAC7BA,EAAaljC,iBAAiB,QAAS2qB,IACvC2X,GAAoB/jC,GAGP,SAAS6kC,KAClB9yB,MACJkxB,IAAQ,GACLhoB,KAAK,SAASjb,GACbW,EAAI,EAAG+jC,GAAS,CAAC1kC,MCzNhB,ICVH8kC,GDUOC,GAAY;AAyBhB,SAASC,GAAoBvsC,GAClC,IAAIwsC,EAAc1sC,EAAe,cAAeE,GAAK4a,WAAWA,WAC7D2K,uBAAuBC,SAAS,GAAGA,SAAS,IAC/ChR,GAAa,IACFi4B,OAAS,GACpBj4B,GAAWk4B,aAAc,EACzBl4B,GAAW0N,WAAalI,GACpBwyB,GA9BN,SAA2BA,GACzB,IAAK,qBAAqBxmC,KAAKwmC,EAAY9Z,KAAK,GAAGC,MAAM,GAAGtN,WAC1D,IAAK,IAAIvf,EAAI,EAAGA,EAAI0mC,EAAY9Z,KAAK3sB,OAAS,EAAGD,GAAK,EAAG,CACvD,IAAI6mC,EAAWH,EAAY9Z,KAAK5sB,GAAG6sB,MAC/B0Z,EAAa;AACjBA,EAAW/hC,OAASqiC,EAAS,GAAGtZ,WAC7BA,WAAWA,WAAW9xB,YACzB8qC,EAAW1b,KAAOgc,EAAS,GAAGtZ,WAAWA,WAAWnY,KACpDmxB,EAAW1rB,IAAMgsB,EAAS,GAAGtZ,WAC1BA,WAAWuR,YAAYrjC,YACvB0B,QAAQ,KAAM,IAAIA,QAAQ,KAAM,IACnCopC,EAAWO,OAASD,EAAS,GAAGprC,YAChC8qC,EAAWQ,WAAaF,EAAS,GAC9BtZ,WAAWA,WAAWA,WAAWA,WACjCuR,YAAYvR,WAAW7T,MAC1B6sB,EAAWS,OAASH,EAAS,GAAGprC,YAChC8qC,EAAWU,OAASJ,EAAS,GAAGprC,YAChC8qC,EAAWzQ,SAAW+Q,EAAS,GAAGprC,YAClCiT,GAAWi4B,OAAO/lC,KAAK2lC,IAYTW,CAAkBR,GACpCZ,IAAyB,EAa3B,SAASqB,KACP,OAVOz4B,IACLwF,GAAUxF,GAAW0N,WAAa5S,IAI7BmF,IACLuF,GAAUvF,GAAWyN,WAAa5S,GCzBtC,IC1BW49B,GACAC,GCCAC,GCAAC,GCEP7M,GACAC,GJqBA6M,GAAW,CACb,WAAY,OAAOzB,GAAY/pC,SAAS,MACxC,SAASwI,GAAS,OAAOuhC,GAAY/pC,SAASwI,IAC9C,SAASA,EAAQijC,GACf,OAAO1qC,EAAK4M,oBAC6B,UAAvC89B,EAAO5a,MAAM,GAAGpxB,YAAY4+B;AAIlC,SAASqN,GAAaljC,EAAQijC,GA5B9B,IAA2BA,EAPRE,EAAQC;AAoCkB,aAAvCH,EAAO5a,MAAM,GAAGpxB,YAAY4+B,QAC5BmN,GAASvrB,KAAK,SAAS9M,GAAK,OAAOA,EAAG3K,EAAQijC,OA9BzBA,EA+BLA,GA9BpBlB,GAAa,IACF/hC,OA6BCA,EA5BZ+hC,GAAW1b,KAAO4c,EAAO5a,MAAM,GAAGU,WAAWA,WAAWnY,KACxDmxB,GAAW1rB,IAAM4sB,EAAO5a,MAAM,GAAGU,WAAWA,WAAWuR,YACpDrjC,YAAY0B,QAAQ,KAAM,IAAIA,QAAQ,KAAM,IAC/CopC,GAAWsB,QAAUJ,EAAO5a,MAAM,GAAGU,WAAWA,WAAWA,WACxD9xB,YACH8qC,GAAWO,OAASW,EAAO5a,MAAM,GAAGpxB,YACpC8qC,GAAWQ,WAAaU,EAAO5a,MAAM,GAAGU,WAAWA,WAAWA,WAC3DA,WAAWuR,YAAYvR,WAAW7T,MACrC6sB,GAAWU,OAASQ,EAAO5a,MAAM,GAAGpxB,YACpC8qC,GAAWS,OAASS,EAAO5a,MAAM,GAAGpxB,YACpC8qC,GAAWuB,QAAUL,EAAO5a,MAAM,GAAGpxB,YACrC8qC,GAAWwB,QArBMJ,EAqBaF,EAAO5a,MAAM,GAAGpxB,YAAY4+B,OArBjCuN,EAsBvBH,EAAO5a,MAAM,GArBA,UAAX8a,EACKC,EAAKra,WAAWA,WAAW5H,aAAa,WAE1C,IAmBPhX,GAAWg4B,OAAO/lC,KAAK2lC,KCpBzB,SAASyB,KACP,OAAOzvB,GAAU,CAACyH,UAAW,YCOxB,SAASioB,KACdrU,GAAa,aAAcllB,IAE3B04B,GAAc7nB,UAAY;AAE1B,IAAI2oB,EAAU3vB,GAAU,CAAC9c,YAAa;AAEtC4d,GAAc6uB,EADdZ,GAAkB9uB,GAAW,CAACwH,UAAW,UAAWvkB,YAAa,WAEjE4d,GAAc+tB,GAAec;AAE7B,IAjBqB/4B,EAiBjBub,EAAS;AACb,GAAiC,IAA7Bhc,GAAWi4B,OAAO1mC,OACpByqB,GAAU;KAEV,IAAK,IAAI1qB,EAAI,EAAGA,EAAI0O,GAAWi4B,OAAO1mC,OAAQD,GAAK,EACjD0qB,GAAU,YAAchc,GAAWi4B,OAAO3mC,GAAG6qB,KAC3C,sCAtBC,YADc1b,EAwBDT,GAAWi4B,OAAO3mC,IAvBf6a,IACrB,eAAiB1L,EAAG23B,OAAS,IAAM33B,EAAG43B,WACtC,0BAA4B53B,EAAG83B,OAC/B,kBAAoB93B,EAAG2mB,UAoBmB,KACtCpnB,GAAWi4B,OAAO3mC,GAAGwE,OAAS;AAGpC9J,EAAoB0sC,GAAe1c,GCX9B,SAASyd,KACdvU,GAAa,aAAcjlB,IAE3B04B,GAAc9nB,UAAY;AAE1B,IAAI2oB,EAAU3vB,GAAU,CAAC9c,YAAa;AAEtC4d,GAAc6uB,EADdX,GAAkB/uB,GAAW,CAACwH,UAAW,UAAWvkB,YAAa,WAEjE4d,GAAcguB,GAAea;AAE7B,IA3BqB/4B,EASJw3B,EAkBbjc,EAAS;AACb,GAAiC,IAA7B/b,GAAWg4B,OAAO1mC,OACpByqB,GAAU;KAEV,IAAK,IAAI1qB,EAAI,EAAGA,EAAI2O,GAAWg4B,OAAO1mC,OAAQD,GAAK,EACjD0qB,KAvBaic,EAuBOh4B,GAAWg4B,OAAO3mC,IAtB/B+nC,OACF,kCAAoCpB,EAAOoB,OAChD,qBAEG,IAmBD,+CAhCC,mBADc54B,EAkCDR,GAAWg4B,OAAO3mC,IAjCR6a,IAC5B,gBAAkB1L,EAAG04B,QACrB,eAAiB14B,EAAG23B,OAAS,IAAM33B,EAAG43B,WACtC,0BAA4B53B,EAAG83B,OAC/B,eAAiB93B,EAAG63B,OACpB,sBAAwB73B,EAAG24B,SA6BvB,WAAan5B,GAAWg4B,OAAO3mC,GAAG6qB,KAAO,KACzClc,GAAWg4B,OAAO3mC,GAAGwE,OAAS;AAGpC9J,EAAoB2sC,GAAe3c,GCpCrC,SAAS0d,GAAoBluC,GAC3B,IAAIwC,EAAOxC,EAAI0+B,cAAc;AAC7B,GAAKl8B,EAAL,CACAg+B,GAAUl/B,OAAOkB,EAAKtB,OACtBu/B,GAAUn/B,OAAOkB,EAAKoY,WAAWyK,UAAU7jB,MAAM,iBAAiB;AAClE,IAAIgrC,EAAc1sC,EAAe,cAAeE,GAAK4a,WAAWA,WAC7D+M,mBAAmBnC,SAAS,GAAGA,SAAS;AACvCgnB,GJ4BS,SAAoBA,GACjC,IAAK,IAAI1mC,EAAI,EAAGA,EAAI0mC,EAAY9Z,KAAK3sB,OAAS,EAAGD,GAAK,EAAG,CACvD,IAAIynC,EAASf,EAAY9Z,KAAK5sB,GAC1BwE,EAASijC,EAAO5a,MAAM,GAAGU,WAC1BA,WAAWA,WAAW9xB;AACzB,GAAe,+BAAX+I,EAA0C;AAC9CkjC,GAAaljC,EAAQijC,IIlCLY,CAAW3B,IAUxB,SAAS4B,GAAwBzrB,GACtC,IAR2B3iB,EAQvBA,EAAM0iB,GAAeC;AARE3iB,EASPA,EARhB6C,EAAKwM,yBAA2Bu8B,KAClCW,GAAoBvsC,GACpB+tC,MAOElrC,EAAK0M,mBACP2+B,GAAoBluC,GAChBwgC,GAAUC,GACZ7iB,GAAU0uB,IAAa9L,GAAU,GAAG97B,YACjC8d,KAAK4rB,IAERH,MCVN,ICvBIjhC,GCMA+I,GFiBAs4B,GAAoB,CACtB,WAAY,OAAQ75B,IACpB,WAAY,OAAQC,IACpB,WAAY,OAAO/E;AASrB,SAAS4+B,GAAmBC,EAAkBh/B,GAvB9C,IAAsBF;AN+CpBmF,GAAa2C,GAAa,cAC1B1C,GAAa0C,GAAa,cAC1B7H,GAAwBuH,EAAS,0BACjCnH,GAAiBmH,EAAS,oBAEtBo2B,OACFv9B,IAAiB,GMnCZ2+B,GAAkBtsB,KAAK,SAAS9M,GACrC,OAAOA,QNuCTR,GAAa,IACFg4B,OAAS,GACpBh4B,GAAWi4B,aAAc,EACzBj4B,GAAWyN,WAAalI,GACxB4xB,IAAyB,EACzBp8B,GAAcqH,EAAS,eACvBg1B,GAAcr8B,GAAY5F,MAAM,WAChCia,GAAS,kBAAkB,GMtCzBjG,GAAU0uB,GAAY,KAAK9pB,KAAK4rB,MA3Bd/+B,EA6BLk/B,EAAkBh/B,IA3B/BkF,GAAWi4B,aAAc,EACzBuB,MAEE5+B,IACFmF,GAAWk4B,aAAc,EACzBqB,OA0BJ,SAASS,GAAU7uC,GACbA,EAAE2K,SAAW8iC,KACf1T,GAAa,aAAc,MAC3B4U,GAAmBzrC,EAAKwM,uBAAwBxM,EAAK0M,mBAEnD5P,EAAE2K,SAAW+iC,KACf3T,GAAa,aAAc,MAC3B4U,GAAmBzrC,EAAKwM,uBAAwBxM,EAAK0M,mBASlD,SAASk/B,KACVn1B,OJtDAzW,EAAK0M,mBACP49B,GAAgBW,KAChBxF,GAAwB3kB,GAAKwpB,KAE3BtqC,EAAKwM,yBACP69B,GAAgBY,KAChBxF,GAAwB3kB,GAAKupB,KI2C3BA,IAAgBA,GAAclkC,iBAAiB,QAASwlC,IACxDrB,IAAgBA,GAAcnkC,iBAAiB,QAASwlC,IAO5DF,GAAmBzrC,EAAKwM,uBAAwBxM,EAAK0M,mBGnExC,SAASm/B,GAAQC,GAC9B,IACIrqC,EACAsqC,EAAU9uC,EAAe,WAFnB4iB,GAAeisB;AAGzB,GAAIC,EAAS,CACX,IAAIC,EAAYD,EAAQvpB;AACxB/gB,EAAS,GACLuqC,IAEFvqC,EADAuqC,EAAYA,EAAU5rC,QAAQ,QAAS,KAI3C,OAAOqB,EFRF,SAASwqC,KACT9hC,IACL4Q,GAAU,CACRvF,IAAK,YACL9Q,KAAM,CACJwnC,UAAW,EACXzsB,IAAK,QACLC,OAAQ,WACRysB,GAAIjtC,OAAOktC,OACXC,gBAAiBh2B,EAAE,iBAAiB7Y,OACpC8uC,YAAaj2B,EAAE,kBAAkB7Y,OAAO4C,QAAQ,SAAU,OAE3Duf,KAAK,SAASjb,GACf,IAAI6nC,EAAOV,GAAQnnC;AACN,gCAAT6nC,GAAmD,KAATA,IAC5CvrB,GAAS,uBACPrf,SAASqS,EAAS,wBAAyB,IAC3CrS,SAASqS,EAAS,cAAe,KACnCw4B,SAASC,MAAM,MAuCd,SAASC,GAAsBhoC,GAZtC,IAAyBA;AAanBA,EAAK4mB,QAAUnhB,KAbIzF,EAcLA,EAblB2R,EAAE,oBACC7Y,KAAKwW,EAAS,wBACZnS,WACAzB,QAAQ,2BAA4B,QACrCuB,SAAS+C,EAAK4mB,OAAOqhB,KAAM,IAAM34B,EAAS,cAC5CqC,EAAE,iBAAiBu2B,IAAI,mBAAoB,OAE3Cv2B,EAAE,iBAAiBu2B,IAAI,mBAAoB,YG1ChC,SAASC,GAAUC,EAAO3vC,GACvC,IAZkB2vC,EALD3vC,EAiBb4vC,EAXuB,KADTD,EAYMA,GAXdhrC,QAAQ,KACT,IAAMgrC,EAMRA,EAKHE,EAAQ,GAMRC,EAAOnpC,EAAS3G,EAAKC,UAErB8vC,IA1Ba/vC,EAyBE8vC,aAxBAE,aAAsBhwC,EAClCC,UAwBYgwC,SAASL,EAAQE,EAAM,KACxCI,YAAYC,6BAA8B;AAC5C,GAA6B,IAAzBJ,EAAMK,eAAuB,OAAO;AACxC,IAAK,IAAItqC,EAAI,EAAGA,EAAIiqC,EAAMK,eAAgBtqC,GAAK,EAC7C+pC,EAAMnpC,KAAKqpC,EAAMM,aAAavqC;AAEhC,OAAO+pC,EChCM,SAASS,GAASX,EAAO3vC,GACtC,IAAI6vC,EAAQH,GAAUC,EAAO3vC;AAC7B,OAAK6vC,EACEA,EAAM,GADO,KHStB,SAASU,GAASC,GAChB,IAAIC,EAAYH,GAAS,mBAAqBE,EAAM;AACpD,GAAKC,EAAL,CACA,IAAIp4B,EAAMo4B,EAAUhlB,aAAa;AACjCpT,EAAMA,EAAIpV,QAAQ,WAAY,IAAIA,QAAQ,OAAQ,IAClDH,SAASoY,KAAO7C,GA6ClB,SAASq4B,KACH36B,IAAuB7R,aAAaC,QAAQ,oBAAqB,KACrErB,SAASoY,KAAO,oBAmClB,SAASy1B,GAAaC,GACpBhzB,GAAU,qCAAqC4E,KAAK,SAASjb,GAhF/D,IAAuCqpC,EAOjCC;AAPiCD,EAiFbA,EA1EpBC,EANMnuB,GAgFQnb,GA9EEm3B,cAClB,mDAGuB3V,qBAAqB,UAC1C6nB,GAAaC,EAAS9qC,QAG1B6X,GAAU,CACRvF,IAAK,YACL9Q,KAAM,CACJwnC,UAAW,EACXzsB,IAAK,UACLC,OAAQ,kBACRuuB,YARWD,EAASD,GAAW1vC,MAS/B6vC,OAAQ,OAEVC,QAAS,WACHj7B,IACF7R,aAAaC,QAAQ,oBAAqB,KAE5CrB,SAASoY,KAAO,6BA6DtB,IAAI+1B,GAAU,CACZC,GAAM,CAAC/oC,GAAIwoC,GAAcQ,IAAK,GAC9BC,GAAM,CAACjpC,GAAIwoC,GAAcQ,IAAK,GAC9BE,GAAM,CAAClpC,GAAIwoC,GAAcQ,IAAK,GAC9BG,GAAM,CAACnpC,GAAIwoC,GAAcQ,IAAK,GAC9BI,GAAM,CAACppC,GAAIwoC,GAAcQ,IAAK,GAC9BK,GAAM,CAACrpC,GAAIwoC,GAAcQ,IAAK,GAC9BM,GAAM,CAACtpC,GAAIwoC,GAAcQ,IAAK,GAC9BO,GAAM,CAACvpC,GAAIwoC,GAAcQ,IAAK,GAC9BQ,GAAM,CAACxpC,GAAIwoC,GAAcQ,IAAK,GAC9BS,GAAM,CAACzpC,GAAIwoC,GAAcQ,IAAK,GAC9BU,GAAM,CAAC1pC,GAAIooC,GAAUY,IAAK,KAC1BW,GAAM,CAAC3pC,GAAIooC,GAAUY,IAAK,KAC1BY,GAAM,CAAC5pC,GA9DT,WACM4N,IAAuB7R,aAAaC,QAAQ,oBAAqB,KACrErB,SAASoY,KACP,iEA4DF82B,GAAM,CAAC7pC,GAAIuoC,IACXuB,GAAM,CAAC9pC,GAtCT,WACM4N,IAAuB7R,aAAaC,QAAQ,oBAAqB,KACrErB,SAASoY,KAAO,2CAqChBg3B,IAAO,CAAC/pC,GAtDV,WACM4N,IAAuB7R,aAAaC,QAAQ,oBAAqB,KACrErB,SAASoY,KAAO,sCAqDhBi3B,IAAO,CAAChqC,GAlDV,WACM4N,IAAuB7R,aAAaC,QAAQ,oBAAqB,KAChE0S,EAAS,4BAGZ/T,SAASoY,KACP,mEAHFpY,SAASoY,KAAO,sDAgDlBk3B,IAAO,CAACjqC,GAAIuoC,IACZ2B,IAAO,CAAClqC,GA9BV,WACM4N,IAAuB7R,aAAaC,QAAQ,oBAAqB,KACrErB,SAASoY,KAAO,0BA6BhBo3B,IAAO,CAACnqC,GA5EV,WAEOrI,EAAe,eAClBgD,SAASoY,KAAO,2DA0ElBq3B,IAAO,CAACpqC,GAvCV,WACQ,mBAAoBtF,IAASA,EAAK2vC,mBACtCnvC,EAAU,aAAc,mBACxB2kB,GAAayR,OAqCfgZ,IAAO,CAACtqC,GAAI2mC,IACZ4D,IAAO,CAACvqC,GAAIwoC,GAAcQ,IAAK;AASjC,IInIWwB,GACPC,GACAC,GJiIAC,GAAU,CACZ,SAASntB,GACP,MAA8B,SAAvBA,EAAIrb,OAAOub,SAA6C,SAAvBF,EAAIrb,OAAOub,SAIrD,SAASF,GAAM,OAAOA,EAAIotB,SAC1B,SAASptB,GAAM,OAAOA,EAAIqtB,SAC1B,SAASrtB,GAAM,OAAOA,EAAIstB;AAG5B,SAASC,GAASvtB,GAChB,IAAK,IAAI7f,EAAI,EAAGA,EAAIgtC,GAAQ/sC,OAAQD,GAAK,EACvC,GAAIgtC,GAAQhtC,GAAG6f,GAAO;AAnB1B,IAAmB1D,GAAAA,EAqBP0D,EAAIwtB,YApBLlC,IACPA,GAAQhvB,GAAG9Z,GAAG8oC,GAAQhvB,GAAGkvB,KAsBd,SAASiC,KACtBr9B,GAAuBc,EAAS,wBAChC5W,SAASozC,WAAaH,GK3JT,SAASI,KACtB,IAAIC,EAASzzC,EAAe;AACxByzC,GAEF/yC,EADa+yC,EAAO/tB,SAAS,GAAGA,SAAS,GACb,6LDIzB,SAASguB,KACVZ,KACF7wC,OAAO0xC,aAAab,IACpBA,IAAY,GAEVC,KACF9wC,OAAO2xC,cAAcb,IACrBA,IAAa,GAIjB,SAASc,GAAMpsC,GACb,IAAIqsC,EAAatyC,OAAOiG,EAAK3H,EAAEgK,MAAM,KAAK;AACrC+oC,KAASA,GAAS,CAACzwB,WAAY,EAAG2xB,GAAI,KAC3ClB,GAAOzwB,WAAa0xB;AACpB,IAAIE,EAAYvsC,EAAK0a;AACjB6xB,IACFA,EAAUt3B,QAAQ,SAASnS,GACzB,IAAI/H,EAASsxC,EAAavpC,EAAQzJ,KAC9BmzC,EAAU1pC,EAAQ2pC,SAASnzC,KAAKoC,QAAQ,iBAAkB,MACzD0vC,GAAOkB,GAAGE,IAAYpB,GAAOkB,GAAGE,GAAWzxC,KAC9CqwC,GAAOkB,GAAGE,GAAWzxC,KAGzB+d,GAAU,YAAasyB,KAI3B,SAASsB,KACP,OEpCOp2B,GAAQ,CAACyE,IAAK,eFoCDE,KAAKmxB,IAGpB,SAASO,KAGd,OAFAV,KACAX,GAAa9wC,OAAOoyC,YAAYF,GAAU,KACnCA,KAOT,SAASG,KACP,IAAIC,EAJGr6B,IAAW24B,IAAUA,GAAOzwB,YAAc;AAK5B,KAAjBmyB,EACFH,KAEAtB,GAAY7wC,OAAOyb,WAAW02B,GACJ,KAAvB,IAAMG,IAIb,SAASC,GAAO/sC,GACVA,IAAOorC,GAASprC,GAGf,SAASgtC,KACd,OAAO94B,GAAU,aAAa+G,KAAK8xB,IAO9B,SAASE,KAHPx2B,MAAmBnb,EAAK8T,iBAAgC,eAAb9T,EAAKyf,KAKrDiyB,KAAc/xB,KAAK4xB,IGzEvB,SAASK,GAAev5B,EAAMnb,GAC5B,IAAI20C,EAAY31B,GAAa,CAAC7D,KAAMA,IAChCy5B,EAAY70C,EAAeC,GAC3B60C,EAAcD,EAAU/5B;AAC5BuE,GAAcu1B,EAAWC,GACzBC,EAAYrxB,aAAamxB,EAAWE,EAAYvhB,YAChDqhB,EAAU1rC,iBAAiB,QAAS,SAAS2c,GAC3CA,EAAIke,oBACH,GAGU,SAASgR,KACtBJ,GAAe,wBAAyB,qBACxCA,GAAe,sCAAuC,mBACtDA,GAAe,2BAA4B,qBAC3CA,GAAe,yCAA0C,qBACzDA,GAAe,uBAAwB,eACvCA,GAAe,qBAAsB,gBClBvC,SAASK,GAAY7/B,GACnBA,EAAG6F,UAAU5S,IAAI,WAGnB,SAAS6sC,GAAatnB,GACpBjJ,MAAMC,UAAUjI,QAAQkI,KAAK+I,EAAUqnB,IAOzC,SAASE,GAAc//B,EAAIoH,GACzB,IAAI44B,EAAchgC,EAAGgd,QAAQC,OACzB+O,EACF,qCAAqChqB,KAAKg+B,GAAa;AACrDhU,EAAsB,EACxBhsB,EAAG6F,UAAU5S,IAAImU,EAAI64B,IACZjU,EAAsB,EAC/BhsB,EAAG6F,UAAU5S,IAAImU,EAAI84B,IAErBlgC,EAAG6F,UAAU5S,IAAImU,EAAI+4B,IAIzB,SAASC,GAAYpgC,GACnB+/B,GAAc//B,EAAI,CAChBigC,GAAI,WACJC,GAAI,WACJC,GAAI,YAIR,SAASE,GAAargC,GACpB+/B,GAAc//B,EAAI,CAChBigC,GAAI,gBACJC,GAAI,kBACJC,GAAI,kBAIR,IAAIG,GAAU,CACZ,CACElxC,UAAW,WAAY,OAAOxB,EAAK4K,oBACnC+nC,cAAe,8BACfC,aAAc,+BAEhB,CACEpxC,UAAW,WAAY,OAAOxB,EAAK2K,0BACnCgoC,cAAe,qCACfC,aAAc,sCAEhB,CACEpxC,UAAW,WAAY,OAAOxB,EAAK8K,mBACnC6nC,cAAe,kCACfC,aAAc,mCAEhB,CACEpxC,UAAW,WAAY,OAAOxB,EAAK6K,sBACnC8nC,cAAe,qCACfC,aAAc;AAIlB,SAASC,GAAUhpB,EAASipB,GAC1BJ,GAAQ/4B,QAAQ,SAASvH,GAzD3B,IAA8B9U,EAAQw1C;AA0D9B1gC,EAAG5Q,cA1DmBlE,EA2DHusB,EA3DWipB,EA2DF1gC,EAAG0gC,GA1DrCZ,GAAa50C,EAAO8a,iBAAiB06B,OA+DhC,SAASC,KACd,IAAIC,EAAiB/1C,EAAe;AAC/B+1C,IAELH,GAAUG,EAAgB,iBACtBhzC,EAAK0O,mBACPwjC,GACEc,EAAetxB,uBAAuB,wBACxCzkB,EAAe,oBAAoBgb,UAAU5S,IAAI,YAGnDsc,MAAMC,UAAUjI,QAAQkI,KACtBmxB,EAAetxB,uBAAuB,eAAgB8wB,IACxD7wB,MAAMC,UAAUjI,QAAQkI,KACtBzkB,SAASgb,iBAAiB,WAC1B,SAAShG,GACgB,SAAnBA,EAAG1T,cACP0T,EAAGoQ,UAAY,6CACbpQ,EAAG1T,YAAc,WAKlB,SAASu0C,KACd,IAAIC,EAAmBj2C,EAAe;AACjCi2C,IACLL,GAAUK,EAAkB,gBACxBlzC,EAAK0O,mBACPwjC,GACEgB,EAAiBxxB,uBAAuB,uBAC1CzkB,EAAe,mBAAmBgb,UAAU5S,IAAI,YAGlDsc,MAAMC,UAAUjI,QAAQkI,KACtBqxB,EAAiBxxB,uBAAuB,eAAgB+wB,KC7G7C,SAASU,GAAKrgB,GAC3B,IAAIK,EAAML,EAAEjxB;AAEZ,OADIixB,EAAI,KAAKK,EAAM,IAAMA,GAClBA,ECGT,IAAIigB,GAAO,CAAC,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO;AAYtD,SAASC,GAAQC,EAAcC,GAC7B,IAXuBC,EACnBC,EACAC,EACAC,EACAC,EAOAC,EAAW,sBAAsBz/B,KAAKk/B;AAC1C,GAAKO,EACL,MAAO,QAbgBL,EAcL,IAAI5wC,KAAK1E,GAEI,KADlB,GAAVq1C,EAAe,GAAiC,GAA5B5xC,SAASkyC,EAAS,GAAI,IAC3ClyC,SAASkyC,EAAS,GAAI,MAfpBJ,EAAOD,EAAMM,cACbJ,EAAKP,GAAKK,EAAMO,WAChBJ,EAAMP,GAAKI,EAAMQ,UACjBJ,EAAQ98B,GAAO08B,EAAMS,YAChBd,GAAKK,EAAMU,YAER,IADHf,GAAKK,EAAMW,cACG,IAAMR,EAAM,IAAMD,EAAK,IAAME,EAAQ,IAAMH,GAS1B,QAGnC,SAASW,KACd,IAAIP,EAAWz2C,SAASskB,uBAAuB;AAC/C,GAAwB,IAApBmyB,EAAS3wC,OAAb,CACA,IAAImxC,EACFp3C,EAAe,mCACbq3C,EAAW,2BAA2BlgC,KACxCigC,EAAiB3yB,uBAAuB,aAAa,GAClDoD,mBAAmBpmB;AAExBf,EAAoB02C,EAClB,yDACAhB,GACEQ,EAAS,GAAG/uB,mBAAmBpmB,YAE/BJ,KAAK8Y,OACFiN,GAASiwB,EAAS,IACnBjwB,GAASiwB,EAAS,KAClBjwB,GACEjnB,SAASskB,uBAAuB,4BAA4B,GACzDoD,mBAAmBpmB,iBAOzB,SAAS61C,KACd,IAAIV,EAAWz2C,SAASskB,uBAAuB;AACvB,IAApBmyB,EAAS3wC,QACbvF,EAAoBV,EAAe,iCACjC,mDACAo2C,GACEQ,EAAS,GAAG/uB,mBAAmBpmB,YAC/BJ,KAAK+hB,KACHgE,GACEjnB,SAASskB,uBAAuB,qBAAqB,GAClDoD,mBAAmBpmB,aAExB2lB,GACEjnB,SAASskB,uBAAuB,uBAAuB,GACpDoD,mBAAmBpmB,gBCpChC,SAAS+M,KACP,IAAImf,EAAWxtB,SAASgb,iBAAiB;AACzCuJ,MAAMC,UAAUjI,QAAQkI,KAAK+I,EAAU,SAASxY,GACvB,cAAnBA,EAAG1T,cACL0T,EAAGoQ,UAAY,oDAuErB,SAASgyB,MA3CHx0C,EAAK2L,sBACL3L,EAAK4L,wBACPvG,EAAI,EAAGkkC,KAKLvpC,EAAK0M,kBACL1M,EAAKwM,yBACPnH,EAAI,EAAGumC,IAKL5rC,EAAKwK,wBACPnF,EAAI,EAAG0tC,IAKL/yC,EAAKyK,2BACPpF,EAAI,EAAG4tC,IAKLjzC,EAAKmO,mBACP9I,EAAI,EAAG4/B,IAKLjlC,EAAKoO,oBACP/I,EAAI,EAAGmgC,IAKLxlC,EAAKqO,sBACPhJ,EAAI,EAAG8d,IAcX,SAASsxB,GAAkB93B,GACzB,IAAI+3B,EAAMz3C,EAAe0f;AACrB+3B,GACFjP,GAAwB3kB,GAAK4zB,GAIjC,SAASC,GAAgBh4B,GACvB,IAAIi4B,EAAS33C,EAAe0f;AACxBi4B,IACFA,EAAO38B,UAAU5S,IAAI,OACrBiX,GAAcrf,EAAe,OAAQ23C,IA4BzC,SAASC,KACH70C,EAAKqN,cAxBL2G,EAAS,kBACX3O,EAAI,EAAGovC,GAAmB,CAAC,kBAKzBzgC,EAAS,yBACX3O,EAAI,EAAGovC,GAAmB,CAAC,mBAWzBzgC,EAAS,mBACX3O,EAAI,EAAGsvC,GAAiB,CAAC,wBAPvB3gC,EAAS,cACX3O,EAAI,EAAGsvC,GAAiB,CAAC,kBAxG3B30C,EAAK2L,qBAAuBqI,EAAS,wBACrChU,EAAK4L,sBAAwBoI,EAAS,yBACtChU,EAAKwK,uBAAyBwJ,EAAS,0BACvChU,EAAKyK,0BACHuJ,EAAS,6BACXhU,EAAK8T,gBAAkBE,EAAS,mBAChChU,EAAK4K,mBAAqBoJ,EAAS,sBACnChU,EAAK2K,yBAA2BqJ,EAAS,4BACzChU,EAAK8K,kBAAoBkJ,EAAS,qBAClChU,EAAK6K,qBAAuBmJ,EAAS,wBACrChU,EAAK0O,iBAAmBsF,EAAS,oBACjChU,EAAKmO,kBAAoB6F,EAAS,qBAClChU,EAAKoO,mBAAqB4F,EAAS,sBACnChU,EAAKqO,qBAAuB2F,EAAS,wBACrChU,EAAKwM,uBAAyBwH,EAAS,0BACvChU,EAAK0M,iBAAmBsH,EAAS,oBACjChU,EAAK4M,mBAAqBoH,EAAS,sBACnChU,EAAK6L,2BACsC,IAAzCmI,EAAS,8BAyGXwgC,KAEAnvC,EAAI,EAAGshC,IACPthC,EAAI,EAAG2sC,IAEP3sC,EAAI,EAAG+uC,IACP/uC,EAAI,EAAGkvC,IAEPlvC,EAAI,EAAGy9B,IAEH9uB,EAAS,aACX3O,EAAI,EAAGygB,IAETzgB,EAAI,EAAGohC,IAEPphC,EAAI,EAAGw8B,IACPx8B,EAAI,EAAG6S,IACP7S,EAAI,EAAG47B,IAEP57B,EAAI,EAAGu+B,IAEPv+B,EAAI,EAAG6+B,IACP7+B,EAAI,EAAGorC,IAEPprC,EAAI,EAAGua,IACPva,EAAI,EAAGssC,KAeM,SAASmD,KACtB,IAAIC,EAAU93C,EAAe;AACzB83C,GAAW9gC,GAAU8gC,EAAQ3lB,QAAQ4lB,KAAK,YAb1ChhC,EAAS,iBACX3O,EAAI,EAAGoG,IAETzL,EAAKqN,YAAc2G,EAAS,eAC5B3O,EAAI,EAAGkrC,IACPsE,KACK7gC,EAAS,mBACZ3O,EAAI,EAAGi7B,KCxMI,SAAS2U,KACtB73C,SAASy+B,cAAc,wBACpB11B,iBAAiB,QAAS,SAAS2c,GAClCA,EAAIpc;AACJ,IAAI8O,EAAM;AACVmM,MAAMC,UAAUjI,QAAQkI,KACtBzkB,SAASgb,iBAAiB,6FAE1B,SAAStb,GAAI0Y,GAAO,IAAM1Y,EAAEkB,KAAO,IAAMlB,EAAEuB,QAC7Ca,OAAOe,SAAWuV,ICTjB,ICQH0/B,GACAztC,GCCA0L,GFVOgiC,GACT,+qBAoBSC,GAAY,CACrBC,QAAQ,EACR9I,MAAM,EACNlgB,MAAO,CAAC,CAAC,EAAG,OAAQ,CAAC,EAAG,QACxBipB,WAAY,CACV,CAACtpB,WAAW,EAAOupB,QAAS,CAAC,KAE/BjpB,WAAW,EACXC,cAAe,GAENipB,GACT;AAQK,SAASC,GAAS34C,GACvBA,EAAE4J;AACF,IAAIqc,EAAO1M,EAAEvZ,EAAE2K,QACXiuC,EAAQ3yB,EAAKoG,OAAO5B,MACpB7H,EAASqD,EAAKoG,OAAOA,OAAO5B;AAChCroB,OAAOe,SAAW,8BAAgCyf,EAChD,WAAag2B,EG3CjB,SAASC,GAASC,GAChB12C,OAAOe,SAAW,6CAChB21C,ECHJ,SAASC,GAAenxC,GAMtB,OALAA,EAAKspB,MAAQtpB,EAAKspB,MAAM9E,OAAO,SAASC,EAAMC,GAG5C,OAFIA,EAAK4I,WAAW7I,EAAK2sB,UAAW,GACpC3sB,EAAKC,EAAKwI,QAAUxI,EACbD,GACN,IACIzkB,EAGM,SAASqxC,KACtB,OAAO/kB,KAAe1W,KAAKu7B,IHD7B,SAASG,KACP,IAAIhoB,EAAQ/wB,EAAewK,GAAS,UACjCia,uBAAuB;AACL,IAAjBsM,EAAM9qB,QACVye,MAAMC,UAAUjI,QAAQkI,KAAKmM,EAAO,SAASlxB,GAC3C,IAAIm5C,EAAWn5C,EAAEI,GAAGkD,QAAQqH,GAAS,SAAU;AAC3CytC,GAAIe,IAAqC,YAAxBf,GAAIe,GAAUC,OAAsBp5C,EAAEm/B,UAI/D,SAASka,GAAYzxC,GACnBwwC,GAAMxwC,EAAKspB;AACX,IAAI3K,EAAY7H,GAAU,CAACyH,UAAW;AACtCtlB,EAAoB0lB,EAClB,0CACF/G,GAAcuE,GAAKwC,GACnBA,EAAUld,iBAAiB,QAAS6vC,IAGvB,SAASI,GAAWC,GAC7B5/B,OACJhP,GAAS4uC,EACTN,KAAmBp2B,KAAKw2B,KCtB1B,IGEIG,GACAC,GACAC,GHJAC,GAAe;AAQnB,SAASC,KACP,IALc3zB,EAAM4zB,EAFC5zB,EAOjBA,EAAO1M,EAAE;AACb0M,EAAK6zB,QAAQ,CAACC,QAAS,GAAI,KARN9zB,EAEPA,EAMyBA,EANnB4zB,EAFe,WAAY5zB,EAAKoK,QAG7C,WAAYpK,EAAK6zB,QAAQ,CAAChU,OAAQ,GAAI,IAAK+T,MAQpD,SAASG,GAAqB5xC,EAAS6xC,GACrC1gC,EAAE,8BAA8Byf,SAEhCzf,EAAE,qBACCmV,OACCnV,EAAE,SAAU,CACVnZ,GAAI,4BACJmoB,MAAO,SAENmG,OACCnV,EAAE,SAAU,CAACnZ,GAAI,yBACd0vC,IAAI,CACHvnB,MAAO,MACP2xB,aAAc,SACdC,mBAAoBF,EACpBvjB,MAAO,qBACP0jB,OAAQ,oBACRC,QAAS,QAEV35C,KAAK0H,KAIhByV,WAAW+7B,GAAU,KAiBvB,SAASU,GAAgBt0B,GACvBA,EAAIke,kBACwB,IAAxByV,GAAavzC,OAfV6X,GAAU,CACf3Z,KAAM,OACNoU,IAAK,6CACL9Q,KAAM,CAAC2yC,cAAeZ,IACtBv7B,SAAU,SACTyE,KAAK,SAAS23B,GACQ,IAAnBA,EAAShxC,OACXwwC,GAAqB,UAAYQ,EAAS/wC,IAAK,oBAEjDrH,OAAOe,SAAW,iDAOlB62C,GAAqB,4BAA6B,oBAMtD,SAASS,GAASz0B,GACZ3P,IACkB,6BAAlB2P,EAAIrb,OAAOvK,IACbk6C,GAAgBt0B,GAIpB,SAAS00B,GAAU10B,GACjB,GAAKA,EAAIrb,OAAOwQ,UAAU+Q,SAAS,mBAAnC,CACA,IAAIyuB,EAAS30B,EAAIrb,OAAOvK,GAAGkD,QAAQ,kBAAmB,IAClDs3C,EAAUjB,GAAa30C,QAAQ21C,IAClB,IAAbC,EACFjB,GAAa5yC,KAAK4zC,GAElBhB,GAAa5kB,OAAO6lB,EAAS,IAIjC,SAASC,KAEP32B,GAAS,0BADT7N,IAA2BA,II1Fd,SAASykC,GAAgBC,EAASC,GAC/C,IAAIC,EAAe;AAInB,OAHID,IACFC,EAAe,UAAYxgC,GAAyB,mBAE/CA,GAAyB,gBAAkBwgC,EAChD,UAAYxgC,GAAyB,kBACrCkB,OAAOiB,KAAKm+B,GAAS3uB,OAAO,SAASC,EAAMvlB,GACzC,OAAOulB,EAAO,UAAY5R,GAAyB3T,EAAM,KACvDi0C,EAAQj0C,GAAO,WAChB,IDIP,IACIo0C,GADA9hB,GAAW;AAWf,SAAS+hB,KACFA,GAAoBC,WACvBD,GAAoBC,SAAW18B,GAAU,CAACyH,UAAW,gBACrDszB,GAAS58B,QAAQ,SAAS4X,GACxB,IAAI4mB,EAAU38B;AAEdc,GAAc67B,EADF5mB,EAAK,GAAGxZ,YAEpBuE,GAAc27B,GAAoBC,SAAUC,KAE9C1S,GAAwB6Q,GAAUv+B,WAAYkgC,GAAoBC,UAClE5B,GAAUr+B,UAAU5S,IAAI,YAY5B,SAAS+yC,GAAI7mB,GACX,IALiBA,EAJCA;AAUlBgE,GADYhE,EAAK,GAAGxZ,WAAWA,YATbwZ,EAUYA,EATV,IAAb2E,IAAkB3E,EAAK,KAAO2E,KAGpB3E,EAMgCA,EAL1CymB,GAAQlgB,SAAuB,YAAZvG,EAAK,MAQjC,SAAS8mB,KACPJ,KACA1B,GAAS58B,QAAQy+B,IAGnB,SAASE,GAAcx1B,GACrB,GAAKA,EAAIrb,OAAOwQ,UAAU+Q,SAAS,aAAnC,CACA,IAAIuvB,EAAS95C,OAAOqkB,EAAIrb,OAAO2nB,QAAQiH;AACnCkiB,IAAWriB,KACbA,GAAWqiB,EACXF,OASJ,SAASG,KACPjC,GAAS58B,QAAQ,SAAS4X,GACxB,IAPiBA,EAObknB,EAAUjC,GAASjlB,EAAK;AAC5BA,EAAK1tB,MARY0tB,EAQKknB,GAPfC,UAAmB,EACrBnnB,EAAKQ,UAMsB0mB,EAAQvC,SAgC5C,SAASyC,GAAUj0C,GAIf,IAhCqBmzC,EACnB5vB;AA4BAvjB,EAAKspB,OAASsoB,KAChBE,GAAW9xC,EAAKspB,MAChB3oB,EAAI,EAAGmzC,IAtBX,SAAsBvwB,GACpB,GAAiB,aAAbjoB,EAAKyf,IAAT,CAIA,IAAIm5B,EAAYx8B,GAAY,CAC1B6G,UAAW,UACXT,UAAW,2CAEbw1B,GAAU77B,GAAY,CACpB8G,UAAW,UACX7hB,KAAM,cAEA+E,iBAAiB,SAAUkyC,IACnC/7B,GAAcs8B,EAAWZ,IACzBr6C,EAAoBsqB,EAAQ,WAC5B3L,GAAc2L,EAAQ2wB,QAdpBZ,GAAU,CAAClgB,SAAS,GAsBpB+gB,EAjCqBhB,EAgCQnzC,EAAKmzC,SA/BhC5vB,EAASquB,GAAUv+B,WAAWA,WAC/B2K,uBAAuBkN,mBACnB3X,UAAU5S,IAAI,aACrB4iB,EAAO9hB,iBAAiB,QAASmyC,IACjC36C,EAAoBsqB,EAAQ2vB,GAAgBC,GAAS,IAC9C5vB,KA+BT,SAAS6wB,KAlGT,IACMC;AAAAA,EAAYl4B,GAAImF,iBAAiBE,qBAAqB;AAmG1D,IAAI8yB,GADJ1C,GAjGiB,aAAbt2C,EAAKyf,IACAs5B,EAAU,GAEZA,EAAU,IA+FO7yB,qBAAqB;AAC7CqwB,GAAW50B,MAAMC,UAAUzP,IAAI0P,KAAKm3B,EAAS,SAASjrB,GAGpD,MAAO,CAACA,EAFKA,EAAIqB,QAAQC,OACJ1wB,MAAMsY,IACN,MAIV,SAASgiC,KAClB99B,OACF46B,KAAmBp2B,KAAKg5B,IACxBtzC,EAAI,EAAGyzC,KE7HX,IACII,GACAC,GAFAC,GAAY;AAIhB,SAASC,GAAYC,GACnBA,EAAQzpB,KAAKlW,QAAQ,SAASvH,GAC5BA,EAAG8Z,IAAIjU,UAAU5S,IAAI,aAEvBi0C,EAAQ9S,MAAO,EAGjB,SAAS+S,KACPH,GAAUz/B,QAAQ,SAAS2/B,GACrBA,EAAQ9S,MAAO6S,GAAYC,KAInC,SAASE,GAAUF,GACjBA,EAAQzpB,KAAKlW,QAAQ,SAASvH,GAC5BA,EAAG8Z,IAAIjU,UAAU6d,OAAO,aAE1BwjB,EAAQ9S,MAAO,EAajB,SAASiT,GAAUrnC,GACjB,MAAmB,OAAfA,EAAG4Q,QALT,SAAkB5Q,GAChB,GAAIA,EAAGsnC,SAAWP,IAAgB,EAAI,OAAO/mC,EAKpCunC,CAASvnC,GAEC,UAAfA,EAAG4Q,QACAy2B,GAAUrnC,EAAG2F,iBADpB,EAiBF,SAAS6hC,GAAO92B,GACVo2B,IAdN,SAAoBp2B,GAClB,IAAI+2B,EAAQJ,GAAU32B,EAAIrb;AAC1B,GAAKoyC,EAAL,CACA,IAAIC,EAAYD,EAAMH,SAAWP,GAC7BG,EAAUF,GAAUU;CACH,IAAjBR,EAAQ9S,MACV+S,KACAC,GAAUF,IAEVD,GAAYC,IAKES,CAAWj3B,GAoB7B,SAASk3B,GAAY9tB,EAAK+tB,EAASC,EAAaC,EAAaC,GAJ7D,IAAoBA,EAASluB,EAbAA,EAIGA,EAAKguB;AAcnB,IAAZD,IACFC,EAAY1hB,OAAStM,EAnBIA,EAoBLA,EAnBlBgtB,IAAYhtB,EAAIjU,UAAU5S,IAAI,YAYP6mB,EAQLA,EAPlBjoB,EADcm2C,EAQLA,IAPaA,EAAQluB,IAS9BiuB,EAAYF,KACdC,EAAYrqB,KAAKoqB,GACfn2C,EAASo2C,EAAYD,GAAU,IACjCC,EAAYrqB,KAAKoqB,GAAS/tB,IAAMA,EAtBJA,EAuBLA,EAvBUguB,EAuBLA,EAtB1BhB,IACFhtB,EAAIjU,UAAU5S,IAAI,WAClB60C,EAAY1T,MAAO,GAEnB0T,EAAY1T,MAAO,GAqCvB,SAASmR,GAAW0C,GAElBr5B,GAASq5B,EADTnB,IAAaA,IAETA,GAAYK,KAnFhBH,GAAUz/B,QAAQ,SAAS2/B,GACpBA,EAAQ9S,MAAOgT,GAAUF,KA0EhCF,GAAUz/B,QAAQ,SAAS2/B,GACzBA,EAAQ9gB,OAAOvgB,UAAUwd,OAAO,cAkBrB,SAAS6kB,GAASxkC,GAPjC,IAAmBukC,EACbE;AAOJpB,GAAcrjC,EAAM0kC,QARHH,EASPvkC,EAAMukC,SARZE,EAASt9C,EAAeo9C,GAC5BnB,GAAYqB,EAAOziB,QACnB76B,EAAeo9C,GACZl0C,iBAAiB,SAAUwxC,GAAWhyC,KAAK,KAAM00C,IAMpD14B,MAAMC,UAAUjI,QAAQkI,KAAK/L,EAAM2kC,SAAS5qB,KAhC9C,SAAmBsqB,EAAaC,EAASluB,GACvC,IAAI+tB,EAAU/tB,EAAIwtB,SAAWP,GACzBW,GAAa5tB,EAAIwtB,SAAWO,GAAWd;AAC3CC,GAAUU,GAAah2C,EAASs1C,GAAUU,GAAY;AACtD,IAAII,EAAcd,GAAUU;AAC5BI,EAAYrqB,KAAOqqB,EAAYrqB,MAAQ,GACvCmqB,GAAY9tB,EAAK+tB,EAASC,EAAaC,EAAaC,IA2BxCz0C,KAAK,KAAMmQ,EAAMqkC,YAAarkC,EAAMskC,UAChDtkC,EAAM2kC,SAASt0C,iBAAiB,QAASyzC,IC3H3C,SAASc,GAAYT,GAAU,OAAmB,IAAZA,ECN/B,SAASU,GAAavoC,GAC3B,MAAmB,UAAfA,EAAG4Q,QAA6B5Q,EAC7BuoC,GAAavoC,EAAG2F,YCMzB,SAAS6iC,GAAoBl2C,GAC3B,IAAI6nC,EAAOV,GAAQnnC,GACfm2C,EAAK,CAACz7B,EAAG,EAAG2U,EAAGwY;AAInB,MAHa,6CAATA,IACFsO,EAAK,CAACz7B,EAAG,EAAG2U,EAAG,KAEV8mB,EAcT,SAASC,GAAkBh+C,GACzB,IAZwBub,EAYpB0K,EAAOjmB,EAAE2K;AACb,GAAqB,QAAjBsb,EAAKC,QAAmB,CAC1BlmB,EAAE4J;AACF,IAAIq0C,EAASh4B,EAAKhL,WAAWM,MAfPA,EAgBL0iC,EAfZhgC,GAAU,CAACvF,IAAK6C,IAAOiC,KAAKsgC,IAAqBj7B,KAAKvG,KAelCuG,KAZ7B,SAAoBoD,EAAMre,GACT,IAAXA,EAAK0a,IACPu7B,GAAa53B,GAAM+B,mBAAmB+K,KAAK,GAAGC,MAAM,GAAGtN,UACrD,wCASuC7c,KAAK,KAAMod,IAEtD,GAAuB,aAAnBA,EAAKE,UAA0B,CACjC,IAAI2H,EAAW/J,GAAIqF,qBAAqB;AACxCvE,MAAMC,UAAUjI,QAAQkI,KAAK+I,EAAU,SAASxY,GAAKA,EAAG6pB,WCjB5D,SAAS+e,GAAqBC,GAC5BriC,GAAU,iBACP+G,KAAK,SAA+Bjb,GACnC,IAAIw2C,EAAax2C,GAAQ;AACzB8Y,GAAU,gBAAiBnH,EAAEkD,OAAO2hC,EAAYD,MAItD,SAASE,GAAgBvxB,GACvB,OArBgBA,EAqBAA,EApBT7O,GAAU,CACfG,SAAU,OACV1F,IAAK,YACL9Q,KAAM,CACJ+a,IAAK,SACLC,OAAQ,gBACR07B,SAAUxxB,MAcWtP,KAAK,SAAyB5V,GACrD,IAAIu2C,EAAY;AAMhB,OALAA,EAAUrxB,GAAW,GACrBqxB,EAAUrxB,GAASvK,WAAanhB,GAChCwG,EAAKiV,QAAQ,SAAwB0hC,GACnCJ,EAAUrxB,GAASyxB,EAAIhU,UAAYgU,IAE9BJ;AA5BX,IAAkBrxB,EAgClB,IAAI0xB,GAAW,CACb,SAAS1xB,EAASqxB,GAAY,OAAOM,QAAQN,IAC7C,SAASrxB,EAASqxB,GAAY,OAAOzkC,GAASykC,IAC9C,SAASrxB,EAASqxB,GAAY,OAAOzkC,GAASykC,EAAUrxB,KACxD,SAASA,EAASqxB,GAChB,MAAgD,iBAAlCA,EAAUrxB,GAASvK,YAEnC,SAASuK,EAASqxB,GAChB,OAAOA,EAAUrxB,GAASvK,WAAanhB,GAAM;AAWjD,SAASs9C,GAAahmB,EAAO5L,GAC3B,OAAI4L,EACK2lB,GAAgBvxB,GAASjK,KAAKq7B,IAEhCpiC,GAAU,iBACd0B,KAZL,SAAgCsP,EAASqxB,GACvC,OAAIK,GAASnvB,MAAM,SAASrvB,GAAI,OAAOA,EAAE8sB,EAASqxB,KACzCA,EAEFE,GAAgBvxB,GAASjK,KAAKq7B,KAQNr1C,KAAK,KAAMikB,IAQ7B,SAAS6xB,GAAajmB,GACnC,IAAI5L,EAAUe;AACd,OAAO6wB,GAAahmB,EAAO5L,GACxBtP,KARL,SAA4BsP,EAASqxB,GAEnC,OADAj7C,EAAKi7C,UAAYA,EAAUrxB,GACpB5pB,EAAKi7C,WAMet1C,KAAK,KAAMikB,IC1DxC,IAkBIqxB,GACAz3C,GC1BAk4C,GACAC,GACA9gC,GACA+gC,GDIAC,GAAa,GACbC,GAAiB,CACnB,CAACn/B,MAAO,qCACR,CAACA,MAAO,iCAAkCoP,MAAS,aACnD,CAACpP,MAAO,kCAAmCoP,MAAS,uBACpD,CACEpP,MAAO,gDACPoP,MAAS,aAEX,CAACpP,MAAO,2CAA4CoP,MAAS,aAC7D,CAACpP,MAAO,wCAAyCoP,MAAS,aAC1D,CAACpP,MAAO,iCAAkCoP,MAAS,aACnD,CAACpP,MAAO,wCAAyCoP,MAAS,aAC1D,CAACpP,MAAO,0CAA2CoP,MAAS,aAC5D,CAACpP,MAAO,wCAAyCoP,MAAS,aAC1D,CAACpP,MAAO,mCAAoCoP,MAAS,aACrD,CAACpP,MAAO,wCAAyCoP,MAAS,cAIxDrnB,GAAO;AAEX,SAASq3C,KACP1lC,EAAE7S,IAAMkoB,UAAU,CAChBE,WAAY,GACZC,WAAY,CAAC,CAAC,GAAI,IAAK,GAAI,CAAC,GAAI,GAAI,QACpCmwB,WAAW,EACXlwB,QAASgwB,GACTxvB,WAAW,EACXC,cAAe,IAWnB,SAAStG,GAAWg2B,GAClB,OAAKhB,GAAUgB,GACR,4CACLhB,GAAUgB,GAAG/+C,GAAK,KAAO++C,EAAI,OAFJA,EAK7B,SAASC,GAAYD,GACnB,OAAKhB,GAAUgB,GACRhB,GAAUgB,GAAGz9B,MADO,GAI7B,SAAS29B,GAAWF,GAClB,OAAKhB,GAAUgB,GACR,2BACLhB,GAAUgB,GAAGG,UAAY,SAFA,GAK7B,SAASC,KAKP,GAHAt+C,EAAK,iCAELyF,GAAOqd,GAAIqF,qBAAqB,SAAS,GACzC,CACA,IAAIo2B,EAAW94C,GAAKosB,kBAAkB5J,iBAClCu2B,EAAYD,EAAS1sB;AACzB2sB,EAAUt5B,UAAY,WACtBs5B,EAAUj5B,aAAa,UAAW;AAClC,I7H1C0BjI,E6HStBmhC,EAiCAC,E7HzCGrhC,GAAS,QAASC;A6H0CzBiB,GAAcmgC,EAAOH,GACrB94C,GAAKyf,UAAY,kBACjBzf,GAAKosB,kBACF8sB,YAAYl5C,GAAKosB,kBAAkBA,mBACtCjO,MAAMC,UAAUjI,QAAQkI,KAAKre,GAAKqsB,KAAM,SAASsG,GAC/CxU,MAAMC,UAAUjI,QAAQkI,KAAKsU,EAAGrG,MAAO,SAAS6sB,GAC9CA,EAAGC,gBAAgB;AAErB,IAAIC,EAAQ1mB,EAAGrG,MAAM,GACjBuX,EAAWwV,EAAMn+C,YAAY4+B;AACjCuf,EAAMr6B,UAAYyD,GAAWohB,GAC7BzmB,GAAmBi8B,EAAO,OAASX,GAAY7U,GAC7C,YAAc8U,GAAW9U,GAAY,WAEzC/qB,GAAc9Y,GAAMi5C,GACpBp3C,EAAI,EAAG02C,IAhDoB,KADvBS,EAAc37B,GAAIa,uBAAuB,iBAC7Bxe,QAChB0d,GAAmB47B,EAAY,GAAI,+FAkDnCr+C,EAAQ,kCAgDV,SAAS2+C,GAAehgD,GACtB,OAAOie,GAAU,CACfvF,IAAK,YACL9Q,KAAM,CACJwnC,UAAW,EACXzsB,IAAK,QACLC,OAAQ,UACRq9B,OAAQjgD,KAET6iB,KArDL,SAA2B7iB,EAAGw6C,GAE5Bv5C,EAAK,iCAAmCjB,GAExCa,EAAoB6F,GAAKwiB,iBAAiBA,iBACxC,QAAUlpB,EAAI;AAChB,IACIkgD,EAAM//C,EAAe,MADf4iB,GAAey3B;AAEzB,GAAK0F,EAAL,CACA,IAEI7mB,EAFQ6mB,EAAIptB,kBAAkBA,kBAAkB5J,iBACjD4J,kBAAkBA,kBACNC;AACflO,MAAMC,UAAUjI,QAAQkI,KAAKsU,EAAI,SAAS/jB,GACxC,IAAI2a,EAAM3a,EAAG0d,MACT1R,EAAS2O,EAAI,GAAGruB,YAAY4+B;AACjB,WAAXlf,IACJy9B,GAAWz9B,GAAUta,EAAS+3C,GAAWz9B,GAAS,IAClDy9B,GAAWz9B,GAAQ6+B,QACjBn5C,EAAS+3C,GAAWz9B,GAAQ6+B,QAAS,GACrC54B,GAAS0I,EAAI,GAAGruB,aAClBm9C,GAAWz9B,GAAQ8+B,IAAMp5C,EAAS+3C,GAAWz9B,GAAQ8+B,IAAK,GACxD74B,GAAS0I,EAAI,GAAGruB,aAClBm9C,GAAWz9B,GAAQ++B,MAAQr5C,EAAS+3C,GAAWz9B,GAAQ++B,MAAO,GAC5D94B,GAAS0I,EAAI,GAAGruB,aAClBm9C,GAAWz9B,GAAQg/B,IAAMt5C,EAAS+3C,GAAWz9B,GAAQg/B,IAAK,GACxD/4B,GAAS0I,EAAI,GAAGruB,aAClBm9C,GAAWz9B,GAAQi/B,OAASv5C,EAAS+3C,GAAWz9B,GAAQi/B,OAAQ,GAC9Dh5B,GAAS0I,EAAI,GAAGruB,aAClBm9C,GAAWz9B,GAAQk/B,OAASx5C,EAAS+3C,GAAWz9B,GAAQk/B,OAAQ,GAC9Dj5B,GAAS0I,EAAI,GAAGruB,aAClBm9C,GAAWz9B,GAAQm/B,QACjBz5C,EAAS+3C,GAAWz9B,GAAQm/B,QAAS,GACrCl5B,GAAS0I,EAAI,GAAGruB,aAClBm9C,GAAWz9B,GAAQo/B,OAAS15C,EAAS+3C,GAAWz9B,GAAQo/B,OAAQ,GAC9Dn5B,GAAS0I,EAAI,GAAGruB,aAClBm9C,GAAWz9B,GAAQq/B,QACjB35C,EAAS+3C,GAAWz9B,GAAQq/B,QAAS,GACrCp5B,GAAS0I,EAAI,GAAGruB,gBAGpBP,EAAQ,iCAAmCrB,KAajB6I,KAAK,KAAM7I,IAGvC,SAAS4gD,KAEP3/C,EAAK,+BAELyF,GAAKyf,UAAY,kBACjBzf,GAAKgf,UAAY,gFAEfgE,GAAUq1B,GAAW,UAAUoB,SAAW,mBAC1Cz2B,GAAUq1B,GAAW,UAAUqB,KAAO,mBACtC12B,GAAUq1B,GAAW,UAAUsB,OAAS,mBACxC32B,GAAUq1B,GAAW,UAAUuB,KAAO,mBACtC52B,GAAUq1B,GAAW,UAAUwB,QAAU,mBACzC72B,GAAUq1B,GAAW,UAAUyB,QAAU,mBACzC92B,GAAUq1B,GAAW,UAAU0B,SAAW,mBAC1C/2B,GAAUq1B,GAAW,UAAU2B,QAAU,mBACzCh3B,GAAUq1B,GAAW,UAAU4B,SAC7B,yBACJpnC,EAAE7S,IAAMkoB,UAAU,CAChBhnB,KAAMA,GACNknB,WAAY,GACZC,WAAY,CAAC,CAAC,GAAI,IAAK,GAAI,CAAC,GAAI,GAAI,QACpCmwB,WAAW,EACXlwB,QAASgwB,GACTxvB,WAAW,EACXC,cAAe,IAGjBpuB,EAAQ,+BAIV,SAASw/C,GAAS1B,GACN,WAANA,GACJv3C,GAAKb,KAAK,CACRoiB,GAAWg2B,GACXC,GAAYD,GACZE,GAAWF,GACXz1B,GAAUq1B,GAAWI,GAAGgB,SACxBz2B,GAAUq1B,GAAWI,GAAGiB,KACxB12B,GAAUq1B,GAAWI,GAAGkB,OACxB32B,GAAUq1B,GAAWI,GAAGmB,KACxB52B,GAAUq1B,GAAWI,GAAGoB,QACxB72B,GAAUq1B,GAAWI,GAAGqB,QACxB92B,GAAUq1B,GAAWI,GAAGsB,SACxB/2B,GAAUq1B,GAAWI,GAAGuB,QACxBh3B,GAAUq1B,GAAWI,GAAGwB,WAI5B,SAASG,KACPnlC,OAAOiB,KAAKmiC,IAAYliC,QAAQgkC,IAChCt4C,EAAI,EAAGq4C,IAmCM,SAASG,KAClBpnC,OACiB,WAAjBzW,EAAK89C,SAhCT//C,EAAK,qCAELyF,GAAOqd,GAAI+O,kBAAkBA,kBAC1B5J,iBAAiB4J,kBAAkBA,qBAEtCpsB,GAAKgf,UAAY,+KAKjBnM,EAAE2Z,KACAyrB,IAAa,GACV97B,KAAK,SAAS23B,GACb2D,GAAY3D,IAEhBwF,GAAe,GACfA,GAAe,GACfA,GAAe,GACfA,GAAe,GACfA,GAAe,GACfA,GAAe,GACfA,GAAe,IACfn9B,KAAK,WACLta,EAAI,EAAGu4C,MAGTz/C,EAAQ,sCASNs9C,IAAa,GAAO97B,KAAK,SAAS23B,GAChC2D,GAAY3D,EACZjyC,EAAI,EAAGg3C,OC7Ob,SAAS0B,KACP,IAL+BC,EAK3BC,EAASt8C,SAAS0U,EAAE,cAAckR,MAAO,IACzCy2B,EAASr8C,SAAS0U,EAAE,cAAckR,MAAO;AANdy2B,EAOHA,EANpBlzB,MAMYmzB,IANMnzB,MAAMkzB,MAO9BnjC,GAAO/W,EAAS+W,GAAM,KACjBojC,OAASA,EACdpjC,GAAKmjC,OAASA,EACdxgC,GAAU,YAAa3C,IACvBxE,EAAE,qCAAqC6nC,YAAYjxB,QAIvD,SAASkxB,MACPtjC,GAAOA,IAAQ,IACVojC,OAASh2C,EAAS6H,YACvB+K,GAAKmjC,OAAS/1C,EAAS8H,YACvByN,GAAU,YAAa3C,IACvBxE,EAAE,cAAckR,IAAI1M,GAAKojC,QACzB5nC,EAAE,cAAckR,IAAI1M,GAAKmjC,QACzB3nC,EAAE,qCAAqC6nC,YAAYjxB,OAGrD,SAASmxB,GAAUt7B,IACjBjI,GAAOA,IAAQ,IACVujC,UAAYt7B,EAAIrb,OAAOqwB,QAC5Bta,GAAU,YAAa3C,IACvBxE,EAAE,YAAYof,QAAQ3S,EAAIrb,OAAOqwB,SAOnC,SAASumB,GAAYv7B,GACnB,IALqB3f,EAKjB4f,EAAO1M,EAAEyM,EAAIrb,QAAQ62C,QAAQ,MAC7Bp0B,EAAQnH,EAAKu7B,QAAQ,SAASJ,YAC9BK,EAAQx7B,EAAK+J,QACb0xB,EAAUz7B,EAAK8J,KAAK,SACpB1pB,EAAO,kBAAkBiR,KAAKoqC,GAC9BC,EAAY,QAVKt7C,EAWHA,IAVS,UAAZA,EAAK,KAUMs7C,EAAY,OACxB,IAAVF,EACFr0B,EAAMmC,MAAM,CAAC,EAAG,OAAQ,CAACkyB,EAAOE,IAAYxxB,OAE5C/C,EAAMmC,MAAM,CAAC,EAAGoyB,IAAYxxB,OA+BhC,SAASyxB,KACP,IAAIhU,EAASr0B,EAAE;AACfq0B,EAAOiU,QAAQj+B,aAAagqB,GAAQ3lB,KAAK,MAAM8H,KAAK,SAAU,KAC9D6d,EAAOiU,QAAQC,YAAYlU,GAAQ3lB,KAAK,MAAM8H,KAAK,SAAU;AAC7D,IA9BIgyB,EASAC,EASAC,EAYAC,EAAS3oC,EAAEm/B;AA9BXqJ,EAAexoC,EAAE,gBA+BH2oC,GA9BdnkC,IAAQ,cAAeA,KACzBgkC,EAAaI,KAAK,UAAWpkC,GAAKujC,WAClC/nC,EAAE,YAAYof,QAAQ5a,GAAKujC,YAE7BS,EAAa5iB,MAAMmiB,IAIfU,EAAYzoC,EAAE,aAuBN2oC,GAtBRnkC,IAAQ,WAAYA,GACtBikC,EAAUv3B,IAAI1M,GAAKojC,QAEnBa,EAAUv3B,IAAItf,EAAS6H,aAKrBivC,EAAY1oC,EAAE,aAeN2oC,GAdRnkC,IAAQ,WAAYA,GACtBkkC,EAAUx3B,IAAI1M,GAAKmjC,QAEnBe,EAAUx3B,IAAItf,EAAS8H,aAYzBsG,EAAE,yBAA0B2oC,GAAQE,MAAMnB,IAC1C1nC,EAAE,YAAa2oC,GAAQ/iB,MAAMkiB,IAC7B9nC,EAAE,KAAMq0B,GAAQlf,OAAOwzB,GAGzB,ICjGIG,GDiGAC,GAAc,CAChB,SAASh/B,GAAM,OAAQA,GACvB,SAASA,EAAKrC,GAAM,OAAQA,GAC5B,SAASqC,EAAKrC,GAAM,OAAO+M,MAAM1K,IAAQ0K,MAAM/M,IAC/C,SAASqC,EAAKrC,EAAKS,GAAQ,OAAOsM,MAAM1K,IAAQ5B,GAAST,GACzD,SAASqC,EAAKrC,EAAKS,GAAQ,OAAO4B,GAAO5B,GAASsM,MAAM/M,IACxD,SAASqC,EAAKrC,EAAKS,GAAQ,OAAO4B,GAAO5B,GAASA,GAAST;AAa7D,SAASshC,GAAUp0B,EAAWvmB,GAC5B,OAAImW,IAXN,SAAiBoQ,EAAWvmB,GAI1B,IAHA,IAAI0b,EAAMvF,GAAKojC,OACXlgC,EAAMlD,GAAKmjC,OACXx/B,EAAQ6F,GAAS3f,EAAK,IACjBzB,EAAI,EAAGA,EAAIm8C,GAAYl8C,OAAQD,GAAK,EAC3C,GAAIm8C,GAAYn8C,GAAGmd,EAAKrC,EAAKS,GAAS,OAAO;AAE/C,OAAO,EAIW8gC,CAAQr0B,EAAWvmB,GAWvC,SAAS66C,GAAS1U,GAChB,IAAI2U,EAAU,YAAYprC,KAAKiC,EAAE,MAAOw0B,GAAMhe,KAAK;AAC/C2yB,GAAU3U,EAAKhe,KAAK,aAAc2yB,EAAQ,IAUhD,SAASC,GAAa5U,EAAM3e,GAC1B,IARmBszB,EAAStzB,EAQxBszB,EAAU,oBAAoBprC,KAAKiC,EAAE,MAAOw0B,GAAMhe,KAAK;AACvD2yB,IATeA,EAULA,EAVctzB,EAULA,EATnBrR,GAAK6kC,MAAMF,EAAQ,KACY,IAAjC3kC,GAAK6kC,MAAMF,EAAQ,IAAIhrB,OACvBtI,EAAIT,SAAS,WAQbof,EAAKhe,KAAK,aAAc2yB,EAAQ,KAsBpC,SAASG,GAAkBzzB,EAAK2e,GAC9B,IARoB3e,EAAKhvB,EAQrBsiD,EAAU,WAAWprC,KAAKy2B,EAAKzsC,QAC/B,CAACohD,EAAS3kC,GAAMA,GAAK3d,IAAIivB,MAAM3V,MACjCqE,GAAK3d,GAAGsiD,EAAQ,IAAMA,EAAQ,GAVZtzB,EAWLA,EAXUhvB,EAWLsiD,EAAQ,GAVxB5D,KAAWA,GAAO1+C,KACpBgvB,EAAI0gB,IAAI,mBAAoB,WAC5B1gB,EAAInH,KAAK,MAAM6nB,IAAI,mBAAoB,aAY3C,SAASgT,GAAU38C,EAAGnG,GACpB,IAtDe+tC,EACX2U,EA0BY3U,EAAM3e,EAMR2e,EAqBV3e,EAAM7V,EAAEvZ,GACRgtC,EAAW5d,EAAIvJ,WACfkoB,EAAOf,EAAS1d,GAAG;AACvBuzB,GAAkBzzB,EAAK2e,GAzDRA,EA0DPf,EAAS1d,GAAG,IAzDhBozB,EAAU,mBAAmBprC,KAAKy2B,EAAKzsC,UAEzCysC,EAAKhe,KAAK,aAA2B,IAAb2yB,EAAQ,GAAY/gD,OAAO+gD,EAAQ,MAwD7D3U,EAAOf,EAAS1d,GAAG,IACdS,KAAK,aAAcxW,EAAE,KAAMw0B,GAAMle,QAAQvuB,OAAOgC,QAAQ,SAAU,KACvEm/C,GAASzV,EAAS1d,GAAG,IACrBmzB,GAASzV,EAAS1d,GAAG,IACrBmzB,GAASzV,EAAS1d,GAAG,IApCLye,EAqCPf,EAAS1d,GAAG,GArCCF,EAqCGA,EApCrBrR,IAAQA,GAAK6kC,OACfD,GAAa5U,EAAM3e,GAKiB,KADxB2e,EAgCPf,EAAS1d,GAAG,IA/BVzJ,SAAS,SAASzf,QAC3B2nC,EAAKhe,KAAK,aAAcge,EAAK9lB,KAAK,MAAM4H,QAAQvuB,OAAOgC,QAAQ,SAAU,KAiC3E,SAASy/C,GAAS58C,EAAGnG,GACnB,IAAIgjD,EAAWzpC,EAAE,KAAMvZ,GAAG6vB;AAC1BtW,EAAE,IAAKypC,GAAUC,WAAWC,SAC5B3pC,EAAEvZ,GAAGmmC,QAAQ5sB,EAAE,YAAYmV,OAAOs0B,IAGpC,SAASG,GAAQC,GAEfniD,EAAK,iBAEL49C,GAAUrlC,KAAKupC,IAEfjE,IADA/gC,GAAOqlC,GAAS,IACFhjD,IAAM,GACpB2d,GAAK3d,GAAK,GACGy+C,GAAUh5B,SAAS,SAASA,SAAS,MAC3CrM,KAAKspC,IACZlB,KACAlhC,GAAU,YAAa3C,IACvBxE,EAAE/Q,GAAGomB,UAAUC,IAAIxrB,OAAO0D,KAAKw7C,IAC/B1D,GAAUuC,UAAU9I,IACpB/+B,EAAE,8CAA+CqlC,IAAMyE,IAAI,SAC3D9pC,EAAE,yBAAyB8W,OAC3BuuB,GAAK0E,GAAG,QAAS,8CAA+C/B,IAChE3C,GAAK0E,GAAG,QAAS,oCAAqC3K,IAEtDt3C,EAAQ,iBAIK,SAASkiD,KAClB5pC,MAEgB,KADpBilC,GAAOrlC,EAAE,mBACAnT,SACTy4C,GAAYtlC,EAAE,qBAAsBqlC,IACpC9iC,GAAU,aAAa+G,KAAKsgC,KErOf,SAASK,GAAUC,EAAQngC,EAAKrC,GAC7C,IALuByiC,EAAUpgC,EAAKrC,EAKlCyiC,EAAW7+C,SAAS4+C,EAAQ;AAChC,GANuBC,EAMHA,EANapgC,EAMHA,EANQrC,EAMHA,GAL3B+M,MAAM01B,IAAwBpgC,EAAXogC,GAAkBA,EAAWziC,EAMtD,OAAOyiC,ECLI,SAASC,GAAUF,GAChC,OAAOD,GAAUC,EAAQ,EAAG,KFQ9B,IAAIG,GACF,uyBAeEC,GACF;AAGF,SAASC,KACP,OAAOH,GAAUxjD,EAAe,cAAcoB,OAGhD,SAASisB,GAAOxH,GACd,IAAIrb,EAASqb,EAAIrb;AACjB,GAAKA,EAAOwQ,UAAU+Q,SAAS,gBAA/B,CACA,IAAIw3B,EAAWI;AACf,GAAKJ,EAAL,CACAvjD,EAAe,YAAYyB,YAAc8hD,EACzCrB,GAAS13C,EAAOmhB,aAAa,UAC7B3rB,EAAe,oBAAoB2/C,gBAAgB;AACnD,IAAIiE,EAAUp5C,EAAOq5C,WAAU;AAC/BD,EAAQ59B,UAAY;AACpB,IAAI89B,EAAW9jD,EAAe;AAC9B8jD,EAASv+B,UAAY,GACrBlG,GAAcykC,EAAUF,KAG1B,SAASG,KACP,IAAIR,EAAWI;AACXJ,IACFvjD,EAAe,YAAYyB,YAAc8hD,GAI7C,SAAS7gC,GAAKyR,GACZ,IAAItC,EAAY7xB,EAAe;AAC3Bk0B,GAASC,EAAMtC,IACfsC,EAAKC,GACPJ,GAAa,0BAA2BnC,GAI5C,SAASmyB,KACP,GAAK9B,GAAL,CACA,IGjE8B5tB,EHiE1B2vB,EAAYjkD,EAAe,YAAYyB;AAC3CzB,EAAe,kBAAkByB,YAC/B,UAAYwiD,EAAY;AAC1B,IAAK,IAAIj+C,EAAI,EAAGA,EAAIi+C,EAAWj+C,GAAK,GGpENsuB,EHqEpB4tB,GGpEHnkC,GAAQ,CACbyE,IAAK,eACLC,OAAQ,UACRwS,QAASX,KHiEO5R,KAAKA,KIhEzB,IAAIwhC,GAAW,CAAC3sB,MAAO,EAAG4sB,MAAO,IAC7BC,GAAQ,sBACRC,GACF;AAiBF,SAASC,KAda,MAAhBvhD,EAAK0f,QAAiBlf,EAAU,UAAW;AAgB/C,IAZIwiC,EAYAA,EATFA,EAD0B,KAFxBA,EAAeniB,GAChBqF,qBAAqB,OACPhjB,OACA8/B,EAAa,GAAGtkC,YAEhBunB,KAQbu7B,EAAa/oC,OAAOiB,KAAKynC,GAASC,OAAO7sB,KAAK,MAC9CktB,EAAeztC,EAAS,oBAAoBspB,OAC5CokB,GAAkD,IAArCD,EAAa3/C,QAAQ,WAClC6/C,GAAiD,IAApCF,EAAa3/C,QAAQ;AACtC2/C,EAAeA,EAAarhD,QAAQ,gBAAiB4iC,GAChD0e,EAMHD,EAJUE,EAIKF,EACZrhD,QAAQ,WAAY,KAAOohD,EAAa,MACxCphD,QAAQ,UAAW+gD,GAASS,mBALhBH,EACZrhD,QAAQ,WAAY,KAAOohD,EAAa,MAH3CC,GAAgB,IAAMD,EASxBtiD,OAAOg9B,mBAAmB8G,EAAcye,EAAc,IAOxD,ICvCIx2C,GACA0e,GACAk4B,GACAC,GCXAC,GCWA7zC,GCFA8zC,GACAC,GACAC,GACAC,GACAC,GCNAC,GACAC,GACAC,GACAC,GCEAC,GACAC,GACAC,GACAC,GCHAC,GACAxkC,GACAykC,GCJAxjC,GACAyjC,GACAC,GACAC,GACAC,GRiCAC,GAAgB,CAClB,CACE3hD,UAAW,SAAS27C,GAClB,OAAmB,EAAZA,EAAMC,KAEf37C,OAAQ,SAAS07C,GACf,OAAOiG,OAAO9kD,KAAKC,MAAkB,IAAZ4+C,EAAMC,KAAa,KAAO,SAGvD,CACE57C,UAAW,SAAS27C,GAClB,OAAmB,EAAZA,EAAMC,KAAqB,EAAVD,EAAMkG,GAEhC5hD,OAAQ,WACN,MAAO,UAGX,CACED,UAAW,SAAS27C,GAClB,OAAiB,EAAVA,EAAMkG,GAEf5hD,OAAQ,SAAS07C,GACf,OAAOA,EAAMkG,EAAI,OAGrB,CACE7hD,UAAW,SAAS27C,GAClB,OAAoB,EAAbA,EAAM9kB,OAAyB,EAAZ8kB,EAAMC,KAAqB,EAAVD,EAAMkG,IAEnD5hD,OAAQ,WACN,MAAO,UAGX,CACED,UAAW,SAAS27C,GAClB,OAAoB,EAAbA,EAAM9kB,MAEf52B,OAAQ,SAAS07C,GACf,OAAOA,EAAM9kB,KAAO,SAClB+qB,OAAO9kD,KAAKC,MAAM4+C,EAAM9kB,KAAO,GAAK,IAAM,IAAM,SAGtD,CACE72B,UAAW,SAAS27C,GAClB,OAAuB,EAAhBA,EAAMmG,SAEf7hD,OAAQ,SAAS07C,GACf,MAAO,KAAOA,EAAMmG,QAAU;AAepC,SAASC,KACP,IAAIpG,EAAQ,CAACkG,EAAG,EAAGjG,IAAK,EAAG/kB,KAAM,EAAGirB,QAAS,GACzC9lD,EAAO;AAKXib,OAAOiB,KAAKynC,GAASC,OAAOznC,QAAQ,SAAS6pC,GAC3CrG,EAAMgE,GAASC,MAAMoC,GAAM,KAAOrC,GAASC,MAAMoC,GAAM,GACvDhmD,GAAQ,WAAagmD,EAAO,cAAgBrC,GAASC,MAAMoC,GAAM,GAC/DrC,GAASC,MAAMoC,GAAM,GAAK;AAG9B,IAvBkBrG,EAuBdsG,GAvBctG,EAuBSA,EAtBpBgG,GAAcj6B,OAAO,SAASC,EAAM/W,GACzC,IAAI+gB,EAAMhK;AAIV,OAHI/W,EAAG5Q,UAAU27C,KACfhqB,GAAO/gB,EAAG3Q,OAAO07C,IAEZhqB,GACN;AAkBH31B,GAAQ,qBAAuBimD,EAAY,OAC3CxmD,EAAe,YAAYulB,UAAY,8CACAhlB,EAAO,wBAC5CimD,EAAY,cACdtC,GAASS,kBAAoB6B,EAsB/B,SAASC,GAASruC,GAChB,OAAOA,GAAwC,OAAhCA,EAAKsuC,SAAS77B,cAkB/B,SAAS87B,GAAYC,GAOnB,IANA,IAEIC,EAFAzuC,EAAOwuC,EACPE,EAAW1uC,EAAK3W,YAEhBN,EAAO,GAGJslD,GAASruC,IACdyuC,EAAUzuC,EAAK3W,YACf2W,EAAOA,EAAK0sB,YACZ3jC,GAAQ0lD;AAEV,IAEI1iD,EACA4iD,EA5CaC,EAyCbA,EAAQ7lD,EAAKgC,QAAQihD,GAAO,IAAIv5B,cAAcnpB,MAAM2iD,KACxD2C,EA5BF,SAAyBJ,EAAcI,GACrC,IAAKA,EAAO,CAIV,IAHA,IAAIH,EACA1lD,EAAO,GACPiX,EAAOwuC,EACJH,GAASruC,IACdyuC,EAAUzuC,EAAK3W,YACf2W,EAAOA,EAAKwkB,gBACZz7B,EAAO0lD,EAAU1lD;AAEnB,OAAOA,EAAKgC,QAAQihD,GAAO,IAAIv5B,cAAcnpB,MAAM2iD,IAErD,OAAO2C,EAgBCC,CAAgBL,EAAcI,KAIpC7iD,EA7C0B,GADX6iD,EA8CEA,GA7CT,GAAGniD,QAAQ,KACZ,IAEmB,EAAxBmiD,EAAM,GAAGniD,QAAQ,KACZ,MAEF,OAwCLkiD,EAAOC,EAAM,GAAGtlD,MAAM,qBAAqB,KAE3CyC,EAAO,UACP4iD,EAAO,KAET7C,GAASC,MAAM2C,GAAY,CAACI,WAAWH,GAAO5iD,GAC9C+/C,GAAS3sB,OAAS,EAGpB,SAAS4vB,GAAiBthC,GAGxB,IADA,IAAI+gC,EAAe/gC,EAAIrb,OACuB,SAAvCo8C,EAAa7gC,QAAQ8E,eAC1B+7B,EAAeA,EAAa9rC;AAE9B,IAAI1C,EAAOwuC,EACP9C,EAAW1rC,EAAK4C,UAAU+Q,SAAS;AACvC3T,EAAK4C,UAAUwd,OAAO,WACtBpgB,EAAK4C,UAAUwd,OAAO;AACtB,IAAIsuB,EAAW1uC,EAAK3W;AAChBqiD,EACF6C,GAAYC,IAEZ1C,GAAS3sB,OAAS,SACX2sB,GAASC,MAAM2C,IA/EH,EAAjB5C,GAAS3sB,MACX+uB,MAEAtmD,EAAe,YAAYulB,UAAY,GACvC2+B,GAASS,kBAAoB,IA8FlB,SAASyC,GAAUvnD,GAChC,IANkB+mD,EAMdA,EAfN,SAAyB/mD,GAEvB,IADA,IAAI+mD,EAAe/mD,EAAE2K,OACdo8C,EAAa7gC,SACuB,SAAvC6gC,EAAa7gC,QAAQ8E,eACvB+7B,EAAeA,EAAa9rC;AAE9B,OAAO8rC,EASYS,CAAgBxnD,IANjB+mD,EAOHA,GANK5rC,WAClB4rC,EAAa5rC,UAAU+Q,SAAS,YAMhCo7B,GAAiBtnD,GACQ,mBAAhBA,EAAE2K,OAAOvK,IA9LC,EAAjBikD,GAAS3sB,OAAY+sB,KS/CZ,SAASgD,GAAoBjnD,EAAQc,GAClDT,EAAoBL,EAAQc,GCHf,SAASomD,GAAUC,GAChC,IAAIC,EAAcD,EAAarkD,QAAQ,SAAU,MAC9CA,QAAQ,WAAY,MACnBghD,EAAQsD,EAAY/lD,MAAM;AAC9B,OAAKyiD,GACLA,EAAMznC,QAAQ,SAAS6pC,EAAMvgD,GAC3B,IACI0hD,EAAW,oBAAsB1hD,EAAI,8BAD1BugD,EAAKpjD,QAAQ,+BAAgC,IAE/C;AACbskD,EAAcA,EAAYtkD,QAAQojD,EAAMmB,KAEtCD,EAAY5iD,QAAQ,SAAW,IAAI4iD,GAAe,SACtDA,EAAcA,EAAYtkD,QAAQ,QAChC,uIATkBqkD,ETsEtB,SAASG,KACP,IAAIC,EAASpE,GAAUqB,GAAOzjD;AAC1BwmD,IAEF7jC,GAAS,eADT/V,GAAe45C,GAEfl7B,GAASkG,KAAO5kB,IAmBpB,SAAS65C,KACP,IAjFyBC,EACrB5xB,EAgFAuxB,GAjFqBK,EAiFWp7B,GAAStrB,MAhFzC80B,EAAM4xB,EACP3kD,QAAQ,KAAM,OACdA,QAAQ,KAAM,OACdA,QAAQ,MAAO,QACfA,QAAQ,oBAAqB,UAC7BA,QAAQ,QAAS,QACjBA,QAAQ,MAAO,IACD,UAAbJ,EAAKyf,MACP0T,EAAMA,EACH/yB,QAAQ,kBAAmB,kBAC3BA,QAAQ,YAAa,qBACrBA,QAAQ,cAAe,SACvBA,QAAQ,mBAAoB,gBAE1B+yB;AAmEPuxB,EAAcF,GAAUE,GACxB7C,GAAYr/B,UAAYkiC,EAGX,SAASM,KACtB/5C,GAAe+I,EAAS,gBACxB2V,GAAW1sB,EAAe,gBAtE5B,WACE,IAAIgoD,EAAa;AACA,UAAbjlD,EAAKyf,MACsBwlC,EAAT,SAAhBjlD,EAAK0f,OAAiC,aAC3B;AAGjB,IAAIwlC,EAAmB1pC,GAAU,CAC/ByH,UACE,mBAAqBgiC;AAMzB3oC,GAAc4oC,EAJM1pC,GAAU,CAC5ByH,UAAW,2BACXT,UAAW,aAIblG,GAAc4oC,EADdrD,GAAcrmC,GAAU,CAACyH,UAAW,+BAEpC3G,GAAcqN,GAAS5R,WAAYmtC,GAqDnCC,GAjDiB,YAAbnlD,EAAKyf,KAEP9hB,EAAoBkjB,GAAK,2gBAuB7B,WACE,IAAIukC,EAAkB5pC,GAAU,CAACgH,UAAW;AAE5ClG,GAAc8oC,EADdtD,GAAS3lC,GAAY,CAACiE,IAAK,EAAGrC,IAAK,GAAI3c,KAAM,SAAU/C,MAAO4M,MAE9Ds5C,GAAoBa,EAAiB;AACrC,IAAIC,EAAYlpC,GAAY,CAC1B8G,UAAW,eACX5kB,MAAO,sBACP+C,KAAM;AAERikD,EAAUl/C,iBAAiB,QAASy+C,IACpCtoC,GAAc8oC,EAAiBC,GAC/B/oC,GAAcuE,GAAKukC,GAcnBE,GACA37B,GAASkG,KAAO5kB,GACC,YAAbjL,EAAKyf,KACPkK,GAAS5R,WAAW5R,iBAAiB,QAASk+C,IAEhD16B,GAASxjB,iBAAiB,QAAS2+C,IAEnCA,KU3GF,SAASS,GAAap8B,EAAMq8B,GAC1B,OAAOr8B,EAAKhX,IANd,SAAqBszC,EAAWC,EAAMziD,GACpC,OAAOyiD,EACLpnD,KAAKC,MAAME,OAAOsY,GAAO9T,GAAGmR,KAAKqxC,GAAW,IAAMvuC,KAIxBvR,KAAK,KAAM6/C,EAAKp2B,QAAQC,SAkBtD,SAASs2B,GAAenoD,GACtB,IAhBuBooD,EAKNC,EAYbD,EADM/lC,GAAeriB,GACF4a,iBAAiB,2BACpCytC,GAlBmBD,EAkBSA,EAjBzBjkC,MAAMC,UAAUsH,OAAOrH,KAAK+jC,EAAcL,GAC/C,CAAC,EAAG,EAAG,EAAG,EAAG;AAiBf,MAbO,CACLn9B,QAFey9B,EAcAA,GAZG,GAClBx9B,QAASw9B,EAAU,GACnBv9B,MAAOu9B,EAAU,GACjBt9B,OAAQs9B,EAAU,GAClBr9B,GAAIq9B,EAAU,IAWH,SAASC,KACtB,OAAO/qC,GACL,gDAAgDT,KAAKqrC,IClCzD,SAASI,GAAa3zC,GACpB,OAAIA,EACKiS,GAASjS,EAAG1T,aAEd,EAGM,SAASsnD,GAAe7oD,GACrC,IAAI8oD,EAAgBhpD,EAAe,cAAeE,GAC9C+oD,EAAiBjpD,EAAe,eAAgBE,GAChDgpD,EAAelpD,EAAe,aAAcE,GAC5CipD,EAAgBnpD,EAAe,cAAeE,GAC9CkpD,EAAYppD,EAAe,UAAWE;AAC1C,MAAO,CACLirB,OAAQ29B,GAAaE,GACrBA,cAAeA,EACf59B,QAAS09B,GAAaG,GACtBA,eAAgBA,EAChB59B,MAAOy9B,GAAaI,GACpBA,aAAcA,EACd59B,OAAQw9B,GAAaK,GACrBA,cAAeA,EACf59B,GAAIu9B,GAAaM,GACjBA,UAAWA,GVnBf,SAASC,GAAYl0C,EAAIm0C,EAAWC,GAClCp0C,EAAGoQ,UAAY,yBAA2BgE,GAAU+/B,GAAa,aACvD//B,GAAU+/B,EAAYC,GAAY,KAG9C,SAASb,GAAec,GACtBH,GAAYvE,GAAWkE,cAAelE,GAAW35B,OAAQq+B,EAAUr+B,QACnEk+B,GAAYvE,GAAWmE,eAAgBnE,GAAW15B,QAASo+B,EAAUp+B,SACrEi+B,GAAYvE,GAAWoE,aAAcpE,GAAWz5B,MAAOm+B,EAAUn+B,OACjEg+B,GAAYvE,GAAWqE,cAAerE,GAAWx5B,OAAQk+B,EAAUl+B,QACnE+9B,GAAYvE,GAAWsE,UAAWtE,GAAWv5B,GAAIi+B,EAAUj+B,IWX9C,SAASk+B,GAAYroC,GAsBlC,OApBgBA,EAAQ6K,OAAO,SAASC,EAAMC,EAAMnmB,GAClD,IAAI0jD,EAAOroD,KAAK8Y,MAAMnU,EAAI;AAG1B,OAFAkmB,EAAKw9B,GAAQ7iD,EAASqlB,EAAKw9B,GAAO,IAClCx9B,EAAKw9B,GAAM9iD,KAAKulB,GACTD,GACN,IAAID,OAAO,SAASC,EAAMC,EAAMnmB,GACjC,IAAI2jD,EAAWx9B,EAAKmL,KAAK,KACrBsyB,EAAehwC,GAAO5T,GACtBo/B,EAAKtmB,KACL+qC,EAAM9qC,GAAa,CACrBiH,UAAW,0BACXmM,QAAS,CAACC,OAAQ,kDAClB3wB,YAAa,QAAUmoD,EAAe;AAMxC,OAJAC,EAAI3gD,iBAAiB,QACnByhC,GAAoBjiC,KAAK,KAAMihD,IACjCtqC,GAAc+lB,EAAIykB,GAClBxqC,GAAc6M,EAAMkZ,GACblZ,GACNrN,MCvBL,SAASirC,GAAgBvpD,GAEvB,OAAOwoD,GADGnmC,GAAeriB,IAIZ,SAASwpD,GAAcC,GACpC,OAAOlsC,GAAUksC,GAAW3sC,KAAKysC,IXiBnC,SAASG,GAAYpqD,GAAI,OAAQA,EAAEmC,SAAS,WAQ5C,SAASkoD,GAAgBh+B,EAAMi+B,GAC7B,IAP+BA;AAY/B,GALcA,EAAWrvC,WAAWA,WAAWA,WAC5C8hB,gBAAgBA,gBAAgBA,gBAAgBA,gBACfrX,UAAUzb,MAAM,KAEjDqpB,OAAO82B,IACmBhkD,OAASgL,GAAoB,CACxD,IAEIm5C,EAAe,uEAFL,kCAAkCjzC,KAC9CgzC,EAAWrvC,WAAWM,MAAM;AAG9B8Q,EAAKtlB,MAjBwBujD,EAiBKA,EAhB7BrsC,GAgBessC,GAhBS1nC,KAAK,WAClCynC,EAAWnvC,UAAU5S,IAAI,eAiB3B,OAAO8jB,EAGT,SAASm+B,KACP,IAAIC,EAAc1a,GAChB;AACF,GAAK0a,EAAL,CACA,IAAIx3B,EAAMw3B,EAAYr+B,OAAOi+B,GAAiB;AAC9C9wC,EAAE2Z,KAAKpqB,MAAMyQ,EAAG0Z,GAAKpQ,KAAK,WACxB1f,SAASoY,KAAO,uCA0BpB,SAASmvC,GAAe1kC,GACtBA,EAAIrb,OAAOwQ,UAAU5S,IAAI;AACzB,IAAI2oC,EAAW5wC,SAASgb,iBAAiB;AACzCuJ,MAAMC,UAAUjI,QAAQkI,KAAKmsB,EAAU,SAASyZ,GAC9CT,GAAcS,EAAMpvC,MAAMsH,KA1B9B,SAAwB+nC,EAAaluC,GACnC,IAAImuC,EAAY,sFAGYnuC,EAAI4O,OAAS,8DAEb5O,EAAI6O,QAAU,qEAGd7O,EAAI8O,MAAQ,6DAEZ9O,EAAI+O,OAAS,kEAGb/O,EAAIgP,GAAK;AAKrC7qB,EAFsB+pD,EAAY3vC,WAAWA,WAC1C2K,uBACkCilC,IAOWhiD,KAAK,KAAM8hD,MAkE7D,SAASG,GAAYC,EAAWzpC,GAC9B,OAAIypC,EAAUzpC,GAAiBypC,EAAUzpC,GAAQI,MAC1C,EAOT,SAASspC,GAAW57B,EAAK27B,GACvB,IApBkBA,EAAWE,EAoBzBA,EAAU1xC,EAAE,IAAK6V,GAAK9tB,OACtBu+C,EAAKtmC,EAAE,KAAM6V,GAAKS;AACtBgwB,EAAGn/C,MAtBeqqD,EAsBCA,GAtBUE,EAsBCA,GApBrBtuB,GAAU,CAACF,WAAYsuB,EAAUE,GAASxuB,aAC/C,kBAAoB/kB,GAAS,mCAC7BqzC,EAAUE,GAAS7qD,GAAK,QAAU6qD,EAAU,aAC5CF,EAAUE,GAASvpC,MAAQ,IAExB,MAAQupC,EAAU;AAgBzB,IAAIC,EAAM3xC,EAAE,KAAM6V,GAAKE,GAAG,GAEtB67B,EADUD,EAAIxqD,OACIuJ,MAAM;AACP,EAAjBkhD,EAAQ/kD,QAAa+kD,EAAQn/B,KAXnC,SAAkB++B,EAAW9jD,EAAGC,GAC9B,OAAO4jD,GAAYC,EAAW7jD,GAAK4jD,GAAYC,EAAW9jD,IAUX4B,KAAK,KAAMkiD;AAC1D,IA1CsBK,EAElBzhC,EACAmtB,EACAuU,EACAC,EAqCAjkC,EAAW8jC,EAAQ73B,OAAO,SAASpyB,GACrC,MAAgB,WAATA,IAAgD,IAA3BA,EAAK8D,QAAQ;AAErB,EAAlBqiB,EAASjhB,QAAay5C,EAAGnxB,OAAOk7B,GAAYviC,IAChDw4B,EAAGnxB,OAAO,oCACRrH,EAASjhB,OAAS,WACpB+kD,EAAUA,EAAQ91C,IAAI,SAASnU,GAC7B,OAAK6pD,EAAU7pD,GACR,4CACL6pD,EAAU7pD,GAAMd,GAAK,KAAOc,EAAO,OAFPA,IAIhCgqD,EAAIxqD,KAAK,SAAWyqD,EAAQ1zB,KAAK,MAAQ,WArDnB2zB,EAsDP7xC,EAAE,KAAM6V,GAAKE,GAAG,GApD3B3F,EADM,uDACErS,KAAK8zC,EAAY9pD,QACzBw1C,EAAQ98B,GAAOhV,QAAQ2kB,EAAE,IACzB0hC,GAAU,IAAIvlD,MAAOkxC,eACrBsU,EAAY,IAAIxlD,MACVylD,WAAW5hC,EAAE,IACvB2hC,EAAUE,YAAY1U,GACtBwU,EAAUG,eAAeJ,GACzBC,EAAU3jB,YAAYhe,EAAE,IACxB2hC,EAAUI,cAAc/hC,EAAE,IAC1ByhC,EAAY18B,OAAO,0DACL48B,EAAUvmD,WAAWH,OAAO,EAAG,IAAM,WA6CrD,SAAS+mD,GAAa10B,GAEpBh2B,EAAK,uBAELsY,EAAE,6BAA6BqyC,IAAI,2BAChCpyC,KAAK,SAASrT,EAAGnG,GAChBgrD,GAAWhrD,EAAGi3B,KAGlB51B,EAAQ,uBAIK,SAASwqD,KApLxB,IACMx7C,EAyEAy7C,EA6BA77B;AA8EAtW,OACJglC,IAAa,GACV97B,KAAK8oC,KAtLJt7C,EAAgB6G,EAAS,mBAE3BqC,EAAE,6CAA6CsW,QAC5CnB,OAAO,wDACwBre,EAAgB,WAqEhDy7C,EAAgBnb,GAAS,mDAG3Bz5B,EAAS,6BAET9F,GAAqB8F,EAAS,sBACX40C,EAAcp4B,WAAWuR,YAAYA,YAC3C9pB,UAAU5S,IAAI,WAC3BujD,EAAcpmC,WAAa,mFAEzBtU,GAAqB,iIAGvBjR,EAAe,0BACZkJ,iBAAiB,QAASmhD,IAAwB,IAErDsB,EAAcpmC,WAAa,kGAG7BvlB,EAAe,mBACZkJ,iBAAiB,QAASqhD,IAER,2BAAjBxnD,EAAK89C,SACPwJ,MAMEv6B,EAAM1W,EAAE,wBACR+V,GAAG,GAAGS,KAAK,QAAS,OACxBE,EAAIX,GAAG,GAAGS,KAAK,QAAS,OACxBE,EAAIX,GAAG,GAAGS,KAAK,QAAS,OACxBE,EAAIX,GAAG,GAAGS,KAAK,QAAS,OY7HX,SAASgG,GAAM9uB,EAAGC,GAC/B,OAAID,EAAE+jB,cAAgB9jB,EAAE8jB,eAAwB,EAC5C/jB,EAAE+jB,cAAgB9jB,EAAE8jB,cAAuB,EACxC,ECDM,SAAS+gC,GAAoBrV,GAC1C,GAA8C,kBAA1C/6B,OAAOmJ,UAAU/f,SAASggB,KAAK2xB,KAC9B1oB,MAAM0oB,EAAMsV,WAOf,OANWtV,EAAMM,cAAcjyC,WAMjB,IALJsxC,GAAKK,EAAMS,WAAa,GAKR,IAJjBd,GAAKK,EAAMO,WAIiB,IAH5BZ,GAAKK,EAAMU,YAG4B,IAFvCf,GAAKK,EAAMW,cAEuC,IADlDhB,GAAKK,EAAMuV,cZkBxB,SAASC,GAAOzhC,GACd,OAAIvqB,EAAYuqB,GAAc,OACvBA,EAAI0hC,iBA2Bb,SAASC,KACP,OAAOzwC,OAAOiB,KAAK0oC,IAAWl5B,OAAO,SAASigC,EAASC,GACrD,OA1BkBA,EA0BDA,EAzBZnH,IAA2B,YAAdA,IAA2BA,KAAcmH,EAyBtBD,EAC9BA,EACL/G,GAAUgH,GAAWlgC,QAxBGkgC,EAwByBA,EAvB9C,SAASC,EAAQC,GACtB,OAAOD,EAAS,WAEdR,GAAoB,IAAIjmD,KAAqB,IAAhB0mD,EAAStrC,MACtC,YACSorC,EAAY,6BACKJ,GAAOM,EAASxrC,KAAQ,6BACxBkrC,GAAOM,EAASrrC,KAAO,6BACvB+qC,GAAOM,EAASzrC,KAAQ,6BACxBmrC,GAAOM,EAASvrC,KAAQ,6BAEhDzf,KAAK8Y,MAAMkyC,EAASzrC,IAAOyrC,EAASvrC,IAAO,KAC7C,6BAC0BurC,EAAS1rC,IAAO,6BAChBorC,GAAOM,EAASprC,KAAQ,eASW;AA5BnE,IAAsBkrC,EAIQA,GAyBzB,IAGL,SAASG,KACHnH,KAAYJ,GAAQx/B,UAAY0mC,MACpChH,GAAOjqC,UAAU6d,OAAO,cAG1B,SAAS0zB,KACPtH,GAAOjqC,UAAU5S,IAAI,cACrBA,EAAI,EAAGkkD,IAGT,SAASE,GAAS3sD,GAChBmlD,GAAYnlD,EAAE2K,OAAOpJ,MACrBmrD,KAGK,SAASE,GAAUC,GA5D1B,IAAsBC;AA6DhBD,IACFvH,GAAYuH,EACZxH,GAAa3/B,WA/DKonC,EA+DoBD,EA9DjC,0EAELlxC,OAAOiB,KAAKkwC,GAAY9gC,KAAK+J,IAAO3J,OAAO,SAASC,EAAM/K,GACxD,OAAO+K,EAAO,kBAAoB/K,EAAS,KAAOA,EAAS,aAC1D,IAAM,aA2DTorC,MAIG,SAASK,KACd,IAAIC,EAAKpuC,GAAY,CAACxe,GAAI,OACtB6sD,EAAOD,EAAGE,cAAc/2B,WAAW;AACvCt1B,EAAoBosD,EAAM;AAE1B,IAAIE,EvIlBG7uC,GAAS,KuIkBU,CAAC1c,YAAa;AAcxC,OAZA4d,GAAc2tC,EADd9H,GAAe3mC,MAEfc,GAAcytC,EAAME,GAEpBtsD,EAAoBosD,EAAM,+HAK1BztC,GAAcwtC,EADd9H,GAAUrmC,MAEVmuC,EAAG3jD,iBAAiB,SAAUsjD,IAE9BntC,GADA4lC,GAAS1mC,GAAU,CAACyH,UAAW,wBACT6mC,GACf5H,GC1FT,SAASgI,GAAYzH,GACnBJ,GAAOhkD,MAAQokD,EACfD,GAAGvqC,UAAU6d,OAAO,cAUtB,SAASq0B,KACP9H,GAAOhkD,MAAQ,mCAGjB,SAAS+rD,KACP,IAAIC,EAAUp2C,GAAUouC,GAAOhkD;AAC/Bmf,GAAU,oBAAqB6sC,GAC5B1qC,KAAK,WACJtJ,EAAE,eAAejY,KAAK,qBAAqBgb,OAAO,QAClDswC,GAAUW,EAAQhsC,WAEnBisC,KAAK,SAAS9xC,GACbnC,EAAE,eAAejY,KAAKoa,GAAKY,OAAO,UAIxC,SAASmxC,GAAansD,EAAMkH,GAC1B,IAAIwhD,EAAM9qC,GAAa,CACrBiH,UAAW,eACXvkB,YAAaN;AAGf,OADA0oD,EAAI3gD,iBAAiB,QAASb,GACvBwhD,EAGF,SAAS0D,KxIgBT,IAAwBnvC;AwIH7B,OAZAmnC,GAAKhnC,GAAU,CAACte,GAAI,KAAM+lB,UAAW,kBACrCo/B,GxIeOjnC,GAAS,WAAYC,IwIdrBiI,aAAa,iBAAkB,OACtC++B,GAAO/+B,aAAa,eAAgB,OACpC++B,GAAO/+B,aAAa,cAAe,OACnC++B,GAAO/+B,aAAa,aAAc,SAClCg/B,GAAUiI,GAAa,OAAQH,IAC/B7H,GAAWgI,GAAa,QAASJ,IACjC7tC,GAAckmC,GAAIH,IAClB/lC,GAAckmC,GAAIvmC,MAClBK,GAAckmC,GAAIF,IAClBhmC,GAAckmC,GAAID,IACXC,GC7CT,SAASiI,KACP,OAAQ/H,GAAQ5qB,QAWlB,SAAS4yB,GAAe5nC,GAPf4/B,GAAQ5qB,SAQc,WAAbhV,EAAIygB,OAJpBmf,GAAQ5qB,SAAU,GAuBpB,SAAS6yB,KDhCF,IAAsBlI;ACiC3BG,GAAQt7C,oBAAoB,SAAUqjD,IAClClI,KDlCuBA,ECkCIA,MDhC7BD,GAAGvqC,UAAU5S,IAAI,cACjBA,EAAI,EAAG6kD,GAAa,CAACzH,KCoDzB,SAASmI,KACP,IAlBIC,EAkBA13B,GAlBA03B,EAAcrvC,GAAU,CAC1ByH,UAAW,+EAEXT,UAAW,mFAGbogC,GAAUzmC,GAAY,CACpB8G,UAAW,eACX/lB,GAAI,UACJc,KAAM,UACNoD,KAAM,WAEA+E,iBAAiB,SAAUwkD,IACnCruC,GAAcuuC,EAAajI,IACpBiI,GAKHC,EAtCGhvC,GAAS,CACdmH,UAAW,wFAEXT,UAAW;AAoCblG,GAAc6W,EAAK23B;AACnB,IAAIC,EAAYvvC,GAAU,CAACyH,UAAW;AACtC3G,GAAcyuC,EAAWlB,MACzBvtC,GAAcyuC,EAAWP,MACzBluC,GAAc6W,EAAK43B,GACnBxjD,EAAUujD,EAAK33B,GACf7W,GAAcqmC,GAAUxvB,GAU1B,SAAS3T,GAAY9a,GACfA,IACF+9C,GAAcxwC,KAAKC,UAAUxN,GAC7BglD,GAAUhlD,EAAK2Z,UAInB,SAASs5B,GAAW70B,GACI,+BAAlBA,EAAIrb,OAAOvK,IACb8jB,GAAS,8BACNhN,EAAS,+BAIhB,SAASg3C,KACPpyC,GAAU,qBAAqB+G,KAAKH,IACpCkjC,GAAQp7C,oBAAoB,SAAU0jD,IACtChrD,EAAK2vC,eAAiB8a,GAvBtB9sD,EAAoBglD,GAClB,iGAwBFiI,KAGa,SAASK,KACtB,IAAIC,EAAK9tD,SAASy+B,cAAc,iCAC5BsvB,EAAQD,EAAGnzC,WAAWA,WACtBqzC,EAAQxvC,KACRyvC,EAAUD,EAAMrvB,YAAY,GAC5BuvB,EAAUF,EAAMrvB,YAAY;AAChCzf,GAAc+uC,EAASH,GACvBI,EAAQ9oC,UAAY6S,GAAmB,8BACrC,+DACF+1B,EAAMjlD,iBAAiB,SAAUwxC,IACjCwT,EAAMpzC,WAAWwzC,aAAaH,EAAOD,IACrCzI,GAAUvmC,GAAY,CACpBjf,GAAI,UACJ+lB,UAAW,kBACX7hB,KAAM,cAEA+E,iBAAiB,SAAU6kD,IAEnC1uC,GADAqmC,GAAWnnC,GAAU,CAACyH,UAAW,eACTy/B,IACxBtlD,SAASiK,KAAKlB,iBAAiB,UAAWukD,IAC1CpuC,GAAclf,SAASiK,KAAMs7C,IWvIhB,SAAS6I,GAAgB1oC,GACtC,IAAI2oC,EAAW3oC,EAAIrb,OAAOmhB,aAAa,UACnC8iC,EAASzuD,EAAewuD,GACxBE,EAAoBD,EAAOzzC,UAAU+Q,SAAS;AAClD0iC,EAAOzzC,UAAUwd,OAAO,WAEtBzU,GAASyqC,EADPE,EACiB,GAEA,MCXR,SAASC,GAAiBtnC,EAASunC,GAChD,IACIrM,EAAUl7B,EAAQlkB,QAAQ,KAAM,IAAIzB,MAAMktD;AAM9C,OALIrM,EACO79C,SAAS69C,EAAQ,GAAI,IAErB,ECFN,SAASsM,KACd1uD,SAASy+B,cAAc,kCACpB+gB,gBAAgB,SAGd,SAASmP,KACd,IAAIC,EAAS5uD,SACVy+B,cAAc;AACjB,GAAKmwB,EAAL,CACA,IAAIC,EAAkBD,EAAO58B,QAAQC,OACjC68B,EAAWN,GAAiBK,EAC9B,qBACEE,EAAWP,GAAiBK,EAC9B;AACEE,EAAWD,GACbvuD,EAAoBquD,EAAOj0C,WAAW+M,mBACpC,QAAU0B,GAAU0lC,EAAWC,GAAY,UZ4BjD,SAASC,GAAgBlyB,EAAcC,GACrC,IATuBh9B,EAAKwgC,EAAS0uB,EACjCC,EAQAnvD,EAAM0iB,GAAeqa,GACrBv6B,EAAO8tC,GAAS,4BAA6BtwC,GAC7CwgC,EAAUh8B,SAAS8rC,GAAS,wBAC9BtwC,GAAKkB,MAAO,IACVu/B,EAAUj+B,EAAK6iB,UAAU7jB,MAAM;AAbZxB,EAcPA,EAdYwgC,EAcPA,EAdgB0uB,EAcPlyB,EAAS9kB,MAbnCi3C,EAAgB7e,GAClB,wDAAyDtwC,KACV,EAA5BmvD,EAAcz8B,KAAK3sB,QAtB1C,SAAqBopD,EAAe3uB,EAAS0uB,GAC3C,GAAgB,IAAZ1uB,EAAe,CACjB,IAAInd,EAAU6rC,EAAWp5B,UAAUo5B,EAAWx8B,KAAK3sB,OAAS;AAC5Dsd,EAAQub,WAAW,GACnBvb,EAAQub,WAAW,GACnBvb,EAAQsP,MAAM,GAAGtN,UACf,sEACFhC,EAAQsP,MAAM,GAAGtN,UAAY,QAE/B,IAAK,IAAIvf,EAAI,EAAGA,GAAKqpD,EAAcz8B,KAAK3sB,OAAS,EAAGD,GAAK,EAAG,CAC1D,IAAI+vB,EAASq5B,EAAWp5B,UAAUo5B,EAAWx8B,KAAK3sB,OAAS;AAC3D8vB,EAAO+I,WAAW,GAClB/I,EAAO+I,WAAW,GAClB/I,EAAOlD,MAAM,GAAGtN,UAAY8pC,EAAcz8B,KAAK5sB,GAAG6sB,MAAM,GAAGtN,UAC3DwQ,EAAOlD,MAAM,GAAGtN,UAAY,MAAQ8pC,EAAcz8B,KAAK5sB,GAAG6sB,MAAM,GAC7DtN,UAAY,QAQf+pC,CAAYD,EAAe3uB,EAAS0uB,GAWlCzuB,GAAWj8B,SAASi8B,EAAQ,GAAI,IAAMD,GACxC5iB,GAAU,0DACP4iB,EAAU,GAAG97B,YACd8d,KAAK,SAASniB,GACd4uD,GAAgB5uD,EAAM,CAAC6X,KAAM8kB,EAAS9kB,SAK5C,SAASm3C,KACP,IAAIC,EAAW5J,GAAwBhzB,KAAK,GAAGC,MAAM,GAClDU,WAAWuR;AACV0qB,GACF1xC,GAAU,oDACP4E,KAAK,SAASjb,GACb0nD,GAAgB1nD,EACd,CAAC2Q,KAAMo3C,MAKjB,SAASC,KAEP/uD,EADqBklD,GAAwBhzB,KAAK,GAAGC,MAAM,GAAGU,WAC1B;AAGpC,IAAIm8B,EAAmB9J,GAAwBhzB,KAAK,GAAGC,MAAM,GAC1DU,WAAWuR;AAEV/tB,EADJ24C,EAAiBzvD,GAAK,qBAEpByvD,EAAiB10C,UAAU5S,IAAI,WAEjCpI,EAAe,0BACZkJ,iBAAiB,QAASqlD,IAG/B,SAASoB,KAEPjvD,EADqBklD,GAAwBhzB,KAAK,GAAGC,MAAM,GAAGU,WAC1B;AAIpC,IAAIq8B,EAA2BhK,GAAwBhzB,KAAK,GAAGC,MAAM,GAClEU,WAAWuR;AAEV/tB,EADJ64C,EAAyB3vD,GAAK,sBAE5B2vD,EAAyB50C,UAAU5S,IAAI,WAEzCpI,EAAe,2BACZkJ,iBAAiB,QAASqlD,IAG/B,SAASsB,KAEPnvD,EADgBklD,GAAwBhzB,KAAK,IAAIC,MAAM,GAAGU,WAC3B;AAG/B,IAAIu8B,EAA+BlK,GAAwBhzB,KAAK,IAC7DC,MAAM,GAAGU,WAAWuR;AAEnB/tB,EADJ+4C,EAA6B7vD,GAAK,0BAEhC6vD,EAA6B90C,UAAU5S,IAAI,WAE7CpI,EAAe,+BACZkJ,iBAAiB,QAASqlD,IAG/B,SAASwB,KAEP,IADA,IAAI/zB,EAAQh7B,YAAYC,MAAQ,EACzB86B,GAASC,EAAO6pB,GAAUzkC,KAC/B1gB,EAAoB0gB,GAAQykC,IAAU/qC,WACpC,uCACF+qC,IAAY;AAEVA,GAAWzkC,GAAQnb,QACrBmC,EAAI,EAAG2nD,IAIX,SAASC,KAEPnK,GAAW,EACXzkC,GAAUjhB,SAASgb,iBACjB,oDACF/S,EAAI,EAAG2nD,IACPnsC,GAAI1a,iBAAiB,QAAS,SAAS2c,GACR,cAAzBA,EAAIrb,OAAOwb,WACf2kB,GAAoB9kB,EAAIrb,OAAOib,uBAAuBtkB,QAI1D,SAAS8uD,KAEP,IAAIC,EAAQtK,GAAwB38B,qBAAqB;AAEzDvoB,EADiBwvD,EAAMA,EAAMjqD,OAAS,GAAG6U,WAEvC,yEACUkO,KACV,uEa5HJ,SAASmnC,GAAOh7C,GACd,IC3B+Bsf,ED2B3B27B,EAAQj7C,EAAG2F,WAAW2K,uBAAuBA,uBAC9CkN,kBAAkBvxB,OC5BUqzB,ED6BtB27B,EC5BFryC,GAAQ,CACbyE,IAAK,QACLC,OAAQ,YACRo+B,QAAS,WACTwP,cAAe57B,IACdpX,KAAKob,KDuBQ/V,KAXlB,SAAoBoD,EAAMre,GACT,IAAXA,EAAK0a,IACP2D,EAAK65B,gBAAgB,SACrB75B,EAAKE,UAAY,WACjBF,EAAKrkB,YAAc,UAOWiH,KAAK,KAAMyM,IAC3CA,EAAG1T,YAAc,GACjB0T,EAAG6Q,UAAY,kBACf7Q,EAAGpL,MAAM4b,gBAAkB,QAAWjO,GACpC,sBAGJ,SAAS44C,GAAQzwD,GACf,IAzBI0wD,EAyBAzqC,EAAOjmB,EAAE2K;AACM,cAAfsb,EAAK1kB,QA1BLmvD,EAAQpwD,SAASgb,iBAAiB,iCACtCuJ,MAAMC,UAAUjI,QAAQkI,KAAK2rC,EAAO,SAASp7C,GAC3CA,EAAG6pB,WAyBkB,aAAnBlZ,EAAKE,WAA2BmqC,GAAOrqC,GAG7C,SAAS0qC,KACP,IAAI7iC,EAAW/J,GAAIqF,qBAAqB;AAClB,EAAlB0E,EAAS1nB,QAxCf,SAAqB2sB,GACnB,IAAK,IAAI5sB,EAAI,EAAGA,EAAI4sB,EAAK3sB,OAAS,EAAGD,GAAK,EACxCtF,EAAoBkyB,EAAK5sB,GAAG6sB,MAAM,GAChC,+CAsCF49B,CAAY9iC,EAASA,EAAS1nB,OAAS,GAAG2sB,MAY/B,SAAS89B,KARxB,IACMC,EACAC;AAOJhtC,GAAI1a,iBAAiB,QAASonD,IAC9BE,KATIG,EAAWzxC,GAAY,CAAC/a,KAAM,SAAU/C,MAAO,cAE3B,KADpBwvD,EAAWhtC,GAAIqF,qBAAqB,SAC3BhjB,QACXoZ,GAAcuxC,EAAS,GAAGnrC,uBAAuBoN,MAAM,GAAI89B,GZnC/D,IAAIE,GAAa,CACfC,gBAAiB,EACjBC,oCAAqC,EACrCC,mBAAoB,EACpBC,2BAA4B,EAC5BC,mBAAoB,EACpBC,oBAAqB,GACrBC,aAAc,GACdC,0BAA2B,GAC3BC,cAAe,GACfC,mBAAoB;AAoBtB,SAASC,KACUxxD,EAAe,qBACrBgb,UAAU5S,IAAI;AACzB,IAAI2oC,EAAW5wC,SAASgb,iBAAiB;AACzCuJ,MAAMC,UAAUjI,QAAQkI,KAAKmsB,EAAU,SAAS0d,GAC9C,IAAIgD,EAAahD,EAAO3zC,WAAWA,WAAW2K;AAG9C3H,GAFW,2BAA2B3G,KAAKs3C,EACxC9iC,aAAa,YAAY,IACZjJ,KAzBpB,SAAuB+nC,EAAaxtB,GAElC,IAAI/8B,EAAM0iB,GAAeqa,GACrBy0B,EAAaxxD,EAAIib,iBACnB,uCACEoc,EAAQ;AACZ7S,MAAMC,UAAUjI,QAAQkI,KAAK8sC,EAAY,SAASC,GAChD,IAAIC,EAAWD,EAAS9pC,mBAAmBpmB,YAAY4+B;AAErD9I,GADEq6B,KAAYf,GACLA,GAAWe,GACL;AAEnB,IAAIC,EAAU3xD,EAAI0+B,cAAc,+BAA+Bx9B;AAC/DsiB,GAAqB+mC,EAAa,0BAChCppD,KAAKC,MAAM,GAAKi2B,GAAS,GAAK,UAAYs6B,EAAU,eAWjBnpD,KAAK,KAAM+oD,MAoBlD,SAASK,GAAejsC,EAAKyE,GAC3B,IAAIynC,EAAc,0BACf56C,KAAK0O,EAAIrb,OAAOmhB,aAAa,YAAY,GACxCqmC,EAAcnsC,EAAIrb,OAAOsQ,WAAWA,WAAWA,WAC/Cm3C,EAAiBD,EAAYvV,SAC7ByV,EAAeD,GAdP,OAc2C3nC,GAd5B,EACpB,GAcH6nC,EAAcH,EAAYl3C;AAC9B,GAvBmBm3C,EAuBHA,EAvBmBC,EAuBHA,EAvBiBC,EAuBHA,IAtBvClM,IAAgB5kD,KAAK8hB,IAAI8uC,EAAgBC,IAC9CA,EAAe,GACfA,EAAeC,EAAYv/B,KAAK3sB,QAoBlC,CAvBF,IAAqBgsD,EAAgBC,EAAcC;AAwBjDr0C,GAAUi0C;AACV,IAAIK,EAAYD,EAAYv/B,KAAKs/B;AACjCC,EAAY1uC,aAAauuC,EAAaI;AACtC,IAAIC,EAfQ,OAee/nC,GAfA,GACpB;AAeProB,OAAOqwD,SAAS,EAAGD,GACnBxsC,EAAIke,mBAGN,SAAShzB,GAAoB8U,GAC3B,IAAIyE,EAAMzE,EAAIrb,OAAOmhB,aAAa;AACtB,OAARrB,GAAwB,SAARA,GAAiBwnC,GAAejsC,EAAKyE,GAG3D,SAASioC,KAEP,IAAIC,EAAaryD,SAASy+B,cAAc;AACxC,GAAI4zB,EAAY,CACd,IAAIC,EAAevzC,GAAY,CAC7Bjf,GAAI,oBACJ+lB,UAAW,eACX7hB,KAAM,SACN/C,MAAO;AAETqxD,EAAavpD,iBAAiB,QAASsoD;AACvC,IAAIkB,EAAQF,EAAW13C,WAAWA;AAClCpa,EAAoBgyD,EAAO,UAC3BrzC,GAAcqzC,EAAOD,GAEnB17C,EAAS,wBACX6M,GAAI1a,iBAAiB,QACnB6H,IAAqB,GAU3B,SAAS4hD,GAAWC,EAAUC,GACxBxwC,GAAMwwC,KACCA,IAPM/M,KACfG,GAAeD,IAOftlD,EAAoBkyD,EAAU,4BAC5BvwC,GAAMwwC,GAAUv7B,KAAK,MAAQ,YASnC,SAASw7B,GAAa39C,GACpB,IANmBy9C,EAMfA,EAAWz9C,EAAGwd;AAElBggC,GAAWC,GARQA,EAOQA,EANT,IAAd5M,GAAyB,gBACtB4M,EAASnxD,cASlB,SAASsxD,KAEP,IADA,IAAI/2B,EAAQh7B,YAAYC,MAAQ,GACzB86B,GAASC,EAAOgqB,GAAWD,KAAU,CAG1C+M,GAFS/M,GAAQC,KAIjBA,IAAa,EAEXA,GAAYD,GAAQ9/C,QACtBmC,EAAI,EAAG2qD,IAWX,SAASC,GAAShV,GAChB37B,GAAQ7G,OAAOiB,KAAKuhC,GAAW/xB,OAAO,SAASC,EAAMC,GACnD,GAAa,eAATA,EAAuB,CACzB,IAAI0mC,EAAW7U,EAAU7xB,GAAMgzB;AAC/BjzB,EAAK2mC,GAAY3mC,EAAK2mC,IAAa,GACnC3mC,EAAK2mC,GAAUjsD,KAAKulB,GAEtB,OAAOD,GACN,IACH45B,GAAS9H,EAAUh1B,MAAcm2B,WACjC4G,GAjBF,WACE,IAAIkN,EAAarvC,GAAImF,iBAAiBtD;AACtC,GAAIwtC,EAAWrgC,MAAiC,EAAzBqgC,EAAWrgC,KAAK3sB,OACrC,OAAOgtD,EAAWrgC,KAAK,GAAGD,kBAAkBA,kBAAkBC,KActDsgC,MAERlN,GAAY,EACZ59C,EAAI,EAAG2qD,KcpLJ,ICKI91C,GACAvK,GACA4B,GACA6+C,GDRAC,GAAiB,CAC1BC,gBAAiB,CACfC,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,IAAO,EACPC,IAAO,EACPC,IAAO,EACP7hB,IAAO,EACP8hB,IAAO,EACPC,IAAO,EACP9hB,IAAO,GAETwP,UAAW,EACXC,UAAW,MAEFsS,GACT,4iGA0ESC,GAAoB,CAC7Bf,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAK,EACLQ,EAAK,EACLC,GAAM,EACNC,GAAM,EACNC,GAAM,EACNC,GAAM,EACNC,GAAM,EACNC,GAAM,EACNC,GAAM,EACNd,IAAO,EACPC,IAAO,EACPC,IAAO,EACP7hB,IAAO,EACP8hB,IAAO,EACPC,IAAO,EACP9hB,IAAO,GAEEyiB,GAAW,CAAC,SAAU,QAAS,SAAU,QAAS,SAAU,SACrE,OAAQ,SAAU,OAAQ,aAAc,SAAU,YAClD,WAAY,SAAU,YAAa,WAAY,cACtCC,GAAY,CACrBC,QAAS,CAACC,KAAM,OAAQv7C,OAAQ,UAAWmW,MAAO,GAClDqlC,UAAW,CAACD,KAAM,MAAOv7C,OAAQ,UAAWmW,MAAO,GACnDslC,YAAa,CAACF,KAAM,KAAMv7C,OAAQ,UAAWmW,MAAO,GACpDulC,KAAM,CAACH,KAAM,OAAQv7C,OAAQ,UAAWmW,MAAO,GAC/CwlC,QAAS,CAACJ,KAAM,MAAOv7C,OAAQ,UAAWmW,MAAO,GACjDylC,KAAM,CAACL,KAAM,OAAQv7C,OAAQ,UAAWmW,MAAO,GAC/C0lC,YAAa,CAACN,KAAM,MAAOv7C,OAAQ,UAAWmW,MAAO,GACrD2lC,UAAW,CAACP,KAAM,MAAOv7C,OAAQ,UAAWmW,MAAO;AC5H9C,SAAS4lC,GAAYhuD,GAC1B0rD,GAAS1rD,EAGJ,SAASiuD,GAAcjuD,GAE5B6U,GADAW,GAAUX,GAAO,GAAI82C,IACLvsD,EAASY,EAAM,KAC/BiL,GAAqBqE,EAAS,sBAC9BzC,GAAqByC,EAAS,sBChBjB,SAAS4+C,GAAY1c,GAClC,OAAI8b,GAAU9b,GAAgB8b,GAAU9b,GAAOgc,KACxC,GCWM,SAASjmC,GAAWC,EAAKxnB,GACtC,IANmBA,EAMfiS,GANejS,EAMMA,GALhBqtB,UAAgCrtB,EAVhCg0C,SAAkB,WACpB,WAIiB,IAMHh0C,EANZ+tB,UAA0B,UAC5B;AAUPvG,EAAIjU,UAAU5S,IAAIsR,GCdpB,SAASk8C,GAAS3mC,GAChB,MAAO,2CACLA,EAAI0F,OAAS,eACb9tB,EAASooB,EAAIuG,UAAW29B,GAAO39B,WAC/B,uCAGJ,SAASqgC,GAAQ5mC,GACf,MAAO,0CACLA,EAAI0F,OAAS,cAGjB,SAASmhC,GAAc3xD,EAAM8qB,EAAK5mB,GAChC,MAAa,YAATlE,EACKkE,EAAG4mB,GAEL,KCRT,IAAI8mC,GAAY,CACd,CACE7vD,KAAM,SAAS+oB,GAAM,OAAOA,EAAIuG,YAAgC,IAAnBvG,EAAIuG,WACjDH,IAAK,SAASpG,EAAKtO,GACjB,MAAO,qBAAuBA,EAAI7Z,IAGtC,CACEZ,KAAM,SAAS+oB,GACb,OAAOA,EAAIuG,WACTvG,EAAIuG,YAAc29B,GAAO6C,mBAE7B3gC,IAAK,SAASpG,EAAKtO,GACjB,MAAO,yBAA2BsO,EAAIuG,UACpC,sBAAwB7U,EAAI7Z,IAGlC,CACEZ,KAAM,SAAS+oB,GACb,OA5BsBA,EA4BIA,GA3BnB6F,YAAc7F,EAAIwsB,WAGHxsB,EAwB+BA,GAvB9CuG,YAAcvG,EAAIwsB,UAC3BxsB,EAAIuG,YAAc29B,GAAO6C;AAF7B,IAA4B/mC,EAJAA,GA8BxBoG,IAAK,SAASpG,EAAKtO,GAAM,OAAOA,EAAIs1C;AAIxC,SAASC,GAASjnC,EAAKtO,GACrB,IAAK,IAAI3a,EAAI,EAAGA,EAAI+vD,GAAU9vD,OAAQD,GAAK,EACzC,GAAI+vD,GAAU/vD,GAAGE,KAAK+oB,GACpB,MAAO,wBAA0B8mC,GAAU/vD,GAAGqvB,IAAIpG,EAAKtO,GACrD,YAAcsO,EAAI0F,OAAS,KAAOhU,EAAI5Z,EAAI;AAGhD,MAAO,GCzCM,SAASovD,GAAUlnC,GAChC,OAAOpoB,EAASooB,EAAI6F,UAAW7F,EAAIuG,WCDtB,SAASxM,GAAWg2B,GACjC,OAAKj8C,EAAKi7C,UAAUgB,GACbj8C,EAAKi7C,UAAUgB,GAAG5U,SADO,MCHnB,SAASgsB,GAAW9rC,EAAKpkB,GACtC,OAAIokB,IAAQpkB,EAAc,YACnB,GCcT,IAAImwD,GAAU,CACZ,CAAC32C,MAAO,OAAQjY,KAAM,YAAa6uD,OC2BtB,SAAoB7uD,EAAMtD,EAAM8qB,GAC7C,MAAa,YAAT9qB,EAA4BsD,EA1BlC,SAA2BA,EAAMwnB,GAC/B,IAXcsnC,EAAWC,EAAWC,EAWhC71C,EAAM/Z,EAASssD,GAAO39B,UACxB29B,GAAO6C,mBACLl2D,GAjBe,IAiBNmvB,EAAIuG,UAjBa,EACvB,EAiBHkhC,GAdUH,EAcCpD,GAAO39B,UAdGghC,EAcQvnC,EAAIuG,UAdDihC,EAelCtD,GAAOhV,SAdLoY,KACe,IAAfC,EAA0BA,EACvBC,IAcHE,EAAOlvD;AACPwnB,EAAIwsB,WAAWkb,EAAO,MAAQlvD,EAAO;AAEzC,IAdmBwnB,EAcf2nC,EAAW;AAMf,OApBmB3nC,EAeHA,GAdL4nC,OAAgC,KAAvB5nC,EAAI4nC,MAAMC,WAe5BF,EAAW,wCAA0C3nC,EAAI4nC,MAAMC,SAC7D,iBAGG,8CAAgDrvD,EACrD,mCACAgS,GAAOwV,EAAIxV,QAAQE,KAAO,wCACcsV,EAAIgG,QAC5C,WAAahG,EAAI0F,OAAS,MAAQ70B,EAAI,MAAQ42D,EAC9C,oBAAsB91C,EAAM,KAC5B+1C,EAAO,OAASC,EAKXG,CAAkBtvD,EAAMwnB,KD5B/B,CAACvP,MAAO,QAASjY,KAAM,mBACvB,CACEiY,MAAO,QACPjY,KAAM0uD,GACNG,OAAQ,CACNU,EEhBS,SAAqBvvD,EAAMtD,EAAM8qB,GAC9C,OAAIA,EAAI6F,WANqB7F,EAOEA,GANvBwsB,UAAmB,EACpBxsB,EAAI6F,WAOY,IAAnB7F,EAAIuG,UAA0B,IAC3BxM,GAAWiG,EAAIuG;AAVxB,IAA+BvG,GFsBzB9G,QGdS,SAA4B1gB,EAAMtD,EAAM8qB,GACrD,GAAIA,EAAIuG,UACN,OAPqB,KADQvG,EAQEA,GAPzBuG,UAA0B,KAC3B,8DACLvG,EAAIuG,UAAY,KAAOxM,GAAWiG,EAAIuG,WAAa;AAHvD,IAAiCvG;AAU/B,GAAIA,EAAIwsB,SAAW,MAAO;AAC1B,IAAIwb,EAAe,yCAA2ChoC,EAAI0F,OAChE;AASF,OARgBnZ,OAAOiB,KAAK02C,GAAOvY,SAChC/uB,KAAK,SAAS/kB,EAAGC,GAAI,OAAOD,EAAIC,IACzB2V,QAAQ,SAAStb,GACzB61D,GAAgB,kBAAoB71D,EAAQ,IAC1Cg1D,GAAW50D,OAAOJ,GAAQ6tB,EAAI6F,WAAa,IAC3Cq+B,GAAOvY,QAAQx5C,GAAS,cAE5B61D,GAAgB,aHCZ9jC,OIjBS,SAA2B1rB,EAAMtD,EAAM8qB,GACpD,OAAIA,EAAIuG,WALe,KADOvG,EAOEA,GANxBuG,UAA0B,KAC3BxM,GAAWiG,EAAIuG,WAOlBvG,EAAIwsB,SAAkB,OACnB0X,GAAOvY,QAAQ3rB,EAAI6F;AAV5B,IAAgC7F,KJyB9B,CACEvP,MAAO,OACPjY,KAAM,OACN6uD,OAAQ,SAASnyD,GAAO,OAAO2wD,GAAS3wD,KAE1C,CAACub,MAAO,MAAOjY,KAAM,gBACrB,CAACiY,MAAO,MAAOjY,KAAM,iBACrB,CAACiY,MAAO,MAAOjY,KAAM,eACrB,CAACiY,MAAO,MAAOjY,KAAM,gBACrB,CAACiY,MAAO,KAAMjY,KAAM,YACpB,CAACiY,MAAO,MAAOjY,KAAM,SACrB,CACEiY,MAAO,QACPjY,KAAM,QACN6uD,OAAQ,CACNU,EAAG,SAAS/d,GACV,OAAI8b,GAAU9b,GACL8b,GAAU9b,GAAOppB,MAEnB,GAET1H,QAASwtC,GACTxiC,OAAQwiC,KAGZ,CAACj2C,MAAO,MAAOjY,KAAM,aAAc6uD,OKrDtB,SAA0B7uD,EAAMtD,EAAM8qB,GACnD,GAAuC,EAAnCvqB,SAASuqB,EAAIioC,eAAgB,IAC/B,OAAO71D,KAAK+hB,KAAK6L,EAAIkoC,WAAaloC,EAAIioC,eAAiB,OLoDzD,CAACx3C,MAAO,KAAMjY,KAAM0uD,GAAWG,OMzClB,SAAkBh2D,EAAO6D,EAAM8qB,GAX9C,IAA6BA;AAY3B,IAAIA,EAAI6F,WAAa7F,EAAIuG,YACvB29B,GAAO6C,kBACT,OAd2B/mC,EAcAA,EAbd,YAaQ9qB,EAbW,MACT,IAAnB8qB,EAAIuG,UACC,yCAA2CvG,EAAI0F,OACpD,4BAEG,2CAA6C1F,EAAI0F,OACtD,eAAiB1F,EAAIuG,UACrB,yCN6CF,CAAC9V,MAAO,KAAMjY,KAAM0uD,GAAWG,OLjBlB,SAAkBc,EAAOjzD,EAAM8qB,GAC5C,OAjBqBA,EAQJA,EASHA,GAhBHuG,YAAgC,IAAnBvG,EAAIuG,YAGZvG,EAKsBA,GAJ3B6F,YAAgC,IAAnB7F,EAAIooC,UAYAvB,GAAc3xD,EAAM8qB,EAAK2mC,KALrC3mC,EAMHA,GALF6F,YAAc7F,EAAIqoC,MAKFxB,GAAc3xD,EAAM8qB,EAAK4mC,SAApD;AAVF,IAAmB5mC,EAJDA,EAJKA,EAYLA,IKsBhB,CAACvP,MAAO,MAAOjY,KAAM,OAAQ6uD,OJVhB,SAAuB7uD,EAAM8vD,EAAOtoC,GAGjD,IAAI0e,EAAS,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAC,CAAI,EAAG,EAAC,CAAA,CAAA,CAAQ,GAAGlmC;AAC1D,OAAe,IAAXkmC,EACKuoB,GAASjnC,EAAK,CACnBnoB,EAAG,OACHC,EAAG,OACHkvD,EAAG,aAEe,IAAXtoB,EACFuoB,GAASjnC,EAAK,CACnBnoB,EAAG,MACHC,EAAG,MACHkvD,EAAG,iBAJA,IICP,CACEv2C,MAAO,UACPjY,KAAM,iBACNsnB,WAAW,EACXyoC,SAAS,GAEX,CACE93C,MAAO,MACPjY,KAAM,YACN6uD,OAAQ,SAASmB,GACf,OAAa,IAATA,EAAoB,KACjB,QAGX,CAAC/3C,MAAO,OAAQjY,KAAM,OAAQ6uD,OOnEjB,SAAoB7uD,EAAMtD,EAAM8qB,GAJ/C,IAA0BA;AAKxB,IAJ0B,KADFA,EAKHA,GAJVooC,YAAoBpoC,EAAIwsB,SAKnC,MAAa,YAATt3C,EAA4B,OACzB,2IAEW8qB,EAAI0F,OAAS,kBP+D/B,CAACjV,MAAO,OAAQjY,KAAM,OAAQ6uD,OQtEjB,SAAoB7uD,EAAMtD,EAAM8qB,GAC7C,IAAIpoB,EAASooB,EAAIqoC,MAAOroC,EAAIwsB,UAC5B,MAAa,YAATt3C,EAA4B,OACzB,wIAEW8qB,EAAI0F,OAAS;ACJlB,SAAS+iC,KACtBhzC,MAAMC,UAAUjI,QAAQkI,KACtBzkB,SAASgb,iBAAiB,6CAC1B,SAAShG,GACPA,EAAG0lB,QACoD,IAArD5d,GAAQo2C,gBAAgBl+C,EAAGwW,aAAa,WAE9CpL,GAAU,gBAAiBtD,ICNd,SAAS06C,KACtB16C,GAAQo2C,gBAAkBgB,GAC1BqD,KACAt+C,EAAE,WAAW6nC,YAAYjxB,MAAK,GCJjB,SAAS8wB,KACtB,IAAIE,EAASt8C,SAAS0U,EAAE,cAAckR,MAAO,IACzCy2B,EAASr8C,SAAS0U,EAAE,cAAckR,MAAO;AACzCuD,MAAMmzB,IAAWnzB,MAAMkzB,KAC3B9jC,GAAQ4kC,UAAYb,EACpB/jC,GAAQ6kC,UAAYf,EACpBxgC,GAAU,gBAAiBtD,IAC3B7D,EAAE,WAAW6nC,YAAYjxB,MAAK,ICGjB,SAAS4nC,KAVxB,IAAuBvE,EACjBwE;AAUJ56C,GAAQo2C,iBAXaA,EAWmBp2C,GAAQo2C,gBAV5CwE,EAAS,GACbr8C,OAAOiB,KAAK42C,GAAiB32C,QAAQ,SAAS/V,GACnB,KAArBjC,SAASiC,EAAK,MAChBkxD,EAAOlxD,GAAO0sD,EAAgB1sD,MAG3BkxD,GAKPH,KACAt+C,EAAE,WAAW6nC,YAAYjxB,OCUZ,SAAS2I,GAAStwB,EAAIyd,GACvBA,EAxBPu7B,QAAQ,MACVv5B,KAAK,uEACLgwC,cAAcnwB,KAAK,QAuBtBt/B,IAAKqa,KApBP,SAAiBoD,EAAMre,GACrB,GAAe,IAAXA,EAAK0a,EAAT,CACA,IAAI+W,EAAKpT,EAAKu7B,QAAQ,MAClB3B,EAAKtmC,EAAE,KAAM8f;AACjBwmB,EAAGvwB,GAAG,GAAG4oC,QACTrY,EAAGvwB,GAAG,IAAI4oC,QACVrY,EAAGvwB,GAAG,IAAI4oC,QACVrY,EAAGvwB,GAAG,IAAI4oC,QACVrY,EAAGvwB,GAAG,IAAI4oC,QACVrY,EAAGvwB,GAAG,IAAI4oC,QACV7+B,EAAGyW,IAAI,kBAAmB,kBAURjnC,KAAK,KAAMod,IACdA,EAPViyC,QAAQxpC,OAAO,aAAe7W,GACjC,8CCpBW,SAASsgD,GAASC,GAC/B,OAAOn6C,GAAU,CACfvF,IAAK,YACL9Q,KAAM,CACJ+a,IAAK,UACLC,OAAQ,cACRy1C,YAAaD,EACb76C,KAAM,GAERa,SAAU,SACTyE,KAAKvG,ICVK,SAASg8C,KACtBl7C,GAAQo2C,gBAAkB,GAC1B3uC,MAAMC,UAAUjI,QAAQkI,KACtBzkB,SAASgb,iBACP,2DACF,SAAShG,GACP8H,GAAQo2C,gBAAgBl+C,EAAGwW,aAAa,SAAW,IAEvDpL,GAAU,gBAAiBtD,IAC3B7D,EAAE,WAAW6nC,YAAYjxB,MAAK,GCTjB,SAASooC,GAASH,EAAWh/B,GAC1C,OAAOnb,GAAU,CACfvF,IAAK,YACL9Q,KAAM,CACJ+a,IAAK,UACLC,OAAQ,eACR41C,SAAUrjD,KAAKC,UAAUgjD,GACzBnjC,UAAWmE,EACX7b,KAAM,GAERa,SAAU,SACTyE,KAAKvG,ICVK,SAASm8C,KACtBr7C,GAAQo2C,gBAAkBD,GAAeC,gBACzCqE,KACAt+C,EAAE,WAAW6nC,YAAYjxB,MAAK,GCHjB,SAASkxB,KACtBjkC,GAAQ4kC,UAAYuR,GAAevR,UACnC5kC,GAAQ6kC,UAAYsR,GAAetR,UACnCvhC,GAAU,gBAAiBtD,IAC3B7D,EAAE,cAAckR,IAAIrN,GAAQ4kC,WAC5BzoC,EAAE,cAAckR,IAAIrN,GAAQ6kC,WAC5B1oC,EAAE,WAAW6nC,YAAYjxB,MAAK,GCLhC,SAASuoC,GAAW9wD,GAClB,IAAI6nC,EAAOV,GAAQnnC,GACfm2C,EAAK;AAGT,OADItO,EAAKttC,SAAS,kBAAkB47C,EAAK,GAClC,CAACz7B,EAAGy7B,EAAI9mB,EAAGwY,GAGL,SAASkpB,GAASP,GAC/B,OAAOn6C,GAAU,CACfvF,IAAK,YACL9Q,KAAM,CACJwnC,UAAW,EACXzsB,IAAK,QACLC,OAAQ,YACRysB,GAAIjtC,OAAOktC,OACXC,gBAAiBr4B,EAAS,iBAC1B0hD,aAAcR,KAEf56C,KAAKk7C,IACL71C,KAAKvG,IClBV,IAAIu8C,GAAWz2D,OAAOue,QAAUA,OAAOuS;AAMvC,SAAS4F,GAAStwB,EAAIisB,EAAM7sB,GAC1B,OAAOY,EAAGisB,GAAMjX,MALE5V,EAKcA,EAJzB,WAAY,OAAOA;AAD5B,IAAoBA,EAmBpB,SAASkxD,GAAehrB,EAAQlmC,GAC9B,OAAe,IAAXA,EAAK0a,GAAsB,SAAXwrB,GAZYlmC,EAaEA,EAZnB,UADSkmC,EAaEA,GAXjBhV,GAAS5B,GAAWtvB,EAAKV,EAAGU,GAGtB,QAAXkmC,EACKhV,GAASD,GAASjxB,EAAKV,EAAGU,QADnC,GAUOA;AAfT,IAA0BkmC,EAAQlmC,EAkB3B,SAASmxD,GAAcnkC,EAAOkZ,GAKnC,OAHA+qB,GAAWA,GAASr7C,KAAK,WACvB,OCnC6BoX,EDmCbA,EClCX3W,GAAU,CACfvF,IAAK,YACL9Q,KAAM,CACJ+a,IAAK,QACLC,OAAQ,YACRo+B,QAAS,WACTwP,cAAe57B,EACfrX,KAAM,GAERa,SAAU,SACTyE,KAAKvG,KDwBiBkB,KAAKs7C,GAAejwD,KAAK,KAAMilC;ACnC3C,IAAkBlZ,IDuDjC,SAASokC,GAAiB/xC,GACxB,OAAO,SAASrf,GACd,OAAe,IAAXA,EAAK0a,GAAwB,WAAb2E,EAAE6mB,OEzDjB7vB,GAAU,CACfvF,IAAK,YACL9Q,KAAM,CAAC+a,IAAK,UAAWC,OAAQ,YAC/BxE,SAAU,SFuDUZ,MAlBHyJ,EAkBoBA,EAlBjBrf,EAkBoBA,EAjBnC,SAASqxD,GAEd,IAAIC,EAAmBD,EAAO/nC,MAAM+nC,EAAO/nC,MAAM9qB,OAAS,GAAGa;AAC7D,MAAiB,SAAbggB,EAAE6mB,OACGhV,GAAS5B,GAAWgiC,EAAkBtxD,GAG9B,QAAbqf,EAAE6mB,OACGhV,GAASD,GAASqgC,EAAkBtxD,QAD7C,KAYOA;AApBX,IAAqBqf,EAAGrf,GAwBxB,SAASuxD,GAAkBlyC,GACzB,OAAO,WACL,OGlE2B2N,EHkEb3N,EAAE2N,MGlEkBlzB,EHkEXulB,EAAEvlB,SGlEmB03D,EHkETnyC,EAAEmyC,KGhEhCl7C,GAAQ,CACbyE,IAAK,QACLC,OAAQ,YACRo+B,QAAS,SACT5gD,GAAIw0B,EACJe,UAAWj0B,EACX03D,KAAMA,KH0DqC57C,KAAKob,IAC7Cpb,KAAKw7C,GAAiB/xC;AGnEd,IAAgB2N,EAAOlzB,EAAU03D,GHuEzC,SAASC,GAAgBpyC,GAG9B,OADA4xC,GAAWA,GAASr7C,KAAK27C,GAAkBlyC,II5D7C,SAASqyC,GAAQt5D,GACfuZ,EAAE,WAAW6nC,YAAY/9C,OAAOkW,EAAEvZ,EAAE2K,QAAQolB,KAAK,QAAQI,OACzD5W,EAAE,wBAAwBgU,QAG5B,SAASgsC,GAASv5D,GAChB,IAAIimB,EAAO1M,EAAEvZ,EAAE2K;AACfmuB,GACEigC,GAAclwD,KAAK,KAAMod,EAAK8J,KAAK,SAAU9J,EAAK8J,KAAK,WACvD9J,GAIJ,SAASuzC,GAAWx5D,GAClB,IAAIimB,EAAO1M,EAAEvZ,EAAE2K;AACfmuB,GACEugC,GAAgBxwD,KAAK,KAAM,CACzB+rB,MAAO3O,EAAK8J,KAAK,SACjBruB,SAAUukB,EAAK8J,KAAK,YACpBqpC,KAAMnzC,EAAK8J,KAAK,QAChB+d,OAAQ7nB,EAAK8J,KAAK,YAEpB9J,GAIJ,SAASwzC,GAASz5D,GAChB,IAAIimB,EAAO1M,EAAEvZ,EAAE2K;AACfmuB,GAAS5B,GAAUruB,KAAK,KAAMod,EAAK8J,KAAK,UAAW9J,GAGrD,SAASiT,GAAUl5B,GACjB,IAAIimB,EAAO1M,EAAEvZ,EAAE2K;AACfmuB,GAASD,GAAQhwB,KAAK,KAAMod,EAAK8J,KAAK,UAAW9J,GAGnD,SAASyzC,GAAW15D,GAClB,IAAIimB,EAAO1M,EAAEvZ,EAAE2K;AACf4tD,GAAS,CAACtyC,EAAKre,KAAK,QAASqe,EAAKwE,OAGpC,SAASkvC,GAAY35D,GACnB,IAAIimB,EAAO1M,EAAEvZ,EAAE2K;AACfmuB,GCxDa,SAAsB8gC,GACnC,OAAO17C,GAAQ,CACbyE,IAAK,QACLC,OAAQ,YACRo+B,QAAS,eACT6Y,WAAYD,IACXp8C,KAAKob,KDkDc/vB,KAAK,KAAM,CAACod,EAAK8J,KAAK,WAAY9J,GAG1D,SAAS6zC,GAAW95D,GAClB,IAAIimB,EAAO1M,EAAEvZ,EAAE2K;AACfmuB,GAASq/B,GAAStvD,KAAK,KAAM,CAACod,EAAKre,KAAK,SAAUqe,GAGpD,SAAS8zC,GAAW/5D,GAClB,IAAIimB,EAAO1M,EAAEvZ,EAAE2K;AACfmuB,GAAS6/B,GAAS9vD,KAAK,KAAM,CAACod,EAAKre,KAAK,SAAUqe,GElEpD,ICEImI,GCCA4rC,GACAC,GFJAhsC,GAAW,CACb,SAASvM,GAAQ,OAAiB,IAAVA,GACxB,SAASA,EAAO4B,EAAKrC,GAAM,OAAO+M,MAAM1K,IAAQ0K,MAAM/M,IACtD,SAASS,EAAO4B,EAAKrC,GAAM,OAAO+M,MAAM1K,IAAQ5B,GAAST,GACzD,SAASS,EAAO4B,EAAKrC,GAAM,OAAOqC,GAAO5B,GAASsM,MAAM/M,IACxD,SAASS,EAAO4B,EAAKrC,GAAM,OAAOqC,GAAO5B,GAASA,GAAST;AAG7D,SAASqhC,GAAYn0B,EAAWvmB,GAI9B,IAHA,IAAI0b,EAAMlG,GAAQ4kC,UACd/gC,EAAM7D,GAAQ6kC,UACdvgC,EAAQ6F,GAAS3f,EAAK,IACjBzB,EAAI,EAAGA,EAAI8nB,GAAS7nB,OAAQD,GAAK,EACxC,GAAI8nB,GAAS9nB,GAAGub,EAAO4B,EAAKrC,GAAO,OAAO;AAE5C,OAAO,EAuBF,SAASi5C,KACd3gD,EAAE/Q,GAAGomB,UAAUC,IAAIxrB,OAAO0D,KACxB,SAASonB,EAAWgsC,EAAMC,EAAQxyD,GAChC,OAAQwV,GAAQo2C,kBACbp2C,GAAQo2C,iBAAgB,KATd5rD,EAUDA,EATTwV,GAAQo2C,iBAAgB,IAC7B5rD,EAAKovD,OAA+B,OAAtBpvD,EAAKovD,MAAMqD;AAF7B,IAAmBzyD,IGAnB,SAAS0yD,KAEPr5D,EAAK,uBAEDiC,EAAKi7C,YAfTj7C,EAAKi7C,UAAYxiC,OAAOiB,KAAK1Z,EAAKi7C,WAE/B/xB,OAAO,SAASC,EAAMC,GAKrB,MAJa,eAATA,IACFD,EAAKnpB,EAAKi7C,UAAU7xB,GAAMlsB,IACxB8C,EAAKi7C,UAAU7xB,IAEZD,GACN,KC9BDinC,GAAOvY,UACTuY,GAAOvY,SAAQ,GAAQ,QAGzBuY,GAAOpiC,MACLoiC,GAAOpiC,MAAMoC,OAAO,SAAS5W,GAC3B,OAAoB,KAAbA,EAAIpY,OJefiV,EAAE/Q,GAAGomB,UAAUC,IAAIxrB,OAAO0D,KAAKu7C,IAI/B/oC,EAAE/Q,GAAGomB,UAAUC,IAAIxrB,OAAO0D,KACxB,SAASonB,EAAWgsC,EAAMC,EAAQxyD,GAChC,OAAQwV,GAAQo2C,iBACdp2C,GAAQo2C,gBAAgB5rD,EAAKtD,QGcnC41D,KHOA3gD,EAAE/Q,GAAGomB,UAAUC,IAAIxrB,OAAO0D,KACxB,SAASonB,EAAWgsC,EAAMC,EAAQxyD,GAChC,IAAIgS,GAAU/U,SAAS+C,EAAKgS,OAAQ,IAAM,KAAK7U;AAC/C,OAAQqY,GAAQo2C,iBACdp2C,GAAQo2C,gBAAgB55C,KKrDjB,WACb,IAAI2gD;AAEFA,EADEjH,GAAO39B,UACK,kCACZ29B,GAAOpiC,MAAM9qB,OACb,yCAEY,wCACZktD,GAAOpiC,MAAM9qB,OACb;AAEJ,IAAIo0D,EAASjG,GAAajxD,QAAQ,kBAAmBi3D;AACrDhhD,EAAE,QAAQ7Y,KAAK85D,GFgCfpgC,GACAy9B,KG7CAt+C,EAAE,cAAckR,IAAIrN,GAAQ4kC,WAC5BzoC,EAAE,cAAckR,IAAIrN,GAAQ6kC,WhCuEf,WACb1oC,EAAE,QAAQmV,OAAO;AAEjB,IAAItB,EAAQ7T,EAAE,WAAW6nC,UAAU,CACjCx5C,KAAM0rD,GAAOpiC,MACbguB,WAAW,EACXpwB,WAAY,GACZC,WAAY,CAAC,CAAC,GAAI,IAAK,IAAK,KAAM,GAAI,CAAC,GAAI,IAAK,IAAK,IAAK,QAC1DypB,WAAY,CAAC,CAACC,QAAS,OAAQgiB,eAAgB,IAC7C,CACEhiB,QAAS,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,IACvCiiB,cAAe,CAAC,OAAQ,SAE5B1rC,QAASwnC,GACTrnC,WAAYA,GACZK,WAAW,EACXC,cAAe;AAEjBrC,EAAMutC,OAAO,IAAIhD,QAAQ,sBAAuBrE,IAChDlmC,EAAMutC,OAAO,IAAIhD,QAAQ,cAAerE,IACtCzgD,IACFua,EAAMutC,OAAO,IAAIhD,QAAQ,cAAerE,IACtC7+C,I6B/CFwqC,GLwBA1lC,EAAE,0BAA0B6oC,MAAMnB,IAClC1nC,EAAE,aAAa4lB,MAAMkiB,IACrB9nC,EAAE,sBAAsB+pC,GAAG,QAAS,yBAA0BgV,IAC9D/+C,EAAE,WAAW4lB,MAAM24B,IACnBv+C,EAAE,YAAY4lB,MAAM44B,IACpBx+C,EAAE,eAAe4lB,MAAMs5B,IACvBl/C,EAAE,WAAW+pC,GAAG,QAAS,eAAgBgW,IACzC//C,EAAE,WAAW+pC,GAAG,QAAS,gBAAiBiW,IAC1ChgD,EAAE,WAAW+pC,GAAG,QAAS,kBAAmBkW,IAC5CjgD,EAAE,WAAW+pC,GAAG,QAAS,gBAAiBmW,IAC1ClgD,EAAE,WAAW+pC,GAAG,QAAS,eAAgBpqB,IACzC3f,EAAE,WAAW+pC,GAAG,SAAU,qBAAsBoW,IAChDngD,EAAE,WAAW+pC,GAAG,QAAS,gBAAiBwW,IAC1CvgD,EAAE,WAAW+pC,GAAG,QAAS,gBAAiByW,IAC1CxgD,EAAE,WAAW+pC,GAAG,QAAS,iBAAkBqW,IKnC3CpgD,EAAE,eAAe4lB,MAAMy7B,IIrDV,WACb,IAAIhrC,EAAQrW,EAAE;AACdqW,EAAMuyB,KAAK,OAAQ;AACnB,IAAI1hC,EAAQlH,EAAE;AACdqW,EAAMirC,KAAKthD,EAAE,uCACbqW,EAAMnW,MAAMgH,GACZA,EAAM0e,MAAM,WACVvP,EAAMnF,IAAI,IACVlR,EAAE,WAAW6nC,YAAY/9C,OAAO,IAAI8sB,SJ8CtC2qC,GAEAz5D,EAAQ,uBAkBH,SAASu5D,KAdhB,IACM3nC;AAcAtZ,OAxDJJ,EAAE,QAAQ7Y,KAAK,oCACfmX,GAAc,4EAyCVob,EAAM,IACNlsB,KAAKmtB,KAAerR,KAAK+yC,KACT,gBAAhB1yD,EAAK0f,QACPqQ,EAAIlsB,KAAK43C,IAAa,IAExB1rB,EAAIlsB,KAAK+U,GAAU,iBAChB+G,KAAKgzC,KAERt8C,EAAE2Z,KAAKpqB,MAAMyQ,EAAG0Z,GAAKpQ,KAAK,WACxBta,EAAI,EAAG+xD,OKhEX,SAASS,GAAUnzD,GACjB,IAAIozD,EAAazhD,EAAE;AACnByhD,EAAWt6D,KAAK,0CAA4CkH,EAAKqvB,GACjE+jC,EAAW/2B,OAAOg3B,MAAM,KAAM5qC,KAAK,KAGrC,SAAS6qC,GAAUC,GACjBJ,GAAU,CAAC9jC,EAAGkkC,EAAMv9C,OAAS,IAAMu9C,EAAMC,aAG3C,SAASC,GAAezzD,GACtB,GAAe,IAAXA,EAAK0a,EACPy4C,GAAUnzD;IACL,CACL,IAAI0zD,EAAS/hD,EAAE,iBAAmB3R,EAAK2zD,SAAS3zD,KAAK;AACrD2R,EAAE,aAAe3R,EAAK2zD,SAASviC,SAC/Bzf,EAAE,SAAW+hD,GAAQtiC,SAEvB7E,GAAa,cAAeh0B,EAAe,gBAG7C,SAASq7D,GAAex1C,GACtB,IAAIy1C,EAASz1C,EAAIrb,OAAOmhB,aAAa,UAAU7hB,MAAM;AACrD+b,EAAIrb,OAAOsQ,WAAWyK,UAAY,cAChC+1C,EAAOr1D,OAAS,SAClBq1D,EAAO5+C,QAAQ,SAAS+X,GACtB3W,GAAU,CACR3Z,KAAM,OACNoU,IAAK,YACL9Q,KAAM,CACJ+a,IAAK,UACLC,OAAQ,WACR24C,QAAS3mC,EACTrX,KAAM,KAERa,SAAU,SACTyE,KAAKw4C,IAAgB7N,KAAK0N,MAIjC,SAASQ,KACsC,YAAzCniD,EAAE,qBAAqBwW,KAAK,UAC9BxW,EAAE,oBAAoB7Y,KAAK,kBAC3B6Y,EAAE,cAAcu2B,IAAI,UAAW,SAC/Bv2B,EAAE,mBAAmBu2B,IAAI,UAAW,QACpCv2B,EAAE,qBAAqBwW,KAAK,QAAS,eAErCxW,EAAE,oBAAoB7Y,KAAK,qBAC3B6Y,EAAE,cAAcu2B,IAAI,UAAW,QAC/Bv2B,EAAE,mBAAmBu2B,IAAI,UAAW,SACpCv2B,EAAE,qBAAqBwW,KAAK,QAAS,YPjDzC,SAAS4rC,GAAUC,GACjB,OAAIA,EAAmBj6D,OAAOi6D,EAAU,IACjC,EAkBT,SAASC,GAAYC,GACnB,GAfIC,EAewBD,EAfL9oC,MAAM,GAAGtN,UAG5Bs2C,EADF,+DACwC1kD,KAAKykD,GAG3CE,EADF,uDACsC3kD,KAAKykD,GACzCG,EAAgBP,GAAUM,GAC1BE,EAAiBR,GAAUK,GACxBC,GACLC,IAAkB9tC,IAClB+tC,IAAmB/tC,GAIc,CACjC,IAAK,IAAI9mB,EAAI,EAAGA,EAAI,EAAGA,GAAK,EAC1Bw0D,EAAK9oC,MAAM1rB,GAAGw4C,gBAAgB;AAEhCgc,EAAK3gD,UAAU5S,IAAI,WACnBuzD,EAAK3gD,UAAU5S,IAAI,aArBvB,IACMwzD,EAGAC,EAGAC,EACAC,EACAC,EAmCN,SAASC,GAAYN,GACnB,IAAIO,GACqC,IADxBP,EAAK9oC,MAAM,GAAGpxB,YAC5ByB,OAAO,2BACkC,MAAxCy4D,EAAK9oC,MAAM,GAAGpxB,YAAY06D,OAAO,IAAeD,IAtBtD,SAAoBP,EAAMO,GACxB,IAEIE,EAFAn0D,EAAU0zD,EAAK9oC,MAAM,GAAGtN,UACxB82C,EAAap0D,EAAQpD,QAAQ;AAEjCu3D,EAAYn0D,EAAQgR,UAAU,EAAGojD;AACjC,IAAIC,EAAcr0D,EAAQpD,QAAQ,IAAMw3D,EAAa,GACjDE,EAAmBt0D,EAAQgR,UAAUojD,EAAa,EAAGC;AACzDX,EAAK9oC,MAAM,GAAGtN,UAAY62C,EAAY,2GAGpCG,EAAmB,yBAA2BA,EAC9C,OAASt0D,EAAQgR,UAAUqjD,EAAar0D,EAAQhC,QAC7Ci2D,GACHK,IAAqBvzC,OACrB5P,EAAEuiD,GAAM7zC,KAAK,MAAMgwC,YAAY,OAAOnoB,IAAI,YAAa,YACvDgsB,EAAK5xD,MAAMwsB,MAAQ,QAQnBimC,CAAWb,EAAMO,GAkBrB,SAASO,KACP,IAAIC,EAVN,WAEE,IADA,IAAI/uC,EAAW/J,GAAIqF,qBAAqB,MAC/BjjB,EAAI,EAAGA,EAAI2nB,EAAS1nB,OAAQD,GAAK,EACxC,GAAgC,YAA5B2nB,EAAS3nB,GAAGvE,YACd,OAAOksB,EAAS3nB,GAME22D;AACtB,GAAKD,EAAL,CACA,IAjB6Bf,EAiBzBiB,EAAWF,EAAgB5hD,WAAWA,WAAWA;AACrD4hD,EAAgBn3C,WAAa,gGAG7B0I,GAAkB1sB;AAElB,IAAK,IAAIyE,EAAI,EAAGA,EAAI42D,EAAShqC,KAAK3sB,OAAQD,GAAK,EAAG,CAChD,IAAI21D,EAAOiB,EAAShqC,KAAK5sB;AAvB3B01D,GAD6BC,EAyBLA,GAvBxBM,GAAYN,KA2BC,SAASkB,KAClB9lD,EAAS,kCACX0lD,KC7DJ,SAASK,GAASnB,EAAMoB,EAAWC,GACjC,IAd6BC,EAczBC,GAAa,EAEbD,EAAc35B,GADCq4B,EAAK9oC,MAAMmqC,GAAYv7D,aAEtC07D,GAAetD,GAASoD,GAAW;AACrBnD,GAAdmD,EACFtB,EAAK3gD,UAAU5S,IAAI,UAnBQ60D,EAoBIA,EAnBZ,GAmBDE,GAnBOF,GAAenD,KAoBxC6B,EAAK3gD,UAAU5S,IAAI,SACnB80D,GAAa,IAlBjB,SAAyBvB,EAAMoB,EAAWG,GACxC,GAAkB,SAAdH,GAAwBG,EAAY,CACtC,IACIE,EADa,kBACSjmD,KAAKwkD,EAAK9oC,MAAM,GAAGtN,WAAW;AACxDo2C,EAAK9oC,MAAM,GAAGtN,WAAa,qBACzByB,GAAco2C,GAAY,YAe9BC,CAAgB1B,EAAMoB,EAAWG,GAOnC,SAASI,GAAcP,EAAWC,EAAYO,GAC5C1D,IAAS,IAAKl0D,MAAQ63D,cAAc,EAAG,GAAK;AAC5C,IAAIC,EAAkB,OAASV,EAAY;AAC3CjD,GANO/iD,EAMqB0mD,IANQ5D;AAOpC,IAAI6D,EAAY;AACE,SAAdX,IACFW,EAAY,EACZH,EAAUviD,UAAU5S,IAAI;AAE1B,IAAK,IAAIpC,EAAI,EAAGA,EAAIu3D,EAAU3qC,KAAK3sB,OAAQD,GAAK03D,EAC9CZ,GAASS,EAAU3qC,KAAK5sB,GAAI+2D,EAAWC;AAEzCj5C,GAAS05C,EAAiB5D,IAGb,SAAS8D,GAAeZ,EAAWC,GAChD,GAAKjmD,EAAS,qBAAd,CACA,IA3DIwmD,EA2DAA,IA3DAA,EAAY/sB,GAAS,mCAEvB+sB,EAAY/sB,GAAS,sCAElB+sB,IACHA,EAAY/sB,GAAS,gEAGhB+sB;AAoDHA,GAAYD,GAAcP,EAAWC,EAAYO,IOpEvD,IAAIK,GAAS,CACX,GACA,CAAC,YACD,CAAC,oBAAqB,gBAAiB,oBACrC,mBACF,CAAC,qBAAsB,wBACvB,CAAC,gDACC,yDACA,8BAA+B,qBAAsB,sBACrD,oCAAqC,kCACrC,0BAA2B,8CAC7B,CAAC,yBAA0B,uBAC3B,CAAC,oCACC,+CACF,CAAC,+CACC,0DACF,CAAC,gCAAiC,uBAChC,kCAAmC,yBACnC,kCAAmC,oCACnC,qBAAsB,8BACxB,CAAC,yCACC,uCACA,+CACA,2CACA,sDACF,CAAC,+BACC,4DACA;AAGG,SAASC,GAAWp2D,GAEzB,SAASq2D,EAAQ3oD,GACf,OAAIvV,EAAOuV,EAAI,UACN1N,EAAKzF,SAASmT,GAEhBA,EAAGjP,KAAKuB,GAGjB,IAAIs2D,EAAUH,GAAOI,UAAU,SAAStpC,GAAM,OAAOA,EAAIzS,KAAK67C;AAC9D,OAAiB,IAAbC,EAAwB,EACrBA,EC3CF,ICoBHE,GACAC,GACAC,GACAx9B,GACAzgC,GACAk+D,GACApxC,GAGAqxC,GD7BOC,GACT,suDA2CSC,GAAY,uJAiBZC,GAAY,EAAC,GAAM,GAAM,GAAM,GAAM,GAAM,GACpD,GAAM,GAAM,GAAM,GAAM,GACfC,GAAW,EAAC,GAAO,GAAO,GAAO,GAAO,GAAO,GACxD,GAAO,GAAO,GAAO,GAAO,GC7C1BxhD,GAAU,GAQVyhD,GAAc,GACdC,IAAiB;AAGrB,SAASC,GAAgBl8D,GACvB,OAAOob,GAAU,CACfvF,IAAK,YACL9Q,KAAM,CAACwnC,UAAW,EAAGzsB,IAAK,QAASC,OAAQ,MAAO/f,KAAMA,GACxDm8D,SAAU,SAId,SAASC,GAAc5yC,EAAMC,GAC3B,IAAIuE,EAASxE;AAEb,OADKA,GAAsB,SAAdC,EAAKprB,OAAkB2vB,EAASvE,GACtCuE,EAST,SAASquC,GAAUt3D,GACjBvH,GAAM0iB,GAAenb;AACrB,IAPIu3D,EAOAC,GAPAD,EAAYh/D,EAAe,MAAOE,IACnCukB,uBAAuB,eACnBC,MAAMC,UAAUsH,OAAOrH,KAAKo6C,EAAWF,GAAe;AAM7DV,GAAW58D,OAAOy9D,EAAU79D,OAC5B4rB,GAAWxrB,OAAO,MAAM2V,KAAK8nD,EAAUnkD,WAAWrZ,aAAa,IAC9C,IAAb28D,KAAiBz9B,GAAUt/B,KAAK8hB,IAAI6J,GAAUmxC,KAClDD,GAAUz8D,YAAc,WAAa28D,GAAW,OAASz9B,GAAU,MAOrE,SAASu+B,GAAcC,EAAWC,GAChC,OAAoB,IAAbhB,IAAkBnhD,GAAQiM,MALDk2C,EAKiCA,EAAXD,IAJjCliD,GAAQiM,IAAI,GAAG,IAAMk2C,IAAUniD,GAAQiM,IAAI,GAAG;AADrE,IAAkCk2C,EAyBlC,SAASC,KACP,IAAIC,EAAYp/D,GAAIukB,uBAAuB;AAClB,IAArB66C,EAAUr5D,QAnBhB,SAAsBq5D,GAGpB,IAFA,IAAI9hB,EAAW8hB,EAAU,GACrBtjC,EAAQwhB,EAAS5qB,KAAK3sB,OAAS,EAC1BD,EAAI,EAAGA,EAAIg2B,EAAOh2B,GAAK,EAAG,CACjC,IAAI42C,EAAQY,EAAS5qB,KAAK5sB,GACtBu5D,EAAS3iB,EAAM/pB,MAAM,GAAGpxB,YACxB09D,EAAY77B,GAAqBi8B,GACjCH,EAAQxiB,EAAM/pB,MAAM,GAAGtN;AAC3B,GAAI25C,GAAcC,EAAWC,GAAQ,CACnCT,IAAiB;AACjB,MAEFD,GAAY93D,KAAK,CAAY,IAAXw3D,GAAiBp4D,EAAGm5D,EAAWI,EAAQH,EACvDvB,GAAWuB,MAMcI,CAAaF,GAG5C,SAASG,GAAYh4D,GACnBs3D,GAAUt3D,GACV43D,KAiBF,SAASK,KACPn/C,GAAU,eAAgBtD,IA6C5B,SAASy6C,KACPhzC,MAAMC,UAAUjI,QAAQkI,KACtBq5C,GAAeh1C,qBAAqB,SACpC,SAAS9T,GACPA,EAAG0lB,QAAU5d,GAAQ0iD,OAAOxqD,EAAGwW,aAAa,WAGhD+zC,KAGF,SAASE,KApDT,IAEM/F;AAmDA8E,IACFD,GAAY7yC,KAAK,SAAS/kB,EAAGC,GAC3B,OAAOD,EAAE,GAAKC,EAAE,KAGpBm3D,GAAUz8D,YAAc,oBAxDpBo4D,GAAS,IAAKl0D,MAAQk6D,WAAW,EAAG,GACxC5iD,GAAQiM,IAAMw1C,GAAYzyC,OAAO,SAASC,EAAMC,GAI9C,OAHIA,EAAK,KAAO0tC,GACd3tC,EAAKtlB,KAAK,CAACulB,EAAK,GAAIA,EAAK,GAAIA,EAAK,GAAIA,EAAK,KAEtCD,GACN,IACHwzC,KAGF,WAEEh/D,EADA29D,GAAU5/C,GAAY,CAACxe,GAAI,gBAAiB+lB,UAAW,eAC1Bu4C,IAE7BG,GAAYhiD,QAAQ,SAASyF,GAC3B,IAAIy6B,EAAQyhB,GAAQroC,WAAW;AAC/B7T,EAAEvb,KAAKg2C,GACF3/B,GAAQ0iD,OAAOx9C,EAAE,MAAMy6B,EAAM52B,UAAY,WAC9C42B,EAAM9d,YAAY,GAAGvZ,UACnB,4DACA7N,GAAc,+BAChBklC,EAAM/pB,MAAM,GAAG7M,UAAY,MAC3B42B,EAAM9d,YAAY,GAAGvZ,UAAY,SAAWpD,EAAE,GAAK,UACnDy6B,EAAM/pB,MAAM,GAAG7M,UAAY,MAC3B42B,EAAM9d,YAAY,GAAGvZ,UAAYpD,EAAE,GACnCy6B,EAAM/pB,MAAM,GAAG7M,UAAY;AAC3B,IAAI85C,EAASzB,GAAQroC,WAAW;AAChC7T,EAAEvb,KAAKk5D,GACF7iD,GAAQ0iD,OAAOx9C,EAAE,MAAM29C,EAAO95C,UAAY;AAC/C,IAAI+5C,EAAMD,EAAOhhC,YAAY;AAC7BihC,EAAI/5C,UAAY,UAChB+5C,EAAIC,QAAU;AAGhB,IAAIh4C,EAAWhoB,EAAe;AAC9B4jB,GAAI0qC,aAAa+P,GAASr2C,GAC1B21C,GAAe,aAAc,GAC7Bd,KAqBAoD,GAGF,SAAS5sC,GAAiB5rB,GACxBg4D,GAAYh4D,GAlFd,WACE,IAAIqrB,EAAM;AACV,GAAI6rC,GACF,IAAK,IAAI34D,EAAI,EAAGA,GAAK26B,GAAS36B,GAAK,EACjC8sB,EAAIlsB,KAAKg4D,GAAgB54D,GAAG0c,KAAK+8C;KAGnCxiD,GAAQiM,IAAIxM,QAAQ,SAAS7c,GAC3B6+D,GAAY93D,KAAK,CAAC,EAAG/G,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE;AAG7C,OAAOuZ,EAAE2Z,KAAKpqB,MAAMyQ,EAAG0Z,GAwEvBotC,GAAgBx9C,KAAKk9C,IA2CvB,ICxNIO,GDwNAC,GAAiB,CACnB,CAACl6D,KAAM,SAAS4f,GAAO,MAAwB,UAAjBA,EAAKC,SAAuBpF,IAzC5D,SAAoBmF,GAClB,IAAIwO,EAAO9yB,OAAOskB,EAAK6F,aAAa;AACpC1O,GAAQ0iD,OAAOrrC,IAASrX,GAAQ0iD,OAAOrrC,GACvCorC;AACA,IAAIxvC,GAAQjT,GAAQ0iD,OAAOrrC;AAC3BoqC,GAAYhiD,QAAQ,SAASyF,GACvBA,EAAE,KAAOmS,IACbgE,GAAYnW,EAAE,GAAI+N,GAClBoI,GAAYnW,EAAE,GAAI+N,QAkCpB,CAAChqB,KAAM,SAAS4f,GAAO,MAAmB,WAAZA,EAAK7lB,IAAmB0gB,IA9BxD,WACE1D,GAAQ0iD,OAASnB,GAAU1mD,MAAM,GACjC4/C,KACAgH,GAAYhiD,QAAQ,SAASyF,GAC3BA,EAAE,GAAGnH,UAAU6d,OAAO,WACtB1W,EAAE,GAAGnH,UAAU6d,OAAO,eA0BxB,CAAC3yB,KAAM,SAAS4f,GAAO,MAAmB,YAAZA,EAAK7lB,IAAoB0gB,IAtBzD,WACE1D,GAAQ0iD,OAASlB,GAAS3mD,MAAM,GAChC4/C,KACAgH,GAAYhiD,QAAQ,SAASyF,GAC3BA,EAAE,GAAGnH,UAAU5S,IAAI,WACnB+Z,EAAE,GAAGnH,UAAU5S,IAAI,eAkBrB,CAAClC,KAAM,SAAS4f,GAAO,MAAmB,SAAZA,EAAK7lB,IAAiB0gB,IAdtD,WACE1D,GAAQiM,KAAM,EACdw2C,KACAxB,GAAUz8D,YAAc,qBACxBi9D,GAAc,GACdC,IAAiB,EACjB3+D,EAAe,iBAAiBulB,UAAY,GAC5Cq5C,GAAgB,GAAGl8C,KAAK2Q;AAU1B,SAASgtC,GAAWC,IAClBrjD,GAAUqjD,GAAYrjD,IACd0iD,OAAS1iD,GAAQ0iD,QAAUnB,GAAU1mD,MAAM,GACnD8L,GAAI2B,UAAY+4C,IAChBL,GAAiBj+D,EAAe,mBACjBkJ,iBAAiB,QAAS2qB,GAAausC,KACtD1I,KACAwG,GAAYl+D,EAAe,aAC3Bm+D,GAAkB38D,OAAOuV,EAAS,4BAClC4pB,GAAUw9B,GACVS,GAAgB,GAAGl8C,KAAK2Q,IE5OX,SAASktC,GAAsBlgE,EAAQE,GACpDH,EAAWC,EAAQ,cAAeE,GCMpC,SAASigE,GAAgBt0C,EAAMC,EAAM0D,GACnC,IALsB1D,EAKlBxlB,EAAMwlB,EAAK0G,MAAM,GAAGpxB,YAAY4+B,OAAOl9B,QAAQ,IAAK;AACxD,OAAKwD,IACLulB,EAAKvlB,GAAO,CAAC85D,IAAK5wC,IAPI1D,EAQHA,GAPP0G,MAAM,IAAM1G,EAAK0G,MAAM,GAAGpxB,cAQpCyqB,EAAKvlB,GAAKvF,MAAQI,OAChB2qB,EAAK0G,MAAM,GAAGpxB,YAAY4+B,OAAOl9B,QAAQ,IAAK,OAG3C+oB,EAGT,SAASw0C,GAAO1e,EAAMzlC,GACpB,OAAIA,EAAIylC,IAASzlC,EAAIylC,GAAM5gD,MAClBmb,EAAIylC,GAAM5gD,MAEZ,EAUT,SAASs/C,GAASvrC,GAChB,IARoBoH,EAAKuZ,EAQrB6qC,EAAYjjB,GAAavoC,GACzByrD,EAAUl8C,MAAMC,UAAUsH,OAAOrH,KAAK+7C,EAAU/tC,KAClD4tC,GAAiB,IACfK,EAAaH,GAAO,SAAUE,GAAWF,GAAO,UAAWE,GAC7DF,GAAO,QAASE,GAAWF,GAAO,SAAUE,GAC5CF,GAAO,KAAME;AACfL,IAdyBzqC,EAcmB6qC,GAdxBpkD,EAceqkD,GAb3BE,aACChrC,EAAIlD,KAAKrW,EAAIukD,aAAaL,IAAM,GAElC3qC,EAAIlD,KAAKkD,EAAIlD,KAAK3sB,OAAS,IAWhC,mEACA46D,EAAa,oBAGjB,SAASE,GAAct5D,GACrB,IAAIqmD,EAAYvvC;AAChB7d,EAAoBotD,EAAWrmD;AAC/B,IAAIu5D,EAAQlT,EAAU7kC,qBAAqB;AAK3C,OAJA+3C,EAAQt8C,MAAMC,UAAUwO,OAAOvO,KAAKo8C,EAAO,SAAS7rD,GAClD,MAA0B,YAAnBA,EAAG1T,eAENib,QAAQgkC,IACPoN,EAAUvoC,UAGnB,SAAS07C,GAAahkD,GACqB,IAArCA,EAAQ1E,IAAI1T,QAAQ,eACxBoY,EAAQikD,WAAaH,IAGR,SAASI,KACtB/nD,EAAEgoD,cAAcH,IFlDlB,IAAII,GAAe,CACjB,SAASv7C,GAAO,MAAwB,MAAjBA,EAAKC,SAC5B,SAASD,GAAO,OAAOw4B,QAAQx4B,EAAK1K,OACpC,SAAS0K,GAAO,OAAOA,EAAK1K,KAAKpZ,SAAS;AAiB5C,SAASs/D,GAAa92D,GARtB,IAAqBA;AASfA,EAAO+2D,aAAa,UARK,WADV/2D,EAULA,GATHT,MAAMoe,SACf3d,EAAOwQ,UAAU5S,IAAI,WAEvBoC,EAAOm1C,gBAAgB,UAQrBn1C,EAAOwQ,UAAUwd,OAAO,WAI5B,SAASgpC,GAAc17C,GAGnBw7C,GADgB,IADF9/D,OAAOiX,GAAsBqN,EAAK1K,KAAM,gBAnCnD+kD,KACHA,GAAMngE,EAAe,sBAEhBmgE,IAoCQr6C,EAAKhL,WAAWA,WAAW+M,oBAI5C,SAAS45C,GAAe57C,GACtB,IAhCuBC,EAgCnBA,EAAOD,EAAIrb;AAhCQsb,EAiCHA,EAhCbu7C,GAAanyC,MAAM,SAAS/Z,GACjC,OAAOA,EAAG2Q,OAgCV07C,GAAc17C,GACdhI,GAAUgI,EAAK1K,MACfyK,EAAIpc,kBGlDR,ICCIi4D,GCYAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GFpBAnsD,GAA2BgB,EAAS;AAcxC,SAASorD,GAAS3X,GAChBjnD,EAAU,UAAW;AACrB,IAdc6+D,EAcVA,EAAS5X,EAAMpvC,KAAK1Z,MAAM,UAAU,IAd1B0gE,EAePA,EAdAtkD,GAAU,CACfvF,IAAK,gBACL9Q,KAAM,CACJX,EAAG,KACHojC,EAAG,IACHjqC,GAAImiE,GAENnkD,SAAU,UAQTyE,KAAK,SAASjb,GACkB,IAA3BA,EAAK4yC,SAASA,SAChBmQ,EAAM1vC,WAAWyK,UAAY,GAE7BnM,EAAE,eAAe7Y,KAAKkH,EAAK4yC,SAAS/wC,KAAK6S,OAAO,UAcxD,SAASkmD,GAAe7X,GATxB,IAAkBA;AAUXz0C,GAGHosD,GAAS3X,GATX/qC,GAAS,gBAJO+qC,EAWLA,GAVS7+B,aAAa,WAE9BjqB,MAAM,kDAAkD,GAC5B,WAC7BygE,GAAS3X,KAYb,SAAS8X,GAAgBziE,GACvB,IAAI2qD,EAAQ3qD,EAAE2K;AACd,GAAsB,QAAlBggD,EAAMzkC,QACR3M,EAAEvZ,EAAE2K,QAAQm9B,KAAK,QACjB6iB,EAAQA,EAAM1vC;KACT,GAAsB,MAAlB0vC,EAAMzkC,QAAkB;AACnClmB,EAAEkkC,kBACFlkC,EAAE4J,iBACF44D,GAAe7X,GGpCjB,SAAS+X,GAAWC,EAAa38C,EAAK8nB,EAAQnpC,GAC5CjB,EAAU,UAAW;AACrB,IAAIuiB,EAAOD,EAAIrb,OACXiqB,EAAQ3O,EAAKhL,WAAWA,WAAW6X,kBAAkBR,QAAQ8lB;AACjEnyB,EAAKrkB,YAAc,GACnBqkB,EAAKE,UAAY,qCACjB2nB,EAAOlZ,GAAO/R,KAAK,SAASjb,GAb9B,IAAwB+6D,EAClBC,EAEAz8D;AAWa,IAAXyB,EAAK0a,GAdWqgD,EAkBLA,EAjBbC,EAASjhE,OAiBiBizB,IAdnB,KADPzuB,EAAIw8D,EAAYE,QAAQ1E,UAAU,SAAS7oD,GAAK,OAAOA,EAAGrO,IAAM27D,MACrDD,EAAYE,QAAQ9tC,OAAO5uB,EAAG,GAe3C8f,EAAK9K,UAAU6d,OAAO,cACtB/S,EAAKhL,WAAWyK,UAAY,0BAA4B/gB,EAAS,WAL/DshB,EAAK+S,WA0CX,SAAS8pC,GAAc78C,GACrB,IAAIiL,EAAQ5wB,SAASgb,iBACnB,gBAAkB2K,EAAK3hB,KAAKS,WAC5B;AACmB,IAAjBmsB,EAAM9qB,QACVye,MAAMC,UAAUjI,QAAQkI,KAAKmM,EAnB/B,SAAqBjL,EAAM88C,GACzB,IANkBC,EALCA,EAWfC,EAAQF,EAAQ5nD,UAAU+Q,SAAS,6BACnCg3C,EAAQxkD,GAAU,CACpByH,UAAW,UACXT,UAAW,qCAdMs9C,EAc4CC,EAb3DD,EAAgB,UACb,YAYiE,MATtDA,EAUHC,EATXD,EAAgB,MACb,QAQiB;AAEpB/8C,EAAK7I,QAAQ+lD,mBACf3jD,GAAc0jD,EACZH,EAAQ9nD,WAAW+M,mBAAmBA,oBAE1CxI,GAAcujD,EAAQ9nD,WAAWA,WAAYioD,IAQGr6D,KAAK,KAAMod,IAG7D,SAASm9C,GAAcC,EAAmBV,GACxC,IAAIW,EAAUX,EAAYY;AAC1BZ,EAAYY,UAAY,SAASj/D,EAAMzB,GAChCyd,KAAKkjD,UACVF,EAAQv+C,KAAKzE,KAAMhc,EAAMzB,GACzBigE,GAAcxiD,QAE8C,IAA1DngB,EAAe,oBAAoByB,YAAYwE,QACjDmC,EAAI,EAAGu6D,GAAe,CAACH,IAEzBU,EAAkBh6D,iBAAiB,QAnDrC,SAAgBs5D,EAAa38C,GACvBA,EAAIrb,OAAOwQ,UAAU+Q,SAAS,aAChCw2C,GAAWC,EAAa38C,EAAKkR,GAAW,QAEtClR,EAAIrb,OAAOwQ,UAAU+Q,SAAS,YAChCw2C,GAAWC,EAAa38C,EAAK6S,GAAS,SA8CWhwB,KAAK,KAAM85D,IASjD,SAASc,KA1FxB,IACMC,EAoFAL,EACAV;AAKCzrD,EAAS,uBA1FVwsD,EAASvjE,EAAe,aACrBgmB,UAAY,cACnBu9C,EAAO5jB,gBAAgB,SAkFnBujB,EAAoBljE,EAAe,sBACnCwiE,EAAcppD,EAAE8pD,GAAmBz7D,KAAK,cAC1Bw7D,GAAcC,EAAmBV,IFvFrD,SAAS38D,GAAWgrB,GAMlB,IGbkCyD,EHa9BA,EAAO,qBAAqBnd,KAAK0Z,EAAKzV,MAAM;AAC5CkZ,IGd8BA,EHepBA,EGdPvW,GAAQ,CACbyE,IAAK,UACLC,OAAQ,cACR8R,aAAcD,KHWI5R,KAPpB,SAAkByR,GACZA,EAAKC,IACPvD,EAAK/V,WAAWyK,UAAY,MASlC,SAASi+C,KACPjgE,EAAU,UAAW;AACrB,IACI65B,EADeskC,GAAoB75C,mBACboB,qBAAqB;AAC/CvE,MAAMC,UAAUjI,QAAQkI,KAAKwY,EAAQv3B,ICEvC,IACI49D,GACAC,GACAC,GACAC,GAJAC,GAAgB;AAMpB,SAASC,GAAa5jE,GACpB,OAAOF,EAAe,qBAAsBE,GACzCukB,uBAAuB,mBAmB5B,SAASs/C,GAAiB7jE,GACxB,IAAIs3D,EAAUt3D,IAAQC,SAClB6jE,EAASF,GAAa5jE,GAAK,GAC3BytB,EAAWq2C,EAAO/6C,qBAAqB;AAC3CvE,MAAMC,UAAUjI,QAAQkI,KAAK+I,EApB/B,SAAwB6pC,EAASriD,GAC/B,IAAIqzC,EAAYrzC,EAAGgd,QAAQC,OACvBnyB,EAAKuoD,EAAU9mD,MAAM,gCAAgC;AACzDmiE,GAAc5jE,GAAM4jE,GAAc5jE,IAAO,CACvCs3B,MAAO,EACP0sC,IAAK9uD,EAAGwW,aAAa,OACrBu4C,YAAa1b,EACb2b,IAAK,GACLluC,IAAK,IAEP4tC,GAAc5jE,GAAIs3B,OAAS,EAC3BssC,GAAc5jE,GAAIkkE,IAAIv9D,KAAKuO,EAAG2F,WAAWM,MACrCo8C,GAAUqM,GAAc5jE,GAAIg2B,IAAIrvB,KAAKuO,EAAG2F,WAAWA,YACvD2oD,IAAa,GAOyC/6D,KAAK,KAAM8uD,IACjEmM,IAAcK,EAAO7oD,iBACnB,2CAA2ClV,OAG/C,SAASm+D,GAAcl4C,EAAMjsB,GAC3B,IAAIoxB,EAAOwyC,GAAc5jE;AACzB,OAAOisB,EAAO,qBAAuBmF,EAAK4yC,IACxC,mDAAqD5yC,EAAK6yC,YAC1D,cAAgB7yC,EAAKkG,MAAQ,6DAC6Bt3B,EAC1D,0BAGJ,SAASokE,KACP,IAAIvuC,EAAMrX,GAAY,CAACuH,UAAW,iBAC9Bs+C,EAAQ5lD;AACZW,GAAcyW,EAAKwuC,GACnB5jE,EAAoB4jE,EAClB,kDACA9oD,OAAOiB,KAAKonD,IAAe53C,OAAOm4C,GAAe;AACnD,IAAIG,EAASzuC,EAAIE,WAAW;AAC5Bt1B,EAAoB6jE,EAAQ;AAC5B,IAAIC,EAAUD,EAAOzlC,YAAY;AACjC0lC,EAAQxE,QAAU,GAClB0D,GAAellD,MACF+G,UAAYk+C,GAAU7+D,WACnCya,GAAcmlD,EAASd,IACvBpc,GAAoBkd,EAAS,MAAQb,GAAW/+D,YAChDg9D,GAAQr8C,UAAY,GACpBlG,GAAcuiD,GAAS9rC,GAGzB,SAAS2uC,GAAkBh9D,GAEzB/G,EAAoBkhE,IADpBgC,IAAa,GAC4B,MACzCG,GAAiBnhD,GAAenb,IAkDlC,SAASi9D,GAAUvvD,GACjBzU,EAAoByU,EAAG2F,WAAWA,WAChC,uCAWJ,SAAS6pD,KACPlB,IAAa,EACbC,GAAajiE,YAAcgiE,GAAU7+D,WAoBvC,IG7KI+nB,GACAi4C,GH4KAjoB,GAAS,CACX,CACEz2C,KAAM,SAAS4f,GAAO,OAAOA,IAASg8C,IACtCnhD,IAjCJ,WACEpd,EAAU,aAAc,sBACxBo+D,GAAY3mD,UAAU5S,IAAI,WAC1By5D,GAAU7mD,UAAU6d,OAAO;AAC3B,IAAIlL,EAAWu0C,GAAaj5C,qBAAqB;AACjDvE,MAAMC,UAAUjI,QAAQkI,KAAK+I,EAAU+2C,MA8BvC,CACEx+D,KAAM,SAAS4f,GAAO,OAAOA,IAASi8C,IACtCphD,IA9EJ,SAAwBmF,GACtBviB,EAAU,aAAc,kBACxBuiB,EAAKhL,WAAWyK,UAAY,qBAX5Bo+C,GADAF,GAAY,EAEZG,GAAY;AAYZ,IAAI9wC,EAAM,CAAC1Z,EAAE2Z,KAAK5yB,UAAUuiB,KAAKqhD;AACjCr/C,MAAMC,UAAUjI,QAAQkI,KATZs9C,GAAar6C,mBACZ+K,KAAK,GAAGlN,SAAS,GAAGA,SAQY,SAASvQ,GACzB,IAAvBA,EAAGuQ,SAASzf,QACd6sB,EAAIlsB,KAAKkX,GAAU3I,EAAGiG,MAAMsH,KAAK+hD,OAGrCrrD,EAAE2Z,KAAKpqB,MAAMyQ,EAAG0Z,GAAKpQ,KAAK2hD,MAsE1B,CACEn+D,KAAM,SAAS4f,GAAO,OAAOA,IAASk8C,IACtCrhD,IArEJ,WACEpd,EAAU,aAAc;AACxB,IAAIoqB,EAAWu0C,GAAaz9C,uBAAuB;AACnDC,MAAMC,UAAUjI,QAAQkI,KAAK+I,EAAU,SAASxY,GAC9CA,EAAG6pB,YAmEL,CACE94B,KAAM,SAAS4f,GAAO,OAAOA,IAASm8C,IACtCthD,IAAK,WACHpd,EAAU,aAAc,sBACxB2kB,GAAayN,MAGjB,CACEzvB,KAAM,SAAS4f,GAAO,OAAOA,EAAK9K,UAAU+Q,SAAS,eACrDpL,IA9DJ,SAAsBmF,GAEpBhI,GADWgI,EAAKL,uBAAuBrK,MACvBsH,KAZlB,SAAqBoD,EAAMre,GACzB,IAAI4yC,EAAWzL,GAAQnnC;AACN,yBAAb4yC,EACWv0B,EAAKhL,aACLgL,EAAKhL,WAAWyK,UAAY,IAEzCnM,EAAE,eAAe7Y,KAAK85C,GAAUl+B,OAAO,SAMRzT,KAAK,KAAMod,MA8D5C,CACE5f,KAAM,SAAS4f,GAAO,OAAOA,EAAK9K,UAAU+Q,SAAS,gBACrDpL,IA3CJ,SAAqBmF,GACnB,IAAI7lB,EAAK6lB,EAAKqM,QAAQ0yC,OAClBnlB,EAAK55B,EAAKhL;AACd4kC,EAAGn6B,UAAY,GACfm6B,EAAG15B,UAAY,kBACf05B,EAAG31C,MAAM4b,gBAAkB,QAAWjO,GACpC;AACF,IAAIob,EAAM;AACV+wC,GAAc5jE,GAAIkkE,IAAIznD,QAAQ,SAAStB,GACrC0X,EAAIlsB,KAAKkX,GAAU1C,GAAMsH,KAAKiiD,OAEhCvrD,EAAE2Z,KAAKpqB,MAAMyQ,EAAG0Z,GAAKpQ,KAAK,WACxBmhD,GAAc5jE,GAAIg2B,IAAIvZ,QAAQ,SAASvH,GAAKA,EAAGoQ,UAAY,KAC3Dm6B,EAAG5kC,WAAW+d;AAkClB,SAASisC,GAAeC,EAAWziE,GACjC,IAAI0iE,EAAYxmD,GACd,CAACwH,UAAW,WAAYvkB,YAAaa;AAIvC,OAHAyiE,EAAUtjE,YAAc,IACxB4d,GAAc0lD,EAAWC,GACzBtkE,EAAoBqkE,EAAW,KACxBC,EG/MT,ICRIzrB,GACAp1C,GACA42B,GDMAkqC,GAAgB,CAClBn/C,KAAM,CAACyQ,MAAO,WAAYtuB,QAAS8O,EAAS,qBAC5CmuD,SAAU,CAAC3uC,MAAO,eAAgBtuB,QAAS8O,EAAS,qBACpDouD,IAAK,CAAC5uC,MAAO,cAAetuB,QAAS8O,EAAS,qBAC9Cm0B,MAAO,CAAC3U,MAAO,SAAUtuB,QAAS8O,EAAS;AAyB7C,SAASquD,GAAS96C,GAChB,OAAIA,EACKA,EAAIO,cAAc1nB,QAAQ,SAAU,KAAK2G,MAAM,WAEjD,GAuBT,SAASu7D,GAAkB7a,GAEzB,OADA79B,GANF,SAAqB69B,GACnB,IAAI8a,EAAgB,qBAAqBnuD,KAAKqzC,EAAMpvC;AACpD,GAAIkqD,EAAgB,OAAO9jE,OAAO8jE,EAAc,IAItCC,CAAY/a,KACP79B,KAAYe,MACzB3J,GAAS,YAAaymC,EAAMrpD,MACrB,QApBX,SAA8BqkE,GAC5B,IALuBC,EAKnBC,EAAW,CACb,CAACx/D,KAAMk/D,GAASruD,EAAS,cAAe5S,KAAM,YAC9C,CAAC+B,KAAMk/D,GAASruD,EAAS,cAAe5S,KAAM,OAC9C,CAAC+B,KAAMk/D,GAASruD,EAAS,cAAe5S,KAAM,UAE5CshE,EAAMD,EAAK36C,cAAc1nB,QAAQ,SAAU,KAC3CwiE,EAASD,EAAS59C,MAXC29C,EAWoBA,EAVpC,SAAStwD,GAAK,OAAOA,EAAGjP,KAAKlE,SAASyjE;AAW7C,GAAIE,EAAS,OAAOA,EAAOxhE,KAcpByhE,CAAqBpb,EAAMrpD,MAa7B,SAAS0kE,GAAsB//C,GACpC,IAXsB0kC,EAWlBA,EAAQrqD,SAASy+B,cACnB;AACE4rB,GAZJoa,GAA2BS,GADL7a,EAaKA,MAVzBA,EAAM1vC,WAAWE,UAAU5S,IACzB68D,GAAcL,IAA0BruC,OAC1C71B,EAAoB8pD,EAAM1vC,WAAY,OACpCmqD,GAAcL,IAA0B38D,UAOC6d,GAC3C/B,GAAS,YAAa,IEjFX,SAAS+hD,GAAyBC,EAAQC,EAAUC,GACjE,IFQ+BA,EAWFD,EAAUC,EEnBnCC,EAAU,wBACdA,GAAW,qDACTl/C,GAAcg/C,GAAY,qBAAuBC,EACjD,oCAAsCvuD,GACtC,8DACGX,EAAS,6BAQZmvD,GAAW,4JADcnvD,EAAS,sBAIX,4CACrBW,GACA,mDAZFwuD,GAAW,yKAGTxuD,GACA;AAUJwuD,GAAW,kFACyCF,EAClD,wBAA0BC,EAC1B,gDACAvuD,GAAc,8CAChBwuD,GAAW,mGAETD,EAAa,yCAA2CA,EACxD,oCAAsCvuD,GACtC,sCACFwuD,IFtB+BD,EEsBHA,EFrBK,SAA7BrB,GACK,oGAELqB,EAAa,oCAAsCA,EACnD,oCAAsCvuD,GACtC,sCAEG,IEePwuD,IFZ6BF,EEYHA,EFZaC,EEYHA,EFXH,SAA7BrB,IAAuC7tD,EAAS,aAC3C,2HAELivD,EAAW,uBAAyBC,EACpC,oCAAsCvuD,GACtC,WAAaiV,GAAU,kCAEpB,IEMPhJ,GAAmBoiD,EADnBG,GAAW,UCpCb,SAASC,GAAe37D,EAAQ47D,EAAkBC,GAChD,IAAIC,EAAK;AACLD,GAAkCD,GAAjBC,IACnBC,EAAK,IAAMD,GAEb3lE,EAAoB8J,EAAQ,+BAC1B47D,EAAmBE,EAAK,WAc5B,SAASC,GAAcpxD,GACrB,IAZyBqxD,EACrBh8D,EACA47D,EAUAI,EAA8B,WAAnBrxD,EAAG1T,YACdglE,EAA+B,YAAnBtxD,EAAG1T,aACf+kE,GAAYC,KAdSD,EAeLA,EAdhBh8D,EAcY2K,EAdA2F,WACZsrD,EAAmB57D,EAAOs6B,YAAYA,YACvC7b,qBAAqB,SAAShjB,OAAS,EAExCkgE,GAAe37D,EAAQ47D,EAAkBrvD,EADvCyvD,EACgD,cAEA,kBCdtD,SAASE,KACP,IAAIC,EAAc3mE,EAAe;AACD,aAA5B2mE,EAAYllE,YACdklE,EAAYllE,YAAc,WAE1BklE,EAAYllE,YAAc,WAE5BzB,EAAe,gBAAgBgb,UAAUwd,OAAO,WAoDlD,SAASouC,GAAYC,GACnB,IAL0BC,EAASC,EAAOC,EAKtCvf,EAAcof,EAAQthD,UACtB0hD,EAAsBlwD,EAAS,2BAC/BmwD,EAAgBnwD,EAAS,sBACzBowD,EAAgB1f,EAAYhjD,OAAO,EAAGwiE,GACvCn9D,MAAM,UAAU7D,OAAS,GATF6gE,EAUKG,EAVIF,EAUiBI,EAVVH,EAWxCE,EADgBzf,EATPxhD,QAAU6gE,GAAWC,EAAQC,KAWnBE,GAAjBC,IACFF,EAvBJ,SAA2Bxf,EAAa2f,GAGtC,IAFA,IAAIF,EAAgBE,EAChBC,EAAa,EACM,EAAhBH,GACLA,GAAiB,EACjBG,EAAa5f,EAAY5iD,QAAQ,SAAUwiE,EAAa;AAE1D,OAAOA,EAgBiBC,CAAkB7f,EAAayf,IArDzD,SAAuBL,EAASpf,EAAawf,GAE3C,IAAIM,EAAa9f,EAAY5iD,QAAQ,OAAQoiE,GAAuB,EAChEO,EAAY;AAChB,GAAmB,IAAfD,EAAkB,CAEpB,GAAmB,KADnBA,EAAa9f,EAAY5iD,QAAQ,IAAKoiE,GAAuB,GACtC;AACvBO,EAAY,OAEd,IAAIC,EAAWhgB,EAAYxuC,UAAU,EAAGsuD,GACpCG,EAASjgB,EAAYxuC,UAAUsuD,EAAY9f,EAAYxhD,QACvD0hE,EAAgB,GAChBC,EAAiB,GACP,CAAC,IAAK,IAAK,IAAK,QACtBlrD,QAAQ,SAAS+6C,GACvB,IApBuBoQ,EAAeC,EAoBlCD,EAAgBH,EAAO7iE,QAAQ,KAAO4yD,EAAM,KAC5CqQ,EAAeJ,EAAO7iE,QAAQ,IAAM4yD,EAAM;AArBRqQ,EAsBDA,GArBb,KADDD,EAsBDA,KApBNA,EAAfC,IAAkD,IAAlBA,KAqB/BH,GAAiB,IAAMlQ,EAAM,IAC7BmQ,GAAkB,KAAOnQ,EAAM,OAGnCoP,EAAQthD,UAAYkiD,EAAWG,EAAiBJ,EAC9C,yGAC6CG,EAAgBD,EAC7D,UACF1nE,EAAe,kBACZkJ,iBAAiB,QAASw9D,IA4B7BqB,CAAclB,EAASpf,EAAawf,IAmBtC,SAASe,GAAaliD,GACpB,OAAkBA,GARH/O,EAAS,mBAQe+O,GAJvB/O,EAAS,mBAO3B,SAASkxD,GAAcniD,EAAM+gD,GApB7B,IAAkBA,EACZpf;AAoBAugB,GAAaliD,KAnBjB2hC,EAAcF,GADVE,GADYof,EAsBLA,GArBethD,cAGxBshD,EAAQthD,UAAYkiC,GC7ExB,SAASygB,KACP,IACI/jE,EADSnE,EAAe,iBACVykB,uBAAuB,gBAAgB,GACtDkH,aAAa,aACZoF,EAAQ5wB,SAASgb,iBAAiB,gBAAkBhX,EACtD;AACF,GAAqB,IAAjB4sB,EAAM9qB,OAAV,CACA,IAAIkiE,EAAahoE,SAASgb,iBAAiB,gBAAkBhX,EAC3D;AACsB,EAApBgkE,EAAWliE,SAAa8qB,EAAQo3C,GACpCzjD,MAAMC,UAAUjI,QAAQkI,KAAKmM,EAAO,SAAS5b,GAAKA,EAAG6pB,WCAvD,SAASopC,GAAOC,GACd,IAAIC,EAAQtoE,EAAe;AAC3B,GAAKsoE,EAAL,CACA,IAhBcD,EAAQE,EAClBC,EAEAC,EACAC,EACAC,EACAC,EAUAL,EAAU/mE,OAAO8mE,EAAM/0C,WAAW9xB,YAAY4+B;AAC7CxS,MAAM06C,KAjBGF,EAiBeA,EAjBPE,EAiBeA,EAhBjCC,EAAUhnE,OACZxB,EAAe,gBAAgBuzB,WAAW9xB,YAAY4+B,QACpDooC,EAAYJ,EAAOl2C,QAAQC,OAC3Bs2C,EAAS,mBAAmBvxD,KAAKsxD,GACjCE,EAASnnE,OAAOknE,EAAO,IACvBE,EAAYvnE,KAAK8Y,MAAMouD,EAAUI,EAAS,OAC9CN,EAAOl2C,QAAQC,OAASq2C,EAAU3wD,MAAM,GAAI,IAC1C,gBAAkBywD,EAAUK,GAAWhkE,WACvC,yBAA2B4jE,EAAUI,GAAWhkE,WAChD,oBCVJ,SAASikE,GAAgB1zD,GACvB,IAAI2zD,EAAM3zD,EAAG8T,qBAAqB;AAClC9T,EAAG2F,WAAWyK,UAAYujD,EAAI,GAAGvjD,UAAUpiB,QAAQ,UAAW,KAC5D,mCAAqC2lE,EAAI,GAAGrnE,YAAc,SCoB9D,SAASsnE,GAAOjjD,GZGD,IACTkjD,EAEAC,EACAC,EACAC,Ea3BAC;ADoBAtjD,IboCqB9lB,EAAe,sBACrC+oB,iBACgB7f,iBAAiB,QAASo5D,IAAiB,GQ/B9D59C,MAAMC,UAAUjI,QAAQkI,KACtBzkB,SAASgb,iBAAiB,6BAA8BorD,IKJxDjD,KX4LW,WACb,IAAI+F,EAAYvF,GAAa3jE;AAC7B,GAAyB,IAArBkpE,EAAUpjE,OAAd,CAEA,IAAIqjE,GADJpH,GAAemH,EAAU,IACEvuD,WACvByuD,EAAQhrD,GAAU,CAACyH,UAAW;AAClC27C,GAAcpjD,KACdqjD,GAAUrjD,KACVsjD,GAAYtjD,GAAU,CAACyH,UAAW;AAClC,IAAIwjD,EAAQjrD;AACZujD,GAAUgD,GAAenD,GAAa,oBACtCI,GAAU+C,GAAelD,GAAS,oBAClCI,GAAa8C,GAAejD,GAAW,sBACvCI,GAAK6C,GAAe0E,EAAO,4BAC3BnqD,GAAckqD,EAAO5H,IACrBtiD,GAAckqD,EAAO3H,IACrBviD,GAAckqD,EAAOC,GACrBnqD,GAAckqD,EAAO1H,IACrBxiD,GAAciqD,EAASC,GACvBD,EAAQpgE,iBAAiB,QAAS2qB,GAAa8oB,MW9M7C8sB,GExBW,WAEb,IAAIrxD,EAAOjY,SAASy+B,cAAc;AAElC,GAAKxmB,EAAL,CACA,IAAIsiD,EAAOl8C,GAAW,CAAC+G,UAAW,YAC9BsR,EAAKrY,GAAW,CAACwH,UAAW,WAAYT,UAAW;AACvDlG,GAAcq7C,EAAM7jC,GACpBywB,GAAoBoT,EAAM,KAC1Br7C,GAAcjH,EAAK0C,WAAY4/C,GAC/B7jC,EAAG3tB,iBAAiB,QAAS,WAC3B3F,EAAU,UAAW,mBACrB2kB,GAAayR,OFab+vC,GHdW,WAEb,IAAItxD,EAAOjY,SAASy+B,cAAc;AAElC,GAAKxmB,EAAL,CACA,IAAIuxD,EAAUnrD,GAAW,CAACwH,UAAW,YAAavkB,YAAa;AAC/DkoE,EAAQzgE,iBAAiB,QAASg/D;AAClC,IAAI77B,EAAU7tB,GAAW,CAAC+G,UAAW;AACrClG,GAAcgtB,EAASs9B,GACvBjpE,EAAoB2rC,EAAS,iBAC7BhtB,GAAcjH,EAAK0C,WAAYuxB,IGK7Bu9B,GC3BER,EAAe1kE,SAAS1E,EAAe,WAAWyB,YAAa,IAC/D2lB,GAASjnB,SAASskB,uBAAuB,cAAc,GACxDoD,mBAAmBpmB,eAAiB2nE,EACrCrlD,GAAS,wBAAyB,IAElCA,GAAS,wBAAyBqlD,GbkBhCJ,EAAqBhpE,EAAe,sBAEpCipE,GADJvH,GAAsB1hE,EAAe,wBACF8a,WAAW+M,mBAC1CqhD,EAAW3qD,GAAU,CAACyH,UAAW,cACjCmjD,EAASpqD,GAAa,CACxBiH,UAAW,eACXvkB,YAAa,UAEf6lD,GAAoB4hB,EAAU,MAC9B7pD,GAAc6pD,EAAUC,GACxB7hB,GAAoB4hB,EAAU,MAC9BF,EAAmB1a,aAAa4a,EAAUD,GAC1CE,EAAOjgE,iBAAiB,QAASs6D,IJoBjC5/C,GAAI1a,iBAAiB,QAASu4D,KgBZjB,SAASoI,KACtB,IAAIrwD,KAAJ,CACA,IAAIusD,EAAS5lE,SACVy+B,cAAc;AACjB,GAAKmnC,EAAL,CACA,IAd2BA,EFjBvBsC,ECZAyB,EH6FmChkD,EACnC+gD,EInDAZ,EAAariD,GAAIqF,qBAAqB,MAAM,GAAGxnB,YAC/CqkB,EAAOmgD,IAAej9C;AAC1B+/C,GAAOjjD,GAEP+/C,GAAsB//C,GAGtBggD,GAAyBC,EADVl/D,EAASkS,GAAgB,aAAcxX,KACX0kE,GArBhBF,EAwBPA,EAvBD,YAuBXE,IAtBNF,EAAO9B,IAAM,iDACb8B,EAAO78D,iBAAiB,QAAS,WAC/BkQ,EAAE,eAAejY,KAAK,WAAWgb,OAAO,YFrBxCksD,EAASloE,SAASy+B,cACpB,gDACWwpC,GAAOC,GCdhByB,EAFY9pE,EAAe,qBAC5BipB,qBAAqB,SAAS,GACLA,qBAAqB,SACjDvE,MAAMC,UAAUjI,QAAQkI,KAAKklD,EAAajB,IH4FH/iD,EIhCtBA,GJiCb+gD,EAAU7mE,EAAe,kBAE7BioE,GAAcniD,EAAM+gD,GAChB9vD,EAAS,wBAAyB6vD,GAAYC,GAClDA,EAAQ39D,iBAAiB,QAASk+C,KIpClC+Z,KACA/4D,EAAI,EAAGy0B,MPtET,SAASktC,GAAYjjD,EAAG3R,GACtBA,EAAG0lB,SAAW1lB,EAAG60D,WAAa70D,EAAG0lB,QAGnC,IULIu0B,GCAO/6C,GACAvI,GACA4G,GACA4B,GCIAglC,GACA2wB,GCkBPC,GACAC,GACAxZ,GACAyZ,GACA7wB,GACA8wB,GACAC,Gb3BAC,GAAQ,CACV,CACEtU,EAAG,WAAY,MAAgB,UAAT9xD,IACtBge,EAAG,SAAS2E,EAAG3R,GACbA,EAAG0lB,SAAW1lB,EAAG60D,WAA6C,IAAjCzwB,GAASzyB,EAAE0jD,OAAOnT,YAGnD,CACEpB,EAAG,SAASnvC,GACV,MAAgB,SAAT3iB,IAAmBo1C,GAASzyB,EAAE0jD,OAAOv1C,UAAY8F,IAE1D5Y,EAAG4nD,IAEL,CACE9T,EAAG,WAAY,MAAgB,aAAT9xD,IACtBge,EAAG4nD;AAWQ,SAASU,GAAanxB,EAAUoxB,EAAWC,EAAOC,GAC/DrxB,GAAWmxB,EACXvmE,GAAOwmE,EACP5vC,GAASv5B,OAAOopE,GAChBtxB,EAAS58B,QAAQ,SAASoK,GAExB,IADSA,EAAE+jD,WAAW/vD,WACfE,UAAU+Q,SAAS,WAA1B,CACA,IAdcjF,EAAG3R,EACfzT,EAaEyT,EAAK2R,EAAE3R,GAAG2F,WAAWA,WAAW2K,uBACjCkN;AAfW7L,EAgBLA,EAhBQ3R,EAgBLA,GAfVzT,EAAQ6oE,GAAMziD,KAAK,SAAS5hB,GAC9B,OAAOA,EAAK+vD,EAAEnvC,OAEJplB,EAAMygB,EAAE2E,EAAG3R,MclBV,SAAS21D,GAAgBlwB,GACtC,GAAqB,eAAjB73C,EAAK89C,QAA0B,CACjC,IAAIkqB,EAAWnnD,GAAIqF,qBAAqB,QAAQ;AAChD,GAAI8hD,EAAU,CACZ,IAAI7xC,EAAKva,GAAS,CAACqH,UAAW,cAC1BopC,EAAaxwC,GAAS,CAACohD,QAAS;AACpC3gD,GAAc6Z,EAAIk2B,GAClB2b,EAASjwD,WAAW2I,aAAayV,EAAI6xC,GACrC3b,EAAW7pC,UAAYo1B,GAAgBC,GAZ3Cl3B,IADIsnD,EAAQpnD,GAAIqF,qBAAqB,SAAS,GAAG2J,MACtBo4C,EAAM/kE,OAAS,GAAG4sB,MAAM,GACjD,iEAHJ,IACMm4C,EJMN,SAASC,GAAc16C,GACrB,OAAIA,EAAc,OACX,OAGM,SAAS26C,GAAgBp/D,EAAgB4G,GAGtD,GAjBF,WACE,IAAK08C,GAAY,CACf,IAAI+b,EAAOvnD,GAAIqF,qBAAqB;AAClB,EAAdkiD,EAAKllE,SACPmpD,GAAa+b,EAAK,GAAG1lD,uBAAuBkN,oBAYhDy4C,GACIhc,GAAY,CACd,IAAIpkC,EAAS,kDACXigD,GAAcn/D,GAAkB,sFAEhCm/D,GAAcv4D,GAAsB;AACjB,eAAjB3P,EAAK89C,UACP71B,GAAU,+FAGZokC,GAAW7pC,UAAYyF,GKvBZ,SAASqgD,GAAYvlD,EAAMzd,EAAI6oC,EAASo6B,GACrDxlD,EAAKE,UAAY,cAEjB3d,EAAG,CADayd,EAAK6F,aAAa,eAClBjJ,KAAK,SAASjb,GACb,IAAXA,EAAK0a,IACT2D,EAAK/b,MAAMwsB,MAAQ,QACnBzQ,EAAKP,UAAY2rB,KAEnB93B,EAAE0M,GAAM6hB,KAAK,QACE7hB,EAdVP,UAAY,wCACf7N,GACA;AAaF,IAAIg7C,EAAQ5sC,EAAKhL,WACbywD,EAAc7Y,EAAM9zB,cAAc0sC;AAClCC,IACFA,EAAYvlD,UAAY,cACxBulD,EAAYhmD,UAAY;AAE1B,IAAIosC,EAAWe,EAAM53C,WAAW6X,kBAAkBA;AAClDg/B,EAAS92B,SAAU,EACnB82B,EAASqY,UAAW,EHPf,SAASnuB,KACdslB,KDDA9sD,GAAsB0C,EAAS,uBAC/BjL,GAAiBiL,EAAS,kBAC1BrE,GAAqBqE,EAAS,sBAC9BzC,GAAqByC,EAAS,sBCA9Bm0D,GAAgBp/D,GAAgB4G;AAEhC,IAVIopC,EAUAC,GAVAD,EAAYl4B,GAAIqF,qBAAqB,UACf6yB,EAAU71C,OAAS,GAC5BgjB,qBAAqB;AAStCqwB,GAAW,GACX2wB,GAAY,GACZvlD,MAAMC,UAAUjI,QAAQkI,KAAKm3B,EAAS,SAAS5mC,GAC7C,IAAIid,EAASjd,EAAGgd,QAAQC;AACxB,GAAIA,EAAQ,CACV,IAAImwB,EAAUnwB,EAAO1wB,MAAMsY;AAC3BiwD,GAAU1nB,EAAQ,KAAO0nB,GAAU1nB,EAAQ,KAAO,GAAK;AACvD,IAAIsoB,EAAa11D,EAAG2F,WAAWA,WAAW+M;AAC1CyxB,GAAS1yC,KAAK,CACZuO,GAAIA,EACJq1D,MAAOjoB,EAAQ,GACfsoB,WAAYA,OAKlBZ,GAAU,OAAS,ECcrB,IAAIuB,GAAe,CACjB,CACEtlE,KAAM,SAASouB,GAAO,OAAQq8B,IAAwC,IAA5BsZ,GAAU31C,EAAKW,UACzDtU,IAAK,SAASmG,EAAGwN,GACf,MAAO,mBAAqBA,EAAKW,QAC/B,wCAGN,CACE/uB,KAAM,SAASouB,GACb,OAAQg2C,IAAah2D,KAAuBggB,EAAKgjC,OAEnD32C,IAAK,SAASmG,GACZ,MAAO,6DACWA,EAAE0jD,MAAQ,2GAIhC,CACEtkE,KAAM,SAASouB,GACb,OAAQ81C,IAAa13D,KAA0C,IAApB4hB,EAAK+iC,WAElD12C,IAAK,SAASmG,GACZ,MAAO,6DACLA,EAAE0jD,MAAQ;AAMlB,SAASiB,GAAU3kD,EAAGwN,GApCtB,IAAuBxN,EAAGwN;AAAHxN,EAqCPA,EArCUwN,EAqCPA,EApCZ+1C,IAAch2D,IACjByS,EAAE+jD,WAAW7vD,UAAU5S,IAAIqR,GAAO6a,EAAK7a,QAAQE;AAoCjD,IAAI+xD,EAAUF,GAAav/C,OAAO,SAASC,EAAM/W,GAC/C,IAAI+gB,EAAMhK;AAIV,OAHI/W,EAAGjP,KAAKouB,KACV4B,GAAO/gB,EAAGwL,IAAImG,EAAGwN,IAEZ4B,GACN;AACa,KAAZw1C,GAAiBhrE,EAAoBomB,EAAE+jD,WAAYa,GAGzD,SAASC,GAAY7kD,EAAGwN,GAClBA,KA7DN,SAAoBxN,EAAGwN,GACrB,IAAIztB,EAASqjE,IAAap+D,IAA1B,CACA,IAAI4/D,EAAU;AACTp3C,EAAKgjC,QACRoU,GAAW,+CACTlnC,mBAAmBlQ,EAAKa,WAAa,aAEzCu2C,GAAW,oBAAsBnxD,GAAW,6BAC1C+Z,EAAKW,QAAU,qCACjBvR,GAAqBoD,EAAE+jD,WAAYa,IAqDjCE,CAAW9kD,EAAGwN,GACdm3C,GAAU3kD,EAAGwN,IAYjB,SAASu3C,KAEP,IADA,IAAI7vC,EAAQh7B,YAAYC,MAAQ,EACzB86B,GAASC,EAAOmuC,GAAY7wB,KAAW,CAC5C,IAAIxyB,EAAIwyB,GAAS6wB;AAEjBwB,GAAY7kD,EADDyyB,GAASzyB,EAAE0jD,QAEtBL,IAAc,EAEZA,GAAa7wB,GAASrzC,OACxBmC,EAAI,EAAGyjE,KAhBL//D,KAAiBo+D,IAAa,GAElCG,GADA1Z,IAAW,EAEPj+C,KAAqB03D,IAAY,GACrCE,IAAY,GA8Cd,IAAIwB,GAAO,CACT,CACE5lE,KAAM,SAAS4f,GAAO,MAAmB,sBAAZA,EAAK7lB,IAClC0gB,IA/BJ,WFrHEoD,GAAS,iBADTjY,IAAkBA,IEwHlBo/D,GAAgBp/D,GAAgB4G,IAC3Bw3D,GAIH5wB,GAAS58B,QAAQ,SAASoK,GAExBwR,GADSxR,EAAE+jD,WAAWl4C,mBACL7mB,OALnBq+D,GAAa,EACb/hE,EAAI,EAAGyjE,OA4BT,CACE3lE,KAAM,SAAS4f,GAAO,MAAmB,0BAAZA,EAAK7lB,IAClC0gB,IArBJ,WF9HEoD,GAAS,qBADTrR,IAAsBA,IEiItBw4D,GAAgBp/D,GAAgB4G,IAC3B03D,GAIH9wB,GAAS58B,QAAQ,SAASoK,GAExBwR,GADSxR,EAAE+jD,WAAWjsC,cAAc,cACnBlsB,OALnBy3D,GAAa,EACb/hE,EAAI,EAAGyjE,OAkBT,CACE3lE,KAAM,SAAS4f,GAAO,MAAmB,4BAAZA,EAAK7lB,IAClC0gB,IAAK,WAAY8pD,GAAanxB,GAAUC,GAAU,WAEpD,CACErzC,KAAM,SAAS4f,GAAO,MAAmB,YAAZA,EAAK7lB,IAClC0gB,IAAK,WGtKM,IAA2B24B,EAEpCyyB,EADA9yC,EAEA+yC,EACAC,EACAn5C;AALoCwmB,EHsKHA,GGrKjCrgB,EAAWj5B,EAAe,kBAAkBoB,MAE5C4qE,EAAU,EACVC,EAAU,GACVn5C,EAAM,GACVwmB,EAAS58B,QAAQ,SAASoK,GACfA,EAAE+jD,WAAWplD,uBAAuBA,uBAC1CkN,kBACIkI,UACLkxC,EAAU1qE,KAAK8Y,MAAM6xD,EAAU,IAC/BC,EAAQF,GAAWllE,EAASolE,EAAQF,GAAU,IAC9CE,EAAQF,GAASnlE,KAAKkgB,EAAE0jD,QACxBwB,GAAW,GACG,IAAO,GACnBl5C,EAAIlsB,KAAKwxD,GAAS6T,EAAQF,GAAU9yC,OAItC+yC,EAAU,IAAO,GACnBl5C,EAAIlsB,KAAKwxD,GAAS6T,EAAQF,GAAU9yC,IAEtC7f,EAAE2Z,KAAKpqB,MAAMyQ,EAAG0Z,GAAKpQ,KAAK,WAAY1f,SAASilB,aHkJ/C,CACE/hB,KAAM,SAAS4f,GAAO,OAAOA,EAAKy7C,aAAa,WAC/C5gD,IAAK,SAASmF,GACZ2kD,GAAanxB,GAAUC,GAAU,OAAQzzB,EAAK6F,aAAa,aAG/D,CACEzlB,KAAM,SAAS4f,GAAO,OAAOA,EAAK9K,UAAU+Q,SAAS,aACrDpL,IAAK,SAASmF,GAAOulD,GAAYvlD,EAAM0yC,GAAU,OAAQ,eAE3D,CACEtyD,KAAM,SAAS4f,GAAO,OAAOA,EAAK9K,UAAU+Q,SAAS,aACrDpL,IAAK,SAASmF,GAAOulD,GAAYvlD,EAAMkyC,GAAU,UAAW,eAE9D,CACE9xD,KAAM,SAAS4f,GAAO,OAAOA,EAAK9K,UAAU+Q,SAAS,cACrDpL,IAAK,SAASmF,GI1LH,IAAqBwzB,EAAUC,EACxCtgB;AAD8BqgB,EJ0LCA,GI1LSC,EJ0LCA,GIzLzCtgB,EAAWz3B,OJyLwCskB,EIzL5BqM,QAAQiH,QACnCkgB,EAAS58B,QAAQ,SAASoK,GACxBA,EAAE3R,GAAG2F,WAAWA,WAAW2K,uBAAuBkN,kBAC/CkI,SAAU;AACb,IAAI3B,EAAKpS,EAAE+jD,WAAW/vD,WAClBoxD,EAAYhzC,EAAGrR;AACnB,GAAiB,IAAboR,EACFC,EAAGle,UAAU6d,OAAO,WACpBqzC,EAAUlxD,UAAU6d,OAAO;IACtB,CACL,IAAIO,EAASmgB,EAASzyB,EAAE0jD,OAAO11C,UAC3ByD,EAAQU,IAAaG;AACzBd,GAAYY,EAAIX,GAChBD,GAAY4zC,EAAW3zC,QJ8K3B,CACEryB,KAAM,SAAS4f,GAAO,MAAmB,cAAZA,EAAK7lB,IAClC0gB,IAAK,WAAY8pD,GAAanxB,GAAUC,GAAU;AAQtD,SAASmC,GAAUj0C,GAJnB,IAAiBA,GAAAA,EAKHA,IAJKA,EAAKspB,OAAUtpB,EAAKmzC,UAMrC+V,GADAuZ,IAAa,EAEb3wB,GAAW9xC,EAAKspB,MAGhBu5C,GADAF,GADAC,IAAY,EAGZF,GAAa,EACb/hE,EAAI,EAAGyjE,IACPf,GAAgBrjE,EAAKmzC,UAGR,SAASuxB,KAClB3yD,OACJs/B,KAAmBp2B,KAAKg5B,IACxBtzC,EAAI,EAAGyzC,IACPj4B,GAAI1a,iBAAiB,QAAS2qB,GAAai4C,MK9M7C,IAAI5uD,GAAU,EACVkvD,GACF,ouBAeEC,GAAc,CAChBC,WAAY,eACZC,WAAY,iBACZC,WAAY,oBACZC,WAAY,SACZC,WAAY,mBACZC,WAAY,eACZC,WAAY,YACZC,YAAa;AAGf,SAASC,GAAe5sE,EAAK6sE,EAAK/hD,GAChC,IAAIgiD,EAAW9sE,EAAI6sE,IAAQ,EACvBE,EAAW;AACXD,EAAW,MAAMC,EAAW,UAChCjiD,EAAOzF,UAAY,gBAAkB0nD,EAAW,KAAOD,EAAW,WAGpE,SAASE,GAAS9rE,EAAO+rE,GACvB,OAAY,EAAR/rE,EAAmBA,EAAMwD,WAAauoE,EACnC,GAYT,SAASC,GAAQltE,EAAKqmD,EAAMv7B,GAC1B,IAVoBqiD,EAChBv2C,EACA1C,EACAk5C,EAOAl5C,EAAIvtB,EAAS3G,EAAIqmD,GAAO;AAC5B,GAAInyB,EAAG,CACL,IAAIk5C,GAZcD,EAYkBj5C,EAXlC0C,EAAIz1B,KAAK8Y,MAAMkzD,EAAK,IACpBj5C,EAAIi5C,EAAK,GACTC,EAAmBJ,GAASp2C,EAAG,KAC3B,EAAJA,GAAa,EAAJ1C,IAAQk5C,GAAoB,KACzCA,GAAoBJ,GAAS94C,EAAG;AAQ9BpJ,EAAOzF,UAAY,iEACO+nD,EAAmB,eACxC,CACL,IAAIC,EAAOvtE,EAAe,cACvB4+B,cAAc,oBAAsB2nB,EAAO;AAE5Cv7B,EAAOzF,UADLgoD,EACiB,2CACJA,EAAK5hD,aAAa,SAAW,oBAEzB,oCAYzB,SAAS6hD,GAAc3nD,GACrB,IAAI4nD,EAAU5nD,EAAIrb;AACQ,sBAAtBijE,EAAQznD,WAGZlI,GAFe,gDACb7b,OAAO6jB,KAAO,aAAe2nD,EAAQ9hD,aAAa,WAChCjJ,KAAK,SAASjb,GAChC,IAbcjD,EAcVA,EADMoe,GAAenb,GACRm3B,cAAc;EAdjBp6B,EAeDA,KAZ4C,IADxDA,EAAO/C,YAAYoD,QAClB,oDACkD,IAApDL,EAAO/C,YAAYoD,QAAQ,sBAYzB4oE,EAAQznD,UAAY,UACpBynD,EAAQloD,UAAY,QAK1B,SAASmoD,GAAkBjmE,GACzB,IAAIkmE,EAAWxtE,SAASy+B,cAAc,6BACpCn3B,EAAK2iC,SAAW,MACdiiB,EAAWshB,EAAS/uC,cAAc;AACjCytB,GAGHxnB,GAFAwnB,EAAW7tC,GAAW,CAACwH,UAAW,oBACrB2nD,EAAS1kD,qBAAqB,MAAM;AAGnDojC,EAAS9mC,UAAY,kBACnBykB,GAAmBviC,EAAK60B,YACxB,gBAAkB70B,EAAK6Z,gBAAkB,MACzC7Z,EAAKmmE,QAAU,MAAQvsE,KAAK8Y,MAAM1S,EAAK6Z,gBACvC7Z,EAAKmmE,QAAU,KAAO,MAiB1B,SAASC,GAAY14D,EAAI24D,EAAiBC,GACxC,GAAKD,EAAL,CAIA,IAAIE,EAAU74D,EAAG0S,mBAAmB8K,kBAAkBA,kBAClDs7C,EAAQvpE,SAASspE,EAAQvsE,YAAY0B,QAAQ,SAAU,IAAK,IAC5D+qE,EArBN,SAAuB/4D,EAAI44D,GACzB,IAAKA,EAAY,CACf,IAAI73C,EAAM1X,GAAW,CAACwH,UAAW;AAEjC,OADA6e,GAAmB3O,EAAK/gB,EAAG0S,oBACpBqO,EAET,OAAO63C,EAeaI,CAAch5D,EAAI44D,GAClCK,EAAgCN,EAAPG,EAZQ,SAC9B;AAYPC,EAAc3oD,UAAY,iBAAmB6oD,EAC3C,MAAQN,EAAkB,gBAR1BC,EAAWxoD,UAAY,GAoB3B,SAAS8oD,GAAcxoD,GACrB,IAAIwI,EAASxI,EAAIrb;AACjB,GAAuB,OAAnB6jB,EAAOtI,QAAX,CACAokB,GAAW9b,EAAO5sB,aAAaihB,KAAKgrD;AAEpC,IAAIY,EAAajgD,EAAOvT,WAAWiO,iBAAiBtnB,YAAYqI,MAAM;AACtEwkE,EAAaA,EAAWriD,OAAO,SAASC,EAAMC,GAC5C,IAA4B,IAAxBA,EAAKtnB,QAAQ,MAAc,CAC7B,IAAI0pE,EAAMpiD,EAAKriB,MAAM;AACrBoiB,EAAKqiD,EAAI,GAAGluC,QAAU37B,SAAS6pE,EAAI,GAAGprE,QAAQ,IAAK,IAAK,IAE1D,OAAO+oB,GACN;AAEH,IACIyB,EADY3tB,EAAe,cACNmb,iBAAiB;AAE1CuJ,MAAMC,UAAUjI,QAAQkI,KAAK+I,EA1B/B,SAAiB2gD,EAAYn5D,GAC3B,IACI24D,EAAkBQ,EADLn5D,EAAGwW,aAAa,cAE7BoiD,EAAa54D,EAAG0S,mBAAmBA,oBACnCimD,GAAmBC,IACrBF,GAAY14D,EAAI24D,EAAiBC,IAqBYrlE,KAAK,KAAM4lE,KAI5D,SAASE,GAASr5D,GAChB,IAAIs5D,EAAWt5D,EAAGwd,kBACd+7C,EAAaD,EAASt8C,QAAQC,OAC9B20B,EAAO5xC,EAAGsQ,uBAAuBkG,aAAa;AAClD8iD,EAASt8C,QAAQC,OAASs8C,EACvBvrE,QAAQ,YAAa,qBAAuB4jD,EAAO;AACtD,IAAIinB,EAAUS,EAAS97C,kBACnBs7C,EAAQvpE,SAASspE,EAAQvsE,YAAY0B,QAAQ,SAAU,IAAK;CAC3DkpE,GAAYl3D,EAAGwW,aAAa,SAAWsiD,EAAQ,KAClD94D,EAAG6F,UAAU5S,IAAI,UAQrB,SAASumE,KACP,IAAI7S,EAAc97D,EAAe,WAC9BipB,qBAAqB,MAAM;AAC9B,IAAkB6yC,GANK5+C,GAAU,EAS/B,OAFAA,IAAW,OACXQ,WAAWixD,GAAa;AAGrB7S,GACLA,EAAY98B,QASd,SAAS4vC,GAAW3xC,GAClB,IAAI8vC,EAAM9vC,EAAa4xC,cAAc5iD,OAAO,SAASC,EAAMC,GAEzD,OADAD,EAAKC,EAAKprB,MAAQorB,EAAK/qB,MAChB8qB,GACN,IACC4iD,EAAM7xC,EAAa8xC,QAAQ9iD,OAAO,SAASC,EAAMC,GAEnD,OADAD,EAAKC,EAAKprB,MAAQorB,EAAK6iD,SAChB9iD,GACN;AACH4gD,GAAeC,EAAK,UAAW/sE,EAAe,WAC9C8sE,GAAeC,EAAK,cAAe/sE,EAAe,WAClDotE,GAAQ0B,EAAK,eAAgB9uE,EAAe,UAC5CotE,GAAQ0B,EAAK,cAAe9uE,EAAe,UAC3CotE,GAAQ0B,EAAK,SAAU9uE,EAAe,WACtCotE,GAAQ0B,EAAK,YAAa9uE,EAAe,UAEzCA,EAAe,kBACZkJ,iBAAiB,QAASskE,IAC7BxtE,EAAe,WACZkJ,iBAAiB,QAASmlE;AAE7B,IA1BI/1B,EA0BA22B,EAASjvE,EAAe,cACzBmb,iBAAiB;AACpBuJ,MAAMC,UAAUjI,QAAQkI,KAAKqqD,EAAQT,KA5BjCl2B,EAAUt4C,EAAe,iBAC1B2rB,aAAa,WACW,KAAZ2sB,GAAiBq2B,KC7MnB,SAASO,GAAgBC,GACtC,OAAOA,EAAQljD,OAAO,SAASC,EAAMC,GAEnC,OADAD,EAAKC,EAAKprB,MAAQS,OAAO2qB,EAAK5K,OACvB2K,GACN,ICEL,IAAIkjD,GAAS;AAmBb,SAASC,GAAa5nE,GACQ,IAAxBA,EAAKsnE,QAAQ9oE,QAlBnB,SAAsBqpE,GACpB,IAAIC,EAAW3rD,GAAI+O,kBAAkBC,KAAK;AAC1C,GAAK28C,EAAL,CACA,IAAI5hD,EAAW4hD,EAAS18C,MAAM,GAAGF,kBAAkB1J,qBAAqB;AACxEvE,MAAMC,UAAUjI,QAAQkI,KAAK+I,EAAU,SAASxY,GAG9C,IAFA,IACIq6D,EADAp9C,EAASjd,EAAGgd,QAAQC,OAEqB,QAArCo9C,EAAYJ,GAAOj4D,KAAKib,KAC1Bk9C,EAAQE,EAAU,MAAQhuE,OAAOguE,EAAU,KAC7C9uE,EAAoByU,EAAG2F,WACrB,sCAAwC00D,EAAU,GAAK,IACvDA,EAAU,GAAK,qBASrBC,CADcP,GAAgBznE,EAAKsnE,UCvBvC,IAAIW,GAAU,mEACDh4D,GAAc;AAiC3B,IAAIyhB,GAAS,CACX,CAACjzB,KAAM,SAAUmC,GAhCnB,SAAoBwd,GAClBzM,EAAEyM,EAAIrb,QAAQm9B,KAAK;AACnB,IAAIsxB,EAAOpzC,EAAIrb,OAAOmhB,aAAa,QAC/B+mC,EAAQ7sC,EAAIrb,OAAOsQ,WAAWA;AACrB,MAATm+C,IAAevG,EAAQA,EAAM53C;AACjC,IAAIM,EAAOs3C,EAAM//B,kBAAkBvX;AACnC89C,GAAgB,CACdzkC,MAAOrZ,EAAK1Z,MAAM,aAAa,GAC/BH,SAAU6Z,EAAK1Z,MAAM,oBAAoB,GACzCu3D,KAAMA,EACNtrB,OAAQ9nB,EAAIrb,OAAOmhB,aAAa,YAE/BjJ,KAAK,SAASjb,GACE,IAAXA,EAAK0a,IACTuwC,EAAMntC,UAAY,sEAGtBmtC,EAAMntC,UAAYmqD,KAgBlB,CAACxpE,KAAM,QAASmC,GAblB,SAAkBwd,GAChBzM,EAAEyM,EAAIrb,QAAQm9B,KAAK;AACnB,IAAI+qB,EAAQ7sC,EAAIrb,OAAOsQ,WAAWA,WAAWA;AAE7Cic,GADW27B,EAAM//B,kBAAkBvX,KACpB1Z,MAAM,aAAa,IAAIghB,KAAK,SAASjb,GACnC,IAAXA,EAAK0a,IACTuwC,EAAMntC,UAAY,wCAEpBmtC,EAAMntC,UAAYmqD,KAMlB,CACExpE,KAAM,UACNmC,GAAI,SAASwd,GACX5jB,OAAOg9B,mBAAmBpZ,EAAIrb,OAAOmhB,aAAa;AAKzC,SAASgkD,GAAc9pD,GACpC,IAAK,IAAI7f,EAAI,EAAGA,EAAImzB,GAAOlzB,OAAQD,GAAK,EACtC,GAAI6f,EAAIrb,OAAOwQ,UAAU+Q,SAASoN,GAAOnzB,GAAGE,MAE1C,YADAizB,GAAOnzB,GAAGqC,GAAGwd,GCvCnB,IASI+pD,GACAC,GACAn0B,GACAo0B,GAZAC,GAAW,aACXC,GAAc,CAChBC,SAAS,EACTC,SAAS,EACTC,SAAS,EACTC,MAAO,GACPC,SAAU,GACVC,SAAU;AAmCZ,SAASC,GAASh0D,GAChB,OAAOf,OAAOiB,KAAKF,GAAKsP,KAAK+J,IAAO3J,OAAO,SAASznB,EAAQmC,GAE1D,OADAnC,EAAOmC,GAAO4V,EAAI5V,GACXnC,GACN,IA0BL,SAASgsE,KACPV,GAAQvqD,UAAY,iBAClB/J,OAAOiB,KAAKozD,GAAQO,OAAOnkD,OAAO,SAASC,EAAMukD,GAC/C,IAZgBpjD;AAahB,OAAOnB,EAAO,yBAA2BukD,EAAM,aAZ5C,kBADapjD,EAYWojD,GAV7B,2CACAj1D,OAAOiB,KAAKozD,GAAQO,OAAOnkD,OAAO,SAASC,EAAMukD,GAC/C,OAAOvkD,EAAO,kBAAoBukD,EAAM,IACtCra,GAAWqa,EAAKZ,GAAQO,MAAM/iD,IAAW,IAAMojD,EAAM,aACtD,IAAM,aAQL,cACD,IAAM,iHAqBb,SAASC,GAAYxkD,EAAMukD,GAQzB,MAP2B,WAAvBZ,GAAQO,MAAMK,KACZvkD,EAAK2jD,GAAQO,MAAMK,IACrBvkD,EAAK2jD,GAAQO,MAAMK,KAASb,GAAOa,GAEnCvkD,EAAK2jD,GAAQO,MAAMK,IAAQb,GAAOa,IAG/BvkD,EAGT,SAASykD,GAAkBC,EAAO1kD,EAAMukD,GACtC,OAAOvkD,EAAO,yBAA2BukD,EACvC,sCA7BgBI,GA8BJD,EAAMH,GAAOZ,GAAQQ,WAChCR,GAAQS,SAAWT,GAAQQ,UAAY,KA9BtCS,EAAOzvE,KAAKyf,IAAIzf,KAAK8hB,IAAI0tD,EAAS,KAAM,IAIjC,IACT1uD,EAAI,IACJ4uD,EAAI1vE,KAAKC,MAAM,IAAMwvE,KAErBC,EAAI,IACJ5uD,EAAI9gB,KAAKC,MAAM,IAAM,IAAOwvE,IAGvB,KAAO,UADF,MAAJ3uD,EAAkB,IAAJ4uD,EARd,GASmBnsE,SAAS,KAAKkT,OAAO,IAkBC,MAC/C84D,EAAMH,GAAK7rE,WAAa;AAhC5B,IAAoBisE,EAEd1uD,EACA4uD,EAFAD,EAkCN,SAASE,KACP,IAAIJ,EAAQp1D,OAAOiB,KAAKmzD,IAAQ3jD,OAAOykD,GAAa;AACpDh1B,GAAUn2B,UAAY,iBACpB/J,OAAOiB,KAAKm0D,GAAO3kD,OAAO0kD,GAAkBjoE,KAAK,KAAMkoE,GAAQ,IAC/D,mBAGJ,SAASK,GAASpxE,GACS,WAArBA,EAAE2K,OAAOub,UACX8pD,GAAQO,MAAMvwE,EAAE2K,OAAOzJ,MAAQlB,EAAE2K,OAAOpJ,MACxCmf,GAAUwvD,GAAUF,IACpBmB,MAiBJ,IAAIr0B,GAAS,CACX,CACEz2C,KAAM,SAAS4f,GAAO,MAAmB,aAAZA,EAAK7lB,IAClC0gB,IAhBJ,WAnFEkvD,GAAQO,MAAQ50D,OAAOiB,KAAKmzD,IAAQ3jD,OAAO,SAASC,EAAMukD,GAExD,OADAvkD,EAAKukD,GAAOA,EACLvkD,GACN,IAkFH3L,GAAUwvD,GAAUF,IACpBW,KACAQ,OAcA,CACE9qE,KAAM,SAAS4f,GACb,MAAO,aAAa5f,KAAK4f,EAAK7lB,KAEhC0gB,IAfJ,SAAmBmF,GACjB,IAAIorD,EAASprD,EAAK7lB;AAClB4vE,GAAQqB,GAAUprD,EAAK+U,QACvBta,GAAUwvD,GAAUF;AAgBtB,SAASsB,GAAQtxE,GACf,IAAIimB,EAAOjmB,EAAE2K,OAAOvK,GAChBmxE,EAAa/tB,GAAUxjD,EAAE2K,OAAOpJ,MAAO,EAAG;AAC1CgwE,IACFvB,GAAQ/pD,GAAQsrD,EAChB7wD,GAAUwvD,GAAUF,IACpBmB,MAIJ,SAASK,GAAO5pE,GAEd6U,GADAuzD,GAAUvzD,GAAO,GAAI0zD,IACLnpE,EAASY,EAAM,KAlH/B+T,OAAOiB,KAAKmzD,IAAQlzD,QAAQ,SAAS+zD,GAC9BZ,GAAQO,MAAMK,KAAOZ,GAAQO,MAAMK,GAAOA,KAEjDZ,GAAQO,MAAQG,GAASV,GAAQO,OAiHjC7vD,GAAUwvD,GAAUF;AACpB,IAAI/hB,EA9JGvvC,GAAU,CACfte,GAAI,YACJslB,UAAW,qDACTkS,GAAUo4C,GAAQI,SAAW,4GAG7Bx4C,GAAUo4C,GAAQK,SAAW,0FAG7Bz4C,GAAUo4C,GAAQM,SAAW,6CAsJ7BmB,EAAS/yD,GAAU,CAACte,GAAI;AAC5Bof,GAAcyuC,EAAWwjB,GACzB51B,GAAYn9B,GAAU,CAACte,GAAI,cAC3B+wE,KACA3xD,GAAciyD,EAAQ51B,IACtBo0B,GAAUvxD,GAAU,CAACte,GAAI,YACzBuwE,KACAnxD,GAAciyD,EAAQxB,IAEtBzwD,GAAciyD,EAzJP/yD,GAAU,CACfte,GAAI,aACJslB,UAAW,iDAETsqD,GAAQQ,SAAW,qEAGnBR,GAAQS,SAAW;AAoJvB,IAAIiB,EAAS3tD,GAAImF,iBAAiBiN,UAAU,GAAG8I,YAAY;AAC3DyyC,EAAOroE,iBAAiB,SAAU+nE,IAClCM,EAAOroE,iBAAiB,QAAS2qB,GAAa8oB,KAC9C40B,EAAOroE,iBAAiB,QAASioE,IACjC9xD,GAAckyD,EAAQzjB,GCrMxB,IAEIke,GACAwF,GACA7jD,GACAiiD,GCNA6B,GACAx3C,GCFA+xC,GACAr+C,GACA+jD,GACAC,GCYAtjE,GACAqhE,GHdAkC,GAAS,IAAInrE,OAAO;AAOxB,SAASorE,KAEP,IADA,IAAI71C,EAAQh7B,YAAYC,MAAQ,EACzB86B,GAASC,EAAOgwC,GAASwF,KAAY,CAG1CnyD,GAFSsO,GAASq+C,IACLwF,GAAUxF,KAEvBA,IAAW,EAETA,GAAUwF,GAAUvrE,QACtBmC,EAAI,EAAGypE,IAIX,SAAS78B,GAAY9uC,GACnB,OAAIA,EAAc,mBACX,GAmBT,SAAS4rE,GAAO38D,GACd,IAAI48D,EAAoC,IAAvB58D,EAAGuQ,SAASzf,OACzB+rE,EAAYh9B,IAAa+8B,GACzBE,EAAW98D,EAAGsQ,uBAAuBF;AAIzC,OAlBF,SAAmB+O,GACjB,IAAmC,IAA/BA,EAAKzvB,QAAQ,aAAqB,CACpC,IAAIotE,EAAW39C,EAAKnxB,QAAQ,YAAa;AACrCysE,GAAOqC,GACTrC,GAAOqC,IAAa,EAEpBrC,GAAOqC,GAAY,GASvBC,CAAUD,GAGHzzD,GAAW,CAChB+G,UAAW,QAAUysD,EACrB,6QAJah9B,GAAY48B,GAAO1rE,KAAK+rE,IAWrC,8BAV0BF,EArBV,SACX,SAgCL,qDAeJ,SAASI,KAEP,IADA,IAZch9D,EAYV6mB,EAAQh7B,YAAYC,MAAQ,GACzB86B,GAASC,EAAOgwC,GAASr+C,KAAW,CACzC,IAAIxY,EAAKwY,GAASq+C;AAdN72D,EAgBLA,EAfO,IAAZ62D,IACF72D,EAAGynB,gBAAgBvW,aAAa,QAAS,SACzClR,EAAGkR,aAAa,QAAS,WAEzBlR,EAAGynB,gBAAgB+iB,gBAAgB,SACnCxqC,EAAGwqC,gBAAgB,UAErB6xB,GAAU5qE,KAAKkrE,GAAO38D,IAUpB62D,IAAW,EAETA,GAAUr+C,GAAS1nB,OACrBmC,EAAI,EAAG+pE,KAEPnG,GAAU,EACV5jE,EAAI,EAAGypE,IDkHTjC,GAASW,GCjHGX,IDkHZj0D,GAAUo0D,IAAUrtD,KAAK2uD,KC9GZ,SAASe,KACtBzkD,GAAWxtB,SAASgb,iBAAiB,0DAErCy0D,GAAS,GACT4B,GAAY,GACZxF,GAAU,EACV5jE,EAAI,EAAG+pE,ICxFT,SAASE,KAEP,IADA,IAToBC,EAShBt2C,EAAQh7B,YAAYC,MAAQ,GACzB86B,GAASC,EAAOy1C,GAAax3C,KAAU,CAE5C,IAAI9kB,EAAK8kB,GAAQw3C,IACba,EAAUn9D,EAAG1T;AACjB0T,EAAGoQ,WAde+sD,EAcUA,EAbzBvvE,EAAKi7C,UAAUs0B,GACb91C,GAAU,CAACF,WAAYv5B,EAAKi7C,UAAUs0B,GAASh2C,aACpD,4CAA8Cv5B,EAAKi7C,UAAUs0B,GAASryE,GACtE,KAAOqyE,EAAU,sDACjBA,EAAU,cAJ0BA,GAcpCb,IAAe,EAEbA,GAAcx3C,GAAQh0B,QACxBmC,EAAI,EAAGiqE,IAII,SAASE,KACtBt4C,GAAU95B,SAASgb,iBAAiB,0EAEpCs2D,GAAc,EACdrpE,EAAI,EAAGiqE,IChBT,SAASG,KAEP,IADA,IAViBr9D,EAUb6mB,EAAQh7B,YAAYC,MAAQ,EACzB86B,GAASC,EAAOgwC,GAASr+C,KAAW,CACzC,IAAIxY,EAAKwY,GAASq+C,KAZH72D,EAcLA,GAbLoe,WAAWguC,aAAa,aAC7BoQ,GAAYx8D,EAAGoe,WAAWZ,kBAAkBlxB,cAAgBiwE,IAEzDC,KACHx8D,EAAG6Q,UAAY,WAWfgmD,IAAW,EAETA,GAAUr+C,GAAS1nB,QACrBmC,EAAI,EAAGoqE,IAII,SAASC,KAEtB,GADAf,GAAW34D,GAAgB,QAC3B,CACA,IAAI25D,EAAYvyE,SAASgb,iBACvB;AACauJ,MAAMC,UAAU1C,KAAK2C,KAAK8tD,EAAW,SAASv9D,GAC3D,OAAOA,EAAG1T,cAAgBiwE,OAG5B/jD,GAAWxtB,SAASgb,iBAAiB,uBACrC6wD,GAAU,EACV5jE,EAAI,EAAGoqE,MEST,SAASh6B,GAAS34C,GAChBA,EAAE4J,iBACFxH,OAAOe,SAAW,mDACFoW,EAAE,sCAAsCkR,MACtD,SAAWlR,EAAE,SAASkR,MAAQ,mBCrClC,SAASqoD,GAAU9yE,GACjB,IAjBsBimB,EAiBlBA,EAAOjmB,EAAE2K;AACY,QAArBsb,EAAKrkB,cAlBaqkB,EAmBLA,GAlBRL,wBACPklB,GAAoB7kB,EAAKL,uBAAuBhkB,aAmBzB,QAArBqkB,EAAKrkB,aAfX,SAAiBqkB,GAGf,IAFA,IAAI8sD,EAAa9sD,EAAKhL,WAAWA,WAAWA,WAAWA,WACnD+3D,EAAY,GACP1rE,EAAI,EAAGA,EAAIyrE,EAAWhgD,KAAK3sB,OAAQkB,GAAK,EAAG,CAClD,IAAI2rE,EAAYF,EAAWhgD,KAAKzrB,GAAG0rB,MAAM,GAAGU,WAAWA;AACvDs/C,EAAUjsE,KAAKksE,EAAUrxE,aAE3BkpC,GAAoBkoC,EAAUv7C,QAS5By7C,CAAQjtD,GAIZ,SAAS62B,GAAO98C,GACVA,EAAE2K,OAAOwQ,UAAU+Q,SAAS,UAAW4mD,GAAU9yE,GAGvD,SAAS4pD,GAAYmpB,GACnB,IAAK,IAAIzrE,EAAI,EAAGA,EAAIyrE,EAAWhgD,KAAK3sB,OAAQkB,GAAK,EAAG,CAElDzG,EADgBkyE,EAAWhgD,KAAKzrB,GAAG0rB,MAAM,GAEvC,iDAEJnyB,EAAoBkyE,EAAWhgD,KAAK,GAAGC,MAAM,GAC3C,iDAYW,SAASmgD,GAA0BC,GACvB,EAArBA,EAAYhtE,QAVlB,SAAmBgtE,GACjB,IAAK,IAAIjtE,EAAI,EAAGA,EAAIitE,EAAYhtE,OAAQD,GAAK,EAAG,CAC9C,IAAI4sE,EAAaK,EAAYjtE;AACzB4sE,EAAWhgD,KAAK3sB,OAAS,GAC7BwjD,GAAYmpB,GAEdK,EAAY,GAAG/pE,iBAAiB,QAASyzC,IAIZu2B,CAAUD,GCrD1B,SAASplD,GAAMzsB,GAC5B,OAAOI,OAAOqsB,MAAMzsB,GCCP,SAAS+xE,GAAcC,EAAQC,GAC5C,OCD4BD,EDCfA,ECDuBC,EDCfA,ECAjBC,EAASjyE,KAAKkyE,IAAI,GAAIF,GACtBxlD,GAAMylD,KAAUA,EAAS,GACtBjyE,KAAKC,MAAM8xE,EAASE,GAAUA,GDFL1uE;ACDnB,IAAewuE,EAAQC,EAChCC,ECSN,SAASE,GAAa7X,GACpB,OAAOA,EAAK9oC,MAAM,GAAGF,kBAAkBhH,aAAa,YAGtD,SAAS8nD,GAAgB9X,EAAM+X,GAC7B,IAAInvC,EAASivC,GAAa7X,GAAMx4D,QAAQ,WAAY;AACpD,IAAKuwE,EAAUnvC,GAAS,CACtB,IAAIovC,EAAWhY,EAAK9zC,mBAAmBgL,MAAM,GAAGpxB,YAC5CmyE,EAAW,GACoB,IAA/BD,EAAS9uE,QAAQ,WACnB+uE,EAAWtwC,GACTqwC,EAASxwE,QAAQ,mBAAoB,MAEzCuwE,EAAUnvC,GAAU,CAClBsvC,aAAcF,EACdC,SAAUA,EACV11C,KAAM,QAcZ,SAAS41C,GAAe3hB,EAAauhB,GACnC,IAAIK,EAAet1D,GAAY,CAACuH,UAAW,gBACvCs+C,EAAQ5lD,GAAY,CACtB6G,UAAW;AAIblG,GAAc00D,EAAczP,GAC5B9oD,OAAOiB,KAAKi3D,GAAWh3D,QAjBzB,SAAgBg3D,EAAWK,EAAcC,GACnCN,EAAUM,GAAOJ,SAAW3yE,IAChCP,EAAoBqzE,EAClB,6BAA+BC,EAAQ,kDAEvCN,EAAUM,GAAOH,aAAe,8BAChCH,EAAUM,GAAO91C,KAAO,eAWYx1B,KAAK,KAAMgrE,EAAWpP;AAE5D,IACIzlC,EADSszB,EAAYn8B,UAAU,GACd8I,YAAY;AACjCD,EAAQmhC,QAAU,EAClB3gD,GAAcwf,EAASk1C,GAgBlB,SAASE,GAAeC,EAAYC,EAASC,GAClD,IAAIC,EAAwBhzE,KAAK+hB,KAAK+wD,EAAU,EAAI;AACpD,GAAkBE,GAAdH,EACF,MAAO;AAET,IAAII,EAAiBD,EAAwBH;AAC7C,OAAqBE,EAAjBE,EACK,4CAEF,wBAA0BA,EAAiB,oBAG7C,SAASC,GAAYC,EAAsBN,GAChD,OAA6B,IAAzBM,EAAoC,EACpB,IAAbN,EAAmBM,EAG5B,SAASC,GAAa9Y,GACpB,IAAI+Y,EAAU/Y,EAAK9oC,MAAM,GAAGpxB;AAC5B,IAA8B,IAA1BizE,EAAQ7vE,QAAQ,KAApB,CACA,IAAIqvE,EAAa1yE,OAAOm6D,EAAK9oC,MAAM,GAAGpxB,aAClCkzE,EAAeD,EAAQ5qE,MAAM,KAC7BsqE,EAAY5yE,OAAOmzE,EAAa,IAChCR,EAAU3yE,OAAOmzE,EAAa;AAClCj0E,EAAoBi7D,EAAK9oC,MAAM,GAC7B,+BACAsgD,GAAcoB,GAAYJ,EAAUC,EAAWF,GAAa,GAC5D,iBAAmBf,GAA2B,IAAbe,EAAmBC,EAAS,GAC7D,cAAgBF,GAAeC,EAAYC,EAASC,GAAa,MAcrE,SAASQ,GAAaC,GACpB,IAAI5B,EAAcrvD,GAAIqF,qBAAqB;AAC3C+pD,GAA0BC;AAG1B,IAFA,IAdiBtX,EACbp3B,EACAuwC,EACArwC,EA/C2BowC,EAAWE,EA0DtCnC,EAAaK,EAAY,GACzB8B,EAAY,GACP/uE,EAAI,EAAGA,EAAI4sE,EAAWhgD,KAAK3sB,OAAS,EAAGD,GAAK,EAAG,CACtD,IAAI21D,EAAOiX,EAAWhgD,KAAK5sB;AAC3ByuE,GAAa9Y,GACb8X,GAAgB9X,EAAMoZ,GAnBPpZ,EAoBLA,OAnBRp3B,EAAAA,EAASC,mBAAmBgvC,GAAa7X,IACzCmZ,EAAQnZ,EAAK9oC,MAAM,GAAGF,kBAK1BtT,GAJIolB,EAASxlB,GAAa,CACxB7D,KAAMb,GAAW,yBAA2BgqB,EAC5C/5B,OAAQ,WAEYsqE,GACtBz1D,GAAcs8C,EAAK9oC,MAAM,GAAI4R,GApDaswC,EAkEPA,GAlEJF,EAkEPA,IAhExBr5D,OAAOiB,KAAKo4D,GAAWn4D,QAAQ,SAASs4D,GAClCD,EAAUC,IACVH,EAAUG,GAAUpB,UAAY3yE,KACpC8zE,EAAUC,GAAY,CACpBnB,aAAcgB,EAAUG,GAAUnB,aAClCD,SAAUiB,EAAUG,GAAUpB,SAC9B11C,KAAM,SA2DV41C,GAAeb,EAAY,GAAI8B,GAC/Bx0D,GAAU,aAAcw0D,GC3EX,SAASE,KAEtB,MAAO,yKA5CLh9C,GAAS,4BACP,8FAEF,gHAE+BR,GAAU10B,EAAKwK,wBAC9C,8FAC+BkqB,GAAU10B,EAAK6K,sBAC9C,gGAC+B6pB,GAAU10B,EAAK8K,mBAC9C,qGAC+B4pB,GAAU10B,EAAK2K,0BAC9C,kGAC+B+pB,GAAU10B,EAAK4K,oBAC9C,sBAmCA0qB,GAAe,iBACfA,GAAe,wBAhCV,4BAA8BN,GACnC,6BACAE,GAAS,6BACP,+DACF,6FAC+BR,GAAU10B,EAAK2L,sBAC9C,0GAEA+oB,GAAU10B,EAAK4L,uBAAyB,iFAExCoI,EAAS,8BAAgC,+BA0BzCshB,GAAe,6BACfA,GAAe,aACfA,GAAe,kBACfA,GAAe,YACfA,GAAe,gBACfA,GAAe,qBACfA,GAAe,sBACfA,GAAe,wBACfA,GAAe,qBACfA,GAAe,oBACfA,GAAe,kBACfA,GAAe,0BACfA,GAAe,uBAlCV,uDACLJ,GAAS,8BACP,2FAEF,gEACAlhB,EAAS,mBACT,2DACAA,EAAS,oBAAsB,eA+B/BshB,GAAe,uBACfA,GAAe,wBC5EnB,SAAS68C,GAAwBC,GAC/B,IAAIz1D,EAAQ,GACRsqD,EAAW;AAKf,MAJkB,SAAdmL,IACFz1D,EAAQ,0CACRsqD,EAAW,aAEN,SAAWtqD,EAAQ,eAAiBy1D,EAAY,sBACrDp+D,EAAS,QAAUo+D,GAAa,IAAMnL,EAAW,8CAGzBmL,EAAY,6BACpCA,EAAY,8CAEWA,EAAY,8CACZA,EAAY,6BACnCp+D,EAAS,QAAUo+D,EAAY,WAAa,WCqFhD,SAASC,KACP,MAAO,gBAAkBn9C,GAAS,gBAChC,kKAE8C,IAGlD,SAASo9C,KACP,MAAO,4EAEL59C,GAAU10B,EAAKuyE,WAAa,IAGzB,SAASC,KACd,MAAO,uBACLt9C,GAAS,uBACP,6EAEF,uDACsBm+B,GAAWrzD,EAAKsN,mBAAoB,KAC1D,IAAMtN,EAAKyyE,UAAY,6BACDpf,GAAWrzD,EAAKsN,mBAAoB,KAC1D,IAAMtN,EAAK0yE,WAAa,6BACFrf,GAAWrzD,EAAKsN,mBAAoB,KAC1D,IAAMtN,EAAK2yE,WAAa,qBAa5B,SAASC,GAAiBC,EAAWC,EAAUL,EAAWrxB,GACxD,MAAO,4BAA8ByxB,EAAY,qBAC/C39C,GAAS29C,EAAY,qBACnBA,EAAY,2BACd,sCAAwCC,EACxC,+CAAiDD,EACjD,kBAAoBJ,EAAY,sBAAwBrxB,EACxD,eAGG,SAAS2xB,KAEd,MAAO,yHA5IL79C,GAAS,2BACP,0DACF,wEAEER,GAAU1gB,EAAS,uBAAyB,uFAG5C0gB,GAAU1gB,EAAS,oBAAsB,gFAGzC0gB,GAAU1gB,EAAS,gBAAkB,wFAGrC0gB,GAAU1gB,EAAS,mBAAqB,sFAGxC0gB,GAAU1gB,EAAS,uBAAyB,sEAO9CkhB,GAAS,mBACP,0GAEF,8DACAR,GAAU1gB,EAAS,aAAe,2GAuHlCshB,GAAe,iBACfA,GAAe,0BACfA,GAAe,oBAnHV,iDACLJ,GAAS,wBACP,iVAOF,iEAEAm+B,GAAWrzD,EAAKoN,oBAAqB,GACrC,0CAEAimD,GAAWrzD,EAAKoN,oBAAqB,GACrC,+CAEAimD,GAAWrzD,EAAKoN,oBAAqB,GACrC,yCAEAimD,GAAWrzD,EAAKoN,oBAAqB,GACrC,sEAImC+nB,GAAU,kBAC7C,YAAcC,GAAa,kBAC3B,mJAMAF,GAAS,4BACP,6FAEF,qEACAR,GAAU1gB,EAAS,oBAAsB,8DAEzCA,EAAS,cAAgB,2DAEzBA,EAAS,iBAAmB,wEAE5BA,EAAS,wBAA0B,wDAKnCkhB,GAAS,mBACP,+TAKF,sEACAl1B,EAAKiM,cAAgB,wCAoCcomE,KAAa,wBAChDC,KAAkB,IAAME,KAAa,aA+BrCI,GAAiB5yE,EAAKyyE,UAAW,mBAAoB,eACnDzyE,EAAKohD,OACPwxB,GAAiB5yE,EAAK0yE,WAAY,oBAAqB,gBACrD1yE,EAAKgzE,QACPJ,GAAiB5yE,EAAK2yE,WAAY,oBAAqB,gBACrD3yE,EAAKizE,QAEP39C,GAAe,eChJnB,SAAS49C,GAAU/pD,EAAMC,EAAMs0C,EAAK/rC,GAClC,IAAIwB,EAAMhK,EAAO,4CAA8CC,EAAK,GAClE,KAAOA,EAAK,GAAK;AAInB,OAHIs0C,IAAQ/rC,EAAIzuB,OAAS,EACvBiwB,GAAO,QACEuqC,IAAQ/rC,EAAIzuB,OAAS,IAAIiwB,GAAO,MACpCA,EAGT,SAASggD,GAAaxhD,GACpB,OAAOA,EAAIzI,OAAOgqD,GAAW,IAehB,SAASE,KACtBpzE,EAAKqzE,WACH,+iBAxCAvzE,IAAIC,QAAU,IAAMD,IAAIE,KAAO,qBAC/BA,EAAKszE,QAAU,iBACd,IAAMtzE,EAAKszE,SAASC,QAAQ,GAAK,gQA4ClCrB,KFxCK,+KAKHC,GAAwB,QAAU,8DAElCA,GAAwB,QAAU,yDAElCA,GAAwB,QAAU,2DAElCA,GAAwB,QAAU,iEAGlCj9C,GAAS,8BACP,0HAEF,oFAEAR,GAAU1gB,EAAS,8BACnB,+EAEA0gB,GAAU1gB,EAAS,iCACnB,cAEFshB,GAAe,aACfA,GAAe,uBACfA,GAAe,wBEiBfy9C,KChEK,8DAGLz9C,GAAe,iCACfA,GAAe,kBAEf,iDACEJ,GAAS,gCACP,sFAEF,mEACAlhB,EAAS,2BAA6B,oBAExCshB,GAAe,qBAEf,iDACEJ,GAAS,wBACP,qLAGF,4EACYlhB,EAAS,uBACrB,gEAGAkhB,GAAS,2BACP,mGAEF,yEAEAR,GAAU1gB,EAAS,wBAA0B,0BAE7CkhB,GAAS,wBACP,sJAGF,+DACAR,GAAU1gB,EAAS,uBACnB,cAEFshB,GAAe,qBACfA,GAAe,eACfA,GAAe,sBACfA,GAAe,wBC1CV,oEAGLA,GAAe,kBACfA,GAAe,uBAEf,gDACEJ,GAAS,qCACP,uGAEF,wEAEAR,GAAU1gB,EAAS,uBAAyB,2EAG5CA,EAAS,iBAAmB,KAE9BshB,GAAe,sBAEf,mEACEJ,GAAS,0CACP,yOAIF,wDACArtB,EAAWmM,EAAS,gBAAkB,wGCxBtCkhB,GAAS,uBACP,gIAEF,4EAEAR,GAAU1gB,EAAS,eAAiB,wDAEpCA,EAAS,kBAAoB,eAE/BshB,GAAe,sBACfA,GAAe,sBCbV,2DAELA,GAAe,iBACfA,GAAe,mBAEf,iDACEJ,GAAS,wBACP,2GAEF,yEAEAR,GAAU1gB,EAAS,wBACnB,0EACYA,EAAS,2BAA6B,mEAElDA,EAAS,sBAAwB,0DAGjCkhB,GAAS,qBACP,yPAIF,yEACYlhB,EAAS,oBAAsB,eAE7CshB,GAAe,sBACfA,GAAe,oBACfA,GAAe,4BC3BV,yFAGuBN,GAC1B,uBACAE,GAAS,uBACP,8DACF,4FAEAR,GAAU10B,EAAKwM,wBAA0B,8DAEzCxM,EAAKyM,sBAAwB,sDAEHuoB,GAC1B,uBACAE,GAAS,uBACP,6GAEF,kFAEAR,GAAU10B,EAAK0M,kBACf,+EAGAwoB,GAAS,eACP,kGACwC,oEACMl1B,EAAK2M,YACrD,eAEF2oB,GAAe,sBACfA,GAAe,sBACfA,GAAe,uBCjCV,yDAELA,GAAe,uBAEf,iDACEJ,GAAS,wBACP,kHAEF,6EAEAR,GAAU1gB,EAAS,gBAAkB,yDAErCA,EAAS,mBAAqB,eAEhCshB,GAAe,oBACfA,GAAe,uBACfA,GAAe,yBAEf,gDACEJ,GAAS,yBACP,kGAEF,8FAEAR,GAAU1gB,EAAS,6BACnB,2EAEAA,EAAS,sBAAwB,eAEnCshB,GAAe,wBNiDf,2VAnCA69C,GAAa,CAAC,CAAC,UAAW,cAAe,CAAC,UAAW,WACnD,CAAC,UAAW,cAAe,CAAC,UAAW,WACvC,CAAC,UAAW,YAAa,CAAC,UAAW,YACrC,CAAC,UAAW,WAAY,CAAC,UAAW,YACtC,oCACAA,GAAa,CAAC,CAAC,SAAU,WAAY,CAAC,QAAS,cAC/C,mCOnBJ,SAASK,GAAmB12E,GAC1B,IAAIkxC,EAAW33B,EAAE,0CACf,mBACEo9D,EAASp9D,EAAEvZ,EAAE2K;AACjBumC,EAASiR,KAAK,UAA6B,mBAAlBw0B,EAAOr1E,QACV,mBAAlBq1E,EAAOr1E,OACTq1E,EAAOr1E,KAAK,oBAEZq1E,EAAOr1E,KAAK,kBAIhB,SAASs1E,KACPh3D,GAAS,qBACP,mDACA,WAAYrb,aAAakc,UAoD7B,SAASo2D,GAAW7wD,GAClB,IAtCI3W,EAEAynE,EAQAxnE,EAEAynE,EAOAhmE,EAEAimE,EAQA5lE,EAEA6lE,EAOAC,EAAQlxD,EAAIrb,OAAOwsE;AAtCnB9nE,EACFshC,GAAS,2CAuCgBumC,GAtCvBJ,EAA+Bn1E,OAAO0N,EAAwB9N,QAC9DysB,MAAM8oD,IACNA,GAAgC,MAClCznE,EAAwB9N,MAAQ,MAK9B+N,EACFqhC,GAAS,sCA8BWumC,GA7BlBH,EAA0Bp1E,OAAO2N,EAAmB/N,QACpDysB,MAAM+oD,IAA4BA,GAA2B,KAC/DznE,EAAmB/N,MAAQ,IAKzBwP,EACF4/B,GAAS,2CAsBaumC,GArBpBF,EAA+Br1E,OAAOoP,EAAwBxP,QAC9DysB,MAAMgpD,IACNA,GAAgC,KAClCjmE,EAAwBxP,MAAQ,IAK9B6P,EACFu/B,GAAS,sCAaWumC,GAZlBD,EAA0Bt1E,OAAOyP,EAAmB7P,QACpDysB,MAAMipD,IAA4BA,GAA2B,KAC/D7lE,EAAmB7P,MAAQ;AAW7B,IAAI61E,EACFzmC,GAAS,wCAAyCumC;AAEpDhzD,GAAS,sBADiBviB,OAAOy1E,EAA2B71E,QAK5D2iB,GAAS,qBAFPysB,GAAS,uCAAwCumC,GACA31E,OAGnD42B,GAAUtb,QAhEZ,SAAuBq6D,EAAOh2E,GAC5B,IAAIm2E,EACF1mC,GAAS,kBAAoBzvC,EAAO,KAAMg2E;AACH,aAArCG,EAAYvrD,aAAa,QAC3B5H,GAAShjB,EAAMm2E,EAAYr8C,SAE3B9W,GAAShjB,EAAMm2E,EAAY91E,QA0DGsH,KAAK,KAAMquE,IAE3C39D,EAAE,eAAejY,KAAK,4BAA4Bgb,OAAO,QAG3D,SAASg7D,KACP5zE,EAAU,eAAgB,yBAC1B2kB,GAAauF,IAGf,SAAS2pD,KACP7zE,EAAU,eAAgB,oBAC1B2kB,GAAauE,IC9Hf,SAAS4qD,GAAQ5uB,EAAMvoD,GAErB,OAAOknB,GACLhO,EAAEqvC,EAAMvoD,GACL4iD,WACA3vB,OAAO,SAASntB,EAAGnG,GAClB,OAAsB,IAAfA,EAAEy3E,WACR,GAAGC,WAIZ,SAASC,GAAat3E,EAAKqmD,GACzB,IAAIkxB,EAAUr+D,EAAE,kCAAoCmtC,EAAO,QAASrmD,GACjEuH,KAAK,UAEJvB,EAAO,yBAAyBiR,KAAKsgE;AACzC,OAAIvxE,EAAckhB,GAASlhB,EAAK,IACzB,EAGT,SAASwxE,GAASjvB,EAAMvoD,GACtB,IAAIsK,EAAS4O,EAAEqvC,EAAMvoD,GACjBwlB,EAAWlb,EAAOkb;AAItB,OAHwB,IAApBA,EAASzf,SACXyf,EAAWlb,EAAOmtE,QAEbvwD,GAAS1B,EAASvkB,OAAO2W,MAAM,GAAI,IAG5C,SAAS8/D,GAAW5W,EAAOz/C,GACzB,OAAoB,GAARA,EAARy/C,GACAA,EAAQz/C,EACHy/C,EAEM,GAARz/C,EAGT,SAASs2D,GAAet7D,GACtBA,EAAIu7D,YAAcF,GAAWr7D,EAAIw7D,YAAax7D,EAAIghB,YAClDhhB,EAAIy7D,aAAeJ,GAAWr7D,EAAI07D,aAAc17D,EAAIghB,YACpDhhB,EAAI27D,WAAaN,GAAWr7D,EAAI47D,WAAY57D,EAAIghB,YAChDhhB,EAAI67D,YAAcR,GAAWr7D,EAAI87D,YAAa97D,EAAIghB,YAClDhhB,EAAI+7D,QAAU/7D,EAAIg8D,QAOb,SAASC,GAAiBv7C,GAC/B,IAL2Bw7C,EAKvBv4E,EAAM0iB,GAAeqa,GACrB1gB,EAAM,CACRghB,WAAY85C,GAAQ,WAAYn3E,GAChC43E,YAAaT,GAAQ,eAAgBn3E,GACrC63E,YAAaL,GAAS,eAAgBx3E,GACtC83E,aAAcX,GAAQ,gBAAiBn3E,GACvC+3E,aAAcP,GAAS,gBAAiBx3E,GACxCg4E,WAAYb,GAAQ,cAAen3E,GACnCi4E,WAAYT,GAAS,cAAex3E,GACpCk4E,YAAaf,GAAQ,eAAgBn3E,GACrCm4E,YAAaX,GAAS,eAAgBx3E,GACtCo4E,QAASjB,GAAQ,WAAYn3E,GAC7Bq4E,QAASb,GAAS,WAAYx3E,GAC9Bw4E,gBAAiBrB,GAAQ,oBAAqBn3E,GAE9Cy4E,mBAAoBnB,GAAat3E,EAAK,kBACtC04E,aAAcpB,GAAat3E,EAAK,WAChC24E,iBAAkBrB,GAAat3E,EAAK,gBACpC44E,eAAgBtB,GAAat3E,EAAK,cAClC64E,eAAgBvB,GAAat3E,EAAK,cAClC84E,kBAAmBxB,GAAat3E,EAAK,gBACrC+4E,eAAgBzB,GAAat3E,EAAK,aAClCg5E,YAAa1B,GAAat3E,EAAK,UAC/Bi5E,qBAAsB3B,GAAat3E,EAAK,oBACxCk5E,sBAAuB5B,GAAat3E,EAAK,sBACzCm5E,eAAgB7B,GAAat3E,EAAK,aAClCo5E,eAAgB9B,GAAat3E,EAAK,cAClCq5E,eAAgB/B,GAAat3E,EAAK,aAClCs5E,eAAgBhC,GAAat3E,EAAK,aAClCu5E,mBAAoBjC,GAAat3E,EAAK,mBACtCw5E,cAAelC,GAAat3E,EAAK,YACjCy5E,qBAAsBnC,GAAat3E,EAAK,oBACxC05E,cAAepC,GAAat3E,EAAK,YACjC25E,WAAYrC,GAAat3E,EAAK;AAKhC,OAHAqc,EAAIu9D,2BAA6Bz4E,KAAKC,MAAM,KAC1Cib,EAAI68D,sBAAwB,KAAO,IAEd,IAAnB78D,EAAIs9D,YA1Cc,iBADKpB,EA4CHl8D,EAAIu7D,eA3COjqD,MAAM4qD,IA+CzCZ,GAAet7D,GAHNA,EAOX,SAASw9D,GAAW51B,EAAOoC,GACzB,OAAO1/C,EAASs9C,EAAMoC,GAAO,GAGxB,SAASyzB,GAAiB7lD,GAC/B,IAAIgwB,EAAQ+qB,GAAgB/6C,EAAK46C,SAC7BxyD,EAAM,CACRghB,WAAYpJ,EAAK5S,MACjBu2D,YAAa3jD,EAAKhJ,OAClB4sD,YAAa5jD,EAAK8lD,aAClBjC,aAAc7jD,EAAK/I,QACnB6sD,aAAc9jD,EAAK+lD,cACnBhC,WAAY/jD,EAAK9I,MACjB8sD,WAAYhkD,EAAKgmD,YACjB/B,YAAajkD,EAAK7I,OAClB+sD,YAAalkD,EAAKimD,aAClB9B,QAASnkD,EAAK5I,GACdgtD,QAASpkD,EAAKkmD,SACd3B,gBAAiBtxD,GAAS+M,EAAKmmD,YAE/B3B,mBAAoBoB,GAAW51B,EAAO,kBACtCy0B,aAAcmB,GAAW51B,EAAO,WAChC00B,iBAAkBkB,GAAW51B,EAAO,gBACpC20B,eAAgBiB,GAAW51B,EAAO,cAClC40B,eAAgBgB,GAAW51B,EAAO,cAClC60B,kBAAmBe,GAAW51B,EAAO,gBACrC80B,eAAgBc,GAAW51B,EAAO,aAClC+0B,YAAaa,GAAW51B,EAAO,UAC/Bg1B,qBAAsBY,GAAW51B,EAAO,oBACxCi1B,sBAAuBW,GAAW51B,EAAO,sBACzCk1B,eAAgBU,GAAW51B,EAAO,aAClCm1B,eAAgBS,GAAW51B,EAAO,cAClCo1B,eAAgBQ,GAAW51B,EAAO,aAClCq1B,eAAgBO,GAAW51B,EAAO,aAClCs1B,mBAAoBM,GAAW51B,EAAO,mBACtCu1B,cAAeK,GAAW51B,EAAO,YACjCw1B,qBAAsBI,GAAW51B,EAAO,oBACxCy1B,cAAeG,GAAW51B,EAAO,YACjC01B,WAAYE,GAAW51B,EAAO;AAGhC,OADuB,IAAnB5nC,EAAIs9D,YAAmBhC,GAAet7D,GACnCA,ElB1HT,IACIg+D,GACAC,GAFAC,GAAWvgE,GAAU,OAIrBgU,GAAiB,CACnB,WAAY,OAAO7f,IACnB,SAASse,GAAU,OAAO5sB,EAAY4sB,IAAYA,IAAY6tD,IAC9D,SAAS7tD,EAASllB,GAAO,OAAOA,EAAK60B,YAAcm+C,IACnD,SAAS9tD,EAASllB,GAAO,OAAOA,EAAKizE,eAAiB12D,IACtD,SAAS2I,EAASllB,GAAO,OAAOA,EAAKizE,eAAiBz2D;AASxD,SAAS02D,GAAY54B,EAAQp1B,EAASllB,GANtC,IAAsBklB,EAASllB;AAO7B/G,EAAoBqhD,EAAOnvB,KAAK,GAC9B,OAAS4J,GAAU,CAACF,WAAY70B,EAAK60B,aAAe,SARlC3P,EASHA,EATYllB,EASHA,EARnBymB,GAAegB,MAAM,SAAS/Z,GACnC,OAAOA,EAAGwX,EAASllB,MAQnBs6C,EAAOjnC,WAAWA,WAAWE,UAAU5S,IAAI,gBAiB/C,SAASwyE,GAAWt9D,GAClB,OAAOlE,EAAE0C,WAAWG,QAAQ,KAAMqB,GAAOjB,UAW3C,SAASw+D,GAAiB/kD,EAAK9M,GAC7B,IAT8B2D,EAASpQ,EASnCu+D,EAAYhlD,EAAIlD,KAAK,GAAGC,MAAM,GAAGF,kBAAkBvX,KACnDuR,EAAU,iBAAiBxV,KAAK2jE,GAAW;AAVRv+D,EAWP,CAAC0Z,IAAKH,EAAKzH,OAAQrF,GAV/CuxD,GAD0B5tD,EAWPA,GATrB4tD,GAAO5tD,GAAS/lB,KAAK2V,GAErBg+D,GAAO5tD,GAAW,CAACpQ,GAUvB,SAASw+D,GAAUjoD,EAAK9J,EAAY8M,EAAKnJ,GACvCmG,EAAIlsB,KAAKujC,GAAWnhB,GACjB3L,KAAK,KAAMu9D,IACXl4D,KAlCL,SAAqBq/B,EAAQp1B,EAASllB,EAAM6V,GACtC7V,EACFkzE,GAAY54B,EAAQp1B,EAASllB,GAM7B/G,EAAoBqhD,EAAOnvB,KAAK,GAC9B,wBAA0BtV,EAAMG,OAAS,UAyBzB/U,KAAK,KAAMotB,EAAKnJ,KAItC,SAASquD,GAAWvzE,GAClB,IAAIklB,EAAUllB,EAAK0a,EAAEliB;AACrBwH,EAAK0a,EAAEf,QAAQ1E,QAAQ,SAASyE,GAC9Bo5D,GAAO5tD,GAASjQ,QAAQ,SAAS2R,GAC3BlN,EAAOpgB,OAASstB,EAAOA,QACzBssD,GAAYtsD,EAAO4H,IAAKtJ,EAAS,CAC/B2P,YAAapiB,GAAUiH,EAAOE,eAAezc,WAC7C81E,cAAev5D,EAAOH,SAOhC,SAASi6D,KACP,IAAIC,EAAat3D,GAAIqF,qBAAqB,SACtC6J,EAAM;AACVynD,GAAS,GACT71D,MAAMC,UAAU7M,MAAM8M,KAAKs2D,EAAY,GAAGx+D,QAAQ,SAASoZ,GACzD,IAAI9M,EAAa8M,EAAIr0B,YAAY4+B;AAC7BvK,EAAIlD,KAAK,GAAGC,MAAM,GAAGF,kBACvBkoD,GAAiB/kD,EAAK9M,GAEtB+xD,GAAUjoD,EAAK9J,EAAY8M,KAG/Bta,OAAOiB,KAAK89D,IAAQ79D,QAAQ,SAASiQ,GmB7GxB,IAAmBA;AnB8GC,IAA3B4tD,GAAO5tD,GAAS1mB,OAClB80E,GAAUjoD,EAAKynD,GAAO5tD,GAAS,GAAG0B,OAAQksD,GAAO5tD,GAAS,GAAGsJ,IAC3DtJ,ImBhH0BA,EnBkHlBA,EmBjHP5O,GAAQ,CAACyE,IAAK,QAASC,OAAQ,OAAQ07B,SAAUxxB,KnBiHjCjK,KAAKs4D,MAG5B5hE,EAAE2Z,KAAKpqB,MAAMyQ,EAAG0Z,GAAKpQ,KAAK,WACxBgtD,GAAQ10D,UAAU5S,IAAI,aAI1B,SAAS+yE,GAAQt7E,GACfuZ,EAAEvZ,EAAE2K,QAAQm9B,KAAK,QACjB+nC,GAAUlxD,GAAW,CACnBwH,UAAW,sCACXT,UAAW,8DAEb1lB,EAAE2K,OAAOsQ,WAAWwzC,aAAaohB,GAAS7vE,EAAE2K,SAC5C6D,GAA4B0I,EAAS,gCAEnC4Q,KACA6yD,GAAY9sD,MAEdutD,KAoBF,IoBjJI1hC,GCIAlrC,GACAC,GrB4IA8sE,GAAgB,CAClB,WAAY,OAAOl9D,MACnB,WAAY,OAAO3E,GAASqK,KAC5B,WAAY,OAAOrK,GAASqK,GAAI+O,oBAChC,WAAY,OAAOpZ,GAASqK,GAAI+O,kBAAkBC,OAClD,WAAY,OAA2C,EAApChP,GAAI+O,kBAAkBC,KAAK3sB,QAC9C,WACE,OACsB,IADf2d,GAAI+O,kBAAkBC,KAAK,GAAGnxB,YAAYoD,QAC/C;AAQS,SAASw2E,KAHfD,GAAclsD,MAAM,SAASrvB,GAAI,OAAOA,OA9BjD,WACE,IAAIy7E,EAAU13D,GAAIqF,qBAAqB,MAAM;AAC7CqyD,EAAQ3oD,kBAAkB3M,UAAY;AACtC,IAAIu1D,EAAUr8D,GAAY,CACxBjf,GAAI,uBACJ+lB,UAAW,0BACX7hB,KAAM,SACN/C,MAAO,sBACP+wB,QAAS,CACPC,OAAQ;AAIZkpD,EAAQ73D,aAAa83D,EAASD,EAAQ3oD,mBACtC4oD,EAAQryE,iBAAiB,QAASiyE,IAoBVK,GoBzI1B,SAASC,GAAa51D,GACpB,IAAI61D,EAAW71D,EAAIrb,OAAOvK,GAEtB8wB,EA1BN,WACE,IAAImqB,EAAUl7C,EAAe;AAC7B,IAAKk7C,EAAS,CACZA,EAAU38B,GAAU,CAACte,GAAI,WAAY+lB,UAAW;AAGhD,IAFA,IAAI0R,EAAW13B,EAAe,aAC1B27E,EAAWjkD,EAASzO,qBAAqB,SACtC0yD,EAAS11E,QACd01E,EAAS,GAAG3gE,UAAU5S,IAAI,YAC1BiX,GAAc67B,EAASygC,EAAS;AAElCjkD,EAAS5c,WAAW2I,aAAay3B,EAASxjB,GAE5C,OAAOwjB,EAaO0gC,GACM3yD,qBAAqB;AACzCvE,MAAMC,UAAUjI,QAAQkI,KAAKmM,EAAO,SAAS5b,GAC3CA,EAAGwd,kBAAkB5J,iBAAiB4J,kBACnCA,kBAAkBkI,SAAU;AAC/B,IAfwBghD,EAAKC,EAILD,EAAKC,EAWzB50C,EAAS/xB,EAAG6F,UAAU+Q,SAAS,WAC/B8vD,EAAmB,cAAbH,EACNI,EAAY3mE,EAAG6F,UAAU+Q,SAAS2vD;AAjBdG,EAkBDA,EAlBMC,EAkBDA,EAAb50C,GAjBArgC,EAASg1E,EAAKC,KAkB3B3mE,EAAG6F,UAAU6d,OAAO,WACpB1jB,EAAG6F,UAAU5S,IAAI,aAhBKyzE,EAkBDA,EAlBMC,EAkBDA,EAAb50C,GAjBE20C,GAAQC,IAkBvB3mE,EAAG6F,UAAU6d,OAAO,YACpB1jB,EAAG6F,UAAU5S,IAAI,cAKvB,SAAS2zE,GAAWl2D,GACU,SAAxBA,EAAIrb,OAAOk8C,WAC4B,IAAvC7gC,EAAIrb,OAAOvK,GAAG4E,QAAQ,aAAqB42E,GAAa51D,GAgC9D,SAASm2D,GAAe7mE,GACtB,IAPeA,EAOXw8C,EAAWx8C,EAAGwd,kBAAkB5J,iBAAiB4J,kBAClDA,kBACC2B,EAAOilB,GAASoY,EAAShmC,aAAa;AACtC2I,IACFnf,EAAG6F,UAAU5S,IAAI,WAAaksB,EAAKQ,WAC/BykB,GAASV,WAZA1jC,EAYmBA,EAAImf,EAX7BS,SACP5f,EAAG6F,UAAU5S,IAAI,UACX+M,EAAG6F,UAAU5S,IAAI,oBAUvBupD,EAAS32C,UAAU5S,IAAI,SAAWksB,EAAKW,SACvC08B,EAAS32C,UAAU5S,IAAI,WAAaksB,EAAKnwB,OAI7C,SAAS83E,GAAax0E,GAEpB3G,EAAK,sBAELy4C,GAAW9xC,EAAKspB;AAEhB,IAAIpD,EAAW3tB,EAAe,aAC3BipB,qBAAqB;AACxBvE,MAAMC,UAAUjI,QAAQkI,KAAK+I,EAAUquD,IAjDzC,SAAyBphC,GACvB,IAAIshC,EAAa;AAEjBA,GAAc,yHAEd1gE,OAAOiB,KAAKm+B,GAASl+B,QAAQ,SAAS/V,GACpCu1E,GAAc,4BAA8Bv1E,EAC1C,mCAAqCA,EAAM,IAC3Ci0C,EAAQj0C,GAAO;AAEnB,IAAIw1E,EAAax9D,GAAS,CACxB1e,GAAI,kBACJslB,UAAW22D;AAEbC,EAAWjzE,iBAAiB,QAAS6yE;AACrC,IAAI5mE,EAAKnV,EAAe,aAAa8a,WAAWA;AAChDylD,GAAsBprD,EAAI,+IAI1BmO,GAAoB64D,EAAYhnE,GA8BhCinE,CAAgB30E,EAAKmzC,SAErB15C,EAAQ,sBAIK,SAASm7E,KAClB7iE,MACJs/B,KAAmBp2B,KAAK,SAASjb,GAC/BW,EAAI,EAAG6zE,GAAc,CAACx0E,MElF1B,SAAS60E,GAAWz2D,GAClB,IA9BkB02D,EACdC,EA6BA1jD,EAASjT,EAAIrb,OAAOvK,GAGpBs8E,GAFWv8E,EAAe,aAC5BA,EAAe,cACSmb,iBAAiB,uBAIvCqhE,GArCcD,EAqCOA,EApCrBC,EAAU93E,SAAS1E,EAAe,kBAAkBoB,MAAO,IAC3DysB,MAAM2uD,GAAkBD,EAAWt2E,OAEnB,MAAhBlD,EAAK0f,OAAwBphB,KAAK8hB,IAAI,IAAKq5D,GACxCA,GAiCHC,EAdN,WACE,IAAIC,EAAO18E,EAAe;AAC1B,GAAI08E,EAAO,OAAOA,EAAK7hD,QAYP8hD;AAChBj4D,MAAMC,UAAUjI,QAAQkI,KAAK23D,EAAY,SAASpnE,GAChD,IAtB2BsnE,EAAWtnE,EAAI2jB,EAAQ64B,EAN7B74B,EAAQ64B,EAJPA,EAgClBA,EAAWx8C,EAAGwd,kBAAkB5J,iBAAiB4J,kBAClDA;AACH,GAxB2B8pD,EAwBDA,EAxBYtnE,EAwBDA,EAxBK2jB,EAwBDA,EAxBS64B,EAwBDA,EAAhC6qB,GAtBjB31E,EAAS41E,GAAYtnE,EAAG6F,UAAU+Q,SAAS,aARd4lC,EASLA,EARR,cADK74B,EASLA,KAbM64B,EAMLA,EALD,aAKP74B,GALqB64B,EAAS32C,UAAU+Q,SAAS,gBAM1D4lC,EAAS32C,UAAU+Q,SAAS+M,IA8B1B,OAFA64B,EAAS92B,SAAU,OACnB2hD,GAAW;AAGb7qB,EAAS92B,SAAU,IAIvB,SAAS+hD,GAAgB/2D,GAInBA,EAAIrb,OAAOwQ,UAAU+Q,SAAS,gBAAiBuwD,GAAWz2D,GAUhE,SAASg3D,KACP,IAAIC,EAAO,8LANI9lE,GAAU,IADPD,EAAS,eACkB,MAEtCC,GAAU,IAAMhM,EAAS8J,YAAc,MASrC4H,QAAQ,SAASvH,GACxB2nE,GAAQ,0BAA4B3nE,EAAG,GACrC,2CAA6CA,EAAG,GAAK;AAIzD,IAAI4nE,EAAWp+D,GAAS,CACtB1e,GAAI,oBACJslB,UAJFu3D,GAAQ;AAMRC,EAAS7zE,iBAAiB,QAAS0zE;AACnC,IAAIznE,EAAKnV,EAAe,aAAa8a,WAAWA;AAChD3F,EAAG2F,WAAW2I,aAAas5D,EAAU5nE,GAGxB,SAAS6nE,KACtB50E,EAAI,EAAGi0E,IACPj0E,EAAI,EAAGy0E,IDpET,SAASI,GAAS9nE,EAAIid,GACpB,IAPmB8O,EANAA,EAafA,EAAS1/B,OAAO,cAAc2V,KAAKib,GAAQ,IAC3CupC,EAAOxmD,EAAG2F,WAAWA;AAdNomB,EAeHA,EAdT7yB,IACK2V,IAAVkd,GACAA,GAAUjd,GAaV03C,EAAK3gD,UAAU5S,IAAI,iBAVF84B,EAWIA,EAVhB5yB,IACK4V,IAAVgd,GACAA,GAAU/c,IASVw3C,EAAK3gD,UAAU5S,IAAI,oBAIvB,SAAS80E,GAAiB/nE,GACxB,IAAIid,EAASjd,EAAGgd,QAAQC;AACNrY,GAAe5C,KAAKib,GAAQ,GAC5B,GAAI6qD,GAAS9nE,EAAIid,GElCrC,IAAI+qD,GAAY,CACd,wDACA,8DACA;AAUF,SAASC,GAAWC,GAClB,IAR0BA,EAStBC,EAAe;AAMnB,OALgB,IAAZD,IACFC,EAAe,oJAIV,WAdQ,IADWD,EAQoBA,IAP1BA,GAAW,EACtBF,GAAUE,GAEZ,2CAWmC,2BACxCA,EAAQz4E,WAAa04E,EAAe,aAGxC,SAASC,GAActgD,GACrB,IAKIugD,EALAt9E,EAAM0iB,GAAeqa,GACrBwgD,EAAqBrkE,EAAElZ,GAAK4nB,KAAK,+BAA+B6vD;AAKpC,EAA5B8F,EAAmBx3E,SACrBu3E,EAAwBp2D,GAASq2D,EAAmBt8E,SAE9BqvC,GAAS,gCACfjrB,UAAYgE,GAAUi0D,GACxCz5D,GAAS,iBAAkBy5D;AAC3B,IAIIE,EAJAC,EACFntC,GAAS,gDAEPotC,EADgB,wCACYzmE,KAAKiC,EAAEukE,GAAiBl2E,KAAK;AAE7D,GAAIm2E,EAAa,CACf,IAAI/E,EAAmB+E,EAAY;AACnCF,EAAwBr8E,KAAK8hB,IAEzB,IAF6B9hB,KAAKC,MACpCD,KAAK8Y,MAAMqjE,EAAwB,GAAK3E,GAChC,IAKZ90D,GAAS,4BAFPysB,GAAS,iCACkBjrB,UAAYm4D,GAI3C,SAASG,GAAattD,GACpB,IAAIjG,EAAMvT,EAASwZ;AAKnB,OAJIxwB,EAAYuqB,KACdvG,GAASwM,EAAM,GACfjG,EAAM,GAEDA,EA+BT,SAASwzD,GAAcT,GACrB,IAxBgBU,EAA2BC,EACvCxtE,EACAytE,EAsBAF,EAA4BF,GAAa,6BACzCG,EAAiBH,GAAa;AAClC,OAAc,EAAVR,GAA6C,KAA9BU,EACV,2FAELx0D,GAAUy0D,GAAkB,yEA7BhBD,EAgCAA,EAhC2BC,EAgCAA,EA/BvCxtE,EAAkBuG,EAAS,mBAC3BknE,EAAyBztE,EANA,KACtB,MAMFA,GAQLsN,GAAU,qCAAqC4E,KAAK66D,IAC7C,4FAELh0D,GAAUy0D,GAAkB,oDAE5B38E,KAAKC,MAAkC,IAA5By8E,GAAmC,IAC9C,8KAGiBE,EAAY,4BAhBtB,gPAKLA,EAAY,4BAkCH,SAASC,GAASC,EAAOC,EAAQf,GAC9C,OAAIc,GAASC,GATGD,EAUEA,EATdjoD,EAAMknD,GADaC,EAUEA,GARrBc,IACFjoD,GAAO4nD,GAAcT,IAEhBnnD,GAOA;AAZT,IAAkBioD,EAAOd,EACnBnnD,EClHN,IAAImoD,GAAK;ACgBM,SAASC,KACtB,IAAIC,EAAkB,GAClBC,EAAmBhuC,GAAS;AAIhC,OAHIguC,IACFD,GAlBJ,SAAkBC,GAChB,IAAI7F;AACJ,IAAiE,IAA7D6F,EAAiB7yD,aAAa,OAAOzoB,OAAO,YAAoB,CAClE,IAAIghE,EAAc9qD,EAAEolE,GAAkB/2E,KAAK,UAEvCg3E,EADkB,0CACctnE,KAAK+sD;AACrCua,IACF9F,EAAqB8F,EAAc,IAGvC,MAAO,iDACQ9F,EAAqB,oBAOf+F,CAASF,IAEvBD,ECpBT,IAAII,GAAY;AAOhB,SAASC,GAAgBC,GACvB,IAAIjG,GACuD,IAAvDiG,EAAWlzD,aAAa,OAAOzoB,OAAO,cAExC01E,EATJ,SAAoB1U,GAClB,IAAI4a,EAAUH,GAAUxnE,KAAK+sD;AAC7B,GAAI4a,EAAU,OAAOA,EAAQ,GAOZC,CADG3lE,EAAEylE,GAAYp3E,KAAK;AAGvC,OAAqB,MAAjBmxE,EACK,sDACaA,EAAe,oBAE9B,GCbT,IAIIoG,GCJAC,GDAAC,GAAU,CAAC,UAAW,aAAc,eAAgB,eACtD,SAAU,UAAW,WAAY,oBAAqB,iBACtD,cAAe,kBAAmB,WAChChyD,GAAY;AAGhB,SAASiyD,GAAW54B,GACF,KAAZA,EAAKtmD,IAAyB,KAAZsmD,EAAKtmD,KACzB++E,GAAW3wD,OAAO81B,MAAMoC,EAAKtmD,IAAMyE,SAAS6hD,EAAKhlC,MAAO,KAI5D,SAAS69D,GAAkBrS,IACU,IAA/BmS,GAAQr6E,QAAQkoE,EAAIhsE,QACtBi+E,GAAW3wD,OAAO7C,aAAauhD,EAAIhsE,MAAQgsE,EAAI3rE,OAgBnD,SAASi+E,GAAsBx/E,EAAG4H,GAZlC,IAAkBA,EAMOA,GAOvBu3E,GAAa,IACFM,OAAS73E,EAAK4yC,SAAS5yC,KAC9Bu3E,GAAWM,OAAO/qD,eACpByqD,GAAWM,OAAOC,KAAOP,GAAWM,OAAOhrD,KAAKr0B,IAGlD++E,GAAW3wD,OAAS,GACpB2wD,GAAW3wD,OAAO81B,MAAQ,GAC1B66B,GAAW3wD,OAAO7C,aAAe,IArBjB/jB,EAsBPA,GArBA4mB,OAAO81B,OACd18C,EAAK4mB,OAAO81B,MAAMznC,QAAQyiE,KAIL13E,EAiBPA,GAhBP4mB,OAAO7C,cACd/jB,EAAK4mB,OAAO7C,aAAa9O,QAAQ0iE,IAgBnCJ,GAAWl+E,KAAO2G,EAAK3G,KACvBosB,GAAUtmB,KAAKo4E,IACfz+D,GAAU,gBAAiB2M,IAG7B,SAASsyD,GAAe3/E,EAAG4H,GAEM,IAA3BA,EAAK4yC,SAASA,UAAiBglC,GAAsBx/E,EAAG4H,GAG9D,SAAS+lB,GAAa/lB,GAChBA,IAAOylB,GAAYzlB,GACvB2R,EAAEqmE,UAAU,IAAM/kE,GAAiC8kE,ICpD9C,SAASE,KAEd,IACIC,EADM3/E,EAAe,cACLykB,uBAAuB;AAC3CC,MAAMC,UAAUjI,QAAQkI,KAAK+6D,EAAW,SAASxqE,GAC/CA,EAAG6F,UAAUwd,OAAO,WAC8B,IAAhDz1B,EAAKiM,cAAcnK,QAAQsQ,EAAG1T,gBAIpC,IAAIm+E,GAAqB,CAEvBpsB,EAAK,SAAS7lB,EAAQ6B,EAAO/nC,EAAMo4E,GAEjC,IAAI3rC,EAAW3E,SAASuwC,UAAUr4E,EAAKs4E;AACvC,GAAI7rC,EAAU,CACZ,IAAI8rC,EAAe9rC,EAASzsC,KAAK1G;AACjC,IAAkD,IAA9CgC,EAAKiM,cAAcnK,QAAQm7E,GAG7B,YAFA5mE,EAAE,0BAA0B+V,GAAG1nB,EAAKs4E,UACjCj4D,KAAK,UAAUgwC,YAAY,WAKlCmnB,GAAYtxC,EAAQ6B,EAAO/nC,EAAMo4E;AAYrC,SAASI,GAAetyC,EAAQ6B,EAAO/nC,EAAMo4E,GAC3C,IAToBA,EAISK,EAKzBA,EAAoBN,GAAmBjyC,IALduyC,EAMHA,IALEl5E,EAAWk5E,KAJhCngF,EADa8/E,EAUyCA,IAThB,IAAbA,GAU9BK,EAAkBvyC,EAAQ6B,EAAO/nC,EAAMo4E,GAEvCZ,GAAYtxC,EAAQ6B,EAAO/nC,EAAMo4E,GAStB,SAASM,KACtB/mE,EAAEqmE,UAAUjlE,GAA2BklE,IACvCA,KANAT,GAAc1vC,SAAS5W,SACvB4W,SAAS5W,SAAWsnD,GCvDf,ICKIG,GACAC,GACAC,GACAC,GCOPC,GACAC,GACAC,GFjBOC,GAAW,miCAsBXC,GAAW,mqCAqBXC,GAAO;AC3BX,SAASC,GAAqBC,GALnCR,GAMeQ,EANSC,UAAU9rE,IAAI,SAASsU,GAC7C,OAAOA,EAAEy3D,cAMPb,GACFA,GAAa76D,UAAY,GAEzB66D,GAAe7hE,GAAU,CAACyH,UAAW,SAEvCq6D,GAAU9hE,GAAU,CAACyH,UAAW,iCAChC3G,GAAc+gE,GAAcC,IACxBU,EAAUG,UACZ7hE,GAAcghE,GAAS52B,GAAY82B,KAErCD,GAAgBvhE,GAAa,CAC3BiH,UAAW,eACXvkB,YAAa,gBAEf4d,GAAcghE,GAASC,IAEvBjhE,GADkBrf,EAAe,gBACNogF,IChB7B,IAeWe,GACAC,GACAC,GACAr4B,GACAs4B,GACAr4B,GACAs4B,GACAr4B,GACAs4B,GACAr4B,GACAs4B,GACAr4B,GACAs4B,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GCzDAC,GCgCPC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAt+B,GACA0E,GCrBAu3B,GHPAsC,GAAmB,CACrB,SAAS18E,GAAM,MAAe,eAARA,GACtB,SAASA,GAAM,OAAqC,IAA9B45E,GAAY17E,QAAQ8B,IAC1C,SAASA,GAAM,OAAQ65E,GAAgB75E,GAAK21B,YAC5C,SAAS31B,GAAM,OAAOnF,OAAOg/E,GAAgB75E,GAAK21B,aAAemkD,IACjE,SAAS95E,GAAM,OAAOnF,OAAOg/E,GAAgB75E,GAAK21B,aAAeokD,IACjE,SAAS/5E,GACP,OAAqC,KAA9B65E,GAAgB75E,GAAK4a,OAC1Bi/D,GAAgB75E,GAAK4a,OAAS,KAElC,SAAS5a,GACP,OAAqC,KAA9B65E,GAAgB75E,GAAK4a,OAC1Bi/D,GAAgB75E,GAAK4a,OAAS;AAgCpC,SAAS+hE,GAAetlC,GACtBwiC,GAAkBxiC;AAClB,IAAImH,EAAY3pC,OAAOiB,KAAK+jE;AAC5BC,GAAavmE,GAAU,IACvBwmE,GAAYxmE,GAAU;AACtB,IAAIqpE,EAAWp+B,EAAUl5B,OAAO,SAASC,EAAMvlB,GAC7C,IAAK,IAAIX,EAAI,EAAGA,EAAIq9E,GAAiBp9E,OAAQD,GAAK,EAChD,GAAIq9E,GAAiBr9E,GAAGW,GAAO,OAAOulB;AAIxC,OAFAA,EAAKtlB,KAAK,4CACR45E,GAAgB75E,GAAK1G,GAAK,KAAO0G,EAAM,QAClCulB,GACN;AACHxrB,EAAoB0/E,GAClB,qJAEoBmD,EAASjsD,KAAK,KAAO,oCAqCtC,SAASksD,GAAqBzC,GACnCT,GAActlE,UAAU5S,IAAI;AAC5B,IAAIkI,EAAmByG,EAAS;AAC5BgqE,EAAUG,WAAa5wE,GACzBkuC,IAAa,GAAO97B,KAAK4gE,IAE3B5iF,EAAoB2/E,GAASQ,IAC7B4B,GAAmBziF,EAAe;AAClC,IAAIyjF,EAASllE,GAAU,CACrByH,UAAW,8BACXT,UAAWq7D;AAEbvhE,GAAc+gE,GAAcqD,GA5C5BtC,GAAoBnhF,EAAe,cACnCohF,GAAsBphF,EAAe,gBACrCqhF,GAAmBrhF,EAAe,aAClCgpD,GAAgBhpD,EAAe,eAC/BshF,GAAsBthF,EAAe,qBACrCipD,GAAiBjpD,EAAe,gBAChCuhF,GAAuBvhF,EAAe,sBACtCkpD,GAAelpD,EAAe,cAC9BwhF,GAAqBxhF,EAAe,oBACpCmpD,GAAgBnpD,EAAe,eAC/ByhF,GAAsBzhF,EAAe,qBACrCopD,GAAYppD,EAAe,WAC3B0hF,GAAkB1hF,EAAe,iBACjC2hF,GAAoB3hF,EAAe,oBACnC4hF,GAAsB5hF,EAAe;AAgCrC,IAAI0jF,EAAWnlE,GAAU,CACvByH,UAAW,gCACXT,UAAWo7D;AAEbthE,GAAc+gE,GAAcsD,GAhC5B7B,GAAe7hF,EAAe,SAC9B8hF,GAAe9hF,EAAe,SAC9B+hF,GAAqB/hF,EAAe,eACpCgiF,GAA2BhiF,EAAe,qBAC1CiiF,GAAsBjiF,EAAe,gBACrCkiF,GAA4BliF,EAAe,sBAC3CmiF,GAAoBniF,EAAe,cACnCoiF,GAA0BpiF,EAAe,oBACzCqiF,GAAqBriF,EAAe,eACpCsiF,GAA2BtiF,EAAe,qBAC1CuiF,GAAiBviF,EAAe,WAChCwiF,GAAuBxiF,EAAe,iBCtGjC,SAASg7E,GAAWz6E,GACzB,IAN2BojF,EAQvBC,EAFMhhE,GAAeriB,GACN4a,iBAAiB,6BACVlV;AAC1Bk7E,GAAkB1/E,YAAcmiF,EAAWh/E,WAC3C89E,GATa,KADciB,EAUWC,GATd,IACjBviF,KAAKC,MAAwB,KAAjB,EAAIqiF,EAAO,KAAa,IAS3CvC,GAAoB3/E,aAAiC,IAAlBihF,IAAuB99E,WAAa,ICwCzE,SAASi/E,KACP76B,GAAcvnD,YAAc8nB,GAAUo5D,IACtC15B,GAAexnD,YAAc8nB,GAAUs5D,IACvC35B,GAAaznD,YAAc8nB,GAAUu5D,IACrC35B,GAAc1nD,YAAc8nB,GAAUw5D,IACtC35B,GAAU3nD,YAAc8nB,GAAU05D,IAClCtB,GAAkBlgF,YAAcyhF,GAAWt+E,WAC3Cu+E,IAAgB,EAChBvB,GAAoBngF,YAAc0hF,GAAav+E,WAGjD,SAASk/E,KACPrB,GAAiBhhF,YAAc,wCAC3B+nD,KApBJ1E,GAAW35B,QAAUq+B,GAAUr+B,OAC/B25B,GAAW15B,SAAWo+B,GAAUp+B,QAChC05B,GAAWz5B,OAASm+B,GAAUn+B,MAC9By5B,GAAWx5B,QAAUk+B,GAAUl+B,OAC/Bw5B,GAAWv5B,IAAMi+B,GAAUj+B,IAiB3Bw2D,GAAmBtgF,YAAc8nB,GAAUu7B,GAAW35B,QACtD82D,GAAoBxgF,YAAc8nB,GAAUu7B,GAAW15B,SACvD+2D,GAAkB1gF,YAAc8nB,GAAUu7B,GAAWz5B,OACrDg3D,GAAmB5gF,YAAc8nB,GAAUu7B,GAAWx5B,QACtDi3D,GAAe9gF,YAAc8nB,GAAUu7B,GAAWv5B;AAElD,IAAI44B,EAAQ+qB,GAAgB3/B,SAASlhB,SAAS81B,OAE1C4/B,EAAwB1iF,KAAK+hB,KAAK0hC,GAAW35B,QACL,MAAzCtkB,EAASs9C,EAAM,oBAAqB;AACvCW,GAAW35B,QAAU44D;AAErB,IAAIC,EAA0B3iF,KAAK+hB,KAAK0hC,GAAW35B,OACjDi4D,GAAalK,YAAc;AAC7B8I,GAAyBvgF,YAAc8nB,GAAUu7B,GAAW35B,OAC1D64D;AAEF,IAAIC,EAA0B5iF,KAAK+hB,KAAK0hC,GAAW15B,SAChD,EAAsC,KAAlCvkB,EAASs9C,EAAM+/B,aAAc,KAChCC,EAAeF,EAA0BF;AAC7C7B,GAA0BzgF,YAAc8nB,GAAU46D,GAElD/B,GAAwB3gF,YAAc8nB,GAAUu7B,GAAWz5B,MACzDhqB,KAAK8Y,MAAM2qC,GAAWz5B,MAAQxkB,EAASs9C,EAAMigC,UAAW,GAAK;AAE/D,IAAIC,EAAmBhjF,KAAK+hB,KAAK6gE,EAC/Bp9E,EAASs9C,EAAMmgC,UAAW,GAAK,MAC7BC,EAAuBljF,KAAK+hB,MAAM0hC,GAAWv5B,GAAK84D,GACpDx9E,EAASs9C,EAAM,cAAe,GAAK,MACjCqgC,EAA6BnjF,KAAK+hB,KACpC0hC,GAAWx5B,OAAS83D,GAAa7J,eAAiB;AACpD+I,GAAyB7gF,YAAc8nB,GAAUu7B,GAAWx5B,OAC1Di5D,EAAuBC,GACzBhC,GAAqB/gF,YAAc8nB,GAAUu7B,GAAWv5B,GACtD84D;AAGF,IAAII,EAAoBpjF,KAAK+hB,KAAKw/D,GAChC/7E,EAASs9C,EAAMugC,OAAQ,GAAK;AAC9BnD,GAAqB9/E,YAAc8nB,GAAUq5D,GAC3C6B;AACF,IAAIE,EAAuBtjF,KAAK+hB,KAAK4/D,GACnCn8E,EAASs9C,EAAMygC,UAAW,GAAK;AACjCnD,GAAoBhgF,YAAc8nB,GAAUy5D,GAC1C2B,GAEFlC,GAAiBhhF,YAAc,QAG1B,SAASojF,KACdpC,GAAiBhhF,YAAc,wCAE/BkhF,IAAgBthF,KAAKC,MAAM8hF,GAAatL,YAAc4K;AACtD,IAAIqB,EAAwB1iF,KAAK+hB,KAAKu/D,IACC,MAApCS,GAAajK;AAEhB0J,IAAiBxhF,KAAKC,MAAM8hF,GAAapL,aAAe0K;AACxD,IAAIuB,EAA0B5iF,KAAK+hB,KAAKy/D,IACrC,EAAqC,KAAjCO,GAAapK,oBAChB8L,EAAmBb,EAA0BF;AAEjDjB,IAAezhF,KAAKC,MAAM8hF,GAAalL,WAAawK,IAEpDK,IAAgB1hF,KAAKC,MAAM8hF,GAAahL,YAAcsK,IACtDO,IAAY5hF,KAAKC,MAAM8hF,GAAa9K,QAAUoK;AAC9C,IAAI2B,EAAmBhjF,KAAK+hB,KAAK6gE,EAC/Bb,GAAa/J,eAAiB,MAC5B0L,EAAc9B,GAAWoB,EACzBE,EAAuBljF,KAAK+hB,KAAK2hE,EACnC3B,GAAa9J,eAAiB;AAEhCuK,KAEAjB,GAAkBD,GAAeoB,EACjCzC,GAAoB7/E,YAAc8nB,GAAUq5D,IAC5CrB,GAAqB9/E,YAAc8nB,GAAUu7D,GAC7CjD,GAAapgF,YAAc8nB,GAAUloB,KAAK+hB,KACrB,IAAnB0hE,IACFhD,GAAargF,YAAc8nB,GAAUloB,KAAK+hB,KACrB,IAAnB0hE,IACFtD,GAAmB//E,YAAc8nB,GAAUu5D,GACzCzhF,KAAK8Y,MAAM2oE,GAAcM,GAAanK,eAAiB,OACzD+J,GAAkBD,GAAewB,EACjC9C,GAAoBhgF,YAAc8nB,GAAUy5D,IAC5CtB,GAAgBjgF,YAAc8nB,GAAUw7D,GAER,IAA5B3B,GAAavJ,aACfwH,GAAiB5/E,YAAc,OAG7B8tC,SAASlhB,SAAS22D,SACpBlB,KAEArB,GAAiBhhF,YAAc,QAK5B,SAASwjF,GAAc9wD,GAC5B,IAAI+wD,EAAWlL,GAAiB7lD;AAChCwuD,IAAgBthF,KAAKC,MAAM4jF,EAASpN,YAAc79D,IAClD4oE,IAAiBxhF,KAAKC,MAAM4jF,EAASlN,aACnC/9D,IACF6oE,IAAezhF,KAAKC,MAAM4jF,EAAShN,WAAaj+D,IAChD8oE,IAAgB1hF,KAAKC,MAAM4jF,EAAS9M,YAAcn+D,IAClDgpE,IAAY5hF,KAAKC,MAAM4jF,EAAS5M,QAAUr+D,IACd,IAAxBirE,EAASrL,aAAmBqJ,IAAc,GAC9CW,KAGK,SAASsB,GAAkBhxD,GAChCivD,GAAepJ,GAAiB7lD,GAG3B,SAASixD,GAAgB7oE,GAC9BuoC,GAAavoC,EAGR,SAAS8oE,GAAe9oE,GAC7BitC,GAAYjtC,EClKd,SAAS+oE,GAAYtqB,GACnBynB,GAAiBhhF,YAAcu5D,EAAMv9C,OAAO7Y,WAAa,IACvDo2D,EAAMC,WA0BV,SAASsqB,GAAYhlF,GACnB,IACIilF,EADM5iE,GAAeriB,GACPq+B,cAAc,kCAE5B9L,EAAM,CAACi3B,GADKy7B,EAAQ//D,uBAAuBrK,MACXsH,KAAK0iE;AAMzC,OAJ8D,IADhDI,EAAQ1qE,WAAWA,WAAW2K,uBACzCA,uBAAuBF,UAAU1gB,QAAQ,cAE1CiuB,EAAIlsB,KAAKiiD,KAAenmC,KAAK2iE,KAExBjsE,EAAE2Z,KAAKpqB,MAAMyQ,EAAG0Z,GAGlB,SAAS2yD,KACdjC,GAAqBzC,IDkIrBoC,GADAD,GADAD,GADAF,GADAD,GADAD,GADAF,GAAe;AC1Hf,IAAI7vD,EAAM;AACVA,EAAIlsB,KAvCGkX,GAAU,CACfvF,IAAK,YACL9Q,KAAM,CACJwnC,UAAW,EACXzsB,IAAK,QACLC,OAAQ,OACR07B,SAAU4iC,GAAU2E,cAAcvnC,YAiClBz7B,KAAKs4D,KACrBzrC,SAASlhB,SAAS22D,UACpBlyD,EAAIlsB,KA7BCkX,GAAU,CACfvF,IAAK,YACL9Q,KAAM,CACJwnC,UAAW,EACXzsB,IAAK,QACLC,OAAQ,YAwBWpF,KAAKkoE;AAE5B,IAAK,IAAIv/E,EAAI,EAAGA,EAAIu6E,GAAYt6E,OAAQD,GAAK,EAC3C8sB,EAAIlsB,KAAKujC,GAAWo2C,GAAYv6E,IAAI0c,KAAKuiE,IACtC53B,KAAKi4B;AAEVxyD,EAAIlsB,KAAKujC,GAAWo2C,GAAY,IAAI79D,KAAKyiE,KACzC/rE,EAAE2Z,KAAKpqB,MAAMyQ,EAAG0Z,GAAKpQ,KAAKmiE,IAG5B,SAASc,GAAU9lF,EAAG4H,GAEa,GADjCs5E,GAAYt5E,EAAK4yC,SAAS5yC,MACZu5E,UAAU/6E,SACtB66E,GAAqBC,IACrBT,GAAcp3E,iBAAiB,QAASu8E,KCxFrC,ICAIG,GCEAC,GACAC,GACA5R,GACA6R,GACAC,GACA/qB,GACA4Y,GCMAoS,GCHAC,GACAC,GCLPrzC,GCUAszC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GNxBOC,GAAY,CACrBtzB,EAAK,MACLC,EAAK,SACLC,EAAK,UAGIqzB,GAAO,CAChBvzB,EAAK,CAACwzB,gBAAiB,OAAQC,WAAY,KAC3CxzB,EAAK,CAACuzB,gBAAiB,IAAKC,WAAY,OACxCvzB,EAAK,CAACszB,gBAAiB,MAAOC,WAAY,GAC1CtzB,EAAK,CAACqzB,gBAAiB,OAAQC,WAAY;AOK7C,SAASC,GAAYrrB,EAAMsrB,GACzBA,EAAUvqE,QAAQ,SAASkxB,GAT7B,IAA0Bs5C,EACpBC;AADoBD,EAUJt5C,GAThBu5C,EASUxrB,EATE78B,YAAY,IACtBkhC,QAAUknB,EAAW,GACvBA,EAAW,KAAKC,EAAMnhE,UAAY,UACtC3G,GAAc8nE,EAAOD,EAAW,MAiB3B,SAASE,GAAQtxD,EAAKlD,GAC3BA,EAAKlW,QAAQ,SAASuS,GARxB,IAAoB6G,EAAKjD,EAAOw0D,EAC1B1rB;AADc7lC,EASLA,EATUjD,EASL5D,EAAI,GATQo4D,EASJp4D,EAAI,GAR1B0sC,EAAO7lC,EAAIE,WAAW,GACtBqxD,IAAS1rB,EAAK31C,UAAY,WAC9BghE,GAAYrrB,EAAM9oC,KJRb,SAASy0D,KACd,GAA2B,EAAvBrB,GAASrzD,KAAK3sB,OAChB,IAAK,IAAID,EAAI,EAAGA,EAAIigF,GAASrzD,KAAK3sB,OAAQD,GAAK,EAC7CigF,GAASxkD,UAAUz7B,GAazB,SAASuhF,GAAeC,GACtB,IAAIC,EAAajpE;AAGjB,OAFAa,GAAcooE,EAAYD,GAC1BlgC,GAAoBmgC,EAAY,KACzBA,EAGF,SAASC,KAfhB,IACMC;AAgBJP,GADAnB,GAAWxnE,GAAY,CAACuH,UAAW,cACjB,CAChB,CAAC,CAAC,CAAC,EAAG5G,GAAS,aAAa,GAAO,CAAC,EAAGA,GAAS,eAAe,KAC/D,CAAC,CAAC,CAAC,GAlBDuoE,EAAiBnpE,KACrBa,GAAcsoE,EAAgB9B,IAC9Bv+B,GAAoBqgC,EAAgB,KACpCtoE,GAAcsoE,EAAgB7B,IACvB6B,IAcwB,CAAC,EAAGzT,MACjC,CAAC,CAAC,CAAC,EAAG90D,GAAS,YAAY,GAAO,CAAC,EAAGmoE,GAAexB,OAAe,GACpE,CAAC,CAAC,CAAC,EAAG3mE,GAAS,UAAU,GAAO,CAAC,EAAGmoE,GAAevB,OAAa,GAChE,CAAC,CAAC,CAAC,EAAG5mE,GAAS,WAAW,GAAO,CAAC,EAAG67C,MAAc,GACnD,CAAC,CAAC,CAAC,EAAG4Y,MACN,CAAC,CAAC,CAAC,EAAGz0D,GAAS,WAAW,GAAO,CAAC,EAAGA,GAAS,UAAU,GACtD,CAAC,EAAGA,GAAS,eAAe,OCnC3B,SAASwoE,KACdzB,GAAU,KACND,KAAaA,GAASlrE,UAAU+Q,SAAS,aAC3CuM,GAAY4tD,IAAU,GFIxBL,GAAUpkF,YAAc,GACxBqkF,GAAMrkF,YAAc,GACpByyE,GAAWzyE,YAAc,GACzBskF,GAAWtkF,YAAc,GACzBukF,GAASvkF,YAAc,GACvBw5D,GAAW11C,UAAY,GACvBsuD,GAAatuD,UAAY,GERvB+hE,MAIG,SAASO,GAAS1yE,GACvB,OAAgB,IAAZA,EAAGhR,OACLgiF,GAAUhxE,EAAG2yE,kBACN,GAKJ,SAASC,KACd,GAAI7B,GACF5tD,GAAY4tD,IAAU;IACjB,CACL,IAAI8B,EAAUhoF,EAAe;AAC7BkmF,GAAW3nE,GAAU,CAACyH,UAAW,cFzBnC6/D,GAAYrnE,KACZsnE,GAAQtnE,KACR01D,GAAa11D,KACbunE,GAAavnE,KACbwnE,GAAWxnE,KACXy8C,GAAaz8C,KACbq1D,GAAer1D,KEqBbkpE,KACAroE,GAAc6mE,GAAUD,IACxB5mE,GAAc2oE,EAAS9B,KIX3B,SAAS+B,GAAgBtU,GACvB,OAAIA,GAAY,EACP,4DAEF,qDAbHp9B,EAAQ,IAAI5wC,KAAK1E,GAAa,IAcnB0yE,GAbXn9B,EAAOD,EAAMM,cACbJ,EAAKP,GAAKK,EAAMO,WAChBH,EAAQ98B,GAAO08B,EAAMS,YAChBd,GAAKK,EAAMU,YAER,IADHf,GAAKK,EAAMW,cACG,IAAMT,EAAK,IAAME,EAAQ,IAAMH,GASpD;AAhBJ,IACMD,EACAC,EACAC,EACAE,EAyCN,SAASuxC,GAAa/yE,GACpB,OAAOA,EAAGgzE,OAAShzE,EAAG++B,SAASk0C,UAAYjC,IAAWhxE,EAAGgzE,QAAUvC,GAG9D,SAASyC,GAAclmE,GAC5B,IA/BmBmmE,EA+BfA,EAAWnmE,EAAE2F,KAAKogE;AAClBI,IAhCeA,EAiCLA,EAhCdzC,GAAUpkF,YAAc6mF,EAASC,WAAW3jF,WAC5CkhF,GAAMrkF,YAAc6mF,EAASE,OAAO5jF,WACpCsvE,GAAWzyE,YAAc6mF,EAASG,MAAM7jF,WACxCmhF,GAAWtkF,YAAc0xE,GAAcoB,GAAY+T,EAASE,OAC1DF,EAASC,WAAYD,EAASG,OAAQ,GACxCzC,GAASvkF,YAAc0xE,GAA+B,IAAjBmV,EAASG,MAAcH,EAASE,OACnE,GACFvtB,GAAW11C,UAAY0uD,GAAeqU,EAASG,MAAOH,EAASE,OAC7DF,EAASC,YACX1U,GAAatuD,UAAY0iE,GAAgBK,EAAS3U,UAGpD,SAAsB2U,GAEpB,GADAhB,KACKgB,EAASI,aAAd,CACA,IAAIz8B,EAAaq8B,EAASI,aAAaxzE,IAAI,SAASiM,GAClD,MAAO,CAAC,CACN,CAAC,EAAG/B,GAAS+B,EAAOkN,OAAOttB,OAC3B,CAAC,EAAGqe,GAAS+B,EAAOsnE,MAAM7jF,aAC1B,CAAC,EAAGwa,GAAS+zD,GAA6B,IAAfhyD,EAAOsnE,MAAcH,EAASG,MAAO,GAAK;AAGzErB,GAAQnB,GAAUh6B,IAWhB08B,CAAaL,IHpDjB,SAASM,GAAYC,GACnB,OAAO9lF,EAAK+T,eAAiB4N,MAAMiW,QAAQkuD,IAAYA,EAAQ5mE,KAAK4lE,IAGtE,SAASiB,KIrBA/qE,GAAQ,CAACyE,IAAK,QAASC,OAAQ,eJsBzBC,KAAK,SAA2Bjb,GAT/C,IAAkBA,GAAAA,EAUDA,GATH2sB,GAAK1P,MAAMiW,QAAQlzB,EAAK0a,KAUhCkmE,GAAc5gF,EAAK0a,GACfymE,GAAYr5C,SAAS44C,QAAQU,SAC/B/1C,GAAY7wC,OAAOyb,WAAWorE,GAAgB,KAE9ClB,QAMR,SAASmB,GAAaF,GA3BhB/1C,KACF7wC,OAAO0xC,aAAab,IACpBA,GAAY,MA2BV81C,GAAYC,IACdd,KACAe,MAEAlB,KAIG,SAASoB,GAAWvhF,GJ7CpB,IAAkBA;AI8CnBA,EAAK0gF,MAAMU,UJ9CQphF,EI+CZA,EAAK0gF,MAAMpnF,KJ9CtB6kF,GAAYn+E,EI+CVshF,GAAathF,EAAK0gF,MAAMU,UCK5B,II7CII,GACA9sE,GACA+sE,GACAC,GACAC,GACAC,GACAC,GJuCAC,GAAY,CACd,CACErjF,KAAM,SAAS4f,GAAO,OAAOA,IAAS4gE,IACtC/lE,IAbJ,WAEEoD,GAAS,uBAAwBhN,EAAS,0BAa1C,CACE7Q,KAAM,SAAS4f,GAAO,OAAOA,IAAS6gE,IACtChmE,IAZJ,WACE5d,EAAKqN,aAAerN,EAAKqN,YACzB2T,GAAS,cAAehhB,EAAKqN,gBAc3Bo5E,GAAW,CACb,CACEtjF,KAAM,SAAS4f,GAAO,OAAOA,IAASwgE,IACtC3lE,IA3CJ,SAAqBmF,GACnB1M,EAAE0M,GAAM6hB,KAAK,QACb4H,SAAS5W,SAAS,GAAI,IAAK,GAAI,KA2C/B,CACEzyB,KAAM,SAAS4f,GAAO,OAAOA,IAASygE,IACtC5lE,IA1CJ,WACEgqB,GAAoB3hB,QA2CpB,CACE9iB,KAAM,SAAS4f,GAAO,OAAOA,IAAS0gE,IACtC7lE,IA1CJ,WACE1e,OAAOsnC,KAAK,iCAAkC,WA2C9C,CACErjC,KAAM,SAAS4f,GAAO,OAAOA,IAAS2gE,IACtC9lE,IA1CJ,WACE,IAAI8oE,EAAYl6C,SAAS44C;AACzBlmF,OAAOsnC,KAAKhvB,GAAW,+BAAiCkvE,EAAUxpF,GAChE;AAqEJ,SAASypF,GAAM1jE,EAAWwgB,EAAKmjD,GAC7B,IAAI9/B,EAAM9qC,GAAa,CACrBiH,UAAW,+CAAiDA,EAC5DmM,QAAS,CAACC,OAAQoU;AAGpB,OADAnnB,GAAcsqE,EAAW9/B,GAClBA,EAGT,SAAS+/B,GAAeD,EAAWliF,GArBnC,IAAkBA,EAAMkiF,EAClBE,EAIAC;AALkBH,EAsBPA,EArBXE,EAAStrE,GAAU,CACrByH,UAAW,UACXT,UAAW,kBAHG9d,EAsBPA,GAnB4B0gF,MAAM4B,SAAW,WAItD1qE,GAFIyqE,EAASvrE,GAAU,CAAC9c,YAAa,eACrC4kF,GAAUjnE,GAAS3X,EAAK4mB,OAAO9M,MAAM3c,aAErCya,GAAcwqE,EAAQC,GACtBzqE,GAAcsqE,EAAWE,GAczBvD,GAAYoD,GAAM,eAAgB,4BAA6BC,GAC/DpD,GAAYmD,GAAM,eAAgB,wBAAyBC,GAC3DnD,GAAWkD,GAAM,cAAe,iBAAkBC,GAClDlD,GAAUiD,GAAM,eAAgB,6BAA8BC,GAGhE,SAASK,GAAUhkE,EAAWwgB,EAAKyjD,GACjC,OAAO9qE,GAAY,CACjB6G,UAAW,+CAAiDA,EAC5DmM,QAAS,CAACC,OAAQoU,GAClByjD,QAASA,IAIb,SAASC,GAAcpjE,GACrB,IAAIqjE,EAAS5rE,GAAU,CAACyH,UAAW,cAC/BokE,EAAWlrE,GAAY,CACzB2b,QAAS/T,EAAEujE,QACXpqF,GAAI6mB,EAAEwjE,QACNnmF,KAAM;AAQR,OANAkb,GAAc8qE,EAAQC,GAEtB/qE,GAAc8qE,EADFH,GAAUljE,EAAEyjE,QAASzjE,EAAE0jE,MAAO1jE,EAAEwjE,UAG5CjrE,GAAc8qE,EADDH,GAAUljE,EAAE2jE,SAAU3jE,EAAE4jE,OAAQ5jE,EAAEwjE,UAE/CjrE,GAAcyH,EAAE6iE,UAAWQ,GACpBC,EA+BF,SAASO,GAAcljF,GAb9B,IAAsBkiF,EAChBiB;AAlFA3oF,OAAO4oF,gBAAkBA,eAAeC,QAC1CD,eAAeC,MAAMC,kBAAoB,IAKvC3E,IAAkBA,GAAgBvtD,SA2FtC+wD,GADAxD,GAzFO7nE,GAAU,CACfyH,UAAW,oBACX/lB,GAAI,4BAwF0BwH,GA/BlC,SAA4BkiF,GAC1B,GAAI5yE,EAAS,sBAAuB,CAClC,IAAIi0E,EAAYj0E,EAAS;AACzB2vE,GAAawD,GAAc,CACzBG,QAASW,EACTV,QAAS,gBACTC,QAAS,UACTC,MAAO,iDACPC,SAAU,WACVC,OAAQ,gDACRf,UAAWA,KAsBfx7E,CAAmBi4E,IAjBCuD,EAkBPvD,GAjBTwE,EAAa7nF,EAAKqN,YACtBu2E,GAAYuD,GAAc,CACxBG,QAASO,EACTN,QAAS,eACTC,QAAS,SACTC,MAAO,qBACPC,SAAU,UACVC,OAAQ,sBACRf,UAAWA,IAUbvD,GAAgBl9E,iBAAiB,QAAS2qB,GAAa21D,KACvDpD,GAAgBl9E,iBAAiB,SAAU2qB,GAAa01D,KACxDvpF,EAAe,kBACZyjB,aAAa2iE,GAAiBpmF,EAAe,eAG3C,SAASirF,GAAWprF,EAAG4H,GAKxB4+E,KACFA,GAAQ5kF,YAAcgG,EAAKV,GK3L/B,SAASmkF,GAAcrrF,GACrBuZ,EAAEvZ,EAAE2K,QAAQm9B,KAAK,QAOnB,SAASwjD,GAAkB1jF,GAJ3B,IAAkBA;AAKhBgoC,GAAsBhoC,IALNA,EAMHA,GALD0gF,OAAS1gF,EAAK0gF,MAAMpnF,OAM9B4pF,GAAcljF,GACduhF,GAAWvhF,GACXzH,EAAe,YACZkJ,iBAAiB,QAASgiF,IACzBnoF,EAAKuT,oBAAqBi5B,SAASC,MAAM,MAIjD,SAAS47C,KACP,IAAIC,EAAMjyE,EAAE;AACO,IAAfiyE,EAAIplF,QACNolF,EAAI17C,IAAI,mBACNi3C,GAAUyE,EAAIlqF,SAAW,WAIhB,SAASmqF,MtLPtBp+E,GAAkB6J,EAAS,sBAE3BqC,EAAE,iCAAiCmV,OACjC,mEAC2BxX,EAAS,iBACpC,yEAE4BA,EAAS,cAClC5T,QAAQ,2BAA4B,OAAS,kPAM9C4T,EAAS,wBACNnS,WACAzB,QAAQ,2BAA4B,OACvC,SACJiW,EAAE,mBAAmB4lB,MAAMgQ,KsLTvB/sC,OAAOspF,kBACTJ,GAAkBlpF,OAAOspF,iBACzBH,GACMnpF,OAAOspF,gBAAgBl9D,OAAO81B,QAEtC/qC,EAAEqmE,UAAU,KAAO/kE,GACP,KAAOA,GACnB,SAAS7a,EAAG4H,GACV0jF,GAAkB1jF,KAEpB2R,EAAEqmE,UAAUhlE,GAAiB2wE,IAC7BhyE,EAAEqmE,UAAU,qBAAsBwL,IDlBpC,SAASO,GAAU/jF,GACjB,IAEI6B,EAFAmiF,EAAOhkF,EAAK4yC,SAASA,SACrBqxC,EAAOjkF,EAAK4yC,SAAS/wC;AAEzB,GAAa,IAATmiF,EAAY,CACd,IAAIE,EAAWD,EAAK7mF,QAAQ;AAE1ByE,GADgB,IAAdqiF,EACID,EAAKzyE,UAAU,EAAG0yE,GAElBD,OAGRpiF,EAAM,iBAAmB7B,EAAK4yC,SAAS5yC,KAAK1G,KAC1C,QAAUwoB,GAAU9hB,EAAK4yC,SAAS5yC,KAAKs/C,MAAQ;AAEnDrmD,EAAoB4oF,GAAWhgF,EAAM,QAGvC,SAASsiF,KACPr8C,SAAS5W,SAAS,GAAI,EAAG,CACvB14B,GAAIgpF,GAAahpF,GACjBg1B,QAASg0D,GAAaluD,QACrB,GACHmuD,GAAQ2C,QAGV,SAASC,KACP,IAAIvoC,EAAWC,GAAU4lC,GAAShoF;AAClC,GAAKmiD,EAAL,CAEA,IADA,IAAIzwB,EAAM,GACD9sB,EAAI,EAAGA,EAAIu9C,EAAUv9C,GAAK,EACjC8sB,EAAIlsB,KA7CCkX,GAAU,CACfmH,OAAO,EACP1M,IAAK,gBACL9Q,KAAM,CACJX,EAAG,GACHojC,EAAG,EACHjqC,GAAIgpF,GAAahpF,GACjBg1B,QAASg0D,GAAaluD,OACtB5V,KAAMrB,MAER7F,SAAU,SAmCUyE,KAAK8oE;AAE3BpyE,EAAE2Z,KAAKpqB,MAAMyQ,EAAG0Z,GAAKpQ,KAAKkpE,KAyB5B,SAASG,GAAgBlsF,EAAG4H,GAC1BwhF,GAAexhF,GACf0U,GAAStV,EAASsV,GAChBnc,EAAe,yBAEjBkpF,GAAUriF,EAASqiF,GAAS9vE,EAAE+C,IAAQ1U,KAAK,2BACtC0hF,GAAkCG,GAAU7nF,YAAc,IA3B/D0nF,GAAS5qE,GAAU,CACjByH,UAAW,WACXvkB,YAAa,kCAEf2nF,GAAWlqE,GAAY,CACrBjf,GAAI,YACJ+lB,UAAW,iBACX7C,IAAK,EACLrC,IAAK,GACL1f,MAAO,EACP+C,KAAM,WAERkb,GAAc8pE,GAAQC,KACtBC,GAAQtqE,GAAa,CAACtd,YAAa,eAC7ByH,iBAAiB,QAAS4iF,IAChCzsE,GAAc8pE,GAAQE,IACtBC,GAAY/qE,KACZc,GAAc8pE,GAAQG,IACtBjqE,GAAclD,GAAQgtE,MEvFxB,SAAS6C,GAAS1M,GAChB,OAAIA,EAAO2M,6BAA+B3M,EAAO4M,sBAAwB,EAChE,iBAEF,oBA+BT,IC9BWtgF,GD8BPugF,GAAkB,CACpB,CACEjmF,KAAM,SAASo5E,GACb,MAA6B,MAAtBA,EAAO8M,YAA8C,MAAxB9M,EAAO+M,cAE7CC,QAAS,WAAY,MAAO,eAE9B,CACEpmF,KAAM,SAASo5E,GAAS,MAA6B,MAAtBA,EAAO8M,YACtCE,QAAS,WAAY,MAAO,gBAE9B,CACEpmF,KAAM,SAASo5E,GAAS,OAA6B,IAAtBA,EAAO8M,YACtCE,QAAS,SAAShN,GAAS,MAAO,gBAAkB0M,GAAS1M,KAE/D,CACEp5E,KAAM,SAASo5E,GAAS,OAA2B,EAApBA,EAAO8M,YACtCE,QAAS,SAAShN,GAAS,MAAO,kBAAoB0M,GAAS1M;AE9BpD,SAASiN,GAAWjN,GACjC,IAvBeA,EAOMA,EAQAA,EAQjBkN,GAvBWlN,EAuBQA,GAtBZpiD,SAASuvD,YACXnN,EAAOpiD,SAASwvD,gBAElBpN,EAAOjxD,OAAO6pD;AAoCrB,GAhBAoH,EAAOqN,kBAAoBH,EACzBnrF,KAAK8Y,MAAMmlE,EAAOjxD,OAAO6pD,WACzBoH,EAAOjxD,OAAO4qD,eAAiB,MAlBE,GADdqG,EAqBPA,GApBHjxD,OAAO4qD,iBAChBqG,EAAOsN,YAAc,sBACnBvrF,KAAK8Y,MAAMmlE,EAAOjxD,OAAO6pD,WACzBoH,EAAOjxD,OAAO4qD,eAAiB,MAAS,QAmB5CqG,EAAOuN,gBAAkBxrF,KAAK8Y,MAAMmlE,EAAOprC,SAAS5oB,OAClDg0D,EAAOjxD,OAAOkrD,eAAiB,MAfE,GADd+F,EAkBPA,GAjBHjxD,OAAOkrD,iBAChB+F,EAAOsN,YAAc,uCACO,EAA1BtN,EAAOuN,gBAAuB,QAiBlCvN,EAAOprC,SAAS5oB,QAAUg0D,EAAOuN,gBACjCvN,EAAOwN,mBAAqBzrF,KAAK+hB,KAAKk8D,EAAOwH,gBAC3CxH,EAAOprC,SAAS5oB,OAASg0D,EAAOqN,kBAChCrN,EAAOyN,gBAE0B,GAA/BzN,EAAO0N,qBAA2B,CACpC,IAAIC,EAAY3N,EAAOwH,gBAAkBxH,EAAOprC,SAAS5oB;AACrD2hE,EAAY3N,EAAOqN,kBACrBrN,EAAO2M,6BAA+B3M,EAAOyN,eAE7CzN,EAAO2M,6BAA+B5qF,KAAK+hB,KACzCk8D,EAAOyN,gBAAkBE,EAAY3N,EAAOqN,yBAGhDrN,EAAO2M,6BAA+B;AAGxC,OAAO3M,ECnCM,SAAS4N,GAAW5N,GACjC,IAlBkBA,EAOMA,EACpB6N,EAUAC,GAlBc9N,EAkBQA,GAjBfpiD,SAASuvD,YACXnN,EAAOpiD,SAASmwD,iBAElB/N,EAAOjxD,OAAOypD;AAiCrB,OAjBmC,EAA/BwH,EAAOjxD,OAAOyqD,iBAChBwG,EAAOsN,YAAc,qBACnBvrF,KAAK8Y,MAAMmlE,EAAOprC,SAAS9oB,QAC3Bk0D,EAAOjxD,OAAOyqD,eAAiB,MAAS,QAE5CwG,EAAOgO,oCACLjsF,KAAK8Y,OAAOizE,EACZ9N,EAAOiO,0BACPjO,EAAOjxD,OAAO8qD,qBAAuB,OACE,EAArCmG,EAAOjxD,OAAO8qD,uBAChBmG,EAAOsN,YAAc,iCACnBtN,EAAOgO,oCAAsC,QAEjDhO,EAAOkO,mBAAqBJ,EAC1B9N,EAAOiO,yBACPjO,EAAOgO,oCACThO,EAAOmO,cA5BHN,GADoB7N,EA6BeA,GA5BbprC,SAAS9oB,QAAUk0D,EAAOprC,SAAS9oB,QAC3Dk0D,EAAOjxD,OAAOyqD,eAAiB,KACE,IAA/BwG,EAAOnvE,oBACFmvE,EAAOkO,mBAAqBnsF,KAAK+hB,KAAK+pE,GAAgB,GAExD7N,EAAOkO,mBACZnsF,KAAK+hB,KAAKk8D,EAAOoO,eAAiBP,IAuB7B7N,ECjCT,SAASqO,GAAWrO,GAClBA,EAAOsO,wBAA0BvsF,KAAKyf,IAAIzf,KAAK+hB,MAC7Ck8D,EAAOiO,yBAA2BjO,EAAOmO,aAAe,GACxDnO,EAAOjxD,OAAOypD,YAAc,OAAS,GACvCwH,EAAOuO,yBAA2BxsF,KAAKyf,IAAIzf,KAAK+hB,MAC9Ck8D,EAAOwO,yBAA2BxO,EAAOyO,WAAa,GACtDzO,EAAOjxD,OAAO+pD,YAAc,OAAS,GAWzC,SAAS4V,GAAU1O,GARnB,IAAwBA;AAStBqO,GAAWrO,GACXA,EAAO2O,sBACL5sF,KAAKyf,IAAIw+D,EAAOsO,wBACdtO,EAAOuO,0BACXvO,EAAOsN,YAAc,4CACnBtN,EAAO2O,sBAAwB,OACI,IAAjC3O,EAAO2O,wBACT3O,EAAO4O,mCACL7sF,KAAK8Y,MAAkC,MAA5BmlE,EAAOjxD,OAAOypD,YACzBwH,EAAO2O,uBACT3O,EAAO6O,mCACL9sF,KAAK8Y,MAAkC,MAA5BmlE,EAAOjxD,OAAO+pD,YACzBkH,EAAO2O,uBACT3O,EAAOsN,YACL,+CACAtN,EAAO4O,mCAAqC,MAC5C5O,EAAO6O,mCAAqC,QAEhD7O,EAAO8O,0CA1BgC,GADjB9O,EA2B4CA,GA1BvDjxD,OAAOsqD,mBACTt3E,KAAK+hB,KAA6C,OAAvC,EAAIk8D,EAAOjxD,OAAOuqD,aAAe,IACjD0G,EAAO2O,uBAEJ,EAuBH3O,EAAO8O,0CACT9O,EAAO+O,mBACP/O,EAAOsN,YACL,8CACAtN,EAAO8O,0CAA4C,OAErD9O,EAAOsN,YACL,sDAqCS,SAAS0B,GAAOhP,GAtF/B,IAAqBA,EAgFHA,EAtBEA,EAWEA,EAhBNA;AAwCd,OA5F0C,GADvBA,EAuFHA,GAtFFjxD,OAAOsqD,oBACa,IAAhC2G,EAAO4M,sBAsFP8B,GAAU1O,IAlC2B,OADzBA,EAqCHA,GApCG4M,sBACoB,IAAhC5M,EAAO4M,wBA0BTyB,GADgBrO,EAWLA,GAhC0B,KADnBA,EAwBPA,GAvBAsO,wBACTtO,EAAOsN,YACL,mDAC0C,IAAnCtN,EAAOsO,0BAChBtO,EAAOsN,YAAc,2BACnBtN,EAAOsO,wBACP,6BAKkC,KADlBtO,EAcPA,GAbFuO,yBACTvO,EAAOsN,YACL,0DAC2C,IAApCtN,EAAOuO,2BAChBvO,EAAOsN,YAAc,2BACnBtN,EAAOuO,yBACP,qCAiBGvO,ECzDM,SAASiP,GAAWjP,GArBnC,IAAuBA,EAdPA,EAeVhH,EACAe,EASiBiG,EACjBhG;AAXAhB,GAfUgH,EAcOA,EAuBPA,GApCHpiD,SAASuvD,YACXnN,EAAOpiD,SAASsxD,aAElBlP,EAAOjxD,OAAOiqD,QAYjBe,EAAiBiG,EAAOjxD,OAAOgrD,eACnCiG,EAAOmP,kBAAoBptF,KAAK8Y,MAAMm+D,EAAUe,EAAiB,MAC5C,EAAjBA,IACFiG,EAAOsN,YAAc,wBAA0BtN,EAAOmP,kBACpD,QAEJnP,EAAOyN,eAAiBzU,EAAUgH,EAAOmP,kBAIrCnV,GADiBgG,EAaPA,GAZcjxD,OAAOirD,eACnCgG,EAAOoP,qBAAuBrtF,KAAK8Y,MAAMmlE,EAAOyN,eAC9CzT,EAAiB,MACE,EAAjBA,IACFgG,EAAOsN,YAAc,6BACnBtN,EAAOoP,qBAAuB;AASlC,IAjCepP,EAiCXlH,GAjCWkH,EAiCWA,GAhCfpiD,SAASuvD,YACXnN,EAAOpiD,SAASyxD,iBAElBrP,EAAOjxD,OAAO+pD;AAqCrB,GAPAkH,EAAOsP,mBAAqBxW,EAC1BkH,EAAOuP,uBAAyBvP,EAAOwO,yBACvCxO,EAAOwP,qBAAuBxP,EAAOoP,qBACvCpP,EAAOyO,WAAa1sF,KAAK8Y,MAAMmlE,EAAOsP,oBACpCtP,EAAOwH,gBAAkBxH,EAAOprC,SAAS7oB,MACzCi0D,EAAOyH,WAAazH,EAAOprC,SAAS3oB,KAEZ,EAAtB+zD,EAAOmO,aAAkB,CAC3B,IAAIsB,EAAe;AACfzP,EAAOsP,oBACPtP,EAAOwH,gBAAkBxH,EAAOprC,SAAS7oB,QAC3C0jE,EAAezP,EAAOsP,mBAAqBtP,EAAOwH,gBAChDxH,EAAOprC,SAAS7oB,OAEpBi0D,EAAO4M,qBAAuB7qF,KAAK+hB,KAAKk8D,EAAOyH,WAC7CzH,EAAOprC,SAAS3oB,GAAKwjE,QAEvBzP,EAAO4M,qBAAuB;AAEhC,OAAO5M,EC7DT,SAAS0P,GAAQ1P,GACf,OAAIA,EAAOpiD,SAASuvD,YACXnN,EAAOpiD,SAAS+xD,kBAElB3P,EAAOjxD,OAAO2pD,aAmBR,SAASkX,GAAY5P,GAhBpC,IAA0BA,EAQNA;AA2BlB,OAlBAA,EAAO6P,oBAAsBH,GAAQ1P,GACnCj+E,KAAK8Y,MAAM60E,GAAQ1P,GACnBA,EAAOjxD,OAAO2qD,kBAAoB,MAClCsG,EAAOgO,oCAnB6B,GADdhO,EAsBPA,GArBNjxD,OAAO2qD,oBAChBsG,EAAOsN,YAAc,gCACrBvrF,KAAK8Y,MAAM60E,GAAQ1P,GACnBA,EAAOjxD,OAAO2qD,kBAAoB,MAAS,QAKb,GADdsG,EAePA,GAdAjxD,OAAO6qD,cAChBoG,EAAOsN,YAAc,mCACrBvrF,KAAK8Y,MAAMmlE,EAAOprC,SAAS/oB,OAASm0D,EAAOjxD,OAAO6qD,YAClD,MAAS,QAaXoG,EAAO0N,qBAAuB3rF,KAAK8Y,MAAMmlE,EAAOoO,eAC9CpO,EAAOprC,SAAS/oB,OAASm0D,EAAOprC,SAAS/oB,OACzCm0D,EAAOjxD,OAAO6qD,YAAc,KAAQoG,EAAO6P,qBAEV,IAA/B7P,EAAOnvE,sBACTmvE,EAAO0N,qBAAuB3rF,KAAK8Y,MAAMmlE,EAAOprC,SAAS/oB,OACvDm0D,EAAOprC,SAAS/oB,OAASm0D,EAAOjxD,OAAO6qD,YAAc,KACrDoG,EAAO6P,oBAAsB,KAG1B7P,ECIM,SAAS8P,GAAe9P,GA7CvC,IAAiBA,EAOMA,EAYAA,EAUEA,EAOEA;AA8BzB,OApBAA,EAAOsN,WAAa,GA7CsB,GAD3BtN,EA+CPA,GA9CGjxD,OAAO+qD,wBAChBkG,EAAOsN,YAAc,mCACrBtN,EAAOjxD,OAAOyrD,2BAA6B,SAIxBwF,EA4CPA,GA3CPwP,qBAAuB,EACA,WAA1BxP,EAAOprC,SAASplB,QACpBwwD,EAAOwP,qBAAuBztF,KAAKyf,IAAIzf,KAAK8Y,OACzCmlE,EAAOjxD,OAAO+pD,YAAckH,EAAOprC,SAAS7oB,OAC7Ci0D,EAAOjxD,OAAO0qD,eAAiB,MAAQ,GACN,EAA/BuG,EAAOjxD,OAAO0qD,iBAChBuG,EAAOsN,YAAc,qBAAuBtN,EAAOwP,qBACnD,SAsCFxP,EAAOuP,uBACLxtF,KAAK8Y,MAAMmlE,EAAOjxD,OAAO+pD,aAAe/2E,KAAK8hB,IACN,IADU9hB,KAAK8Y,MACpDmlE,EAAOjxD,OAAOqqD,gBAAkB,GAChC4G,EAAOjxD,OAAOwqD,iBAAkB,IAAM,MAC1CyG,EAAOiO,yBACLlsF,KAAK8Y,MAAkC,MAA5BmlE,EAAOjxD,OAAOypD,YACzBwH,EAAOjxD,OAAOsqD,oBAChB2G,EAAOwO,yBACLzsF,KAAK8Y,MAAkC,MAA5BmlE,EAAOjxD,OAAO+pD,YACzBkH,EAAOjxD,OAAOsqD,sBA3CK2G,EA4CPA,GA3CP+O,mBAAqB,GACxB/O,EAAOjxD,OAAOsqD,qBAChB2G,EAAO+O,mBAAqBhtF,KAAK+hB,KAE/B,OADC,EAAIk8D,EAAOjxD,OAAOuqD,aAAe,IACzB0G,EAAOjxD,OAAOsqD,qBAMU,GADd2G,EAmCPA,GAlCLjxD,OAAOwqD,mBAChByG,EAAOsN,YAAc,qBACnBtN,EAAOuP,uBAAyB,QAKG,GADdvP,EA6BPA,GA5BPjxD,OAAOsqD,qBAChB2G,EAAOsN,YAAc,4BACnBtN,EAAOiO,yBAA2B,MAClCjO,EAAOwO,yBAA2B,4BACRxO,EAAO+O,mBAAqB,QAyBnD/O,ECUT,SAAS+P,GAAsBpyD,EAAcC,GAC3C,IA1DsBoiD,EAOLA,EAOGgQ,EAChB/yE,ECpB2B+iE,EDiF3BiQ,EAlBAjQ,EAAS;AACbA,EAAOpiD,SAAWA,EAElBoiD,EAAOjxD,OAASmqD,GAAiBv7C,GACjCqiD,EAAOnvE,oBAAsB4G,EAAS,uBACtCuoE,EAAOoO,eAAiB,OACxBpO,EAAOwH,gBA/DHD,IADkBvH,EAgEkBA,GA/DxBnvE,qBACP02E,GAAKvH,EAAOnvE,qBAAqB22E,gBAEnC,OA6DPxH,EAAOyH,WAzDHF,IADavH,EA0DaA,GAzDdnvE,qBACP02E,GAAKvH,EAAOnvE,qBAAqB42E,WAEnC,IAuDPzH,EAAOprC,UApDao7C,EAqDLhQ,EAAOjxD,OAAOyrD,4BApDzBv9D,EAAM,IACNxb,KAAOqY,EAAE,wBAAwB0O,KAAK,WAAW3mB,OACrDob,EAAIuS,MAAQ1V,EAAE,wBACX0O,KAAK,uBACL3mB,OACHob,EAAI4O,OAAS/D,GAAShO,EAAE,wBACrB0O,KAAK,oBAAoB3mB,QAC5Bob,EAAI6O,QAAUhE,GAAShO,EAAE,wBACtB0O,KAAK,oBAAoB3mB,QAC5Bob,EAAI8O,MAAQjE,GAAShO,EAAE,wBACpB0O,KAAK,oBAAoB3mB,QAC5Bob,EAAI+O,OAASlE,GAAShO,EAAE,wBACrB0O,KAAK,oBAAoB3mB,QAC5Bob,EAAIgP,GAAKnE,GAAShO,EAAE,wBACjB0O,KAAK,gBAAgB3mB,SAEgB,IAApCob,EAAIxb,KAAKmC,OAAO,iBAClBqZ,EAAI4O,QAAU9pB,KAAK+hB,KAAK7G,EAAI4O,OAASmkE,GACrC/yE,EAAI6O,SAAW/pB,KAAK+hB,KAAK7G,EAAI6O,QAAUkkE,GACvC/yE,EAAI8O,OAAShqB,KAAK+hB,KAAK7G,EAAI8O,MAAQikE,GACnC/yE,EAAI+O,QAAUjqB,KAAK+hB,KAAK7G,EAAI+O,OAASgkE,GACrC/yE,EAAIgP,IAAMlqB,KAAK+hB,KAAK7G,EAAIgP,GAAK+jE,IAExB/yE,IAoCP+iE,EAASkQ,GADTlQ,ERpCa,SAAsBA,GA5CrC,IAAwBA,EALPA,EAmBSA,EALFA;AAqCtBA,EAAO8M,WA7CqC,OADtB9M,EA8CaA,GA7CxB2M,6BACF3M,EAAO4M,qBANuB,OADxB5M,EAQIA,GAPL4M,sBACZ5M,EAAO4M,qBAAuB5M,EAAO2M,6BAO9B,IAEF3M,EAAO4M,qBAyCd5M,EAAO+M,aAhC6B,OADZ/M,EAiCeA,GAhC5B4M,qBACF5M,EAAO2M,6BAN+B,OADzB3M,EAQIA,GAPZ2M,8BACZ3M,EAAO2M,6BAA+B3M,EAAO4M,qBAOtC,IAEF5M,EAAO2M;AA4Bd,IAAK,IAAIjmF,EAAI,EAAGA,EAAImmF,GAAgBlmF,OAAQD,GAAK,EAC/C,GAAImmF,GAAgBnmF,GAAGE,KAAKo5E,GAE1B,OADAA,EAAOmQ,YAActD,GAAgBnmF,GAAGsmF,QAAQhN,GACzCA;AAIX,OADAA,EAAOmQ,YAAc,UACdnQ,EQyBEoQ,CADTpQ,EAASiN,GADTjN,EAAS4P,GADT5P,EAASiP,GADTjP,EAAS4N,GADT5N,EAAS8P,GAAe9P,UAOjBqQ,cC/EA,qFADwBrQ,EDgFCA,GC9FrBpiD,SAASuvD,YAAqB,SAClC,IAiBL,sHAbwB,EAgBdnN,EAhBDmO,aAA0B,MAC9B,MAgBL,4FAEAnO,EAAOmO,aAAe,0GAGtBnO,EAAO4M,qBACP,4FAC2C5M,EAAOyO,WAClD,uGApBiC,GAuBtBzO,EAvBF0N,qBAAmC,MACvC,MAuBL,8FAC6C,EAC7C1N,EAAO0N,qBAAuB,0GAG9B1N,EAAO2M,6BACP,iGACgD,EAChD3M,EAAOwN,mBAAqB,sGAEcxN,EAAO8M,WACjD,6FAC4C9M,EAAO+M,aACnD,4HAGA/M,EAAOmQ,YAAc,uJAGiBnQ,EAAOsN,WAC7C,iWD0CE1vD,EAAS0yD,iBAnC+B,IAAxCx2E,EAAE,2BAA2BnT,QAC/BmT,EAAE,wBACCmV,OAAO,+DAmCVghE,EAAWjQ,EAAOqQ,cAAcxsF,QAAQ,KAAM,OAC9CiW,EAAE,2BAA2B7Y,KAAKgvF,KA9BG,IAAnCn2E,EAAE,sBAAsBnT,QAC1BmT,EAAE,wBACCmV,OAAO,0DA+BVghE,EAAWjQ,EAAOqQ,cAAcxsF,QAAQ,KAAM,OAC9CiW,EAAE,sBAAsB7Y,KAAKgvF,IAIjC,SAASM,GAAapnC,EAAMvoD,GAC1B,IAAIkY,EAAOo4B,GAAS,iDAClBiY,EAAO,OAAQvoD;AACjB,OAAIkY,EAAc5W,OAAO4W,EAAK0sB,YAAYrjC,YAAY0B,QAAQ,IAAK,KAC5D,EAGT,SAAS2sF,GAAqB7yD,GAC5B,IAAI/8B,EAAM0iB,GAAeqa,GACrBowD,EAAmBwC,GAAa,SAAU3vF,GAC1C+uF,EAAoBY,GAAa,UAAW3vF,GAC5CwsF,EAAkBmD,GAAa,QAAS3vF,GACxCyuF,EAAmBkB,GAAa,SAAU3vF,GAC1CsuF,EAAeqB,GAAa,KAAM3vF;AACtC4d,GAAU,qCAAqC4E,KAAK,SAASniB,GAC3D8uF,GAAsB9uF,EAAM,CAC1BksF,aAAa,EACbY,iBAAkBA,EAClB4B,kBAAmBA,EACnBvC,gBAAiBA,EACjBiC,iBAAkBA,EAClBH,aAAcA,EACdoB,iBAAiB,MAKvB,SAASG,GAAmB9yD,GAC1B,IAAI/8B,EAAM0iB,GAAeqa,GACrB+yD,EAAiB52E,EAAElZ,GACpB4nB,KAAK;AACoB,EAAxBkoE,EAAe/pF,QAGjB6X,GAFgBkyE,EAAeC,QAAQ,YAAYnoE,KAAK,WACrD8H,KAAK,SACalN,KAAKotE,IAI9B,SAASI,GAAiCrqE,GACxC,IAAIm6D,EAAen6D,EAAIrb,OAAOmhB,aAAa,gBACvC80C,EAAM19D,EAAKiM,cAAcnK,QAAQm7E,IACxB,IAATvf,GACF19D,EAAKiM,cAAc4lB,OAAO6rC,EAAK,GAC/B56C,EAAIrb,OAAO+a,UAAY,gCAEvBxiB,EAAKiM,cAAcpI,KAAKo5E,GACxBn6D,EAAIrb,OAAO+a,UAAY,gCAEzBxB,GAAS,gBAAiBhhB,EAAKiM,cAAcsoB,QAE7CooD,KAGa,SAASyQ,KAmBtB,GAlBA/2E,EAAE,sBAAsB7Y,KAAK,IAC7B6Y,EAAE,2BAA2B7Y,KAAK,IAElCud,GAAU,qCAAqC4E,KAAK,SAASniB,GAC3D8uF,GAAsB9uF,EAAM,CAC1BksF,aAAa,EACbY,iBAAkB,EAClB4B,kBAAmB,EACnBvC,gBAAiB,EACjBiC,iBAAkB,EAClBH,aAAc,EACdoB,iBAAiB,MAGrB9xE,GAAU,iDACP4E,KAAKqtE,IAER32E,EAAE,qCAAqC7Y,KAAK,IACU,IAAlD6Y,EAAE,qCAAqCnT,OAAc,CAIvDmT,EAHuB,uIAGHuoC,YAAYvoC,EAAE,wBAC/B0O,KAAK,kBAEV,IAAIk4D,EAAe5mE,EAAE,wBAAwB0O,KAAK,WAC/C3mB;AACHiY,EAAE,qCACCwW,KAAK,eAAgBowD;AACxB,IAAIt1B,EAAY,+BACkC,IAA9C3nD,EAAKiM,cAAcnK,QAAQm7E,KAC7Bt1B,EAAY,gCAEdtxC,EAAE,qCAAqC7Y,KAAKmqD,GAC5C1qD,EAAe,oCACZkJ,iBAAiB,QAChBgnF,IAAkC,GP/LxC,IAEIE,GACAC,GACAC,GACAC,GACAC,GACAC,GAPA3J,GAAkB,OAClBC,GAAa;AA0BjB,SAAS2J,GAAYC,EAAaC,GAChC,OAAOD,EAAYlsE,uBAAuBmsE,GAAe,GACtD/oE,mBAAmBpmB,YA8DxB,IS5FWsR,GACP89E,GCJO9kF,GACAC,GV8FPgnC,GAAU,CACZ,SAASvrC,EAAMq4E,GACb,OAA0B,IAAnBA,EAAQ75E,QACb65E,EAAQ,GAAG9kE,UAAU+Q,SAAS,uBAElC,SAAStkB,EAAMq4E,GACb,OAAOA,EAAQ75E,OAAS,EAAIwB,EAAKs4E,UAEnC,SAASt4E,GACP,OAAQ8nC,SAASuwC,UAAUr4E,EAAKs4E,WAElC,SAASt4E,GACP,OAAOA,EAAK4yC,SAAS5yC,KAAKxH,KACxBsvC,SAASuwC,UAAUr4E,EAAKs4E,UAAUt4E,KAAKxH,GAAG2E;AAIhD,SAASksF,GAAerpF,GAEtB,IADA,IAAIq4E,EAAU9/E,EAAe,cAAc0lB,SAClC1f,EAAI,EAAGA,EAAIgtC,GAAQ/sC,OAAQD,GAAK,EACvC,GAAIgtC,GAAQhtC,GAAGyB,EAAMq4E,GAAW;CApEpC,SAAqB5rC,EAAU68C,GAC7B,IAAIC,EAAe3vF,KAAK+hB,KAAK8wB,EAAS3oB,GAAKw7D,GAAa7yC,EAAS7oB,MAC/Dy7D,IACEmK,EAAY;AACZb,GAAYl8C,EAAS3yB,QAAQ0vE,EAAY;AAC7C,IAAIC,EAAa,kEACsCh9C,EAAS7nB,SAC9D,4LAG8C6nB,EAAShpB,eACvD,6CAA+CgpB,EAAS3yB,MACxD,6BAA+B0vE,EAAY,KAC3Cb,GAAY,+DACwCl8C,EAAS/oB,OAC7D,0CAA4CklE,GAAc,uDACdn8C,EAAS9oB,QACrD,yCAA2CklE,GAAa,8DACLp8C,EAAS7oB,MAC5D,yCAA2CklE,GAAa,sDACbr8C,EAAS5oB,OACpD,wCAA0CklE,GAAY,2DACNt8C,EAAS3oB,GACzD,qCAAuCklE,GAAS,qCACjBO,EAAe,oDACL98C,EAASxE,KAAO;AAItDwE,EAAS1oB,aAGZ0oB,EAAS1oB,aAAa9O,QAAQ,SAAS7c,GACrCqxF,GAAc,uBAAyBrxF,EAAEkB,KACvC,yBAA2BlB,EAAEuB,MAAQ,eAJzC8vF,GAAc,kDAQhBA,GAAc,0IAEkBh9C,EAASi9C,YAAc,qGAEnBj9C,EAASnzC,KAAO,yBAGpDgwF,EAAQ5+D,QAAQC,OAAS8+D,EA0BzBE,CAAY3pF,EAAK4yC,SAAS5yC,KAAMq4E,EAAQr4E,EAAKs4E,UAAUptD,kBACpDA,kBAAkBA,mBS5GvB,SAAS0+D,GAAaC,EAAUC,GAC9B,IAAIC,EAAU3qF,EAASyqF,EAAU;AAWjC,OAVIE,EAAQruE,IACVquE,EAAQruE,IAAM9hB,KAAK8hB,IAAIquE,EAAQruE,IAAKouE,GAEpCC,EAAQruE,IAAMouE,EAEZC,EAAQ1wE,IACV0wE,EAAQ1wE,IAAMzf,KAAKyf,IAAI0wE,EAAQ1wE,IAAKywE,GAEpCC,EAAQ1wE,IAAMywE,EAETC,EAsCF,SAASC,GAAkBv9C,GAC5BnhC,IAhCN,SAAsBmhC,GACf28C,KAAaA,GAAa,IAC/BA,GAAW38C,EAASnzC,MAAQ8F,EAASgqF,GAAW38C,EAASnzC,MAAO;AAChE,IAP+BmzC,EAO3Bw9C,EAAcb,GAAW38C,EAASnzC;AAkBtC,GAjBA2wF,EAAYxmE,eAAiBrkB,EAAS6qF,EAAYxmE,eAChDgpB,EAAShpB,gBACXwmE,EAAYrlE,SAAWxlB,EAAS6qF,EAAYrlE,SAC1C6nB,EAAS7nB,UACXqlE,EAAYnwE,MAAQ1a,EAAS6qF,EAAYnwE,MACvC/f,OAAO0yC,EAAS3yB,QAClBmwE,EAAYvtF,KAAO0C,EAAS6qF,EAAYvtF,KAAM+vC,EAAS/vC,MACvDutF,EAAYrmE,MAAQgmE,GAAaK,EAAYrmE,MAC3C7pB,OAAO0yC,EAAS7oB,QAClBqmE,EAAYvmE,OAASkmE,GAAaK,EAAYvmE,OAC5C3pB,OAAO0yC,EAAS/oB,SAClBumE,EAAYpmE,OAAS+lE,GAAaK,EAAYpmE,OAC5C9pB,OAAO0yC,EAAS5oB,SAClBomE,EAAYtmE,QAAUimE,GAAaK,EAAYtmE,QAC7C5pB,OAAO0yC,EAAS9oB,UAClBsmE,EAAYnmE,GAAK8lE,GAAaK,EAAYnmE,GACxC/pB,OAAO0yC,EAAS3oB,MAxBa2oB,EAyBHA,GAxBZ1oB,cAA+C,EAA/B0oB,EAAS1oB,aAAavlB,OAwBf,CACrCyrF,EAAYlmE,aAAe3kB,EAAS6qF,EAAYlmE,aAAc;AAC9D,IAAImmE,EAASD,EAAYlmE;AACzB0oB,EAAS1oB,aAAa9O,QAAQ,SAAS7c,GACrC8xF,EAAO9xF,EAAEkB,MAAQswF,GAAaM,EAAO9xF,EAAEkB,MAAOS,OAAO3B,EAAEuB,UAG3Dmf,GAAU,iBAAkBswE,IAIPe,CAAa19C,GE9CpC,SAAS29C,GAAepqF,GAJxB,IAAiBA,EX8GgBA,GW9GhBA,EAKHA,IAJKA,EAAK4yC,UAAa5yC,EAAK4yC,SAAS5yC,OX6GlBA,EWxGdA,EXyGbmE,IAAmBklF,GAAerpF,GWxGtCgqF,GAAkBhqF,EAAK4yC,SAAS5yC,OAGlC,SAASqqF,GAAYjyF,EAAGmG,GACP,IAAXnG,EAAEsE,MACN2Z,GAAU,CACRvF,IAAK,wBAA0B1Y,EAAE4H,KAAKxH,GAAK,aAAe+F,EAC1DiY,SAAU,SACTyE,KAAKmvE,IAGV,SAASE,KACHnmF,IXKC,WACLwkF,GAAYhpE,GAASspE,GACnB1wF,EAAe,iCAAkC;AACnD,IAAI2wF,EAAc3wF,EAAe;AACjCqwF,GAAcK,GAAYC,EAAa,gBACvCL,GAAaI,GAAYC,EAAa,eACtCJ,GAAaG,GAAYC,EAAa,eACtCH,GAAYE,GAAYC,EAAa,cACrCF,GAASC,GAAYC,EAAa,WWbXqB,GACvBziD,SAASuwC,UAAUpjE,QAAQo1E,IAG7B,SAASG,MAEHrmF,IAAoBmH,KACtBg/E,KAIW,SAASG,KXnBjB,IALc/hF,EAMfA;AAuGJvE,GAAmBmL,EAAS,oBS7D5BhE,GAAiBgE,EAAS,kBAC1B4E,GAAU,kBAAkB+G,KAAK,SAASjb,GACxCopF,GAAappF,GAAQ,KT5CnB0I,EAAsB4G,EAAS,wBANhB5G,EAOHA,IALS,GAAvBA,GAA4BA,GAAuB,IAMnD22E,GAAkBD,GAAK12E,GAAqB22E,gBAC5CC,GAAaF,GAAK12E,GAAqB42E,YWmBzC3tE,EAAEqmE,UAAUjlE,GAA2By3E,IACvCA,KD7CF,IEAI17E,GFAA47E,GAAa,CACf5+B,EAAK,WACHxnD,GAAehJ,EAAKohD,MACpBn4C,GAAmBjJ,EAAKyyE,WAE1BhiB,EAAK,WACHznD,GAAehJ,EAAKgzE,OACpB/pE,GAAmBjJ,EAAK0yE,YAE1BhiB,EAAK,WACH1nD,GAAehJ,EAAKizE,OACpBhqE,GAAmBjJ,EAAK2yE;AAIrB,SAAS0c,KACd,IAAIC,EAAQF,GAAWpvF,EAAKsN;AACxBrJ,EAAWqrF,IACbA,IGnBW,SAASC,GAAyBzyF,GACzB,uBAAlBA,EAAE2K,OAAOzJ,OACbgC,EAAKsN,mBAAqBxQ,EAAE2K,OAAOpJ,MACnC2iB,GAAS,qBAAsBhhB,EAAKsN,oBACpC+hF,KACA7iD,SAASC,MAAM,KDIjB,SAAS+iD,KACP,GAAKh8E,GAAL,CACA,IACIi8E,EADMxyF,EAAe,cACPykB,uBAAuB;AACzCC,MAAMC,UAAUjI,QAAQkI,KAAK4tE,EAAS,SAASr9E,GAC7C,IAAIs9E,EAAQt9E,EAAGsP,uBAAuB;AACjB,IAAjBguE,EAAMxsF,QACRwsF,EAAM,GAAGz3E,UAAU5S,IAAI,cER7B,ICGWsqF,GDHPC,GAAc,CAChB,SAASC,GAAS,OAAQA,GAC1B,SAASA,GAAS,OAAQA,EAAO9S,SACjC,SAAS8S,GAAS,OAAiC,IAA1BA,EAAO9S,QAAQ75E;AAG1C,SAAS4sF,GAAcprF,GACrB,IAAImrF,EAAS57E,GAAUvP;AACvB,GAAIkrF,GAAY1wE,KAAK,SAAS9M,GAAK,OAAOA,MAAU,OAAO1N;AAC3D,IAAI0gF,EAAQ54C,SAAS44C;AAQrB,OAPAyK,EAAO9S,QAAU8S,EAAO9S,QAAQ3sD,OAAO,SAAShe,GAC9C,OAAgB,IAAZA,EAAGhR,OAC4B,IAA1BgR,EAAG1N,KAAKqrF,eAAuB39E,EAAG1N,KAAK8Z,OAAS4mE,EAAM4B,YAIvD/0E,KAAKC,UAAU29E,GAU3B,SAASG,GAAa91E,EAAS+1E,GAN/B,IAAsBA;AAOhBjwF,EAAKuT,sBAPW08E,EAOwBA,GANrBvrF,MACrBurF,EAAgBvrF,KAAKyiC,GACV8oD,EAAgBvrF,KAAKyiC,EAAGvvB,MAKnCsC,EAAQikD,WAAa2xB,ICvBzB,IAAII,GAAY,CACd38E,mBDZK,WACLvT,EAAKuT,oBAAsBvT,EAAKuT,mBAChCyN,GAAS,qBAAsBhhB,EAAKuT,oBACpCi5B,SAASC,MAAM,MCUfj5B,kBHZK,WAELwN,GAAS,oBADTxN,IAAqBA,IAErBg5B,SAASC,MAAM,MGUf5jC,iBfJK,WAELmY,GAAS,mBADTnY,IAAoBA,KeIpBS,iBClBa,WACbtJ,EAAKuyE,WAAavyE,EAAKuyE,UACvBvxD,GAAS,mBAAoBhhB,EAAKuyE,WAClC/lC,SAASC,MAAM,KDgBfz8B,eNbK,WAELgR,GAAS,iBADThR,IAAkBA,KMalB+D,cvB+BK,WACL/T,EAAK+T,eAAiB/T,EAAK+T,cAC3BiN,GAAS,gBAAiBhhB,EAAK+T,eAC/BiyE,GAAax5C,SAAS44C,QAAQU;AuB/BhC,SAASqK,GAAgBrzF,GACvB,IAAIwyF,EAAQY,GAAUpzF,EAAE2K,OAAOzJ;AAC3BiG,EAAWqrF,KACbxyF,EAAE2K,OAAO2oF,OACTd,EAAMxyF,IAIH,SAASuzF,KACd,IAAIjK,EAAS5qE,GAAU,CAACyH,UAAW,sBAC/BqtE,EAAW90E,GAAU,CACvBte,GAAI,gBACJslB,UAAW6S,GAAmB,oBAAsB,eAClDA,GAAmB,kBAAoB,eACvCA,GAAmB,iBAAmB,mBAEtCA,GAAmB,sBAAwB,eAC3CA,GAAmB,qBAAuB,gBtD2FvCg9C,KAAaC,MAAkB,IAAME;AsDxF5C8d,EAASnqF,iBAAiB,QAASgqF,IACnCG,EAASnqF,iBAAiB,SAAUopF,IACpCjzE,GAAc8pE,EAAQkK,GAEtBh0E,GAAc8pE,EADduJ,GAAkBn0E,MAGlB+E,GAAoB6lE,EADGnpF,EAAe,uBAAuB0lB,SAAS,IEtBxE,SAAS4tE,GAAsBztE,EAAKpe,GAC9BsE,IArBN,SAA6B8Z,EAAKpe,GAChC,GAAK1E,EAAKuyE,UAAV,CAIA,IAAIie,EAAW9rF,EAAKV,EAAEklB,OAAO,SAASC,EAAMC,GAE1C,OADAD,EAAKC,EAAKprB,OAAQ,EACXmrB,GACN,IACCsnE,EAAeznF,GAAakgB,OAAO,SAASC,EAAMC,GAEpD,OADKonE,EAASpnE,EAAKkU,SAAUnU,EAAKtlB,KAAKulB,GAChCD,GACN;AACuB,EAAtBsnE,EAAavtF,OACfysF,GAAgBntE,UAAY,wBAC1BvZ,GAAmB,sBACnBwnF,EAAal8D,KAAK,MAAQ,IACtBo7D,GAAgBntE,UAAY,QAflCmtE,GAAgBntE,UAAY,GAmBXkuE,CAAoB5tE,EAAKpe,GCR/B,SAASisF,KAbtB3wF,EAAKohD,MAAQ7zB,GAAc,gBAC3BvtB,EAAKyyE,UAAYz+D,EAAS,oBAC1BhU,EAAKgzE,OAASzlD,GAAc,iBAC5BvtB,EAAK0yE,WAAa1+D,EAAS,qBAC3BhU,EAAKizE,OAAS1lD,GAAc,iBAC5BvtB,EAAK2yE,WAAa3+D,EAAS,qBAC3BhU,EAAKiM,cAAgBshB,GAAc,iBACnCvtB,EAAKsN,mBAAqB0G,EAAS,sBACnChU,EAAKuT,mBAAqBS,EAAS,sBACnChU,EAAKuyE,UAAYv+D,EAAS,oBAC1BhU,EAAK+T,cAAgBC,EAAS,iBAK9Bq8E,KJqBAh6E,EAAEgoD,cAAc,OAAQ2xB,IGXxBX,KACAh5E,EAAEqmE,UAAUhlE,GAAiB64E,IACzBvwF,EAAKuyE,WAAarzE,OAAOspF,iBAC3B+H,GAAsB,EACpB,CAACvsF,EAAG9E,OAAOspF,gBAAgBl9D,OAAO81B,QLZtC5tC,GAAoBQ,EAAS,qBAC7BqC,EAAEqmE,UAAUjlE,GAA2B+3E,IACvCA,KOhBF,SAASoB,GAAgBxvF,GACvBiV,EAAE,2BAA6BjV,EAAKS,WAAa,mBAAmBsrB,OAOtE,IAAI0jE,GAAiB,CACnB,qBACA,kBACA,cACA,iBACA;AAGF,SAASC,KACPD,GAAel3E,QAAQ,SAASvH,EAAInP,GAbtC,IAA4B7B;AAcpB4S,EAAS5B,KAdWhR,EAeH6B,EAAI,EAd3BoT,EAAEqmE,UAAUjlE,GAA2Bm5E,GAAgBjrF,KAAK,KAAMvE,IAe9DwvF,GAAgB3tF,EAAI,MAK1B,SAAS8tF,GAAUC,EAAYC,EAAeC,GAC5C,IAAItU,EAAYoU,EAAWtvE,uBAAuBuvE;AAClDtvE,MAAMC,UAAUjI,QAAQkI,KAAK+6D,EAAW,SAASxqE,GAC/CA,EAAG6F,UAAU5S,IAAI6rF,KAIrB,SAASC,KACP,IAAIvzE,EAAM3gB,EAAe;AACzB8zF,GAAUnzE,EAAK,aAAc,YAC7BmzE,GAAUnzE,EAAK,aAAc,aAC7BmzE,GAAUnzE,EAAK,aAAc,UAU/B,SAASwzE,GAASt0F,EAAG8G,GACP,eAARA,GAAuB4oC,SAASC,MAAM,KAG7B,SAAS4kD,KACtBV,KAEAt6E,EAAEqmE,UAAU,sBAAuB0Q,IACnC0D,KAdI98E,EAAS,4BACXqC,EAAEqmE,UAAUjlE,GAA2B05E,IACvCA,MAcF/T,KACA+R,KACA94E,EAAEqmE,UAAU,mBAAoB0U,IxCN5Bp9E,EAAS,aACX4E,GAAU,iBAAiB+G,KAAK8K,IwCOlC89D,KtB6BAlyE,EAAEqmE,UAAU,yBAA0BsM,IXRtC3yE,EAAEqmE,UAAU,IAAM/kE,GAAiCirE,IiCjBnDvsE,EAAE,kBAAkBi7E,mBAAmB,CAAC1qF,OAAQ,SAChDyP,EAAE,eAAeuuB,KAAK,QC5DxB,SAAS2sD,GAAoBr3D,GACjBra,GAAeqa,IAEvBj6B,SAASilB,SAgCb,SAASssE,KAEP,I1C/BI1V,E0C+BAN,EAAkB,mBAAqB7mE,GACzC,yOAIE88E,EAAehkD,GAAS,sCACxBikD,EAAiBjkD,GAAS,sCAC1BkkD,E5C3DS,SAA0BtW,GACvC,IAAIf,EAAU;AACd,GAAIe,EAAQ,CACV,IAAIuW,EAAav7E,EAAEglE,GAAQ32E,KAAK,UAC5BmtF,EAAkBvW,GAAGlnE,KAAKw9E;AAC9BtX,EAAU77E,OAAOozF,EAAgB,IAEnC,OAAOvX,E4CoDawX,CAAiBL;AACrCjW,GAAmBL,GAASuW,EAAgBD,EAAcE,GAC1DnW,GAAmBD,KACnBC,I1CzCIM,EAAaruC,GAAS,uCAEjBouC,GAAgBC,GAElB,G0CsCH97E,EAAKqN,cACPmuE,GAAmB,8EAGrBA,GAAmB,6CACnBA,GAAmB;AAEnB,IA/CIuW,EA+CAjqB,EAAar6B,GAAS;AAErBq6B,IAGLxrD,GAAcwrD,EADAtsD,GAAU,CAACgH,UAAWg5D,KArCtC,SAAmBJ,EAAOC,EAAQf,GAChC,GALwBe,EAKHA,EALWf,EAKHA,GAAfc,GAJGC,IAAuB,IAAZf,EAIW,CACrC,IAAI0X,EAAuB/0F,EAAe,8BACtCg1F,EAAU,qEAEZ57E,EAAE,sBAAsBu+D,OAAOx2E,OAAOgC,QAAQ,KAAM,IACpD;AACF4xF,EAAqB7rF,iBAAiB,QAAS,WAC7C4U,GAAUk3E,GAAStyE,KAAK4xE,MACvB,GAbP,IAA0BlW,EAAQf,EA4ChC4X,CAAUR,EAAgBD,EAAcE,IAtDpCI,EAAU90F,EAAe,4BAE3B80F,EAAQ5rF,iBAAiB,QAAS,WAChC6a,GAAS,mBACNhN,EAAS,oBACZ/T,SAASilB,WACR,IA4DQ,SAASitE,KAClBh3E,OARAle,EAAe,cAAgBiC,OAAOstC,SACxC6kD,KAEAG,MCzEJ,ICTIY,GACAC,GACAC,GDOAr7E,GAAS,mBACTs7E,GAAyB,CAC3BC,gBAAiB,cACjBC,qBAAsB,oBACtBC,cAAe,mBACfC,YAAa,kBACbC,mBAAoB,kBACpBC,cAAe,oBACfC,mBAAoB,iBACpBC,iBAAkB,kBAClBC,iBAAkB;AAGpB,SAASC,GAAgB7hE,GACvB,IAAI8hE,EAAej2F,EAAe;AAC9Bk0B,GAASC,EAAM8hE,KACf9hE,EAAKhS,EAAE+uB,QACTld,GAAa,oEACmCiiE,GAEhDjiE,GAAa,kEACmCiiE,IAIpD,SAASC,KACP,IEtC+BtlE,EFsC3BulE,EAAiB/8E,EAAE,kBAAkBwW,KAAK,SAC1CwmE,EAAWh9E,EAAE,2BAA2BwW,KAAK;AACjDxW,EAAE,uBAAuB7Y,KAAK,aAAe41F,EAAiB;AAC9D,IAAK,IAAInwF,EAAI,EAAGA,EAAImwF,EAAgBnwF,GAAK,GEzCV4qB,EF0CpBwlE,EEzCJr4E,GAAQ,CACbyE,IAAK,YACLC,OAAQ,WACR4zE,UAAWzlE,KFsCQlO,KAAKszE,IAuB5B,SAASM,GAAsBr5D,EAAcC,GAC3C,IAAI+0C,EANN,SAAqBh1C,GACnB,IAAIg1C,EAAWj4D,GAAO7C,KAAK8lB;AAC3B,GAAIg1C,EAAW,OAAOA,EAAS,GAIhBskB,CAAYt5D,GACvBu5D,EAAqB3vF,EAASyuF,GAAuBrjB,GACvDA;AACF,GAAIA,IAAaukB,EAAoB,CACnC,IAAIC,EAAY73E,GAAS,CACvB2G,UAAW,YAAchO,GACvB,4BACAm/E,UAAUF,GAAsB;AAEtBhmD,GAAS,uBAAwBtT,GACvC7W,aAAa,UAAW,KAChChH,GAAc6d,EAASpiB,WAAWA,WAAWA,WAAY27E,IAsB7D,SAASE,KACP,IAAI/lE,EAASxX,EAAE,sBAAsBsW,QACjC3uB,EAAO6vB,EAAOrwB,OACdq2F,EAAahmE,EAAOrwB,OAAO4C,QAAQ,KAAM;AAC7CytB,EAAOrwB,KAAK,YAAcga,GACxB,iCAAmCq8E,EAAa,KAAO71F,EACvD;AAEF,IAAIqwB,EAAawe,GACf;AACExe,GACFA,EAAW1U,QAAQ,SAASm6E,GAE1B/4E,GA/BN,SAAiCg5E,GAC/B,IAEIC,EADF,oEACsB5/E,KAAK2/E;AAC7B,GAAiB,OAAbC,EACF,OAAO;AAET,IAKIC,EAAS,yBALAD,EAAS,GAK2B,WAJrCA,EAAS,GAKnB,MAJSA,EAAS,GAIH,MAHPA,EAAS,GAGY,UAFnBA,EAAS;AAIrB,OADAC,EAASz/E,GAASy/E,EAiBJC,CADDJ,EAAM1kE,QAAQC,SACgB1P,KAAK,SAASniB,GACnD+1F,GAAsB/1F,EAAMs2F;AAE9B,IAAIK,EAAwBL,EAAM/7E,WAAWA,WAC1CA,WAAWgqB,YAAYvR;AAC1B2jE,EAAsB3xE,UAAY,SAChC2xE,EAAsB3xE,UAAY,YAK3B,SAAS4xE,KAClBj5E,OACFy4E,KAvEFv9E,EAAE,2BAA2BioC,QAAQ,SAAS9yB,OAP/B,yXAQfvuB,EAAe,eAAekJ,iBAAiB,QAC7CgtF,IAAa,IGlCjB,SAASkB,KACP,IARuB1gF,EACnBogB,EACAkS,EAMAtyB,EAAkBK,EAAS;AAC/B,OAAIL,EAAkBzV,GAAM,OACnB,2KAVcyV,EAcAA,EAbnBogB,EAAIz1B,KAAK8Y,OAAOlZ,GAAMyV,GAAmB,KACzCsyB,EAAI3nC,KAAK8Y,MAAM2c,EAAI,IACvBA,GAAK,GACEgT,GAAad,EAAG,YAAclS,EAAI,SFZ3C,SAASugE,KAEP,OADKlC,KAAMA,GAAMn1F,EAAe,WACzBm1F,GAwBT,SAASmC,GAAmBC,GAC1B,IALIC,EAKAC,EAASJ,KAAYj2F,OAjB3B,WACE,IAAKi0F,GAAM,CACT,IACIt/D,EADe2nB,GAAa25C,MACNrhE,UAAU,IACpCq/D,GAAOt/D,EAAO+I,WAAW,IACpBkhC,QAAU,IACfq1B,GAAKrvE,UAAY,YAEnB,OAAOqvE,GAUPqC,IAAanyE,UAAY,oDACfkyE,EAAS,sBAAwBluE,GAAUguE,GACnD,gBAAkBhuE,IARhBiuE,EAQqCC,EAAQF,GAPlCl2F,KAAK+hB,KAAKo0E,EAAQ,MAO8B,WAOjE,SAASG,KACP,IAAI3wC,GAhCCouC,KAAMA,GAAMp1F,EAAe,UACzBo1F;AAgCP,GAAIpuC,EAAO,CACT,IAAIuwC,EAAYvwC,EAAM5lD,OACgB,IAAlCm2F,EAAUr0F,OAAO,YACnBo0F,GAAmBC,GARnBlC,IAA2B,KAAnBA,GAAK9vE,YAAmB8vE,GAAK9vE,UAAY,KGtCvD,IACIwqB,GACA6nD,GCEAC,GACAC,GDLAC,GAAW;AAIf,SAASC,GAAWC,EAAQC,GAC1B,OAAOp6E,GAAU,CACfvF,IAAK,YACL9Q,KAAM,CACJwnC,UAAW,EACXzsB,IAAK,QACLC,OAAQ,aACR01E,QAASF,EACTG,QAASF,KAKf,SAASG,KACP,IAAIC,EAAW;AACfl/E,EAAE,SAAUw+E,IAAWv+E,KAAK,SAASrT,EAAGnG,GACtCy4F,EAAS1xF,KAAKwS,EAAEvZ,GAAGyqB;AAErB,IAAIwI,EAAM;AACVwlE,EAAS57E,QAAQ,SAAS4N,EAAKm2C,GACzBn2C,IAAQytE,GAASt3B,KACrB3tC,EAAIlsB,KAAKoxF,GAAW,IAAKv3B,IACzB1wB,GAAM5gB,GAAGsxC,GAAK7wC,KAAK,CACjBq0C,IAAKvsD,GAAc,kCACnB0Q,MAAO,KACPud,OAAQ,UAGZvsB,EAAE2Z,KAAKpqB,MAAMyQ,EAAG0Z,GAAKpQ,KAAK,WACxB41E,EAAS57E,QAAQ,SAAS4N,EAAKm2C,GACjB,MAARn2C,GAAeA,IAAQytE,GAASt3B,IACpC3tC,EAAIlsB,KAAKoxF,GAAW1tE,EAAKm2C,MAE3BrnD,EAAE2Z,KAAKpqB,MAAMyQ,EAAG0Z,GAAKpQ,KAAK,WACxBzgB,OAAOe,SAAW,uCAKxB,SAASu1F,GAAY1yE,GACnBzM,EAAEyM,EAAIrb,QAAQ04C;AAId,IAAIj2B,GAFJ8iB,GACE32B,EAAE,qEACc+V,GAAG,GAAGkyB,QAAQ,SAAShhD,SAASghD,QAAQ,SAEtDpyB,EAAM7V,EAAE,UACZw+E,GAAY3oE,GACRV,OAAO,SACXwhB,GAAM12B,KAAK,SAASrT,EAAGnG,GACrB,IAAI24F,EAAOp/E,EAAEvZ,GAAG+vB,KAAK;AAEnB4oE,EADwC,EAAtCA,EAAK3zF,QAAQ,uBACR,IAEA2zF,EAAK92F,MAAM,mBAAmB;AAEvC,IAAInB,EAAO6Y,EAAE8+B;AACb9+B,EAAE,gBAAkBo/E,EAAO,IAAKj4F,GAAMyhD,KAAK,YAAY,GACvD/yB,EAAIV,OAAOhuB,KAEb0sB,EAAMsB,OAAOU,GAEb7V,EAAE,iCAAkC6T,GACjC2C,KAAK,CAACxH,MAAO,KAAMud,OAAQ,OAE9B1W,EAAM7V,EAAE,qJAIRA,EAAE,QAAS6V,GAAK+P,MAAMq5D,IACtBprE,EAAMsB,OAAOU,GE3Ef,SAASwpE,GAASC,GAChB,IAAIz1C,EAAQy1C,GAAU;AACtBz1C,EAAMR,MAAQ,GACGrpC,EAAE,wBAAwBtB,MAAM,GACtCuB,KAAK,SAASrT,EAAGnG,GAC1B,IAAIimB,EAAO1M,EAAEvZ,GACTokE,EAAMn+C,EAAK8J,KAAK,OAChBqoE,EAAS,aAAa9gF,KAAK8sD,GAAK;AACpChhB,EAAMR,MAAMw1C,GAAU,GACtBh1C,EAAMR,MAAMw1C,GAAQ1gE,MAAQ/1B,OAAO,QAChC2V,KAAK2O,EAAKu7B,QAAQ,MAAM9gD,QAAQ,IACnC0iD,EAAMR,MAAMw1C,GAAQ78E,KAAO6oD,IAE7B1jD,GAAU,YAAa0iC,GDNzB,IAAI9G,GAAY;AAEhB,SAASw8C,GAASx3F,GAChB,OAAOujB,MAAMC,UAAUmD,KAAKlD,KAAKizE,GAAU,SAAS1iF,GAClD,OAAyC,IAAlCA,EAAG1T,YAAYoD,QAAQ1D,KAqBlC,SAAS4V,GAAS5S,EAAMoG,EAASjI,GAC/B,IAAK65C,GAAUh4C,GAAM7B,GAAQ,CAC3B,IAAIs2F,GATOz0F,EASOA,EARN,WAQY7B,EAPjB,IAAImE,OAAO,aAAetC,GAE5B,aAMD/C,EAAQmJ,EAAQ9I,YAAYC,MAAMk3F,GAAO;AAC7Cz8C,GAAUh4C,GAAM7B,GAASlB,EAX7B,IAAe+C;AAab,OAAOg4C,GAAUh4C,GAAM7B,GAsBzB,SAASu2F,GAAY10F,EAAM20F,EAAS/0C,EAAUnW,GAC5C,IAGImrD,EAHAtB,EAnBG1gF,GAmBgB5S,EAAM20F,EAnBE,UAoB3B/xC,EAhBGhwC,GAgBY5S,EAAM20F,EAhBKjxE,mBAAoB;AAmB9Ck8B,EAAWgD,GAAQ+wC,IACrBiB,EAAYh1C,EAAW0zC,EACvB7pD,EAAK5nB,UAAY,YAEjB+yE,EAAY13F,KAAK8Y,MAAM29E,GAAa/wC,GAAQ0wC,EAC5C7pD,EAAK5nB,UAAY,UAEnB4nB,EAAKnsC,YAAc,KAAOs3F,EAAY,YAGxC,SAASC,GAAgB70F,EAAM20F,EAASjzE,GACtC,IAAIC,EAAOD,EAAIrb,OACXu5C,EAAWviD,OAAOskB,EAAK1kB,OACvBwsC,EA7BN,SAAiBzpC,EAAM20F,GAErB,GADK38C,GAAUh4C,KAAQg4C,GAAUh4C,GAAQ,KACpCg4C,GAAUh4C,GAAM80F,KAAM,CACzB,IAAIA,EAAOz6E;AACX8oC,GAAoBwxC,EAAS,KAC7Bz5E,GAAcy5E,EAASG,GACvB98C,GAAUh4C,GAAM80F,KAAOA,EAEzB,OAAO98C,GAAUh4C,GAAM80F,KAqBZC,CAAQ/0F,EAAM20F;AACrBjrE,GAAMk2B,IAA0B,IAAbA,EACrBnW,EAAK5nB,UAAY,UAGnB6yE,GAAY10F,EAAM20F,EAAS/0C,EAAUnW,GAGvC,SAASurD,GAAoBh1F,GAC3B,IAnEuBgR,EAmEnB2jF,EAAUH,GAASx0F,IAnEAgR,EAoEP2jF,EAnET3jF,EAAG0S,mBAAmBA,mBAC1BA,mBAAmBnC,SAAS,GAAGkN,KAAK,GAAGC,MAAM,GAAGnN,SAAS,IAkEnCxc,iBAAiB,QACxC8vF,GAAgBtwF,KAAK,KAAMvE,EAAM20F,IAGrC,SAASM,KA7ET,IAAsB92F;AA8EpBw1F,GAAa1wE,GAASpnB,EAAe,eAAeyB,aACpD03F,GAAoB,WACpBA,GAAoB,YAhFA72F,EAiFP,OAhFNq2F,GAASr2F,GAAOulB,mBAAmBA,mBACvCA,oBA+EkBtC,UAAY,YAAchO,GAC7C,qDAGJ,SAAS8hF,GAAiBP,EAASnyF,GACjC,IACI2yF,EADOX,GAASG,GACHjxE,mBAAmBA;AACpC,GAAIyxE,EAAO,CAGTv1E,GAASpd,EADGnF,OADE,eACa2V,KAAKmiF,EAAM/zE,WAAW,IAC3B,IAIX,SAASg0E,KACtB1B,GAAW13F,SAASgb,iBAAiB,2EAErCk+E,GAAiB,gBAAiB,eAClCA,GAAiB,iBAAkB,gBACnCD,KEvGF,IACII,GCTAC,GACAC,GACAC,GACAC,GACAC,GACAC,GDGAjjF,GAAkB;AAGtB,SAASkjF,GAAOhmB,EAAchgC,GAC5BrzC,EAAoBqzE,EAClB,6BAA+BhgC,EAAG,GAAK,kDEnB5B,SAA2BwC,GACxC,GAA8C,kBAA1C/6B,OAAOmJ,UAAU/f,SAASggB,KAAK2xB,KAC9B1oB,MAAM0oB,EAAMsV,WAOf,OANWtV,EAAMyjD,iBAAiBp1F,WAMpB,IALJsxC,GAAKK,EAAM0jD,cAAgB,GAKX,IAJjB/jD,GAAKK,EAAM2jD,cAIiB,IAH5BhkD,GAAKK,EAAM4jD,eAG4B,IAFvCjkD,GAAKK,EAAM6jD,iBAEuC,IADlDlkD,GAAKK,EAAM8jD,iBFapBC,CAAkB,IAAI30F,KAAa,IAARouC,EAAG,KAAc,cAchD,SAASwmD,KACP,IACI17D,EADSjb,GAAImF,iBAAiBiN,WAAW,GACxB8I,YAAY;AAEjC,OADAD,EAAQmhC,QAAU,EACXnhC,EAGT,SAASi1C,GAAe0mB,GACtB,IAnByBA,EACrBzmB,EACAzP,EAiBAyP,GAnBqBymB,EAmBYA,EAlBjCzmB,EAAet1D,GAAY,CAACuH,UAAW,gBACvCs+C,EAAQ5lD,GAAY,CACtB6G,UAAW,mGAGblG,GAAc00D,EAAczP,GAC5Bk2B,EAAM99E,QAAQq9E,GAAOrxF,KAAK,KAAM47D,IACzByP;AAaP10D,GADAm6E,GAAce,KACaxmB,GAG7B,SAAS0mB,KACH5nD,IAAUA,GAAOkB,IAMnB+/B,GALYt4D,OAAOiB,KAAKo2B,GAAOkB,IAAI7+B,IAAI,SAASvO,GAC9C,MAAO,CAACA,EAAKksC,GAAOkB,GAAGptC,MACtBklB,KAAK,SAAS/kB,EAAGC,GAClB,OAAOD,EAAE,GAAKC,EAAE,MAkBtB,SAAS2zC,GAAW70B,GACdA,EAAIrb,OAAOvK,KAAO4W,KACpB9T,EAAK8T,iBAAmB9T,EAAK8T,gBAC7BkN,GAASlN,GAAiB9T,EAAK8T,iBAd5B9T,EAAK8T,gBAORu9B,KAAoBsmD,OAAOD,KANvBjB,KACFA,GAAY1+E,WAAW+d,SACvB2gE,IAAc,GAEhB9lD,OAcJ,SAASinD,KACPvmD,KAAoBsmD,OAAOD,ICnE7B,SAASjiD,GAAS34C,GAChB,GAAsB,WAAlBA,EAAE2K,OAAOrG,KAAb,CACAtE,EAAE4J;AACF,IAAIutE,EAAOn3E,EAAE2K,OAAOwsE,KAChB/d,EAAO+d,EAAK,GAAG51E,MACf+C,EAAO6yE,EAAK,GAAG51E,MACfw5F,EAAS5jB,EAAK,GAAG51E,MACjBy5F,EAAS7jB,EAAK,GAAG51E,MACjB05F,EAAY9jB,EAAK,GAAG51E,MACpBsB,EAAOs0E,EAAK,GAAG51E;AACnBa,OAAOe,SAAW,gCAAkCmB,EAAO,SAAW80D,EACpE,SAAWv2D,EAAO,WAAak4F,EAAS,WAAaC,EACrD,cAAgBC,GAGpB,IAAIC,GAAuB,CACzB,CAAC35F,MAAO,GACR,CAACA,MAAO,GACR,CAACA,MAAO,GACR,CAACA,MAAO,GACR,CAACA,MAAO,IAGN45F,GAAc,CAChB,4BACA,+BACA,gCACA,8BACA,iCACA;AAyBF,SAASC,GAAQzwC,EAAOjyC,GACL,EAAbA,EAAItS,QACNukD,EAAMnkC,aAAa,OAAQ9N,GAkC/B,SAAS2iF,KA9BT,IACMhwF,EACAC,EACAC,EACAC,EACAC,EACAC,EAEA4vF,EAnBAC,EAhBAh+D;AA0DArmB,EAAS,wBA1DTqmB,EAASxZ,GAAIqF,qBAAqB,KACtCwwE,GAAar8D,EAAO,GACpBs8D,GAAat8D,EAAO,GACpBu8D,GAAav8D,EAAO,GACpBw8D,GAAex8D,EAAO,GACtBy8D,GAAiBz8D,EAAO,GACxB08D,GAAmBiB,GAAqB9uE,OAAO,SAASC,EAAMC,EAAMnmB,GAClE,IAAIkwB,EAAMhK;AAIV,MAH0D,YAAtDkR,EAAOp3B,GAAG2sB,kBAAkBhH,aAAa,WAC3CuK,GAAO/J,EAAK/qB,OAEP80B,GACN,GAKHnS,GAAS,sBADLq3E,EAAap4F,SAASE,QAE1B6gB,GAASi3E,GAAYlB,IAAmBsB,GAUpClwF,EAA4B6L,EAASikF,GAAY,IACjD7vF,EAA+B4L,EAASikF,GAAY,IACpD5vF,EAAgC2L,EAASikF,GAAY,IACrD3vF,EAA8B0L,EAASikF,GAAY,IACnD1vF,EAAiCyL,EAASikF,GAAY,IACtDzvF,EAAkCwL,EAASikF,GAAY,IAEvDG,EAAkB,CACpB9vF,EACAC,EACAC,EACAL,EACAC,EACAC,GAGE0uF,GAAmB,GACrBmB,GAAQvB,GAAYyB,EAAgBrB,KACpCmB,GAAQtB,GAAYzuF,GACpB+vF,GAAQrB,GAAczuF,GACtB8vF,GAAQpB,GAAgBzuF,KAExB6vF,GAAQxB,GAAY0B,EAAgBrB,KACpCmB,GAAQtB,GAAYtuF,GACpB4vF,GAAQrB,GAActuF,GACtB2vF,GAAQpB,GAAgBtuF,KAY5B,SAAS8vF,GAAaC,EAASC,GAC7B,MAAO,gCACShhF,GAAW,+BACC+gF,EAAU,8HAEA5jF,GACpC,sGAEA6jF,EAAUp4F,QAAQ,KAAM,KAAO,uGAEKuU,GACpC,oDAoBG,SAAS8jF,KACd53E,GAAI1a,iBAAiB,QAASsvC,IAC9B0iD;AACA,IAAIO,EAAa73E,GAAIqF,qBAAqB,SAAS;AACnD,GAAKwyE,EAEL,IADA,IAfgCF,EAAW5/B,EAevCxuD,EArBA4J,EAAS,cACJA,EAAS,kBAAkBjN,MAAM,KAEnC,GAmBE9D,EAAI,EAAGA,EAAIy1F,EAAW7oE,KAAK3sB,OAAQD,GAAK,EAAG,CAClD,IAAI21D,EAAO8/B,EAAW7oE,KAAK5sB,GACvBu1F,EAAY5/B,EAAK9oC,MAAM,GAAGpxB,YAAY0B,QAAQ,QAAS,KAAKk9B;AAlBlCk7D,EAmBLA,EAnBgB5/B,EAmBLA,EAlBD,GAkBtBxuD,EAlBAtI,QAAQ02F,KACrB5/B,EAAK3gD,UAAU5S,IAAI,WACnBuzD,EAAK9zC,mBAAmB7M,UAAU5S,IAAI,WACtCuzD,EAAK9zC,mBAAmBA,mBAAmB7M,UAAU5S,IAAI,WACzDuzD,EAAK9zC,mBAAmBA,mBAAmBA,mBACxC7M,UAAU5S,IAAI;AAcjB,IAAIkzF,EAAU,iBAAiBnkF,KAAKwkD,EAAK9oC,MAAM,GAAGtN,WAAW;AAC7Do2C,EAAK9oC,MAAM,GAAGtN,UAAY81E,GAAaC,EAASC,IEnIpD,SAASG,GAAYC,EAAWC,EAAUtsF,GACxC,OAAIssF,EACKD,EAAY,IAAMC,EAAS,GAAK,KAX3C,SAAqBA,GACnB,IAAK,IAAIz0F,EAAI,EAAGA,EAAI+f,GAASjhB,OAAQkB,GAAK,EACxC,GAAI+f,GAAS/f,GAAGpG,OAAS66F,EAAS,GAChC,OAAO10E,GAAS/f,GAAGi0B,KAAKx2B;AAG5B,MAAO,IAKyCi3F,CAAYD,GACxD,iBAAmBtsF,EAEhBA,EAGT,SAASwsF,GAAWC,GAClB,IAAIzsF,EAAUysF;AACTzsF,IAAUA,EAAU;AAQzB,IAPA,IA5BgBqsF,EAAWK,EAAc1sF,EA4BrCqsF,EAAY/vC,GAAoB,IAAIjmD,MACpCs2F,EAAiBj8F,EAAe,oBACjCulB,UAAUzb,MAAM,OACfoyF,EAAiB,IAAIz1F,OAAO,kFAE5B01F,EAAc,IAAI11F,OAAO,0DAEpBT,EAAI,EAAGA,EAAIi2F,EAAeh2F,OAAQD,GAAK,EAAG,CACjD,IAAI41F,EAAWO,EAAYhlF,KAAK8kF,EAAej2F,IAC3Co2F,EAAcF,EAAe/kF,KAAK8kF,EAAej2F;AACrDsJ,EAAUosF,GAAYC,EAAWC,EAAUtsF,GAtC7BqsF,EAuCKA,EAvCoBrsF,EAuCIA,EAA3CA,GAvCyB0sF,EAuCKI,GArCvBT,EAAY,8BACjBK,EAAa,GAAK,cAAgB1sF,EAE/BA,EAoCPiR,GAAU,cAAejR,GCvC3B,IAAI+2C,GAAU,CACZ,CACE9hD,UAAW,WACT,OAAOvE,EAAe,qBAExBwE,OAAQ,WACNpB,EAAW,iCDqCV2T,EAAS,gBACd4E,GAAU,eAAe+G,KAAKo5E,MClC9B,CACEv3F,UAAW,WACT,OAAOisC,GAAS,yBAElBhsC,OAAQ,WACNpB,EAAW,yCACXo4F,OAGJ,CACEj3F,UAAW,WACT,OAAOisC,GAAS,oCACdA,GAAS,wFAGbhsC,OAAQ,WACNpB,EAAW,sCACXw9C,OAYJ,CACEr8C,UAAW,WACT,OAAiD,EAA1C6U,EAAE,+BAA+BnT,QAE1CzB,OAAQ,WACNpB,EAAW,6BACX+zF;AC9CN,IACIzgF,GADA2lF,GAAkB;AAGtB,SAASC,GAAkBrtE,GACzB,GAAgD,eAA5CA,EAAIvJ,SAAS,GAAGA,SAAS,GAAGjkB,YAA8B,CAC5D,IAAI6iC,EAAUhB,GACZrU,EAAIvJ,SAAS,GAAGA,SAAS,GAAGjkB,YAAY0B,QAAQ,WAAY;AAChDuT,GAAV4tB,IACFvgB,GAASs4E,GAAiB/3D,GAC1B5tB,GAAkB4tB,IAKxB,SAASmZ,GAAYT,GAAU,OAAiB,EAAVA,EAMvB,SAASu/C,KACtB7lF,GAAkBK,EAASslF;AAC3B,IANiBj/C,EAMbA,EAAW,sBACXsB,EAAY96B,GAAIqF,qBAAqB;AAClB,EAAnBy1B,EAAUz4C,SARGm3C,EASLA,EARZz5B,GAQsB+6B,EAAU,GAAG9rB,KAAK,GARRyF,GAAe+kB,IAS7CC,GAAS,CACPD,SAAUA,EACVI,SAAUkB,EAAU,GACpBnB,QAAS,EACTL,YAAaO,GACbN,QAASm/C,MCVf,IAAIE,GAAQ,CACV,WAAY,OAAQzlF,EAAS,yBAC7B,WAAY,OAAQ6M,IACpB,WAAY,OAAOpK;AAGN,SAASijF,KAClBD,GAAMv6E,KAAK,SAAS9M,GAAK,OAAOA,OAhCtC,WACEiE,EAAE,aAAasW,QAAQE,KAAK,KAAM,UAClCxW,EAAE,cAActB,MAAM,EAAG,GAAGuB,KAAK,SAASrT,EAAGnG,GAC3CuZ,EAAEvZ,GAAG+vB,KAAK,OAAQ;AAEpB,IAAI4tB,EAAWpkC,EAAE,oBAAoBsW;AACrC8tB,EAASjvB,OAAO,0BAChBnV,EAAE,KAAMokC,GAAUruB,GAAG,GAAG0J;AACxB,IAAI6jE,EAAUtjF,EAAE,8BAA+BokC;AACxB,IAAnBk/C,EAAQz2F,QACVy2F,EAAQC,SAAS,WAAYn/C;AAE/B,IAAIo/C,EAAQxjF,EAAE,KAAMokC,GAAUruB,GAAG;AACjCytE,EAAMhtE,KAAK,UAAW,KACtBxW,EAAE,QAASwjF,GAAOC,YAAY;AAE9B,IAAIC,EAAS1jF,EAAE,UAAWwjF;AAC1BE,EAAOC,QAAQ,SAASl9F,GACtB,GAAkB,KAAdA,EAAEm9F,SAAmC,KAAjBF,EAAOxyE,MAE7B,OADAlR,EAAE,oBAAqBokC,GAAUxe,SAC1B,IAaXi+D,GCUF,SAASC,GAAathC,GACpB,IAzB8BuhC,EAyB1BC,EAAYxhC,EAAY3iD,UAAU2iD,EAAY/2D,QAAQ,cAAgB,GACxE+2D,EAAY/2D,QAAQ,aAAe,GACjCw4F,EAAiB,qBAAqBlmF,KAAKimF;AAC/C,GAAIC,EAAgB,CAClB,IAAIF,EAAiBE,EAAe,GAChCC,EAAY1hC,EAAYl6D,MAAM;AAClC,OAAI47F,GA/BwBH,EAgCGA,EAAXG,EA9BK,GAAGn6F,QAAQ,KAAM,IAAIA,QAAQ,KAAM,IAC3D2G,MAAM,WACCmiB,OAAO,SAASC,EAAM/W,GAC9B,IAAI+gB,EAAMhK,EACNqxE,EAAOpoF,EAAG0V;AAId,OAHI9nB,EAAKy6F,SAASD,KAChBrnE,GAAOnzB,EAAKy6F,SAASD,GAAM34F,WAAa,KAEnCsxB,GACN,IACI,SAAWlP,GAAcm2E,EAXhB,IAYZ,oBAqBK,SAAWn2E,GAAcm2E,GAAkB,mBAEpD,MAAO,GAGT,SAASM,GAAO9hC,EAAM+hC,EAAa10E,GAvDnC,IAAsB2yC,EAAM+hC,EAAa10E,EACnC20E,EACAC,EACAC,EAEAC;AALsBJ,EAwDPA,EAxDoB10E,EAwDPA,EAvD5B20E,EAAY,GACZC,GAFgBjiC,EAwDPA,GAtDO9oC,MAAM,GAAGtN,UACzBs4E,EAAgBD,EACjB3kF,UAAU,EAAG2kF,EAAS/4F,QAAQ,WAAa,GAC1Ci5F,EAAeF,EAChB3kF,UAAU2kF,EAAS/4F,QAAQ,eAAiB,GAAI+4F,EAAS33F,QACvDy3F,IACHC,EAAY,+FACmC30E,EAC7C,gBAEJ2yC,EAAK9oC,MAAM,GAAGtN,UAAYs4E,EAAgB,OAASF,EACjDG;AA4CF,IAzBqB90E,EApCH89B,EA6Dd8U,EAAcD,EAAK9oC,MAAM,GAAGtN,UAC5B62C,EAAYR,EAAY3iD,UAAU,EAAG2iD,EAAY/2D,QAAQ,WAAa,GACtEu4F,EAAYF,GAAathC,GACzBmiC,EAAaniC,EAAY3iD,UAAU2iD,EACpC/2D,QAAQ,cAAgB,GAAI+2D,EAAY/2D,QAAQ,aAC/Cm5F,EAAWpiC,EAAY3iD,UAAU2iD,EAAY/2D,QAAQ,YACvD+2D,EAAY31D,QACV03F,EAAY,iDACd30E,EAAa,uGAEbA,EAAa,WACXi1E,GApCiBj1E,EAoCUA,EAnC3BjmB,EAAK2N,mBACA,0DACLsY,EAAa,eAEV,IAgCHk1E,EAAU;AACVn7F,EAAK0I,oBACPyyF,GA3EgBp3C,EA2EKsV,EAAUj5D,QAAQ,UAAW,KA1E7C2jD,EAAS3jD,QAAQ,kBAAmB,KA0EesB,OAAO,EAAG;AAEpE,IAAI05F,EAAa,0FAC0Cn1E,EACzD,cAAgBk1E,EAAU;AAC5BviC,EAAK9oC,MAAM,GAAGtN,UAAY62C,EAAY,SAAW+hC,EAC/CR,EAAYP,EAAYa,EAAaF,EACrC,UAAYC,ECnED,SAASI,GAAcziC,EAAM0iC,GAR5C,IACM/5D,EAPiBq3B;AAeD,iBAAhB0iC,KAfiB1iC,EAe+BA,GAdxC9oC,MAAM,GAAGF,mBACyB,QAA5CgpC,EAAK9oC,MAAM,GAAGF,kBAAkB5M,UACiC,IAAjE41C,EAAK9oC,MAAM,GAAGF,kBAAkBsxC,IAAIp/D,QAAQ,mBAI1Cy/B,EAAUhB,GASMq4B,EAToB9oC,MAAM,GAAGpxB,cACnCsB,EAAK2T,kBACjBqN,GAAS,kBAAmBugB,GAC5BvhC,EAAK2T,gBAAkB4tB,GCbpB,IAAIg6D,GAAW,CACpBhrC,EAAK,2BACLC,EAAK,0CACLC,EAAK,mBACLC,EAAK,4BACLC,EAAK,oDACLC,EAAK,+CACLE,EAAK,+DACLC,EAAK,yBACLQ,EAAK,8BACLI,GAAM,yBACN6pC,GAAM,4BACNC,GAAM,0BACNC,GAAM,wEACNC,GAAM,+CACNC,GAAM,4DACNC,GAAM,oCACNC,GAAM,2BACNC,GAAM,gBACNC,GAAM,0BACNC,GAAM,wBACNC,GAAM,iCACNC,GAAM,8BACNC,GAAM,6BACNC,GAAM,oCACNC,GAAM,2BACNjuD,GAAM,6BACNI,GAAM,6BACNE,GAAM,2CACNE,GAAM;AChBR,IAAI0tD,GAAc;AAElB,SAAS96F,GAAOikD,EAAM7kD,EAAM2yB,GAC1B,OAAa,IAATkyB,EACK7kD,EAAO,iBAAmB2yB,EAAQ,KACvChN,GAAUk/B,GAAQ,WAEf,GAkBT,SAAS82C,GAAkBrzE,EAAM/W,GAC/B,OAAc,KAAVA,EAAGlV,GACEisB,EAAO,oCAAsC/W,EAAGqqF,OAAO,GAC5D,sBAAyBrqF,EAAGqqF,OAAO,GAAK,YAE9B,KAAVrqF,EAAGlV,GACEisB,EAAO,oCAAsC/W,EAAGqqF,OAAO,GAC5D,iDAAoDrqF,EAAGqqF,OAAO,GAC9D,iBAEGtzE,EAGT,SAASuzE,GAAYC,EAAevrE,GAClC,GAAKA,EAAKC,EAAV,CACA,IAtBYD,EAJKA,EAJAA,EA8BboC,GA9BapC,EAQLA,EAsBKA,GA7BLhS,EAAEw9E,aAAiC,IAAlBxrE,EAAKhS,EAAEy9E,UAGnBzrE,EAKgBA,GAJpBhS,EAAEw9E,aAAiC,IAAlBxrE,EAAKhS,EAAEy9E,OAK5B,WAEF;AAmBPF,EAAcn6E,UAAY/gB,GAAO2vB,EAAKhS,EAAE09E,QAAS,YAAatpE,GAC5D/xB,GAAO2vB,EAAKhS,EAAE29E,UAAW,YAAavpE,GACtC/xB,GAAO2vB,EAAKhS,EAAE49E,YAAa,cAAexpE,GAC1C/xB,GAAO2vB,EAAKhS,EAAE69E,kBAAmB,gBAAiBzpE,GAClD/xB,GAAO2vB,EAAKhS,EAAE89E,kBAAmB,aAAc1pE,GAC/CpC,EAAKhS,EAAEm8E,SAASryE,OAAOszE,GAAmB,KAG9C,SAASW,GAAe/qF,GACtB,OAAOA,EAAGlV,MAAMq+F,GAgBlB,SAAS6B,GAAgBhsE,GAClBA,EAAKhS,EAAEm8E,SAASpvE,MAAMgxE,KACzBpiF,GAAU,8CAAgDqW,EAAKhS,EAAEliB,IAC9DyiB,KAhBP,SAAsByR,EAAM5zB,GAC1B,IAAI6/F,EAAcx9E,GAAeriB,GAAM4a,iBAAiB;AACxDgZ,EAAKhS,EAAEm8E,SAAS5hF,QAAQ,SAASvH,EAAInP,GAC9Bk6F,GAAe/qF,IAIlB5R,EAAU,OAAQ,sBAChByR,KAAKC,UAAUE,GAAM,IAAMirF,EAAYp6F,GAAGvE,gBAQzBiH,KAAK,KAAMyrB,IAapC,SAASksE,GAAc1kC,GACrB,IC/FiC17D,ED+F7BqgG,EAAW,kBAAkBnpF,KAAKwkD,EAAK9oC,MAAM,GAAGtN,WAAW,GAC3Dm6E,EAAgBnhF,GAAU,CAACxU,MAAO,CAACwsB,MAAO;AAC9ClX,GAAcs8C,EAAK9oC,MAAM,GAAI6sE,GACzBJ,GAAYgB,IAAahB,GAAYgB,GAAUh8D,QACjDm7D,GAAYC,EAAeJ,GAAYgB,KCnGRrgG,EDqGpBqgG,ECpGNviF,GAAQ,CACbyE,IAAK,SACLC,OAAQ,OACR89E,UAAWtgG,KDiGUyiB,KAhBzB,SAAqBi5C,EAAMxnC,GACzB,GAAKA,EAAKC,EAAV,CACA,IAAIosE,EAAe7kC,EAAK9oC,MAAM,GAAGpxB;AACjC0yB,EAAKmQ,QAAUhB,GAAqBk9D,GAAgB,IACpDlB,GAAYnrE,EAAKhS,EAAEliB,IAAMk0B,EACzB5T,GAAU,gBAAiB++E,IAC3Ba,GAAgBhsE,KAUwBzrB,KAAK,KAAMizD,IAC9Cj5C,KAAK+8E,GAAY/2F,KAAK,KAAMg3F,IAInC,SAASe,GAAmBC,EAASC,GACnC,IAAIC,EAAcpiF,GAAW,CAAC+G,UAAWo7E;AACzCD,EAAQpyC,aAAasyC,EAAaF,EAAQntE,YAkB5C,SAASstE,GAAiBllC,GACxB,IAhByB+kC,EAgBrBd,GAhBqBc,EAgBM/kC,EAAK9oC,MAAM,GAf5B,2BAA2B3sB,KAAKw6F,EAAQn7E,YAEpDk7E,GAAmBC,EACjB,2DACK,GAEI,uBAAuBx6F,KAAKw6F,EAAQn7E,YAE/Ck7E,GAAmBC,EACjB,qDACK,QAHT,GASI,CAAC,EAAG,GAAG1+F,SAAS49F,IAAUS,GAAc1kC,GAG9C,IAAImlC,GAAiB,CACnB,SAASnlC,EAAM0iC,GAAc,MAAuB,WAAhBA,GACpC,WAAY,OAAOt7F,EAAKuO,qBACxB,SAASqqD,GACP,OAAOA,EAAK9oC,MAAM,IAAM,aAAa3sB,KAAKy1D,EAAK9oC,MAAM,GAAGtN,YAE1D,SAASo2C,GACP,OAAQ,qBAAqBz1D,KAAKy1D,EAAK9oC,MAAM,GAAGpxB;AAQ7C,SAASs/F,GAAcplC,EAAM0iC,GAJpC,IAAqB1iC,EAAM0iC;AAAN1iC,EAMHA,EANS0iC,EAMHA,EALfyC,GAAe5xE,MAAM,SAASrvB,GAAI,OAAOA,EAAE87D,EAAM0iC,MAKnBwC,GAAiBllC,GAoBxD,SAASqlC,GAAav5F,GACpB,IAbkBA,EACdi5E,EAYAugB,EAAS/mF,GAAU;CAClBzS,EAAK4oB,WAAa5oB,EAAK4oB,UAAY4wE,GAdtBx5F,EAeLA,EAdTi5E,EAAYxmE,GAAU,QAC1BolF,GAAc9jF,OAAOiB,KAAKhV,GAAMwkB,OAAO,SAASC,EAAMg1E,GAPxD,IAA6Bz5F,EAAMy5F,EAAUxgB;AAWzC,OAXyBj5E,EAQDA,EARiBi5E,EAQDA,GAPtB,eADawgB,EAQDA,IAPGz5F,EAAKy5F,GAAU58D,SAChD78B,EAAKy5F,GAAU58D,QAAUo8C,KAOvBx0D,EAAKg1E,GAAYz5F,EAAKy5F,IAEjBh1E,GACN,KACSmE,UAAYnW,GACxBqG,GAAU,gBAAiB++E,KAQzBA,GAAc73F,EAIlB,SAAS05F,GAAW15F,GACdA,GAAOu5F,GAAav5F,GEtK1B,IACI25F,GACAztF,GACAC,GAHA+5D,GAAW;AA6Bf,SAAS0zB,GAAYC,EAAiBt4E,EAAYu4E,GAChD,QAAKD,KACyC,IAA1CF,GAAiBv8F,QAAQmkB,IAC3Bu4E,EAAcx3F,MAAMwsB,MAAQ,SACrB,IAhBMvN,EAkBPA,EAlBmBu4E,EAkBPA,GAjBuB,IAAvC3tF,GAAc/O,QAAQmkB,KACxBu4E,EAAcx3F,MAAMwsB,MAAQ,OAIhBvN,EAaPA,EAbmBu4E,EAaPA,GAZuB,IAAtC5tF,GAAa9O,QAAQmkB,KACvBu4E,EAAcx3F,MAAMwsB,MAAQ,SAYvB;AApBT,IAAiBvN,EAAYu4E,EAMbv4E,EAAYu4E,EAiD5B,SAASC,GAAc7lC,GACrB,OAAOA,EAAK9oC,MAAM,GAAGU,WAAWuR,aACoB,MAAlD62B,EAAK9oC,MAAM,GAAGU,WAAWuR,YAAY4hB,UACrC,YAAYxgD,KAAKy1D,EAAK9oC,MAAM,GAAGU,WAAWuR,YAAY1pB,MAQ1D,SAASqmF,GAAa9lC,EAAM0iC,EAAar1E,EAAY00E,GAC/B,iBAAhBW,GACAmD,GAAc7lC,IA7CpB,SAAuBA,EAAM3yC,EAAY00E,GACvC,IAAKA,EAAa,CAChB,IAAIgE,EAAgB,qIAEuB14E,EACzC;AACF2yC,EAAK9oC,MAAM,GAAGtN,UAAYo2C,EAAK9oC,MAAM,GAAGtN,UAAY,OAClDm8E,EAEJ,IACIC,EADoB,kBAErBxqF,KAAKwkD,EAAK9oC,MAAM,GAAGtN,WAAW,GAC7Bq8E,EAAoBjmC,EAAK9oC,MAAM,GAAGU,WAAWuR,YAC9Cvf,UACCmlC,EAAY,mIAEsBk3C,EACpC,+DACAA,EAAoB,uGAEpBA,EAAoB;AACtBl3C,GAAa,SAAW1jC,GAAc26E,GACpC,YACE5+F,EAAK2N,qBACPg6C,GAAa,0DACWk3C,EAAoB,gBAE9Cl3C,GAAa,mBAEbiR,EAAK9oC,MAAM,GAAGtN,WAAamlC,EAiBzBm3C,CAAclmC,EAAM3yC,EAAY00E,GAIpC,SAASoE,GAAenmC,EAAM0iC,GAC5B,IAAIkD,EACAv4E,EAdgB2yC,EAAM0iC,EAetBiD,GAAkB;AACF,SAAhBjD,IAEFr1E,GADAu4E,EAAgB5lC,EAAK9oC,MAAM,GAAGU,YACHhO,UAC3B+7E,GAAkB,GAnBA3lC,EAqBHA,EApBV90D,EAAyB,aADNw3F,EAqBHA,GApBoC,iBAAhBA,IACzCmD,GAAc7lC,KAqBd3yC,GADAu4E,EAAgB5lC,EAAK9oC,MAAM,GAAGU,WAAWuR,aACdvf,UAC3B+7E,GAAkB;AAEpB,IL9B0C3lC,EAAM+hC,EAAa10E,EK8BzD00E,EAAc2D,GAAYC,EAAiBt4E,EAAYu4E;AL9BjB5lC,EK+BtBA,EL/B4B+hC,EK+BtBA,EL/BmC10E,EK+BtBA,EL9BnB,SK8Bbq1E,GL9BsBZ,GAAO9hC,EAAM+hC,EAAa10E,GK+BvDy4E,GAAa9lC,EAAM0iC,EAAar1E,EAAY00E,GAC5CqD,GAAcplC,EAAM0iC,GACpBD,GAAcziC,EAAM0iC,GAmCtB,SAAS0D,KAzIPh/F,EAAKy6F,SAAWt2E,GAAS+E,OAAO,SAASC,EAAMC,GAC7C,IAAI+J,EAAMhK;AAMV,OALYC,EAAKkP,MAAMvxB,MAAM,KACvB4S,QAAQ,SAASvH,GACrB,IAAIooF,EAAOpoF,EAAG0V;AACdqL,EAAIqnE,GAAQpxE,EAAKlsB,KAEZi2B,GACN,IAmIHnzB,EAAK2N,mBAAqBqG,EAAS;AACnC,IAAI6lD,EAAWpsB,GAAS;AAEpBosB,GA/BN,SAAuBA,GACrBwkC,GAAmB5lF,OAAOiB,KAAK1Z,EAAKi7C,WACpCrqC,GAAeg6D,GAASliC,QAAQv2B,IAAI,SAASqH,GAC3C,OAAOA,EAAI6tB,WAEbx2B,GAAgB+5D,GAASjiC,SAASx2B,IAAI,SAASqH,GAC7C,OAAOA,EAAI6tB,WAEbrnC,EAAKuO,oBAAsByF,EAAS,uBACpChU,EAAK2T,gBAAkBK,EAAS,mBAChChU,EAAK0I,kBAAoBsL,EAAS;AAClC,IAjB2B4kD,EAEvB0iC,EAeA2D,EAAgBplC,EAAShqC,KAAK,GAAGC,MAAM;AACvCmvE,GACFthG,EAAoBshG,EAAe;AAIrC,IAAK,IAAIh8F,EAAI,EAAGA,EAAI42D,EAAShqC,KAAK3sB,OAAQD,GAAK,EAvBpB21D,EAwBLiB,EAAShqC,KAAK5sB,IAtBhCq4F,EAAc1iC,EAAK9oC,MAAM,GAAGU,WAAW5H,aAAa,cACtCm2E,GAAenmC,EAAM0iC;AAuBvCjlF,EAAE,YAAY4lB,MAAM,SAASnZ,GAC3B5jB,OAAOg9B,mBAAmBpZ,EAAIrb,OAAOmhB,aAAa,iBAChD,GAAI9F,EAAIrb,OAAOmhB,aAAa,cASjBs2E,CAAcrlC,GAGhB,SAASslC,KAClB1oF,MACJJ,EAAE2Z,KACAyrB,IAAa,GACb9T,IAAQ,GAAOhoB,KAAK,SAASjb,GAC3BkmE,GAAWlmE,IFcRkU,GAAU,iBAAiB+G,KAAKy+E,KEXrCz+E,KAAKq/E,IClKT,SAASI,KACP,IAAIC,EAAgBpiG,EAAe,cAChCykB,uBAAuB;AAC1B,GAA6B,IAAzB29E,EAAcn8F,OAAlB,CAEA,IADA,IAAI6sB,EAAM,GACD9sB,EAAIo8F,EAAcn8F,OAAS,EAAQ,GAALD,EAAQA,GAAK,EAAG,CACrD,IAAIq8F,EAAeD,EAAcp8F,GAC7Bs8F,EAAYD,EAAavnF,WAAWA,WAAW6X,kBAChDA;AACH0vE,EAAa96D,UAAY,aAAe7vB,GACtC,6CACFob,EAAIlsB,KACFkX,GAAU,CACRvF,IAAK,uDACL9Q,KAAM,CAAC86F,WAAY,eAAeprF,KAAKmrF,EAAUnwE,QAAQC,QAAQ,OAIvEhZ,EAAE2Z,KAAKpqB,MAAMyQ,EAAG0Z,GAAKpQ,KAAK,WACxB1iB,EAAe,WAAWg/B,WC1B9B,IAyBIwjE,GC3BAC,GACA/1E,GACAg2E,GDAAC,GAAa,CACfC,SAAU,OACVC,SAAS,EACTC,QAAS,EACTC,OAAQ,EACRt7F,KAAM,CACJwnC,UAAW,EACXzsB,IAAK,OACLC,OAAQ,eAEVugF,aAAc,IAEZC,GAAY,CACdL,SAAU,aACVC,SAAS,EACTC,QAAS,EACTC,OAAQ,EACRt7F,KAAM,CACJwnC,UAAW,EACXzsB,IAAK,QACLC,OAAQ,OACRo+B,QAAS,eAEXmiD,aAAc;AA2BhB,SAASE,GAAc7oD,GACrB,IAAIn6C,EAAM0iB,GAAey3B,GACrBzL,EAAUx1B,EAAE,iBAAkBlZ;AAClC,GAAuB,IAAnB0uC,EAAQ3oC,OAAZ,CA1BF,IAAmB2oC,EACbpkC;AADaokC,EA2BPA,EAzBY,KADlBpkC,EAAS4O,EAAE,mBACJnT,OACTmT,EAAE,QAAQ4sB,QAAQ4I,EAAQyS,QAAQ,UAElC72C,EAAO62C,QAAQ,SAASw7C,YAAYjuD,EAAQyS,QAAQ,UAuBtDjoC,EAAE,qBAAqBjY,KAAKiY,EAAE,oBAAqBlZ,GAAKiB,QACxDiY,EAAE,wCAAwCjY,KAAK,SAAS0uB,GACtD,OAAOzW,EAAE,uCAAwClZ,GAAKivB,GAAGU,GAAO1uB;AAElE,IAvBmB2lB,EAMQ5mB,EAiBvB4mB,EAAI07E;AACRppF,EAAE,UAAUtB,MAAMgP,EAAEi8E,QAAQ5hG,KAAK,SAAS0uB,GACxC,OAAOzW,EAAE,SAAUlZ,GAAK4X,MAAMgP,EAAEi8E,QAAQ5zE,GAAGU,GAAO1uB,SAzBjC2lB,EA2BPA,EA1B6B,MAArC1N,EAAE,UAAU+V,GAAGrI,EAAEg8E,SAAS3hG,QAC5BiY,EAAE,+BAA+B4oC,KAAK,YAAY,GAIzB9hD,EAsBPA,EArBU,MAqBb4mB,EArBXrf,KAAK07F,eACT/pF,EAAE,wBAAwBkR,IAAIlR,EAAE,uBAAwBlZ,GAAKoqB,OAE7DlR,EAAE,wBAAwBkR,IAAI,KAmBhClR,EAAE,yBAAyBkR,IAAIxD,EAAEk8E,eAQnC,SAAShmF,GAAOomF,GACdtlF,GAAU,CAACvF,IAAK,YAAa9Q,KAAM27F,IAAQ1gF,KAAKwgF,IAGlD,SAASG,GAAYxjG,GACnBA,EAAE4J;AACF,IAXqBqd,EAAG2wE,EAWpB3wE,EAAI07E,GACJ/K,EAASr+E,EAAE,wBAAwBkR,OAZlBxD,EAaHA,EAbM2wE,EAaHA,EAZuB,MAArCr+E,EAAE,UAAU+V,GAAGrI,EAAEg8E,SAAS3hG,SAC9BiY,EAAEkqF,UAAU7L,IAAWA,EAAS,KAYnC3wE,EAAErf,KAAKwxD,KAAO,UACdnyC,EAAErf,KAAK07F,eAAiB1L,EACxBz6E,GAAO8J,EAAErf,OAGX,SAAS87F,GAAe1jG,GACtBA,EAAE4J;AACF,IAAIqd,EAAI07E,GACJ/K,EAASr+E,EAAE,yBAAyBkR;CACnClR,EAAEkqF,UAAU7L,IAAWA,EAAS,IACrC3wE,EAAErf,KAAKwxD,KAAO,WACdnyC,EAAErf,KAAK+7F,gBAAkB/L,EACzBz6E,GAAO8J,EAAErf,OAoBX,SAASo7F,GAAQ/7E,EAAG28E,GAjBpB,IAA4BA;AAAAA,EAkBPA,EAAH38E,EAjBV+7E,SACJY,EAAKt0E,GAAG,GAAGkyB,QAAQ,MAAM/nC,MAAM;AAiBjC,IAAIoqF,EAAOtqF,EAAE;AACb,GAAoB,IAAhBsqF,EAAKz9F,OAAT,CACA,IAbsB6gB,EAAG48E,EAAMC,EAa3BA,EAAWvqF,EAAE;AACjB,GAAwB,IAApBuqF,EAAS19F,OAdS6gB,EAePA,EAfU48E,EAePA,EAfaC,EAePA,EAdiB,MAArCvqF,EAAE,UAAU+V,GAAGrI,EAAEg8E,SAAS3hG,OAC5BuiG,EAAK1hD,KAAK,YAAY,GAEtB0hD,EAAK1kE,MAAMqkE,IAEbM,EAAS3kE,MAAMukE,KAoBjB,SAASK,KART,IACM98E,EACA28E;AAOAvlF,OARA4I,EAAI07E,GAEY,KADhBiB,EAAOrqF,EAAE,WACJnT,QAAgBw9F,EAAKt0E,GAAG,GAAGhuB,SAAW2lB,EAAE87E,UAC/CC,GAAQ/7E,EAAG28E,IC7Hf,SAASI,KACP,IAAIpiG,EAAcirB,GAAStrB,MACvB0iG,EAAQriG,EAAYwE;AACZw8F,GAARqB,IACFriG,EAAcA,EAAYwX,UAAU,EAAGwpF,IACvC/1E,GAAStrB,MAAQK,EACjBqiG,EAAQrB,IAELC,KACHA,GAAkBh2E,GAAS5R,WAAWA,WAAWA,WAAWA,WACzDkb,YAAY8I,cAEjB4jE,GAAgBn9E,UAAY,gEACOu+E,EAAQ,IAAMrB,GAC/C,sDAAwDhhG,EACxD,oCAGJ,SAASsiG,MACPr3E,GAAW1sB,EAAe,iBACjBkJ,iBAAiB,QAAS26F,ICyCrC,ICtDIG,GACA/gE,GDqDJghE,GAAe,CACbC,SAAU,CAACC,IAAK,CAACA,IAAK,CAACA,IAAK,CAACA,I3EkGhB,WACb,IAAI3qF,KAAJ,CApJAzW,EAAKuyE,UAAYv+D,EAAS,oBAC1BhU,EAAKohD,MAAQptC,EAAS,gBACtBhU,EAAKyyE,UAAYz+D,EAAS,oBAC1BhU,EAAKgzE,OAASh/D,EAAS,iBACvBhU,EAAK0yE,WAAa1+D,EAAS,qBAC3BhU,EAAKizE,OAASj/D,EAAS,iBACvBhU,EAAK2yE,WAAa3+D,EAAS,qBAC3BhU,EAAKiM,cAAgB+H,EAAS,iBAE9BhU,EAAKyM,sBAAwBuH,EAAS,yBACtChU,EAAK2M,YAAcqH,EAAS,eAC5BhU,EAAKoN,oBAAsB4G,EAAS,uBACpChU,EAAKsN,mBAAqB0G,EAAS,sBACnChU,EAAKszE,SAAWrhE,KAAKC,UAAU7Q,cAAc6B,OAC/C,QAAwB,KAAKqwE,QAAQ,GAwInCH;AACA,IAAIiuB,EAAepkG,EAAe;AAClCU,EAAoB0jG,EAAc,yBAChCrhG,EAAKqzE,WAAa,UACiB,EAAjCh9D,EAAEgrF,GAAc3lD,KAAK,WACvBrlC,EAAEgrF,GAAc3lD,KAAK,MAAO,eAAgB,gBAxChD,WACE,IAAI4lD,EAAU7lF,GAAW,CACvBve,GAAI,cACJ+lB,UAAW,UACXvkB,YAAa;AAEf4iG,EAAQn7F,iBAAiB,QAASqtE;AAClC,IAAIvrD,EAAShrB,EAAe,kBAAkB2yB,kBAC3CC,KAAK,GAAGC,MAAM;AACjBxT,GAAc2L,EAAQhM,MACtBK,GAAc2L,EAAQq5E,GAEtBrkG,EAAe,mBACZkJ,iBAAiB,QAASutE,IAE7Bz2E,EAAe,sBACZkJ,iBAAiB,QAASwtE,IAC7B12E,EAAe,mBACZkJ,iBAAiB,QAASiuE,IAC7Bn3E,EAAe,0BACZkJ,iBAAiB,QAASkuE,IAE7Bp3E,EAAe,8BACZkJ,iBAAiB,QAASqlD,IAC7BvuD,EAAe,8BACZkJ,iBAAiB,QAASqlD,IAC7BvuD,EAAe,8BACZkJ,iBAAiB,QAASqlD,IAC7BvuD,EAAe,8BACZkJ,iBAAiB,QAASqlD,IAa7B+1C,GACAvgF,GAAS,gBAAiB/jB,EAAe,kBACtC2yB,kBAAkB5J,iBAAiB6J,KAAK,GAAGC,MAAM,GAAGF,kBACpDvxB,a2E9GHmjG,MAAO,CAACJ,IAAK,CAACA,IAAK,CAACA,IAAK,CAACA,IAAKjP,OAC/BsP,KAAM,CACJ57E,MAAO,CAACu7E,IAAK,CAACA,IAAK,CAACA,ID1CjB,WACL1B,GAAgB,IAChBsB,SCyCEU,SAAU,CAACN,IAAK,CAACA,IAAK,CAACA,IDtCpB,WACL1B,GAAgB,IAChBsB,UCsCAW,WAAY,CAACC,UAAW,CAACR,IAAK,CAACA,IAAK,CAAC5wC,EAAK2hC,OAC1CjyC,MAAO,CACLkhD,IAAK,CAACA,IAAK,CAACA,IAAK,CAACA,IAAK/gD,MACvB9rB,KAAM,CAAC6sE,IAAK,CAACA,IAAK,CAACA,IAAK/gD,MACxBwhD,UAAW,CAACT,IAAK,CAACA,IAAK,CAACA,InNpDb,WACTjmF,MAnBN,WACE,IAAI2mF,EAAazrF,EAAE,yBACf0rF,EAAa1rF,EAAE;AACnB,GAA0B,IAAtByrF,EAAW5+F,OAAc,CAC3B,IAAI8+F,EAAc3rF,EAAE;AACpByrF,EAAWG,OAAOD,GAAaC,OAAO,UACtCD,EAAY/lE,MAAM,WAAY0Z,GAAS,KAEzC,GAA0B,IAAtBosD,EAAW7+F,OAAc,CAC3B,IAAI+mB,EAAW5T,EAAE,0BAA0BioC,QAAQ,MAAMn1B,OAAO/qB,OAC7DgC,QAAQ,MAAO,IACd8hG,EAAe7rF,EAAE;AACrB0rF,EAAWxrF,MAAM2rF,GAAc3rF,MAAM,UACrC2rF,EAAajmE,MAAM,WAAY0Z,GAAS1rB,KAE1C5T,EAAE,4BAA4B4lB,MAAMwZ,IAId0sD,OmNoDpBC,SAAU,CAAChB,IAAK,CAACA,IAAK,CAACA,IjB3DZ,WACT3qF,MACJmC,GAAU,aAAa+G,KAAK+1E,QiB0D1Bh2F,MAAO,CAAC0hG,IAAK,CAACA,IAAK,CAACA,InBET,WACb,IAAI3qF,KAAJ,CACA,IAAIpB,EAAOgB,EAAE;AACO,IAAhBhB,EAAKnS,SACTmS,EAAKoW,SAAS,oBACdpW,EAAK4mB,MAAMu5D,WmBLX6M,UAAW,CACTjB,IAAK,CAACA,IAAK,CAACA,IAAK,CAACA,IAAK3I,MACvB6J,KAAM,CAAClB,IAAK,CAACA,IAAK,CAACA,IAAK3I,MACxB8J,UAAW,CAACnB,IAAK,CAACA,IAAK,CAACA,If0ErB,WACL,IAAIl5F,EAAsB8L,EAAS;AACF,EAA7B9L,EAAoBhF,QACtB2d,GAAIqF,qBAAqB,KAAK,GAC3B5C,aAAa,OAAQpb;AAE1B,IAAIqwF,EAAUviF,GAAgB,YAC1B8xD,EAAajnD,GAAIqF,qBAAqB,MAAM;AAGhDvoB,EAAoBmqE,EAAYwwB,GAAaC,EAF7BzwB,EAAW5hD,qBAAqB,QAAQ,GAAGxnB,YACxD0B,QAAQ,KAAM,WejFjBoiG,QAAS,CACPpB,IAAK,CAACA,IAAK,CAACA,IAAK,CAACA,IAAKt6B,MACvB27B,gBAAiB,CAACrB,IAAK,CAACA,IAAK,CAACA,IAAKt6B,MACnC47B,OAAQ,CAACtB,IAAK,CAACA,IAAK,CAACA,IAAKt6B,MAC1B67B,UAAW,CAACvB,IAAK,CAACA,IAAK,CAACA,IAAKt6B,MAC7Bx1C,QAAS,CAAC8vE,IAAK,CAACA,IAAK,CAACA,IAAKt6B,MAC3B87B,UAAW,CAACxB,IAAK,CAACA,IAAK,CAACA,IAAKp8C,MAC7B69C,UAAW,CAACzB,IAAK,CAACA,IAAK,CAACA,IE3Fb,WCAA,IAIT0B,EACAC,EAJAC,EAEAnrD,EAGA39B;ADLJkvD,KCAI45B,EAASniF,GAAIqF,qBAAqB,QAAQ,GAC3CpB,mBAAmBA,mBAAmBA,mBACrC+yB,EAAUmrD,EAAO98E,qBAAqB,OAGtChM,EAAU,oHAEdyH,MAAMC,UAAUjI,QAAQkI,KAAKg2B,EAAS,SAAS/6C,GAC7C,IAAIokE,EAAMpkE,EAAE8rB,aAAa,QACc,IAAnCs4C,EAAIp/D,QAAQ,oBAA2BghG,GAAa,IACpB,IAAhC5hC,EAAIp/D,QAAQ,iBACdihG,GAAO,EACP7oF,GAAW,iBAAmBpd,EAAEib,WAAWM,KACxC1Z,MAAM,uBAAuB,GAAK,IACnC7B,EAAEib,WAAWA,WAAWrZ,YAAc,eAGvCokG,GAAeC,GAGpBniF,GAAmBoiF,EAFnB9oF,GAAW,sGH0EX+oF,aAAc,CACZ7B,IAAK,CAACA,IAAK,CAACA,IAAK,CAACA,IH3Cf,WApBP,IACM8B,EAIAC;CAgBA1sF,MAAuBoK,KApBvBqiF,EAAYznF,GAAW,CACzBwH,UAAW,YACXvkB,YAAa,gBAEXykG,EAAOlmG,EAAe,QAAQ8a,WAAWA,WAC1C+M,mBAAmB8K,mBACjB3X,UAAU5S,IAAI,aACnBsb,GAAqBwiF,EAAM,KAC3B19D,GAAwB09D,EAAMD,GAC9BviF,GAAqBwiF,EAAM,KAC3BD,EAAU/8F,iBAAiB,QAASi5F,IAIhCprF,EAAS,yBACX/W,EAAe,aAAa66B,SAAU,GAQxC76B,EAAe,SAASg/B,aGwCtBmnE,YAAa,CAAChC,IAAK,CAACA,IAAK,CAACA,IHrCvB,WACLhrD,GAAW,gBGsCXsd,MAAO,CACL/a,UAAW,CACT+pD,OAAQ,CAACtB,IAAK,CAACA,II7FN,WACT3qF,OACJglC,IAAa,GAAO97B,KAAK,WACvBta,EAAI,EAAGmqE,MAETnqE,EAAI,EAAGqqE,IACPrqE,EAAI,EAAGgqE,IACPxuD,GAAIqF,qBAAqB,SAAS,GAC/B/f,iBAAiB,QAASymE,QJsFzBy2B,QAAS,CAACjC,IAAK,CAACA,IAAKzzC,KACrB21C,WAAY,CAAClC,IAAK,CAACA,IAAKzzC,KACxB41C,WAAY,CAACnC,IAAK,CAACA,IAAKh4B,MAE1Bo6B,KAAM,CAACpC,IAAK,CAACA,IAAK,CAACA,IKtGhB,WACL1H,KACA9+B,GAAe,OAAQ,OLqGrBz0C,IAAK,CAACi7E,IAAK,CAACA,IAAK,CAACA,IKlGf,WACLxmC,GAAe,WAAY,GAC3Bd,SLiGE2pC,OAAQ,CACNC,UAAW,CAACtC,IAAK,CAACA,IlM1FT,WACT3qF,OACJsrC,GAAaiE,GAAe5oD,WACb6oD,eACbH,KAAenmC,KAAKgmC,OkMuFlBg+C,uBAAwB,CAACvC,IAAK,CAACA,IAAKz4C,KACpCi7C,QAAS,CAACxC,IAAK,CAACA,IAAKz4C,KACrBy4C,IAAK,CAACA,IAAK,CAACA,IAAKz4C,MAEnBk7C,OAAQ,CAACzC,IAAK,CAACA,IAAK,CAACA,I7LyCV,WACb/7F,EAAI,EAAGy0B,IACPz0B,EAAI,EAAGymD,IACPzmD,EAAI,EAAG0mD,IACPlJ,GAA0BhiC,GACvBmF,iBAAiB6J,KAAK,GAAGC,MAAM,GAAGF,kBACrCvqB,EAAI,EAAGqnD,IACPrnD,EAAI,EAAGunD,IACPvnD,EAAI,EAAGynD,IACPznD,EAAI,EAAG4nD,IACP5nD,EAAI,EAAG6nD,IACHz2C,OAEAzC,EAAS,yBACX3O,EAAI,EAAGmnD,IAETnnD,EAAI,EAAG4lD,S6LxDL64C,QAAS,CACP1C,IAAK,CAACA,IAAK,CAACA,IAAKvjD,KACjBkmD,OAAQ,CAAC3C,IAAK,CAACA,IAAKvjD,MAEtBmmD,QAAS,CAAC5C,IAAK,CAACA,IAAK,CAACA,IAAKp8C,MAC3Bi/C,KAAM,CAAC7C,IAAK,CAACA,IAAK,CAACA,IvEtER,WAMb,GALA/7F,EAAI,EAAGy0B,IACPgyB,KACAC,KACAzgD,GAA4B0I,EAAS,6BACrCzI,GAA+ByI,EAAS,gCATjCvV,OAAOuX,GAAgB,eAAiB2U,OAC5Crf,IAA8BC,IASjC,CACAqZ;AACA,IAAI4Z,EAAUphC,SAASgb,iBACrB;AACFuJ,MAAMC,UAAUjI,QAAQkI,KAAK2c,EAAS27C,SuE6DpC+pB,WAAY,CAAC9C,IAAK,CAACA,IAAK,CAACA,ItFOd,WACT3qF,MACJmC,GAAU,cAAc+G,KAAKkyD,QsFR3BsyB,QAAS,CAAC/C,IAAK,CAACA,IAAK,CAACA,I5MlFX,WACT3qF,OACJoK,GAAI1a,iBAAiB,QAAS20C,IAC9Bn9C,EAAoBP,SAASy+B,cAAc,wBACzC,+C4M+EAvc,MAAO,CAAC8hF,IAAK,CAACA,IAAK,CAACA,I5L4DT,WACT3qF,OACJglC,IAAa,GAAM97B,KAAK,SAASs7B,GAC/B51C,EAAI,EAAG4qD,GAAU,CAAChV,MAEpB51C,EAAI,EAAGmqD,S4LhEL40C,UAAW,CAACC,WAAY,CAACjD,IAAK,CAACA,IlG7FpB,WACT3qF,MACJkxB,KAAUhoB,KAAK2sD,QkG4Fbo0B,KAAM,CAACU,IAAK,CAACA,IAAK,CAACA,IFahB,WACL3B,GAAeS,GACfW,SEdEyD,KAAM,CACJlD,IAAK,CAACA,IAAK,CAACA,I9M/GH,WACb,IAViB/mD,EAAUp1B,EACvBs/E,EASAlqD,EAAW,oBACXI,EAAW55B,GAAImF;AACfy0B,aAAoB+pD,mBAZPnqD,EAaLA,EAbep1B,EAaLw1B,EAAS/3B,uBAAuBA,uBAZlD6hF,EAAQ/oF,GAAU,CACpByH,UAAW,cACXT,UAAW6S,GAAmBglB,KAEhCp1B,EAAShN,UAAU5S,IAAI,eACvBiX,GAAc2I,EAAUs/E,GAQtBjqD,GAAS,CACPD,SAAUA,EACVI,SAAUA,EACVD,QAAS,EACTL,YAAaO,S8MuGb+pD,KAAM,CAACrD,IAAK,CAACA,IAAKp8C,OAGtB07C,KAAM,CAACU,IAAK,CAACA,IAAK,CAACA,IAAK,CAACA,IFYpB,WACL3B,GAAeG,GACfiB,UEbA16E,IAAK,CACHi7E,IAAK,CAACA,IAAK,CAACA,IAAK,CAACA,IKnHf,WACLxmC,GAAe,YAAa,GAC5BukC,SLkHEuF,OAAQ,CAACtD,IAAK,CAACA,IAAK,CAACA,IKxHlB,WACLxmC,GAAe,SAAU,QLyHzB+pC,aAAc,CAACvD,IAAK,CAACA,IAAK,CAACA,IAAK,CAACA,IxM9DpB,WACb,IAAI3qF,KAAJ,CACA,IAAImuF,EAAQ/jF,GAAIqF,qBAAqB,OAAO;AAC5C0+E,EAAM3hF,UAAY;AAClB,IAAI4hF,EAAUhkF,GAAIqF,qBAAqB;AACvCvE,MAAMC,UAAUjI,QAAQkI,KAAKgjF,EAAS,SAASzyF,EAAInP,GACjD,IAAIsuB,EAAOnf,EAAGwd,kBACVP,EAASkC,EAAKnC,QAAQC;AAC1BqxB,GAAcA,GACXtgD,QAAQ,IAAM6C,EAAI,IAAK09C,IACvBvgD,QAAQ,QAASmxB,EAAK3I,aAAa,QACnCxoB,QAAQ,WAAYivB,EAAO1wB,MAAM,mBAAmB,IACpDyB,QAAQ,WAAYivB,KAEzBqxB,GAAcA,GAAYtgD,QAAQ,QAAS,IAC3CzC,EAAoBinG,EAAM7sF,WAAY2oC,IACtCzjD,EAAe,aAAakJ,iBAAiB,QAASmkB,IACtDrtB,EAAe,cAAckJ,iBAAiB,QAAS66C,IACvD/jD,EAAe,UAAUkJ,iBAAiB,QAAS86C,UwM6CnD6jD,YAAa,CAACC,UAAW,CAAC3D,IAAK,CAACA,IAAK,CAACA,ItBlFzB,WACbvgF,GAAI1a,iBAAiB,QAASyuF,SsBkF9BoQ,UAAW,CAAC5D,IAAK,CAACA,IAAK,CAACA,IAAK,CAACA,IpGkGjB,WACb,IAAI3qF,KAAJ,CACA,IAAIwuF,EAAehoG,EAAe;AAC7BgoG,IACLrkF,GAAmBqkF,EAAar1E,kBAAmBy5C,IACnDjiC,GAAWloC,OAAO6jB,MAAMpD,KAAKksD,WoGtG7Bq5B,QAAS,CACPC,SAAU,CAAC/D,IAAK,CAACA,IAAK,CAACA,IAAK12E,MAC5B06E,cAAe,CAAChE,IAAK,CAACA,IAAK,CAACA,IAAK1pC,MACjC2tC,YAAa,CAACjE,IAAK,CAACA,IAAK,CAACA,IAAK1pC,MAC/B4tC,cAAe,CAAClE,IAAK,CAACA,IAAK,CAACA,IAAKvwE,MACjC00E,cAAe,CAACnE,IAAK,CAACA,IAAK,CAACA,IAAKnpE,MACjCutE,cAAe,CAACpE,IAAK,CAACA,IAAK,CAACA,IAAKh0E,MACjCq4E,iBAAkB,CAACrE,IAAK,CAACA,IAAK,CAACA,IAAKlpE,MACpCwtE,WAAY,CAACtE,IAAK,CAACA,IAAK,CAACA,IAAK13E,MAC9Bi8E,aAAc,CAACvE,IAAK,CAACA,IAAK,CAACA,IAAKxuE,MAChCgzE,UAAW,CAACxE,IAAK,CAACA,IAAK,CAACA,IAAKxqE,MAC7B7pB,aAAc,CAACq0F,IAAK,CAACA,IAAK,CAACA,IAAKp8E,MAChC6gF,eAAgB,CAACzE,IAAK,CAACA,IAAK,CAACA,IAAK76E,MAClCu/E,YAAa,CAAC1E,IAAK,CAACA,IAAK,CAACA,IhIwFf,WACT3qF,MACJmC,GAAU,gBAAgB+G,KAAK29C,QgIzF7ByoC,UAAW,CAAC3E,IAAK,CAACA,IAAK,CAACA,IAAKpiE,MAC7BgnE,UAAW,CAAC5E,IAAK,CAACA,IAAK,CAACA,IAAKniE,MAC7BgnE,aAAc,CAAC7E,IAAK,CAACA,IAAK,CAACA,IMpJhB,WACb,IAAI3qF,KAAJ,CAIA,IAHA,IAAIgO,EAAU5D,GACVqlF,EAAc,GACd1iG,EAAOD,gBACFN,EAAI,EAAGA,EAAIO,EAAKN,OAAQD,GAAK,EACpCijG,EAAY1iG,EAAKP,IAAM+Q,EAASxQ,EAAKP;AAEvCwhB,EAAQjC,UAAY,6ZAQlBvQ,KAAKC,UAAUg0F,GAAe,sHAGhC7vF,EAAE,uBAAuB4lB,MAAM,WAC7B,IAAItE,EAAY1jB,GAAUhX,EAAe,qBAAqBoB;AAC9D,GAAImY,GAASmhB,GAAY,CACvB,IAAIwpE,EAAWxpE;AACflf,OAAOiB,KAAKynF,GAAUxnF,QAAQ,SAASzc,GACrC8jB,GAAS9jB,EAAIikG,EAASjkG,MAExBmZ,EAAE,eAAejY,KAAK,iCAAiCgb,OAAO,gBN2HhEgoF,IAAK,CAACA,IAAK,CAACA,IAAK,CAACA,IhTxHf,WACD3qF,MACJJ,EAAE,kBACCwW,KAAK,OAAQ,MACbA,KAAK,OAAQ,MACb+f,IAAI,SAAU,agTqHjBu5D,OAAQ,CACN/E,IAAK,CACHA,IAAK,CACHA,IAAK,CAACA,IAAK5K,IACXjmC,EAAK,CAAC6wC,IAAK5K,IACXhmC,EAAK,CAAC4wC,IAAKh8D,OAIjBghE,MAAO,CACLhF,IAAK,CAACA,IAAK,CAACA,IAAK,CAACA,IAAKnnB,MACvBosB,aAAc,CAACjF,IAAK,CAACA,IAAK,CAACA,IAAKnnB,MAChCqsB,eAAgB,CAAClF,IAAK,CAACA,IAAK,CAACA,IAAKnnB,OAEpChJ,MAAO,CAACmwB,IAAK,CAACA,IAAK,CAACA,IAAK,CAACA,IO1Kb,WACb,IAAIvxB,EAAahvD,GAAI8B,SAAS,GAC1BqQ,EAAS68C,EAAW58C,UAAU;AAClCt1B,EAAoBq1B,EAAQ,QAE5Br1B,EADAq1B,EAAS68C,EAAW58C,UAAU,GACF,+GPsK5BszE,SAAU,CACRC,GAAI,CAACpF,IAAK,CAACA,IAAK,CAACA,IAAK9oB,MACtBmuB,UAAW,CAACrF,IAAK,CAACA,IAAK,CAACA,IAAK9oB,MAC7B3rC,KAAM,CAACy0D,IAAK,CAACA,IAAK,CAACA,IAAK9oB,MACxBf,WAAY,CAAC6pB,IAAK,CAACA,IAAK,CAACA,IAAK9oB,MAC9BouB,SAAU,CAACtF,IAAK,CAACA,IAAK,CAACA,IAAK9oB,MAC5BquB,YAAa,CAACvF,IAAK,CAACA,IAAK,CAACA,IAAK9oB,MAC/Bp4B,MAAO,CAACkhD,IAAK,CAACA,IAAK,CAACA,IAAK9oB,MACzBsuB,YAAa,CAACxF,IAAK,CAACA,IAAK,CAACA,IAAK9oB,MAC/BuuB,QAAS,CAACzF,IAAK,CAACA,IAAK,CAACA,IAAK9oB,MAC3BwuB,YAAa,CAAC1F,IAAK,CAACA,IAAK,CAACA,IQtLf,WAEb,IADA,IAAI2F,EAAWlmF,GAAIqF,qBAAqB,SAAS,GACxCjjB,EAAI,EAAGA,EAAI8jG,EAASl3E,KAAK3sB,OAAQD,GAAK,EAAG,CAChD,IAAImhF,EAAQ2iB,EAASl3E,KAAK5sB,GAAG6sB,MAAM;AACnCs0D,EAAM5hE,UAAY,yFAEhB4hE,EAAM1lF,YAAc,KAAO0lF,EAAM1lF,YAAc,aRkLnD01F,UAAW,CAAC4S,WAAY,CAAC5F,IAAK,CAACA,IAAK,CAACA,IAAKhN,OAC1C6S,QAAS,CAAC7F,IAAK,CAACA,IAAK,CAACA,IAAK,CAACA,InI/Hf,WACb,IAAI3qF,MAEiB,IADTJ,EAAE,UACJnT,OAAV,CACAmT,EAAE,QAAQ6wF,UAAU,+BASpB7wF,EAAE,QAAQ4sB,QAAQ;AAIlB,IAAItO,EAAW;AACfte,EAAE,2CAA2CC,KAAK,SAASrT,EAAGnG,GAC5D,IAAIqqG,EAAUlwF,GAAO7C,KAAKiC,EAAEvZ,GAAG+vB,KAAK;AACpC,GAAKs6E,EAAL,CACA,IAAInvE,EAASmvE,EAAQ,GACjBz1E,EAAQy1E,EAAQ,GAChB93E,EAAShZ,EAAEvZ,GAAG+vB,KAAK,eACnBq0C,EAAM7qD,EAAEvZ,GAAG+vB,KAAK;AACpB,GAAK8H,EAASqD,GASZrD,EAASqD,GAAQugC,OAAO10D,KAAK6tB;IATR,CACrB,IAAI6mC,EAAS;AACbA,EAAO10D,KAAK6tB,GACZiD,EAASqD,GAAU,CACjBugC,OAAQA,EACRlpC,OAAQA,EACR6xC,IAAKA;AAMX,IAAIkmC,EAAiB/wF,EAAE;AACvBoC,OAAOiB,KAAKib,GAAUhb,QAAQ,SAASzc,GACrC,IAAImqG,EAAQ1yE,EAASz3B;AACrBkqG,EAAe57E,OAAO,yIAGUtuB,EAAK,aAAemqG,EAAM9uC,OAAOhkC,OAC/D,cAAgB8yE,EAAM9uC,OAAOr1D,OAAS,6BACnBmkG,EAAMnmC,IACzB,iDACAmmC,EAAMh4E,OAAS,gBACjBpyB,EAAe,wBAA0BC,GACtCiJ,iBAAiB,QAASmyD,IAAgB,KAE/Cr7D,EAAe,mBACZkJ,iBAAiB,QAASqyD,IAAiB,SmI4E9C8uC,WAAY,CAAClG,IAAK,CAACA,IAAK,CAACA,IAAK,CAACA,IhT7K1B,WACD3qF,OACJmO,KACuBvO,EAAE,8BACR/Y,SAASkuB,OAAO,6FAE/BvK,GAAgB,qBAChBC,GAAgB,qKAGMC,GAAgB,qBACtCC,GAAgB,4EAGlB/K,EAAE,6BAA6B0O,KAAK,wBACjCzO,KAAK,SAASrT,EAAGnG,GAChB,IAAII,EAAK,qBAAqBkX,KAAKiC,EAAEvZ,GAAG+vB,KAAK;AAC7CxW,EAAEvZ,GAAGyZ,MAAM,yCACT0N,GAAc/mB,EAAG,IAAM,oBgT4J7BqqG,OAAQ,CACNnG,IAAK,CAACA,IAAK,CAACA,IAAK,CAACA,IAAKnsD,MACvBgvD,KAAM,CAAC7C,IAAK,CAACA,IAAK,CAACA,IS5LR,WACRptF,EAAS,wBACd2N,MAAMC,UAAUjI,QAAQkI,KAAKzkB,SAASgb,iBAAiB,oBACrD,SAAStb,GAAIA,EAAEkK,MAAMoe,QAAU,UACjCnoB,EAAe,qBAAqB+J,MAAMoe,QAAU,aT0LpD4I,MAAO,CAACozE,IAAK,CAACA,IAAK,CAACA,IAAK,CAACA,IAAKnsD,OAC/B2nC,UAAW,CAACwkB,IAAK,CAACA,IAAK,CAACA,IAAK,CAACA,IAAKnsD,OACnCuyD,aAAc,CAACpG,IAAK,CAACA,IAAK,CAACA,IAAK,CAACA,IAAKnsD,OACtCwyD,OAAQ,CAACrG,IAAK,CAACA,IAAK,CAACA,IAAK,CAACA,IAAKnsD,OAChCuI,OAAQ,CAAC4jD,IAAK,CAACA,IAAK,CAACA,IAAK,CAACA,IAAKnsD,OAChCyyD,MAAO,CAACtG,IAAK,CAACA,IAAK,CAACA,IAAK,CAACA,IAAKnsD,OAC/B0yD,WAAY,CAACvG,IAAK,CAACA,IAAK,CAACA,IAAK,CAACA,I3F5IlB,WACTjmF,MACF9E,EAAE,gCAAgC4lB,MAAMwZ,S2F2I1CmyD,OAAQ,CAACxG,IAAK,CAACA,IAAK,CAACA,IAAK,CAACA,IAAKt8D,OAChC+iE,UAAW,CACTzG,IAAK,CAACA,IAAK,CAACA,IAAK,CAACA,IxT1Cf,WACDjmF,MAAmB0F,IAAMuC,SwT0C3B0kF,UAAW,CAAC1G,IAAK,CAACA,IAAK,CAACA,IpN3Gb,WACT3qF,OACJ2/B,GAAW,aACXjjC,GAA0Ba,EAAS,2BACnC/W,EAAe,4BAA4B8a,WACxC5R,iBAAiB,QAASoxC,IAAU,GACvCt6C,EAAe,mBACZkJ,iBAAiB,QAASqxC,IAC7B75C,EAAoBkjB,GAClB,sCACAyU,GAAe,2BACf,oBACFr4B,EAAe,2BACZkJ,iBAAiB,QAASwxC,SoN+F3BowD,OAAQ,CAAC3G,IAAK,CAACA,IAAK,CAACA,IxTxClB,WACLnkG,EAAe,uBACZkJ,iBAAiB,QAAS,WACzBlJ,EAAe,+BAA+BoB,MAC5CpB,EAAe,6BAA6ByB,cAElDzB,EAAe,0BACZkJ,iBAAiB,SAAU,WAC1BlJ,EAAe,+BAA+BoB,MAC5CpB,EAAe,6BAA6ByB,mBwTiClDspG,UAAW,CAAC5G,IAAK,CAACA,IAAK,CAACA,IAAK,CAACA,IpBhKjB,WAxCf,IACM6G,GAAAA,EAAe7qG,SAASy+B,cAAc,+BAExCosE,EAAa9hG,iBAAiB,QAAS,SAASrJ,GAC9CA,EAAE4J,iBACFxH,OAAOe,SAAW,2CAChB7C,SAASy+B,cAAc,uCAAuCx9B,QAsBtE,WACE,IAAI0oG,EAAW3pG,SAASy+B,cAAc,cAClC7I,EAASpX,KACTssF,EAAWl1E,EAAO+I,YAAY;AAClCmsE,EAAStlE,OAAS,GAClBslE,EAASxpG,YAAc;AACvB,IAAIypG,EAAYn1E,EAAO+I,YAAY;AACnCosE,EAAUC,MAAQ,QAClBD,EAAU3lF,UAAY6xE,KACtB/3E,GAAcyqF,EAAU/zE,GAKxBq1E,QoB+JAC,SAAU,CAAClH,IAAK,CAACA,IAAK,CAACA,IAAK,CAACA,IAAKnoD,OAClCsvD,UAAW,CAACnH,IAAK,CAACA,IAAK,CAACA,IAAK,CAACA,IAAKnoD,OACnCuvD,WAAY,CAACpH,IAAK,CAACA,IAAK,CAACA,IAAK,CAACA,IhB5HlB,WACb,IAAI3qF,KAAJ,CACA,IAAIqlB,EAAU07D;AACd17D,EAAQ8G,OAAS,IACjB9G,EAAU07D,MACFv0E,UAAY,YACpB6Y,EAAQtZ,UAAY6S,GAAmBvhB,IACvCgoB,EAAQ31B,iBAAiB,SAAUwxC,IAC/B33C,EAAK8T,iBACP49B,KAAc/xB,KAAKi4E,UgBoHrBwJ,IAAK,CACHqH,kBAAmB,CAACrH,IAAK,CAACA,IAAK,CAACA,IAAK5H,MACrCkP,YAAa,CAACtH,IAAK,CAACA,IAAK,CAACA,IAAK5H,MAC/B4H,IAAK,CAACA,IAAK,CAACA,IAAK,CAACA,IZpJP,WACT3qF,MAIJ6sC,GAAQpkC,KAAK,SAAS9M,GACpB,QAAIA,EAAG5Q,cACL4Q,EAAG3Q,UACI;AajDb,SAASknG,GAAY71D,GACnB,IAAI81D,EAAWxrG,SAASy+B,cAAciX;AACtC,OAAO81D,GAAYA,EAASvqG,OAAS,IAGvC,IAAIwqG,GAAU,CACZ,SAASppF,GAAM,OAAOyhF,GAAazhF,IACnC,SAASA,EAAKC,GAAS,OAAOwhF,GAAazhF,GAAKC,IAChD,SAASD,EAAKC,EAAQo+B,GAAU,OAAOojD,GAAazhF,GAAKC,GAAQo+B,IACjE,SAASr+B,EAAKC,EAAQo+B,EAAS18C,GAC7B,OAAO8/F,GAAazhF,GAAKC,GAAQo+B,GAAS18C;AAY9C,SAAS0nG,KACP,IAAIrpF,EACAC,EACAo+B,EACA18C,EACA2nG,EAlCA3nG;AAmC6B,KAA7BhE,SAAS6C,SAASE,QACpBsf,EAAM3b,EAASkS,GAAgB,OAAQ,KACvC0J,EAAS5b,EAASkS,GAAgB,UAAW,KAC7C8nC,EAAUh6C,EAASkS,GAAgB,WAAY,KAtC7C5U,EAAO,IACC,WAsCKqe,IArCfre,EAAO0C,EAASkS,GAAgB,QAAS,MAqCzC5U,EAnCKA,EAoCL2nG,EAAYjlG,EAASkS,GAAgB,aAAc,OAEnDyJ,EAAMkpF,GAAY,qBAEH,YADfjpF,EAASipF,GAAY,2BAGnBjpF,EADAD,EAAM,KAGRq+B,EAAU6qD,GAAY,yBAEtBI,EADA3nG,EAAO,KAGTpB,EAAKyf,IAAMA,EACXzf,EAAK0f,OAASA,EACd1f,EAAK89C,QAAUA,EACf5d,GAAezgB,EAAM,IAAMC,EAAS,IAAMo+B,EAAU,IAAM18C,EAAO,IAC/D2nG,EAEF9H,GArCF,SAA0BxhF,EAAKC,EAAQo+B,EAAS18C,EAAM2nG,GACpD,GAAIF,GAAQ18E,MAAM,SAASrvB,GACzB,OAAO0Z,GAAS1Z,EAAE2iB,EAAKC,EAAQo+B,EAAS18C,OACpC8/F,GAAazhF,GAAKC,GAAQo+B,GAAS18C,GAAM2nG,GAC7C,OAAO7H,GAAazhF,GAAKC,GAAQo+B,GAAS18C,GAAM2nG,GAiCnCC,CAAiBvpF,EAAKC,EAAQo+B,EAAS18C,EAAM2nG,GAc9D,SAASE,KAIHhlG,EAAWg9F,MACb5gG,EAAW6/B,IACX9gC,EAAM,UAAW8gC,IACjB+gE,KACAzhG,EAAI,UAAW0gC,KAInBhhC,OAAOY,IAAMZ,OAAOY,KAAO,GAC3BZ,OAAOY,IAAIE,KAAO,KAGlBd,OAAOY,IAAIopG,SAAW,WAEpBxpG,IACAN,EAAM,UAAW,gBAEjB0pG,KACAh0D,KACAzvC,EAAI,EAAG4jG,IAEHxyF,OnVlGAzC,EAAS,wBACX3O,EAAI,EAAG8Q,IHwCJnW,EAAKqN,aACRhI,EAAI,EAAGoQ,IsVgETjW,EAAI,UAAW","sourceRoot":"sourceMap","sourcesContent":["export default function isType(e, t) {return typeof e === t;}\r\n","import isType from './isType';\r\n\r\nexport default function isUndefined(e) {return isType(e, 'undefined');}\r\n","export function getElementById(id, doc) {\r\n  if (doc) {return doc.getElementById(id);}\r\n  return document.getElementById(id);\r\n}\r\n","export default function insertHtml(parent, where, html) {\r\n  if (parent instanceof Element) {\r\n    parent.insertAdjacentHTML(where, html);\r\n  }\r\n}\r\n","import insertHtml from './insertHtml';\r\n\r\nexport default function insertHtmlBeforeEnd(parent, html) {\r\n  insertHtml(parent, 'beforeend', html);\r\n}\r\n","import {getElementById} from '../common/getElement';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\n\r\nvar timers = {};\r\nvar footWrap = getElementById('foot-wrap');\r\n\r\nexport function log(text, value) {\r\n  if (footWrap) {\r\n    insertHtmlBeforeEnd(footWrap,\r\n      '<br>' + text + ': ' + value + ' (' + typeof value + ')');\r\n  }\r\n}\r\n\r\nexport function time(name) {\r\n  if (name) {timers[name] = performance.now() * 1000;}\r\n}\r\n\r\nexport function timeEnd(name) {\r\n  if (timers[name]) {\r\n    log(name, Math.round(performance.now() * 1000 -\r\n      timers[name]) / 1000 + 'ms');\r\n    delete timers[name];\r\n  }\r\n}\r\n","import {getElementById} from '../common/getElement';\r\n\r\nvar thePlayerId;\r\n\r\nexport default function playerId() {\r\n  if (!thePlayerId) {\r\n    thePlayerId = Number(\r\n      getElementById('holdtext')\r\n        .textContent.match(/fallensword.com\\/\\?ref=(\\d+)/)[1]\r\n    );\r\n  }\r\n  return thePlayerId;\r\n}\r\n","import isUndefined from '../common/isUndefined';\r\nimport {log} from './debug';\r\nimport playerId from '../common/playerId';\r\n\r\nvar times = {};\r\nvar refAry = ['www.lazywebtools.co.uk', 'refreshthing.com'];\r\n\r\nfunction isAuto() {\r\n  var docRef = document.referrer\r\n    .match(/^https?:\\/\\/([^/?#]+)(?:[/?#]|$)/i);\r\n  if (docRef) {docRef = docRef[1];}\r\n  return refAry.includes(docRef);\r\n}\r\n\r\nfunction noGa() {\r\n  return isAuto() || isUndefined(window.ga);\r\n}\r\n\r\nexport function start(category, variable, label) {\r\n  if (noGa()) {return;}\r\n  times[category + ':' + variable + ':' + label] =\r\n    performance.now() * 1000;\r\n}\r\n\r\nfunction sendTiming(category, variable, label) {\r\n  var myTime = Math.round(performance.now() * 1000 -\r\n    times[category + ':' + variable + ':' + label]) / 1000;\r\n  if (myTime > 10) {\r\n    ga('fshApp.send', 'timing', category, variable, Math.round(myTime),\r\n      label);\r\n  }\r\n  //#if _BETA  //  Timing output\r\n  log(variable, myTime + 'ms');\r\n  //#endif\r\n}\r\n\r\nexport function end(category, variable, label) {\r\n  if (noGa()) {return;}\r\n  sendTiming(category, variable, label);\r\n}\r\n\r\nfunction fixupUrl() {\r\n  var origPath = window.location.pathname + window.location.search;\r\n  var page = origPath.replace(/&m=.*/, '')\r\n    .replace(/&subcmd=&.*/, '')\r\n    .replace(/&subcmd2=&.*/, '')\r\n    .replace(/&[a-z_]+_id=.+/, '')\r\n    .replace(/&id=.+/, '')\r\n    .replace(/&target_player=.+/, '')\r\n    .replace(/&[a-z]+_username=.+/, '')\r\n    .replace(/\\?cmd=auctionhouse.+/, '?cmd=auctionhouse')\r\n    .replace(/&subcmd=[0-9a-f]{32}/, '')\r\n    .replace(/&search_active=.+/, '')\r\n    .replace(/&letter=.+/, '')\r\n    .replace(/&guild_name=.+/, '')\r\n    .replace(/&user=.+/, '')\r\n    .replace(/&[a-z_]*page=.+/, '')\r\n    .replace(/&prestige=.+/, '')\r\n    .replace(/&withdraw_amount=.+/, '')\r\n    .replace(/&tickets=.+/, '')\r\n    .replace(/&search=.+/, '')\r\n    .replace(/&target=.+/, '')\r\n    .replace(/&xcv=[0-9a-f]{32}/, '')\r\n    .replace(/\\?ref=[0-9]+/, '');\r\n  ga('fsh.set', 'page', page);\r\n}\r\n\r\nexport function setup() {\r\n  if (noGa()) {return;}\r\n\r\n  ga('create', 'UA-76488113-1', 'auto', 'fshApp', {\r\n    userId: playerId(),\r\n    siteSpeedSampleRate: 10\r\n  });\r\n  ga('fshApp.set', 'appName', 'fshApp');\r\n  ga('fshApp.set', 'appVersion', FSH.version + '(' + FSH.calf + ')');\r\n  ga('create', 'UA-76488113-2', 'auto', 'fsh', {\r\n    userId: playerId(),\r\n    siteSpeedSampleRate: 10\r\n  });\r\n  fixupUrl();\r\n  ga('fsh.send', 'pageview');\r\n}\r\n\r\nexport function screenview(funcName) {\r\n  if (noGa()) {return;}\r\n  ga('fshApp.send', 'screenview', {screenName: funcName});\r\n}\r\n\r\nexport function sendEvent(eventCategory, eventAction, eventLabel) {\r\n  if (noGa()) {return;}\r\n  ga('fshApp.send', 'event', eventCategory, eventAction, eventLabel);\r\n}\r\n\r\nexport function sendException(desc, fatal) {\r\n  //#if _BETA  //  sendException\r\n  console.log('sendException', desc); // eslint-disable-line no-console\r\n  //#endif\r\n  if (noGa()) {return;}\r\n  ga('fshApp.send', 'exception', {\r\n    exDescription: desc,\r\n    exFatal: fatal\r\n  });\r\n}\r\n\r\n// TODO needs CORS\r\n\r\n// window.addEventListener('error', function(e) {\r\n//   // console.log('e.message', e.message);\r\n//   // console.log('e.filename', e.filename);\r\n//   // console.log('e.lineno', e.lineno);\r\n//   // console.log('e.colno', e.colno);\r\n//   console.log('error event', e);\r\n//   if (e.error) {\r\n//     console.log('error event message', e.error.message);\r\n//     console.log('error event stack', e.error.stack);\r\n//   }\r\n//   // sendException(e.error.stack, true);\r\n// });\r\n\r\n// var oldError = window.onerror;\r\n// window.onerror = function(message, source, lineno, colno, error) {\r\n//   console.log('onerror message', message);\r\n//   console.log('onerror source', source);\r\n//   console.log('onerror lineno', lineno);\r\n//   console.log('onerror colno', colno);\r\n//   console.log('onerror error', error);\r\n//   console.log('onerror error.message', error.message);\r\n//   console.log('onerror error.stack', error.stack);\r\n// };\r\n","import isUndefined from '../common/isUndefined';\r\nimport {sendException} from './fshGa';\r\n\r\n// GM_ApiBrowserCheck\r\n// @author        GIJoe\r\n// @license       http://creativecommons.org/licenses/by-nc-sa/3.0/\r\n// Global variables\r\nvar gvar = {};\r\nvar GMSTORAGE_PATH = 'GM_';\r\n\r\nfunction storItem(name, type, value) {\r\n  window.localStorage.setItem(GMSTORAGE_PATH + name, type + value);\r\n}\r\n\r\nvar reviver = [\r\n  {\r\n    condition: 'S]',\r\n    result: function(value) {return value.substr(2);}\r\n  },\r\n  {\r\n    condition: 'N]',\r\n    result: function(value) {return parseInt(value.substr(2), 10);}\r\n  },\r\n  {\r\n    condition: 'B]',\r\n    result: function(value) {return value.substr(2) === 'true';}\r\n  }\r\n];\r\nvar cold = [\r\n  {\r\n    condition: 'string',\r\n    result: function(name, value) {storItem(name, 'S]', value);}\r\n  },\r\n  {\r\n    condition: 'number',\r\n    result: function(name, value) {\r\n      if (value.toString().indexOf('.') < 0) {storItem(name, 'N]', value);}\r\n    }\r\n  },\r\n  {\r\n    condition: 'boolean',\r\n    result: function(name, value) {storItem(name, 'B]', value);}\r\n  }\r\n];\r\n\r\nfunction retrieve(value) {\r\n  for (var i = 0; i < reviver.length; i += 1) {\r\n    var test = reviver[i];\r\n    if (value.substr(0, 2) === test.condition) {return test.result(value);}\r\n  }\r\n  return value;\r\n}\r\n\r\n// You can change it to avoid conflict with others scripts\r\nvar needApiUpgrade = false;\r\nif (window.navigator.appName.match(/^opera/i) &&\r\n    typeof window.opera !== 'undefined') {\r\n  needApiUpgrade = true;\r\n  gvar.isOpera = true;\r\n  window.GM_log = window.opera.postError;\r\n}\r\nif (typeof GM_setValue !== 'undefined') {\r\n  var gsv;\r\n  try {\r\n    gsv = window.GM_setValue.toString();\r\n  } catch (e) {\r\n    gsv = 'staticArgs';\r\n  }\r\n  if (gsv.indexOf('staticArgs') > 0) {\r\n    gvar.isGreaseMonkey = true;\r\n  // test GM_hitch\r\n  } else if (gsv.match(/not\\s+supported/)) {\r\n    needApiUpgrade = true;\r\n    gvar.isBuggedChrome = true;\r\n  }\r\n} else {\r\n  needApiUpgrade = true;\r\n}\r\n\r\nif (needApiUpgrade) {\r\n  var ws = null;\r\n  var uid = new Date().toString();\r\n  var result;\r\n  try {\r\n    window.localStorage.setItem(uid, uid);\r\n    result = window.localStorage.getItem(uid) === uid;\r\n    window.localStorage.removeItem(uid);\r\n    if (result) {\r\n      ws = typeof window.localStorage;\r\n    } else {\r\n      sendException('There is a problem with your local storage. ' +\r\n        'FSH cannot persist your settings.', false);\r\n      ws = null;\r\n    }\r\n  } catch (e) {\r\n    ws = null;\r\n  }\r\n  // Catch Security error\r\n  if (ws === 'object') {\r\n    window.GM_getValue = function(name, defValue) {\r\n      var value = window.localStorage.getItem(GMSTORAGE_PATH + name);\r\n      if (value === null || isUndefined(value)) {return defValue;}\r\n      return retrieve(value);\r\n    };\r\n    window.GM_setValue = function(name, value) {\r\n      for (var i = 0; i < cold.length; i += 1) {\r\n        var storType = cold[i];\r\n        if (typeof value === storType.condition) {\r\n          storType.result(name, value);\r\n        }\r\n      }\r\n    };\r\n  } else if (!gvar.isOpera || isUndefined(window.GM_setValue)) {\r\n    gvar.temporarilyStorage = [];\r\n    window.GM_getValue = function(name, defValue) {\r\n      if (typeof gvar.temporarilyStorage[GMSTORAGE_PATH + name] ===\r\n        'undefined') {return defValue;}\r\n      return gvar.temporarilyStorage[GMSTORAGE_PATH + name];\r\n    };\r\n    window.GM_setValue = function(name, value) {\r\n      if (['string', 'boolean', 'number'].indexOf(typeof value) !== -1) {\r\n        gvar.temporarilyStorage[GMSTORAGE_PATH + name] = value;\r\n      }\r\n    };\r\n  }\r\n\r\n  window.GM_listValues = function() {\r\n    var list = [];\r\n    var reKey = new RegExp('^' + GMSTORAGE_PATH);\r\n    for (var i = 0, il = window.localStorage.length; i < il; i += 1) {\r\n      var key = window.localStorage.key(i);\r\n      if (key.match(reKey)) {\r\n        list.push(key.replace(GMSTORAGE_PATH, ''));\r\n      }\r\n    }\r\n    return list;\r\n  };\r\n}\r\n","export default function fallback(a, b) {\r\n  return a || b;\r\n}\r\n","import isType from './isType';\r\n\r\nexport default function isFunction(e) {return isType(e, 'function');}\r\n","/*\r\nBased on\r\nfiddle.jshell.net/GRIFFnDOOR/r7tvg/\r\n*/\r\n\r\nvar heap = [null];\r\n\r\nfunction cmp(i, j) {\r\n  return heap[i] && heap[i].priority < heap[j].priority;\r\n}\r\n\r\nfunction swp(i, j) {\r\n  var temp = heap[i];\r\n  heap[i] = heap[j];\r\n  heap[j] = temp;\r\n}\r\n\r\nfunction calcChildIndex(leftHigher, i) {\r\n  if (leftHigher) {return i * 2;}\r\n  return i * 2 + 1;\r\n}\r\n\r\nfunction sink(j) {\r\n  var i = j;\r\n  while (i * 2 < heap.length) {\r\n    var leftHigher = !cmp(i * 2 + 1, i * 2);\r\n    var childIndex = calcChildIndex(leftHigher, i);\r\n    if (cmp(i, childIndex)) {break;}\r\n    swp(i, childIndex);\r\n    i = childIndex;\r\n  }\r\n}\r\n\r\nfunction bubble(j) {\r\n  var i = j;\r\n  while (i > 1) {\r\n    // eslint-disable-next-line no-bitwise\r\n    var parentIndex = i >> 1;\r\n    if (!cmp(i, parentIndex)) {break;}\r\n    swp(i, parentIndex);\r\n    i = parentIndex;\r\n  }\r\n}\r\n\r\nexport function pop() {\r\n  if (heap.length === 1) {return;}\r\n  var topVal = heap[1].data;\r\n  var last = heap.pop();\r\n  if (heap.length > 1) {\r\n    heap[1] = last;\r\n    sink(1);\r\n  }\r\n  return topVal;\r\n}\r\n\r\nexport function push(data, priority) {\r\n  bubble(heap.push({data: data, priority: priority}) - 1);\r\n}\r\n\r\nexport function getLength() {\r\n  return heap.length - 1;\r\n}\r\n","import fallback from '../system/fallback';\r\nimport isFunction from '../common/isFunction';\r\nimport isUndefined from '../common/isUndefined';\r\nimport {sendException} from './fshGa';\r\nimport {getLength, pop, push} from './sch';\r\n\r\nvar paused = true;\r\nvar message = 'fshMessage';\r\n\r\nfunction taskRunner() {\r\n  if (getLength() === 0) {\r\n    paused = true;\r\n  } else {\r\n    paused = false;\r\n    window.postMessage(message, '*');\r\n  }\r\n}\r\n\r\nfunction devLog(args) {\r\n  if (args && !Array.isArray(args)) {\r\n    // eslint-disable-next-line no-console\r\n    console.log('addTask Array.isArray(args)', Array.isArray(args));\r\n  }\r\n}\r\n\r\nexport default function add(priority, fn, args, scope) {\r\n  //#if _DEV  //  Not sending args as Array\r\n  devLog(args);\r\n  //#endif\r\n  if (isFunction(fn)) {\r\n    var _scope = fallback(scope, window);\r\n    var _args = fallback(args, []);\r\n    push(fn.bind.apply(fn, [_scope].concat(_args)), priority);\r\n    if (paused) {taskRunner();}\r\n  }\r\n}\r\n\r\nfunction parseStack(e) {\r\n  var concatStack = e.stack.replace(/\\n +/g, '|');\r\n  if (e.stack.includes(e.message)) {\r\n    return concatStack;\r\n  }\r\n  return e.message + '|' + concatStack;\r\n}\r\n\r\nfunction parseError(e) {\r\n  if (e.stack) {return parseStack(e);}\r\n  return e.message;\r\n}\r\n\r\nfunction popError(fn) {\r\n  if (!isUndefined(fn)) {\r\n    sendException('pop() was not a function (' + typeof fn + ')', false);\r\n  }\r\n}\r\n\r\nfunction testPop() {\r\n  var testFn = pop();\r\n  if (isFunction(testFn)) {\r\n    testFn();\r\n  } else {popError(testFn);}\r\n}\r\n\r\nfunction asyncTask() {\r\n  try {\r\n    testPop();\r\n  } catch (e) {\r\n    sendException(parseError(e), false);\r\n  } finally {\r\n    taskRunner();\r\n  }\r\n}\r\n\r\nfunction callback(event) {\r\n  var key = event.data;\r\n  if (typeof key === 'string' && key.indexOf(message) === 0) {\r\n    asyncTask();\r\n  }\r\n}\r\n\r\nwindow.addEventListener('message', callback);\r\n\r\nwindow.addEventListener('error', function(e) {\r\n  if (e.error) {\r\n    var msg = parseError(e.error);\r\n    if (msg.includes('calfSystem')) {\r\n      sendException(msg, true);\r\n    }\r\n  }\r\n});\r\n","export default {};\r\n","var dragTarget;\r\n\r\nfunction dragOver(event) {\r\n  event.preventDefault();\r\n  return false;\r\n}\r\n\r\nfunction dragDrop(event) {\r\n  var offset = event.dataTransfer.getData('text/plain').split(',');\r\n  dragTarget.style.left =\r\n    event.clientX + parseInt(offset[0], 10) + 'px';\r\n  dragTarget.style.top =\r\n    event.clientY + parseInt(offset[1], 10) + 'px';\r\n  document.body.removeEventListener('dragover', dragOver, false);\r\n  document.body.removeEventListener('drop', dragDrop, false);\r\n  event.preventDefault();\r\n  return false;\r\n}\r\n\r\nfunction dragStart(parent, event) {\r\n  if (parent) {\r\n    dragTarget = parent;\r\n  } else {\r\n    dragTarget = event.target;\r\n  }\r\n  var style = window.getComputedStyle(dragTarget, null);\r\n  event.dataTransfer.setData('text/plain',\r\n    parseInt(style.getPropertyValue('left'), 10) - event.clientX + ',' +\r\n    (parseInt(style.getPropertyValue('top'), 10) - event.clientY));\r\n  document.body.addEventListener('dragover', dragOver, false);\r\n  document.body.addEventListener('drop', dragDrop, false);\r\n}\r\n\r\nexport default function draggable(element, parent) {\r\n  element.draggable = true;\r\n  element.addEventListener('dragstart', dragStart.bind(null, parent));\r\n}\r\n","export default function escapeHtml(unsafe) {\r\n  return unsafe\r\n    .replace(/&/g, '&amp;')\r\n    .replace(/</g, '&lt;')\r\n    .replace(/>/g, '&gt;')\r\n    .replace(/\"/g, '&quot;')\r\n    .replace(/'/g, '&#039;');\r\n}\r\n","var thePlants = [\r\n  'Amber',\r\n  'Blood Bloom',\r\n  'Jademare',\r\n  'Dark Shade',\r\n  'Trinettle',\r\n  'Heffle Wart'\r\n];\r\nvar thePotions = [\r\n  ['Sludge Brew', 'DC 200'],\r\n  ['Potion of Black Death', 'DC 225'],\r\n  ['Potion of Aid', 'Assist'],\r\n  ['Potion of Supreme Doubling', 'DB 450'],\r\n  ['Potion of Acceleration', 'DB 500'],\r\n  ['Potion of Lesser Death Dealer', 'DD'],\r\n  ['Runic Potion', 'FI 250'],\r\n  ['Potion of the Bookworm', 'Lib 225'],\r\n  ['Potion of Truth', 'EW 1k'],\r\n  ['Dull Edge', 'DE 25'],\r\n  ['Notched Blade', 'DE 80'],\r\n  ['Potion of Death', 'DW 125'],\r\n  ['Potion of Decay', 'WI 150'],\r\n  ['Potion of Fatality', 'WI 350'],\r\n  ['Potion of Annihilation', 'DW 150'],\r\n  ['Potion of the Wise', 'Lib 200'],\r\n  ['Potion of Shattering', 'SA'],\r\n  ['Dragons Blood Potion', 'ZK 200'],\r\n  ['Berserkers Potion', 'ZK 300'],\r\n  ['Potion of Fury', 'ZK 350'],\r\n  ['Potion of Supreme Luck', 'FI 1k']\r\n];\r\n\r\nfunction plants() {\r\n  return thePlants.map(function(el) {\r\n    return {category: 'Plants', searchname: el, nickname: ''};\r\n  });\r\n}\r\n\r\nfunction potions() {\r\n  return thePotions.map(function(el) {\r\n    return {\r\n      category: 'Potions',\r\n      searchname: el[0],\r\n      nickname: el[1],\r\n      displayOnAH: true\r\n    };\r\n  });\r\n}\r\n\r\nexport function def_quickSearch() {\r\n  return JSON.stringify(plants().concat(potions()));\r\n}\r\n","import {def_quickSearch} from './defaultQuickSearchList';\r\n\r\n/* eslint-disable max-lines */\r\nexport var defaults = {\r\n  lastActiveQuestPage: '',\r\n  lastNormalActiveQuestPage: '',\r\n  lastNormalCompletedQuestPage: '',\r\n  lastNormalNotStartedQuestPage: '',\r\n  lastSeasonalActiveQuestPage: '',\r\n  lastSeasonalCompletedQuestPage: '',\r\n  lastSeasonalNotStartedQuestPage: '',\r\n\r\n  enableLogColoring: false,\r\n  enableChatParsing: false,\r\n  enableCreatureColoring: false,\r\n  showCombatLog: false,\r\n  showCreatureInfo: false,\r\n  keepLogs: false,\r\n\r\n  showExtraLinks: false,\r\n  huntingBuffs: 'Doubler,Librarian,Adept Learner,Merchant,' +\r\n    'Treasure Hunter,Animal Magnetism,Conserve',\r\n  huntingBuffsName: 'default',\r\n  huntingBuffs2: 'Deflect',\r\n  huntingBuffs2Name: 'PvP',\r\n  huntingBuffs3: 'Super Elite Slayer',\r\n  huntingBuffs3Name: 'SE',\r\n  showHuntingBuffs: false,\r\n  moveFSBox: false,\r\n  moveDailyQuest: false,\r\n\r\n  guildSelf: '',\r\n  guildSelfMessage: 'Member of your own guild!',\r\n  guildFrnd: '',\r\n  guildFrndMessage: 'Do not attack - Guild is friendly!',\r\n  guildPast: '',\r\n  guildPastMessage: 'Do not attack - You\\'ve been in that guild once!',\r\n  guildEnmy: '',\r\n  guildEnmyMessage: 'Enemy guild. Attack at will!',\r\n  goldRecipient: '',\r\n  goldAmount: '',\r\n  sendGoldonWorld: false,\r\n\r\n  hideQuests: false,\r\n  hideQuestNames: '',\r\n  hideRecipes: false,\r\n  hideRecipeNames: '',\r\n  enableGuildInfoWidgets: false,\r\n  enableOnlineAlliesWidgets: false,\r\n  guildOnlineRefreshTime: 300,\r\n  hideGuildInfoSecureTrade: false,\r\n  hideGuildInfoTrade: false,\r\n  hideGuildInfoMessage: false,\r\n  hideGuildInfoBuff: false,\r\n\r\n  buyBuffsGreeting: 'Hello {playername}, can I buy {buffs} for {cost} please?',\r\n  renderSelfBio: false,\r\n  bioEditLines: 10,\r\n  renderOtherBios: false,\r\n  playNewMessageSound: false,\r\n  showSpeakerOnWorld: false,\r\n  defaultMessageSound: 'https://fallenswordhelper.github.io/fallenswordhelper/audio/sms-alert-2-daniel_simon.wav',\r\n  highlightPlayersNearMyLvl: false,\r\n  highlightGvGPlayersNearMyLvl: false,\r\n  detailedConflictInfo: false,\r\n  gameHelpLink: true,\r\n  navigateToLogAfterMsg: false,\r\n\r\n  enableAllyOnlineList: false,\r\n  enableEnemyOnlineList: false,\r\n  allyEnemyOnlineRefreshTime: 300,\r\n  moveGuildList: false,\r\n  moveOnlineAlliesList: false,\r\n\r\n  hideMatchesForCompletedMoves: false,\r\n  doNotKillList: '',\r\n  enableBioCompressor: false,\r\n  maxCompressedCharacters: 250,\r\n  maxCompressedLines: 10,\r\n\r\n  currentGoldSentTotal: 0,\r\n  keepBuffLog: false,\r\n  buffLog: '',\r\n\r\n  enableActiveBountyList: false,\r\n  bountyListRefreshTime: 300,\r\n  enableWantedList: false,\r\n  wantedNames: '',\r\n  wantedGuildMembers: false,\r\n  bwNeedsRefresh: true,\r\n\r\n  fsboxlog: false,\r\n  fsboxcontent: '',\r\n  itemRecipient: '',\r\n  quickLinks: '[]',\r\n  enableAttackHelper: false,\r\n  minGroupLevel: 1,\r\n  combatEvaluatorBias: 0,\r\n  huntingMode: false,\r\n  enabledHuntingMode: '1',\r\n  hideRelicOffline: false,\r\n\r\n  enterForSendMessage: false,\r\n  trackKillStreak: false,\r\n  storeLastQuestPage: false,\r\n  addAttackLinkToLog: false,\r\n  showStatBonusTotal: false,\r\n\r\n  newGuildLogHistoryPages: 3,\r\n  useNewGuildLog: false,\r\n  enhanceChatTextEntry: false,\r\n\r\n  ajaxifyRankControls: false,\r\n\r\n  enableMaxGroupSizeToJoin: false,\r\n  maxGroupSizeToJoin: 11,\r\n\r\n  enableTempleAlert: false,\r\n  enableUpgradeAlert: false,\r\n  enableComposingAlert: false,\r\n  autoFillMinBidPrice: false,\r\n  showPvPSummaryInLog: false,\r\n  enableQuickDrink: false,\r\n  enhanceOnlineDots: false,\r\n  hideBuffSelected: false,\r\n  hideHelperMenu: false,\r\n  keepHelperMenuOnScreen: true,\r\n  draggableHelperMenu: false,\r\n  quickLinksTopPx: 22,\r\n  quickLinksLeftPx: 0,\r\n  draggableQuickLinks: false,\r\n  showNextQuestSteps: true,\r\n\r\n  showRecallMessages: true,\r\n  showRelicMessages: true,\r\n  showMercenaryMessages: true,\r\n  showGroupCombatMessages: true,\r\n  showDonationMessages: true,\r\n  showRankingMessages: true,\r\n  showGvGMessages: true,\r\n  showTaggingMessages: true,\r\n  showTitanMessages: true,\r\n\r\n  showQuickDropLinks: false,\r\n\r\n  onlinePlayerMinLvl: 1,\r\n  onlinePlayerMaxLvl: 9999,\r\n  arenaMinLvl: 1,\r\n  arenaMaxLvl: 9999,\r\n  showMonsterLog: false,\r\n  lastTempleCheck: 0,\r\n  needToPray: false,\r\n  lastChatCheck: '0',\r\n  lastGuildLogCheck: '0',\r\n  lastOutBoxCheck: '0',\r\n  lastPlayerLogCheck: '0',\r\n  showAdmin: false,\r\n  alliestotal: 0,\r\n  enemiestotal: 0,\r\n  footprints: false,\r\n  hideNonPlayerGuildLogMessages: false,\r\n  listOfAllies: '',\r\n  listOfEnemies: '',\r\n  contactList: '',\r\n  lastUpgradeCheck: 0,\r\n  needToDoUpgrade: false,\r\n  characterVirtualLevel: 0,\r\n  guildLogoControl: false,\r\n  statisticsControl: false,\r\n  guildStructureControl: false,\r\n  lastMembrListCheck: 0,\r\n  disableItemColoring: true,\r\n  showQuickSendLinks: false,\r\n  needToCompose: false,\r\n  lastComposeCheck: 0,\r\n  lastOnlineCheck: 0,\r\n  bountyList: '',\r\n  wantedList: '',\r\n  lowestLevelInTop250: 0,\r\n\r\n  quickMsg: '[\"Thank you very much ^_^\",\"Happy hunting, {playername}\"]',\r\n\r\n  sendClasses: '[\"Composed Pots\", \"13699\"], [\"Amber\", \"5611\"], ' +\r\n    '[\"Amethyst Weed\", \"9145\"], [\"Blood Bloom\", \"5563\"], ' +\r\n    '[\"Cerulean Rose\", \"9156\"], [\"Coleoptera Body\", \"9287\"], ' +\r\n    '[\"Dark Shade\", \"5564\"], [\"Deathbloom\", \"9140\"], ' +\r\n    '[\"Deathly Mold\", \"9153\"], [\"Greenskin\\u00A0Fungus\", \"9148\"], ' +\r\n    '[\"Heffle\", \"5565\"], [\"Jademare\", \"5566\"], ' +\r\n    '[\"Ruby Thistle\", \"9143\"], [\"Toad Corpse\",\"9288\"], ' +\r\n    '[\"Trinettle\", \"5567\"], [\"Viridian\\u00A0Vine\", \"9151\"], ' +\r\n    '[\"Mortar & Pestle\", \"9157\"], [\"Beetle Juice\", \"9158\"]',\r\n\r\n  quickSearchList: def_quickSearch(),\r\n\r\n  arenaMoves: '[]',\r\n  arenaMatches: '[]',\r\n  CombatLog: '',\r\n  hideChampionsGroup: false,\r\n  hideElitesGroup: false,\r\n  hideSEGroup: false,\r\n  hideTitanGroup: false,\r\n  hideLegendaryGroup: false,\r\n  disableDeactivatePrompts: false,\r\n  moveComposingButtons: false,\r\n  expandMenuOnKeyPress: false,\r\n  disableBreakdownPrompts: false,\r\n  collapseNewsArchive: false,\r\n  collapseHallPosts: false,\r\n  lastmyGuildLogCheck: 0,\r\n  hideSubLvlCreature: false,\r\n  hidePlayerActions: false,\r\n  extraProfile: '',\r\n  textToSearchFor: '',\r\n  lastLadderReset: 0,\r\n  disableQuickWearPrompts: false,\r\n  enableGuildActivityTracker: false,\r\n  enableSeTracker: false,\r\n  showTitanInfo: false\r\n};\r\n","import {defaults} from '../support/dataObj';\r\nimport isUndefined from '../common/isUndefined';\r\n\r\nexport default function getValue(name) {\r\n  //#if _DEV  //  No default setting available\r\n  if (isUndefined(defaults[name])) {\r\n    // eslint-disable-next-line no-console\r\n    console.log(name, defaults[name]);\r\n  }\r\n  //#endif\r\n  return GM_getValue(name, defaults[name]);\r\n}\r\n","\r\nexport default function jsonParse(str, reviver) {\r\n  try {\r\n    return JSON.parse(str, reviver);\r\n  } catch (e) {\r\n    // Ignore bad json\r\n  }\r\n}\r\n","import getValue from './getValue';\r\nimport jsonParse from '../common/jsonParse';\r\n\r\nfunction reviver(key, value) {\r\n  if (typeof value === 'string') {\r\n    var a =\r\n      /^(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2}(?:\\.\\d*)?)Z$/\r\n        .exec(value);\r\n    if (a) {\r\n      return new Date(Date.UTC(Number(a[1]), Number(a[2]) - 1, Number(a[3]),\r\n        Number(a[4]), Number(a[5]), Number(a[6])));\r\n    }\r\n  }\r\n  return value;\r\n}\r\n\r\nexport default function getValueJSON(name) {\r\n  var resultJSON = getValue(name);\r\n  var result;\r\n  if (resultJSON) {result = jsonParse(resultJSON, reviver);}\r\n  return result;\r\n}\r\n","export var server = document.location.protocol + '//' +\r\n  document.location.host + '/';\r\nexport var imageServer = window.HCS && window.HCS.defines &&\r\n  window.HCS.defines.fileserver &&\r\n  window.HCS.defines.fileserver.slice(0, -1);\r\n","import add from '../support/task';\r\nimport calf from '../support/calf';\r\nimport draggable from '../common/dragStart';\r\nimport escapeHtml from '../system/escapeHtml';\r\nimport fallback from '../system/fallback';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport getValueJSON from '../system/getValueJSON';\r\nimport {imageServer} from '../system/system';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\n\r\nfunction retBool(bool, ifTrue, ifFalse) {\r\n  if (bool) {\r\n    return ifTrue;\r\n  }\r\n  return ifFalse;\r\n}\r\n\r\nfunction retOption(option, ifTrue, ifFalse) {\r\n  return retBool(getValue(option), ifTrue, ifFalse);\r\n}\r\n\r\nfunction isDraggable(draggableQuickLinks) {\r\n  if (draggableQuickLinks) {\r\n    draggable(getElementById('fshQuickLinks'));\r\n  }\r\n}\r\n\r\nfunction haveNode(node, quickLinks) { // Native ?\r\n  var quickLinksTopPx = getValue('quickLinksTopPx');\r\n  var quickLinksLeftPx = getValue('quickLinksLeftPx');\r\n  var draggableQuickLinks = getValue('draggableQuickLinks');\r\n  var draggableQuickLinksClass = retBool(draggableQuickLinks, ' fshMove', '');\r\n  var html = '<div style=\"top:' + quickLinksTopPx + 'px; left:' +\r\n    quickLinksLeftPx + 'px; background-image:url(\\'' + imageServer +\r\n    '/skin/inner_bg.jpg\\');\" id=\"fshQuickLinks\" class=\"fshQuickLinks' +\r\n    retOption('keepHelperMenuOnScreen', ' fshFixed', '') +\r\n    draggableQuickLinksClass + '\">';\r\n  for (var i = 0; i < quickLinks.length; i += 1) {\r\n    var newWindow = retBool(quickLinks[i].newWindow, ' target=\"new\"', '');\r\n    html += '<li><a href=\"' + escapeHtml(quickLinks[i].url) + '\"' +\r\n      newWindow + '>' + quickLinks[i].name + '</a></li>';\r\n  }\r\n  html += '</div>';\r\n  insertHtmlBeforeEnd(document.body, html);\r\n  isDraggable(draggableQuickLinks);\r\n}\r\n\r\nfunction injectQuickLinks() { // Native ?\r\n  var node = getElementById('statbar-container');\r\n  if (!node) {return;}\r\n  var quickLinks = fallback(getValueJSON('quickLinks'), []);\r\n  if (quickLinks.length <= 0) {return;}\r\n  haveNode(node, quickLinks);\r\n}\r\n\r\nexport default function doQuickLinks() {\r\n  if (!calf.huntingMode) {\r\n    add(3, injectQuickLinks);\r\n  }\r\n}\r\n","import isUndefined from '../common/isUndefined';\r\n\r\nfunction outputParamVal(param) {\r\n  if (isUndefined(param)) {return true;}\r\n  return param;\r\n}\r\n\r\nexport default function getCustomUrlParameter(sPageURL, sParam) {\r\n  var sURLVariables = sPageURL.split('&');\r\n  var sParameterName;\r\n  for (var i = 0; i < sURLVariables.length; i += 1) {\r\n    sParameterName = sURLVariables[i].split('=');\r\n    if (sParameterName[0] === sParam) {\r\n      return outputParamVal(sParameterName[1]);\r\n    }\r\n  }\r\n}\r\n","import getCustomUrlParameter from './getCustomUrlParameter';\r\n\r\nexport default function getUrlParameter(sParam) {\r\n  var sPageURL = decodeURIComponent(window.location.search.substring(1));\r\n  return getCustomUrlParameter(sPageURL, sParam);\r\n}\r\n","import add from '../support/task';\r\nimport getValue from '../system/getValue';\r\n\r\nfunction doMsgSound() { // jQuery\r\n  var soundLocation = getValue('defaultMessageSound');\r\n  $('a:contains(\"New log messages\"):first').each(function(i, e) {\r\n    $(e).after('<audio src=\"' + soundLocation +\r\n    '\" autoplay=true />');\r\n  });\r\n  $('a:contains(\"New Guild chat message\"):first').each(function(i, e) {\r\n    $(e).after('<audio src=\"' + soundLocation +\r\n    '\" autoplay=true />');\r\n  });\r\n}\r\n\r\nexport default function isMessageSound() {\r\n  if (getValue('playNewMessageSound')) {\r\n    add(3, doMsgSound);\r\n  }\r\n}\r\n","import isType from './isType';\r\n\r\nexport default function isObject(e) {return isType(e, 'object');}\r\n","import isFunction from './isFunction';\r\n\r\nexport default function jQueryNotPresent() {return !isFunction(window.$);}\r\n","export var rarity = [\r\n  {colour: '#ffffff', clas: 'fshCommon'},\r\n  {colour: '#0099ff', clas: 'fshRare'},\r\n  {colour: '#cc00ff', clas: 'fshUnique'},\r\n  {colour: '#ffff33', clas: 'fshLegendary'},\r\n  {colour: '#cc0033', clas: 'fshSuper'},\r\n  {colour: '#6633ff', clas: 'fshCrystal'},\r\n  {colour: '#009900', clas: 'fshEpic'}\r\n];\r\n\r\nexport var places = ['first', 'second', 'third', 'fourth', 'fifth', 'sixth',\r\n  'seventh', 'eighth', 'ninth', 'tenth', 'eleventh', 'twelfth', 'thirteenth',\r\n  'fourteenth'];\r\n\r\nexport var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug',\r\n  'Sep', 'Oct', 'Nov', 'Dec'];\r\n\r\nexport var mercRE = [\r\n  /<td>Attack:<\\/td><td>(\\d+)<\\/td>/,\r\n  /<td>Defense:<\\/td><td>(\\d+)<\\/td>/,\r\n  /<td>Armor:<\\/td><td>(\\d+)<\\/td>/,\r\n  /<td>Damage:<\\/td><td>(\\d+)<\\/td>/,\r\n  /<td>HP:<\\/td><td>(\\d+)<\\/td>/\r\n];\r\n\r\nexport var lastActivityRE =\r\n  /<td>Last Activity:<\\/td><td>(\\d+)d (\\d+)h (\\d+)m (\\d+)s<\\/td>/;\r\n\r\nexport var itemRE = /item_id=(\\d+)&inv_id=(\\d+)/;\r\nexport var defenderMultiplier = 0.2;\r\nexport var now = Date.now();\r\nexport var nowSecs = Math.floor(now / 1000);\r\nexport var newGuildLogLoc = '?cmd=notepad&blank=1&subcmd=newguildlog';\r\nexport var newGuildLogUrl = 'index.php' + newGuildLogLoc;\r\nexport var beginFolderSpanElement =\r\n  '<span class=\"fshLink fshNoWrap fshFolder fshVMid\" data-folder=\"';\r\nexport var guideUrl = 'https://guide.fallensword.com/index.php?&cmd=';\r\nexport var def_afterUpdateActionlist = 'after-update.actionlist';\r\nexport var def_playerBuffs = 'buffs.player';\r\nexport var def_suffixSuccessActionResponse = '-success.action-response';\r\n\r\nexport var def_creatureCombat = 2;\r\nexport var def_repairAll = 15;\r\n\r\nexport var def_fetch_playerStats = 1;\r\nexport var def_fetch_playerBackpackCount = 2;\r\nexport var def_fetch_playerBackpackItems = 4;\r\nexport var def_fetch_playerPrefs = 8;\r\n\r\nexport var def_fetch_playerBuffs = 16;\r\nexport var def_fetch_worldDefines = 32;\r\nexport var def_fetch_worldRealmStatic = 64;\r\nexport var def_fetch_worldRealmDynamic = 128;\r\n\r\nexport var def_fetch_worldRealmActions = 256;\r\nexport var def_fetch_playerEquipment = 512;\r\nexport var def_fetch_playerNotifications = 1024;\r\n","import getValue from '../system/getValue';\r\nimport {newGuildLogLoc, newGuildLogUrl} from '../support/constants';\r\n\r\nfunction testForGuildLogMsg(guildLogNode) {\r\n  return location.search !== newGuildLogLoc ||\r\n    guildLogNode.parentNode.id !== 'notification-guild-log';\r\n}\r\n\r\nfunction hideGuildLogMsg(guildLogNode) {\r\n  // hide the lhs box\r\n  if (testForGuildLogMsg(guildLogNode)) {return;}\r\n  var messageBox = guildLogNode.parentNode;\r\n  if (messageBox) {\r\n    messageBox.classList.add('fshHide');\r\n  }\r\n}\r\n\r\nfunction gotGuildLogNodes(guildLogNodes) {\r\n  var guildLogNode;\r\n  for (var i = 0; i < guildLogNodes.length; i += 1) {\r\n    guildLogNode = guildLogNodes[i];\r\n    guildLogNode.href = newGuildLogUrl;\r\n  }\r\n  hideGuildLogMsg(guildLogNode);\r\n}\r\n\r\nexport default function changeGuildLogHREF() {\r\n  if (!getValue('useNewGuildLog')) {return;}\r\n  var guildLogNodes = document.querySelectorAll(\r\n    '#pCL a[href=\"index.php?cmd=guild&subcmd=log\"]');\r\n  if (guildLogNodes.length > 0) {gotGuildLogNodes(guildLogNodes);}\r\n}\r\n","export default function stringifyError(err) {\r\n  return JSON.stringify(err,\r\n    Object.getOwnPropertyNames(Object.getPrototypeOf(err)), 1)\r\n    .replace(/\\n/g, '');\r\n}\r\n","// import localforage from\r\n//   '../../../node_modules/localforage/dist/localforage.nopromises';\r\nimport {sendException} from '../support/fshGa';\r\nimport stringifyError from '../common/stringifyError';\r\n\r\nfunction forageGet(forage, dfr) {\r\n  localforage.getItem(forage).then(function(data) {\r\n    // returns null if key does not exist\r\n    dfr.resolve(data);\r\n  }).catch(function(err) {\r\n    if (err.name === 'UnknownError') {\r\n      $('#dialog_msg').html('Firefox IndexedDB - UnknownError<br>' +\r\n        err.message + '<br>' +\r\n        '<a href=\"https://bugzilla.mozilla.org/show_bug.cgi?id=944918\">' +\r\n        'More Info</a>').dialog('open');\r\n    } else {\r\n      sendException(forage + ' localforage.getItem error ' +\r\n        stringifyError(err), false);\r\n    }\r\n    dfr.reject(err);\r\n  });\r\n}\r\n\r\nexport default function getForage(forage) {\r\n  // Wrap in jQuery Deferred because we're using 1.7\r\n  // rather than using ES6 promise\r\n  var dfr = $.Deferred();\r\n  if (window.localforage) {\r\n    forageGet(forage, dfr);\r\n  }\r\n  return dfr.promise();\r\n}\r\n","import isObject from './isObject';\r\n\r\nexport default function extend(obj, mixins) {\r\n  Object.keys(mixins).forEach(function(key) {\r\n    if (isObject(mixins[key]) && mixins[key] !== null) {\r\n      obj[key] = extend(mixins[key].constructor(), mixins[key]);\r\n    } else {\r\n      obj[key] = mixins[key];\r\n    }\r\n  });\r\n  return obj;\r\n}\r\n","var paused = true;\r\nvar queue = [];\r\n\r\nfunction beforeSend(xhr) {\r\n  window.addEventListener('beforeunload', function() {\r\n    xhr.abort();\r\n    queue = [];\r\n  });\r\n}\r\n\r\nfunction doAjax(options, retries, dfr) {\r\n  var opt;\r\n  if (typeof options === 'string') {\r\n    opt = {url: options};\r\n  } else {\r\n    opt = options;\r\n  }\r\n  opt.beforeSend = beforeSend;\r\n  return $.ajax(opt).pipe(dfr.resolve,\r\n    function(jqXhr, textStatus, errorThrown) {\r\n      if (retries > 0 && jqXhr.status === 503) {\r\n        setTimeout(doAjax, 100, opt, retries - 1, dfr);\r\n      } else {\r\n        dfr.reject(jqXhr, textStatus, errorThrown);\r\n      }\r\n    }\r\n  );\r\n}\r\n\r\nfunction taskRunner() {\r\n  if (queue.length === 0) {\r\n    paused = true;\r\n  } else {\r\n    paused = false;\r\n    if ($.active < 4) {\r\n      var opts = queue.shift();\r\n      doAjax.apply(null, opts);\r\n      taskRunner();\r\n    }\r\n  }\r\n}\r\n\r\nfunction add(options, retries, dfr) {\r\n  queue.push([options, retries, dfr]);\r\n  if (paused) {taskRunner();}\r\n}\r\n\r\nexport default function retryAjax(options) {\r\n  var dfr = $.Deferred();\r\n  if (options) {add(options, 10, dfr);}\r\n  return dfr.promise();\r\n}\r\n\r\nif (typeof jQuery !== 'undefined') {\r\n  $(document).ajaxComplete(function() {\r\n    taskRunner();\r\n  });\r\n}\r\n","import extend from '../common/extend';\r\nimport retryAjax from '../ajax/retryAjax';\r\n\r\nexport default function callApp(data) {\r\n  extend(data, {app: 1});\r\n  return retryAjax({\r\n    url: 'app.php',\r\n    data: data,\r\n    dataType: 'json'\r\n  });\r\n}\r\n","import isFunction from './isFunction';\r\n\r\nexport default function jQueryPresent() {return isFunction(window.$);}\r\n","import isObject from './isObject';\r\n\r\nexport function mixin(obj, mixins) {\r\n  Object.keys(mixins).forEach(function(key) {\r\n    if (isObject(mixins[key]) && mixins[key] !== null) {\r\n      mixin(obj[key], mixins[key]);\r\n    } else {\r\n      obj[key] = mixins[key];\r\n    }\r\n  });\r\n}\r\n\r\nfunction cElement(type, props) {\r\n  var el = document.createElement(type);\r\n  if (props) {mixin(el, props);}\r\n  return el;\r\n}\r\n\r\nexport function createDiv(props) {\r\n  return cElement('div', props);\r\n}\r\n\r\nexport function createSpan(props) {\r\n  return cElement('span', props);\r\n}\r\n\r\nexport function createTable(props) {\r\n  return cElement('table', props);\r\n}\r\n\r\nexport function createTBody(props) {\r\n  return cElement('tbody', props);\r\n}\r\n\r\nexport function createTr(props) {\r\n  return cElement('tr', props);\r\n}\r\n\r\nexport function createTd(props) {\r\n  return cElement('td', props);\r\n}\r\n\r\nexport function createTFoot(props) {\r\n  return cElement('tfoot', props);\r\n}\r\n\r\nexport function createUl(props) {\r\n  return cElement('ul', props);\r\n}\r\n\r\nexport function createLi(props) {\r\n  return cElement('li', props);\r\n}\r\n\r\nexport function createButton(props) {\r\n  return cElement('button', props);\r\n}\r\n\r\nexport function createBr() {\r\n  return cElement('br');\r\n}\r\n\r\nexport function createAnchor(props) {\r\n  return cElement('a', props);\r\n}\r\n\r\nexport function createInput(props) {\r\n  return cElement('input', props);\r\n}\r\n\r\nexport function createTextArea(props) {\r\n  return cElement('textarea', props);\r\n}\r\n\r\nexport function createTh(props) {\r\n  return cElement('th', props);\r\n}\r\n\r\nexport function createLabel(props) {\r\n  return cElement('label', props);\r\n}\r\n\r\nexport function textSpan(text) {\r\n  return createSpan({textContent: text});\r\n}\r\n","export default function insertElement(parent, child) {\r\n  if (parent instanceof Node && child instanceof Node) {\r\n    parent.appendChild(child);\r\n  }\r\n  return child;\r\n}\r\n","import {createDiv} from './cElement';\r\nimport {getElementById} from './getElement';\r\nimport insertElement from './insertElement';\r\n\r\nexport default function jConfirm(title, msgText, fn) { // jQuery\r\n  var fshMsg = getElementById('fshmsg');\r\n  if (!fshMsg) {\r\n    fshMsg = createDiv({id: 'fshmsg'});\r\n    insertElement(document.body, fshMsg);\r\n    $(fshMsg).dialog({\r\n      autoOpen: false,\r\n      dialogClass: 'no-close',\r\n      draggable: false,\r\n      modal: true,\r\n      resizable: false,\r\n    });\r\n  }\r\n  fshMsg.textContent = msgText;\r\n  $(fshMsg).dialog('option', {\r\n    buttons: {\r\n      Yes: function() {\r\n        fn();\r\n        $(this).dialog('close');\r\n      },\r\n      No: function() {$(this).dialog('close');}\r\n    },\r\n    title: title\r\n  }).dialog('open');\r\n}\r\n","import jConfirm from '../common/jConfirm';\r\nimport {sendException} from '../support/fshGa';\r\nimport stringifyError from '../common/stringifyError';\r\n\r\nfunction clearForage() {\r\n  localforage.clear().catch(function(err) {\r\n    sendException('localforage.clear error ' + stringifyError(err), false);\r\n  });\r\n}\r\n\r\nfunction forageSet(forage, data, dfr) {\r\n  localforage.setItem(forage, data).then(function(value) {\r\n    dfr.resolve(value);\r\n  }).catch(function(err) {\r\n    if (err.name === 'QuotaExceededError') {\r\n      jConfirm('IndexedDB Quota Exceeded Error',\r\n        'Not enough disk space. Would you like to clear IndexedDB?',\r\n        clearForage\r\n      );\r\n    } else {\r\n      sendException(forage + ' localforage.setItem error ' +\r\n        stringifyError(err), false);\r\n    }\r\n    dfr.reject(err);\r\n  });\r\n}\r\n\r\nexport default function setForage(forage, data) {\r\n  // Wrap in jQuery Deferred because we're using 1.7\r\n  // rather than using ES6 promise\r\n  var dfr = $.Deferred();\r\n  if (window.localforage) {\r\n    forageSet(forage, data, dfr);\r\n  }\r\n  return dfr.promise();\r\n}\r\n","export var act = 0;\r\nexport var cur = 1;\r\nexport var lvl = 2;\r\nexport var max = 3;\r\nexport var utc = 4;\r\nexport var vl = 5;\r\nexport var gxp = 6;\r\n","import fallback from '../system/fallback';\r\nimport getForage from '../ajax/getForage';\r\nimport getValue from '../system/getValue';\r\nimport guildManage from '../app/guild/manage';\r\nimport jQueryPresent from '../common/jQueryPresent';\r\nimport {nowSecs} from '../support/constants';\r\nimport setForage from '../ajax/setForage';\r\nimport {act, cur, gxp, lvl, max, utc, vl} from './guildTracker/indexConstants';\r\n\r\nvar oldArchive;\r\nvar guild;\r\n\r\nfunction pushNewRecord(member) {\r\n  oldArchive.members[member.name].push([\r\n    Math.floor(member.last_activity / 86400),\r\n    member.current_stamina,\r\n    member.level,\r\n    member.max_stamina,\r\n    nowSecs,\r\n    member.vl,\r\n    member.guild_xp,\r\n  ]);\r\n}\r\n\r\nfunction initMember(member) {\r\n  if (!oldArchive.members[member.name]) {\r\n    oldArchive.members[member.name] = [];\r\n    pushNewRecord(member);\r\n  }\r\n}\r\n\r\nvar type2tests = [\r\n  function(archive, current) {\r\n    // Has current stam changed ?\r\n    return current.current_stamina !== archive[cur]; // probably want a weighted percentage here\r\n    // Might only care if it has dropped significantly ?\r\n  },\r\n  function(archive, current) {\r\n    // Has Max Stam increased ?\r\n    return current.max_stamina > archive[max]; // probably want a weighted percentage here\r\n  },\r\n  function(archive, current) {\r\n    // Has level changed ?\r\n    return current.level !== archive[lvl];\r\n  },\r\n  function(archive, current) {\r\n    // Has VL changed ?\r\n    return current.vl !== archive[vl];\r\n  },\r\n  function(archive, current) {\r\n    // Has GXP changed ?\r\n    return current.guild_xp !== archive[gxp]; // probably want a weighted percentage here\r\n  }\r\n];\r\n\r\nfunction processMemberRecord(newArchive, member) {\r\n  initMember(member);\r\n  var archiveMember = oldArchive.members[member.name];\r\n  var archiveLength = archiveMember.length;\r\n  var archiveRecord = archiveMember[archiveLength - 1];\r\n  var archiveAge = nowSecs - archiveRecord[utc];\r\n  if (archiveAge >= 86100) {\r\n    var type2change = type2tests.some(function(test) {\r\n      if (test(archiveRecord, member)) {\r\n        return true;\r\n      }\r\n      return false;\r\n    });\r\n    if (type2change) {\r\n      pushNewRecord(member);\r\n    } else {\r\n      archiveRecord[act] = Math.floor(member.last_activity / 86400);\r\n      archiveRecord[utc] = nowSecs;\r\n    }\r\n  }\r\n  newArchive.members[member.name] = oldArchive.members[member.name];\r\n}\r\n\r\nfunction doMerge() { // jQuery.min\r\n  var newArchive = {lastUpdate: nowSecs, members: {}};\r\n  guild.r.ranks.forEach(function(rank) {\r\n    rank.members.forEach(processMemberRecord.bind(null, newArchive));\r\n  });\r\n  setForage('fsh_guildActivity', newArchive);\r\n}\r\n\r\nfunction gotGuild(data) {\r\n  if (data && data.r) {\r\n    guild = data;\r\n    doMerge();\r\n  }\r\n}\r\n\r\nfunction gotActivity(data) { // jQuery.min\r\n  if (data) {\r\n    oldArchive = data;\r\n  } else {\r\n    oldArchive = {lastUpdate: 0, members: {}};\r\n  }\r\n  if (nowSecs > fallback(oldArchive.lastUpdate, 0) + 300) { // 5 mins - probably want to increase\r\n    guildManage().done(gotGuild);\r\n  }\r\n}\r\n\r\nexport default function guildActivity() { // jQuery.min\r\n  if (jQueryPresent() && getValue('enableGuildActivityTracker')) {\r\n    getForage('fsh_guildActivity').done(gotActivity);\r\n  }\r\n}\r\n","import callApp from '../callApp';\r\n\r\nexport default function guildManage() {\r\n  return callApp({cmd: 'guild', subcmd: 'manage'});\r\n}\r\n","export default function createDocument(details) {\r\n  // Use DOMParser to prevent img src tags downloading\r\n  var parser = new DOMParser();\r\n  var doc = parser.parseFromString(details, 'text/html');\r\n  return doc;\r\n}\r\n","export default function getRandomInt(_min, _max) {\r\n  var min = Math.ceil(_min);\r\n  var max = Math.floor(_max);\r\n  return Math.floor(Math.random() * (max - min)) + min;\r\n}\r\n","export default function insertElementBefore(newNode, referenceNode) {\r\n  if (referenceNode instanceof Node &&\r\n      referenceNode.parentNode instanceof Node) {\r\n    return referenceNode.parentNode.insertBefore(newNode, referenceNode);\r\n  }\r\n}\r\n","import insertHtml from './insertHtml';\r\n\r\nexport default function insertHtmlAfterBegin(parent, html) {\r\n  insertHtml(parent, 'afterbegin', html);\r\n}\r\n","import insertHtml from './insertHtml';\r\n\r\nexport default function insertHtmlAfterEnd(parent, html) {\r\n  insertHtml(parent, 'afterend', html);\r\n}\r\n","import {getElementById} from '../common/getElement';\r\n\r\nexport var pCC = getElementById('pCC');\r\nexport var pCR = getElementById('pCR');\r\n","import getRandomInt from './getRandomInt';\r\n\r\nexport default function rnd() {\r\n  return getRandomInt(1000000000, 9999999998);\r\n}\r\n","export default function setValue(name, value) {\r\n  GM_setValue(name, value);\r\n}\r\n","import add from '../support/task';\r\nimport calf from '../support/calf';\r\nimport createDocument from '../system/createDocument';\r\nimport {getElementById} from '../common/getElement';\r\nimport getRandomInt from '../system/getRandomInt';\r\nimport getValue from '../system/getValue';\r\nimport {imageServer} from '../system/system';\r\nimport insertElementBefore from '../common/insertElementBefore';\r\nimport insertHtmlAfterBegin from '../common/insertHtmlAfterBegin';\r\nimport insertHtmlAfterEnd from '../common/insertHtmlAfterEnd';\r\nimport jQueryPresent from '../common/jQueryPresent';\r\nimport {now} from '../support/constants';\r\nimport {pCC} from '../support/layout';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport rnd from '../system/rnd';\r\nimport setValue from '../system/setValue';\r\n\r\nvar composeMsg =\r\n  '<li class=\"notification\"><a href=\"index.php?cmd=composing\"><span' +\r\n  ' class=\"notification-icon\"></span><p class=\"notification-content\">' +\r\n  'Composing to do</p></a></li>';\r\n\r\nfunction displayComposeMsg() {\r\n  insertHtmlAfterBegin(getElementById('notifications'), composeMsg);\r\n}\r\n\r\nfunction getDoc(data) {\r\n  if (calf.cmd !== 'composing') {\r\n    return createDocument(data);\r\n  }\r\n  return document;\r\n}\r\n\r\nfunction parseComposing(data) {\r\n  var doc = getDoc(data);\r\n  var timeRE = /ETA:\\s*(\\d+)h\\s*(\\d+)m\\s*(\\d+)s/;\r\n  var times = [];\r\n  var openSlots = doc.getElementsByClassName('composing-potion-time');\r\n  Array.prototype.forEach.call(openSlots, function(el) {\r\n    if (el.textContent === 'ETA: Ready to Collect!' ||\r\n        el.textContent === 'ETA: n/a') {\r\n      times.push(0);\r\n    } else {\r\n      var timeArr = timeRE.exec(el.textContent);\r\n      var milli = (timeArr[1] * 3600 + timeArr[2] * 60 + Number(timeArr[3])) *\r\n        1000 + now;\r\n      times.push(milli);\r\n    }\r\n  });\r\n  var eta = Math.min.apply(null, times);\r\n  if (eta === 0) {\r\n    if (calf.cmd !== 'composing') {displayComposeMsg();}\r\n    setValue('needToCompose', true);\r\n  } else {\r\n    setValue('needToCompose', false);\r\n    setValue('lastComposeCheck', eta);\r\n  }\r\n}\r\n\r\nfunction createSuccess(temp, textStatus) {\r\n  var potName = temp[temp.selectedIndex].text;\r\n  var myParent = temp.parentNode;\r\n  var infoDiv = myParent.previousElementSibling.previousElementSibling;\r\n  infoDiv.children[0].innerHTML = '';\r\n  infoDiv.children[0].classList.add('fshPot');\r\n  infoDiv.children[0].style.backgroundImage = 'url(' + imageServer +\r\n    '/composing/potions/' + getRandomInt(1, 11) + '_' +\r\n    getRandomInt(1, 51) + '.gif)';\r\n  infoDiv.children[2].innerHTML = 'Creating \\'<span class=\"fshBold\">' +\r\n    potName + '</span>\\' Potion';\r\n  infoDiv.children[3].innerHTML = '';\r\n  myParent.innerHTML = '<div class=\"fshScs\">' + textStatus + '</div>';\r\n}\r\n\r\nfunction createPotion(temp) { // jQuery\r\n  retryAjax({\r\n    cache: false,\r\n    dataType: 'json',\r\n    url: 'index.php',\r\n    data: {\r\n      cmd: 'composing',\r\n      subcmd: 'createajax',\r\n      template_id: temp.value,\r\n      _rnd: rnd()\r\n    }\r\n  }).done(function potionDone(data, textStatus) {\r\n    if (data.error !== '') {\r\n      temp.parentNode.innerHTML = '<div class=\"fshScs\">' +\r\n        data.error + '</div>';\r\n    } else {\r\n      createSuccess(temp, textStatus);\r\n    }\r\n  });\r\n}\r\n\r\nfunction isOurTarget(target) {\r\n  return target.tagName === 'SPAN' && target.className === 'quickCreate';\r\n}\r\n\r\nfunction doQuickCreate(self) {\r\n  var temp = self.previousElementSibling.previousElementSibling;\r\n  if (temp && temp.value !== 'none') {\r\n    self.innerHTML = '';\r\n    self.classList.add('fshSpinner', 'fshSpinner12', 'fshComposingSpinner');\r\n    createPotion(temp);\r\n  }\r\n}\r\n\r\nfunction quickCreate(evt) {\r\n  var self = evt.target.parentNode;\r\n  if (isOurTarget(self)) {doQuickCreate(self);}\r\n}\r\n\r\nfunction checkLastCompose() { // jQuery\r\n  var lastComposeCheck = getValue('lastComposeCheck');\r\n  if (lastComposeCheck && now < lastComposeCheck) {return;}\r\n  retryAjax('index.php?no_mobile=1&cmd=composing').done(function(data) {\r\n    add(3, parseComposing, [data]);\r\n  });\r\n}\r\n\r\nfunction composeAlert() {\r\n  var needToCompose = getValue('needToCompose');\r\n  if (needToCompose) {\r\n    displayComposeMsg();\r\n    return;\r\n  }\r\n  checkLastCompose();\r\n}\r\n\r\nexport function injectComposeAlert() {\r\n  if (jQueryPresent() && calf.cmd !== 'composing') {composeAlert();}\r\n}\r\n\r\nfunction moveButtons() {\r\n  if (getValue('moveComposingButtons')) {\r\n    var buttonDiv = getElementById('composing-error-dialog')\r\n      .previousElementSibling;\r\n    buttonDiv.setAttribute('style', 'text-align: right; padding: 0 38px 0 0');\r\n    var top = pCC.getElementsByClassName('composing-level')[0]\r\n      .parentNode;\r\n    insertElementBefore(buttonDiv, top);\r\n  }\r\n}\r\n\r\nfunction hasJQuery() {\r\n  if (calf.enableComposingAlert) {\r\n    parseComposing();\r\n  }\r\n\r\n  var buttons = pCC\r\n    .querySelectorAll('input[id^=create-]:not(#create-multi)');\r\n  Array.prototype.forEach.call(buttons, function(el) {\r\n    insertHtmlAfterEnd(el, '<span class=\"quickCreate\">' +\r\n      '[<span class=\"sendLink\">Quick Create</span>]</span>');\r\n  });\r\n  pCC.addEventListener('click', quickCreate);\r\n  moveButtons();\r\n}\r\n\r\nexport function injectComposing() {\r\n  if (jQueryPresent() && pCC) {hasJQuery();}\r\n}\r\n\r\nexport function composingCreate() {\r\n  getElementById('composing-add-skill')\r\n    .addEventListener('click', function() {\r\n      getElementById('composing-skill-level-input').value =\r\n        getElementById('composing-skill-level-max').textContent;\r\n    });\r\n  getElementById('composing-skill-select')\r\n    .addEventListener('change', function() {\r\n      getElementById('composing-skill-level-input').value =\r\n        getElementById('composing-skill-level-max').textContent;\r\n    });\r\n}\r\n","import getValue from '../system/getValue';\r\nimport intValue from '../system/intValue';\r\n\r\nexport var pvpLowerLevel;\r\nexport var pvpUpperLevel;\r\nexport var gvgLowerLevel;\r\nexport var gvgUpperLevel;\r\n\r\nfunction calcLvlToTest() {\r\n  var levelToTest = intValue(document.getElementsByClassName(\r\n    'stat-level')[0].nextElementSibling.textContent);\r\n  var characterVirtualLevel = getValue('characterVirtualLevel');\r\n  if (characterVirtualLevel) {levelToTest = characterVirtualLevel;}\r\n  return levelToTest;\r\n}\r\n\r\nvar lowerPvpCalcs = [\r\n  {\r\n    a: function(levelToTest) {return levelToTest <= 205;},\r\n    b: function() {return 5;}\r\n  },\r\n  {\r\n    a: function(levelToTest) {return levelToTest >= 206 && levelToTest <= 209;},\r\n    b: function(levelToTest) {return levelToTest - 200;}\r\n  },\r\n  {a: function() {return true;}, b: function() {return 10;}}\r\n];\r\n\r\nfunction calcLowerPvpLevel(levelToTest) {\r\n  return levelToTest -\r\n    lowerPvpCalcs.find(function(e) {return e.a(levelToTest);}).b(levelToTest);\r\n}\r\n\r\nfunction calcUpperPvpLevel(levelToTest) {\r\n  var modifier = 10;\r\n  if (levelToTest < 200) {modifier = 5;}\r\n  return levelToTest + modifier;\r\n}\r\n\r\nvar lowerGvgCalcs = [\r\n  {\r\n    a: function(levelToTest) {return levelToTest >= 801;},\r\n    b: function() {return 100;}\r\n  },\r\n  {\r\n    a: function(levelToTest) {return levelToTest >= 752;},\r\n    b: function(levelToTest) {return levelToTest - 701;}\r\n  },\r\n  {\r\n    a: function(levelToTest) {return levelToTest >= 351;},\r\n    b: function() {return 50;}\r\n  },\r\n  {\r\n    a: function(levelToTest) {return levelToTest >= 326;},\r\n    b: function(levelToTest) {return levelToTest - 301;}\r\n  },\r\n  {a: function() {return true;}, b: function() {return 25;}}\r\n];\r\n\r\nfunction calcLowerGvgLevel(levelToTest) {\r\n  return levelToTest -\r\n    lowerGvgCalcs.find(function(e) {return e.a(levelToTest);}).b(levelToTest);\r\n}\r\n\r\nfunction calcUpperGvgLevel(levelToTest) {\r\n  var modifier = 100;\r\n  if (levelToTest <= 700) {modifier = 50;}\r\n  if (levelToTest <= 300) {modifier = 25;}\r\n  return levelToTest + modifier;\r\n}\r\n\r\nexport function calculateBoundaries() {\r\n  var levelToTest = calcLvlToTest();\r\n  pvpLowerLevel = calcLowerPvpLevel(levelToTest);\r\n  pvpUpperLevel = calcUpperPvpLevel(levelToTest);\r\n  gvgLowerLevel = calcLowerGvgLevel(levelToTest);\r\n  gvgUpperLevel = calcUpperGvgLevel(levelToTest);\r\n}\r\n","export default function makePageHeader(title, comment, spanId, button) {\r\n  var _comment = '';\r\n  if (comment !== '') {_comment = '&nbsp;(' + comment + ')';}\r\n  var _span = '';\r\n  if (spanId) {\r\n    _span = '[<span class=\"fshLink\" id=\"' +\r\n      spanId + '\">' + button + '</span>]';\r\n  }\r\n  return '<table width=100%><tbody><tr class=\"fshHeader\">' +\r\n    '<td width=\"90%\"><b>&nbsp;' + title + '</b>' + _comment +\r\n    '<td width=\"10%\" class=\"fshBtnBox\">' + _span +\r\n    '</td></tr><tbody></table>';\r\n}\r\n","import makePageHeader from './makePageHeader';\r\n\r\n// function makePageTemplate(title, comment, spanId, button, divId) {\r\nexport default function makePageTemplate(o) {\r\n  return makePageHeader(o.title, o.comment, o.spanId, o.button) +\r\n    '<div class=\"fshSmall\" id=\"' + o.divId + '\"></div>';\r\n}\r\n","export default function quickBuffHref(aPlayerId, buffList) { // Bad Pattern\r\n  var passthru = '';\r\n  if (buffList) {passthru = '&blist=' + buffList;}\r\n  return 'href=\\'javascript:window.openWindow(\"index.php?cmd=' +\r\n    'quickbuff&tid=' + aPlayerId + passthru +\r\n    '\", \"fsQuickBuff\", 618, 1000, \",scrollbars\")\\'';\r\n}\r\n","export default function intValue(theText) {\r\n  if (!theText) {return 0;}\r\n  return parseInt(theText.replace(/,/g, ''), 10);\r\n}\r\n","import addCommas from './system/addCommas';\r\nimport calf from './support/calf';\r\nimport doSortParams from './common/doSortParams';\r\nimport {getElementById} from './common/getElement';\r\nimport getForage from './ajax/getForage';\r\nimport {imageServer} from './system/system';\r\nimport jQueryPresent from './common/jQueryPresent';\r\nimport numberSort from './system/numberSort';\r\nimport {pCC} from './support/layout';\r\nimport setForage from './ajax/setForage';\r\nimport stringSort from './system/stringSort';\r\n\r\nvar content;\r\nvar monsterAry;\r\n\r\nfunction noMobs() {\r\n  content.innerHTML = '<span>No monster information! ' +\r\n    'Please enable entity log and travel a bit to see the world</span>';\r\n}\r\n\r\nfunction mobRows() {\r\n  var result = '';\r\n  for (var i = 0; i < monsterAry.length; i += 1) {\r\n    result += '<tr>' +\r\n      '<td class=\"fshCenter\">' + monsterAry[i].image + '</td>' +\r\n      '<td>' + monsterAry[i].name + '</td>' +\r\n      '<td class=\"fshCenter\">' + monsterAry[i].creature_class + '</td>' +\r\n      '<td class=\"fshCenter\">' + monsterAry[i].level + '</td>' +\r\n      '<td class=\"fshCenter\">' + monsterAry[i].attack + '</td>' +\r\n      '<td class=\"fshCenter\">' + monsterAry[i].defense + '</td>' +\r\n      '<td class=\"fshCenter\">' + monsterAry[i].armor + '</td>' +\r\n      '<td class=\"fshCenter\">' + monsterAry[i].damage + '</td>' +\r\n      '<td class=\"fshCenter\">' + monsterAry[i].hp + '</td>' +\r\n      '<td class=\"fshCenter\">' + monsterAry[i].enhancements + '</td></tr>';\r\n  }\r\n  return result;\r\n}\r\n\r\nfunction drawMobs() {\r\n  var inject = getElementById('entityTableOutput');\r\n  if (!monsterAry || !inject) {return;}\r\n  inject.innerHTML = mobRows();\r\n}\r\n\r\nfunction findSortType(target) {\r\n  return target.getAttribute('sortType') || 'string';\r\n}\r\n\r\nfunction sortMonsterAry(sortType) {\r\n  if (sortType === 'string') {\r\n    monsterAry.sort(stringSort);\r\n  } else {\r\n    monsterAry.sort(numberSort);\r\n  }\r\n}\r\n\r\nfunction sortCol(target) {\r\n  doSortParams(target.getAttribute('sortKey'));\r\n  var sortType = findSortType(target);\r\n  sortMonsterAry(sortType);\r\n  drawMobs();\r\n}\r\n\r\nfunction doHandlers(evt) { // jQuery.min\r\n  var target = evt.target;\r\n  if (target.id === 'clearEntityLog') {\r\n    setForage('fsh_monsterLog', '');\r\n    noMobs();\r\n    return;\r\n  }\r\n  if (!target.classList.contains('fshLink')) {return;}\r\n  sortCol(target);\r\n}\r\n\r\nfunction drawTable() {\r\n  if (!monsterAry) {return;}\r\n  content.innerHTML = '<table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" ' +\r\n    'width=\"100%\"><tr class=\"fshBlack fshWhite\">' +\r\n    '<td width=\"90%\" class=\"fshCenter\"><b>Entity Information</b></td>' +\r\n    '<td width=\"10%\">[<span id=\"clearEntityLog\" class=\"fshPoint\">Clear' +\r\n    '</span>]</td></tr></table>' +\r\n    '<table cellspacing=\"1\" cellpadding=\"2\" border=\"0\"><thead>' +\r\n    '<tr class=\"fshVerySoftOrange\">' +\r\n    '<th width=\"25%\" class=\"fshLink\" sortkey=\"name\" colspan=\"2\">Entity</th>' +\r\n    '<th class=\"fshCenter fshLink\" sortkey=\"creature_class\">Class</th>' +\r\n    '<th class=\"fshCenter fshLink\" sortkey=\"level\" sorttype=\"number\">Lvl</th>' +\r\n    '<th class=\"fshCenter\">Attack</th>' +\r\n    '<th class=\"fshCenter\">Defence</th>' +\r\n    '<th class=\"fshCenter\">Armor</th>' +\r\n    '<th class=\"fshCenter\">Damage</th>' +\r\n    '<th class=\"fshCenter\">HP</th>' +\r\n    '<th class=\"fshCenter\">Enhancements</th>' +\r\n    '</tr></thead><tbody id=\"entityTableOutput\"></tbody></table>';\r\n  content.addEventListener('click', doHandlers);\r\n}\r\n\r\nfunction hazEnhancements(enhancements) {\r\n  return enhancements && enhancements.length > 0;\r\n}\r\n\r\nfunction prepMonster(data) {\r\n  monsterAry = Object.keys(data).reduce(function(prev, curr) {\r\n    var tmpObj = data[curr];\r\n    tmpObj.name = curr;\r\n    tmpObj.image = '<img class=\"tip-static\" src=\"' + imageServer +\r\n      '/creatures/' + tmpObj.image_id + '.jpg\" data-tipped=\"<img src=\\'' +\r\n      imageServer + '/creatures/' + tmpObj.image_id +\r\n      '.jpg\\' width=200 height=200>\" width=40 height=40>';\r\n    tmpObj.level = addCommas(tmpObj.level);\r\n    tmpObj.attack = tmpObj.attack.min + ' - ' + tmpObj.attack.max;\r\n    tmpObj.defense = tmpObj.defense.min + ' - ' + tmpObj.defense.max;\r\n    tmpObj.armor = tmpObj.armor.min + ' - ' + tmpObj.armor.max;\r\n    tmpObj.damage = tmpObj.damage.min + ' - ' + tmpObj.damage.max;\r\n    tmpObj.hp = tmpObj.hp.min + ' - ' + tmpObj.hp.max;\r\n    var enhancements;\r\n    if (tmpObj.enhancements) {enhancements = Object.keys(tmpObj.enhancements);}\r\n    if (hazEnhancements(enhancements)) {\r\n      var tmp = '<span class=\"fshXXSmall\">';\r\n      tmp += enhancements.reduce(function(_prev, _curr) {\r\n        return _prev + '<span class=\"fshNoWrap\">' + _curr + ': ' +\r\n          tmpObj.enhancements[_curr].min + ' - ' +\r\n          tmpObj.enhancements[_curr].max + '</span><br>';\r\n      }, '');\r\n      tmpObj.enhancements = tmp.slice(0, -4) + '</span>';\r\n    } else {\r\n      tmpObj.enhancements = '<span class=\"fshGrey\">**Missing**</span>';\r\n    }\r\n    prev.push(tmpObj);\r\n    return prev;\r\n  }, []);\r\n}\r\n\r\nfunction prepAry(data) {\r\n  if (!data || data === '') {\r\n    noMobs();\r\n    return;\r\n  }\r\n  prepMonster(data);\r\n  calf.sortBy = 'level';\r\n  calf.sortAsc = true;\r\n  monsterAry.sort(numberSort);\r\n  drawTable();\r\n  drawMobs();\r\n}\r\n\r\nfunction haveJquery(injector) { // jQuery.min\r\n  content = injector || pCC;\r\n  if (!content) {return;}\r\n  getForage('fsh_monsterLog').done(prepAry);\r\n}\r\n\r\nexport default function injectMonsterLog(injector) {\r\n  if (jQueryPresent()) {haveJquery(injector);}\r\n}\r\n","import {getElementById} from './common/getElement';\r\nimport getForage from './ajax/getForage';\r\nimport jConfirm from './common/jConfirm';\r\nimport jQueryNotPresent from './common/jQueryNotPresent';\r\nimport {pCC} from './support/layout';\r\nimport setForage from './ajax/setForage';\r\n\r\nvar content;\r\nvar combatLog = [];\r\nvar textArea;\r\n\r\nfunction notepadCopyLog() {\r\n  textArea.focus();\r\n  textArea.select();\r\n}\r\n\r\nfunction clearCombatLog() {\r\n  combatLog = [];\r\n  textArea.value = '[]';\r\n  setForage('fsh_combatLog', combatLog);\r\n}\r\n\r\nfunction notepadClearLog() { // jQuery\r\n  jConfirm('Clear Combat Log',\r\n    'Are you sure you want to clear your log?', clearCombatLog\r\n  );\r\n}\r\n\r\nfunction gotCombatLog(data) {\r\n  if (data) {combatLog = data;}\r\n  var yuuzParser = '<tr><td align=\"center\" colspan=\"4\"><b>Log Parser</b>' +\r\n    '</td></tr>' +\r\n    '<tr><td colspan=\"4\" align=\"center\">WARNING: this links to an ' +\r\n    'external site not related to HCS.<br />' +\r\n    'If you wish to visit site directly URL is: http://evolutions.' +\r\n    'yvong.com/fshlogparser.php<br />' +\r\n    '<tr><td colspan=4 align=\"center\"><input type=\"hidden\" value=\"true\" ' +\r\n    'name=\"submit\"><input type=\"submit\" value=\"Analyze!\"></td></tr>';\r\n  content.innerHTML = '<h1>Combat Logs</h1><br /><form action=\"http://' +\r\n    'evolutions.yvong.com/fshlogparser.php\" method=\"post\" target=\"_blank\">' +\r\n    '<div align=\"center\"><textarea align=\"center\" cols=\"80\" rows=\"25\" ' +\r\n    'readonly style=\"background-color:white;font-family:Consolas,\\'' +\r\n    'Lucida Console\\',\\'Courier New\\',monospace;\" id=\"combatLog\" ' +\r\n    'name=\"logs\">' + JSON.stringify(combatLog) + '</textarea></div>' +\r\n    '<br /><br /><table width=\"100%\"><tr>' +\r\n    '<td colspan=\"2\" align=center>' +\r\n    '<input type=\"button\" class=\"custombutton\" value=\"Select All\" ' +\r\n    'id=\"copyLog\"></td>' +\r\n    '<td colspan=\"2\" align=center>' +\r\n    '<input type=\"button\" class=\"custombutton\" value=\"Clear\" ' +\r\n    'id=\"clearLog\"></td>' +\r\n    '</tr>' + yuuzParser + '</table></div>' +\r\n    '</form>';\r\n  textArea = getElementById('combatLog');\r\n  getElementById('copyLog')\r\n    .addEventListener('click', notepadCopyLog);\r\n  getElementById('clearLog')\r\n    .addEventListener('click', notepadClearLog);\r\n}\r\n\r\nexport default function injectNotepadShowLogs(injector) { // jQuery.min\r\n  if (jQueryNotPresent()) {return;}\r\n  content = injector || pCC;\r\n  getForage('fsh_combatLog').done(gotCombatLog);\r\n}\r\n","import {getElementById} from './common/getElement';\r\nimport getForage from './ajax/getForage';\r\nimport jQueryNotPresent from './common/jQueryNotPresent';\r\nimport makePageTemplate from './lists/makePageTemplate';\r\nimport {pCC} from './support/layout';\r\nimport quickBuffHref from './common/quickBuffHref';\r\nimport setForage from './ajax/setForage';\r\nimport {\r\n  calculateBoundaries,\r\n  gvgLowerLevel,\r\n  gvgUpperLevel,\r\n  pvpLowerLevel,\r\n  pvpUpperLevel\r\n} from './common/levelHighlight';\r\n\r\nexport function injectFindPlayer() { // Bad jQuery\r\n  if (jQueryNotPresent()) {return;}\r\n  calculateBoundaries();\r\n  var findPlayerButton = $('input[value=\"Find Player\"]');\r\n  findPlayerButton.parent().append('&nbsp;<a href=\"index.php?' +\r\n    'cmd=findplayer&search_active=1&search_username=&search_level_min=' +\r\n    pvpLowerLevel + '&search_level_max=' +\r\n    pvpUpperLevel + '&search_in_guild=0\"><span ' +\r\n    'style=\"color:blue;\">Get PvP targets</span></a>&nbsp;<a href=\"' +\r\n    'index.php?cmd=findplayer&search_active=1&search_username=&' +\r\n    'search_level_min=' + gvgLowerLevel + '&search_level_max=' +\r\n    gvgUpperLevel + '&search_in_guild=0\"><span style=\"color:blue;\">' +\r\n    'Get GvG targets</span></a>');\r\n\r\n  $('table[class=\"width_full\"]').find('a[href*=\"player_id\"]')\r\n    .each(function(i, e) {\r\n      var id = /player_id=([0-9]*)/.exec($(e).attr('href'));\r\n      $(e).after('<a style=\"color:blue;font-size:10px;\" ' +\r\n        quickBuffHref(id[1]) + '>[b]</a>');\r\n    });\r\n}\r\n\r\nexport function injectNotepad() { // jQuery\r\n  if (jQueryNotPresent()) {return;}\r\n  $('#notepad_notes')\r\n    .attr('cols', '90')\r\n    .attr('rows', '30')\r\n    .css('resize', 'none');\r\n}\r\n\r\nexport function injectFsBoxContent(injector) { // jQuery.min\r\n  if (jQueryNotPresent()) {return;}\r\n  var content = injector || pCC;\r\n  content.innerHTML = makePageTemplate({\r\n    title: 'FS Box Log',\r\n    comment: '',\r\n    spanId: 'fsboxclear',\r\n    button: 'Clear',\r\n    divId: 'fsboxdetail'\r\n  });\r\n  getForage('fsh_fsboxcontent').done(function(fsboxcontent) {\r\n    getElementById('fsboxdetail').innerHTML = fsboxcontent;\r\n  });\r\n  getElementById('fsboxclear')\r\n    .addEventListener('click', function() {\r\n      setForage('fsh_fsboxcontent', '');\r\n      location.reload();\r\n    }, true);\r\n}\r\n","import {createDiv} from '../common/cElement';\r\nimport {getElementById} from '../common/getElement';\r\nimport insertElement from '../common/insertElement';\r\n\r\nexport default function jQueryDialog(fn) { // jQuery\r\n  var content = getElementById('content');\r\n  if (content) {content.innerHTML = '';} else {\r\n    content = createDiv({\r\n      id: 'content',\r\n      style: {display: 'none'}\r\n    });\r\n    insertElement(document.body, content);\r\n  }\r\n  $(content).dialog({\r\n    width: 640,\r\n    modal: true,\r\n    position: {my: 'top', at: 'top', offset: '0 60', collision: 'none'},\r\n    resizable: false\r\n  });\r\n  fn(content);\r\n}\r\n","import {createSpan} from '../common/cElement';\r\nimport {getElementById} from '../common/getElement';\r\nimport getForage from '../ajax/getForage';\r\nimport {injectFsBoxContent} from '../misc';\r\nimport insertElement from '../common/insertElement';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\nimport jQueryDialog from './jQueryDialog';\r\nimport jQueryPresent from '../common/jQueryPresent';\r\nimport {sendEvent} from '../support/fshGa';\r\nimport setForage from '../ajax/setForage';\r\n\r\nfunction getBoxList(boxList) {\r\n  if (boxList) {return boxList;}\r\n  return '';\r\n}\r\n\r\nfunction storeFSBox(_boxList) {\r\n  var boxList = getBoxList(_boxList);\r\n  var fsbox = getElementById('minibox-fsbox')\r\n    .getElementsByClassName('message')[0].innerHTML;\r\n  if (boxList.indexOf(fsbox) < 0) {boxList = '<br>' + fsbox + boxList;}\r\n  if (boxList.length > 10000) {boxList = boxList.substring(0, 10000);}\r\n  setForage('fsh_fsboxcontent', boxList);\r\n}\r\n\r\nfunction fSBoxExists(node) { // jQuery.min\r\n  var nodediv = node.lastElementChild;\r\n  var playerName = nodediv.getElementsByTagName('a');\r\n  if (playerName.length === 0) {return;}\r\n  getForage('fsh_fsboxcontent').done(storeFSBox);\r\n  playerName = playerName[0].textContent;\r\n  insertHtmlBeforeEnd(nodediv,\r\n    '<br><span class=\"fshPaleVioletRed\">' +\r\n    '[ <a href=\"index.php?cmd=log&subcmd=doaddignore&ignore_username=' +\r\n    playerName + '\">Ignore</a> ]</span> ');\r\n  var log = createSpan({\r\n    className: 'fshYellow',\r\n    innerHTML: '[ <span class=\"fshLink\">Log</span> ]'\r\n  });\r\n  log.addEventListener('click', function() {\r\n    sendEvent('injectFSBoxLog', 'injectFsBoxContent');\r\n    jQueryDialog(injectFsBoxContent);\r\n  });\r\n  insertElement(nodediv, log);\r\n}\r\n\r\nexport default function injectFSBoxLog() {\r\n  var node = getElementById('minibox-fsbox');\r\n  if (jQueryPresent() && node) {fSBoxExists(node);}\r\n}\r\n","import {getElementById} from '../common/getElement';\r\nimport getForage from '../ajax/getForage';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport makePageTemplate from '../lists/makePageTemplate';\r\nimport {pCC} from '../support/layout';\r\nimport setForage from '../ajax/setForage';\r\n\r\nfunction displayBuffLog(buffLog) {\r\n  getElementById('bufflog').innerHTML = buffLog;\r\n}\r\n\r\nfunction clearBuffLog() {\r\n  setForage('fsh_buffLog', '').done(displayBuffLog);\r\n}\r\n\r\nexport default function injectBuffLog(injector) { // jQuery.min\r\n  if (jQueryNotPresent()) {return;}\r\n  var content = injector || pCC;\r\n  content.innerHTML = makePageTemplate({\r\n    title: 'Buff Log',\r\n    comment: '',\r\n    spanId: 'clearBuffs',\r\n    button: 'Clear',\r\n    divId: 'bufflog'\r\n  });\r\n  getElementById('clearBuffs').addEventListener('click', clearBuffLog);\r\n  getForage('fsh_buffLog').done(displayBuffLog);\r\n}\r\n","export default function addCommas(x) {\r\n  return x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\r\n}\r\n","import calf from '../support/calf';\r\nimport isUndefined from './isUndefined';\r\n\r\nfunction reverseSort(headerClicked) {\r\n  return calf.sortBy && calf.sortBy === headerClicked;\r\n}\r\n\r\nexport default function doSortParams(headerClicked) {\r\n  if (isUndefined(calf.sortAsc)) {calf.sortAsc = true;}\r\n  if (reverseSort(headerClicked)) {\r\n    calf.sortAsc = !calf.sortAsc;\r\n  }\r\n  calf.sortBy = headerClicked;\r\n}\r\n","import fallback from './fallback';\r\nimport isUndefined from '../common/isUndefined';\r\n\r\nfunction getPath(obj, aPath, def) {\r\n  var _obj = obj;\r\n  var _path = aPath.split('.');\r\n  var len = _path.length;\r\n  for (var i = 0; i < len; i += 1) {\r\n    if (fallback(!_obj, typeof _obj !== 'object')) {return def;}\r\n    _obj = _obj[_path[i]];\r\n  }\r\n  return _obj;\r\n}\r\n\r\nexport default function path(obj, aPath, def) {\r\n  var _obj = getPath(obj, aPath, def);\r\n  if (isUndefined(_obj)) {return def;}\r\n  return _obj;\r\n}\r\n","import calf from '../support/calf';\r\n\r\nexport default function sortDesc(result) {\r\n  if (calf.sortAsc) {return result;}\r\n  return -result;\r\n}\r\n","import calf from '../support/calf';\r\nimport path from './path';\r\nimport sortDesc from './sortDesc';\r\n\r\nfunction intFromString(val) {\r\n  if (typeof val === 'string') {\r\n    return parseInt(val.replace(/,|#/g, ''), 10);\r\n  }\r\n  return val;\r\n}\r\n\r\nfunction aIsNotEquipment(a) {\r\n  return typeof a.type !== 'undefined' && a.type > 8;\r\n}\r\n\r\nfunction bIsNotEquipment(a, b) {\r\n  return typeof a.type !== 'undefined' && b.type > 8;\r\n}\r\n\r\nexport default function numberSort(a, b) {\r\n  if (aIsNotEquipment(a)) {return 1;} // non equipment items\r\n  if (bIsNotEquipment(a, b)) {return -1;}\r\n  var valueA = path(a, calf.sortBy, 1);\r\n  var valueB = path(b, calf.sortBy, 1);\r\n  valueA = intFromString(valueA);\r\n  valueB = intFromString(valueB);\r\n  var result = valueA - valueB;\r\n  return sortDesc(result);\r\n}\r\n","import calf from '../support/calf';\r\nimport path from './path';\r\nimport sortDesc from './sortDesc';\r\n\r\nexport default function stringSort(a, b) {\r\n  var result = 0;\r\n  var _a = path(a, calf.sortBy, 'a');\r\n  var _b = path(b, calf.sortBy, 'a');\r\n  if (_a.toLowerCase() < _b.toLowerCase()) {result = -1;}\r\n  if (_a.toLowerCase() > _b.toLowerCase()) {result = 1;}\r\n  return sortDesc(result);\r\n}\r\n","var guildId;\r\n\r\nexport default function currentGuildId() {\r\n  if (!guildId) {\r\n    var nodeList = document.body.getElementsByTagName('script');\r\n    Array.prototype.forEach.call(nodeList, function getGuildId(el) {\r\n      var match = el.textContent.match(/\\s+guildId: ([0-9]+),/);\r\n      if (match) {guildId = Number(match[1]);}\r\n    });\r\n  }\r\n  return guildId;\r\n}\r\n","import createDocument from './system/createDocument';\r\nimport currentGuildId from './common/currentGuildId';\r\nimport {defaults} from './support/dataObj';\r\nimport fallback from './system/fallback';\r\nimport getForage from './ajax/getForage';\r\nimport getValue from './system/getValue';\r\nimport intValue from './system/intValue';\r\nimport jQueryNotPresent from './common/jQueryNotPresent';\r\nimport {now} from './support/constants';\r\nimport retryAjax from './ajax/retryAjax';\r\nimport setForage from './ajax/setForage';\r\nimport setValue from './system/setValue';\r\nimport {\r\n  calculateBoundaries,\r\n  pvpLowerLevel,\r\n  pvpUpperLevel\r\n} from './common/levelHighlight';\r\n\r\nvar context;\r\nvar onlinePlayers;\r\nvar onlineData;\r\nvar highlightPlayersNearMyLvl;\r\nvar onlinePages;\r\nvar lastPage;\r\nvar table;\r\nvar guildId;\r\n\r\nfunction buildOnlinePlayerData() { // jQuery\r\n  onlineData = [];\r\n  Object.keys(onlinePlayers).forEach(function(player) {\r\n    var guildImage = $('<div/>')\r\n      .append(onlinePlayers[player][0]);\r\n    $('img', guildImage).addClass('fshImgCntr');\r\n    onlineData.push([\r\n      guildImage.html(),\r\n      onlinePlayers[player][1],\r\n      onlinePlayers[player][2],\r\n      onlinePlayers[player][3] * 100 +\r\n      onlinePlayers[player][4] + 1,\r\n    ]);\r\n  });\r\n}\r\n\r\nfunction saveVal(key, val) {\r\n  if (!isNaN(val)) {setValue(key, val);}\r\n}\r\n\r\nvar lvlTests = [\r\n  function(level, min, max) {return isNaN(min) && isNaN(max);},\r\n  function(level, min, max) {return isNaN(min) && level <= max;},\r\n  function(level, min, max) {return min <= level && isNaN(max);},\r\n  function(level, min, max) {return min <= level && level <= max;}\r\n];\r\n\r\nfunction dataTableSearch(_settings, data) { // jQuery\r\n  /* Custom filtering function which will search\r\n  data in column three between two values */\r\n  var min = parseInt($('#fshMinLvl', context).val(), 10); // context\r\n  var max = parseInt($('#fshMaxLvl', context).val(), 10); // context\r\n  saveVal('onlinePlayerMinLvl', min);\r\n  saveVal('onlinePlayerMaxLvl', max);\r\n  var level = fallback(intValue(data[2]), 0);\r\n  for (var i = 0; i < lvlTests.length; i += 1) {\r\n    if (lvlTests[i](level, min, max)) {return true;}\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction filterHeaderOnlinePlayers() { // jQuery\r\n  $('#fshOutput', context).html( // context\r\n    '<div align=right>' +\r\n    'Min lvl:<input value=\"' + getValue('onlinePlayerMinLvl') +\r\n      '\" size=5 id=\"fshMinLvl\" /> ' +\r\n    'Max lvl:<input value=\"' + getValue('onlinePlayerMaxLvl') +\r\n      '\" size=5 id=\"fshMaxLvl\" /> ' +\r\n    '<input id=\"fshReset\" type=\"button\" value=\"Reset\"/>' +\r\n    '</div><table id=\"fshInv\" class=\"allow stripe hover\"></table>');\r\n}\r\n\r\nfunction guildNumber(html) {\r\n  var match = html.match(/;guild_id=([0-9]+)\"/);\r\n  if (match) {return Number(match[1]);}\r\n}\r\n\r\nvar highlightTests = [\r\n  function() {return highlightPlayersNearMyLvl;},\r\n  function(data) {return guildNumber(data[0]) !== guildId;},\r\n  function(data) {return intValue(data[2]) >= pvpLowerLevel;},\r\n  function(data) {return intValue(data[2]) <= pvpUpperLevel;}\r\n];\r\n\r\nfunction pvpHighlight(data) {\r\n  return highlightTests.every(function(el) {\r\n    return el(data);\r\n  });\r\n}\r\n\r\nfunction gotOnlinePlayers() { // jQuery\r\n  buildOnlinePlayerData();\r\n  $.fn.dataTable.ext.search.push(dataTableSearch);\r\n  filterHeaderOnlinePlayers();\r\n  highlightPlayersNearMyLvl = getValue('highlightPlayersNearMyLvl');\r\n  calculateBoundaries();\r\n  guildId = currentGuildId();\r\n\r\n  table = $('#fshInv', context).dataTable({ // context\r\n    data: onlineData,\r\n    pageLength: 30,\r\n    lengthMenu: [[30, 60, -1], [30, 60, 'All']],\r\n    columns: [\r\n      {title: 'Guild', 'class': 'dt-center', orderable: false},\r\n      {title: 'Name', 'class': 'dt-center'},\r\n      {title: 'Level', 'class': 'dt-center'},\r\n      {title: 'Page/Index', 'class': 'dt-center'}\r\n    ],\r\n    createdRow: function(row, data) {\r\n      if (pvpHighlight(data)) {\r\n        $('td', row).eq(2).addClass('lvlHighlight');\r\n      }\r\n    },\r\n    order: [3, 'desc'],\r\n    stateSave: true,\r\n    stateDuration: 0\r\n  }).api();\r\n}\r\n\r\nfunction checkLastPage() {\r\n  if (onlinePages === lastPage) {\r\n    setForage('fsh_onlinePlayers', onlinePlayers);\r\n    gotOnlinePlayers();\r\n  }\r\n}\r\n\r\nfunction getOnlinePlayers(data) { // Bad jQuery\r\n  $('#fshOutput', context).append(' ' +\r\n    (onlinePages + 1)); // context\r\n  var doc = createDocument(data);\r\n  var input = $('#pCC input.custominput', doc).first();\r\n  var thePage = input.attr('value');\r\n  var theRows = $('#pCC img[src$=\"/skin/icon_action_view.gif',\r\n    doc).parent().parent().parent();\r\n  theRows.each(function(index, element) {\r\n    var tds = $('td', $(element));\r\n    var player = tds.eq(1).text();\r\n    if (onlinePlayers[player] &&\r\n        onlinePlayers[player][3] > thePage) {return;}\r\n    onlinePlayers[player] = [\r\n      tds.eq(0).html(),\r\n      tds.eq(1).html(),\r\n      tds.eq(2).text(),\r\n      thePage,\r\n      index\r\n    ];\r\n  });\r\n  onlinePages += 1;\r\n  if (onlinePages === 1) {\r\n    input = input.parent().text();\r\n    lastPage = parseInt(input.match(/(\\d+)/g)[0], 10);\r\n    for (var i = 2; i <= lastPage; i += 1) {\r\n      retryAjax('index.php?no_mobile=1&cmd=onlineplayers&page=' + i)\r\n        .done(getOnlinePlayers);\r\n    }\r\n  }\r\n  checkLastPage();\r\n}\r\n\r\nfunction refreshEvt() { // Bad jQuery\r\n  $('#fshRefresh', context).hide();\r\n  onlinePages = 0;\r\n  onlinePlayers = {};\r\n  retryAjax('index.php?no_mobile=1&cmd=onlineplayers&page=1')\r\n    .done(getOnlinePlayers);\r\n  setValue('lastOnlineCheck', now);\r\n  $('#fshOutput', context).append('Parsing online players...'); // context\r\n}\r\n\r\nfunction changeLvl(e) { // jQuery\r\n  if (e.target.id === 'fshMinLvl' || e.target.id === 'fshMaxLvl') {\r\n    table.draw();\r\n  }\r\n}\r\n\r\nfunction resetEvt() { // context\r\n  setValue('onlinePlayerMinLvl',\r\n    defaults.onlinePlayerMinLvl);\r\n  setValue('onlinePlayerMaxLvl',\r\n    defaults.onlinePlayerMaxLvl);\r\n  $('#fshMinLvl', context).val(\r\n    defaults.onlinePlayerMinLvl); // context\r\n  $('#fshMaxLvl', context).val(\r\n    defaults.onlinePlayerMaxLvl); // context\r\n  table.draw();\r\n}\r\n\r\nfunction doOnlinePlayerEventHandlers(e) {\r\n  if (e.target.id === 'fshRefresh') {refreshEvt();}\r\n  if (e.target.id === 'fshReset') {resetEvt();}\r\n}\r\n\r\nfunction injectOnlinePlayersNew() { // jQuery\r\n  var lastCheck = getValue('lastOnlineCheck');\r\n  var refreshButton;\r\n  if (now - lastCheck > 300000) {\r\n    refreshButton = '<span> (takes a while to refresh so only do it ' +\r\n      'if you really need to) </span><span id=\"fshRefresh\" class=\"fshLink\"' +\r\n      '>[Refresh]</span>';\r\n  } else {\r\n    refreshButton = '<span>[ Wait ' + Math.round(300 - (now -\r\n      lastCheck) / 1000) + 's ]</span>';\r\n  }\r\n  context.html(\r\n    '<span><b>Online Players</b></span>' + refreshButton +\r\n    '<div id=\"fshOutput\"></div>');\r\n  getForage('fsh_onlinePlayers').done(function(value) {\r\n    onlinePlayers = value || {};\r\n    gotOnlinePlayers();\r\n  });\r\n  context[0].addEventListener('click', doOnlinePlayerEventHandlers);\r\n  context[0].addEventListener('keyup', changeLvl);\r\n}\r\n\r\nexport default function injectOnlinePlayers(content) { // jQuery\r\n  if (jQueryNotPresent()) {return;}\r\n  if (content) {\r\n    context = $(content);\r\n  } else {\r\n    context = $('#pCC');\r\n  }\r\n  injectOnlinePlayersNew();\r\n}\r\n","import getValue from '../system/getValue';\r\nimport playerId from '../common/playerId';\r\nimport setForage from '../ajax/setForage';\r\nimport shouldBeArray from '../system/shouldBeArray';\r\n\r\nvar currentPlayerId;\r\nvar hideRecipes = [];\r\n\r\nfunction getRecipeItems(recipe) {\r\n  if (recipe.items) {\r\n    return recipe.items.reduce(function(prev, itm) {\r\n      return prev + '<div class=\"rmItem\"><img class=\"tip-dynamic\" ' +\r\n        'data-tipped=\"fetchitem.php?item_id=' +\r\n        itm.id + '&inv_id=-1&t=2&p=' +\r\n        currentPlayerId + '&vcode=' +\r\n        itm.verify + '\" src=\"' +\r\n        itm.img + '\" height=\"20px\" width=\"20px\"><p>' +\r\n        itm.amountPresent + '/' +\r\n        itm.amountNeeded + '</p></div>';\r\n    }, '');\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction getComponents(recipe) {\r\n  if (recipe.components) {\r\n    return recipe.components.reduce(function(prev, comp) {\r\n      return prev + '<div class=\"rmItem\"><img class=\"tip-dynamic\" ' +\r\n        'data-tipped=\"fetchitem.php?item_id=' +\r\n        comp.id + '&inv_id=-1&t=2&p=' +\r\n        currentPlayerId + '&vcode=' +\r\n        comp.verify + '\" src=\"' +\r\n        comp.img + '\" height=\"20px\" width=\"20px\"><p>' +\r\n        comp.amountPresent + '/' +\r\n        comp.amountNeeded + '</p></div>';\r\n    }, '');\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction getImg(recipe) {\r\n  if (recipe.target) {\r\n    return ' <img class=\"tip-dynamic\" ' +\r\n      'data-tipped=\"fetchitem.php?item_id=' +\r\n      recipe.target.id + '&inv_id=-1&t=2&p=' + currentPlayerId +\r\n      '&vcode=' + recipe.target.verify + '\" ' +\r\n      'src=\"' + recipe.target.img +\r\n      '\" height=\"30px\" width=\"30px\"><br/>';\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction drawRecipeTable(output, recipebook) { // Legacy\r\n  currentPlayerId = playerId();\r\n  var i;\r\n  var result = '<table width=\"100%\"><tr class=\"rmTh\"><th>Recipe</th>' +\r\n    '<th><span id=\"sortName\" class=\"fshLink\" sortkey=\"name\">Name</span>' +\r\n    '</th><th>Items</th><th>Components</th><th>Target</th></tr>';\r\n  var recipe;\r\n  for (i = 0; i < recipebook.recipe.length; i += 1) {\r\n    recipe = recipebook.recipe[i];\r\n    if (hideRecipes.indexOf(recipe.name) !== -1) {continue;}\r\n    result += '<tr class=\"rmTr\"><td class=\"rmTd\"><a href=\"' + recipe.link +\r\n      '\"><img src=\"' + recipe.img +\r\n      '\" height=\"30px\" width=\"30px\"></a></td><td class=\"rmTd\"><a href=\"' +\r\n      recipe.link + '\">' + recipe.name + '</a></td><td class=\"rmTd\">';\r\n    result += getRecipeItems(recipe);\r\n    result += '</td><td class=\"rmTd\">';\r\n    result += getComponents(recipe);\r\n    result += '</td><td class=\"rmTd\">';\r\n    result += getImg(recipe);\r\n    result += '</td></tr>';\r\n  }\r\n  result += '</table>';\r\n  output.innerHTML = result;\r\n  recipebook.lastUpdate = new Date();\r\n  setForage('fsh_recipeBook', recipebook);\r\n}\r\n\r\nexport default function generateRecipeTable(output, recipebook) { // Legacy\r\n  if (recipebook) {\r\n    if (getValue('hideRecipes')) {\r\n      hideRecipes = shouldBeArray('hideRecipeNames');\r\n    }\r\n    drawRecipeTable(output, recipebook);\r\n  }\r\n}\r\n","import getValue from './getValue';\r\n\r\nexport default function shouldBeArray(pref) {\r\n  var stored = getValue(pref);\r\n  if (stored && stored !== '') {return stored.split(/\\s*,\\s*/);}\r\n  return [];\r\n}\r\n","import createDocument from '../system/createDocument';\r\nimport getCustomUrlParameter from '../system/getCustomUrlParameter';\r\nimport {getElementById} from '../common/getElement';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\nimport retryAjax from '../ajax/retryAjax';\r\n\r\nvar itmRE =\r\n  /fetchitem.php\\?item_id=(\\d+)&inv_id=-1&t=2&p=(\\d+)&vcode=([a-z0-9]+)/i;\r\n\r\nfunction hasAmounts(result, amounts) {\r\n  if (amounts) {\r\n    var resultAmounts = amounts.textContent.split('/');\r\n    result.amountPresent = parseInt(resultAmounts[0], 10);\r\n    result.amountNeeded = parseInt(resultAmounts[1], 10);\r\n  }\r\n}\r\n\r\nfunction reduceItemOrComponent(bgGif, prev, el) {\r\n  var background = el.getAttribute('background');\r\n  if (!background || background.indexOf(bgGif) === -1) {return prev;}\r\n  var img = el.children[0].children[0];\r\n  var mouseOver = img.dataset.tipped;\r\n  var mouseOverRX = mouseOver.match(itmRE);\r\n  var result = {\r\n    img: img.getAttribute('src'),\r\n    id: mouseOverRX[1],\r\n    verify: mouseOverRX[3]\r\n  };\r\n  hasAmounts(result, el.parentNode.nextElementSibling);\r\n  prev.push(result);\r\n  return prev;\r\n}\r\n\r\nfunction parseRecipeItemOrComponent(bgGif, doc) {\r\n  var tblCells = getElementById('pCC', doc).getElementsByTagName('td');\r\n  return Array.prototype.reduce.call(tblCells,\r\n    reduceItemOrComponent.bind(null, bgGif), []);\r\n}\r\n\r\nfunction processRecipe(output, recipebook, recipe, data) {\r\n  var doc = createDocument(data);\r\n  insertHtmlBeforeEnd(output,\r\n    'Parsing blueprint ' + recipe.name + '...<br>');\r\n  recipe.items = parseRecipeItemOrComponent('/inventory/2x3.gif', doc);\r\n  recipe.components = parseRecipeItemOrComponent('/inventory/1x1mini.gif', doc);\r\n  recipe.target = parseRecipeItemOrComponent('/hellforge/2x3.gif', doc)[0];\r\n  recipebook.recipe.push(recipe);\r\n}\r\n\r\nfunction processFolderAnyPage(output, recipebook, data) { // jQuery.min\r\n  var doc = createDocument(data);\r\n  var innerPcc = getElementById('pCC', doc);\r\n  var scope = innerPcc.firstElementChild.rows[6].cells[0]\r\n    .firstElementChild.getElementsByTagName('a');\r\n  var prm = Array.prototype.reduce.call(scope, function(prev, el) {\r\n    insertHtmlBeforeEnd(output,\r\n      'Found blueprint \"' + el.textContent + '\".<br>');\r\n    var recipe = {\r\n      img: el.parentNode.previousElementSibling.firstElementChild\r\n        .getAttribute('src'),\r\n      link: el.href,\r\n      name: el.textContent,\r\n      id: getCustomUrlParameter(el.href, 'recipe_id')\r\n    };\r\n    prev.push(retryAjax(el.href)\r\n      .pipe(processRecipe.bind(null, output, recipebook, recipe)));\r\n    return prev;\r\n  }, []);\r\n  return $.when.apply($, prm);\r\n}\r\n\r\nfunction processFolderFirstPage(output, recipebook, data) { // jQuery.min\r\n  var prm = [];\r\n  var doc = createDocument(data);\r\n  var innerPcc = getElementById('pCC', doc);\r\n  var scope = innerPcc.firstElementChild.rows[4].cells[0]\r\n    .firstElementChild.getElementsByTagName('img');\r\n  var thisFolder = Array.prototype.filter.call(scope, function(el) {\r\n    return /\\/folder_on\\.gif/.test(el.getAttribute('src'));\r\n  })[0];\r\n  var pages = innerPcc.getElementsByClassName('customselect')[0]\r\n    .getElementsByTagName('option').length;\r\n  for (var i = 1; i < pages; i += 1) {\r\n    prm.push(retryAjax(thisFolder.parentNode.href + '&page=' + i)\r\n      .pipe(processFolderAnyPage.bind(null, output, recipebook)));\r\n  }\r\n  prm.push($.when(data)\r\n    .pipe(processFolderAnyPage.bind(null, output, recipebook)));\r\n  return $.when.apply($, prm);\r\n}\r\n\r\nfunction reduceFolders(output, recipebook, prev, el) { // jQuery.min\r\n  var href = el.parentNode.href;\r\n  var folderName = el.parentNode.nextElementSibling.nextElementSibling\r\n    .firstChild.textContent;\r\n  if (getCustomUrlParameter(href, 'folder_id') === '-1') {\r\n    return prev;\r\n  }\r\n  if (/quest/i.test(folderName)) {\r\n    insertHtmlBeforeEnd(output, 'Skipping folder \"' +\r\n      folderName + '\"  as it has the word \"quest\" in folder name.<br>');\r\n    return prev;\r\n  }\r\n  prev.push(retryAjax(href)\r\n    .pipe(processFolderFirstPage.bind(null, output, recipebook)));\r\n  return prev;\r\n}\r\n\r\nexport default function processFirstPage(output, recipebook, data) { // jQuery.min\r\n  var doc = createDocument(data);\r\n  var scope = getElementById('pCC', doc).firstElementChild.rows[4].cells[0]\r\n    .firstElementChild.getElementsByTagName('img');\r\n  var prm = Array.prototype.reduce.call(scope,\r\n    reduceFolders.bind(null, output, recipebook), []);\r\n  prm.push($.when(data)\r\n    .pipe(processFolderFirstPage.bind(null, output, recipebook)));\r\n  return $.when.apply($, prm);\r\n}\r\n","import {createDiv} from '../common/cElement';\r\nimport generateRecipeTable from './generateRecipeTable';\r\nimport insertElement from '../common/insertElement';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\nimport processFirstPage from './processFirstPage';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport setForage from '../ajax/setForage';\r\n\r\nexport var recipebook;\r\nexport var output;\r\n\r\nfunction displayStuff() {\r\n  insertHtmlBeforeEnd(output, 'Finished parsing ... formatting ...');\r\n  setForage('fsh_recipeBook', recipebook);\r\n  generateRecipeTable(output, recipebook);\r\n}\r\n\r\nexport function parseInventingStart() { // jQuery.min\r\n  recipebook = {};\r\n  recipebook.recipe = [];\r\n  output.innerHTML = '<br>Parsing inventing screen ...<br>';\r\n  retryAjax('index.php?no_mobile=1&cmd=inventing')\r\n    .pipe(processFirstPage.bind(null, output, recipebook))\r\n    .done(displayStuff);\r\n}\r\n\r\nexport function gotRecipeBook(content, data) {\r\n  recipebook = data;\r\n  content.innerHTML = '<table class=\"fshInvFilter\"><thead><tr>' +\r\n    '<th width=\"90%\"><b>&nbsp;Recipe Manager</b></th>' +\r\n    '<th width=\"10%\" class=\"fshBtnBox\">[' +\r\n    '<span id=\"rfsh\" class=\"fshLink\">' +\r\n    'Refresh</span>]</th>' +\r\n    '</tr></thead></table>';\r\n  output = createDiv();\r\n  insertElement(content, output);\r\n  if (!recipebook) {\r\n    parseInventingStart();\r\n  } else {\r\n    generateRecipeTable(output, recipebook);\r\n  }\r\n}\r\n","import outputResult from './outputResult';\r\n\r\nvar lastMsg;\r\n\r\nfunction notSeenErrorMessage(json) {\r\n  return !json.s && lastMsg !== json.e.message;\r\n}\r\n\r\nexport default function jsonFail(json, handle) {\r\n  if (notSeenErrorMessage(json)) {\r\n    lastMsg = json.e.message;\r\n    outputResult(json.e.message, handle);\r\n  }\r\n  if (!json.s) {return true;}\r\n}\r\n","import {createTable} from './common/cElement';\r\nimport eventHandler from './common/eventHandler';\r\nimport {getElementById} from './common/getElement';\r\nimport getInventory from './ajax/getInventory';\r\nimport {imageServer} from './system/system';\r\nimport insertElement from './common/insertElement';\r\nimport jConfirm from './common/jConfirm';\r\nimport jQueryNotPresent from './common/jQueryNotPresent';\r\nimport jsonFail from './common/jsonFail';\r\nimport outputResult from './common/outputResult';\r\nimport {pCC} from './support/layout';\r\nimport useitem from './app/profile/useitem';\r\n\r\nvar extTbl;\r\nvar playerId;\r\nvar extractInv;\r\nvar selectST;\r\nvar selectMain;\r\nvar resourceList;\r\nvar buyResult;\r\n\r\nfunction backpackRemove(invId) {\r\n  extractInv.some(function(el, i, ary) {\r\n    if (el.inv_id === invId) {\r\n      ary.splice(i, 1);\r\n      return true;\r\n    }\r\n    return false;\r\n  });\r\n}\r\n\r\nfunction quickDoneExtracted(invId, json) {\r\n  if (jsonFail(json, buyResult)) {return;}\r\n  backpackRemove(invId);\r\n  outputResult('Item Extracted.', buyResult);\r\n}\r\n\r\nfunction doExtract(target) {\r\n  var InventoryIDs = resourceList[target.id.replace('fshExtr', '')].invIDs;\r\n  target.parentNode.innerHTML = 'extracting all ' +\r\n    InventoryIDs.length + ' resources';\r\n  for (var i = 0; i < InventoryIDs.length; i += 1) {\r\n    useitem(InventoryIDs[i])\r\n      .done(quickDoneExtracted.bind(null, InventoryIDs[i]));\r\n  }\r\n}\r\n\r\nfunction extractAllSimilar(self) {\r\n  jConfirm('Extract Resources',\r\n    'Are you sure you want to extract all similar items?',\r\n    doExtract.bind(null, self)\r\n  );\r\n}\r\n\r\nfunction inMain(item) {\r\n  return selectMain && item.folder_id !== -1;\r\n}\r\n\r\nfunction inSt(item) {\r\n  return !selectST && item.is_in_st;\r\n}\r\n\r\nfunction checkFlags(item) {\r\n  return inMain(item) || inSt(item);\r\n}\r\n\r\nfunction resources(prev, item) {\r\n  if (checkFlags(item)) {return prev;}\r\n  if (prev[item.item_id]) {\r\n    prev[item.item_id].invIDs.push(item.inv_id);\r\n  } else {\r\n    prev[item.item_id] = {\r\n      invIDs: [item.inv_id],\r\n      inv_id: item.inv_id,\r\n      item_name: item.item_name\r\n    };\r\n  }\r\n  return prev;\r\n}\r\n\r\nfunction tableRows(prev, item_id) {\r\n  var res = resourceList[item_id];\r\n  return prev + '<tr><td class=\"fshCenter\"><span class=\"smallLink\"' +\r\n    ' id=\"fshExtr' + item_id +\r\n    '\">Extract all ' + res.invIDs.length + '</span></td>' +\r\n    '<td><img src=\"' + imageServer + '/items/' +\r\n    item_id + '.gif\" class=\"tip-dynamic\" data-tipped=\"' +\r\n    'fetchitem.php?item_id=' + item_id + '&inv_id=' +\r\n    res.inv_id + '&t=1&p=' + playerId +\r\n    '\" border=0></td><td>' + res.item_name + '</td></tr>';\r\n}\r\n\r\nfunction showQuickExtract() {\r\n  resourceList = extractInv.reduce(resources, {});\r\n  var output = '<tr><th width=\"20%\">Actions</th><th>Items</th></tr>' +\r\n    '<tr><td colspan=\"2\"><ol id=\"qeresult\"></ol></td></tr>';\r\n  output += Object.keys(resourceList).reduce(tableRows, '');\r\n  extTbl.innerHTML = output;\r\n  buyResult = getElementById('qeresult');\r\n}\r\n\r\nfunction isExtractable(curr) {\r\n  return curr.item_name === 'Zombie Coffin' ||\r\n    curr.type === 12 ||\r\n    curr.type === 16;\r\n}\r\n\r\nfunction prepInv(data) {\r\n  playerId = data.player_id;\r\n  extractInv = data.items.reduce(function(prev, curr) {\r\n    if (isExtractable(curr)) {prev.push(curr);}\r\n    return prev;\r\n  }, []);\r\n  showQuickExtract();\r\n}\r\n\r\nvar extractEvents = [\r\n  {\r\n    test: function(self) {return self.id === 'fshInSt';},\r\n    act: function() {\r\n      selectST = !selectST;\r\n      showQuickExtract();\r\n    }\r\n  },\r\n  {\r\n    test: function(self) {return self.id === 'fshInMain';},\r\n    act: function() {\r\n      selectMain = !selectMain;\r\n      showQuickExtract();\r\n    }\r\n  },\r\n  {\r\n    test: function(self) {return self.id.indexOf('fshExtr') === 0;},\r\n    act: extractAllSimilar\r\n  }\r\n];\r\n\r\nexport default function insertQuickExtract(injector) { // jQuery.min\r\n  if (jQueryNotPresent()) {return;}\r\n  var content = injector || pCC;\r\n  content.innerHTML = '<div class=\"qeHead\"><b>Quick Extract</b></div>' +\r\n    'Select which type of plants you wish to extract all of. Only ' +\r\n    'select extractable resources.<br>' +\r\n    '<label><input type=\"checkbox\" id=\"fshInSt\" checked>' +\r\n    ' Select items in ST</label>&nbsp;&nbsp;' +\r\n    '<label><input type=\"checkbox\" id=\"fshInMain\" checked>' +\r\n    ' Only extract items in Main Folder</label>';\r\n  extTbl = createTable({width: '100%'});\r\n  insertElement(content, extTbl);\r\n  selectST = true;\r\n  selectMain = true;\r\n  content.addEventListener('click', eventHandler(extractEvents));\r\n  getInventory().done(prepInv);\r\n}\r\n","import doSortParams from '../common/doSortParams';\r\nimport generateRecipeTable from './generateRecipeTable';\r\nimport getForage from '../ajax/getForage';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport numberSort from '../system/numberSort';\r\nimport {pCC} from '../support/layout';\r\nimport stringSort from '../system/stringSort';\r\nimport {\r\n  gotRecipeBook,\r\n  output,\r\n  parseInventingStart,\r\n  recipebook\r\n} from './parseInventing';\r\n\r\nfunction testSortType(evt) {\r\n  var sortType = evt.target.getAttribute('sorttype');\r\n  if (!sortType) {sortType = 'string';}\r\n  sortType = sortType.toLowerCase();\r\n  return sortType;\r\n}\r\n\r\nfunction sortRecipeBook(sortType) {\r\n  if (sortType === 'number') {\r\n    recipebook.recipe.sort(numberSort);\r\n  } else {\r\n    recipebook.recipe.sort(stringSort);\r\n  }\r\n}\r\n\r\nfunction sortRecipeTable(evt) { // Legacy\r\n  doSortParams(evt.target.getAttribute('sortKey'));\r\n  var sortType = testSortType(evt);\r\n  sortRecipeBook(sortType);\r\n  generateRecipeTable(output, recipebook);\r\n}\r\n\r\nfunction rmEvtHdl(evt) {\r\n  if (evt.target.id === 'rfsh') {\r\n    parseInventingStart();\r\n  }\r\n  if (evt.target.id === 'sortName') {\r\n    sortRecipeTable(evt);\r\n  }\r\n}\r\n\r\nexport default function injectRecipeManager(injector) { // jQuery.min\r\n  if (jQueryNotPresent()) {return;}\r\n  var content = injector || pCC;\r\n  getForage('fsh_recipeBook').done(gotRecipeBook.bind(null, content));\r\n  content.addEventListener('click', rmEvtHdl);\r\n}\r\n","export default function eventHandler(evtAry) {\r\n  return function(evt) {\r\n    var self = evt.target;\r\n    evtAry.some(function(el) {\r\n      if (el.test(self)) {\r\n        el.act(self);\r\n        return true;\r\n      }\r\n      return false;\r\n    });\r\n  };\r\n}\r\n","import calf from '../support/calf';\r\nimport retryAjax from './retryAjax';\r\n\r\nexport default function getInventory() {\r\n  var subcmd = 'inventory';\r\n  if (calf.subcmd === 'guildinvmgr') {\r\n    subcmd = 'guild_store&inc_tagged=1';\r\n  }\r\n  return retryAjax({\r\n    dataType: 'json',\r\n    url: 'index.php?cmd=export&subcmd=' + subcmd\r\n  });\r\n}\r\n","import insertHtmlBeforeEnd from './insertHtmlBeforeEnd';\r\n\r\nexport default function outputResult(result, handle) {\r\n  insertHtmlBeforeEnd(handle,\r\n    '<li class=\"fshNbrList\">' + result + '</li>');\r\n}\r\n","import callApp from '../callApp';\r\n\r\nexport default function useitem(item) {\r\n  return callApp({\r\n    cmd: 'profile',\r\n    subcmd: 'useitem',\r\n    inventory_id: item\r\n  });\r\n}\r\n","import {beginFolderSpanElement} from '../support/constants';\r\nimport {imageServer} from '../system/system';\r\nimport insertElement from '../common/insertElement';\r\nimport playerId from '../common/playerId';\r\nimport {createDiv, createTBody, createTable} from '../common/cElement';\r\n\r\nfunction alpha(a, b) {\r\n  if (a.n.toLowerCase() < b.n.toLowerCase()) {return -1;}\r\n  if (a.n.toLowerCase() > b.n.toLowerCase()) {return 1;}\r\n  return 0;\r\n}\r\n\r\nfunction isUseable(item) {\r\n  if ([10, 12, 15, 16].indexOf(item.t) !== -1 ||\r\n      item.n === 'Zombie Coffin') {\r\n    return 'smallLink';\r\n  }\r\n  return 'notLink';\r\n}\r\n\r\nfunction itemImage(item) {\r\n  var ret = imageServer + '/';\r\n  if (item.b === 13699) {\r\n    ret += 'composing/potions/' + item.extra.design + '_' +\r\n      item.extra.color + '.gif';\r\n  } else {\r\n    ret += 'items/' + item.b + '.gif';\r\n  }\r\n  return ret;\r\n}\r\n\r\nfunction tableRows(tbl, currentPlayerId, item) {\r\n  var newRow = tbl.insertRow(-1);\r\n  item.dom = newRow;\r\n  var equipClass = 'fshEq ';\r\n  var useClass = 'fshUse ';\r\n  if (item.t < 9) {equipClass += 'smallLink';} else {equipClass += 'notLink';}\r\n  useClass += isUseable(item);\r\n  newRow.innerHTML = '<td class=\"fshCenter\"><span class=\"' + equipClass +\r\n    '\" data-itemid=\"' + item.a + '\">Wear</span>&nbsp;|&nbsp;<span class=\"' +\r\n    useClass + '\" data-itemid=\"' + item.a +\r\n    '\">Use/Ext</span></td><td><img src=\"' + itemImage(item) +\r\n    '\" class=\"tip-dynamic\" data-tipped=\"fetchitem.php?item_id=' + item.b +\r\n    '&amp;inv_id=' + item.a + '&amp;t=1&amp;p=' + currentPlayerId +\r\n    '&amp;currentPlayerId=' + currentPlayerId +\r\n    '\" width=\"30\" height=\"30\" border=\"0\"></td><td width=\"90%\">&nbsp;' +\r\n    item.n + '</td>';\r\n}\r\n\r\nfunction makeFolderSpans(appInv) {\r\n  return beginFolderSpanElement + '0\">All</span>' +\r\n    appInv.r.reduce(function(prev, folderObj) {\r\n      return prev + ' &ensp;' + beginFolderSpanElement +\r\n        folderObj.id.toString() + '\">' + folderObj.name + '</span>';\r\n    }, '');\r\n}\r\n\r\nexport default function createQuickWear(appInv) {\r\n  var currentPlayerId = playerId();\r\n  var tbl = createTable({\r\n    width: '100%',\r\n    innerHTML: '<thead><tr><th class=\"fshCenter\" colspan=\"3\">' +\r\n      makeFolderSpans(appInv) + '</th></tr>' +\r\n      '<tr class=\"fshHeader\"><th class=\"fshCenter\" width=\"20%\">Actions</th>' +\r\n      '<th colspan=\"2\">Items</th></tr></thead>'\r\n  });\r\n  var tbody = createTBody();\r\n  insertElement(tbl, tbody);\r\n  appInv.r.forEach(function(aFolder) {\r\n    aFolder.items.sort(alpha);\r\n    aFolder.items.forEach(tableRows.bind(null, tbody, currentPlayerId));\r\n  });\r\n  var qw = createDiv({\r\n    id: 'invTabs-qw',\r\n    className: 'ui-tabs-panel ui-corner-bottom'\r\n  });\r\n  insertElement(qw, tbl);\r\n  return qw;\r\n}\r\n","export default function dialog(data) {\r\n  if (data.r === 0) {return;}\r\n  $('#dialog_msg').html(data.m).dialog('open');\r\n}\r\n","import dialog from './dialog';\r\nimport retryAjax from './retryAjax';\r\n\r\nexport default function equipItem(backpackInvId) {\r\n  return retryAjax({\r\n    url: 'index.php',\r\n    data: {\r\n      cmd: 'profile',\r\n      subcmd: 'equipitem',\r\n      inventory_id: backpackInvId,\r\n      ajax: 1\r\n    },\r\n    dataType: 'json'\r\n  }).done(dialog);\r\n}\r\n","import {createDiv} from '../common/cElement';\r\nimport getValueJSON from '../system/getValueJSON';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\n\r\nfunction ahLink(searchname, nickname) {\r\n  return '<a href=\"index.php?cmd=auctionhouse&search=' + searchname +\r\n    '\">' + nickname + '</a>';\r\n}\r\n\r\nfunction foundInvItem(invCount, name) {\r\n  if (invCount[name]) {\r\n    invCount[name].count += 1;\r\n  } else {\r\n    invCount[name] = {count: 1, nicknameList: []};\r\n  }\r\n}\r\n\r\nfunction displayFoundCount(invCount) {\r\n  return Object.keys(invCount).reduce(function(prev, key) {\r\n    if (invCount[key].nicknameList.length !== 0) {\r\n      return prev + '<tr><td>' + key + '</td><td>' +\r\n        invCount[key].nicknameList.map(function(nickname) {\r\n          return ahLink(key, nickname);\r\n        }).join(' ') + '</td><td>' +\r\n        invCount[key].count + '</td><td></td><td></td></tr>';\r\n    }\r\n    return prev;\r\n  }, '');\r\n}\r\n\r\nfunction displayNotFound(quickSL) {\r\n  return quickSL.reduce(function(prev, item) {\r\n    if (item.displayOnAH && !item.found) {\r\n      return prev + ahLink(item.searchname, item.nickname) + ', ';\r\n    }\r\n    return prev;\r\n  }, '');\r\n}\r\n\r\nfunction displayOtherCount(invCount) {\r\n  return Object.keys(invCount).reduce(function(prev, key) {\r\n    if (invCount[key].nicknameList.length === 0) {\r\n      return prev + '<tr><td>' + key + '</td><td></td><td>' +\r\n        invCount[key].count + '</td><td></td><td></td><td></td></tr>';\r\n    }\r\n    return prev;\r\n  }, '');\r\n}\r\n\r\nfunction buildHTML(invCount, quickSL) {\r\n  // TODO this is going to need significant rebuild\r\n  return '<table width=\"100%\" cellspacing=\"2\" cellpadding=\"2\"><thead>' +\r\n    '<tr><th colspan=\"5\" class=\"fshCenter\">Items from ' +\r\n    '<a href=\"index.php?cmd=notepad&blank=1&subcmd=auctionsearch\">' +\r\n    'AH Quick Search</a> found in your inventory</th></tr>' +\r\n    '<tr><th>Name</th><th>Nick Name</th><th>Inv Count</th>' +\r\n    '<th>AH Min Price</th><th>AH BuyNow Price</th></tr></thead><tbody>' +\r\n    // show inv & counter for item with nickname found\r\n    displayFoundCount(invCount) +\r\n    // show item from quick AH search that are not in our inv\r\n    '<tr><td colspan=\"5\"><hr></td></tr>' +\r\n    '<tr><td>Did not find:</td><td colspan=\"4\">' +\r\n    displayNotFound(quickSL) +\r\n    '</td></tr><tr><td colspan=\"5\"><hr></td></tr></tbody>' +\r\n    '<thead><tr><th colspan=\"5\" class=\"fshCenter\">Items NOT from ' +\r\n    '<a href=\"index.php?cmd=notepad&blank=1&subcmd=auctionsearch\">' +\r\n    'AH Quick Search</a> found in your inventory</td></thead><tbody>' +\r\n    // show inv & counter for item with nickname NOT found\r\n    displayOtherCount(invCount) +\r\n    '</tbody></table>';\r\n}\r\n\r\nfunction inQuickSearchList(invCount, name, listItem) {\r\n  if (name === listItem.searchname) {\r\n    listItem.found = true;\r\n    if (invCount[name].nicknameList.indexOf(listItem.nickname) < 0) {\r\n      invCount[name].nicknameList.push(listItem.nickname);\r\n    }\r\n  }\r\n}\r\n\r\nfunction testItemList(invCount, quickSL, item) {\r\n  var name = item.n;\r\n  foundInvItem(invCount, name);\r\n  quickSL.forEach(inQuickSearchList.bind(null, invCount, name));\r\n}\r\n\r\nexport default function showAHInvManager(itemList) {\r\n  var invCount = {};\r\n  var quickSL = getValueJSON('quickSearchList');\r\n  // fill up the Inv Counter\r\n  itemList.r.forEach(function(aFolder) {\r\n    aFolder.items.forEach(testItemList.bind(null, invCount, quickSL));\r\n  });\r\n  var im = createDiv({\r\n    id: 'invTabs-ah',\r\n    className: 'ui-tabs-panel ui-corner-bottom'\r\n  });\r\n  insertHtmlBeforeEnd(im, buildHTML(invCount, quickSL));\r\n  return im;\r\n}\r\n","export default function isChecked(pref) {\r\n  if (pref) {return ' checked';}\r\n  return '';\r\n}\r\n","/* eslint-disable max-lines */\r\nexport default {\r\n  moveGuildList: {\r\n    helpTitle: 'Move Guild Info List',\r\n    helpText: 'This will Move the Guild Info List higher ' +\r\n      'on the bar on the right'\r\n  },\r\n  moveOnlineAlliesList: {\r\n    helpTitle: 'Move Online Allies List',\r\n    helpText: 'This will Move the Online Allies List higher ' +\r\n      'on the bar on the right'\r\n  },\r\n  enableOnlineAlliesWidgets: {\r\n    helpTitle: 'Enable Online Allies Widgets',\r\n    helpText: 'Enabling this option will enable the Allies List ' +\r\n      'Widgets (coloring on the Allies List panel)'\r\n  },\r\n  moveFSBox: {\r\n    helpTitle: 'Move FS box',\r\n    helpText: 'This will move the FS box to the left, under the menu, ' +\r\n      'for better visibility (unless it is already hidden.)'\r\n  },\r\n  moveDailyQuest: {\r\n    helpTitle: 'Move Daily Quest',\r\n    helpText: 'This will move the Daily Quest to the left, under the menu, ' +\r\n      'for better visibility (unless it is already hidden.)'\r\n  },\r\n  gameHelpLink: {\r\n    helpTitle: '&quot;Game Help&quot; Settings Link',\r\n    helpText: 'This turns the Game Help text in the lower ' +\r\n      'right box into a link to this settings page.'\r\n  },\r\n  enableTempleAlert: {\r\n    helpTitle: 'Enable Temple Alert',\r\n    helpText: 'Puts an alert on the LHS if you have not ' +\r\n      'prayed at the temple today.',\r\n    network: true\r\n  },\r\n  enableUpgradeAlert: {\r\n    helpTitle: 'Enable Gold Upgrade Alert',\r\n    helpText: 'Puts an alert on the LHS if you have not upgraded your ' +\r\n      'stamina with gold today.',\r\n    network: true\r\n  },\r\n  enableComposingAlert: {\r\n    helpTitle: 'Enable Composing Alert',\r\n    helpText: 'Puts an alert on the LHS if you have composing ' +\r\n      'slots available.',\r\n    network: true\r\n  },\r\n  enhanceOnlineDots: {\r\n    helpTitle: 'Enhance Online Dots',\r\n    helpText: 'Enhances the green/grey dots by player names to show ' +\r\n      'online/offline status.'\r\n  },\r\n  hideBuffSelected: {\r\n    helpTitle: 'Hide Buff Selected',\r\n    helpText: 'Hides the buff selected functionality in the online allies ' +\r\n      'and guild info section.'\r\n  },\r\n  hideHelperMenu: {\r\n    helpTitle: 'Hide Helper Menu',\r\n    helpText: 'Hides the helper menu from top left.'\r\n  },\r\n  keepHelperMenuOnScreen: {\r\n    helpTitle: 'Keep Helper Menu On Screen',\r\n    helpText: 'Keeps helper menu on screen as you scroll (helper ' +\r\n      'menu must be enabled to work). Also works with quick links.'\r\n  },\r\n  showAdmin: {\r\n    helpTitle: 'Show rank controls',\r\n    helpText: 'Show ranking controls for guild managemenet in member ' +\r\n      'profile page - this works for guild founders only'\r\n  },\r\n  ajaxifyRankControls: {\r\n    helpTitle: 'AJAXify rank controls',\r\n    helpText: 'Enables guild founders with ranking rights to change rank ' +\r\n      'positions without a screen refresh.'\r\n  },\r\n  detailedConflictInfo: {\r\n    helpTitle: 'Show Conflict Details',\r\n    helpText: 'Inserts detailed conflict information onto your guild\\'s ' +\r\n      'manage page. Currently displays the target guild as well as ' +\r\n      'the current score.',\r\n    network: true\r\n  },\r\n  showCombatLog: {\r\n    helpTitle: 'Show Combat Log',\r\n    helpText: 'This will show the combat log for each automatic ' +\r\n      'battle below the monster list.'\r\n  },\r\n  enableCreatureColoring: {\r\n    helpTitle: 'Color Special Creatures',\r\n    helpText: 'Creatures will be colored according to their rarity. ' +\r\n      'Champions will be colored green, Elites yellow and Super Elites red.'\r\n  },\r\n  showCreatureInfo: {\r\n    helpTitle: 'Show Creature Info',\r\n    helpText: 'This will show the information from the view creature ' +\r\n      'link when you mouseover the link.',\r\n    network: true\r\n  },\r\n  fsboxlog: {\r\n    helpTitle: 'Enable FS Box Log',\r\n    helpText: 'This enables the functionality to keep a log of ' +\r\n      'recent seen FS Box message.'\r\n  },\r\n  keepBuffLog: {\r\n    helpTitle: 'Enable Buff Log',\r\n    helpText: 'This enables the functionality to keep a log of ' +\r\n      'recently casted buffs'\r\n  },\r\n  huntingMode: {\r\n    helpTitle: 'Enable Hunting Mode',\r\n    helpText: 'This disable menu and some visual features to ' +\r\n      'speed up the calf.'\r\n  },\r\n  hideNonPlayerGuildLogMessages: {\r\n    helpTitle: 'Cleanup Guild Log',\r\n    helpText: 'Any log messages not related to the current player ' +\r\n      'will be dimmed (e.g. recall messages from guild store)'\r\n  },\r\n  useNewGuildLog: {\r\n    helpTitle: 'Use New Guild Log',\r\n    helpText: 'This will replace the standard guild log with the ' +\r\n      'helper version of the guild log.'\r\n  },\r\n  enableLogColoring: {\r\n    helpTitle: 'Enable Log Coloring',\r\n    helpText: 'Three logs will be colored if this is enabled, ' +\r\n      'Guild Chat, Guild Log and Player Log. It will show any new ' +\r\n      'messages in yellow and anything 20 minutes old ones in brown.'\r\n  },\r\n  enableChatParsing: {\r\n    helpTitle: 'Enable Chat Parsing',\r\n    helpText: 'If this is checked, your character log will be parsed for ' +\r\n      'chat messages and show the chat message on the screen if you reply ' +\r\n      'to that message.'\r\n  },\r\n  addAttackLinkToLog: {\r\n    helpTitle: 'Add attack link to log',\r\n    helpText: 'If checked, this will add an Attack link to each message ' +\r\n      'in your log.'\r\n  },\r\n  enhanceChatTextEntry: {\r\n    helpTitle: 'Enhance Chat Text Entry',\r\n    helpText: 'If checked, this will enhance the entry field for entering ' +\r\n      'chat text on the guild chat page.'\r\n  },\r\n  showExtraLinks: {\r\n    helpTitle: 'Show Extra Links',\r\n    helpText: 'If checked, this will add AH and UFSG ' +\r\n      'links to equipment screens.'\r\n  },\r\n  disableItemColoring: {\r\n    helpTitle: 'Disable Item Coloring',\r\n    helpText: 'Disable the code that colors the item text based on the ' +\r\n      'rarity of the item.'\r\n  },\r\n  showQuickDropLinks: {\r\n    helpTitle: 'Show Quick Drop Item',\r\n    helpText: 'This will show a link beside each item which gives the ' +\r\n      'option to drop the item.  WARNING: NO REFUNDS ON ERROR'\r\n  },\r\n  storeLastQuestPage: {\r\n    helpTitle: 'Store Last Quest Page',\r\n    helpText: 'This will store the page and sort order of each of the ' +\r\n      'three quest selection pages for next time you visit. If you need ' +\r\n      'to reset the links, turn this option off, click on the link you ' +\r\n      'wish to reset and then turn this option back on again.'\r\n  },\r\n  showNextQuestSteps: {\r\n    helpTitle: 'Show Next Quest Steps',\r\n    helpText: 'Shows all quest steps in the UFSG.'\r\n  },\r\n  renderSelfBio: {\r\n    helpTitle: 'Render self bio',\r\n    helpText: 'This determines if your own bio will render the FSH ' +\r\n      'special bio tags.'\r\n  },\r\n  renderOtherBios: {\r\n    helpTitle: 'Render other players&#39; bios',\r\n    helpText: 'This determines if other players bios will render the FSH ' +\r\n      'special bio tags.'\r\n  },\r\n  showStatBonusTotal: {\r\n    helpTitle: 'Show Stat Bonus Total',\r\n    helpText: 'This will show a total of the item stats when you ' +\r\n      'mouseover an item on the profile screen.'\r\n  },\r\n  enableQuickDrink: {\r\n    helpTitle: 'Enable Quick Drink/Wear',\r\n    helpText: 'This enables the quick drink/wear functionality on the ' +\r\n      'profile page.'\r\n  },\r\n  disableDeactivatePrompts: {\r\n    helpTitle: 'Disable Deactivate Prompts',\r\n    helpText: 'This disables the prompts for deactivating buffs on ' +\r\n      'the profile page.'\r\n  },\r\n  enableAttackHelper: {\r\n    helpTitle: 'Show Attack Helper',\r\n    helpText: 'This will show extra information on the attack player ' +\r\n      'screen about stats and buffs on you and your target',\r\n    network: true\r\n  },\r\n  showPvPSummaryInLog: {\r\n    helpTitle: 'Show PvP Summary in Log',\r\n    helpText: 'This will show a summary of the PvP results in the log.',\r\n    network: true\r\n  },\r\n  autoFillMinBidPrice: {\r\n    helpTitle: 'Auto Fill Min Bid Price',\r\n    helpText: 'This enables the functionality to automatically fill in ' +\r\n      'the min bid price so you just have to hit bid and your bid will ' +\r\n      'be placed.'\r\n  },\r\n  hideRelicOffline: {\r\n    helpTitle: 'Hide Relic Offline',\r\n    helpText: 'This hides the relic offline defenders checker.'\r\n  },\r\n  enterForSendMessage: {\r\n    helpTitle: 'Enter Sends Message',\r\n    helpText: 'If enabled, will send a message from the Send Message ' +\r\n      'screen if you press enter. You can still insert a new line by ' +\r\n      'holding down shift when you press enter.'\r\n  },\r\n  navigateToLogAfterMsg: {\r\n    helpTitle: 'Navigate After Message Sent',\r\n    helpText: 'If enabled, will navigate to the referring page after a ' +\r\n      'successful message is sent. Example:  if you are on the world ' +\r\n      'screen and hit message on the guild info panel after you send the ' +\r\n      'message, it will return you to the world screen.'\r\n  },\r\n  moveComposingButtons: {\r\n    helpTitle: 'Move Composing Buttons',\r\n    helpText: 'If enabled, will move composing buttons to the top of ' +\r\n      'the composing screen.'\r\n  },\r\n  draggableHelperMenu: {\r\n    helpTitle: 'Draggable Helper Menu',\r\n    helpText: 'If enabled, allows the helper menu to ' +\r\n      'be dragged around the screen.'\r\n  },\r\n  draggableQuickLinks: {\r\n    helpTitle: 'Draggable Quick Links',\r\n    helpText: 'If enabled, allows the quick link box to ' +\r\n      'be dragged around the screen.'\r\n  },\r\n  expandMenuOnKeyPress: {\r\n    helpTitle: 'Expand Menu on Key Press',\r\n    helpText: 'If enabled, expands the left hand menu ' +\r\n      'when you use hotkeys.'\r\n  },\r\n  disableBreakdownPrompts: {\r\n    helpTitle: 'Disable Breakdown Prompts',\r\n    helpText: 'If enabled, will disable prompts when you breakdown items.' +\r\n      '<br>NO REFUNDS OR DO-OVERS! Use at own risk.'\r\n  },\r\n  collapseNewsArchive: {\r\n    helpTitle: 'Collapse News Archive',\r\n    helpText: 'If enabled, will collapse news archives.'\r\n  },\r\n  collapseHallPosts: {\r\n    helpTitle: 'Collapse Hall Posts',\r\n    helpText: 'If enabled, will collapse hall posts.'\r\n  },\r\n  hideSubLvlCreature: {\r\n    helpTitle: 'Hide Sub Level Creatures',\r\n    helpText: 'If enabled, will hide creatures that are ' +\r\n      'lower than the current realm level.'\r\n  },\r\n  hidePlayerActions: {\r\n    helpTitle: 'Hide Player Actions',\r\n    helpText: 'If enabled, will hide player actions.'\r\n  },\r\n  disableQuickWearPrompts: {\r\n    helpTitle: 'Disable Use/Ext Prompts',\r\n    helpText: 'If enabled, will disable prompts when you Use/Ext items.' +\r\n      '<br>NO REFUNDS OR DO-OVERS! Use at own risk.',\r\n    title: 'Disable Use/Ext<br>Prompts'\r\n  },\r\n  enableGuildActivityTracker: {\r\n    helpTitle: 'Enable Guild Activity Tracker',\r\n    helpText: 'If enabled, will track guild member activity over time.',\r\n    network: true,\r\n    title: 'Enable Tracker'\r\n  },\r\n  enableSeTracker: {\r\n    helpTitle: 'Enable SE Tracker',\r\n    helpText: 'If enabled, will track the last time each SE was killed.<br>' +\r\n      'This is DIFFERENT from the usual FSH network activity.<br>' +\r\n      'When this is enabled, if you have ANY game page open in a<br>' +\r\n      'browser tab it will scan the SE Log every 10 minutes.<br>' +\r\n      'You do not need auto-refresh for this to work.',\r\n    network: true\r\n  },\r\n  showMonsterLog: {\r\n    helpTitle: 'Keep Creature Log',\r\n    helpText: 'This will show the creature log for each creature you see ' +\r\n      'when you travel.',\r\n    network: true\r\n  },\r\n  showTitanInfo: {\r\n    helpTitle: 'Show Titan Info',\r\n    helpText: 'This will show titan info in the action list.',\r\n    network: true\r\n  },\r\n  wantedGuildMembers: {\r\n    helpTitle: 'Show Guild Members',\r\n    helpText: 'If enabled, will show guild members in the wanted bounty list.'\r\n  }\r\n};\r\n","import {createDiv} from '../common/cElement';\r\nimport createQuickWear from './createQuickWear';\r\nimport equipItem from '../ajax/equipItem';\r\nimport eventHandler from '../common/eventHandler';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport insertElement from '../common/insertElement';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\nimport jConfirm from '../common/jConfirm';\r\nimport jQueryPresent from '../common/jQueryPresent';\r\nimport loadInventory from '../app/profile/loadInventory';\r\nimport {pCC} from '../support/layout';\r\nimport {sendEvent} from '../support/fshGa';\r\nimport setValue from '../system/setValue';\r\nimport showAHInvManager from './showAHInvManager';\r\nimport {simpleCheckboxHtml} from '../settings/simpleCheckbox';\r\nimport toggleForce from '../common/toggleForce';\r\nimport useItem from '../ajax/useItem';\r\n\r\nvar disableQuickWearPrompts;\r\nvar content;\r\nvar itemList;\r\n\r\nfunction doAction(self, fn, verb) { // jQuery.min\r\n  sendEvent('QuickWear', 'doAction');\r\n  self.textContent = '';\r\n  self.classList.remove('smallLink');\r\n  self.classList.add('fshSpinner', 'fshSpin12');\r\n  fn(self.dataset.itemid).done(function(data) {\r\n    if (data.r !== 0) {return;}\r\n    self.parentNode.innerHTML = '<span class=\"fastWorn\">' + verb + '</span>';\r\n  });\r\n}\r\n\r\nfunction doUseItem(self) {\r\n  doAction(self, useItem, 'Used');\r\n}\r\n\r\nfunction useProfileInventoryItem(self) {\r\n  if (disableQuickWearPrompts) {\r\n    doUseItem(self);\r\n  } else {\r\n    jConfirm('Use/Extract Item',\r\n      'Are you sure you want to use/extract the item?',\r\n      doUseItem.bind(null, self)\r\n    );\r\n  }\r\n}\r\n\r\nfunction equipProfileInventoryItem(self) {\r\n  doAction(self, equipItem, 'Worn');\r\n}\r\n\r\nfunction processItems(folderId, thisFolder, o) {\r\n  var tr = o.dom;\r\n  if (folderId === '0') {\r\n    tr.classList.remove('fshHide');\r\n  } else {\r\n    var force = folderId !== thisFolder.toString();\r\n    toggleForce(tr, force);\r\n  }\r\n}\r\n\r\nfunction processFolder(folderId, aFolder) {\r\n  var thisFolder = aFolder.id;\r\n  aFolder.items.forEach(processItems.bind(null, folderId, thisFolder));\r\n}\r\n\r\nfunction hideFolders(self) {\r\n  var folderId = self.dataset.folder;\r\n  itemList.r.forEach(processFolder.bind(null, folderId));\r\n}\r\n\r\nfunction togglePref() {\r\n  disableQuickWearPrompts = !disableQuickWearPrompts;\r\n  setValue('disableQuickWearPrompts', disableQuickWearPrompts);\r\n}\r\n\r\nvar events = [\r\n  {\r\n    test: function(self) {\r\n      return self.classList.contains('smallLink') &&\r\n        self.classList.contains('fshEq');\r\n    },\r\n    act: equipProfileInventoryItem\r\n  },\r\n  {\r\n    test: function(self) {\r\n      return self.classList.contains('smallLink') &&\r\n        self.classList.contains('fshUse');\r\n    },\r\n    act: useProfileInventoryItem\r\n  },\r\n  {\r\n    test: function(self) {return self.classList.contains('fshFolder');},\r\n    act: hideFolders\r\n  },\r\n  {\r\n    test: function(self) {return self.id === 'disableQuickWearPrompts';},\r\n    act: togglePref\r\n  }\r\n];\r\n\r\nfunction createInvTabs() {\r\n  return createDiv({\r\n    id: 'invTabs',\r\n    className: 'ui-tabs ui-widget-content ui-corner-all',\r\n    innerHTML: '<input id=\"qwtab1\" type=\"radio\" name=\"qwtabs\" checked>' +\r\n      '<input id=\"qwtab2\" type=\"radio\" name=\"qwtabs\">' +\r\n      '<ul class=\"ui-tabs-nav ui-helper-reset ' +\r\n        'ui-helper-clearfix ui-widget-header ui-corner-all\">' +\r\n      '<li class=\"ui-state-default ui-corner-top inv-tabs-qw\">' +\r\n      '<label for=\"qwtab1\">Quick Wear / Use / Extract<br>Manager</label>' +\r\n      '</li>' +\r\n      '<li class=\"ui-state-default ui-corner-top inv-tabs-ah\">' +\r\n      '<label for=\"qwtab2\">Inventory Manager Counter' +\r\n        '<br>filtered by AH Quick Search</label>' +\r\n      '</li><div id=\"setPrompt\" class=\"fshFloatRight fshCenter\"></div></ul>'\r\n  });\r\n}\r\n\r\nfunction showQuickWear(appInv) {\r\n  itemList = appInv;\r\n  var invTabs = createInvTabs();\r\n  var invTabsQw = createQuickWear(appInv);\r\n  insertElement(invTabs, invTabsQw);\r\n  content.innerHTML = '';\r\n  insertElement(content, invTabs);\r\n  invTabs.addEventListener('click', eventHandler(events));\r\n  insertElement(invTabs, showAHInvManager(appInv));\r\n  insertHtmlBeforeEnd(getElementById('setPrompt'),\r\n    simpleCheckboxHtml('disableQuickWearPrompts'));\r\n}\r\n\r\nfunction hasJquery(injector) { // jQuery.min\r\n  content = injector || pCC;\r\n  if (!content) {return;}\r\n  insertHtmlBeforeEnd(content, 'Getting item list from backpack...');\r\n  loadInventory().done(showQuickWear);\r\n  disableQuickWearPrompts = getValue('disableQuickWearPrompts');\r\n}\r\n\r\nexport default function insertQuickWear(injector) {\r\n  if (jQueryPresent()) {hasJquery(injector);}\r\n}\r\n","export var networkIcon =\r\n  '<img class=\"networkIcon tip-static\" ' +\r\n  'data-tipped=\"This function retrieves data from the network. ' +\r\n  'Disable this to increase speed\" src=\"data:image/png;base64,' +\r\n  'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA' +\r\n  'B3RJTUUH1QgGDTMWk1twEwAAAAlwSFlzAAALEgAACxIB0t1+' +\r\n  '/AAAAARnQU1BAACxjwv8YQUAAAC8SURBVHjahVPBEcQgCEQn' +\r\n  'HdmTqUlr0qe16I8cufOiCGZnGCcIy4LEICJwmGgWJ3o0IOCQ' +\r\n  'EqVg9Y4U3CoCHQhvxuPUZEiA3XYkxyI1/6S6R6rke8AlJbkV' +\r\n  '7u95lleXq3yrdyUjLGxwnifmnHEXY3fJIQSIMcKOZCLgMltr' +\r\n  'r+1ZWgxp8wi1VrEqxfeFWloYq4wKtOHeBNqeawqmeOnNvfdY' +\r\n  'SvkbfaeUxP0w/G+k6WsT/xCBc25SuxDsnownEy4u5BHudpMF' +\r\n  'egAAAABJRU5ErkJggg==\" width=\"16\" height=\"16\" />';\r\n\r\nexport var saveBoxes = [\r\n  'navigateToLogAfterMsg',\r\n  'gameHelpLink',\r\n  'guildSelf',\r\n  'guildSelfMessage',\r\n  'guildFrnd',\r\n  'guildFrndMessage',\r\n  'guildPast',\r\n  'guildPastMessage',\r\n  'guildEnmy',\r\n  'guildEnmyMessage',\r\n  'showAdmin',\r\n  'ajaxifyRankControls',\r\n  'detailedConflictInfo',\r\n  'disableItemColoring',\r\n  'enableLogColoring',\r\n  'enableChatParsing',\r\n  'enableCreatureColoring',\r\n  'hideNonPlayerGuildLogMessages',\r\n  'buyBuffsGreeting',\r\n  'renderSelfBio',\r\n  'renderOtherBios',\r\n  'defaultMessageSound',\r\n  'showSpeakerOnWorld',\r\n  'playNewMessageSound',\r\n  'highlightPlayersNearMyLvl',\r\n  'highlightGvGPlayersNearMyLvl',\r\n  'showCombatLog',\r\n  'showMonsterLog',\r\n  'showCreatureInfo',\r\n  'keepLogs',\r\n  'enableGuildInfoWidgets',\r\n  'enableOnlineAlliesWidgets',\r\n  'hideGuildInfoMessage',\r\n  'hideGuildInfoBuff',\r\n  'hideGuildInfoSecureTrade',\r\n  'hideGuildInfoTrade',\r\n  'huntingBuffs',\r\n  'huntingBuffsName',\r\n  'huntingBuffs2',\r\n  'huntingBuffs2Name',\r\n  'huntingBuffs3',\r\n  'huntingBuffs3Name',\r\n  'showHuntingBuffs',\r\n  'moveGuildList',\r\n  'moveOnlineAlliesList',\r\n  'moveFSBox',\r\n  'moveDailyQuest',\r\n  'hideQuests',\r\n  'hideQuestNames',\r\n  'hideRecipes',\r\n  'hideRecipeNames',\r\n  'doNotKillList',\r\n  'enableBioCompressor',\r\n  'maxCompressedCharacters',\r\n  'maxCompressedLines',\r\n  'sendGoldonWorld',\r\n  'goldRecipient',\r\n  'goldAmount',\r\n  'keepBuffLog',\r\n  'showQuickSendLinks',\r\n  'showQuickDropLinks',\r\n  'sendClasses',\r\n  'itemRecipient',\r\n  'currentGoldSentTotal',\r\n  'enableAllyOnlineList',\r\n  'enableEnemyOnlineList',\r\n  'allyEnemyOnlineRefreshTime',\r\n  'quickLinksTopPx',\r\n  'quickLinksLeftPx',\r\n  'draggableQuickLinks',\r\n  'enableActiveBountyList',\r\n  'bountyListRefreshTime',\r\n  'enableWantedList',\r\n  'wantedNames',\r\n  'wantedGuildMembers',\r\n  'fsboxlog',\r\n  'huntingMode',\r\n  'enableAttackHelper',\r\n  'hideRelicOffline',\r\n  'enterForSendMessage',\r\n  'storeLastQuestPage',\r\n  'addAttackLinkToLog',\r\n  'showStatBonusTotal',\r\n  'newGuildLogHistoryPages',\r\n  'useNewGuildLog',\r\n  'enhanceChatTextEntry',\r\n  'enableMaxGroupSizeToJoin',\r\n  'maxGroupSizeToJoin',\r\n  'enableTempleAlert',\r\n  'enableUpgradeAlert',\r\n  'enableComposingAlert',\r\n  'autoFillMinBidPrice',\r\n  'showPvPSummaryInLog',\r\n  'enableQuickDrink',\r\n  'enhanceOnlineDots',\r\n  'hideBuffSelected',\r\n  'hideHelperMenu',\r\n  'keepHelperMenuOnScreen',\r\n  'draggableHelperMenu',\r\n  'showNextQuestSteps',\r\n  'hideChampionsGroup',\r\n  'hideElitesGroup',\r\n  'hideSEGroup',\r\n  'hideTitanGroup',\r\n  'hideLegendaryGroup',\r\n  'disableDeactivatePrompts',\r\n  'moveComposingButtons',\r\n  'showExtraLinks',\r\n  'expandMenuOnKeyPress'\r\n];\r\n","import fallback from '../system/fallback';\r\nimport getValue from '../system/getValue';\r\nimport isChecked from '../system/isChecked';\r\nimport mySimpleCheckboxes from './simple';\r\nimport {networkIcon} from './settingObj';\r\n\r\nexport function helpLink(title, text) {\r\n  return '&nbsp;[&nbsp;<span class=\"fshLink tip-static\" data-tipped=\"' +\r\n    '<span class=\\'fshHelpTitle\\'>' + title + '</span><br><br>' +\r\n    text + '\">?</span>&nbsp;]';\r\n}\r\n\r\nfunction hasNetwork(o) {\r\n  if (o.network) {return networkIcon;}\r\n  return '';\r\n}\r\n\r\nfunction isOn(name) {\r\n  return isChecked(getValue(name));\r\n}\r\n\r\nexport function justLabel(name) {\r\n  var o = mySimpleCheckboxes[name];\r\n  return hasNetwork(o) +\r\n    '<label for=\"' + name + '\">' + fallback(o.title, o.helpTitle) +\r\n    helpLink(o.helpTitle, o.helpText) +\r\n    ':</label>';\r\n}\r\n\r\nexport function justCheckbox(name) {\r\n  return '<input id=\"' + name + '\" name=\"' + name +\r\n    '\" class=\"fshVMid\" type=\"checkbox\" value=\"on\"' + isOn(name) + '>';\r\n}\r\n\r\nexport function simpleCheckboxHtml(name) {\r\n  return justLabel(name) + justCheckbox(name);\r\n}\r\n\r\nexport function simpleCheckbox(name) {\r\n  return '<tr><td align=\"right\">' + justLabel(name) +\r\n    '</td><td>' + justCheckbox(name) + '</td></tr>';\r\n}\r\n","export default function toggleForce(el, force) {\r\n  if (el instanceof Element) {\r\n    el.classList.toggle('fshHide', force);\r\n  }\r\n}\r\n","function hasErrorMsg(json) {\r\n  return json.e && json.e.message;\r\n}\r\n\r\nexport default function errorDialog(json) {\r\n  if (!json.s && hasErrorMsg(json)) {\r\n    $('#dialog_msg').html(json.e.message).dialog('open');\r\n    json.r = 1;\r\n  } else {json.r = 0;}\r\n  return json;\r\n}\r\n","import errorDialog from '../app/errorDialog';\r\nimport useitem from '../app/profile/useitem';\r\n\r\nexport default function useItem(backpackInvId) {\r\n  return useitem(backpackInvId).pipe(errorDialog);\r\n}\r\n","import {defaults} from '../support/dataObj';\r\nimport eventHandler from '../common/eventHandler';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValueJSON from '../system/getValueJSON';\r\nimport isChecked from '../system/isChecked';\r\nimport jsonParse from '../common/jsonParse';\r\nimport makePageHeader from './makePageHeader';\r\nimport makePageTemplate from './makePageTemplate';\r\nimport {pCC} from '../support/layout';\r\nimport setValueJSON from '../system/setValueJSON';\r\n\r\nvar param;\r\n\r\nfunction hasUrl(j) {\r\n  return param.url && param.url[j] !== '';\r\n}\r\n\r\nfunction detailRow(j, itemField) { // Legacy\r\n  if (param.tags[j] === 'checkbox') {\r\n    return '<input type=\"checkbox\"' + isChecked(itemField) +\r\n      ' disabled>';\r\n  } else if (hasUrl(j)) {\r\n    return '<a href=\"' + param.url[j].replace('@replaceme@', itemField) +\r\n      '\">' + itemField + '</a>';\r\n  }\r\n  return itemField;\r\n}\r\n\r\nfunction itemRow(item) { // Legacy\r\n  var result = '';\r\n  for (var j = 0; j < param.fields.length; j += 1) {\r\n    result += '<td class=\"fshCenter\">';\r\n    var itemField = item[param.fields[j]];\r\n    if (param.fields[j] === param.categoryField) {continue;}\r\n    result += detailRow(j, itemField) + '</td>';\r\n  }\r\n  return result;\r\n}\r\n\r\nfunction doInputs() { // Legacy\r\n  var result = '<tr>';\r\n  for (var i = 0; i < param.tags.length; i += 1) {\r\n    result += '<td align=center><input type=\"' + param.tags[i] +\r\n      '\" class=\"custominput\" id=\"fshIn' + param.fields[i] + '\"></td>';\r\n  }\r\n  return result;\r\n}\r\n\r\nfunction generateManageTable() { // Legacy\r\n  var result = '<table cellspacing=\"2\" cellpadding=\"2\" class=\"fshGc\" ' +\r\n    'width=\"100%\"><tr class=\"fshOr\">';\r\n  result += param.headers.reduce(function(prev, curr) {\r\n    return prev + '<th>' + curr + '</th>';\r\n  }, '');\r\n  result += '<th>Action</th></tr>';\r\n  var currentCategory = '';\r\n  param.currentItems.forEach(function(item, i) {\r\n    result += '<tr>';\r\n    if (param.categoryField &&\r\n        currentCategory !==\r\n        item[param.categoryField]) {\r\n      currentCategory = item[param.categoryField];\r\n      result += '<td><span class=\"fshQs\">' +\r\n        currentCategory + '</span></td><td></td><td></td><td></td><td></td>' +\r\n          '</tr><tr>';\r\n    }\r\n    result += itemRow(item);\r\n    result += '<td><span class=\"HelperTextLink\" data-itemId=\"' + i +\r\n      '\" id=\"fshDel' + i + '\">[Del]</span></td></tr>';\r\n  });\r\n  result += doInputs();\r\n  result += '<td><span class=\"HelperTextLink\" id=\"fshAdd\">' +\r\n    '[Add]</span></td></tr></table>' +\r\n    '<table width=\"100%\"><tr><td class=\"fshCenter\">' +\r\n    '<textarea cols=70 rows=20 id=\"fshEd\">' +\r\n    JSON.stringify(param.currentItems) + '</textarea></td></tr>' +\r\n    '<tr><td class=\"fshCenter\"><input id=\"fshSave\" ' +\r\n    'type=\"button\" value=\"Save\" class=\"custombutton\">' +\r\n    '&nbsp;<input id=\"fshReset\" type=\"button\" value=\"Reset\" ' +\r\n    'class=\"custombutton\"></td></tr>' +\r\n    '</tbody></table>';\r\n  getElementById(param.id).innerHTML = result;\r\n  setValueJSON(param.gmname, param.currentItems);\r\n}\r\n\r\nfunction deleteQuickItem(self) { // Legacy\r\n  var itemId = self.getAttribute('data-itemId');\r\n  param.currentItems.splice(itemId, 1);\r\n  generateManageTable();\r\n}\r\n\r\nfunction buildNewItem() { // Legacy\r\n  var newItem = {};\r\n  for (var i = 0; i < param.fields.length; i += 1) {\r\n    if (param.tags[i] === 'checkbox') {\r\n      newItem[param.fields[i]] =\r\n        getElementById('fshIn' + param.fields[i]).checked;\r\n    } else {\r\n      newItem[param.fields[i]] =\r\n        getElementById('fshIn' + param.fields[i]).value;\r\n    }\r\n  }\r\n  return newItem;\r\n}\r\n\r\nfunction addQuickItem() { // Legacy\r\n  var isArrayOnly = param.fields.length === 0;\r\n  var newItem = {};\r\n  if (isArrayOnly) {\r\n    newItem = getElementById('fshIn0').value;\r\n  } else {\r\n    newItem = buildNewItem();\r\n  }\r\n  param.currentItems.push(newItem);\r\n  generateManageTable();\r\n}\r\n\r\nfunction saveRawEditor() { // Legacy\r\n  var userInput = jsonParse(getElementById('fshEd').value);\r\n  if (Array.isArray(userInput)) {\r\n    param.currentItems = userInput;\r\n    generateManageTable();\r\n  }\r\n}\r\n\r\nfunction resetRawEditor() { // Legacy\r\n  if (param.id === 'fshAso') {\r\n    param.currentItems =\r\n      jsonParse(defaults.quickSearchList);\r\n  } else {param.currentItems = [];}\r\n  generateManageTable();\r\n}\r\n\r\nvar listEvents = [\r\n  {test: function(self) {return self.id === 'fshReset';}, act: resetRawEditor},\r\n  {test: function(self) {return self.id === 'fshSave';}, act: saveRawEditor},\r\n  {test: function(self) {return self.id === 'fshAdd';}, act: addQuickItem},\r\n  {\r\n    test: function(self) {return self.id.indexOf('fshDel') === 0;},\r\n    act: deleteQuickItem\r\n  }\r\n];\r\n\r\nexport function injectAuctionSearch(injector) { // Legacy\r\n  var content = injector || pCC;\r\n  content.innerHTML =\r\n    makePageHeader('Trade Hub Quick Search', '', '', '') +\r\n    '<div>This screen allows you to set up some quick ' +\r\n      'search templates for the Auction House. The Display on AH column ' +\r\n      'indicates if the quick search will show on the short list on the ' +\r\n      'Auction House main screen. A maximum of 36 items can show on this ' +\r\n      'list (It will not show more than 36 even if you have more than 36 ' +\r\n      'flagged). To edit items, either use the large text area below, or ' +\r\n      'add a new entry and delete the old one. You can always reset the ' +\r\n      'list to the default values.</div>' +\r\n    '<div class=\"fshSmall\" id=\"fshAso\">' +\r\n    '</div>';\r\n  // global parameters for the meta function generateManageTable\r\n  param = {\r\n    id: 'fshAso',\r\n    headers: ['Category', 'Nickname', 'Quick Search Text',\r\n      'Display in AH?'],\r\n    fields: ['category', 'nickname', 'searchname', 'displayOnAH'],\r\n    tags: ['text', 'text', 'text', 'checkbox'],\r\n    url: ['', '',\r\n      'index.php?cmd=auctionhouse&amp;type=-1&amp;search=@replaceme@', ''],\r\n    currentItems: getValueJSON('quickSearchList'),\r\n    gmname: 'quickSearchList',\r\n    categoryField: 'category',\r\n  };\r\n  generateManageTable();\r\n  content.addEventListener('click', eventHandler(listEvents));\r\n}\r\n\r\nexport function injectQuickLinkManager(injector) { // Legacy\r\n  var content = injector || pCC;\r\n  content.innerHTML = makePageTemplate({\r\n    title: 'Quick Links',\r\n    comment: '',\r\n    spanId: '',\r\n    button: '',\r\n    divId: 'qla'\r\n  });\r\n\r\n  // global parameters for the meta function generateManageTable\r\n  param = {\r\n    id: 'qla',\r\n    headers: ['Name', 'URL',\r\n      'New [<span class=\"fshLink tip-static\" ' +\r\n      'data-tipped=\"Open page in a new window\">?</span>]'],\r\n    fields: ['name', 'url', 'newWindow'],\r\n    tags: ['text', 'text', 'checkbox'],\r\n    currentItems: getValueJSON('quickLinks'),\r\n    gmname: 'quickLinks',\r\n  };\r\n  generateManageTable();\r\n  content.addEventListener('click', eventHandler(listEvents));\r\n}\r\n","import callApp from '../callApp';\r\n\r\nexport default function loadInventory() {\r\n  return callApp({cmd: 'profile', subcmd: 'loadinventory'});\r\n}\r\n","export default function setValueJSON(name, value) {\r\n  GM_setValue(name, JSON.stringify(value));\r\n}\r\n","/* eslint-disable no-multi-spaces, max-len */\r\nexport default [\r\n  {name: 'Rage',                stam: 10, lvl: 1,    id: 0,   nicks: 'rage'},\r\n  {name: 'Stun',                stam: 15, lvl: 1,    id: 1,   nicks: 'stun,st'},\r\n  {name: 'Fury',                stam: 10, lvl: 25,   id: 2,   nicks: 'fury'},\r\n  {name: 'Blood Thirst',        stam: 10, lvl: 25,   id: 4,   nicks: 'blood thirst,bloodthirst,bt'},\r\n  {name: 'Enchant Weapon',      stam: 10, lvl: 25,   id: 5,   nicks: 'enchant weapon,ew'},\r\n  {name: 'Berserk',             stam: 15, lvl: 75,   id: 3,   nicks: 'berserk'},\r\n  {name: 'Holy Flame',          stam: 15, lvl: 75,   id: 6,   nicks: 'holy flame,hf'},\r\n  {name: 'Dark Curse',          stam: 20, lvl: 150,  id: 7,   nicks: 'dark curse,dc'},\r\n  {name: 'Shockwave',           stam: 20, lvl: 200,  id: 29,  nicks: 'shockwave,sw,shock'},\r\n  {name: 'Ignite',              stam: 10, lvl: 200,  id: 30,  nicks: 'ignite,ign'},\r\n  {name: 'Super Elite Slayer',  stam: 25, lvl: 250,  id: 31,  nicks: 'super elite slayer,ses,se slayer'},\r\n  {name: 'Wither',              stam: 15, lvl: 250,  id: 32,  nicks: 'wither,with'},\r\n  {name: 'Shatter Armor',       stam: 20, lvl: 300,  id: 33,  nicks: 'shatter armor,sa'},\r\n  {name: 'Death Wish',          stam: 20, lvl: 300,  id: 34,  nicks: 'deathwish,dw,deathw,death wish'},\r\n  {name: 'Spell Breaker',       stam: 35, lvl: 300,  id: 35,  nicks: 'spell breaker,sb'},\r\n  {name: 'Spectral Knight',     stam: 15, lvl: 400,  id: 48,  nicks: 'spectral knight,sk,spec knight'},\r\n  {name: 'Keen Edge',           stam: 10, lvl: 400,  id: 47,  nicks: 'keen edge,ke'},\r\n  {name: 'Arterial Strike',     stam: 20, lvl: 500,  id: 49,  nicks: 'arterial strike,as,art strike,art str'},\r\n  {name: 'Death Dealer',        stam: 20, lvl: 500,  id: 50,  nicks: 'death dealer,dd'},\r\n  {name: 'Savagery',            stam: 15, lvl: 600,  id: 51,  nicks: 'savagery,savage'},\r\n  {name: 'Chi Strike',          stam: 20, lvl: 700,  id: 52,  nicks: 'chi strike,chi,chis,chi str'},\r\n  {name: 'Shield Strike',       stam: 20, lvl: 700,  id: 53,  nicks: 'shield strike,ss,sh str'},\r\n  {name: 'Demoralize',          stam: 25, lvl: 800,  id: 73,  nicks: 'demoralize,dem'},\r\n  {name: 'Poison',              stam: 25, lvl: 800,  id: 70,  nicks: 'poison,poi'},\r\n  {name: 'Iron Fist',           stam: 25, lvl: 900,  id: 74,  nicks: 'iron fist,if'},\r\n  {name: 'Spell Leech',         stam: 50, lvl: 900,  id: 79,  nicks: 'spell leech,sl'},\r\n  {name: 'Distraction',         stam: 25, lvl: 900,  id: 78,  nicks: 'distraction,dis'},\r\n  {name: 'Coordinated Attack',  stam: 30, lvl: 1000, id: 118, nicks: 'coordinated attack,coorda'},\r\n  {name: 'Undermine',           stam: 30, lvl: 1000, id: 108, nicks: 'undermine,um'},\r\n  {name: 'Cursed Rune',         stam: 30, lvl: 1000, id: 89,  nicks: 'cursed rune,crune'},\r\n  {name: 'Anti Deflect',        stam: 30, lvl: 1000, id: 105, nicks: 'anti deflect,ad'},\r\n  {name: 'Overkill',            stam: 30, lvl: 1200, id: 109, nicks: 'overkill,ok'},\r\n  {name: 'Smashing Hammer',     stam: 30, lvl: 1200, id: 111, nicks: 'smashing hammer,sh'},\r\n  {name: 'Mighty Vigor',        stam: 35, lvl: 1200, id: 113, nicks: 'mighty vigor,mv'},\r\n  {name: 'Fist Fight',          stam: 30, lvl: 1200, id: 115, nicks: 'fist fight,ff'},\r\n  {name: 'Cursed Ring',         stam: 30, lvl: 1400, id: 88,  nicks: 'cursed ring,cring'},\r\n  {name: 'Sharpen',             stam: 30, lvl: 1400, id: 106, nicks: 'sharpen,sharp'},\r\n  {name: 'Balanced Attack',     stam: 30, lvl: 1400, id: 116, nicks: 'balanced attack,ba'},\r\n  {name: 'Heavy Weight',        stam: 20, lvl: 1600, id: 146, nicks: 'heavy weight, hw'},\r\n  {name: 'Armored Strike',      stam: 30, lvl: 1600, id: 130, nicks: 'armored strike, armstr'},\r\n  {name: 'Invert',              stam: 40, lvl: 2000, id: 173, nicks: 'invert'},\r\n  {name: 'Reign of Terror',     stam: 40, lvl: 2500, id: 174, nicks: 'reign of terror'},\r\n  {name: 'Critical Strike',     stam: 40, lvl: 3000, id: 175, nicks: 'critical strike'},\r\n  {name: 'Great Vigor',         stam: 10, lvl: 1,    id: 12,  nicks: 'great vigor,vigor,gv'},\r\n  {name: 'Fortify',             stam: 10, lvl: 25,   id: 8,   nicks: 'fortify'},\r\n  {name: 'Evade',               stam: 10, lvl: 25,   id: 10,  nicks: 'evade'},\r\n  {name: 'Absorb',              stam: 20, lvl: 25,   id: 13,  nicks: 'absorb,abs'},\r\n  {name: 'Rock Skin',           stam: 15, lvl: 75,   id: 11,  nicks: 'rock skin,rs'},\r\n  {name: 'Enchanted Armor',     stam: 10, lvl: 75,   id: 9,   nicks: 'enchanted armor,enchant armor,ea,ench arm,ench armor'},\r\n  {name: 'Aura of Protection',  stam: 20, lvl: 150,  id: 15,  nicks: 'aura of protection,aop,aofp'},\r\n  {name: 'Deflect',             stam: 25, lvl: 150,  id: 14,  nicks: 'deflect,defl'},\r\n  {name: 'Force Shield',        stam: 10, lvl: 200,  id: 27,  nicks: 'force shield,fs'},\r\n  {name: 'Unbreakable',         stam: 20, lvl: 200,  id: 28,  nicks: 'unbreakable,ub,unb,unbr'},\r\n  {name: 'Honor',               stam: 10, lvl: 800,  id: 82,  nicks: 'honor'},\r\n  {name: 'Assist',              stam: 30, lvl: 250,  id: 36,  nicks: 'assist,ass'},\r\n  {name: 'Constitution',        stam: 25, lvl: 300,  id: 37,  nicks: 'constitution,const'},\r\n  {name: 'Counter Attack',      stam: 20, lvl: 400,  id: 54,  nicks: 'counter attack,ca'},\r\n  {name: 'Summon Shield Imp',   stam: 50, lvl: 400,  id: 55,  nicks: 'summon shield imp,ssi,imp'},\r\n  {name: 'Vision',              stam: 20, lvl: 500,  id: 56,  nicks: 'vision,vis'},\r\n  {name: 'Fortitude',           stam: 15, lvl: 500,  id: 57,  nicks: 'fortitude,fort'},\r\n  {name: 'Flinch',              stam: 20, lvl: 600,  id: 58,  nicks: 'flinch'},\r\n  {name: 'Terrorize',           stam: 20, lvl: 700,  id: 59,  nicks: 'terrorize,terror'},\r\n  {name: 'Nightmare Visage',    stam: 40, lvl: 700,  id: 60,  nicks: 'nightmare visage,nv,visage'},\r\n  {name: 'Sanctuary',           stam: 25, lvl: 800,  id: 44,  nicks: 'sanctuary,sanc'},\r\n  {name: 'Dull Edge',           stam: 10, lvl: 800,  id: 46,  nicks: 'dull edge,de'},\r\n  {name: 'Erosion',             stam: 25, lvl: 900,  id: 80,  nicks: 'erosion,ero'},\r\n  {name: 'Avert Gaze',          stam: 10, lvl: 900,  id: 71,  nicks: 'avert gaze,ag'},\r\n  {name: 'Enchant Shield',      stam: 25, lvl: 900,  id: 77,  nicks: 'enchant shield,es'},\r\n  {name: 'Smite',               stam: 30, lvl: 1000, id: 97,  nicks: 'smite,sm'},\r\n  {name: 'Balanced Defense',    stam: 30, lvl: 1000, id: 117, nicks: 'balanced defense,bd'},\r\n  {name: 'Bastion',             stam: 30, lvl: 1000, id: 122, nicks: 'bastion,bast'},\r\n  {name: 'Side Step',           stam: 30, lvl: 1000, id: 86,  nicks: 'side step,sstep'},\r\n  {name: 'High Guard',          stam: 30, lvl: 1200, id: 96,  nicks: 'high guard,hg'},\r\n  {name: 'Barricade',           stam: 30, lvl: 1200, id: 98,  nicks: 'barricade,bar'},\r\n  {name: 'Coordinated Defense', stam: 30, lvl: 1200, id: 119, nicks: 'coordinated defense,cd'},\r\n  {name: 'Degrade',             stam: 30, lvl: 1200, id: 121, nicks: 'degrade,deg,dg'},\r\n  {name: 'Retaliate',           stam: 30, lvl: 1400, id: 123, nicks: 'retaliate,ret'},\r\n  {name: 'Shame',               stam: 35, lvl: 1400, id: 110, nicks: 'shame'},\r\n  {name: 'Dispel Curse',        stam: 35, lvl: 1400, id: 114, nicks: 'dispel curse,dispel'},\r\n  {name: 'Anchored',            stam: 30, lvl: 1600, id: 154, nicks: 'anchored, anch, anchor'},\r\n  {name: 'Hardened',            stam: 30, lvl: 1600, id: 153, nicks: 'hardened, hard, harden'},\r\n  {name: 'Armor Boost',         stam: 30, lvl: 1600, id: 136, nicks: 'armor boost, armbst, arm bst, armb'},\r\n  {name: 'Shield Wall',         stam: 30, lvl: 1600, id: 135, nicks: 'shield wall, shldwll, sw'},\r\n  {name: 'Layered Armor',       stam: 40, lvl: 2000, id: 170, nicks: 'layered armor'},\r\n  {name: 'Defensive Aura',      stam: 40, lvl: 2500, id: 171, nicks: 'defensive aura'},\r\n  {name: 'Fumble',              stam: 40, lvl: 3000, id: 172, nicks: 'fumble'},\r\n  {name: 'Find Item',           stam: 10, lvl: 1,    id: 16,  nicks: 'find item,fi'},\r\n  {name: 'Treasure Hunter',     stam: 15, lvl: 1,    id: 17,  nicks: 'treasure hunter,th,treas hunter'},\r\n  {name: 'Deep Pockets',        stam: 10, lvl: 1,    id: 22,  nicks: 'deep pockets,dp'},\r\n  {name: 'Quest Finder',        stam: 5,  lvl: 1,    id: 61,  nicks: 'quest finder,qf'},\r\n  {name: 'Adept Learner',       stam: 10, lvl: 25,   id: 19,  nicks: 'adept learner,al'},\r\n  {name: 'Defiance',            stam: 15, lvl: 25,   id: 18,  nicks: 'defiance'},\r\n  {name: 'Librarian',           stam: 10, lvl: 75,   id: 20,  nicks: 'librarian,lib,libr'},\r\n  {name: 'Merchant',            stam: 10, lvl: 75,   id: 21,  nicks: 'merchant,merch,merc'},\r\n  {name: 'Last Ditch',          stam: 15, lvl: 150,  id: 23,  nicks: 'last ditch,ld'},\r\n  {name: 'Animal Magnetism',    stam: 10, lvl: 200,  id: 24,  nicks: 'animal magnetism,animag,ani mag,am'},\r\n  {name: 'Empower',             stam: 20, lvl: 200,  id: 25,  nicks: 'empower,emp'},\r\n  {name: 'Doubler',             stam: 5,  lvl: 200,  id: 26,  nicks: 'doubler,doub,db'},\r\n  {name: 'Conserve',            stam: 10, lvl: 250,  id: 39,  nicks: 'conserve,cons,consv,con'},\r\n  {name: 'Brewing Master',      stam: 10, lvl: 250,  id: 40,  nicks: 'brewing master,bm,brm,brewm'},\r\n  {name: 'Four Leaf',           stam: 20, lvl: 250,  id: 41,  nicks: 'four leaf,4l,fl'},\r\n  {name: 'Extend',              stam: 30, lvl: 300,  id: 42,  nicks: 'extend,ext'},\r\n  {name: 'Inventor',            stam: 15, lvl: 400,  id: 62,  nicks: 'inventor,inv,invI,inv1,inventor1,inventor 1,inventor i,inv i,inv 1'},\r\n  {name: 'Extractor',           stam: 15, lvl: 400,  id: 63,  nicks: 'extractor,extr'},\r\n  {name: 'Inventor II',         stam: 20, lvl: 500,  id: 64,  nicks: 'inventor ii,inventorii,invii,inv2,inventor 2,inv ii,inv 2'},\r\n  {name: 'Buff Master',         stam: 10, lvl: 500,  id: 65,  nicks: 'buff master,buffm,bum'},\r\n  {name: 'Reflection',          stam: 10, lvl: 600,  id: 66,  nicks: 'reflection,ref,refl,reflect'},\r\n  {name: 'Guild Buffer',        stam: 10, lvl: 600,  id: 160, nicks: 'guild buffer, gldbfr, gb'},\r\n  {name: 'Light Foot',          stam: 15, lvl: 700,  id: 67,  nicks: 'light foot,lf'},\r\n  {name: 'Mesmerize',           stam: 20, lvl: 700,  id: 68,  nicks: 'mesmerize,mesmer,mes,mez'},\r\n  {name: 'Resource Finder',     stam: 25, lvl: 800,  id: 76,  nicks: 'resource finder,rf'},\r\n  {name: 'Quest Hunter',        stam: 25, lvl: 800,  id: 166, nicks: 'quest hunter'},\r\n  {name: 'Gloat',               stam: 10, lvl: 900,  id: 81,  nicks: 'gloat'},\r\n  {name: 'Sacrifice',           stam: 25, lvl: 900,  id: 75,  nicks: 'sacrifice,sac'},\r\n  {name: 'Reckoning',           stam: 25, lvl: 900,  id: 72,  nicks: 'reckoning,rec,rek'},\r\n  {name: 'Reinforce',           stam: 30, lvl: 1000, id: 126, nicks: 'reinforce,rein'},\r\n  {name: 'Bodyguard',           stam: 30, lvl: 1000, id: 120, nicks: 'bodyguard,bg'},\r\n  {name: 'Riposte',             stam: 30, lvl: 1000, id: 124, nicks: 'riposte,rip'},\r\n  {name: 'Severe Condition',    stam: 30, lvl: 1000, id: 101, nicks: 'severe condition,sc'},\r\n  {name: 'Sealed',              stam: 35, lvl: 1200, id: 112, nicks: 'sealed,seal'},\r\n  {name: 'Righteous',           stam: 30, lvl: 1200, id: 107, nicks: 'righteous,right'},\r\n  {name: 'Epic Forge',          stam: 30, lvl: 1200, id: 102, nicks: 'epic forge,ef'},\r\n  {name: 'Golden Shield',       stam: 30, lvl: 1200, id: 103, nicks: 'golden shield,gs'},\r\n  {name: 'Stalker',             stam: 35, lvl: 1400, id: 125, nicks: 'stalker,stalk'},\r\n  {name: 'Ageless',             stam: 30, lvl: 1400, id: 100, nicks: 'ageless,age'},\r\n  {name: 'Extractor II',        stam: 30, lvl: 1400, id: 104, nicks: 'extractor ii,extractorii,extii,ext2,extractor 2,ext ii,ext 2'},\r\n  {name: 'Epic Craft',          stam: 30, lvl: 1600, id: 159, nicks: 'epic craft, epc crft, epccrft, ec'},\r\n  {name: 'Gold Foot',           stam: 20, lvl: 1600, id: 137, nicks: 'gold foot, goldfoot, gldft, gf'},\r\n  {name: 'Titan Doubler',       stam: 40, lvl: 2000, id: 167, nicks: 'titan doubler'},\r\n  {name: 'Teleport',            stam: 40, lvl: 2500, id: 168, nicks: 'teleport'},\r\n  {name: 'Invigorate',          stam: 40, lvl: 3000, id: 169, nicks: 'invigorate'}\r\n];\r\n","import add from '../support/task';\r\nimport getValue from '../system/getValue';\r\nimport moreToDo from '../common/moreToDo';\r\nimport {lastActivityRE, nowSecs} from '../support/constants';\r\n\r\nvar dotList;\r\nvar dotCount;\r\nvar redDot =\r\n  '<span class=\"fshDot redDot tip-static\" data-tipped=\"Offline\"></span>';\r\nvar greenDiamond =\r\n  '<span class=\"fshDot greenDiamond tip-static\" data-tipped=\"Online\"></span>';\r\nvar yellowDiamond =\r\n  '<span class=\"fshDot yellowDiamond tip-static\" data-tipped=\"Offline\"></span>';\r\nvar orangeDiamond =\r\n  '<span class=\"fshDot orangeDiamond tip-static\" data-tipped=\"Offline\"></span>';\r\nvar offlineDot =\r\n  '<span class=\"fshDot offlineDot tip-static\" data-tipped=\"Offline\"></span>';\r\nvar sevenDayDot =\r\n  '<span class=\"fshDot sevenDayDot tip-static\" data-tipped=\"Offline\"></span>';\r\n\r\nvar getMins = [\r\n  function(obj, min) {\r\n    if (obj.day) {return min + parseInt(obj.day, 10) * 1440;}\r\n    return min;\r\n  },\r\n  function(obj, min) {\r\n    if (obj.hour) {return min + parseInt(obj.hour, 10) * 60;}\r\n    return min;\r\n  },\r\n  function(obj, min) {\r\n    if (obj.min) {return min + parseInt(obj.min, 10);}\r\n    return min;\r\n  },\r\n  function(obj, min) {\r\n    if (obj.last_login) {\r\n      return Math.floor((nowSecs - obj.last_login) / 60);\r\n    }\r\n    return min;\r\n  },\r\n  function(obj, min) {\r\n    // last_login is 'false' over 30 days\r\n    if ('last_login' in obj && !obj.last_login) {return 99999;}\r\n    return min;\r\n  }\r\n];\r\n\r\nvar getDot = [\r\n  {condition: 2, result: greenDiamond},\r\n  {condition: 5, result: yellowDiamond},\r\n  {condition: 30, result: orangeDiamond},\r\n  {condition: 10080, result: offlineDot},\r\n  {condition: 44640, result: sevenDayDot}\r\n];\r\n\r\nexport function onlineDot(obj) {\r\n  var min = getMins.reduce(function(prev, curr) {\r\n    return curr(obj, prev);\r\n  }, 0);\r\n  for (var i = 0; i < getDot.length; i += 1) {\r\n    var el = getDot[i];\r\n    if (min < el.condition) {return el.result;}\r\n  }\r\n  return redDot;\r\n}\r\n\r\nfunction changeOnlineDot(contactLink) {\r\n  var lastActivity = lastActivityRE\r\n    .exec(contactLink.dataset.tipped);\r\n  contactLink.parentNode.previousSibling.innerHTML =\r\n    onlineDot({\r\n      min: lastActivity[3],\r\n      hour: lastActivity[2],\r\n      day: lastActivity[1]\r\n    });\r\n}\r\n\r\nfunction batchDots() {\r\n  var limit = performance.now() + 5;\r\n  while (moreToDo(limit, dotCount, dotList)) {\r\n    changeOnlineDot(dotList[dotCount]);\r\n    dotCount += 1;\r\n  }\r\n  if (dotCount < dotList.length) {\r\n    add(3, batchDots);\r\n  }\r\n}\r\n\r\nexport function colouredDots() {\r\n  if (!getValue('enhanceOnlineDots')) {return;}\r\n  dotList = document.querySelectorAll(\r\n    '#pCC a[data-tipped*=\"Last Activity\"]');\r\n  dotCount = 0;\r\n  add(3, batchDots);\r\n}\r\n","import {helpLink} from '../settings/simpleCheckbox';\r\n\r\nfunction outputTable(o) {\r\n  return '<br><h1>Potential ' + o.processed + 'ers and Bio Info</h1><br>' +\r\n    '<table class=\"fshResult\" id=\"buffTable\"><tbody>' +\r\n    '<tr><th class=\"nameCol\">&nbsp;Name</th>' +\r\n    '<th class=\"infoCol\">&nbsp;Player Info</th>' +\r\n    '<th>&nbsp;Notable Bio Text</th></tr>' +\r\n    '</tbody></table><br>';\r\n}\r\n\r\nfunction disclaimer() {\r\n  return '<div class=\"disclaim\">Disclaimer: This ' +\r\n    'functionality does a simple text search for the terms above. ' +\r\n    'It is not as smart as you are, so please do not judge the results ' +\r\n    'too harshly. It does not search all online players, just a subset ' +\r\n    'of those that have been on recently. ' +\r\n    'The aim is to be fast and still return a good set of results. This ' +\r\n    'feature is a work in progress, so it may be tweaked and enhanced ' +\r\n    'over time.</div>';\r\n}\r\n\r\nexport default function pageLayout(o, extraProfile) { // Legacy\r\n  return '<table class=\"fshFind\"><tbody>' +\r\n    '<tr><td rowspan=\"2\" colspan=\"2\" class=\"headCell\">' +\r\n    '<h1>Find ' + o.header + '</h1></td>' +\r\n    '<td class=\"findLabel\">Select ' + o.what + ' to search for:</td>' +\r\n    '<td>' + o.control() + '</td></tr>' +\r\n    '<tr><td class=\"findLabel\">Level ' + o.cutoff + 'ers only:</td>' +\r\n    '<td><input id=\"level175\" type=\"checkbox\"></td></tr>' +\r\n    '<tr><td class=\"leftLabel\">' + o.searched +\r\n    ':&nbsp;</td><td id=\"buffNicks\">&nbsp;</td>' +\r\n    '<td class=\"findLabel\">Search guild members:</td>' +\r\n    '<td><input id=\"guildMembers\" type=\"checkbox\" checked></td></tr>' +\r\n    '<tr><td class=\"findLabel\">' +\r\n    '# potential ' + o.potential + 'ers to search:&nbsp;</td>' +\r\n    '<td id=\"potentialBuffers\"></td>' +\r\n    '<td class=\"findLabel\">Search allies/enemies:' +\r\n    helpLink('Search Allies/Enemies',\r\n      'The checkbox enables searching your own personal ' +\r\n      'allies/enemies list for buffs.<br><br>' +\r\n      'Additional profiles to search can be added in the text ' +\r\n      'field to the right, separated by commas.') + '</td>' +\r\n    '<td><input id=\"alliesEnemies\" type=\"checkbox\" checked>' +\r\n    '<input class=\"extraProfile\" class=\"custominput\" id=\"extraProfile\" ' +\r\n    'type=\"text\" title=\"Extra profiles to search\" value=\"' +\r\n    (extraProfile || '') + '\"></td></tr>' +\r\n    '<tr><td class=\"findLabel\"># ' + o.processed + 'ers processed:' +\r\n    '&nbsp;</td><td id=\"buffersProcessed\">0</td>' +\r\n    '<td class=\"findLabel\">Search online list:</td>' +\r\n    '<td><select class=\"selectOnline\" id=\"onlinePlayers\">' +\r\n      '<option value=\"0\">Disabled</option>' +\r\n      '<option value=\"49\">Short (fastest)</option>' +\r\n      '<option value=\"47\">Medium (medium)</option>' +\r\n      '<option value=\"45\">Long (slowest)</option>' +\r\n    '</select></td></tr>' +\r\n    '<tr><td class=\"findLabel\">Find ' + o.progress + ' progress:' +\r\n    '&nbsp;</td><td class=\"buffProg\" id=\"bufferProgress\">Idle</td>' +\r\n    '<td align=\"center\"><input id=\"clearresultsbutton\" ' +\r\n    'class=\"custombutton\" type=\"button\" value=\"Clear Results\"></td>' +\r\n    '<td align=\"center\"><input id=\"findbuffsbutton\" class=\"custombutton\" ' +\r\n    'type=\"button\" value=\"Find Buffers\"></td></tr>' +\r\n    '</tbody></table>' +\r\n    outputTable(o) +\r\n    disclaimer();\r\n}\r\n","export default function moreToDo(limit, cntr, list) {\r\n  return list && performance.now() < limit && cntr < list.length;\r\n}\r\n","import createDocument from '../system/createDocument';\r\nimport fallback from '../system/fallback';\r\nimport {getElementById} from '../common/getElement';\r\nimport intValue from '../system/intValue';\r\nimport {onlineDot} from '../common/colouredDots';\r\n\r\nvar sustainLevelRE = /Level<br>(\\d+)%/;\r\n\r\nfunction uniq(arr, removeBy) {\r\n  var seen = {};\r\n  if (removeBy) {\r\n    return arr.filter(function(item) {\r\n      if (seen[item[removeBy]]) {return false;}\r\n      seen[item[removeBy]] = true;\r\n      return true;\r\n    });\r\n  }\r\n  return arr.filter(function(item) {\r\n    if (seen[item]) {return false;}\r\n    seen[item] = true;\r\n    return true;\r\n  });\r\n}\r\n\r\nfunction getPrevBr(bioCellHtml, runningTotalPosition) { // Legacy\r\n  var prevBR = bioCellHtml.lastIndexOf('<br>', runningTotalPosition - 1);\r\n  if (prevBR === -1) {return 0;}\r\n  return prevBR;\r\n}\r\n\r\nfunction getNextBr(bioCellHtml, runningTotalPosition) { // Legacy\r\n  var nextBR = bioCellHtml.indexOf('<br>', runningTotalPosition);\r\n  if (nextBR === -1 && bioCellHtml.indexOf('<br>') !== -1) {\r\n    return bioCellHtml.length - 5;\r\n  }\r\n  return nextBR;\r\n}\r\n\r\nfunction getBioLines(bioCellHtml, findBuffNicks) { // Legacy\r\n  var res = [];\r\n  var buffPosition = 0;\r\n  var startingPosition = 0;\r\n  var runningTotalPosition = 0;\r\n  var bioTextToSearch = ' ' + bioCellHtml + ' ';\r\n  var buffRE = new RegExp('[^a-zA-Z]((' +\r\n    findBuffNicks.replace(/,/g, ')|(') + '))[^a-zA-Z]', 'i');\r\n  while (buffPosition !== -1) {\r\n    bioTextToSearch = bioTextToSearch.substr(startingPosition,\r\n      bioTextToSearch.length);\r\n    buffPosition = bioTextToSearch.search(buffRE);\r\n    if (buffPosition !== -1) {\r\n      startingPosition = buffPosition + 1;\r\n      runningTotalPosition += buffPosition;\r\n      var prevBR = getPrevBr(bioCellHtml, runningTotalPosition);\r\n      var nextBR = getNextBr(bioCellHtml, runningTotalPosition);\r\n      var textLine = bioCellHtml.substr(prevBR + 4, nextBR - prevBR);\r\n      textLine = textLine.replace(/(`~)|(~`)|(\\{b\\})|(\\{\\/b\\})/g, '');\r\n      res.push(textLine);\r\n    }\r\n  }\r\n  return uniq(res);\r\n}\r\n\r\nfunction getSustain(doc) {\r\n  var aLinks = getElementById('profileLeftColumn', doc)\r\n    .getElementsByTagName('a');\r\n  var sustainLevel;\r\n  Array.prototype.some.call(aLinks, function(el) {\r\n    if (el.textContent === 'Sustain') {\r\n      var sustainText = el.parentNode.parentNode.parentNode.nextElementSibling\r\n        .firstElementChild.dataset.tipped;\r\n      sustainLevel = parseInt(sustainLevelRE.exec(sustainText)[1], 10);\r\n      return true;\r\n    }\r\n    return false;\r\n  });\r\n  return fallback(sustainLevel, -1);\r\n}\r\n\r\nfunction nameCell(doc, callback, lastActivity, bioCellHtml) { // Legacy\r\n  var innerPlayerName = getElementById('pCC', doc)\r\n    .getElementsByTagName('h1')[0].textContent;\r\n  var levelValue = intValue(getElementById('profileLeftColumn', doc)\r\n    .children[4].children[0].rows[0].cells[1].textContent);\r\n  var virtualLevelValue = parseInt(getElementById('stat-vl', doc)\r\n    .textContent, 10);\r\n  var lastActivityMinutes = parseInt(lastActivity[1], 10);\r\n  var lastActivityIMG = onlineDot({min: lastActivityMinutes});\r\n  var playerHREF = callback.href;\r\n  var bioTip = bioCellHtml.replace(/'|\"|\\n/g, '');\r\n  return '<nobr>' + lastActivityIMG + '&nbsp;<a href=\"' +\r\n    playerHREF + '\" target=\"new\" ' +\r\n    // FIXME - It kind works now, but not guaranteed?\r\n    'class=\"tip-static\" ' +\r\n    'data-tipped=\"' + bioTip + '\">' + innerPlayerName + '</a>' +\r\n    '&nbsp;<span class=\"fshBlue\">[<span class=\"a-reply fshLink\" ' +\r\n    'target_player=\"' + innerPlayerName + '\">m</span>]</span></nobr><br>' +\r\n    '<span class=\"fshGray\">Level:&nbsp;</span>' + levelValue +\r\n    '&nbsp;(' + virtualLevelValue + ')';\r\n}\r\n\r\nfunction playerInfo(lastActivity, sustainLevel, hasExtendBuff) { // Legacy\r\n  var sustain = 'fshRed';\r\n  if (sustainLevel >= 100) {sustain = 'fshGreen';}\r\n  var extend = '<span class=\"fshRed\">No</span>';\r\n  if (hasExtendBuff) {extend = '<span class=\"fshGreen\">Yes</span>';}\r\n  return '<table><tbody><tr>' +\r\n    '<td colspan=\"2\" class=\"resAct\">Last Activity:</td>' +\r\n    '<td colspan=\"2\"><nobr>' + lastActivity[0] + '</nobr></td></tr>' +\r\n    '<tr><td class=\"resLbl\">Sustain:' +\r\n    '</td><td class=\"resVal ' + sustain + '\">' + sustainLevel + '%</td>' +\r\n    '<td class=\"resLbl\">Extend:</td>' +\r\n    '<td class=\"resVal\">' + extend + '</td></tr>';\r\n}\r\n\r\nexport default function parseProfileAndDisplay(responseText, callback) { // Hybrid - Evil\r\n  var doc = createDocument(responseText);\r\n  // name and level\r\n  var innerPcc = getElementById('pCC', doc);\r\n  // last activity\r\n  var lastActivityElement = innerPcc.getElementsByTagName('p')[0];\r\n  var lastActivity = /(\\d+) mins, (\\d+) secs/\r\n    .exec(lastActivityElement.textContent);\r\n  // buffs\r\n  var bioCellHtml = getElementById('profile-bio', doc).innerHTML;\r\n  var buffTable = getElementById('buffTable');\r\n  var textLineArray = getBioLines(bioCellHtml, callback.findBuffNicks);\r\n  // sustain\r\n  var sustainLevel = getSustain(doc);\r\n  // extend\r\n  var hasExtendBuff = doc.querySelector(\r\n    'img.tip-static[data-tipped*=\"Extend\"]');\r\n\r\n  // add row to table\r\n  if (textLineArray.length > 0) {\r\n    var newRow = buffTable.insertRow(-1);\r\n    // name cell\r\n    var newCell = newRow.insertCell(0);\r\n    newCell.style.verticalAlign = 'top';\r\n    newCell.innerHTML = nameCell(doc, callback, lastActivity, bioCellHtml);\r\n    $('.a-reply').click(function(evt) {\r\n      window.openQuickMsgDialog(evt.target.getAttribute('target_player'));\r\n    });\r\n\r\n    // player info cell\r\n    newCell = newRow.insertCell(1);\r\n    newCell.innerHTML = playerInfo(lastActivity, sustainLevel, hasExtendBuff);\r\n    newCell.style.verticalAlign = 'top';\r\n    // buff cell\r\n    newCell = newRow.insertCell(2);\r\n    textLineArray.forEach(function(el) {\r\n      newCell.innerHTML += el + '<br>';\r\n    });\r\n  }\r\n  var processedBuffers = getElementById('buffersProcessed');\r\n  var potentialBuffers =\r\n    parseInt(getElementById('potentialBuffers').textContent, 10);\r\n  var processedBuffersCount = parseInt(processedBuffers.textContent, 10);\r\n  processedBuffers.innerHTML = processedBuffersCount + 1;\r\n  if (potentialBuffers === processedBuffersCount + 1) {\r\n    callback.bufferProgress.innerHTML = 'Done.';\r\n    callback.bufferProgress.style.color = 'blue';\r\n  }\r\n}\r\n","import {getElementById} from '../common/getElement';\r\n\r\nvar thisPlayerName;\r\n\r\nexport default function playerName() {\r\n  if (!thisPlayerName) {\r\n    thisPlayerName = getElementById('statbar-character').textContent;\r\n  }\r\n  return thisPlayerName;\r\n}\r\n","import buffList from '../support/buffObj';\r\nimport getValue from '../system/getValue';\r\n\r\nexport var buffCustom = {\r\n  header: 'Buff',\r\n  what: 'buff',\r\n  control: function() {\r\n    var ret = '<select style=\"width:140px;\" id=\"selectedBuff\">';\r\n    for (var j = 0; j < buffList.length; j += 1) {\r\n      ret += '<option value=\"' + buffList[j].id + '\">' +\r\n        buffList[j].name + '</option>';\r\n    }\r\n    ret += '</select>';\r\n    return ret;\r\n  },\r\n  cutoff: '175 buff',\r\n  searched: 'Nicknames of buff searched',\r\n  potential: 'buff',\r\n  processed: 'Buff',\r\n  progress: 'buffers'\r\n};\r\nexport var otherCustom = {\r\n  header: 'Other',\r\n  what: 'text',\r\n  control: function() {\r\n    var textToSearchFor = getValue('textToSearchFor') || '';\r\n    return '<input style=\"width:140px;\" class=\"custominput\" ' +\r\n      'id=\"textToSearchFor\" type=\"text\" title=\"Text to search for\" value=\"' +\r\n      textToSearchFor + '\">';\r\n  },\r\n  cutoff: '500+ play',\r\n  searched: 'Text searched for',\r\n  potential: 'play',\r\n  processed: 'Play',\r\n  progress: 'Other'\r\n};\r\n","import buffList from '../support/buffObj';\r\nimport calf from '../support/calf';\r\nimport createDocument from '../system/createDocument';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {lastActivityRE} from '../support/constants';\r\nimport {pCC} from '../support/layout';\r\nimport pageLayout from './pageLayout';\r\nimport parseProfileAndDisplay from './parseProfileAndDisplay';\r\nimport playerName from '../common/playerName';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport setValue from '../system/setValue';\r\nimport stringSort from '../system/stringSort';\r\nimport {buffCustom, otherCustom} from './assets';\r\n\r\nvar characterName;\r\nvar findBuffNicks;\r\nvar findBuffMinCastLevel;\r\nvar findBuffsLevel175Only;\r\nvar onlinePlayers;\r\nvar onlinePlayersSetting;\r\nexport var extraProfile;\r\nvar profilePagesToSearch;\r\nvar profilePagesToSearchProcessed;\r\nvar bufferProgress;\r\n\r\nfunction findBuffsParsePlayersForBuffs() { // Legacy\r\n  // remove duplicates TODO\r\n  // now need to parse player pages for buff ...\r\n  getElementById('potentialBuffers').innerHTML =\r\n    onlinePlayers.length;\r\n  if (onlinePlayers.length <= 0) {\r\n    bufferProgress.innerHTML = 'Done.';\r\n    bufferProgress.style.color = 'blue';\r\n    return;\r\n  }\r\n  bufferProgress.innerHTML = 'Parsing player data ...';\r\n  bufferProgress.style.color = 'green';\r\n\r\n  //#if _DEV  //  Find Buffs uglify bug\r\n  console.log('onlinePlayers', onlinePlayers); // eslint-disable-line no-console\r\n  //#endif\r\n\r\n  onlinePlayers.forEach(function(j) {\r\n    retryAjax(j).done(function(html) {\r\n      parseProfileAndDisplay(html, {\r\n        href: onlinePlayers[j],\r\n        bufferProgress: bufferProgress,\r\n        findBuffNicks: findBuffNicks\r\n      });\r\n    });\r\n  });\r\n}\r\n\r\nfunction calcMinLvl() { // Legacy\r\n  if (findBuffsLevel175Only) {return 500;}\r\n  return 1;\r\n}\r\n\r\nfunction calcNextPage(curPage, maxPage) { // Legacy\r\n  if (curPage === 1) {return Math.round(onlinePlayersSetting * maxPage / 50);}\r\n  return curPage + 1;\r\n}\r\n\r\nfunction addPlayerToSearchList(onlinePlayer, onlinePlayerName) {\r\n  // add online player to search list (all but self)\r\n  if (characterName !== onlinePlayerName.trim()) {\r\n    onlinePlayers.push(onlinePlayer);\r\n  }\r\n}\r\n\r\nfunction playerRow(i, e) {\r\n  var onlinePlayer = $(e).find('td:eq(1) a').attr('href');\r\n  var onlinePlayerLevel = parseInt($(e).find('td:eq(2)').text()\r\n    .replace(/,/g, ''), 10);\r\n  var onlinePlayerName = $(e).find('td:eq(1) a').text();\r\n  var minPlayerVirtualLevel = calcMinLvl();\r\n  if (onlinePlayerLevel >= findBuffMinCastLevel &&\r\n      onlinePlayerLevel >= minPlayerVirtualLevel) {\r\n    addPlayerToSearchList(onlinePlayer, onlinePlayerName);\r\n  }\r\n}\r\n\r\nfunction findBuffsParseOnlinePlayers(responseText) { // Legacy\r\n  var doc = createDocument(responseText);\r\n  var playerRows = $(doc).find('table:contains(\"Username\")>tbody>tr:has' +\r\n    '(td>a[href*=\"cmd=profile&player_id=\"])');\r\n  var maxPage = parseInt($(doc).find('td:has(input[name=\"page\"]):last')\r\n    .text().replace(/\\D/g, ''), 10);\r\n  var curPage = parseInt($(doc).find('input[name=\"page\"]:last').val()\r\n    .replace(/\\D/g, ''), 10);\r\n  if (curPage !== 1) {\r\n    playerRows.each(playerRow);\r\n  }\r\n  if (curPage < maxPage) {\r\n    var newPage = calcNextPage(curPage, maxPage);\r\n    bufferProgress.innerHTML = 'Parsing online page ' + curPage + ' ...';\r\n    retryAjax('index.php?no_mobile=1&cmd=onlineplayers&page=' +\r\n      newPage.toString()).done(findBuffsParseOnlinePlayers);\r\n  } else {\r\n    // all done so moving on\r\n    findBuffsParsePlayersForBuffs();\r\n  }\r\n}\r\n\r\nfunction findBuffsParseOnlinePlayersStart() { // Legacy\r\n  // if option enabled then parse online players\r\n  onlinePlayersSetting =\r\n    parseInt(getElementById('onlinePlayers').value, 10);\r\n  if (onlinePlayersSetting !== 0) {\r\n    retryAjax('index.php?no_mobile=1&cmd=onlineplayers&page=1')\r\n      .done(findBuffsParseOnlinePlayers);\r\n  } else {\r\n    findBuffsParsePlayersForBuffs();\r\n  }\r\n}\r\n\r\nfunction calcLastActMins(tipped) {\r\n  var lastActivity = lastActivityRE.exec(tipped);\r\n  var lastActivityDays = parseInt(lastActivity[1], 10);\r\n  var lastActivityHours = parseInt(lastActivity[2], 10) + lastActivityDays * 24;\r\n  return parseInt(lastActivity[3], 10) + lastActivityHours * 60;\r\n}\r\n\r\nfunction isValidPlayer(lastActivityMinutes, vlevel, minPlayerVirtualLevel) {\r\n  return lastActivityMinutes < 5 && vlevel >= findBuffMinCastLevel &&\r\n    vlevel >= minPlayerVirtualLevel;\r\n}\r\n\r\nfunction parsePlayerLink(el) {\r\n  var tipped = el.dataset.tipped;\r\n  var lastActivityMinutes = calcLastActMins(tipped);\r\n  // check if they are high enough level to cast the buff\r\n  var vlevel = Number(/VL:.+?(\\d+)/.exec(tipped)[1]);\r\n  var minPlayerVirtualLevel = calcMinLvl();\r\n  if (isValidPlayer(lastActivityMinutes, vlevel, minPlayerVirtualLevel)) {\r\n    addPlayerToSearchList(el.href, el.textContent);\r\n  }\r\n}\r\n\r\nfunction findBuffsParseProfilePage(responseText) {\r\n  var doc = createDocument(responseText);\r\n  var profileAlliesEnemies =\r\n    doc.querySelectorAll('#profileLeftColumn a[data-tipped*=\"Last Activity\"]');\r\n  Array.prototype.forEach.call(profileAlliesEnemies, parsePlayerLink);\r\n  // continue with online players\r\n  profilePagesToSearchProcessed += 1;\r\n  if (profilePagesToSearchProcessed ===\r\n    profilePagesToSearch.length) {\r\n    findBuffsParseOnlinePlayersStart();\r\n  }\r\n}\r\n\r\nfunction findBuffsParseProfilePageStart() { // Legacy\r\n  // if option enabled then parse profiles\r\n  profilePagesToSearch = [];\r\n  profilePagesToSearch.push('index.php?cmd=profile'); // ???\r\n  var extraProfileArray = extraProfile.split(',');\r\n  extraProfileArray.forEach(function(el) {\r\n    profilePagesToSearch.push('index.php?cmd=findplayer' + // ???\r\n      '&search_active=1&search_level_max=&search_level_min=' +\r\n      '&search_username=' + el + '&search_show_first=1');\r\n  });\r\n  profilePagesToSearchProcessed = 0;\r\n  if (getElementById('alliesEnemies').checked) {\r\n    profilePagesToSearch.forEach(function(el) {\r\n      retryAjax(el).done(findBuffsParseProfilePage);\r\n    });\r\n  } else {\r\n    findBuffsParseOnlinePlayersStart();\r\n  }\r\n}\r\n\r\nfunction findBuffsParseGuildManagePage(responseText) {\r\n  var doc = createDocument(responseText);\r\n  if (getElementById('guildMembers').checked) {\r\n    var memList = doc.querySelectorAll('#pCC a[data-tipped*=\"<td>VL:</td>\"]');\r\n    Array.prototype.forEach.call(memList, parsePlayerLink);\r\n  }\r\n  // continue with profile pages\r\n  findBuffsParseProfilePageStart();\r\n}\r\n\r\nfunction findBuffsClearResults() { // Legacy\r\n  var buffTable = getElementById('buffTable');\r\n  for (var j = buffTable.rows.length; j > 1; j -= 1) {\r\n    buffTable.deleteRow(j - 1);\r\n  }\r\n  getElementById('buffNicks').innerHTML = '';\r\n  // var bufferProgress = getElementById('bufferProgress');\r\n  bufferProgress.innerHTML = 'Idle.';\r\n  bufferProgress.style.color = 'black';\r\n  getElementById('potentialBuffers').innerHTML = '';\r\n  getElementById('buffersProcessed').innerHTML = 0;\r\n}\r\n\r\nfunction findAnyStart(progMsg) { // jQuery.min // jQuery\r\n  if (jQueryNotPresent()) {return;}\r\n  characterName = playerName();\r\n  getElementById('buffNicks').innerHTML = findBuffNicks;\r\n  bufferProgress = getElementById('bufferProgress');\r\n  bufferProgress.innerHTML = 'Gathering list of ' + progMsg + ' ...';\r\n  bufferProgress.style.color = 'green';\r\n  findBuffsLevel175Only =\r\n    getElementById('level175').checked;\r\n  getElementById('buffersProcessed').innerHTML = 0;\r\n  onlinePlayers = [];\r\n  extraProfile = getElementById('extraProfile').value;\r\n  setValue('extraProfile', extraProfile);\r\n  // get list of players to search, starting with guild>manage page\r\n  retryAjax('index.php?no_mobile=1&cmd=guild&subcmd=manage')\r\n    .done(findBuffsParseGuildManagePage);\r\n}\r\n\r\nfunction findBuffsStart() { // Legacy\r\n  var selectedBuff = parseInt($('#selectedBuff').val(), 10);\r\n  for (var j = 0; j < buffList.length; j += 1) {\r\n    if (selectedBuff === buffList[j].id) {\r\n      findBuffNicks = buffList[j].nicks;\r\n      findBuffMinCastLevel = buffList[j].lvl;\r\n      break;\r\n    }\r\n  }\r\n  findAnyStart('potential buffers');\r\n}\r\n\r\nfunction findOtherStart() { // Legacy\r\n  var textToSearchFor = $('#textToSearchFor').val().replace(/\\s*,\\s*/, ',');\r\n  setValue('textToSearchFor', textToSearchFor);\r\n  findBuffNicks = textToSearchFor;\r\n  findBuffMinCastLevel = 1;\r\n  findAnyStart('profiles to search');\r\n}\r\n\r\nexport function injectFindBuffs(injector) { // Legacy\r\n  var content = injector || pCC;\r\n  calf.sortBy = 'name';\r\n  calf.sortAsc = true;\r\n  buffList.sort(stringSort);\r\n  extraProfile = getValue('extraProfile');\r\n  content.innerHTML = pageLayout(buffCustom, extraProfile);\r\n  getElementById('findbuffsbutton')\r\n    .addEventListener('click', findBuffsStart, true);\r\n  getElementById('clearresultsbutton')\r\n    .addEventListener('click', findBuffsClearResults, true);\r\n}\r\n\r\nexport function injectFindOther(injector) { // Native - Bad\r\n  var content = injector || pCC;\r\n  extraProfile = getValue('extraProfile');\r\n  content.innerHTML = pageLayout(otherCustom, extraProfile);\r\n  getElementById('findbuffsbutton')\r\n    .addEventListener('click', findOtherStart, true);\r\n  getElementById('clearresultsbutton')\r\n    .addEventListener('click', findBuffsClearResults, true);\r\n}\r\n","import {createDiv} from '../common/cElement';\r\nimport draggable from '../common/dragStart';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport {imageServer} from '../system/system';\r\nimport injectBuffLog from '../buffLog/injectBuffLog';\r\nimport {injectFsBoxContent} from '../misc';\r\nimport injectMonsterLog from '../monstorLog';\r\nimport injectNotepadShowLogs from '../combatLog';\r\nimport injectOnlinePlayers from '../onlinePlayers';\r\nimport injectRecipeManager from '../recipeMgr/recipeMgr';\r\nimport insertElement from '../common/insertElement';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\nimport insertQuickExtract from '../quickExtract';\r\nimport insertQuickWear from '../quickWear/quickWear';\r\nimport isFunction from '../common/isFunction';\r\nimport jQueryDialog from './jQueryDialog';\r\nimport jQueryPresent from '../common/jQueryPresent';\r\nimport {sendEvent} from '../support/fshGa';\r\nimport {injectAuctionSearch, injectQuickLinkManager} from '../lists/lists';\r\nimport {injectFindBuffs, injectFindOther} from '../findBuffs/findBuffs';\r\n\r\nvar helperMenuBlob =\r\n  '<div class=\"column\"><h3>Character</h3><ul>' +\r\n  '<li><span class=\"fshLink\">Buff Log</span></li>' +\r\n  '<li><span class=\"fshLink\">Combat Log</span></li>' +\r\n  '<li><span class=\"fshLink\">Creature Log</span></li>' +\r\n  '<li><span class=\"fshLink\">Recipe Manager</span></li>' +\r\n  '<li><span class=\"fshLink\">Quick Links</span></li>' +\r\n  '</ul><h3>Actions</h3><ul>' +\r\n  '<li><span class=\"fshLink\">Find Buffs</span></li>' +\r\n  '<li><span class=\"fshLink\">Find Other</span></li>' +\r\n  '<li><span class=\"fshLink\">Online Players</span></li>' +\r\n  '<li><span class=\"fshLink\">AH Quick Search</span></li>' +\r\n  '</ul><h3>Extra</h3><ul>' +\r\n  '<li><span class=\"fshLink\">Quick Extract</span></li>' +\r\n  '<li><span class=\"fshLink\">Quick Wear</span></li>' +\r\n  '<li><span class=\"fshLink\">FS Box Log</span></li>' +\r\n  '</ul><h3>FSH developer quick links</h3><ul>' +\r\n  '<li><span class=\"a-reply\" target_player=\"PointyHair\">PM</span> ' +\r\n  '<a href=\"index.php?cmd=profile&player_id=1963510\">PointyHair</a></li>' +\r\n  '<li><span class=\"a-reply\" target_player=\"yuuzhan\">PM</span> ' +\r\n  '<a href=\"index.php?cmd=profile&player_id=1599987\">yuuzhan</a></li>' +\r\n  '</ul></div>';\r\n\r\nvar functionLookup = {\r\n  'Buff Log': injectBuffLog,\r\n  'Combat Log': injectNotepadShowLogs,\r\n  'Creature Log': injectMonsterLog,\r\n  'Recipe Manager': injectRecipeManager,\r\n  'Quick Links': injectQuickLinkManager,\r\n  'Find Buffs': injectFindBuffs,\r\n  'Find Other': injectFindOther,\r\n  'Online Players': injectOnlinePlayers,\r\n  'AH Quick Search': injectAuctionSearch,\r\n  'Quick Extract': insertQuickExtract,\r\n  'Quick Wear': insertQuickWear,\r\n  'FS Box Log': injectFsBoxContent\r\n};\r\n\r\nfunction callHelperFunction(evt) {\r\n  var functionPath = evt.target.textContent;\r\n  var fn = functionLookup[functionPath];\r\n  if (jQueryPresent() && isFunction(fn)) {\r\n    sendEvent('helperMenu', functionPath);\r\n    jQueryDialog(fn);\r\n  }\r\n}\r\n\r\nfunction eventHandler(evt) {\r\n  if (evt.target.classList.contains('fshLink')) {\r\n    callHelperFunction(evt);\r\n    return;\r\n  }\r\n  if (evt.target.classList.contains('a-reply')) {\r\n    window.openQuickMsgDialog(evt.target.getAttribute('target_player'));\r\n  }\r\n}\r\n\r\nfunction showHelperMenu() {\r\n  var helperMenu = getElementById('helperMenu');\r\n  helperMenu.removeEventListener('mouseenter', showHelperMenu);\r\n\r\n  var helperMenuDiv = createDiv({\r\n    id: 'helperMenuDiv',\r\n    className: 'helperMenuDiv',\r\n    style: {\r\n      backgroundImage: 'url(' + imageServer +\r\n        '/skin/inner_bg.jpg)'\r\n    }\r\n  });\r\n  insertHtmlBeforeEnd(helperMenuDiv, helperMenuBlob);\r\n  insertElement(helperMenu, helperMenuDiv);\r\n  helperMenu.addEventListener('click', function(evt) {\r\n    if (evt.target.id !== 'helperMenu') {return;}\r\n    var menu = evt.target.firstElementChild;\r\n    menu.classList.toggle('showMenuDiv');\r\n  });\r\n  helperMenuDiv.addEventListener('click', eventHandler);\r\n}\r\n\r\nfunction haveNode(node) {\r\n  var helperMenu = createDiv({\r\n    id: 'helperMenu',\r\n    className: 'helperMenu',\r\n    innerHTML: 'Helper&nbsp;Menu'\r\n  });\r\n  if (getValue('keepHelperMenuOnScreen')) {\r\n    helperMenu.classList.add('fshFixed');\r\n  }\r\n  helperMenu.addEventListener('mouseenter', showHelperMenu);\r\n  if (getValue('draggableHelperMenu')) {\r\n    helperMenu.classList.add('fshMove');\r\n    draggable(helperMenu);\r\n  }\r\n  node.parentNode.insertBefore(helperMenu, node);\r\n}\r\n\r\nexport default function injectHelperMenu() {\r\n  // don't put all the menu code here (but call if clicked) to minimize lag\r\n  var node = getElementById('statbar-container');\r\n  if (node) {haveNode(node);}\r\n}\r\n","import currentGuildId from '../common/currentGuildId';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport injectBuffLog from '../buffLog/injectBuffLog';\r\nimport injectMonsterLog from '../monstorLog';\r\nimport injectNotepadShowLogs from '../combatLog';\r\nimport injectOnlinePlayers from '../onlinePlayers';\r\nimport injectRecipeManager from '../recipeMgr/recipeMgr';\r\nimport insertElement from '../common/insertElement';\r\nimport insertElementAfter from '../common/insertElementAfter';\r\nimport insertHtmlAfterEnd from '../common/insertHtmlAfterEnd';\r\nimport isObject from '../common/isObject';\r\nimport jQueryDialog from './jQueryDialog';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {newGuildLogUrl} from '../support/constants';\r\nimport {createAnchor, createLi} from '../common/cElement';\r\nimport {injectAuctionSearch, injectQuickLinkManager} from '../lists/lists';\r\nimport {injectFindBuffs, injectFindOther} from '../findBuffs/findBuffs';\r\nimport {sendEvent, sendException} from '../support/fshGa';\r\n\r\nvar guildId;\r\n\r\nfunction updateQuestLink() {\r\n  var lastActiveQuestPage = getValue('lastActiveQuestPage');\r\n  if (lastActiveQuestPage.length > 0) {\r\n    getElementById('nav-character-questbook')\r\n      .setAttribute('href', lastActiveQuestPage);\r\n  }\r\n}\r\n\r\nfunction insertAdjElement(parent, listItem) {\r\n  insertElementAfter(listItem, parent);\r\n}\r\n\r\nfunction insertAfterParent(target, fn, listItem) {\r\n  var tgt = getElementById(target);\r\n  if (tgt instanceof Node) {\r\n    var parent = tgt.parentNode;\r\n    fn(parent, listItem);\r\n  } else {sendException('#' + target + ' is not a Node', false);}\r\n}\r\n\r\nfunction anchorButton(navLvl, text, fn, target) {\r\n  var li = createLi({className: 'nav-level-' + navLvl});\r\n  var al = createAnchor({\r\n    className: 'nav-link fshPoint',\r\n    textContent: text\r\n  });\r\n  al.addEventListener('click', function() {\r\n    sendEvent('accordion', text);\r\n    jQueryDialog(fn);\r\n  });\r\n  insertElement(li, al);\r\n  insertAfterParent(target, insertAdjElement, li);\r\n}\r\n\r\nfunction buffLogLink() {\r\n  if (getValue('keepBuffLog')) {\r\n    anchorButton('1', 'Buff Log', injectBuffLog, 'nav-character-log');\r\n  }\r\n}\r\n\r\nfunction combatLogLink() {\r\n  if (getValue('keepLogs')) {\r\n    anchorButton('1', 'Combat Logs', injectNotepadShowLogs,\r\n      'nav-character-notepad');\r\n  }\r\n}\r\n\r\nfunction creatureLogLink() {\r\n  if (getValue('showMonsterLog')) {\r\n    anchorButton('1', 'Creature Logs', injectMonsterLog,\r\n      'nav-character-notepad');\r\n  }\r\n}\r\n\r\nfunction newGuildLogLink() {\r\n  if (guildId && !getValue('useNewGuildLog')) {\r\n    // if not using the new guild log, show it as a separate menu entry\r\n    insertAfterParent('nav-guild-ledger-guildlog', insertHtmlAfterEnd,\r\n      '<li class=\"nav-level-2\"><a class=\"nav-link\" ' +\r\n      'href=\"index.php' + newGuildLogUrl + '\"' +\r\n      '>New Guild Log</a></li>');\r\n  }\r\n}\r\n\r\nfunction guildInventory() {\r\n  if (guildId) {\r\n    insertAfterParent('nav-guild-storehouse-inventory', insertHtmlAfterEnd,\r\n      '<li class=\"nav-level-2\"><a class=\"nav-link\" id=\"nav-' +\r\n      'guild-guildinvmanager\" href=\"index.php?cmd=notepad&blank=1' +\r\n      '&subcmd=guildinvmgr\">Guild Inventory</a></li>');\r\n  }\r\n}\r\n\r\nfunction navHeightsIsArray(theNav, myNav) {\r\n  // first the closed saved variables\r\n  myNav.heights = [\r\n    null,\r\n    null,\r\n    // Character\r\n    getElementById('nav-character').nextElementSibling.children\r\n      .length * 22,\r\n    660,\r\n    // Guild\r\n    document.querySelectorAll('#nav-guild > ul li').length * 22,\r\n    374,\r\n    132,\r\n    132,\r\n    null\r\n  ];\r\n  if (myNav.state !== '-1' && myNav.state !== -1) {\r\n    // and now the open one\r\n    theNav.children[myNav.state].children[1].style.height =\r\n      myNav.heights[myNav.state] + 'px';\r\n  }\r\n}\r\n\r\nfunction navHeightExists(theNav, myNav) {\r\n  if (Array.isArray(myNav.heights)) {\r\n    navHeightsIsArray(theNav, myNav);\r\n  } else {\r\n    sendException('$(\\'#nav\\').data(\\'nav\\').heights is not an Array', false);\r\n  }\r\n}\r\n\r\nfunction navDataExists(theNav, myNav) {\r\n  if ('heights' in myNav) {\r\n    navHeightExists(theNav, myNav);\r\n  } else {\r\n    sendException('$(\\'#nav\\').data(\\'nav\\').heights does not exist', false);\r\n  }\r\n}\r\n\r\nfunction navExists(theNav) { // jQuery\r\n  var myNav = $(theNav).data('nav');\r\n  if (isObject(myNav)) {\r\n    navDataExists(theNav, myNav);\r\n  } else {\r\n    sendException('$(\\'#nav\\').data(\\'nav\\') is not an object', false);\r\n  }\r\n}\r\n\r\nfunction adjustHeight() {\r\n  // adjust the menu height for the newly added items\r\n  var theNav = getElementById('nav');\r\n  if (theNav instanceof Element) {\r\n    navExists(theNav);\r\n  } else {\r\n    sendException('#nav is not an Element', false);\r\n  }\r\n}\r\n\r\nexport default function injectMenu() {\r\n  if (!getElementById('pCL') || jQueryNotPresent()) {return;}\r\n  guildId = currentGuildId();\r\n  updateQuestLink();\r\n  // character\r\n  anchorButton('1', 'Recipe Manager', injectRecipeManager, 'nav-character-log');\r\n  insertAfterParent('nav-character-log', insertHtmlAfterEnd,\r\n    '<li class=\"nav-level-1\"><a class=\"nav-link\" id=\"nav-' +\r\n    'character-medalguide\" href=\"index.php?cmd=profile&subcmd=' +\r\n    'medalguide\">Medal Guide</a></li>' +\r\n    '<li class=\"nav-level-1\"><a class=\"nav-link\" id=\"nav-' +\r\n    'character-invmanager\" href=\"index.php?cmd=notepad&blank=1&' +\r\n    'subcmd=invmanagernew\">Inventory Manager</a></li>');\r\n  buffLogLink();\r\n  combatLogLink();\r\n  creatureLogLink();\r\n  anchorButton('1', 'Quick Links', injectQuickLinkManager,\r\n    'nav-character-notepad');\r\n  // guild\r\n  guildInventory();\r\n  newGuildLogLink();\r\n  // top rated\r\n  insertAfterParent('nav-toprated-players-level', insertHtmlAfterEnd,\r\n    '<li class=\"nav-level-2\"><a class=\"nav-link\" id=\"nav-' +\r\n    'toprated-top250\" href=\"index.php?cmd=toprated&subcmd=xp\">' +\r\n    'Top 250 Players</a></li>');\r\n  // actions\r\n  anchorButton('2', 'AH Quick Search', injectAuctionSearch,\r\n    'nav-actions-trade-auctionhouse');\r\n  anchorButton('2', 'Online Players', injectOnlinePlayers,\r\n    'nav-actions-interaction-findplayer');\r\n  anchorButton('2', 'Find Other', injectFindOther,\r\n    'nav-actions-interaction-findplayer');\r\n  anchorButton('2', 'Find Buffs', injectFindBuffs,\r\n    'nav-actions-interaction-findplayer');\r\n  adjustHeight();\r\n}\r\n","import fallback from '../system/fallback';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport getValueJSON from '../system/getValueJSON';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport setValueJSON from '../system/setValueJSON';\r\n\r\nvar enterForSendMessage;\r\nvar fshTemplate;\r\nvar sendMessage;\r\n\r\nfunction showMsgTemplate() { // jQuery\r\n  var targetPlayer = $('#quickMsgDialog_targetUsername').text();\r\n  $('#msgTemplateDialog').remove();\r\n\r\n  // template displayed\r\n  var html = '<div id=msgTemplateDialog title=\"Choose Msg Template\" ' +\r\n    'style=\"display:none\"><style>#msgTemplate .ui-selecting { ' +\r\n    'background: #FECA40; };</style><ol id=msgTemplate valign=center>';\r\n  for (var i = 0; i < fshTemplate.length; i += 1) {\r\n    html += '<li class=\"ui-widget-content\">' +\r\n      fshTemplate[i].replace(/\\{playername\\}/g, targetPlayer) + '</li>';\r\n  }\r\n  html += '</ol></div>';\r\n  $('body').append(html);\r\n\r\n  // template manager\r\n  $('#msgTemplate li').prepend('<input type=button class=\"del-button\" ' +\r\n    'value=Del style=\"display:none\">');\r\n  $('#msgTemplate').append('<li class=\"add-button\" style=\"display:none\">' +\r\n    '<input type=button id=newTmplAdd value=Add><input id=newTmpl ' +\r\n    'class=ui-widget-content></li>');\r\n  $(':button', '#msgTemplate').button();\r\n  $('.del-button').click(function(evt) {\r\n    fshTemplate.splice($('#msgTemplate li')\r\n      .index(evt.target.parentNode), 1);\r\n    setValueJSON('quickMsg', fshTemplate);\r\n    $('#msgTemplateDialog').dialog('close');\r\n    showMsgTemplate();\r\n  });\r\n  $('#newTmplAdd').click(function() {\r\n    if ($('#newTmpl').val() === '') {return;}\r\n    fshTemplate.push($('#newTmpl').val());\r\n    setValueJSON('quickMsg', fshTemplate);\r\n    $('#msgTemplateDialog').dialog('close');\r\n    showMsgTemplate();\r\n  });\r\n\r\n  // enable selectable template\r\n  $('#msgTemplate').selectable({\r\n    filter: 'li.ui-widget-content',\r\n    stop: function() {\r\n      if ($('.add-button.ui-selected').length > 0) {return;} // click on add row\r\n      if ($('.ui-selected').length === 0) {return;} // nothing selected yet\r\n      $('#quickMsgDialog_msg').val($('#quickMsgDialog_msg').val() +\r\n        $('#msgTemplate .ui-selected').text() + '\\n');\r\n      $('#msgTemplateDialog').dialog('close');\r\n    }\r\n  });\r\n\r\n  // show the template form\r\n  $('#msgTemplateDialog').dialog({\r\n    buttons: {\r\n      Manage: function() {\r\n        $('.del-button').toggle();\r\n        $('.add-button').toggle();\r\n      },\r\n      Cancel: function() {\r\n        $('#msgTemplateDialog').dialog('close');\r\n        $('#msgTemplateDialog').remove();\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\nfunction keypress(evt) {\r\n  if (evt.code === 'Enter' && !evt.shiftKey) {\r\n    evt.preventDefault();\r\n    sendMessage();\r\n  }\r\n}\r\n\r\nfunction captureEnter() {\r\n  if (enterForSendMessage) {\r\n    getElementById('quickMsgDialog_msg')\r\n      .addEventListener('keypress', keypress);\r\n  }\r\n}\r\n\r\nfunction openQuickMsgDialog(name, msg, tip) { // jQuery\r\n  if (!fshTemplate) {\r\n    fshTemplate = getValueJSON('quickMsg');\r\n    var buttons = $('#quickMessageDialog').dialog('option', 'buttons');\r\n    sendMessage = buttons['Send Message'];\r\n    buttons.Template = showMsgTemplate;\r\n    $('#quickMessageDialog').dialog('option', 'buttons', buttons);\r\n  }\r\n  $('#quickMsgDialog_targetUsername').html(name);\r\n  $('#quickMsgDialog_targetPlayer').val(name);\r\n  $('#quickMsgDialog_msg').val(fallback(msg, ''));\r\n  $('#quickMsgDialog_msg').removeAttr('disabled');\r\n  captureEnter();\r\n  $('.validateTips').text(fallback(tip, ''));\r\n  $('#quickMessageDialog').dialog('open');\r\n}\r\n\r\nexport default function injectQuickMsgDialogJQ() {\r\n  if (jQueryNotPresent()) {return;}\r\n  enterForSendMessage = getValue('enterForSendMessage');\r\n  window.openQuickMsgDialog = openQuickMsgDialog;\r\n}\r\n","import {months} from '../support/constants';\r\n\r\nexport default function parseDateAsTimestamp(textDate) {\r\n  var dateAry = textDate.split(/[: /[]/);\r\n  return Date.UTC(Number(dateAry[4]), months.indexOf(dateAry[3]),\r\n    Number(dateAry[2]), Number(dateAry[0]), Number(dateAry[1]), 0);\r\n}\r\n","import {createAnchor} from '../common/cElement';\r\nimport getValue from '../system/getValue';\r\nimport {guideUrl} from '../support/constants';\r\nimport insertElement from '../common/insertElement';\r\nimport insertHtmlAfterEnd from '../common/insertHtmlAfterEnd';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {pCC} from '../support/layout';\r\nimport parseDateAsTimestamp from '../system/parseDateAsTimestamp';\r\nimport setValue from '../system/setValue';\r\n\r\nfunction containsNewsHead(el) {\r\n  return el.classList.contains('news_head') ||\r\n    el.classList.contains('news_head_tavern');\r\n}\r\n\r\nfunction closestHead(el) {\r\n  if (containsNewsHead(el)) {\r\n    return el;\r\n  }\r\n  if (el.classList.contains('news_left_column')) {return;}\r\n  return closestHead(el.parentNode);\r\n}\r\n\r\nfunction getNewsClass(newsHead) {\r\n  if (newsHead.classList.contains('news_head_tavern')) {\r\n    return '.news_body_tavern';\r\n  }\r\n  return '.news_body';\r\n}\r\n\r\nfunction gotNewsHead(evt, newsHead) { // jQuery\r\n  var newsBody = newsHead.nextElementSibling;\r\n  var newsClass = getNewsClass(newsHead);\r\n  if (!$(newsBody).data('open')) {\r\n    evt.preventDefault();\r\n    $(newsClass).hide().data('open', false);\r\n    $(newsBody).show().data('open', true);\r\n  } else if (evt.target.tagName !== 'A') {\r\n    $(newsBody).hide().data('open', false);\r\n  }\r\n  evt.stopPropagation();\r\n}\r\n\r\nfunction newsEvt(evt) {\r\n  var newsHead = closestHead(evt.target);\r\n  if (newsHead) {gotNewsHead(evt, newsHead);}\r\n}\r\n\r\nfunction fixCollapse() {\r\n  var newsCol = document.getElementsByClassName('news_left_column');\r\n  if (jQueryNotPresent() || newsCol.length !== 1) {return;}\r\n  newsCol[0].addEventListener('click', newsEvt, true);\r\n}\r\n\r\nfunction lookForPvPLadder() {\r\n  var lastLadderReset = getValue('lastLadderReset');\r\n  var rumours = pCC.getElementsByClassName('news_head_tavern');\r\n  Array.prototype.forEach.call(rumours, function(head) {\r\n    if (head.children[1].textContent === 'PvP Ladder') {\r\n      var logTime = parseDateAsTimestamp(head.children[2].textContent);\r\n      if (logTime > lastLadderReset) {\r\n        setValue('lastLadderReset', logTime);\r\n        lastLadderReset = logTime;\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\nfunction addUfsgLinks() {\r\n  var imgs = document.querySelectorAll(\r\n    '.news_body img[src^=\"https://cdn.fallensword.com/creatures/\"]');\r\n  Array.prototype.forEach.call(imgs, function(img) {\r\n    var myName = encodeURIComponent(img.getAttribute('oldtitle'));\r\n    var myLink = createAnchor({\r\n      href: guideUrl + 'creatures&search_name=' + myName,\r\n      target: '_blank'\r\n    });\r\n    img.parentNode.insertBefore(myLink, img);\r\n    insertElement(myLink, img);\r\n  });\r\n}\r\n\r\nexport default function injectHomePageTwoLink() { // Pref\r\n  var archiveLink = document.querySelector(\r\n    '#pCC a[href=\"index.php?cmd=&subcmd=viewupdatearchive\"]');\r\n  if (!archiveLink) {return;}\r\n  insertHtmlAfterEnd(archiveLink, '&nbsp;<a href=\"index.php?cmd=' +\r\n    '&subcmd=viewupdatearchive&subcmd2=&page=2&search_text=\">' +\r\n    'View Updates Page 2</a>');\r\n  archiveLink = document.querySelector(\r\n    '#pCC a[href=\"index.php?cmd=&subcmd=viewarchive\"]');\r\n  insertHtmlAfterEnd(archiveLink, '&nbsp;<a href=\"index.php?cmd=' +\r\n    '&subcmd=viewarchive&subcmd2=&page=2&search_text=\">View News Page 2</a>');\r\n  fixCollapse(); // Pref\r\n  lookForPvPLadder(); // Pref\r\n  addUfsgLinks(); // Pref\r\n}\r\n","import {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport insertHtmlAfterEnd from '../common/insertHtmlAfterEnd';\r\n\r\nfunction findNewGroup(el) {\r\n  if (el.textContent.indexOf('New attack group created.') === -1) {return;}\r\n  var groupJoinHTML = '';\r\n  if (!getValue('enableMaxGroupSizeToJoin')) {\r\n    groupJoinHTML = '<a href=\"index.php?cmd=guild&subcmd=groups&' +\r\n      'subcmd2=joinall\"><span class=\"notification-icon\"></span>' +\r\n      '<p class=\"notification-content\">Join all attack groups.</p></a>';\r\n  } else {\r\n    var maxGroupSizeToJoin = getValue('maxGroupSizeToJoin');\r\n    groupJoinHTML = '<a href=\"index.php?cmd=guild&subcmd=groups&' +\r\n      'subcmd2=joinallgroupsundersize\"><span class=\"notification-icon\">' +\r\n      '</span><p class=\"notification-content\">Join all attack groups ' +\r\n      'less than size ' + maxGroupSizeToJoin + '.</p></a>';\r\n  }\r\n  insertHtmlAfterEnd(el, '<li class=\"notification\">' + groupJoinHTML + '</li>');\r\n}\r\n\r\nexport default function injectJoinAllLink() {\r\n  var nodeList = getElementById('pCL').getElementsByTagName('li');\r\n  Array.prototype.forEach.call(nodeList, findNewGroup);\r\n}\r\n","export default function insertElementAfter(newNode, referenceNode) {\r\n  if (referenceNode instanceof Node &&\r\n      referenceNode.parentNode instanceof Node) {\r\n    return referenceNode.parentNode.insertBefore(newNode,\r\n      referenceNode.nextSibling);\r\n  }\r\n}\r\n","import {createDiv} from '../common/cElement';\r\nimport {getElementById} from '../common/getElement';\r\nimport insertElement from '../common/insertElement';\r\nimport toggleForce from '../common/toggleForce';\r\n\r\nfunction doServerNode(topbannerStats, miniboxList) {\r\n  var nodeName = miniboxList.children[7].textContent;\r\n  var serverDiv = createDiv({\r\n    className: 'tip-static',\r\n    dataset: {tipped: 'Server'},\r\n    textContent: 'Server: ' + nodeName\r\n  });\r\n  insertElement(topbannerStats, serverDiv);\r\n}\r\n\r\nfunction doOnlinePlayers(topbannerStats, miniboxList) {\r\n  var playersOnline = miniboxList.children[3].innerHTML;\r\n  var bannerPlayers = topbannerStats.children[0];\r\n  bannerPlayers.innerHTML = 'Online: ' + playersOnline;\r\n}\r\n\r\nfunction statBoxesExist(topbannerStats, gameStats) {\r\n  var miniboxList = gameStats.nextElementSibling.children[0];\r\n  if (miniboxList.children.length === 8) {\r\n    doServerNode(topbannerStats, miniboxList);\r\n    doOnlinePlayers(topbannerStats, miniboxList);\r\n    toggleForce(gameStats.parentNode, true);\r\n  }\r\n}\r\n\r\nfunction validStatBoxes(topbannerStats, gameStats) {\r\n  var hidden = topbannerStats.classList.contains('topbanner-stats-hidden');\r\n  return topbannerStats && !hidden && gameStats;\r\n}\r\n\r\nexport default function injectServerNode() {\r\n  var topbannerStats = getElementById('topbanner-stats');\r\n  var h3coll = document.querySelectorAll('#pCR h3');\r\n  var gameStats = Array.prototype.find.call(h3coll, function(el) {\r\n    return el.textContent === 'Game Stats';\r\n  });\r\n  if (validStatBoxes(topbannerStats, gameStats)) {\r\n    statBoxesExist(topbannerStats, gameStats);\r\n  }\r\n}\r\n","import {getElementById} from '../common/getElement';\r\nimport {imageServer} from '../system/system';\r\nimport insertHtmlAfterBegin from '../common/insertHtmlAfterBegin';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport setValue from '../system/setValue';\r\n\r\nvar havePrayedMsg =\r\n  '<span class=\"notification-icon\"></span><p class=\"notification-content\">' +\r\n  'You are currently praying at the temple.</p>';\r\nvar godsNotification =\r\n  '<li class=\"notification\">' +\r\n  '<span id=\"helperPrayToGods\" class=\"fastPray\">' +\r\n  '<table><tbody><tr><td>' +\r\n  '<span class=\"tip-static\" data-tipped=\"Pray to Sahria\" ' +\r\n  'style=\"background-image: url(\\'' + imageServer +\r\n  '/temple/0.gif\\');\" praytype=\"0\"></span></td><td>' +\r\n  '<span class=\"tip-static\" data-tipped=\"Pray to Osverin\" ' +\r\n  'style=\"background-image: url(\\'' + imageServer +\r\n  '/temple/1.gif\\');\" praytype=\"1\"></span></td></tr><tr><td>' +\r\n  '<span class=\"tip-static\" data-tipped=\"Pray to Gurgriss\" ' +\r\n  'style=\"background-image: url(\\'' + imageServer +\r\n  '/temple/2.gif\\');\" praytype=\"2\"></span></td><td>' +\r\n  '<span class=\"tip-static\" data-tipped=\"Pray to Lindarsil\" ' +\r\n  'style=\"background-image: url(\\'' + imageServer +\r\n  '/temple/3.gif\\');\" praytype=\"3\"></span></td></tr></tbody></table>' +\r\n  '<a href=\"index.php?cmd=temple\">' +\r\n  '<p class=\"notification-content\">Bow down to the gods</p>' +\r\n  '</a></span></li>';\r\n\r\nfunction havePrayed() {\r\n  getElementById('helperPrayToGods').outerHTML = havePrayedMsg;\r\n  setValue('needToPray', false);\r\n  setValue('lastTempleCheck', new Date()\r\n    .setUTCHours(23, 59, 59, 999) + 1); // Midnight\r\n}\r\n\r\nfunction prayToGods(e) { // jQuery\r\n  var myGod = e.target.getAttribute('praytype');\r\n  if (!myGod) {return;}\r\n  getElementById('helperPrayToGods').removeEventListener('click',\r\n    prayToGods);\r\n  retryAjax('index.php?no_mobile=1&cmd=temple&subcmd=pray&type=' + myGod)\r\n    .done(havePrayed);\r\n  $(e.target).qtip('hide');\r\n}\r\n\r\nexport default function displayDisconnectedFromGodsMessage() {\r\n  insertHtmlAfterBegin(getElementById('notifications'), godsNotification);\r\n  getElementById('helperPrayToGods').addEventListener('click',\r\n    prayToGods);\r\n}\r\n","import calf from '../support/calf';\r\nimport createDocument from '../system/createDocument';\r\nimport displayDisconnectedFromGodsMessage\r\n  from './displayDisconnectedFromGodsMessage';\r\nimport setValue from '../system/setValue';\r\n\r\nfunction templeAlertEnabled(responseText) {\r\n  var checkNeedToPray;\r\n  var doc;\r\n  if (calf.cmd !== 'temple') {\r\n    doc = createDocument(responseText);\r\n  } else {\r\n    doc = document;\r\n  }\r\n  checkNeedToPray = doc.querySelector('input[value=\"Pray to Osverin\"]');\r\n  var needToPray = false;\r\n  if (checkNeedToPray) {\r\n    displayDisconnectedFromGodsMessage();\r\n    needToPray = true;\r\n  }\r\n  setValue('needToPray', needToPray);\r\n  setValue('lastTempleCheck', new Date()\r\n    .setUTCHours(23, 59, 59, 999) + 1); // midnight\r\n}\r\n\r\nexport function parseTemplePage(responseText) {\r\n  if (calf.enableTempleAlert) {templeAlertEnabled(responseText);}\r\n}\r\n","import calf from '../support/calf';\r\nimport displayDisconnectedFromGodsMessage\r\n  from './displayDisconnectedFromGodsMessage';\r\nimport getValue from '../system/getValue';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {now} from '../support/constants';\r\nimport {parseTemplePage} from './parseTemplePage';\r\nimport retryAjax from '../ajax/retryAjax';\r\n\r\nfunction checkLastUpdate(templeAlertLastUpdate) {\r\n  return !templeAlertLastUpdate || now > templeAlertLastUpdate;\r\n}\r\n\r\nfunction doWeNeedToParse() {\r\n  if (checkLastUpdate(getValue('lastTempleCheck'))) {\r\n    retryAjax('index.php?no_mobile=1&cmd=temple').done(parseTemplePage);\r\n  } else if (getValue('needToPray')) {\r\n    displayDisconnectedFromGodsMessage();\r\n  }\r\n}\r\n\r\nexport default function injectTempleAlert() { // jQuery\r\n  // Checks to see if the temple is open for business.\r\n  if (calf.cmd === 'temple' || jQueryNotPresent()) {return;}\r\n  doWeNeedToParse();\r\n}\r\n","import {getElementById} from '../common/getElement';\r\nimport insertHtmlAfterBegin from '../common/insertHtmlAfterBegin';\r\n\r\nvar goldUpgradeMsg =\r\n'<li class=\"notification\"><a href=\"index.php?cmd=points&type=1\"><span' +\r\n' class=\"notification-icon\"></span><p class=\"notification-content\">Up' +\r\n'grade stamina with gold</p></a></li>';\r\n\r\nexport default function displayUpgradeMsg() {\r\n  if (location.search.indexOf('cmd=points&type=1') === -1) {\r\n    insertHtmlAfterBegin(getElementById('notifications'), goldUpgradeMsg);\r\n  }\r\n}\r\n","import calf from '../support/calf';\r\nimport createDocument from '../system/createDocument';\r\nimport displayUpgradeMsg from './displayUpgradeMsg';\r\nimport setValue from '../system/setValue';\r\n\r\nfunction findDoc(data) {\r\n  if (location.search.indexOf('cmd=points&type=1') === -1) {\r\n    return createDocument(data);\r\n  }\r\n  document.querySelectorAll('#pCC input[name=\"quantity\"]')[1].value = '10';\r\n  return document;\r\n}\r\n\r\nfunction checkUpgrade(limit) {\r\n  var checkDoneUpgrade = limit.textContent.split(' / ');\r\n  if (checkDoneUpgrade[0] !== checkDoneUpgrade[1]) {\r\n    displayUpgradeMsg();\r\n    setValue('needToDoUpgrade', true);\r\n  } else {\r\n    setValue('needToDoUpgrade', false);\r\n    setValue('lastUpgradeCheck',\r\n      Date.parse(limit.nextElementSibling.textContent + ' GMT'));\r\n  }\r\n}\r\n\r\nexport default function parseGoldUpgrades(data) {\r\n  if (!calf.enableUpgradeAlert) {return;}\r\n  var doc = findDoc(data);\r\n  var tables = doc.querySelectorAll('#pCC > table');\r\n  if (tables.length > 0) {\r\n    var limit = tables[tables.length - 1].rows[3].cells[2];\r\n    checkUpgrade(limit);\r\n  }\r\n}\r\n","import add from '../support/task';\r\nimport displayUpgradeMsg from './displayUpgradeMsg';\r\nimport getValue from '../system/getValue';\r\nimport jQueryPresent from '../common/jQueryPresent';\r\nimport {now} from '../support/constants';\r\nimport parseGoldUpgrades from './parseGoldUpgrades';\r\nimport retryAjax from '../ajax/retryAjax';\r\n\r\nfunction checkLastUpgrade() {\r\n  var lastUpgradeCheck = getValue('lastUpgradeCheck');\r\n  if (lastUpgradeCheck && now < lastUpgradeCheck) {return;}\r\n  retryAjax('index.php?no_mobile=1&cmd=points&type=1').done(function(data) {\r\n    add(3, parseGoldUpgrades, [data]);\r\n  });\r\n}\r\n\r\nfunction notUpgradesPage() {\r\n  if (getValue('needToDoUpgrade')) {\r\n    displayUpgradeMsg();\r\n    return;\r\n  }\r\n  checkLastUpgrade();\r\n}\r\n\r\nexport default function injectUpgradeAlert() { // jQuery\r\n  if (jQueryPresent() && location.search.indexOf('cmd=points&type=1') === -1) {\r\n    notUpgradesPage();\r\n  }\r\n}\r\n","export default function insertElementAfterBegin(parentNode, newNode) {\r\n  if (parentNode instanceof Element) {\r\n    parentNode.insertBefore(newNode, parentNode.firstChild);\r\n  }\r\n}\r\n","function getPos(available, desired, offset) {\r\n  return Math.floor(Math.max(available - desired, 0) / 2 + offset);\r\n}\r\n\r\nfunction fshOpen(url, title, w, _h, features) {\r\n  var h = _h;\r\n  if (_h === 500) {h = 1000;}\r\n  var top = getPos(window.screen.availHeight, h, window.screenY);\r\n  var left = getPos(document.documentElement.clientWidth, w, window.screenX);\r\n  window.open(url, title, 'width=' + w + ', height=' + h + ', left=' + left +\r\n    ', top=' + top + features);\r\n}\r\n\r\nexport default function interceptQuickBuff() {\r\n  window.openWindow = fshOpen;\r\n}\r\n\r\n// export default function interceptQuickBuff() {\r\n//   window.openWindow = fshOpen;\r\n//   export default function interceptQuickBuff(url, title, w, h, features) {\r\n\r\n//   var pixelRatio = window.devicePixelRatio;\r\n\r\n//   var chrome = 1;\r\n//   if (navigator.userAgent.includes('Chrome')) {\r\n//     chrome = pixelRatio;\r\n//   }\r\n\r\n//   var docHeightInCss = document.documentElement.clientHeight;\r\n//   var screenYInCss = Math.floor(window.screenY / chrome);\r\n//   var desiredHeightInCss = Math.min(h, window.screen.availHeight);\r\n\r\n//   var docWidthInCss = document.documentElement.clientWidth;\r\n//   var screenXInCss = Math.floor(window.screenX / chrome);\r\n//   var desiredWidthInCss = w;\r\n\r\n//   console.log('pixelRatio', pixelRatio);\r\n//   console.log('docHeightInCss', docHeightInCss);\r\n//   console.log('screenYInCss', screenYInCss);\r\n//   console.log('desiredHeightInCss', desiredHeightInCss);\r\n//   console.log('docWidthInCss', docWidthInCss);\r\n//   console.log('screenXInCss', screenXInCss);\r\n//   console.log('desiredWidthInCss', desiredWidthInCss);\r\n\r\n//   var topInCss = Math.floor(\r\n//     (docHeightInCss - desiredHeightInCss) / 2 + screenYInCss\r\n//   );\r\n\r\n//   var leftInCss = Math.floor(\r\n//     (docWidthInCss - desiredWidthInCss) / 2 + screenXInCss\r\n//   );\r\n\r\n//   window.open(url, title,\r\n//     'width=' + Math.floor(desiredWidthInCss * chrome) +\r\n//     ', height=' + Math.floor(desiredHeightInCss * chrome) +\r\n//     ', top=' + Math.floor(topInCss * chrome) +\r\n//     ', left=' + Math.floor(leftInCss * chrome) +\r\n//     features);\r\n// }\r\n","import jQueryNotPresent from '../common/jQueryNotPresent';\r\n\r\nexport default function navMenu() { // jQuery\r\n  if (jQueryNotPresent()) {return;}\r\n  var myNav = $('#nav').data('nav');\r\n  if (!myNav) {return;}\r\n  var oldSave = myNav._saveState;\r\n  myNav._saveState = function(_id) {\r\n    var id = _id;\r\n    var myHeight = $('li.nav-level-0', '#nav').eq(id).find('ul').height();\r\n    if (myHeight === 0) {id = -1;}\r\n    oldSave.call(myNav, id);\r\n  };\r\n}\r\n","export default function outputFormat(value, suffix) {\r\n  if (value === 0) {return '';}\r\n  return value.toString() + suffix;\r\n}\r\n","import {nowSecs} from '../support/constants';\r\nimport outputFormat from './outputFormat';\r\n\r\nexport default function formatLastActivity(last_login) {\r\n  var s = Math.abs(nowSecs - last_login);\r\n  var m = Math.floor(s / 60);\r\n  s %= 60;\r\n  var h = Math.floor(m / 60);\r\n  m %= 60;\r\n  var d = Math.floor(h / 24);\r\n  h %= 24;\r\n  return outputFormat(d, ' days, ') + outputFormat(h, ' hours, ') +\r\n    outputFormat(m, ' mins, ') + s + ' secs';\r\n}\r\n","import retryAjax from './retryAjax';\r\n\r\nexport default function getProfile(username) {\r\n  return retryAjax({\r\n    url: 'index.php',\r\n    data: {\r\n      cmd: 'export',\r\n      subcmd: 'profile',\r\n      player_username: username\r\n    },\r\n    dataType: 'json'\r\n  });\r\n}\r\n","import calf from '../support/calf';\r\nimport getForage from './getForage';\r\nimport getProfile from './getProfile';\r\nimport {now} from '../support/constants';\r\nimport playerName from '../common/playerName';\r\nimport setForage from './setForage';\r\n\r\nfunction sendMyProfileToForage(data) {\r\n  setForage('fsh_selfProfile', data);\r\n}\r\n\r\nfunction addLastUpdateDate(data) {\r\n  data.lastUpdate = now;\r\n  return data;\r\n}\r\n\r\nfunction getMyProfile() {\r\n  return getProfile(playerName())\r\n    .pipe(addLastUpdateDate)\r\n    .done(sendMyProfileToForage);\r\n}\r\n\r\nfunction getProfileFromForage(data) {\r\n  if (!data || data.lastUpdate < now -\r\n    calf.allyEnemyOnlineRefreshTime) {\r\n    return getMyProfile();\r\n  }\r\n  return data;\r\n}\r\n\r\nexport default function myStats(force) {\r\n  if (force) {return getMyProfile();}\r\n  // jQuery 1.7 uses pipe instead of then\r\n  return getForage('fsh_selfProfile')\r\n    .pipe(getProfileFromForage);\r\n}\r\n","export default function openQuickBuffByName(aPlayerName) {\r\n  window.openWindow('index.php?cmd=quickbuff&t=' + aPlayerName,\r\n    'fsQuickBuff', 618, 1000, ',scrollbars');\r\n}\r\n","import add from '../support/task';\r\nimport calf from '../support/calf';\r\nimport {createDiv} from '../common/cElement';\r\nimport fallback from '../system/fallback';\r\nimport formatLastActivity from '../system/formatLastActivity';\r\nimport {getElementById} from '../common/getElement';\r\nimport insertElementAfterBegin from '../common/insertElementAfterBegin';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport myStats from '../ajax/myStats';\r\nimport {nowSecs} from '../support/constants';\r\nimport openQuickBuffByName from '../common/openQuickBuffByName';\r\nimport {pCR} from '../support/layout';\r\n\r\nvar buffCheck = '<span class=\"enemy-buff-check-on\"></span>';\r\nvar msgButton = '<span class=\"enemy-send-message guild-icon left ' +\r\n  'guild-minibox-action tip-static\" data-tipped=\"Send Message\"></span>';\r\nvar buffButton = '<span class=\"enemy-quickbuff guild-icon left ' +\r\n  'guild-minibox-action tip-static\" data-tipped=\"Quick Buff\"></span>';\r\n\r\nvar contactClass = [\r\n  {\r\n    condition: function(n) {return n < 120;},\r\n    ally: 'fshDodgerBlue',\r\n    enemy: 'fshRed'\r\n  },\r\n  {\r\n    condition: function(n) {return n < 300;},\r\n    ally: 'fshDodgerBlue',\r\n    enemy: 'fshRed'\r\n  },\r\n  {\r\n    condition: function() {return true;},\r\n    ally: 'fshPowderBlue',\r\n    enemy: 'fshPink'\r\n  }\r\n];\r\n\r\nfunction allyOrEnemy(type, test) {\r\n  if (type) {return test.ally;}\r\n  return test.enemy;\r\n}\r\n\r\nfunction contactColor(last_login, type) {\r\n  for (var i = 0; i < contactClass.length; i += 1) {\r\n    var test = contactClass[i];\r\n    if (test.condition(nowSecs - last_login)) {\r\n      return allyOrEnemy(type, test);\r\n    }\r\n  }\r\n  return 'fshWhite';\r\n}\r\n\r\nfunction playerName(val, type) {\r\n  return '<a class=\"player-name tip-static ' +\r\n    contactColor(val.last_login, type) +\r\n    '\" data-tipped=\"<b>' + val.username + '</b><br><table><tbody><tr>' +\r\n    '<td>Level:</td><td>' + val.level + '</td></tr><tr><td>Last ' +\r\n    'Activity:</td><td>' + formatLastActivity(val.last_login) +\r\n    '</td></tr></tbody></table>\" href=\"index.php?cmd=profile&player_id=' +\r\n    val.id + '\">' + val.username + '</a>';\r\n}\r\n\r\nfunction doBuffCheck() {\r\n  if (!calf.hideBuffSelected) {\r\n    return buffCheck;\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction doMsgButton() {\r\n  if (!calf.hideGuildInfoMessage) {\r\n    return msgButton;\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction doBuffButton() {\r\n  if (!calf.hideGuildInfoBuff) {\r\n    return buffButton;\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction doSecureButton(val) {\r\n  if (!calf.hideGuildInfoSecureTrade) {\r\n    return '<a class=\"enemy-secure-trade guild-icon left ' +\r\n      'guild-minibox-action tip-static\" href=\"index.php?cmd=trade' +\r\n      '&subcmd=createsecure&target_username=' + val.username +\r\n      '\" data-tipped=\"Secure Trade\"></a>';\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction doTradeButton(val) {\r\n  if (!calf.hideGuildInfoTrade) {\r\n    return '<a class=\"enemy-trade guild-icon left ' +\r\n      'guild-minibox-action tip-static\" href=\"index.php?cmd=trade' +\r\n      '&target_player=' + val.username +\r\n      '\" data-tipped=\"Send Gold/Items/FSP\"></a>';\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction addContact(contactList, type) {\r\n  var output = '';\r\n  contactList.forEach(function(val) {\r\n    if (nowSecs - val.last_login > 1800) {return;} // 30 mins\r\n    output += '<li class=\"player\"><div class=\"player-row\">';\r\n    output += doBuffCheck();\r\n    output += playerName(val, type);\r\n    output += '</div><div class=\"guild-minibox-actions\">';\r\n    output += doMsgButton();\r\n    output += doBuffButton();\r\n    output += doSecureButton(val);\r\n    output += doTradeButton(val);\r\n    output += '</div></li>';\r\n  });\r\n  return output;\r\n}\r\n\r\nvar noAlliesTests = [\r\n  function(allies, enemies) {return allies.length + enemies.length;},\r\n  function(allies, enemies) {\r\n    if (!calf.enableAllyOnlineList) {return enemies.length;}\r\n  },\r\n  function(allies) {\r\n    if (!calf.enableEnemyOnlineList) {return allies.length;}\r\n  }\r\n];\r\n\r\nfunction noAllies(allies, enemies) {\r\n  return noAlliesTests.every(function(e) {return e(allies, enemies) === 0;});\r\n}\r\n\r\nfunction hazAllies(allies, enemies) {\r\n  var output = '';\r\n  if (calf.enableAllyOnlineList) {\r\n    output += addContact(allies, true);\r\n  }\r\n  if (calf.enableEnemyOnlineList) {\r\n    output += addContact(enemies, false);\r\n  }\r\n  var fshContactList = getElementById('fshContactList');\r\n  fshContactList.innerHTML = '';\r\n  insertHtmlBeforeEnd(fshContactList, output);\r\n}\r\n\r\nfunction injectAllyEnemyList(data) {\r\n  var allies = fallback(data._allies, []);\r\n  var enemies = fallback(data._enemies, []);\r\n  if (noAllies(allies, enemies)) {return;}\r\n  hazAllies(allies, enemies);\r\n}\r\n\r\nfunction resetList() { // jQuery.min\r\n  myStats(true).done(injectAllyEnemyList);\r\n}\r\n\r\nfunction toggleBuffSelected(self) {\r\n  self.classList.toggle('enemy-buff-check-on');\r\n  self.classList.toggle('enemy-buff-check-off');\r\n}\r\n\r\nfunction msgPlayer(self) {\r\n  window.openQuickMsgDialog(self.parentNode.previousElementSibling\r\n    .lastElementChild.textContent);\r\n}\r\n\r\nfunction buffPlayer(self) {\r\n  openQuickBuffByName(self.parentNode\r\n    .previousElementSibling.lastElementChild.textContent);\r\n}\r\n\r\nfunction selectedBuff() {\r\n  var buffBalls = getElementById('fshContactList')\r\n    .getElementsByClassName('enemy-buff-check-on');\r\n  var sendstring = Array.prototype.reduce.call(buffBalls,\r\n    function(prev, curr) {\r\n      prev.push(curr.nextElementSibling.textContent);\r\n      return prev;\r\n    }, []);\r\n  openQuickBuffByName(sendstring.join());\r\n}\r\n\r\nvar classEvt = [\r\n  {className: 'enemy-buff-check-on', handler: toggleBuffSelected},\r\n  {className: 'enemy-buff-check-off', handler: toggleBuffSelected},\r\n  {className: 'enemy-send-message', handler: msgPlayer},\r\n  {className: 'enemy-quickbuff', handler: buffPlayer},\r\n  {className: 'enemy-quick-buff', handler: selectedBuff}\r\n];\r\n\r\nfunction eventHandler(evt) {\r\n  var self = evt.target;\r\n  if (self.id === 'fshResetEnemy') {\r\n    resetList();\r\n    return;\r\n  }\r\n  classEvt.some(function(test) {\r\n    if (self.classList.contains(test.className)) {\r\n      test.handler(self);\r\n      return true;\r\n    }\r\n    return false;\r\n  });\r\n}\r\n\r\nfunction makeDiv(data) {\r\n  var fshAllyEnemy = createDiv({\r\n    id: 'fshAllyEnemy',\r\n    className: 'minibox'\r\n  });\r\n  var wrapper = '<h3>Allies/Enemies</h3><div class=\"minibox-content\">' +\r\n    '<h4>Online Contacts <span id=\"fshResetEnemy\">Reset</span></h4>' +\r\n    '<div id=\"minibox-enemy\"><ul id=\"fshContactList\"></ul>';\r\n  if (!calf.hideBuffSelected) {\r\n    wrapper += '<ul class=\"enemy-quick-buff\">Quick Buff Selected</ul>';\r\n  }\r\n  wrapper += '</div></div>';\r\n  insertHtmlBeforeEnd(fshAllyEnemy, wrapper);\r\n  insertElementAfterBegin(pCR, fshAllyEnemy);\r\n  fshAllyEnemy.addEventListener('click', eventHandler);\r\n  injectAllyEnemyList(data);\r\n}\r\n\r\nexport default function prepareAllyEnemyList() { // jQuery.min\r\n  if (jQueryNotPresent()) {return;}\r\n  myStats(false)\r\n    .done(function(data) {\r\n      add(3, makeDiv, [data]);\r\n    });\r\n}\r\n","import {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport getValueJSON from '../system/getValueJSON';\r\nimport {nowSecs} from '../support/constants';\r\nimport setValue from '../system/setValue';\r\n\r\nexport var bountyList;\r\nexport var wantedList;\r\nexport var activeBountyListPosted;\r\nvar bountyListRefreshTime;\r\nexport var bwNeedsRefresh;\r\nvar wantedNames;\r\nexport var wantedArray;\r\nexport var bountyUrl = 'index.php?no_mobile=1&cmd=bounty&page=';\r\n\r\nfunction parseActiveBounty(activeTable) { // Legacy\r\n  if (!/No bounties active/.test(activeTable.rows[1].cells[0].innerHTML)) {\r\n    for (var i = 1; i < activeTable.rows.length - 2; i += 2) {\r\n      var theCells = activeTable.rows[i].cells;\r\n      var thisBounty = {};\r\n      thisBounty.target = theCells[0].firstChild\r\n        .firstChild.firstChild.textContent;\r\n      thisBounty.link = theCells[0].firstChild.firstChild.href;\r\n      thisBounty.lvl = theCells[0].firstChild\r\n        .firstChild.nextSibling.textContent\r\n        .replace(/\\[/, '').replace(/\\]/, '');\r\n      thisBounty.reward = theCells[2].textContent;\r\n      thisBounty.rewardType = theCells[2]\r\n        .firstChild.firstChild.firstChild.firstChild\r\n        .nextSibling.firstChild.title;\r\n      thisBounty.posted = theCells[3].textContent;\r\n      thisBounty.xpLoss = theCells[4].textContent;\r\n      thisBounty.progress = theCells[5].textContent;\r\n      bountyList.bounty.push(thisBounty);\r\n    }\r\n  }\r\n}\r\n\r\nexport function getActiveBountyList(doc) { // Legacy\r\n  var activeTable = getElementById('bounty-info', doc).parentNode.parentNode\r\n    .previousElementSibling.children[0].children[0];\r\n  bountyList = {};\r\n  bountyList.bounty = [];\r\n  bountyList.isRefreshed = true;\r\n  bountyList.lastUpdate = nowSecs;\r\n  if (activeTable) {parseActiveBounty(activeTable);}\r\n  activeBountyListPosted = true;\r\n}\r\n\r\nfunction testBountyList() {\r\n  return bountyList &&\r\n    nowSecs - bountyList.lastUpdate > bountyListRefreshTime;\r\n}\r\n\r\nfunction testWantedList() {\r\n  return wantedList &&\r\n    nowSecs - wantedList.lastUpdate > bountyListRefreshTime;\r\n}\r\n\r\nfunction testCacheInvalid() {\r\n  return testBountyList() || testWantedList();\r\n}\r\n\r\nexport function invalidateCache() {\r\n  bountyList = getValueJSON('bountyList');\r\n  wantedList = getValueJSON('wantedList');\r\n  bountyListRefreshTime = getValue('bountyListRefreshTime');\r\n  bwNeedsRefresh = getValue('bwNeedsRefresh');\r\n  if (bwNeedsRefresh) {return;}\r\n  if (testCacheInvalid()) {\r\n    bwNeedsRefresh = true; // invalidate cache\r\n  }\r\n}\r\n\r\nexport function doRefresh() {\r\n  wantedList = {};\r\n  wantedList.bounty = [];\r\n  wantedList.isRefreshed = true;\r\n  wantedList.lastUpdate = nowSecs;\r\n  activeBountyListPosted = false;\r\n  wantedNames = getValue('wantedNames');\r\n  wantedArray = wantedNames.split(/\\s*,\\s*/);\r\n  setValue('bwNeedsRefresh', false);\r\n}\r\n","import calf from '../support/calf';\r\nimport {wantedArray, wantedList} from './lists';\r\n\r\nvar thisBounty;\r\n\r\nfunction acceptBtn(action, cell) {\r\n  if (action !== '[n/a]') {\r\n    return cell.firstChild.firstChild.getAttribute('onclick');\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction getTarget(target, theRow) {\r\n  thisBounty = {};\r\n  thisBounty.target = target;\r\n  thisBounty.link = theRow.cells[0].firstChild.firstChild.href;\r\n  thisBounty.lvl = theRow.cells[0].firstChild.firstChild.nextSibling\r\n    .textContent.replace(/\\[/, '').replace(/\\]/, '');\r\n  thisBounty.offerer = theRow.cells[1].firstChild.firstChild.firstChild\r\n    .textContent;\r\n  thisBounty.reward = theRow.cells[2].textContent;\r\n  thisBounty.rewardType = theRow.cells[2].firstChild.firstChild.firstChild\r\n    .firstChild.nextSibling.firstChild.title;\r\n  thisBounty.xpLoss = theRow.cells[3].textContent;\r\n  thisBounty.posted = theRow.cells[4].textContent;\r\n  thisBounty.tickets = theRow.cells[5].textContent;\r\n  thisBounty.accept = acceptBtn(theRow.cells[6].textContent.trim(),\r\n    theRow.cells[6]);\r\n  wantedList.bounty.push(thisBounty);\r\n}\r\n\r\nvar isWanted = [\r\n  function() {return wantedArray.includes('*');},\r\n  function(target) {return wantedArray.includes(target);},\r\n  function(target, theRow) {\r\n    return calf.wantedGuildMembers &&\r\n      theRow.cells[6].textContent.trim() === '[n/a]';\r\n  }\r\n];\r\n\r\nfunction wantedTarget(target, theRow) {\r\n  if (theRow.cells[6].textContent.trim() !== '[active]' &&\r\n      isWanted.some(function(el) {return el(target, theRow);})) {\r\n    getTarget(target, theRow);\r\n  }\r\n}\r\n\r\nexport default function findTarget(activeTable) {\r\n  for (var i = 1; i < activeTable.rows.length - 2; i += 2) {\r\n    var theRow = activeTable.rows[i];\r\n    var target = theRow.cells[0].firstChild\r\n      .firstChild.firstChild.textContent;\r\n    if (target === '[ No bounties available. ]') {break;}\r\n    wantedTarget(target, theRow);\r\n  }\r\n}\r\n","import calf from '../support/calf';\r\nimport {createDiv} from '../common/cElement';\r\nimport insertElementAfterBegin from '../common/insertElementAfterBegin';\r\nimport {pCR} from '../support/layout';\r\n\r\nexport var bountyListDiv;\r\nexport var wantedListDiv;\r\n\r\nfunction createMiniBox() {\r\n  return createDiv({className: 'minibox'});\r\n}\r\n\r\nexport function createDivs() {\r\n  if (calf.enableWantedList) {\r\n    wantedListDiv = createMiniBox();\r\n    insertElementAfterBegin(pCR, wantedListDiv);\r\n  }\r\n  if (calf.enableActiveBountyList) {\r\n    bountyListDiv = createMiniBox();\r\n    insertElementAfterBegin(pCR, bountyListDiv);\r\n  }\r\n}\r\n","import {bountyList} from './lists';\r\nimport {bountyListDiv} from './createDivs';\r\nimport insertElement from '../common/insertElement';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\nimport setValueJSON from '../system/setValueJSON';\r\nimport {createDiv, createSpan} from '../common/cElement';\r\n\r\nexport var bountyListReset;\r\n\r\nfunction makeMouseOver(el) {\r\n  return 'Level:  ' + el.lvl +\r\n    '<br>Reward: ' + el.reward + ' ' + el.rewardType +\r\n    '<br>XP Loss Remaining: ' + el.xpLoss +\r\n    '<br>Progress:  ' + el.progress;\r\n}\r\n\r\nexport function injectBountyList() { // Legacy\r\n  setValueJSON('bountyList', bountyList);\r\n\r\n  bountyListDiv.innerHTML = '';\r\n\r\n  var heading = createDiv({textContent: 'Active Bounties '});\r\n  bountyListReset = createSpan({className: 'xxsLink', textContent: 'Reset'});\r\n  insertElement(heading, bountyListReset);\r\n  insertElement(bountyListDiv, heading);\r\n\r\n  var output = '';\r\n  if (bountyList.bounty.length === 0) {\r\n    output += '<div class=\"xsOrange\">[No active bounties]</div>';\r\n  } else {\r\n    for (var i = 0; i < bountyList.bounty.length; i += 1) {\r\n      output += '<a href=\"' + bountyList.bounty[i].link +\r\n        '\" class=\"tip-static\" data-tipped=\"' +\r\n        makeMouseOver(bountyList.bounty[i]) + '\">' +\r\n        bountyList.bounty[i].target + '</a><br>';\r\n    }\r\n  }\r\n  insertHtmlBeforeEnd(bountyListDiv, output);\r\n}\r\n","import insertElement from '../common/insertElement';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\nimport setValueJSON from '../system/setValueJSON';\r\nimport {wantedList} from './lists';\r\nimport {wantedListDiv} from './createDivs';\r\nimport {createDiv, createSpan} from '../common/cElement';\r\n\r\nexport var wantedListReset;\r\n\r\nfunction makeMouseOver(el) {\r\n  return 'Target Level:  ' + el.lvl +\r\n    '<br>Offerer: ' + el.offerer +\r\n    '<br>Reward: ' + el.reward + ' ' + el.rewardType +\r\n    '<br>XP Loss Remaining: ' + el.xpLoss +\r\n    '<br>Posted: ' + el.posted +\r\n    '<br>Tickets Req.:  ' + el.tickets;\r\n}\r\n\r\nfunction acceptBtn(bounty) {\r\n  if (bounty.accept) {\r\n    return '<span class=\"xsGreen\" onclick=\"' + bounty.accept +\r\n      '\">[a]</span>&nbsp;';\r\n  }\r\n  return '';\r\n}\r\n\r\nexport function injectWantedList() { // Legacy\r\n  setValueJSON('wantedList', wantedList);\r\n\r\n  wantedListDiv.innerHTML = '';\r\n\r\n  var heading = createDiv({textContent: 'Wanted Bounties '});\r\n  wantedListReset = createSpan({className: 'xxsLink', textContent: 'Reset'});\r\n  insertElement(heading, wantedListReset);\r\n  insertElement(wantedListDiv, heading);\r\n\r\n  var output = '';\r\n  if (wantedList.bounty.length === 0) {\r\n    output += '<div class=\"xsOrange\">[No wanted bounties]</div>';\r\n  } else {\r\n    for (var i = 0; i < wantedList.bounty.length; i += 1) {\r\n      output += acceptBtn(wantedList.bounty[i]) +\r\n        '<a class=\"xsKhaki tip-static\" data-tipped=\"' +\r\n        makeMouseOver(wantedList.bounty[i]) +\r\n        '\" href=\"' + wantedList.bounty[i].link + '\">' +\r\n        wantedList.bounty[i].target + '</a><br>';\r\n    }\r\n  }\r\n  insertHtmlBeforeEnd(wantedListDiv, output);\r\n}\r\n","import calf from '../support/calf';\r\nimport createDocument from '../system/createDocument';\r\nimport findTarget from './findTarget';\r\nimport {getElementById} from '../common/getElement';\r\nimport {injectBountyList} from './injectBountyList';\r\nimport {injectWantedList} from './injectWantedList';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport {activeBountyListPosted, bountyUrl, getActiveBountyList} from './lists';\r\n\r\nvar curPage;\r\nvar maxPage;\r\n\r\nfunction getWantedBountyList(doc) {\r\n  var page = doc.querySelector('#pCC input[name=\"page\"]');\r\n  if (!page) {return;}\r\n  curPage = Number(page.value);\r\n  maxPage = Number(page.parentNode.innerHTML.match(/of&nbsp;(\\d*)/)[1]);\r\n  var activeTable = getElementById('bounty-info', doc).parentNode.parentNode\r\n    .nextElementSibling.children[0].children[0];\r\n  if (activeTable) {findTarget(activeTable);}\r\n}\r\n\r\nfunction hazActiveBountyList(doc) {\r\n  if (calf.enableActiveBountyList && !activeBountyListPosted) {\r\n    getActiveBountyList(doc);\r\n    injectBountyList();\r\n  }\r\n}\r\n\r\nexport function parseBountyPageForWorld(details) {\r\n  var doc = createDocument(details);\r\n  hazActiveBountyList(doc);\r\n  if (calf.enableWantedList) {\r\n    getWantedBountyList(doc);\r\n    if (curPage < maxPage) {\r\n      retryAjax(bountyUrl + (curPage + 1).toString())\r\n        .done(parseBountyPageForWorld);\r\n    } else {\r\n      injectWantedList();\r\n    }\r\n  }\r\n}\r\n","import calf from '../support/calf';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {parseBountyPageForWorld} from './parseBountyPageForWorld';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport setValueJSON from '../system/setValueJSON';\r\nimport {\r\n  bountyList,\r\n  bountyUrl,\r\n  bwNeedsRefresh,\r\n  doRefresh,\r\n  invalidateCache,\r\n  wantedList\r\n} from './lists';\r\nimport {bountyListDiv, createDivs, wantedListDiv} from './createDivs';\r\nimport {bountyListReset, injectBountyList} from './injectBountyList';\r\nimport {injectWantedList, wantedListReset} from './injectWantedList';\r\n\r\nfunction notRefreshed(enableActiveBountyList, enableWantedList) {\r\n  if (enableWantedList) {\r\n    wantedList.isRefreshed = false;\r\n    injectWantedList(wantedList);\r\n  }\r\n  if (enableActiveBountyList) {\r\n    bountyList.isRefreshed = false;\r\n    injectBountyList(bountyList);\r\n  }\r\n}\r\n\r\nvar refreshConditions = [\r\n  function() {return !bountyList;},\r\n  function() {return !wantedList;},\r\n  function() {return bwNeedsRefresh;}\r\n];\r\n\r\nfunction needsRefresh() {\r\n  return refreshConditions.some(function(el) {\r\n    return el();\r\n  });\r\n}\r\n\r\nfunction retrieveBountyInfo(enableActiveList, enableWantedList) {\r\n  invalidateCache();\r\n  if (needsRefresh()) {\r\n    doRefresh();\r\n    retryAjax(bountyUrl + '1').done(parseBountyPageForWorld);\r\n  } else {\r\n    notRefreshed(enableActiveList, enableWantedList);\r\n  }\r\n}\r\n\r\nfunction resetList(e) {\r\n  if (e.target === bountyListReset) {\r\n    setValueJSON('bountyList', null);\r\n    retrieveBountyInfo(calf.enableActiveBountyList, calf.enableWantedList);\r\n  }\r\n  if (e.target === wantedListReset) {\r\n    setValueJSON('wantedList', null);\r\n    retrieveBountyInfo(calf.enableActiveBountyList, calf.enableWantedList);\r\n  }\r\n}\r\n\r\nfunction doHandlers() {\r\n  if (bountyListDiv) {bountyListDiv.addEventListener('click', resetList);}\r\n  if (wantedListDiv) {wantedListDiv.addEventListener('click', resetList);}\r\n}\r\n\r\nexport function prepareBountyData() {\r\n  if (jQueryNotPresent()) {return;}\r\n  createDivs();\r\n  doHandlers();\r\n  retrieveBountyInfo(calf.enableActiveBountyList, calf.enableWantedList);\r\n}\r\n","import getValue from '../system/getValue';\r\nimport infoBox from '../common/infoBox';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport setValue from '../system/setValue';\r\n\r\nvar sendGoldonWorld;\r\n\r\nexport function doSendGold() { // jQuery\r\n  if (!sendGoldonWorld) {return;}\r\n  retryAjax({\r\n    url: 'index.php',\r\n    data: {\r\n      no_mobile: 1,\r\n      cmd: 'trade',\r\n      subcmd: 'sendgold',\r\n      xc: window.ajaxXC,\r\n      target_username: $('#HelperSendTo').html(),\r\n      gold_amount: $('#HelperSendAmt').html().replace(/[^\\d]/g, '')\r\n    }\r\n  }).done(function(data) {\r\n    var info = infoBox(data);\r\n    if (info === 'You successfully sent gold!' || info === '') {\r\n      setValue('currentGoldSentTotal',\r\n        parseInt(getValue('currentGoldSentTotal'), 10) +\r\n        parseInt(getValue('goldAmount'), 10));\r\n      GameData.fetch(1);\r\n    }\r\n  });\r\n}\r\n\r\nexport function injectSendGoldOnWorld() { // jQuery\r\n  sendGoldonWorld = getValue('sendGoldonWorld');\r\n  if (!sendGoldonWorld) {return;}\r\n  $('#statbar-gold-tooltip-general').append(\r\n    '<dt class=\"stat-gold-sendTo\">Send To:</dt>' +\r\n    '<dd id=\"HelperSendTo\">' + getValue('goldRecipient') +\r\n    '</dd>' +\r\n    '<dt class=\"stat-gold-sendAmt\">Amount:</dt>' +\r\n    '<dd id=\"HelperSendAmt\">' + getValue('goldAmount')\r\n      .replace(/(\\d)(?=(\\d\\d\\d)+(?!\\d))/g, '$1,') + '</dd>' +\r\n    '<dt class=\"stat-gold-sendTo\">Send?</dt>' +\r\n    '<dd><input id=\"HelperSendGold\" value=\"Send!\" class=\"custombutton\" ' +\r\n    'type=\"submit\"><input type=\"hidden\" id=\"xc\" value=\"\"</dd>' +\r\n    '<dt class=\"stat-gold-sendTotal\">Total Sent:</dt>' +\r\n    '<dd id=\"HelperSendTotal\">' +\r\n      getValue('currentGoldSentTotal')\r\n        .toString()\r\n        .replace(/(\\d)(?=(\\d\\d\\d)+(?!\\d))/g, '$1,') +\r\n      '</dd>');\r\n  $('#HelperSendGold').click(doSendGold);\r\n}\r\n\r\nfunction updateGoldValue(data) {\r\n  $('#HelperSendTotal')\r\n    .html(getValue('currentGoldSentTotal')\r\n      .toString()\r\n      .replace(/(\\d)(?=(\\d\\d\\d)+(?!\\d))/g, '$1,'));\r\n  if (parseInt(data.player.gold, 10) > getValue('goldAmount')) {\r\n    $('#statbar-gold').css('background-color', 'red');\r\n  } else {\r\n    $('#statbar-gold').css('background-color', 'inherit');\r\n  }\r\n}\r\n\r\nexport function updateSendGoldOnWorld(data) { // jQuery\r\n  if (data.player && sendGoldonWorld) {\r\n    updateGoldValue(data);\r\n  }\r\n}\r\n","import calf from '../support/calf';\r\nimport createDocument from '../system/createDocument';\r\nimport {doSendGold} from '../newMap/sendGold';\r\nimport findNode from '../system/findNode';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport insertQuickWear from '../quickWear/quickWear';\r\nimport jQueryDialog from './jQueryDialog';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport {sendEvent} from '../support/fshGa';\r\n\r\nvar expandMenuOnKeyPress;\r\n\r\nfunction movePage(dir) { // Legacy\r\n  var dirButton = findNode('//input[@value=\"' + dir + '\"]');\r\n  if (!dirButton) {return;}\r\n  var url = dirButton.getAttribute('onClick');\r\n  url = url.replace(/^[^']*'/m, '').replace(/';$/m, '');\r\n  location.href = url;\r\n}\r\n\r\nfunction changeCombatSet(responseText, itemIndex) { // jQuery.min\r\n  var doc = createDocument(responseText);\r\n\r\n  var cbsSelect = doc.querySelector(\r\n    '#profileCombatSetDiv select[name=\"combatSetId\"]');\r\n\r\n  // find the combat set id value\r\n  var allItems = cbsSelect.getElementsByTagName('option');\r\n  if (itemIndex >= allItems.length) {return;}\r\n  var cbsIndex = allItems[itemIndex].value;\r\n\r\n  retryAjax({\r\n    url: 'index.php',\r\n    data: {\r\n      no_mobile: 1,\r\n      cmd: 'profile',\r\n      subcmd: 'managecombatset',\r\n      combatSetId: cbsIndex,\r\n      submit: 'Use'\r\n    },\r\n    success: function() {\r\n      if (expandMenuOnKeyPress) {\r\n        localStorage.setItem('hcs.nav.openIndex', '2');\r\n      }\r\n      location.href = 'index.php?cmd=profile';\r\n    }\r\n  });\r\n}\r\n\r\nfunction doRepair() {\r\n  // do not use repair link for new map\r\n  if (!getElementById('worldPage')) {\r\n    location.href = 'index.php?cmd=blacksmith&subcmd=repairall&fromworld=1';\r\n  }\r\n}\r\n\r\nfunction createGroup() {\r\n  if (expandMenuOnKeyPress) {localStorage.setItem('hcs.nav.openIndex', '4');}\r\n  location.href =\r\n    'index.php?cmd=guild&subcmd=groups&subcmd2=create&fromworld=1';\r\n}\r\n\r\nfunction logPage() {\r\n  if (expandMenuOnKeyPress) {localStorage.setItem('hcs.nav.openIndex', '2');}\r\n  location.href = 'index.php?cmd=log';\r\n}\r\n\r\nfunction gotoGuild() {\r\n  if (expandMenuOnKeyPress) {localStorage.setItem('hcs.nav.openIndex', '4');}\r\n  location.href = 'index.php?cmd=guild&subcmd=manage';\r\n}\r\n\r\nfunction joinAllGroup() {\r\n  if (expandMenuOnKeyPress) {localStorage.setItem('hcs.nav.openIndex', '4');}\r\n  if (!getValue('enableMaxGroupSizeToJoin')) {\r\n    location.href = 'index.php?cmd=guild&subcmd=groups&subcmd2=joinall';\r\n  } else {\r\n    location.href =\r\n      'index.php?cmd=guild&subcmd=groups&subcmd2=joinallgroupsundersize';\r\n  }\r\n}\r\n\r\nfunction backpack() {\r\n  if (expandMenuOnKeyPress) {localStorage.setItem('hcs.nav.openIndex', '2');}\r\n  location.href = 'index.php?cmd=profile&subcmd=dropitems';\r\n}\r\n\r\nfunction fastWearMgr() {\r\n  if (!('dialogIsClosed' in calf) || calf.dialogIsClosed()) {\r\n    sendEvent('keyHandler', 'insertQuickWear');\r\n    jQueryDialog(insertQuickWear);\r\n  }\r\n}\r\n\r\nfunction profile() {\r\n  if (expandMenuOnKeyPress) {localStorage.setItem('hcs.nav.openIndex', '2');}\r\n  location.href = 'index.php?cmd=profile';\r\n}\r\n\r\nfunction combatSetKey(itemIndex) {\r\n  retryAjax('index.php?no_mobile=1&cmd=profile').done(function(data) {\r\n    changeCombatSet(data, itemIndex);\r\n  });\r\n}\r\n\r\nvar keyDict = {\r\n  '33': {fn: combatSetKey, arg: 1}, // Shift+1\r\n  '64': {fn: combatSetKey, arg: 2}, // Shift+2\r\n  '34': {fn: combatSetKey, arg: 2}, // Shift+2 -- for UK keyboards, I think\r\n  '35': {fn: combatSetKey, arg: 3}, // Shift+3\r\n  '36': {fn: combatSetKey, arg: 4}, // Shift+4\r\n  '37': {fn: combatSetKey, arg: 5}, // Shift+5\r\n  '94': {fn: combatSetKey, arg: 6}, // Shift+6\r\n  '38': {fn: combatSetKey, arg: 7}, // Shift+7\r\n  '42': {fn: combatSetKey, arg: 8}, // Shift+8\r\n  '40': {fn: combatSetKey, arg: 9}, // Shift+9\r\n  '60': {fn: movePage, arg: '<'}, // move to prev page [<]\r\n  '62': {fn: movePage, arg: '>'}, // move to next page [>]\r\n  '71': {fn: createGroup}, // create group [G]\r\n  '76': {fn: logPage}, // Log Page [L]\r\n  '98': {fn: backpack}, // backpack [b]\r\n  '103': {fn: gotoGuild}, // go to guild [g]\r\n  '106': {fn: joinAllGroup}, // join all group [j]\r\n  '108': {fn: logPage}, // Log Page [l]\r\n  '112': {fn: profile}, // profile [p]\r\n  '114': {fn: doRepair}, // repair [r]\r\n  '118': {fn: fastWearMgr}, // fast wear manager [v]\r\n  '121': {fn: doSendGold}, // fast send gold [y]\r\n  '163': {fn: combatSetKey, arg: 3}, // Shift+3 -- for UK keyboards\r\n};\r\n\r\nfunction handleKey(r) {\r\n  if (r in keyDict) {\r\n    keyDict[r].fn(keyDict[r].arg);\r\n  }\r\n}\r\n\r\nvar bailOut = [\r\n  function(evt) {\r\n    return evt.target.tagName !== 'HTML' && evt.target.tagName !== 'BODY';\r\n  },\r\n  /* ignore control, alt and meta keys\r\n  (I think meta is the command key in Macintoshes) */\r\n  function(evt) {return evt.ctrlKey;},\r\n  function(evt) {return evt.metaKey;},\r\n  function(evt) {return evt.altKey;}\r\n];\r\n\r\nfunction keyPress(evt) {\r\n  for (var i = 0; i < bailOut.length; i += 1) {\r\n    if (bailOut[i](evt)) {return;}\r\n  }\r\n  handleKey(evt.charCode);\r\n}\r\n\r\nexport default function replaceKeyHandler() {\r\n  expandMenuOnKeyPress = getValue('expandMenuOnKeyPress');\r\n  document.onkeypress = keyPress;\r\n}\r\n","import createDocument from '../system/createDocument';\r\nimport {getElementById} from '../common/getElement';\r\n\r\nexport default function infoBox(documentText) {\r\n  var doc = createDocument(documentText);\r\n  var result;\r\n  var infoMsg = getElementById('info-msg', doc);\r\n  if (infoMsg) {\r\n    var infoMatch = infoMsg.innerHTML;\r\n    result = '';\r\n    if (infoMatch) {\r\n      infoMatch = infoMatch.replace(/<br.*/, '');\r\n      result = infoMatch;\r\n    }\r\n  }\r\n  return result;\r\n}\r\n","import fallback from './fallback';\r\n\r\nfunction getTarget(doc) {\r\n  if (doc instanceof HTMLDocument) {return doc;}\r\n  return document;\r\n}\r\n\r\nfunction patchXPath(xpath) {\r\n  if (xpath.indexOf('/') === 0) {\r\n    return '.' + xpath;\r\n    // TODO this is likely to be bad\r\n    // this is a chrome fix - needs a .// for xpath\r\n    // where as firefox can function without it.\r\n    // firefox still works with .//\r\n  }\r\n  return xpath;\r\n}\r\n\r\nexport default function findNodes(xpath, doc) {\r\n  var _xpath = patchXPath(xpath);\r\n  var nodes = [];\r\n  var target;\r\n  // We may have passed in a HTMLDocument object as the context\r\n  // See createDocument with DOMParser\r\n  // This only matters in Firefox. evaluate will fail silently if\r\n  // the context is not part of the calling object.\r\n  var _doc = fallback(doc, document);\r\n  target = getTarget(_doc);\r\n  var findQ = target.evaluate(_xpath, _doc, null,\r\n    XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);\r\n  if (findQ.snapshotLength === 0) {return null;}\r\n  for (var i = 0; i < findQ.snapshotLength; i += 1) {\r\n    nodes.push(findQ.snapshotItem(i));\r\n  }\r\n  return nodes;\r\n}\r\n","import findNodes from './findNodes';\r\n\r\nexport default function findNode(xpath, doc) {\r\n  var nodes = findNodes(xpath, doc);\r\n  if (!nodes) {return null;}\r\n  return nodes[0];\r\n}\r\n","import calf from '../support/calf';\r\nimport getForage from '../ajax/getForage';\r\nimport jQueryPresent from '../common/jQueryPresent';\r\nimport {nowSecs} from '../support/constants';\r\nimport setForage from '../ajax/setForage';\r\nimport superelite from '../app/superelite';\r\n\r\nexport var oldLog;\r\nvar timeoutId;\r\nvar intervalId;\r\n\r\nexport function disableBackgroundChecks() {\r\n  if (timeoutId) {\r\n    window.clearTimeout(timeoutId);\r\n    timeoutId = false;\r\n  }\r\n  if (intervalId) {\r\n    window.clearInterval(intervalId);\r\n    intervalId = false;\r\n  }\r\n}\r\n\r\nfunction gotSe(data) { // jQuery.min\r\n  var serverTime = Number(data.t.split(' ')[1]);\r\n  if (!oldLog) {oldLog = {lastUpdate: 0, se: {}};}\r\n  oldLog.lastUpdate = serverTime;\r\n  var resultAry = data.r;\r\n  if (resultAry) {\r\n    resultAry.forEach(function(element) {\r\n      var myTime = serverTime - element.time;\r\n      var mobName = element.creature.name.replace(' (Super Elite)', '');\r\n      if (!oldLog.se[mobName] || oldLog.se[mobName] < myTime) {\r\n        oldLog.se[mobName] = myTime;\r\n      }\r\n    });\r\n    setForage('fsh_seLog', oldLog);\r\n  }\r\n}\r\n\r\nfunction getSeLog() { // jQuery.min\r\n  return superelite().done(gotSe);\r\n}\r\n\r\nexport function doBackgroundCheck() {\r\n  disableBackgroundChecks();\r\n  intervalId = window.setInterval(getSeLog, 300000);\r\n  return getSeLog();\r\n}\r\n\r\nfunction whenWasLastCheck() {\r\n  return nowSecs - (oldLog && oldLog.lastUpdate || 0);\r\n}\r\n\r\nfunction setupBackgroundCheck() {\r\n  var lastCheckSecs = whenWasLastCheck();\r\n  if (lastCheckSecs >= 600) {\r\n    doBackgroundCheck();\r\n  } else {\r\n    timeoutId = window.setTimeout(doBackgroundCheck,\r\n      (600 - lastCheckSecs) * 1000);\r\n  }\r\n}\r\n\r\nfunction gotLog(data) {\r\n  if (data) {oldLog = data;}\r\n}\r\n\r\nexport function getFshSeLog() { // jQuery.min\r\n  return getForage('fsh_seLog').done(gotLog);\r\n}\r\n\r\nfunction shouldLog() {\r\n  return jQueryPresent() && calf.enableSeTracker && calf.cmd !== 'superelite';\r\n}\r\n\r\nexport function seLog() { // jQuery.min\r\n  if (shouldLog()) {\r\n    getFshSeLog().done(setupBackgroundCheck);\r\n  }\r\n}\r\n","import {getElementById} from '../common/getElement';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\n\r\nexport default function scoutTowerLink() {\r\n  var spoils = getElementById('minibox-spoilsofwar');\r\n  if (spoils) {\r\n    var parent = spoils.children[1].children[0];\r\n    insertHtmlBeforeEnd(parent, '&nbsp;' +\r\n      '<a href=\"index.php?cmd=guild&subcmd=scouttower\" ' +\r\n      'class=\"tip-static\" data-tipped=\"View Scout Report\">' +\r\n      '<img id=\"fshScoutTower\" ' +\r\n      'src=\"https://cdn.fallensword.com/structures/27.gif\"></a>');\r\n  }\r\n}\r\n","import callApp from './callApp';\r\n// import failStub from './failStub';\r\n\r\nexport default function superelite() {\r\n  return callApp({cmd: 'superelite'});\r\n  // return failStub();\r\n}\r\n","import {createAnchor} from '../common/cElement';\r\nimport {getElementById} from '../common/getElement';\r\nimport insertElement from '../common/insertElement';\r\n\r\nfunction statbarWrapper(href, id) {\r\n  var myWrapper = createAnchor({href: href});\r\n  var character = getElementById(id);\r\n  var statWrapper = character.parentNode;\r\n  insertElement(myWrapper, character);\r\n  statWrapper.insertBefore(myWrapper, statWrapper.firstChild);\r\n  myWrapper.addEventListener('click', function(evt) {\r\n    evt.stopPropagation();\r\n  }, true);\r\n}\r\n\r\nexport default function statbar() {\r\n  statbarWrapper('index.php?cmd=profile', 'statbar-character');\r\n  statbarWrapper('index.php?cmd=points&subcmd=reserve', 'statbar-stamina');\r\n  statbarWrapper('index.php?cmd=blacksmith', 'statbar-equipment');\r\n  statbarWrapper('index.php?cmd=profile&subcmd=dropitems', 'statbar-inventory');\r\n  statbarWrapper('index.php?cmd=points', 'statbar-fsp');\r\n  statbarWrapper('index.php?cmd=bank', 'statbar-gold');\r\n}\r\n","import calf from '../support/calf';\r\nimport {getElementById} from '../common/getElement';\r\n\r\nfunction hideElement(el) {\r\n  el.classList.add('fshHide');\r\n}\r\n\r\nfunction hideNodeList(nodeList) {\r\n  Array.prototype.forEach.call(nodeList, hideElement);\r\n}\r\n\r\nfunction hideQuerySelectorAll(parent, selector) { // Native - probably wrong\r\n  hideNodeList(parent.querySelectorAll(selector));\r\n}\r\n\r\nfunction contactColour(el, obj) {\r\n  var onMouseOver = el.dataset.tipped;\r\n  var lastActivityMinutes =\r\n    /Last Activity:<\\/td><td>(\\d+) mins/.exec(onMouseOver)[1];\r\n  if (lastActivityMinutes < 2) {\r\n    el.classList.add(obj.l1);\r\n  } else if (lastActivityMinutes < 5) {\r\n    el.classList.add(obj.l2);\r\n  } else {\r\n    el.classList.add(obj.l3);\r\n  }\r\n}\r\n\r\nfunction guildColour(el) {\r\n  contactColour(el, {\r\n    l1: 'fshGreen',\r\n    l2: 'fshWhite',\r\n    l3: 'fshGrey'\r\n  });\r\n}\r\n\r\nfunction alliesColour(el) {\r\n  contactColour(el, {\r\n    l1: 'fshDodgerBlue',\r\n    l2: 'fshLightSkyBlue',\r\n    l3: 'fshPowderBlue'\r\n  });\r\n}\r\n\r\nvar hideBtn = [\r\n  {\r\n    condition: function() {return calf.hideGuildInfoTrade;},\r\n    guildSelector: '#guild-minibox-action-trade',\r\n    allySelector: '#online-allies-action-trade'\r\n  },\r\n  {\r\n    condition: function() {return calf.hideGuildInfoSecureTrade;},\r\n    guildSelector: '#guild-minibox-action-secure-trade',\r\n    allySelector: '#online-allies-action-secure-trade'\r\n  },\r\n  {\r\n    condition: function() {return calf.hideGuildInfoBuff;},\r\n    guildSelector: '#guild-minibox-action-quickbuff',\r\n    allySelector: '#online-allies-action-quickbuff'\r\n  },\r\n  {\r\n    condition: function() {return calf.hideGuildInfoMessage;},\r\n    guildSelector: '#guild-minibox-action-send-message',\r\n    allySelector: '#online-allies-action-send-message'\r\n  }\r\n];\r\n\r\nfunction doHideBtn(context, selector) {\r\n  hideBtn.forEach(function(el) {\r\n    if (el.condition()) {\r\n      hideQuerySelectorAll(context, el[selector]);\r\n    }\r\n  });\r\n}\r\n\r\nexport function addGuildInfoWidgets() {\r\n  var guildMembrList = getElementById('minibox-guild-members-list');\r\n  if (!guildMembrList) {return;} // list exists\r\n  // hide guild info links\r\n  doHideBtn(guildMembrList, 'guildSelector');\r\n  if (calf.hideBuffSelected) {\r\n    hideNodeList(\r\n      guildMembrList.getElementsByClassName('guild-buff-check-on'));\r\n    getElementById('guild-quick-buff').classList.add('fshHide');\r\n  }\r\n  // add coloring for offline time\r\n  Array.prototype.forEach.call(\r\n    guildMembrList.getElementsByClassName('player-name'), guildColour);\r\n  Array.prototype.forEach.call(\r\n    document.querySelectorAll('#pCR h4'),\r\n    function(el) {\r\n      if (el.textContent !== 'Chat') {return;}\r\n      el.innerHTML = '<a href=\"index.php?cmd=guild&subcmd=chat\">' +\r\n        el.textContent + '</a>';\r\n    }\r\n  );\r\n}\r\n\r\nexport function addOnlineAlliesWidgets() {\r\n  var onlineAlliesList = getElementById('minibox-allies-list');\r\n  if (!onlineAlliesList) {return;}\r\n  doHideBtn(onlineAlliesList, 'allySelector');\r\n  if (calf.hideBuffSelected) {\r\n    hideNodeList(\r\n      onlineAlliesList.getElementsByClassName('ally-buff-check-on'));\r\n    getElementById('ally-quick-buff').classList.add('fshHide');\r\n  }\r\n  // add coloring for offline time\r\n  Array.prototype.forEach.call(\r\n    onlineAlliesList.getElementsByClassName('player-name'), alliesColour);\r\n}\r\n","export default function padZ(n) {\r\n  var ret = n.toString();\r\n  if (n < 10) {ret = '0' + ret;}\r\n  return ret;\r\n}\r\n","import {getElementById} from '../common/getElement';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\nimport intValue from '../system/intValue';\r\nimport padZ from '../system/padZ';\r\nimport {months, now} from '../support/constants';\r\n\r\nvar days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\r\n\r\nfunction formatShortDate(aDate) {\r\n  var yyyy = aDate.getFullYear();\r\n  var dd = padZ(aDate.getDate());\r\n  var ddd = days[aDate.getDay()];\r\n  var month = months[aDate.getMonth()];\r\n  var hh = padZ(aDate.getHours());\r\n  var mm = padZ(aDate.getMinutes());\r\n  return hh + ':' + mm + ' ' + ddd + ' ' + dd + '/' + month + '/' + yyyy;\r\n}\r\n\r\nfunction timeBox(nextGainTime, hrsToGo) {\r\n  var nextGain = /([0-9]+)m ([0-9]+)s/.exec(nextGainTime);\r\n  if (!nextGain) {return;}\r\n  return '<dd>' +\r\n    formatShortDate(new Date(now +\r\n    (hrsToGo * 60 * 60 + parseInt(nextGain[1], 10) * 60 +\r\n    parseInt(nextGain[2], 10)) * 1000)) + '</dd>';\r\n}\r\n\r\nexport function injectStaminaCalculator() {\r\n  var nextGain = document.getElementsByClassName('stat-stamina-nextGain');\r\n  if (nextGain.length === 0) {return;}\r\n  var staminaMouseover =\r\n    getElementById('statbar-stamina-tooltip-stamina');\r\n  var stamVals = /([,0-9]+)\\s\\/\\s([,0-9]+)/.exec(\r\n    staminaMouseover.getElementsByClassName('stat-name')[0]\r\n      .nextElementSibling.textContent\r\n  );\r\n  insertHtmlBeforeEnd(staminaMouseover,\r\n    '<dt class=\"stat-stamina-nextHuntTime\">Max Stam At</dt>' +\r\n    timeBox(\r\n      nextGain[0].nextElementSibling.textContent,\r\n      // get the max hours to still be inside stamina maximum\r\n      Math.floor(\r\n        (intValue(stamVals[2]) -\r\n        intValue(stamVals[1])) /\r\n        intValue(\r\n          document.getElementsByClassName('stat-stamina-gainPerHour')[0]\r\n            .nextElementSibling.textContent\r\n        )\r\n      )\r\n    )\r\n  );\r\n}\r\n\r\nexport function injectLevelupCalculator() {\r\n  var nextGain = document.getElementsByClassName('stat-xp-nextGain');\r\n  if (nextGain.length === 0) {return;}\r\n  insertHtmlBeforeEnd(getElementById('statbar-level-tooltip-general'),\r\n    '<dt class=\"stat-xp-nextLevel\">Next Level At</dt>' +\r\n    timeBox(\r\n      nextGain[0].nextElementSibling.textContent,\r\n      Math.ceil(\r\n        intValue(\r\n          document.getElementsByClassName('stat-xp-remaining')[0]\r\n            .nextElementSibling.textContent\r\n        ) /\r\n        intValue(\r\n          document.getElementsByClassName('stat-xp-gainPerHour')[0]\r\n            .nextElementSibling.textContent\r\n        )\r\n      )\r\n    )\r\n  );\r\n}\r\n","import add from '../support/task';\r\nimport calf from '../support/calf';\r\nimport changeGuildLogHREF from './changeGuildLogHREF';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport guildActivity from '../guild/guildActivity';\r\nimport {injectComposeAlert} from '../composing/composing';\r\nimport injectFSBoxLog from './injectFSBoxLog';\r\nimport injectHelperMenu from './helperMenu';\r\nimport injectHomePageTwoLink from '../news/injectHomePageTwoLink';\r\nimport injectJoinAllLink from '../notification/injectJoinAllLink';\r\nimport injectMenu from './accordion';\r\nimport injectQuickMsgDialogJQ from './messaging';\r\nimport injectServerNode from './injectServerNode';\r\nimport injectTempleAlert from '../notification/injectTempleAlert';\r\nimport injectUpgradeAlert from '../notification/injectUpgradeAlert';\r\nimport insertElement from '../common/insertElement';\r\nimport insertElementAfterBegin from '../common/insertElementAfterBegin';\r\nimport interceptQuickBuff from './interceptQuickBuff';\r\nimport jsonParse from '../common/jsonParse';\r\nimport navMenu from './navMenu';\r\nimport {pCR} from '../support/layout';\r\nimport prepareAllyEnemyList from './allyEnemy';\r\nimport {prepareBountyData} from '../activeWantedBounties/activeWantedBounties';\r\nimport replaceKeyHandler from './keyHandler';\r\nimport scoutTowerLink from './scoutTowerLink';\r\nimport {seLog} from '../seLog/seLog';\r\nimport statbar from './statBar';\r\nimport {addGuildInfoWidgets, addOnlineAlliesWidgets} from './widgets';\r\nimport {injectLevelupCalculator, injectStaminaCalculator} from './calc';\r\n\r\nfunction gameHelpLink() {\r\n  var nodeList = document.querySelectorAll('#pCR h3');\r\n  Array.prototype.forEach.call(nodeList, function(el) {\r\n    if (el.textContent === 'Game Help') {\r\n      el.innerHTML = '<a href=\"index.php?cmd=settings\">Game Help</a>';\r\n    }\r\n  });\r\n}\r\n\r\nfunction getEnvVars() {\r\n  calf.enableAllyOnlineList = getValue('enableAllyOnlineList');\r\n  calf.enableEnemyOnlineList = getValue('enableEnemyOnlineList');\r\n  calf.enableGuildInfoWidgets = getValue('enableGuildInfoWidgets');\r\n  calf.enableOnlineAlliesWidgets =\r\n    getValue('enableOnlineAlliesWidgets');\r\n  calf.enableSeTracker = getValue('enableSeTracker');\r\n  calf.hideGuildInfoTrade = getValue('hideGuildInfoTrade');\r\n  calf.hideGuildInfoSecureTrade = getValue('hideGuildInfoSecureTrade');\r\n  calf.hideGuildInfoBuff = getValue('hideGuildInfoBuff');\r\n  calf.hideGuildInfoMessage = getValue('hideGuildInfoMessage');\r\n  calf.hideBuffSelected = getValue('hideBuffSelected');\r\n  calf.enableTempleAlert = getValue('enableTempleAlert');\r\n  calf.enableUpgradeAlert = getValue('enableUpgradeAlert');\r\n  calf.enableComposingAlert = getValue('enableComposingAlert');\r\n  calf.enableActiveBountyList = getValue('enableActiveBountyList');\r\n  calf.enableWantedList = getValue('enableWantedList');\r\n  calf.wantedGuildMembers = getValue('wantedGuildMembers');\r\n  calf.allyEnemyOnlineRefreshTime =\r\n    getValue('allyEnemyOnlineRefreshTime') * 1000;\r\n}\r\n\r\nfunction callAllyEnemy() {\r\n  if (calf.enableAllyOnlineList ||\r\n      calf.enableEnemyOnlineList) {\r\n    add(3, prepareAllyEnemyList);\r\n  }\r\n}\r\n\r\nfunction callBounties() {\r\n  if (calf.enableWantedList ||\r\n      calf.enableActiveBountyList) {\r\n    add(3, prepareBountyData);\r\n  }\r\n}\r\n\r\nfunction callGuildInfo() {\r\n  if (calf.enableGuildInfoWidgets) {\r\n    add(3, addGuildInfoWidgets);\r\n  }\r\n}\r\n\r\nfunction callAllies() {\r\n  if (calf.enableOnlineAlliesWidgets) {\r\n    add(3, addOnlineAlliesWidgets);\r\n  }\r\n}\r\n\r\nfunction callTemple() {\r\n  if (calf.enableTempleAlert) {\r\n    add(3, injectTempleAlert);\r\n  }\r\n}\r\n\r\nfunction callUpgrade() {\r\n  if (calf.enableUpgradeAlert) {\r\n    add(3, injectUpgradeAlert);\r\n  }\r\n}\r\n\r\nfunction callComposing() {\r\n  if (calf.enableComposingAlert) {\r\n    add(3, injectComposeAlert);\r\n  }\r\n}\r\n\r\nfunction conditional() {\r\n  callAllyEnemy();\r\n  callBounties();\r\n  callGuildInfo();\r\n  callAllies();\r\n  callTemple();\r\n  callUpgrade();\r\n  callComposing();\r\n}\r\n\r\nfunction moveRHSBoxUpOnRHS(title) {\r\n  var box = getElementById(title);\r\n  if (box) {\r\n    insertElementAfterBegin(pCR, box);\r\n  }\r\n}\r\n\r\nfunction moveRHSBoxToLHS(title) {\r\n  var boxDiv = getElementById(title);\r\n  if (boxDiv) {\r\n    boxDiv.classList.add('pCR');\r\n    insertElement(getElementById('pCL'), boxDiv);\r\n  }\r\n}\r\n\r\nfunction doMoveGuildList() {\r\n  if (getValue('moveGuildList')) {\r\n    add(3, moveRHSBoxUpOnRHS, ['minibox-guild']);\r\n  }\r\n}\r\n\r\nfunction doMoveAllyList() {\r\n  if (getValue('moveOnlineAlliesList')) {\r\n    add(3, moveRHSBoxUpOnRHS, ['minibox-allies']);\r\n  }\r\n}\r\n\r\nfunction doMoveFsBox() {\r\n  if (getValue('moveFSBox')) {\r\n    add(3, moveRHSBoxToLHS, ['minibox-fsbox']);\r\n  }\r\n}\r\n\r\nfunction doMoveDailyQuest() {\r\n  if (getValue('moveDailyQuest')) {\r\n    add(3, moveRHSBoxToLHS, ['minibox-daily-quest']);\r\n  }\r\n}\r\n\r\nfunction notHuntMode() {\r\n  if (calf.huntingMode) {return;}\r\n  // move boxes in opposite order that you want them to appear.\r\n  doMoveGuildList();\r\n  doMoveAllyList();\r\n  doMoveDailyQuest();\r\n  doMoveFsBox();\r\n\r\n  getEnvVars();\r\n  conditional();\r\n\r\n  add(3, navMenu);\r\n  add(3, statbar);\r\n\r\n  add(3, injectStaminaCalculator);\r\n  add(3, injectLevelupCalculator);\r\n\r\n  add(3, injectMenu);\r\n\r\n  if (getValue('fsboxlog')) {\r\n    add(3, injectFSBoxLog);\r\n  }\r\n  add(3, interceptQuickBuff);\r\n\r\n  add(3, injectJoinAllLink);\r\n  add(3, changeGuildLogHREF);\r\n  add(3, injectHomePageTwoLink);\r\n\r\n  add(3, injectQuickMsgDialogJQ);\r\n\r\n  add(3, injectServerNode);\r\n  add(3, scoutTowerLink);\r\n\r\n  add(4, guildActivity);\r\n  add(4, seLog);\r\n}\r\n\r\nfunction prepareEnv() {\r\n  if (getValue('gameHelpLink')) {\r\n    add(3, gameHelpLink);\r\n  }\r\n  calf.huntingMode = getValue('huntingMode');\r\n  add(3, replaceKeyHandler);\r\n  notHuntMode();\r\n  if (!getValue('hideHelperMenu')) {\r\n    add(3, injectHelperMenu);\r\n  }\r\n}\r\n\r\nexport default function lookForHcsData() {\r\n  var hcsData = getElementById('html');\r\n  if (hcsData && jsonParse(hcsData.dataset.hcs)['new-ui']) {\r\n    prepareEnv();\r\n  }\r\n}\r\n","export default function allowBack() {\r\n  document.querySelector('input[type=\"submit\"]')\r\n    .addEventListener('click', function(evt) {\r\n      evt.preventDefault();\r\n      var url = 'index.php?';\r\n      Array.prototype.forEach.call(\r\n        document.querySelectorAll('input:not([type=\"submit\"])' +\r\n          ':not([type=\"checkbox\"]), select, input[type=\"checkbox\"]:checked'),\r\n        function(e) {url += '&' + e.name + '=' + e.value;});\r\n      window.location = url;\r\n    });\r\n}\r\n","export var moveOptions =\r\n  '<td colspan=3 ' +\r\n  'style=\"padding-top: 2px;padding-bottom: 2px;\">' +\r\n  '<select style=\"max-width: 50px;\">' +\r\n  '<option value=\"x\">Basic Attack</option>' +\r\n  '<option value=\"0\">Block</option>' +\r\n  '<option value=\"1\">Counter Attack</option>' +\r\n  '<option value=\"2\">Critical Hit</option>' +\r\n  '<option value=\"3\">Defend</option>' +\r\n  '<option value=\"4\">Deflect</option>' +\r\n  '<option value=\"5\">Dodge</option>' +\r\n  '<option value=\"6\">Lunge</option>' +\r\n  '<option value=\"7\">Power Attack</option>' +\r\n  '<option value=\"8\">Spin Attack</option>' +\r\n  '<option value=\"9\">Piercing Strike</option>' +\r\n  '<option value=\"10\">Crush</option>' +\r\n  '<option value=\"11\">Weaken</option>' +\r\n  '<option value=\"12\">Ice Shard</option>' +\r\n  '<option value=\"13\">Fire Blast</option>' +\r\n  '<option value=\"14\">Poison</option>' +\r\n  '</select></td>';\r\nexport var tableOpts = {\r\n  paging: false,\r\n  info: false,\r\n  order: [[3, 'asc'], [0, 'asc']],\r\n  columnDefs: [\r\n    {orderable: false, targets: [9]}\r\n  ],\r\n  stateSave: true,\r\n  stateDuration: 0\r\n};\r\nexport var arenaFilter =\r\n  '<table width=\"100%\"><tbody><tr><td>' +\r\n  '<span class=\"fshBlue\"><input id=\"fshHideMoves\" type=\"checkbox\">' +\r\n  '&nbsp;Hide Matches for Completed Moves</span></td><td align=\"right\">' +\r\n  '<span class=\"fshBlue\">Min lvl:&nbsp;<input id=\"fshMinLvl\" size=\"5\">' +\r\n  '&nbsp;Max lvl:&nbsp;<input id=\"fshMaxLvl\" size=\"5\">&nbsp;&nbsp;' +\r\n  '<input id=\"fshReset\" class=\"custombutton\" type=\"button\" ' +\r\n  'value=\"Reset\"></span></td></tr></tbody></table>';\r\n\r\nexport function dontPost(e) { // jQuery\r\n  e.preventDefault();\r\n  var self = $(e.target);\r\n  var pvpId = self.prev().val();\r\n  var subcmd = self.prev().prev().val();\r\n  window.location = 'index.php?cmd=arena&subcmd=' + subcmd +\r\n    '&pvp_id=' + pvpId;\r\n}\r\n","import {createDiv} from './cElement';\r\nimport {getElementById} from '../common/getElement';\r\nimport getInventoryById from '../ajax/getInventoryById';\r\nimport insertElement from './insertElement';\r\nimport insertHtmlBeforeEnd from './insertHtmlBeforeEnd';\r\nimport jQueryNotPresent from './jQueryNotPresent';\r\nimport {pCC} from '../support/layout';\r\n\r\nvar inv;\r\nvar target;\r\n\r\nfunction selectPerf() {\r\n  var items = getElementById(target + '-items')\r\n    .getElementsByClassName('selectable-item');\r\n  if (items.length === 0) {return;}\r\n  Array.prototype.forEach.call(items, function(e) {\r\n    var thisItem = e.id.replace(target + '-item-', '');\r\n    if (inv[thisItem] && inv[thisItem].craft === 'Perfect') {e.click();}\r\n  });\r\n}\r\n\r\nfunction drawFilters(data) {\r\n  inv = data.items;\r\n  var buttonDiv = createDiv({className: 'fshAC'});\r\n  insertHtmlBeforeEnd(buttonDiv,\r\n    '<button class=\"fshBl\">Perfect</button>');\r\n  insertElement(pCC, buttonDiv);\r\n  buttonDiv.addEventListener('click', selectPerf);\r\n}\r\n\r\nexport default function perfFilter(loc) { // jQuery.min\r\n  if (jQueryNotPresent()) {return;}\r\n  target = loc;\r\n  getInventoryById().done(drawFilters);\r\n}\r\n","import {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {pCC} from '../support/layout';\r\nimport perfFilter from '../common/perfFilter';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport setValue from '../system/setValue';\r\nimport {simpleCheckbox} from '../settings/simpleCheckbox';\r\n\r\nvar disableBreakdownPrompts;\r\nvar selectedList = [];\r\n\r\nfunction disappearance(self) {return function() {self.hide();};}\r\n\r\nfunction goDown(self, disappear) {\r\n  return function() {self.animate({height: 0}, 500, disappear);};\r\n}\r\n\r\nfunction fadeAway() {\r\n  var self = $('#composingMessageContainer');\r\n  self.animate({opacity: 0}, 500, goDown(self, disappearance(self)));\r\n}\r\n\r\nfunction showComposingMessage(message, bgcolor) { // jQuery\r\n  $('#composingMessageContainer').remove();\r\n\r\n  $('#composingMessage')\r\n    .append(\r\n      $('<div/>', {\r\n        id: 'composingMessageContainer',\r\n        width: '100%'\r\n      })\r\n        .append(\r\n          $('<div/>', {id: 'composingMessageText'})\r\n            .css({\r\n              width: '90%',\r\n              'text-align': 'center',\r\n              'background-color': bgcolor,\r\n              color: 'rgb(255, 255, 255)',\r\n              margin: '5px auto 5px auto',\r\n              padding: '2px'\r\n            })\r\n            .html(message)\r\n        )\r\n    );\r\n\r\n  setTimeout(fadeAway, 5000);\r\n}\r\n\r\nfunction breakItems() { // jQuery.min\r\n  return retryAjax({\r\n    type: 'POST',\r\n    url: 'index.php?cmd=composing&subcmd=dobreakdown',\r\n    data: {'item_list[]': selectedList},\r\n    dataType: 'json'\r\n  }).done(function(response) {\r\n    if (response.error !== 0) {\r\n      showComposingMessage('Error: ' + response.msg, 'rgb(164, 28, 28)');\r\n    }\r\n    window.location = 'index.php?cmd=composing&subcmd=breakdown&m=1';\r\n  });\r\n}\r\n\r\nfunction validBreakEvent(evt) {\r\n  evt.stopPropagation();\r\n  if (selectedList.length === 0) {\r\n    showComposingMessage('Error: No items selected.', 'rgb(164, 28, 28)');\r\n    return;\r\n  }\r\n  breakItems();\r\n}\r\n\r\nfunction breakEvt(evt) {\r\n  if (disableBreakdownPrompts &&\r\n      evt.target.id === 'breakdown-selected-items') {\r\n    validBreakEvent(evt);\r\n  }\r\n}\r\n\r\nfunction itemClick(evt) {\r\n  if (!evt.target.classList.contains('selectable-item')) {return;}\r\n  var myItem = evt.target.id.replace('composing-item-', '');\r\n  var itemPos = selectedList.indexOf(myItem);\r\n  if (itemPos === -1) {\r\n    selectedList.push(myItem);\r\n  } else {\r\n    selectedList.splice(itemPos, 1);\r\n  }\r\n}\r\n\r\nfunction togglePref() {\r\n  disableBreakdownPrompts = !disableBreakdownPrompts;\r\n  setValue('disableBreakdownPrompts', disableBreakdownPrompts);\r\n}\r\n\r\nexport default function composingBreakdown() {\r\n  if (jQueryNotPresent()) {return;}\r\n  perfFilter('composing');\r\n  disableBreakdownPrompts = getValue('disableBreakdownPrompts');\r\n  getElementById('breakdown-selected-items').parentNode\r\n    .addEventListener('click', breakEvt, true);\r\n  getElementById('composing-items')\r\n    .addEventListener('click', itemClick);\r\n  insertHtmlBeforeEnd(pCC,\r\n    '<table class=\"fshTblCenter\"><tbody>' +\r\n    simpleCheckbox('disableBreakdownPrompts') +\r\n    '</tbody></table>');\r\n  getElementById('disableBreakdownPrompts')\r\n    .addEventListener('click', togglePref);\r\n}\r\n","import {dontPost} from './assets';\r\nimport jQueryPresent from '../common/jQueryPresent';\r\n\r\nfunction gotoPage(pageId) {\r\n  window.location = 'index.php?cmd=arena&subcmd=completed&page=' +\r\n    pageId;\r\n}\r\n\r\nfunction overrideButtons() {\r\n  var prevButton = $('#pCC input[value=\"<\"]');\r\n  var nextButton = $('#pCC input[value=\">\"]');\r\n  if (prevButton.length === 1) {\r\n    var startButton = $('<input value=\"<<\" type=\"button\">');\r\n    prevButton.before(startButton).before('&nbsp;');\r\n    startButton.click(function() {gotoPage(1);});\r\n  }\r\n  if (nextButton.length === 1) {\r\n    var lastPage = $('#pCC input[value=\"Go\"]').closest('td').prev().text()\r\n      .replace(/\\D/g, '');\r\n    var finishButton = $('<input value=\">>\" type=\"button\">');\r\n    nextButton.after(finishButton).after('&nbsp;');\r\n    finishButton.click(function() {gotoPage(lastPage);});\r\n  }\r\n  $('#pCC input[value=\"View\"]').click(dontPost);\r\n}\r\n\r\nexport default function completedArenas() { // jQuery\r\n  if (jQueryPresent()) {overrideButtons();}\r\n}\r\n","import getInventory from './getInventory';\r\n\r\nfunction rekeyInventory(data) {\r\n  data.items = data.items.reduce(function(prev, curr) {\r\n    if (curr.is_in_st) {prev.fshHasST = true;}\r\n    prev[curr.inv_id] = curr;\r\n    return prev;\r\n  }, {});\r\n  return data;\r\n}\r\n\r\nexport default function getInventoryById() {\r\n  return getInventory().pipe(rekeyInventory);\r\n}\r\n","import add from '../support/task';\r\nimport calf from '../support/calf';\r\nimport getInventoryById from '../ajax/getInventoryById';\r\nimport insertElement from '../common/insertElement';\r\nimport insertElementAfterBegin from '../common/insertElementAfterBegin';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\nimport {itemRE} from '../support/constants';\r\nimport jQueryPresent from '../common/jQueryPresent';\r\nimport makeFolderSpans from '../common/makeFolderSpans';\r\nimport {pCC} from '../support/layout';\r\nimport toggleForce from '../common/toggleForce';\r\nimport {createDiv, createInput, createLabel} from '../common/cElement';\r\n\r\nvar itemTable;\r\nvar itemsAry;\r\nvar invItems;\r\nvar folderId = 0;\r\nvar perfBox;\r\n\r\nfunction whichTableHasItems() {\r\n  var allTables = pCC.lastElementChild.getElementsByTagName('table');\r\n  if (calf.cmd === 'crafting') {\r\n    return allTables[1];\r\n  }\r\n  return allTables[0];\r\n}\r\n\r\nfunction drawingNewItemTable() {\r\n  if (!drawingNewItemTable.itemGrid) {\r\n    drawingNewItemTable.itemGrid = createDiv({className: 'fshItemGrid'});\r\n    itemsAry.forEach(function(item) {\r\n      var itemDiv = createDiv();\r\n      var aLink = item[0].parentNode;\r\n      insertElement(itemDiv, aLink);\r\n      insertElement(drawingNewItemTable.itemGrid, itemDiv);\r\n    });\r\n    insertElementAfterBegin(itemTable.parentNode, drawingNewItemTable.itemGrid);\r\n    itemTable.classList.add('fshHide');\r\n  }\r\n}\r\n\r\nfunction testFolder(item) {\r\n  return folderId !== 0 && item[2] !== folderId;\r\n}\r\n\r\nfunction testCraft(item) {\r\n  return perfBox.checked && item[3] !== 'Perfect';\r\n}\r\n\r\nfunction afn(item) {\r\n  var myDiv = item[0].parentNode.parentNode;\r\n  toggleForce(myDiv, testFolder(item) || testCraft(item));\r\n}\r\n\r\nfunction reDrawGrid() {\r\n  drawingNewItemTable();\r\n  itemsAry.forEach(afn);\r\n}\r\n\r\nfunction doHideFolders(evt) {\r\n  if (!evt.target.classList.contains('fshFolder')) {return;}\r\n  var evtFid = Number(evt.target.dataset.folder);\r\n  if (evtFid !== folderId) {\r\n    folderId = evtFid;\r\n    reDrawGrid();\r\n  }\r\n}\r\n\r\nfunction getFolderId(item) {\r\n  if (item.equipped) {return -2;}\r\n  return item.folder_id;\r\n}\r\n\r\nfunction enhanceWarehouse() {\r\n  itemsAry.forEach(function(item) {\r\n    var invItem = invItems[item[1]];\r\n    item.push(getFolderId(invItem), invItem.craft);\r\n  });\r\n}\r\n\r\nfunction doFolderButtons(folders) {\r\n  var inject = itemTable.parentNode.parentNode\r\n    .previousElementSibling.firstElementChild;\r\n  inject.classList.add('fshCenter');\r\n  inject.addEventListener('click', doHideFolders);\r\n  insertHtmlBeforeEnd(inject, makeFolderSpans(folders, true));\r\n  return inject;\r\n}\r\n\r\nfunction doPerfSwitch(inject) {\r\n  if (calf.cmd === 'crafting') {\r\n    perfBox = {checked: false};\r\n    return;\r\n  }\r\n  var perfLabel = createLabel({\r\n    className: 'fshVMid',\r\n    innerHTML: '<span class=\"fshLink\">Perfect</span> '\r\n  });\r\n  perfBox = createInput({\r\n    className: 'fshVMid',\r\n    type: 'checkbox'\r\n  });\r\n  perfBox.addEventListener('change', reDrawGrid);\r\n  insertElement(perfLabel, perfBox);\r\n  insertHtmlBeforeEnd(inject, ' &ensp;');\r\n  insertElement(inject, perfLabel);\r\n}\r\n\r\nfunction inventory(data) {\r\n  if (data.items && itemTable) {\r\n    invItems = data.items;\r\n    add(4, enhanceWarehouse);\r\n    var inject = doFolderButtons(data.folders);\r\n    doPerfSwitch(inject);\r\n  }\r\n}\r\n\r\nfunction getItems() {\r\n  itemTable = whichTableHasItems();\r\n  var imgList = itemTable.getElementsByTagName('img');\r\n  itemsAry = Array.prototype.map.call(imgList, function(img) {\r\n    var tipped = img.dataset.tipped;\r\n    var matches = tipped.match(itemRE);\r\n    return [img, matches[2]];\r\n  });\r\n}\r\n\r\nexport default function craftForge() {\r\n  if (jQueryPresent()) {\r\n    getInventoryById().done(inventory);\r\n    add(3, getItems);\r\n  }\r\n}\r\n","import {beginFolderSpanElement} from '../support/constants';\r\n\r\nexport default function makeFolderSpans(folders, needsWorn) {\r\n  var wornSelector = '';\r\n  if (needsWorn) {\r\n    wornSelector = ' &ensp;' + beginFolderSpanElement + '-2\">Worn</span>';\r\n  }\r\n  return beginFolderSpanElement + '0\">All</span>' + wornSelector +\r\n    ' &ensp;' + beginFolderSpanElement + '-1\">Main</span>' +\r\n    Object.keys(folders).reduce(function(prev, key) {\r\n      return prev + ' &ensp;' + beginFolderSpanElement + key + '\">' +\r\n        folders[key] + '</span>';\r\n    }, '');\r\n}\r\n","import fallback from '../system/fallback';\r\nimport {getElementById} from '../common/getElement';\r\nimport isFunction from './isFunction';\r\nimport setValue from '../system/setValue';\r\n\r\nvar warehouse = [];\r\nvar prefValue;\r\nvar headerIndex;\r\n\r\nfunction collapseArt(article) {\r\n  article.rows.forEach(function(el) {\r\n    el.row.classList.add('fshHide');\r\n  });\r\n  article.open = false;\r\n}\r\n\r\nfunction collapseAll() {\r\n  warehouse.forEach(function(article) {\r\n    if (article.open) {collapseArt(article);}\r\n  });\r\n}\r\n\r\nfunction expandArt(article) {\r\n  article.rows.forEach(function(el) {\r\n    el.row.classList.remove('fshHide');\r\n  });\r\n  article.open = true;\r\n}\r\n\r\nfunction expandAll() {\r\n  warehouse.forEach(function(article) {\r\n    if (!article.open) {expandArt(article);}\r\n  });\r\n}\r\n\r\nfunction isHeader(el) {\r\n  if (el.rowIndex % headerIndex === 0) {return el;}\r\n}\r\n\r\nfunction closestTr(el) {\r\n  if (el.tagName === 'TR') {\r\n    return isHeader(el);\r\n  }\r\n  if (el.tagName === 'TABLE') {return;}\r\n  return closestTr(el.parentNode);\r\n}\r\n\r\nfunction evtEnabled(evt) {\r\n  var myRow = closestTr(evt.target);\r\n  if (!myRow) {return;}\r\n  var articleNo = myRow.rowIndex / headerIndex;\r\n  var article = warehouse[articleNo];\r\n  if (article.open === false) {\r\n    collapseAll();\r\n    expandArt(article);\r\n  } else {\r\n    collapseArt(article);\r\n  }\r\n}\r\n\r\nfunction evtHdl(evt) {\r\n  if (prefValue) {evtEnabled(evt);}\r\n}\r\n\r\nfunction makeHeaderClickable(row) {\r\n  if (prefValue) {row.classList.add('fshPoint');}\r\n}\r\n\r\nfunction collapseDuringAnalysis(row, thisArticle) {\r\n  if (prefValue) {\r\n    row.classList.add('fshHide');\r\n    thisArticle.open = false;\r\n  } else {\r\n    thisArticle.open = true;\r\n  }\r\n}\r\n\r\nfunction hasExtraFn(extraFn, row) {\r\n  if (isFunction(extraFn)) {extraFn(row);}\r\n}\r\n\r\nfunction testRowType(row, rowType, thisArticle, articleTest, extraFn) {\r\n  if (rowType === 0) {\r\n    thisArticle.header = row;\r\n    makeHeaderClickable(row);\r\n    hasExtraFn(extraFn, row);\r\n  }\r\n  if (articleTest(rowType)) {\r\n    thisArticle.rows[rowType] =\r\n      fallback(thisArticle[rowType], {});\r\n    thisArticle.rows[rowType].row = row;\r\n    collapseDuringAnalysis(row, thisArticle);\r\n  }\r\n}\r\n\r\nfunction doTagging(articleTest, extraFn, row) {\r\n  var rowType = row.rowIndex % headerIndex;\r\n  var articleNo = (row.rowIndex - rowType) / headerIndex;\r\n  warehouse[articleNo] = fallback(warehouse[articleNo], {});\r\n  var thisArticle = warehouse[articleNo];\r\n  thisArticle.rows = thisArticle.rows || [];\r\n  testRowType(row, rowType, thisArticle, articleTest, extraFn);\r\n}\r\n\r\nfunction toggleHeaderClass() {\r\n  warehouse.forEach(function(article) {\r\n    article.header.classList.toggle('fshPoint');\r\n  });\r\n}\r\n\r\nfunction togglePref(prefName) {\r\n  prefValue = !prefValue;\r\n  setValue(prefName, prefValue);\r\n  if (prefValue) {collapseAll();} else {expandAll();}\r\n  toggleHeaderClass();\r\n}\r\n\r\nfunction setupPref(prefName) {\r\n  var prefEl = getElementById(prefName);\r\n  prefValue = prefEl.checked;\r\n  getElementById(prefName)\r\n    .addEventListener('change', togglePref.bind(null, prefName));\r\n}\r\n\r\nexport default function collapse(param) {\r\n  headerIndex = param.headInd;\r\n  setupPref(param.prefName);\r\n  Array.prototype.forEach.call(param.theTable.rows,\r\n    doTagging.bind(null, param.articleTest, param.extraFn));\r\n  param.theTable.addEventListener('click', evtHdl);\r\n}\r\n","import collapse from '../common/collapse';\r\nimport {createDiv} from '../common/cElement';\r\nimport insertElement from '../common/insertElement';\r\nimport {pCC} from '../support/layout';\r\nimport {simpleCheckboxHtml} from '../settings/simpleCheckbox';\r\n\r\nfunction testArticle(rowType) {return rowType === 1;}\r\n\r\nfunction setupPref(prefName, injector) {\r\n  var flDiv = createDiv({\r\n    className: 'fshHallPref',\r\n    innerHTML: simpleCheckboxHtml(prefName)\r\n  });\r\n  injector.classList.add('fshRelative');\r\n  insertElement(injector, flDiv);\r\n}\r\n\r\nexport default function guildHall() {\r\n  var prefName = 'collapseHallPosts';\r\n  var theTable = pCC.lastElementChild;\r\n  if (theTable instanceof HTMLTableElement) {\r\n    setupPref(prefName, theTable.previousElementSibling.previousElementSibling);\r\n    collapse({\r\n      prefName: prefName,\r\n      theTable: theTable,\r\n      headInd: 3,\r\n      articleTest: testArticle\r\n    });\r\n  }\r\n}\r\n","export function closestTable(el) {\r\n  if (el.tagName === 'TABLE') {return el;}\r\n  return closestTable(el.parentNode);\r\n}\r\n","import {closestTable} from '../common/closest';\r\nimport dialog from '../ajax/dialog';\r\nimport infoBox from '../common/infoBox';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {pCC} from '../support/layout';\r\nimport retryAjax from '../ajax/retryAjax';\r\n\r\nfunction translateReturnInfo(data) {\r\n  var info = infoBox(data);\r\n  var _r = {r: 1, m: info};\r\n  if (info === 'Item was transferred to the guild store!') {\r\n    _r = {r: 0, m: ''};\r\n  }\r\n  return _r;\r\n}\r\n\r\nfunction guildMailboxTake(href) {\r\n  return retryAjax({url: href}).pipe(translateReturnInfo).done(dialog);\r\n}\r\n\r\nfunction takeResult(self, data) {\r\n  if (data.r === 0) {\r\n    closestTable(self).nextElementSibling.rows[0].cells[0].innerHTML =\r\n      '<span class=\"fshGreen\">Taken</span>';\r\n  }\r\n}\r\n\r\nfunction guildMailboxEvent(e) { // jQuery.min\r\n  var self = e.target;\r\n  if (self.tagName === 'IMG') {\r\n    e.preventDefault();\r\n    var anchor = self.parentNode.href;\r\n    guildMailboxTake(anchor).done(takeResult.bind(null, self));\r\n  }\r\n  if (self.className === 'sendLink') {\r\n    var nodeList = pCC.getElementsByTagName('img');\r\n    Array.prototype.forEach.call(nodeList, function(el) {el.click();});\r\n  }\r\n}\r\n\r\nexport default function guildMailbox() {\r\n  if (jQueryNotPresent()) {return;}\r\n  pCC.addEventListener('click', guildMailboxEvent);\r\n  insertHtmlBeforeEnd(document.querySelector('#pCC td[height=\"25\"]'),\r\n    '<span class=\"sendLink\">Take All</span>');\r\n}\r\n","import calf from '../support/calf';\r\nimport currentGuildId from '../common/currentGuildId';\r\nimport getForage from './getForage';\r\nimport isObject from '../common/isObject';\r\nimport {now} from '../support/constants';\r\nimport retryAjax from './retryAjax';\r\nimport setForage from './setForage';\r\n\r\nfunction getGuild(guildId) {\r\n  return retryAjax({\r\n    dataType: 'json',\r\n    url: 'index.php',\r\n    data: {\r\n      cmd: 'export',\r\n      subcmd: 'guild_members',\r\n      guild_id: guildId\r\n    }\r\n  });\r\n}\r\n\r\nfunction addMembrListToForage(membrList) {\r\n  getForage('fsh_membrList')\r\n    .done(function saveMembrListInForage(data) {\r\n      var oldMemList = data || {};\r\n      setForage('fsh_membrList', $.extend(oldMemList, membrList));\r\n    });\r\n}\r\n\r\nfunction getGuildMembers(guildId) {\r\n  return getGuild(guildId).pipe(function membrListToHash(data) {\r\n    var membrList = {};\r\n    membrList[guildId] = {};\r\n    membrList[guildId].lastUpdate = now;\r\n    data.forEach(function memberToObject(ele) {\r\n      membrList[guildId][ele.username] = ele;\r\n    });\r\n    return membrList;\r\n  });\r\n}\r\n\r\nvar testList = [\r\n  function(guildId, membrList) {return Boolean(membrList);},\r\n  function(guildId, membrList) {return isObject(membrList);},\r\n  function(guildId, membrList) {return isObject(membrList[guildId]);},\r\n  function(guildId, membrList) {\r\n    return typeof membrList[guildId].lastUpdate === 'number';\r\n  },\r\n  function(guildId, membrList) {\r\n    return membrList[guildId].lastUpdate > now - 300000;\r\n  }\r\n];\r\n\r\nfunction getMembrListFromForage(guildId, membrList) {\r\n  if (testList.every(function(e) {return e(guildId, membrList);})) {\r\n    return membrList;\r\n  }\r\n  return getGuildMembers(guildId).done(addMembrListToForage);\r\n}\r\n\r\nfunction guildMembers(force, guildId) {\r\n  if (force) {\r\n    return getGuildMembers(guildId).done(addMembrListToForage);\r\n  }\r\n  return getForage('fsh_membrList')\r\n    .pipe(getMembrListFromForage.bind(null, guildId));\r\n}\r\n\r\nfunction setHelperMembrList(guildId, membrList) {\r\n  calf.membrList = membrList[guildId];\r\n  return calf.membrList;\r\n}\r\n\r\nexport default function getMembrList(force) {\r\n  var guildId = currentGuildId();\r\n  return guildMembers(force, guildId)\r\n    .pipe(setHelperMembrList.bind(null, guildId));\r\n}\r\n","import add from './support/task';\r\nimport addCommas from './system/addCommas';\r\nimport calf from './support/calf';\r\nimport createDocument from './system/createDocument';\r\nimport {createTFoot} from './common/cElement';\r\nimport fallback from './system/fallback';\r\nimport {getElementById} from './common/getElement';\r\nimport getMembrList from './ajax/getMembrList';\r\nimport insertElement from './common/insertElement';\r\nimport insertHtmlAfterEnd from './common/insertHtmlAfterEnd';\r\nimport insertHtmlBeforeEnd from './common/insertHtmlBeforeEnd';\r\nimport intValue from './system/intValue';\r\nimport jQueryNotPresent from './common/jQueryNotPresent';\r\nimport {pCC} from './support/layout';\r\nimport retryAjax from './ajax/retryAjax';\r\nimport {time, timeEnd} from './support/debug';\r\n\r\nvar newSummary = {};\r\nvar advisorColumns = [\r\n  {title: '<div class=\"fshBold\">Member</div>'},\r\n  {title: '<div class=\"fshBold\">Lvl</div>', 'class': 'dt-center'},\r\n  {title: '<div class=\"fshBold\">Rank</div>', 'class': 'dt-center dt-nowrap'},\r\n  {\r\n    title: '<div class=\"fshBold\">Gold From Deposits</div>',\r\n    'class': 'dt-center'\r\n  },\r\n  {title: '<div class=\"fshBold\">Gold From Tax</div>', 'class': 'dt-center'},\r\n  {title: '<div class=\"fshBold\">Gold Total</div>', 'class': 'dt-center'},\r\n  {title: '<div class=\"fshBold\">FSP</div>', 'class': 'dt-center'},\r\n  {title: '<div class=\"fshBold\">Skill Cast</div>', 'class': 'dt-center'},\r\n  {title: '<div class=\"fshBold\">Group Create</div>', 'class': 'dt-center'},\r\n  {title: '<div class=\"fshBold\">Group Join</div>', 'class': 'dt-center'},\r\n  {title: '<div class=\"fshBold\">Relic</div>', 'class': 'dt-center'},\r\n  {title: '<div class=\"fshBold\">XP Contrib</div>', 'class': 'dt-center'}\r\n];\r\nvar membrList;\r\nvar list;\r\nvar data = [];\r\n\r\nfunction doTable() { // jQuery\r\n  $(list).dataTable({\r\n    pageLength: 25,\r\n    lengthMenu: [[25, 50, -1], [25, 50, 'All']],\r\n    autoWidth: false,\r\n    columns: advisorColumns,\r\n    stateSave: true,\r\n    stateDuration: 0\r\n  });\r\n}\r\n\r\nfunction summaryLink() {\r\n  var updateInput = pCC.getElementsByClassName('custombutton');\r\n  if (updateInput.length === 0) {return;}\r\n  insertHtmlAfterEnd(updateInput[0], '<span> <a href=\"index.php' +\r\n    '?cmd=guild&subcmd=advisor&subcmd2=weekly\">7-Day Summary</a></span>');\r\n}\r\n\r\nfunction playerName(f) {\r\n  if (!membrList[f]) {return f;}\r\n  return '<a href=\"index.php?cmd=profile&player_id=' +\r\n    membrList[f].id + '\">' + f + '</a>';\r\n}\r\n\r\nfunction playerLevel(f) {\r\n  if (!membrList[f]) {return '';}\r\n  return membrList[f].level;\r\n}\r\n\r\nfunction playerRank(f) {\r\n  if (!membrList[f]) {return '';}\r\n  return '<div class=\"fshAdvRank\">' +\r\n    membrList[f].rank_name + '</div>';\r\n}\r\n\r\nfunction injectAdvisorNew() {\r\n\r\n  time('guildAdvisor.injectAdvisorNew');\r\n\r\n  list = pCC.getElementsByTagName('TABLE')[1];\r\n  if (!list) {return;}\r\n  var totalRow = list.firstElementChild.lastElementChild;\r\n  var totalCell = totalRow.firstElementChild;\r\n  totalCell.className = 'fshRight';\r\n  totalCell.setAttribute('colspan', '3');\r\n  var tfoot = createTFoot();\r\n  insertElement(tfoot, totalRow);\r\n  list.className = 'fshXSmall hover';\r\n  list.firstElementChild\r\n    .removeChild(list.firstElementChild.firstElementChild);\r\n  Array.prototype.forEach.call(list.rows, function(tr) {\r\n    Array.prototype.forEach.call(tr.cells, function(td) {\r\n      td.removeAttribute('bgcolor');\r\n    });\r\n    var tdOne = tr.cells[0];\r\n    var username = tdOne.textContent.trim();\r\n    tdOne.innerHTML = playerName(username);\r\n    insertHtmlAfterEnd(tdOne, '<td>' + playerLevel(username) +\r\n      '</td><td>' + playerRank(username) + '</td>');\r\n  });\r\n  insertElement(list, tfoot);\r\n  add(3, doTable);\r\n  summaryLink();\r\n\r\n  timeEnd('guildAdvisor.injectAdvisorNew');\r\n\r\n}\r\n\r\nfunction returnAdvisorPage(e, response) {\r\n\r\n  time('guildAdvisor.returnAdvisorPage' + e);\r\n\r\n  insertHtmlBeforeEnd(list.lastElementChild.lastElementChild,\r\n    ' day ' + e + ',');\r\n  var doc = createDocument(response);\r\n  var pcc = getElementById('pCC', doc);\r\n  if (!pcc) {return;}\r\n  var table = pcc.firstElementChild.firstElementChild.lastElementChild\r\n    .firstElementChild.firstElementChild;\r\n  var tr = table.rows;\r\n  Array.prototype.forEach.call(tr, function(el) {\r\n    var tds = el.cells;\r\n    var member = tds[0].textContent.trim();\r\n    if (member === 'Member') {return;}\r\n    newSummary[member] = fallback(newSummary[member], {});\r\n    newSummary[member].deposit =\r\n      fallback(newSummary[member].deposit, 0) +\r\n      intValue(tds[1].textContent);\r\n    newSummary[member].tax = fallback(newSummary[member].tax, 0) +\r\n      intValue(tds[2].textContent);\r\n    newSummary[member].total = fallback(newSummary[member].total, 0) +\r\n      intValue(tds[3].textContent);\r\n    newSummary[member].fsp = fallback(newSummary[member].fsp, 0) +\r\n      intValue(tds[4].textContent);\r\n    newSummary[member].skills = fallback(newSummary[member].skills, 0) +\r\n      intValue(tds[5].textContent);\r\n    newSummary[member].grpCrt = fallback(newSummary[member].grpCrt, 0) +\r\n      intValue(tds[6].textContent);\r\n    newSummary[member].grpJoin =\r\n      fallback(newSummary[member].grpJoin, 0) +\r\n      intValue(tds[7].textContent);\r\n    newSummary[member].relics = fallback(newSummary[member].relics, 0) +\r\n      intValue(tds[8].textContent);\r\n    newSummary[member].contrib =\r\n      fallback(newSummary[member].contrib, 0) +\r\n      intValue(tds[9].textContent);\r\n  });\r\n\r\n  timeEnd('guildAdvisor.returnAdvisorPage' + e);\r\n\r\n}\r\n\r\nfunction getAdvisorPage(e) { // jQuery\r\n  return retryAjax({\r\n    url: 'index.php',\r\n    data: {\r\n      no_mobile: 1,\r\n      cmd: 'guild',\r\n      subcmd: 'advisor',\r\n      period: e\r\n    }\r\n  }).done(returnAdvisorPage.bind(null, e));\r\n}\r\n\r\nfunction displayAdvisor() { // jQuery\r\n\r\n  time('guildAdvisor.displayAdvisor');\r\n\r\n  list.className = 'fshXSmall hover';\r\n  list.innerHTML = '<tfoot id=\"advTFoot\"><tr><td class=\"fshRight\" ' +\r\n    'colspan=\"3\">Total: </td><td><u>' +\r\n    addCommas(newSummary['Total:'].deposit) + '</u></td><td><u>' +\r\n    addCommas(newSummary['Total:'].tax) + '</u></td><td><u>' +\r\n    addCommas(newSummary['Total:'].total) + '</u></td><td><u>' +\r\n    addCommas(newSummary['Total:'].fsp) + '</u></td><td><u>' +\r\n    addCommas(newSummary['Total:'].skills) + '</u></td><td><u>' +\r\n    addCommas(newSummary['Total:'].grpCrt) + '</u></td><td><u>' +\r\n    addCommas(newSummary['Total:'].grpJoin) + '</u></td><td><u>' +\r\n    addCommas(newSummary['Total:'].relics) + '</u></td><td><u>' +\r\n    addCommas(newSummary['Total:'].contrib) +\r\n      '</u></td></tr></tfoot>';\r\n  $(list).dataTable({\r\n    data: data,\r\n    pageLength: 25,\r\n    lengthMenu: [[25, 50, -1], [25, 50, 'All']],\r\n    autoWidth: false,\r\n    columns: advisorColumns,\r\n    stateSave: true,\r\n    stateDuration: 0\r\n  });\r\n\r\n  timeEnd('guildAdvisor.displayAdvisor');\r\n\r\n}\r\n\r\nfunction addStats(f) {\r\n  if (f === 'Total:') {return;}\r\n  data.push([\r\n    playerName(f),\r\n    playerLevel(f),\r\n    playerRank(f),\r\n    addCommas(newSummary[f].deposit),\r\n    addCommas(newSummary[f].tax),\r\n    addCommas(newSummary[f].total),\r\n    addCommas(newSummary[f].fsp),\r\n    addCommas(newSummary[f].skills),\r\n    addCommas(newSummary[f].grpCrt),\r\n    addCommas(newSummary[f].grpJoin),\r\n    addCommas(newSummary[f].relics),\r\n    addCommas(newSummary[f].contrib),\r\n  ]);\r\n}\r\n\r\nfunction addAdvisorPages() {\r\n  Object.keys(newSummary).forEach(addStats);\r\n  add(3, displayAdvisor);\r\n}\r\n\r\nfunction injectAdvisorWeekly() { // jQuery\r\n\r\n  time('guildAdvisor.injectAdvisorWeekly');\r\n\r\n  list = pCC.firstElementChild.firstElementChild\r\n    .lastElementChild.firstElementChild.firstElementChild;\r\n  if (!list) {return;}\r\n  list.innerHTML = '<span class=\"fshCurveContainer fshFlex\">' +\r\n    '<span class=\"fshCurveEle fshCurveLbl fshOldSpinner\"></span>' +\r\n    '<span class=\"fshSpinnerMsg\">&nbsp;Retrieving daily data ...</span>' +\r\n    '</span>';\r\n\r\n  $.when(\r\n    getMembrList(false)\r\n      .done(function(response) {\r\n        membrList = response;\r\n      }),\r\n    getAdvisorPage(1),\r\n    getAdvisorPage(2),\r\n    getAdvisorPage(3),\r\n    getAdvisorPage(4),\r\n    getAdvisorPage(5),\r\n    getAdvisorPage(6),\r\n    getAdvisorPage(7)\r\n  ).done(function() {\r\n    add(3, addAdvisorPages);\r\n  });\r\n\r\n  timeEnd('guildAdvisor.injectAdvisorWeekly');\r\n\r\n}\r\n\r\nexport default function injectAdvisor() {\r\n  if (jQueryNotPresent()) {return;}\r\n  if (calf.subcmd2 === 'weekly') {\r\n    injectAdvisorWeekly();\r\n  } else {\r\n    getMembrList(false).done(function(response) {\r\n      membrList = response;\r\n      add(3, injectAdvisorNew);\r\n    });\r\n  }\r\n}\r\n","import {defaults} from '../support/dataObj';\r\nimport fallback from '../system/fallback';\r\nimport getForage from '../ajax/getForage';\r\nimport intValue from '../system/intValue';\r\nimport isObject from '../common/isObject';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport setForage from '../ajax/setForage';\r\nimport {arenaFilter, dontPost, tableOpts} from './assets';\r\nimport {time, timeEnd} from '../support/debug';\r\n\r\nvar tabs;\r\nvar theTables;\r\nvar opts;\r\nvar oldIds;\r\n\r\nfunction levelsAreNotNaN(minLvl, maxLvl) {\r\n  return !isNaN(minLvl) && !isNaN(maxLvl);\r\n}\r\n\r\nfunction changeLvls() { // jQuery\r\n  var minLvl = parseInt($('#fshMinLvl').val(), 10);\r\n  var maxLvl = parseInt($('#fshMaxLvl').val(), 10);\r\n  if (levelsAreNotNaN(minLvl, maxLvl)) {\r\n    opts = fallback(opts, {});\r\n    opts.minLvl = minLvl;\r\n    opts.maxLvl = maxLvl;\r\n    setForage('fsh_arena', opts);\r\n    $('#arenaTypeTabs table[width=\"635\"]').DataTable().draw();\r\n  }\r\n}\r\n\r\nfunction resetLvls() { // jQuery\r\n  opts = opts || {};\r\n  opts.minLvl = defaults.arenaMinLvl;\r\n  opts.maxLvl = defaults.arenaMaxLvl;\r\n  setForage('fsh_arena', opts);\r\n  $('#fshMinLvl').val(opts.minLvl);\r\n  $('#fshMaxLvl').val(opts.maxLvl);\r\n  $('#arenaTypeTabs table[width=\"635\"]').DataTable().draw();\r\n}\r\n\r\nfunction hideMoves(evt) { // jQuery\r\n  opts = opts || {};\r\n  opts.hideMoves = evt.target.checked;\r\n  setForage('fsh_arena', opts);\r\n  $('.moveMax').toggle(!evt.target.checked);\r\n}\r\n\r\nfunction testIsNotDesc(test) {\r\n  return test && test[1] === '_desc';\r\n}\r\n\r\nfunction sortHandler(evt) { // jQuery\r\n  var self = $(evt.target).closest('td');\r\n  var table = self.closest('table').DataTable();\r\n  var myCol = self.index();\r\n  var classes = self.attr('class');\r\n  var test = /sorting([^\\s]+)/.exec(classes);\r\n  var sortOrder = 'desc';\r\n  if (testIsNotDesc(test)) {sortOrder = 'asc';}\r\n  if (myCol !== 3) {\r\n    table.order([3, 'asc'], [myCol, sortOrder]).draw();\r\n  } else {\r\n    table.order([3, sortOrder]).draw();\r\n  }\r\n}\r\n\r\nfunction hideMovesCheckbox(aTable) { // jQuery\r\n  var fshHideMoves = $('#fshHideMoves', aTable);\r\n  if (opts && 'hideMoves' in opts) {\r\n    fshHideMoves.prop('checked', opts.hideMoves);\r\n    $('.moveMax').toggle(!opts.hideMoves);\r\n  }\r\n  fshHideMoves.click(hideMoves);\r\n}\r\n\r\nfunction minLvlValue(aTable) { // jQuery\r\n  var fshMinLvl = $('#fshMinLvl', aTable);\r\n  if (opts && 'minLvl' in opts) {\r\n    fshMinLvl.val(opts.minLvl);\r\n  } else {\r\n    fshMinLvl.val(defaults.arenaMinLvl);\r\n  }\r\n}\r\n\r\nfunction maxLvlValue(aTable) { // jQuery\r\n  var fshMaxLvl = $('#fshMaxLvl', aTable);\r\n  if (opts && 'maxLvl' in opts) {\r\n    fshMaxLvl.val(opts.maxLvl);\r\n  } else {\r\n    fshMaxLvl.val(defaults.arenaMaxLvl);\r\n  }\r\n}\r\n\r\nfunction filterHeader() { // jQuery\r\n  var theRow = $('#pCC > table > tbody > tr:nth-child(7)');\r\n  theRow.clone().insertBefore(theRow).find('td').attr('height', '2');\r\n  theRow.clone().insertAfter(theRow).find('td').attr('height', '1');\r\n  var aTable = $(arenaFilter);\r\n  hideMovesCheckbox(aTable);\r\n  minLvlValue(aTable);\r\n  maxLvlValue(aTable);\r\n  $('#fshMinLvl, #fshMaxLvl', aTable).keyup(changeLvls);\r\n  $('#fshReset', aTable).click(resetLvls);\r\n  $('td', theRow).append(aTable);\r\n}\r\n\r\nvar doLvlFilter = [\r\n  function(min) {return !min;},\r\n  function(min, max) {return !max;},\r\n  function(min, max) {return isNaN(min) && isNaN(max);},\r\n  function(min, max, level) {return isNaN(min) && level <= max;},\r\n  function(min, max, level) {return min <= level && isNaN(max);},\r\n  function(min, max, level) {return min <= level && level <= max;}\r\n];\r\n\r\nfunction hazOpts(_settings, data) {\r\n  var min = opts.minLvl;\r\n  var max = opts.maxLvl;\r\n  var level = intValue(data[7]);\r\n  for (var i = 0; i < doLvlFilter.length; i += 1) {\r\n    if (doLvlFilter[i](min, max, level)) {return true;}\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction lvlFilter(_settings, data) {\r\n  if (opts) {return hazOpts(_settings, data);}\r\n  return true;\r\n}\r\n\r\nfunction players(cell) { // jQuery\r\n  var matches = /(\\d+)\\s\\/\\s(\\d+)/.exec(cell.text());\r\n  if (matches) {\r\n    cell.attr('data-order', matches[2] * 1000 + Number(matches[1]));\r\n  }\r\n}\r\n\r\nfunction boolData(cell) { // jQuery\r\n  var matches = /(\\d)\\.gif/.exec($('img', cell).attr('src'));\r\n  if (matches) {cell.attr('data-order', matches[1]);}\r\n}\r\n\r\nfunction hazMaxMoves(matches, row) { // jQuery\r\n  if (opts.moves[matches[1]] &&\r\n    opts.moves[matches[1]].count === 3) {\r\n    row.addClass('moveMax');\r\n  }\r\n}\r\n\r\nfunction optsHazMoves(cell, row) { // jQuery\r\n  var matches = /\\/pvp\\/(\\d+)\\.gif/.exec($('img', cell).attr('src'));\r\n  if (matches) {\r\n    hazMaxMoves(matches, row);\r\n    cell.attr('data-order', matches[1]);\r\n  }\r\n}\r\n\r\nfunction maxMoves(cell, row) { // jQuery\r\n  if (opts && opts.moves) {\r\n    optsHazMoves(cell, row);\r\n  }\r\n}\r\n\r\nfunction reward(cell) { // jQuery\r\n  if (cell.children('table').length !== 1) {return;}\r\n  cell.attr('data-order', cell.find('td').first().text().replace(/[,\\s]/g, ''));\r\n}\r\n\r\nfunction colourNewRow(row, id) { // jQuery\r\n  if (oldIds && !oldIds[id]) {\r\n    row.css('background-color', '#F5F298');\r\n    row.find('tr').css('background-color', '#F5F298');\r\n  }\r\n}\r\n\r\nfunction checkTournamentId(row, cell) { // jQuery\r\n  var matches = /#\\s(\\d+)/.exec(cell.text());\r\n  if ([matches, opts, opts.id].every(isObject)) {\r\n    opts.id[matches[1]] = matches[1];\r\n    colourNewRow(row, matches[1]);\r\n  }\r\n}\r\n\r\nfunction orderData(i, e) { // jQuery\r\n  var row = $(e);\r\n  var theCells = row.children();\r\n  var cell = theCells.eq(0);\r\n  checkTournamentId(row, cell);\r\n  players(theCells.eq(1));\r\n  cell = theCells.eq(2);\r\n  cell.attr('data-order', $('td', cell).first().text().replace(/[,\\s]/g, ''));\r\n  boolData(theCells.eq(4));\r\n  boolData(theCells.eq(5));\r\n  boolData(theCells.eq(6));\r\n  maxMoves(theCells.eq(8), row);\r\n  reward(theCells.eq(8));\r\n}\r\n\r\nfunction redoHead(i, e) { // jQuery\r\n  var firstRow = $('tr', e).first();\r\n  $('a', firstRow).contents().unwrap();\r\n  $(e).prepend($('<thead/>').append(firstRow));\r\n}\r\n\r\nfunction process(arena) { // jQuery\r\n\r\n  time('arena.process');\r\n\r\n  theTables.each(redoHead);\r\n  opts = arena || {};\r\n  oldIds = opts.id || {};\r\n  opts.id = {};\r\n  var myRows = theTables.children('tbody').children('tr');\r\n  myRows.each(orderData);\r\n  filterHeader();\r\n  setForage('fsh_arena', opts);\r\n  $.fn.dataTable.ext.search.push(lvlFilter);\r\n  theTables.DataTable(tableOpts);\r\n  $('td.sorting, td.sorting_asc, td.sorting_desc', tabs).off('click');\r\n  $('div.dataTables_filter').hide();\r\n  tabs.on('click', 'td.sorting, td.sorting_asc, td.sorting_desc', sortHandler);\r\n  tabs.on('click', 'input.custombutton[type=\"submit\"]', dontPost);\r\n\r\n  timeEnd('arena.process');\r\n\r\n}\r\n\r\nexport default function injectArena() { // jQuery\r\n  if (jQueryNotPresent()) {return;}\r\n  tabs = $('#arenaTypeTabs');\r\n  if (tabs.length !== 1) {return;} // Join error screen\r\n  theTables = $('table[width=\"635\"]', tabs);\r\n  getForage('fsh_arena').done(process);\r\n}\r\n","import buyitem from './app/potionbazaar/buyitem';\r\nimport {getElementById} from './common/getElement';\r\nimport insertElement from './common/insertElement';\r\nimport insertHtmlBeforeEnd from './common/insertHtmlBeforeEnd';\r\nimport jQueryNotPresent from './common/jQueryNotPresent';\r\nimport jsonFail from './common/jsonFail';\r\nimport outputResult from './common/outputResult';\r\nimport {pCC} from './support/layout';\r\nimport testQuant from './system/testQuant';\r\n\r\nvar ItemId;\r\nvar bazaarTable =\r\n  '<table id=\"fshBazaar\"><tr><td colspan=\"5\">Select an item to quick-buy:' +\r\n  '</td></tr><tr><td colspan=\"5\">Select how many to quick-buy</td></tr>' +\r\n  '<tr><td colspan=\"5\"><input id=\"buy_amount\" class=\"fshNumberInput\" ' +\r\n  'type=\"number\" min=\"0\" max=\"99\" value=\"1\"></td></tr><tr><td>@0@</td>' +\r\n  '<td>@1@</td><td>@2@</td><td>@3@</td><td>@4@</td></tr><tr><td>@5@</td>' +\r\n  '<td>@6@</td><td>@7@</td><td>@8@</td><td>@9@</td></tr><tr>' +\r\n  '<td colspan=\"3\">Selected item:</td><td id=\"selectedItem\" colspan=\"2\">' +\r\n  '</td></tr><tr><td colspan=\"5\">' +\r\n  '<span id=\"fshBazaarWarning\" class=\"fshHide\">' +\r\n  'Warning:<br>pressing [<span id=\"fshBuy\" class=\"fshLink\">This button' +\r\n  '</span>] now will buy the <span id=\"quantity\">1</span> item(s) WITHOUT ' +\r\n  'confirmation!</span></td></tr><tr><td colspan=\"5\">' +\r\n  '<span id=\"buyResultLabel\"></span><ol id=\"buy_result\"></ol>' +\r\n  '</td>' +\r\n  '</tr></table>';\r\nvar bazaarItem =\r\n  '<span class=\"bazaarButton tip-dynamic\" style=\"background-image: ' +\r\n  'url(\\'@src@\\');\" itemid=\"@itemid@\" data-tipped=\"@tipped@\"></span>';\r\n\r\nfunction testBuyAmount() {\r\n  return testQuant(getElementById('buy_amount').value);\r\n}\r\n\r\nfunction select(evt) {\r\n  var target = evt.target;\r\n  if (!target.classList.contains('bazaarButton')) {return;}\r\n  var theValue = testBuyAmount();\r\n  if (!theValue) {return;}\r\n  getElementById('quantity').textContent = theValue;\r\n  ItemId = target.getAttribute('itemid');\r\n  getElementById('fshBazaarWarning').removeAttribute('class');\r\n  var dupNode = target.cloneNode(false);\r\n  dupNode.className = 'bazaarSelected tip-dynamic';\r\n  var selected = getElementById('selectedItem');\r\n  selected.innerHTML = '';\r\n  insertElement(selected, dupNode);\r\n}\r\n\r\nfunction quantity() {\r\n  var theValue = testBuyAmount();\r\n  if (theValue) {\r\n    getElementById('quantity').textContent = theValue;\r\n  }\r\n}\r\n\r\nfunction done(json) {\r\n  var buyResult = getElementById('buy_result');\r\n  if (jsonFail(json, buyResult)) {return;}\r\n  if (json.s) {\r\n    outputResult('You purchased the item!', buyResult);\r\n  }\r\n}\r\n\r\nfunction buy() { // jQuery.min\r\n  if (!ItemId) {return;}\r\n  var buyAmount = getElementById('quantity').textContent;\r\n  getElementById('buyResultLabel').textContent =\r\n    'Buying ' + buyAmount + ' items';\r\n  for (var i = 0; i < buyAmount; i += 1) {\r\n    buyitem(ItemId).done(done);\r\n  }\r\n}\r\n\r\nexport default function injectBazaar() { // TODO stop using getElementById\r\n  if (jQueryNotPresent()) {return;}\r\n  var pbImg = pCC.getElementsByTagName('IMG')[0];\r\n  pbImg.className = 'fshFloatLeft';\r\n  var potions = pCC.getElementsByTagName('A');\r\n  Array.prototype.forEach.call(potions, function(el, i) {\r\n    var item = el.firstElementChild;\r\n    var tipped = item.dataset.tipped;\r\n    bazaarTable = bazaarTable\r\n      .replace('@' + i + '@', bazaarItem)\r\n      .replace('@src@', item.getAttribute('src'))\r\n      .replace('@itemid@', tipped.match(/\\?item_id=(\\d+)/)[1])\r\n      .replace('@tipped@', tipped);\r\n  });\r\n  bazaarTable = bazaarTable.replace(/@\\d@/g, '');\r\n  insertHtmlBeforeEnd(pbImg.parentNode, bazaarTable);\r\n  getElementById('fshBazaar').addEventListener('click', select);\r\n  getElementById('buy_amount').addEventListener('input', quantity);\r\n  getElementById('fshBuy').addEventListener('click', buy);\r\n}\r\n","function theValueIsValid(theValue, min, max) {\r\n  return !isNaN(theValue) && theValue > min && theValue < max;\r\n}\r\n\r\nexport default function testRange(aValue, min, max) {\r\n  var theValue = parseInt(aValue, 10);\r\n  if (theValueIsValid(theValue, min, max)) {\r\n    return theValue;\r\n  }\r\n}\r\n","import testRange from './testRange';\r\n\r\nexport default function testQuant(aValue) {\r\n  return testRange(aValue, 0, 100);\r\n}\r\n","import callApp from '../callApp';\r\n\r\nexport default function buyitem(item) {\r\n  return callApp({\r\n    cmd: 'potionbazaar',\r\n    subcmd: 'buyitem',\r\n    item_id: item\r\n  });\r\n}\r\n","import calf from '../../support/calf';\r\nimport {getElementById} from '../../common/getElement';\r\nimport getValue from '../../system/getValue';\r\nimport {pCC} from '../../support/layout';\r\nimport playerName from '../../common/playerName';\r\nimport {sendEvent} from '../../support/fshGa';\r\n\r\nvar buffCost = {count: 0, buffs: {}};\r\nvar numRE = /[^a-zA-Z0-9.,+\\- ]/g;\r\nvar priceRE =\r\n  /([+-]{0,1}[.\\d]+ *k)|([+-]{0,1}[.\\d]+ *fsp)|([+-]{0,1}[.\\d]+ *stam)/;\r\n\r\nfunction profileBuyBuffsEvent() {\r\n  if (calf.subcmd === '-') {sendEvent('profile', 'formatBuffsToBuy');}\r\n}\r\n\r\nfunction getTargetPlayer() {\r\n  var targetPlayer = pCC\r\n    .getElementsByTagName('h1');\r\n  if (targetPlayer.length !== 0) {\r\n    targetPlayer = targetPlayer[0].textContent;\r\n  } else {\r\n    targetPlayer = playerName();\r\n  }\r\n  return targetPlayer;\r\n}\r\n\r\nfunction formatBuffsToBuy() { // Legacy\r\n  profileBuyBuffsEvent();\r\n  var targetPlayer = getTargetPlayer();\r\n  var buffsToBuy = Object.keys(buffCost.buffs).join(', ');\r\n  var greetingText = getValue('buyBuffsGreeting').trim();\r\n  var hasBuffTag = greetingText.indexOf('{buffs}') !== -1;\r\n  var hasCostTag = greetingText.indexOf('{cost}') !== -1;\r\n  greetingText = greetingText.replace(/{playername}/g, targetPlayer);\r\n  if (!hasBuffTag) {\r\n    greetingText += ' ' + buffsToBuy;\r\n  } else if (!hasCostTag) {\r\n    greetingText = greetingText\r\n      .replace(/{buffs}/g, '`~' + buffsToBuy + '~`');\r\n  } else {\r\n    greetingText = greetingText\r\n      .replace(/{buffs}/g, '`~' + buffsToBuy + '~`')\r\n      .replace(/{cost}/g, buffCost.buffCostTotalText);\r\n  }\r\n  window.openQuickMsgDialog(targetPlayer, greetingText, '');\r\n}\r\n\r\nfunction getBuffsToBuy() { // Legacy\r\n  if (buffCost.count > 0) {formatBuffsToBuy();}\r\n}\r\n\r\nvar costFormatter = [\r\n  {\r\n    condition: function(total) {\r\n      return total.fsp > 0;\r\n    },\r\n    result: function(total) {\r\n      return String(Math.round(total.fsp * 100) / 100) + ' FSP';\r\n    }\r\n  },\r\n  {\r\n    condition: function(total) {\r\n      return total.fsp > 0 && total.k > 0;\r\n    },\r\n    result: function() {\r\n      return ' and ';\r\n    }\r\n  },\r\n  {\r\n    condition: function(total) {\r\n      return total.k > 0;\r\n    },\r\n    result: function(total) {\r\n      return total.k + ' k';\r\n    }\r\n  },\r\n  {\r\n    condition: function(total) {\r\n      return total.stam > 0 && (total.fsp > 0 || total.k > 0);\r\n    },\r\n    result: function() {\r\n      return ' and ';\r\n    }\r\n  },\r\n  {\r\n    condition: function(total) {\r\n      return total.stam > 0;\r\n    },\r\n    result: function(total) {\r\n      return total.stam + ' Stam(' +\r\n        String(Math.round(total.stam / 25 * 10) / 10) + 'fsp)';\r\n    }\r\n  },\r\n  {\r\n    condition: function(total) {\r\n      return total.unknown > 0;\r\n    },\r\n    result: function(total) {\r\n      return ' (' + total.unknown + ' buff(s) with unknown cost)';\r\n    }\r\n  }\r\n];\r\n\r\nfunction formatCost(total) {\r\n  return costFormatter.reduce(function(prev, el) {\r\n    var ret = prev;\r\n    if (el.condition(total)) {\r\n      ret += el.result(total);\r\n    }\r\n    return ret;\r\n  }, '');\r\n}\r\n\r\nfunction hazBuffs() { // Legacy\r\n  var total = {k: 0, fsp: 0, stam: 0, unknown: 0};\r\n  var html = 'This is an estimated cost based on how the script finds ' +\r\n    'the cost associated with buffs from viewing bio.' +\r\n    'It can be incorrect, please use with discretion.<br><hr>' +\r\n    '<table border=0>';\r\n\r\n  Object.keys(buffCost.buffs).forEach(function(buff) {\r\n    total[buffCost.buffs[buff][1]] += buffCost.buffs[buff][0];\r\n    html += '<tr><td>' + buff + '</td><td>: ' + buffCost.buffs[buff][0] +\r\n      buffCost.buffs[buff][1] + '</td></tr>';\r\n  });\r\n\r\n  var totalText = formatCost(total);\r\n\r\n  html += '</table><b>Total: ' + totalText + '</b>';\r\n  getElementById('buffCost').innerHTML = '<br/><span ' +\r\n    'class=\"tip-static\" data-tipped=\"' + html + '\">Estimated Cost: <b>' +\r\n    totalText + '</b></span>';\r\n  buffCost.buffCostTotalText = totalText;\r\n}\r\n\r\nfunction updateBuffCost() { // Legacy\r\n  if (buffCost.count > 0) {\r\n    hazBuffs();\r\n  } else {\r\n    getElementById('buffCost').innerHTML = '';\r\n    buffCost.buffCostTotalText = '';\r\n  }\r\n}\r\n\r\nfunction priceUnit(price) {\r\n  if (price[0].indexOf('k') > 0) {\r\n    return 'k';\r\n  }\r\n  if (price[0].indexOf('f') > 0) {\r\n    return 'fsp';\r\n  }\r\n  return 'stam';\r\n}\r\n\r\nfunction thisLine(node) {\r\n  return node && node.nodeName.toLowerCase() !== 'br';\r\n}\r\n\r\nfunction priceBeforeName(buffNameNode, price) {\r\n  if (!price) { // some players have prices BEFORE the buff names\r\n    var newtext;\r\n    var text = '';\r\n    var node = buffNameNode;\r\n    while (thisLine(node)) {\r\n      newtext = node.textContent;\r\n      node = node.previousSibling;\r\n      text = newtext + text;\r\n    }\r\n    return text.replace(numRE, '').toLowerCase().match(priceRE);\r\n  }\r\n  return price;\r\n}\r\n\r\nfunction getBuffCost(buffNameNode) {\r\n  var node = buffNameNode;\r\n  var buffName = node.textContent;\r\n  var newtext;\r\n  var text = '';\r\n  // get the whole line from the buff name towards the end (even after\r\n  // the ',', in case of 'AL, Lib, Mer: 10k each'\r\n  while (thisLine(node)) {\r\n    newtext = node.textContent;\r\n    node = node.nextSibling;\r\n    text += newtext;\r\n  }\r\n  var price = text.replace(numRE, '').toLowerCase().match(priceRE);\r\n  price = priceBeforeName(buffNameNode, price);\r\n  var type;\r\n  var cost;\r\n  if (price) {\r\n    type = priceUnit(price);\r\n    cost = price[0].match(/([+-]{0,1}[.\\d]+)/)[0];\r\n  } else {\r\n    type = 'unknown';\r\n    cost = '1';\r\n  }\r\n  buffCost.buffs[buffName] = [parseFloat(cost), type];\r\n  buffCost.count += 1;\r\n}\r\n\r\nfunction toggleBuffsToBuy(evt) { // Legacy\r\n  // This is also called by bio preview\r\n  var buffNameNode = evt.target;\r\n  while (buffNameNode.tagName.toLowerCase() !== 'span') {\r\n    buffNameNode = buffNameNode.parentNode;\r\n  }\r\n  var node = buffNameNode;\r\n  var selected = node.classList.contains('fshBlue');\r\n  node.classList.toggle('fshBlue');\r\n  node.classList.toggle('fshYellow');\r\n  var buffName = node.textContent;\r\n  if (selected) {\r\n    getBuffCost(buffNameNode);\r\n  } else {\r\n    buffCost.count -= 1;\r\n    delete buffCost.buffs[buffName];\r\n  }\r\n  updateBuffCost();\r\n}\r\n\r\nfunction getBuffNameNode(e) {\r\n  var buffNameNode = e.target;\r\n  while (buffNameNode.tagName &&\r\n      buffNameNode.tagName.toLowerCase() !== 'span') {\r\n    buffNameNode = buffNameNode.parentNode;\r\n  }\r\n  return buffNameNode;\r\n}\r\n\r\nfunction isBuffLink(buffNameNode) {\r\n  return buffNameNode.classList &&\r\n    buffNameNode.classList.contains('buffLink');\r\n}\r\n\r\nexport default function bioEvtHdl(e) {\r\n  var buffNameNode = getBuffNameNode(e);\r\n  if (isBuffLink(buffNameNode)) {\r\n    toggleBuffsToBuy(e);\r\n  } else if (e.target.id === 'fshSendBuffMsg') {\r\n    getBuffsToBuy(e);\r\n  }\r\n}\r\n","import bioEvtHdl from './bioEvtHdl';\r\nimport calf from '../../support/calf';\r\nimport {getElementById} from '../../common/getElement';\r\nimport getValue from '../../system/getValue';\r\nimport insertElement from '../../common/insertElement';\r\nimport insertHtmlBeforeEnd from '../../common/insertHtmlBeforeEnd';\r\nimport insertTextBeforeEnd from '../../common/insertTextBeforeEnd';\r\nimport {pCC} from '../../support/layout';\r\nimport renderBio from './render';\r\nimport setValue from '../../system/setValue';\r\nimport testQuant from '../../system/testQuant';\r\nimport {createDiv, createInput} from '../../common/cElement';\r\n\r\nvar bioEditLines;\r\nvar textArea;\r\nvar previewArea;\r\nvar theBox;\r\n\r\nfunction convertTextToHtml(inputText) {\r\n  var ret = inputText\r\n    .replace(/</g, '&lt')\r\n    .replace(/>/g, '&gt')\r\n    .replace(/\\n/g, '<br>')\r\n    .replace(/\\[(\\/?)([biu])\\]/g, '<$1$2>')\r\n    .replace(/\\\\\\\\/g, '&#92')\r\n    .replace(/\\\\/g, '');\r\n  if (calf.cmd === 'guild') {\r\n    ret = ret\r\n      .replace(/\\[(\\/?)block\\]/g, '<$1blockquote>')\r\n      .replace(/\\[list\\]/g, '<ul class=\"list\">')\r\n      .replace(/\\[\\/list\\]/g, '</ul>')\r\n      .replace(/\\[\\*\\](.*?)<br>/g, '<li>$1</li>');\r\n  }\r\n  return ret;\r\n}\r\n\r\nfunction bioPreview() {\r\n  var widthClass = 'fshBioProfile';\r\n  if (calf.cmd === 'guild') {\r\n    if (calf.subcmd === 'hall') {widthClass = 'fshBioHall';} else {\r\n      widthClass = 'fshBioGuild';\r\n    }\r\n  }\r\n  var previewContainer = createDiv({\r\n    className:\r\n      'fshBioContainer ' + widthClass\r\n  });\r\n  var previewHeader = createDiv({\r\n    className: 'fshBioHeader fshBioInner',\r\n    innerHTML: 'Preview'\r\n  });\r\n  insertElement(previewContainer, previewHeader);\r\n  previewArea = createDiv({className: 'fshBioPreview fshBioInner'});\r\n  insertElement(previewContainer, previewArea);\r\n  insertElement(textArea.parentNode, previewContainer);\r\n}\r\n\r\nfunction bioWords() {\r\n  if (calf.cmd === 'profile') {\r\n    // Add description text for the new tags\r\n    insertHtmlBeforeEnd(pCC, '<div>' +\r\n      '`~This will allow FSH Script users to select buffs from your bio~`<br>' +\r\n      'You can use the [cmd] tag as well to determine where to put the \"Ask ' +\r\n      'For Buffs\" button<br><br><blockquote><ul class=\"list\">' +\r\n      '<li>Note 1: The ` and ~ characters are on the same key on US QWERTY ' +\r\n      'keyboards. ` is <b>NOT</b> an apostrophe.</li>' +\r\n      '<li>Note 2: Inner text will not contain special characters ' +\r\n      '(non-alphanumeric).</li>' +\r\n      '<li>P.S. Be creative with these! Wrap your buff pack names in ' +\r\n      'them to make buffing even easier!</li>' +\r\n      '</ul></blockquote></div>');\r\n  }\r\n}\r\n\r\nfunction changeHeight() {\r\n  var boxVal = testQuant(theBox.value);\r\n  if (boxVal) {\r\n    bioEditLines = boxVal;\r\n    setValue('bioEditLines', boxVal);\r\n    textArea.rows = bioEditLines;\r\n  }\r\n}\r\n\r\nfunction bioHeight() {\r\n  var bioEditLinesDiv = createDiv({innerHTML: '<br>Display '});\r\n  theBox = createInput({min: 1, max: 99, type: 'number', value: bioEditLines});\r\n  insertElement(bioEditLinesDiv, theBox);\r\n  insertTextBeforeEnd(bioEditLinesDiv, ' Lines ');\r\n  var saveLines = createInput({\r\n    className: 'custombutton',\r\n    value: 'Update Rows To Show',\r\n    type: 'button'\r\n  });\r\n  saveLines.addEventListener('click', changeHeight);\r\n  insertElement(bioEditLinesDiv, saveLines);\r\n  insertElement(pCC, bioEditLinesDiv);\r\n}\r\n\r\nfunction updateBioCharacters() {\r\n  var bioContents = convertTextToHtml(textArea.value);\r\n  bioContents = renderBio(bioContents);\r\n  previewArea.innerHTML = bioContents;\r\n}\r\n\r\nexport default function injectBioWidgets() {\r\n  bioEditLines = getValue('bioEditLines');\r\n  textArea = getElementById('textInputBox');\r\n  bioPreview();\r\n  bioWords();\r\n  bioHeight();\r\n  textArea.rows = bioEditLines;\r\n  if (calf.cmd === 'profile') {\r\n    textArea.parentNode.addEventListener('click', bioEvtHdl);\r\n  }\r\n  textArea.addEventListener('keyup', updateBioCharacters);\r\n  // Force the preview area to render\r\n  updateBioCharacters();\r\n}\r\n","import addCommas from '../system/addCommas';\r\nimport getMercStats from '../ajax/getMercStats';\r\nimport groupViewStats from '../ajax/groupViewStats';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\n\r\nvar groupStats;\r\n\r\nfunction displayStat(el, groupStat, mercStat) {\r\n  el.innerHTML = '<span class=\"fshBlue\">' + addCommas(groupStat) + '</span>' +\r\n    ' ( ' + addCommas(groupStat - mercStat) + ' )';\r\n}\r\n\r\nfunction parseMercStats(mercStats) {\r\n  displayStat(groupStats.attackElement, groupStats.attack, mercStats.attack);\r\n  displayStat(groupStats.defenseElement, groupStats.defense, mercStats.defense);\r\n  displayStat(groupStats.armorElement, groupStats.armor, mercStats.armor);\r\n  displayStat(groupStats.damageElement, groupStats.damage, mercStats.damage);\r\n  displayStat(groupStats.hpElement, groupStats.hp, mercStats.hp);\r\n}\r\n\r\nexport default function injectGroupStats() { // jQuery\r\n  if (jQueryNotPresent()) {return;}\r\n  groupStats = groupViewStats(document);\r\n  if (groupStats.attackElement) {\r\n    getMercStats().done(parseMercStats);\r\n  }\r\n}\r\n","import calf from '../support/calf';\r\nimport doBuffLinks from '../common/doBuffLinks';\r\nimport findNode from '../system/findNode';\r\nimport findNodes from '../system/findNodes';\r\nimport {getElementById} from '../common/getElement';\r\nimport getGroupStats from '../ajax/getGroupStats';\r\nimport getMembrList from '../ajax/getMembrList';\r\nimport getValue from '../system/getValue';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {months} from '../support/constants';\r\nimport {onlineDot} from '../common/colouredDots';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport {server} from '../system/system';\r\nimport {time, timeEnd} from '../support/debug';\r\n\r\nvar maxGroupSizeToJoin;\r\n\r\nfunction displayMinGroupLevel() { // jQuery\r\n  var minGroupLevel = getValue('minGroupLevel');\r\n  if (minGroupLevel) {\r\n    $('#pCC > table > tbody > tr > td > table td').first()\r\n      .append('<span style=\"color:blue\"> ' +\r\n      'Current Min Level Setting: ' + minGroupLevel + '</span>');\r\n  }\r\n}\r\n\r\nfunction filterMercs(e) {return !e.includes('#000099');}\r\n\r\nfunction joinGroup(groupJoinURL, joinButton) { // jQuery\r\n  return retryAjax(groupJoinURL).done(function() {\r\n    joinButton.classList.add('fshHide');\r\n  });\r\n}\r\n\r\nfunction doJoinUnderSize(prev, joinButton) { // Legacy\r\n  var memList = joinButton.parentNode.parentNode.parentNode\r\n    .previousSibling.previousSibling.previousSibling.previousSibling;\r\n  var memListArrayWithMercs = memList.innerHTML.split(',');\r\n  var memListArrayWithoutMercs = memListArrayWithMercs\r\n    .filter(filterMercs);\r\n  if (memListArrayWithoutMercs.length < maxGroupSizeToJoin) {\r\n    var groupID = /javascript:confirmJoin\\((\\d+)\\)/.exec(\r\n      joinButton.parentNode.href)[1];\r\n    var groupJoinURL = 'index.php?no_mobile=1&cmd=guild&subcmd=groups' +\r\n      '&subcmd2=join&group_id=' + groupID;\r\n    prev.push(joinGroup(groupJoinURL, joinButton));\r\n  }\r\n  return prev;\r\n}\r\n\r\nfunction joinAllGroupsUnderSize() { // Legacy\r\n  var joinButtons = findNodes(\r\n    '//img[contains(@src,\"skin/icon_action_join.gif\")]');\r\n  if (!joinButtons) {return;}\r\n  var prm = joinButtons.reduce(doJoinUnderSize, []);\r\n  $.when.apply($, prm).done(function() {\r\n    location.href = 'index.php?cmd=guild&subcmd=groups';\r\n  });\r\n}\r\n\r\nfunction parseGroupData(linkElement, obj) {\r\n  var extraText = '<table class=\"fshgrpstat\">' +\r\n    '<tr>' +\r\n    '<td class=\"fshBrown\">Attack</td>' +\r\n    '<td class=\"fshRight\">' + obj.attack + '</td>' +\r\n    '<td class=\"fshBrown\">Defense</td>' +\r\n    '<td class=\"fshRight\">' + obj.defense + '</td>' +\r\n    '</tr><tr>' +\r\n    '<td class=\"fshBrown\">Armor</td>' +\r\n    '<td class=\"fshRight\">' + obj.armor + '</td>' +\r\n    '<td class=\"fshBrown\">Damage</td>' +\r\n    '<td class=\"fshRight\">' + obj.damage + '</td>' +\r\n    '</tr><tr>' +\r\n    '<td class=\"fshBrown\">HP</td>' +\r\n    '<td class=\"fshRight\">' + obj.hp + '</td>' +\r\n    '<td colspan=\"2\"></td>' +\r\n    '</tr></table>';\r\n  var expiresLocation = linkElement.parentNode.parentNode\r\n    .previousElementSibling;\r\n  insertHtmlBeforeEnd(expiresLocation, extraText);\r\n}\r\n\r\nfunction fetchGroupData(evt) {\r\n  evt.target.classList.add('fshHide');\r\n  var allItems = document.querySelectorAll('#pCC a[href*=\"=viewstats&\"]');\r\n  Array.prototype.forEach.call(allItems, function(aLink) {\r\n    getGroupStats(aLink.href).done(parseGroupData.bind(null, aLink));\r\n  });\r\n}\r\n\r\nfunction groupButtons() { // Legacy\r\n  var buttonElement = findNode('//td[input[@value=\"Join All ' +\r\n    'Available Groups\"]]');\r\n  var enableMaxGroupSizeToJoin =\r\n    getValue('enableMaxGroupSizeToJoin');\r\n  if (enableMaxGroupSizeToJoin) {\r\n    maxGroupSizeToJoin = getValue('maxGroupSizeToJoin');\r\n    var joinAllInput = buttonElement.firstChild.nextSibling.nextSibling;\r\n    joinAllInput.classList.add('fshHide');\r\n    buttonElement.innerHTML += '&nbsp;<input id=\"joinallgroupsunder' +\r\n      'size\" type=\"button\" value=\"Join All Groups < ' +\r\n      maxGroupSizeToJoin + ' Members\" class=\"custombutton\">&nbsp;' +\r\n      '<input id=\"fetchgroupstats\" type=\"button\" value=\"Fetch ' +\r\n      'Group Stats\" class=\"custombutton\">';\r\n    getElementById('joinallgroupsundersize')\r\n      .addEventListener('click', joinAllGroupsUnderSize, true);\r\n  } else {\r\n    buttonElement.innerHTML += '&nbsp;<input id=\"fetchgroupstats\" ' +\r\n      'type=\"button\" value=\"Fetch Group Stats\" class=\"custombutton\">';\r\n  }\r\n  getElementById('fetchgroupstats')\r\n    .addEventListener('click', fetchGroupData);\r\n\r\n  if (calf.subcmd2 === 'joinallgroupsundersize') {\r\n    joinAllGroupsUnderSize();\r\n  }\r\n}\r\n\r\nfunction fixTable() { // jQuery\r\n  // Cows don't add!\r\n  var tds = $('#pCC td.header-dark');\r\n  tds.eq(0).attr('width', '20%');\r\n  tds.eq(1).attr('width', '51%');\r\n  tds.eq(2).attr('width', '22%');\r\n  tds.eq(3).attr('width', '7%');\r\n}\r\n\r\nfunction groupLocalTime(theDateCell) { // jQuery\r\n  var xRE = /([a-zA-Z]+), (\\d+) ([a-zA-Z]+) (\\d+):(\\d+):(\\d+) UTC/;\r\n  var x = xRE.exec(theDateCell.text());\r\n  var month = months.indexOf(x[3]);\r\n  var curYear = new Date().getFullYear(); // Boundary condition\r\n  var groupDate = new Date();\r\n  groupDate.setUTCDate(x[2]);\r\n  groupDate.setUTCMonth(month);\r\n  groupDate.setUTCFullYear(curYear);\r\n  groupDate.setUTCHours(x[4]);\r\n  groupDate.setUTCMinutes(x[5]);\r\n  theDateCell.append('<br><span style=\"color:blue; font-size:x-small\">' +\r\n    'Local: ' + groupDate.toString().substr(0, 21) + '</span>');\r\n}\r\n\r\nfunction getCreator(membrlist, creator) {\r\n  if (membrlist[creator]) {\r\n    return onlineDot({last_login: membrlist[creator].last_login}) +\r\n      '&nbsp;<a href=\"' + server + 'index.php?cmd=profile&player_id=' +\r\n      membrlist[creator].id + '\"><b>' + creator + '</b></a> [' +\r\n      membrlist[creator].level + ']';\r\n  }\r\n  return '<b>' + creator + '</b>';\r\n}\r\n\r\nfunction memberLevel(membrlist, member) {\r\n  if (membrlist[member]) {return membrlist[member].level;}\r\n  return 0;\r\n}\r\n\r\nfunction byMember(membrlist, a, b) {\r\n  return memberLevel(membrlist, b) - memberLevel(membrlist, a);\r\n}\r\n\r\nfunction doGroupRow(row, membrlist) { // jQuery\r\n  var creator = $('b', row).text();\r\n  var td = $('td', row).first();\r\n  td.html(getCreator(membrlist, creator));\r\n  var td2 = $('td', row).eq(1);\r\n  var theList = td2.html();\r\n  var listArr = theList.split(', ');\r\n  if (listArr.length > 1) {listArr.sort(byMember.bind(null, membrlist));}\r\n  var buffList = listArr.filter(function(name) {\r\n    return name !== '[none]' && name.indexOf('<font') === -1;\r\n  });\r\n  if (buffList.length > 0) {td.append(doBuffLinks(buffList));}\r\n  td.append('<span class=\"fshXSmall\">Members: ' +\r\n    buffList.length + '</span>');\r\n  listArr = listArr.map(function(name) {\r\n    if (!membrlist[name]) {return name;}\r\n    return '<a href=\"index.php?cmd=profile&player_id=' +\r\n      membrlist[name].id + '\">' + name + '</a>';\r\n  });\r\n  td2.html('<span>' + listArr.join(', ') + '</span>');\r\n  groupLocalTime($('td', row).eq(2));\r\n}\r\n\r\nfunction doGroupPaint(m) { // jQuery\r\n\r\n  time('groups.doGroupPaint');\r\n\r\n  $('#pCC table table table tr').has('.group-action-container')\r\n    .each(function(i, e) {\r\n      doGroupRow(e, m);\r\n    });\r\n\r\n  timeEnd('groups.doGroupPaint');\r\n\r\n}\r\n\r\nexport default function injectGroups() { // jQuery\r\n  if (jQueryNotPresent()) {return;}\r\n  getMembrList(false)\r\n    .done(doGroupPaint);\r\n  displayMinGroupLevel();\r\n  groupButtons();\r\n  fixTable();\r\n}\r\n","import add from '../../support/task';\r\nimport alpha from '../../common/alpha';\r\nimport formatLocalDateTime from '../../common/formatLocalDateTime';\r\nimport insertElement from '../../common/insertElement';\r\nimport insertHtmlBeforeEnd from '../../common/insertHtmlBeforeEnd';\r\nimport isUndefined from '../../common/isUndefined';\r\nimport {act, cur, gxp, lvl, max, utc, vl} from './indexConstants';\r\nimport {\r\n  createDiv,\r\n  createTBody,\r\n  createTable,\r\n  createTh,\r\n} from '../../common/cElement';\r\n\r\nvar actBody;\r\nvar selMember;\r\nvar tgCont;\r\nvar memberSelect;\r\nvar myMembers;\r\n\r\nfunction buildOptions(ourMembers) {\r\n  return '<select name=\"member\">' +\r\n    '<option value=\"- All -\" selected>- All -</option>' +\r\n    Object.keys(ourMembers).sort(alpha).reduce(function(prev, member) {\r\n      return prev + '<option value=\"' + member + '\">' + member + '</option>';\r\n    }, '') + '</select>';\r\n}\r\n\r\nfunction toText(val) {\r\n  if (isUndefined(val)) {return '#DEF';}\r\n  return val.toLocaleString();\r\n}\r\n\r\nfunction memberFilter(memberKey) {\r\n  return selMember && selMember !== '- All -' && selMember !== memberKey;\r\n}\r\n\r\nfunction aMembersActivityRows(memberKey) {\r\n  return function(inside, activity) {\r\n    return inside + '<tr>' +\r\n      '<td>' +\r\n      formatLocalDateTime(new Date(activity[utc] * 1000)) +\r\n      '</td>' +\r\n      '<td>' + memberKey + '</td>' +\r\n      '<td class=\"fshRight\">' + toText(activity[lvl]) + '</td>' +\r\n      '<td class=\"fshRight\">' + toText(activity[vl]) + '</td>' +\r\n      '<td class=\"fshRight\">' + toText(activity[cur]) + '</td>' +\r\n      '<td class=\"fshRight\">' + toText(activity[max]) + '</td>' +\r\n      '<td class=\"fshRight\">' +\r\n        Math.floor(activity[cur] / activity[max] * 100) +\r\n      '</td>' +\r\n      '<td class=\"fshRight\">' + activity[act] + '</td>' +\r\n      '<td class=\"fshRight\">' + toText(activity[gxp]) + '</td>' +\r\n      '</tr>';\r\n  };\r\n}\r\n\r\nfunction memberRows() {\r\n  return Object.keys(myMembers).reduce(function(outside, memberKey) {\r\n    if (memberFilter(memberKey)) {return outside;}\r\n    return outside +\r\n      myMembers[memberKey].reduce(aMembersActivityRows(memberKey), '');\r\n  }, '');\r\n}\r\n\r\nfunction drawRows() {\r\n  if (myMembers) {actBody.innerHTML = memberRows();}\r\n  tgCont.classList.remove('fshSpinner');\r\n}\r\n\r\nfunction queueDrawRows() {\r\n  tgCont.classList.add('fshSpinner');\r\n  add(3, drawRows);\r\n}\r\n\r\nfunction myChange(e) {\r\n  selMember = e.target.value;\r\n  queueDrawRows();\r\n}\r\n\r\nexport function initTable(theMembers) {\r\n  if (theMembers) {\r\n    myMembers = theMembers;\r\n    memberSelect.innerHTML = buildOptions(theMembers);\r\n    queueDrawRows();\r\n  }\r\n}\r\n\r\nexport function makeTg() {\r\n  var tg = createTable({id: 'tg'});\r\n  var hrow = tg.createTHead().insertRow(-1);\r\n  insertHtmlBeforeEnd(hrow, '<th>Date</th>');\r\n\r\n  var memberHead = createTh({textContent: 'Member'});\r\n  memberSelect = createDiv();\r\n  insertElement(memberHead, memberSelect);\r\n  insertElement(hrow, memberHead);\r\n\r\n  insertHtmlBeforeEnd(hrow, '<th>Level</th><th>VL</th>' +\r\n    '<th>Stam</th><th>Max<br>Stam</th><th>Stam<br>%</th>' +\r\n    '<th>Last<br>Activity<br>(Days)</th><th>GXP</th>');\r\n\r\n  actBody = createTBody();\r\n  insertElement(tg, actBody);\r\n  tg.addEventListener('change', myChange);\r\n  tgCont = createDiv({className: 'tgCont fshSpinner64'});\r\n  insertElement(tgCont, tg);\r\n  return tgCont;\r\n}\r\n","import add from '../../support/task';\r\nimport {initTable} from './trackerTable';\r\nimport insertElement from '../../common/insertElement';\r\nimport jsonParse from '../../common/jsonParse';\r\nimport setForage from '../../ajax/setForage';\r\nimport {\r\n  createBr,\r\n  createButton,\r\n  createDiv,\r\n  createTextArea,\r\n} from '../../common/cElement';\r\n\r\nvar ioText;\r\nvar saveBtn;\r\nvar resetBtn;\r\nvar io;\r\n\r\nfunction drawRawData(trackerData) {\r\n  ioText.value = trackerData;\r\n  io.classList.remove('fshSpinner');\r\n}\r\n\r\nexport function queueRawData(trackerData) {\r\n  if (trackerData) {\r\n    io.classList.add('fshSpinner');\r\n    add(4, drawRawData, [trackerData]);\r\n  }\r\n}\r\n\r\nfunction doReset() {\r\n  ioText.value = '{\"lastUpdate\": 0, \"members\": {}}';\r\n}\r\n\r\nfunction doSave() {\r\n  var newData = jsonParse(ioText.value);\r\n  setForage('fsh_guildActivity', newData)\r\n    .done(function() {\r\n      $('#dialog_msg').text('Update successful').dialog('open');\r\n      initTable(newData.members);\r\n    })\r\n    .fail(function(err) {\r\n      $('#dialog_msg').text(err).dialog('open');\r\n    });\r\n}\r\n\r\nfunction customButton(text, fn) {\r\n  var btn = createButton({\r\n    className: 'custombutton',\r\n    textContent: text\r\n  });\r\n  btn.addEventListener('click', fn);\r\n  return btn;\r\n}\r\n\r\nexport function makeInOut() {\r\n  io = createDiv({id: 'io', className: 'fshSpinner64'});\r\n  ioText = createTextArea();\r\n  ioText.setAttribute('autocapitalize', 'off');\r\n  ioText.setAttribute('autocomplete', 'off');\r\n  ioText.setAttribute('autocorrect', 'off');\r\n  ioText.setAttribute('spellcheck', 'false');\r\n  saveBtn = customButton('Save', doSave);\r\n  resetBtn = customButton('Reset', doReset);\r\n  insertElement(io, ioText);\r\n  insertElement(io, createBr());\r\n  insertElement(io, saveBtn);\r\n  insertElement(io, resetBtn);\r\n  return io;\r\n}\r\n","import calf from '../../support/calf';\r\nimport draggable from '../../common/dragStart';\r\nimport getForage from '../../ajax/getForage';\r\nimport getValue from '../../system/getValue';\r\nimport insertElement from '../../common/insertElement';\r\nimport insertHtmlBeforeEnd from '../../common/insertHtmlBeforeEnd';\r\nimport setValue from '../../system/setValue';\r\nimport {simpleCheckboxHtml} from '../../settings/simpleCheckbox';\r\nimport {\r\n  createDiv,\r\n  createInput,\r\n  createTr,\r\n  createUl\r\n} from '../../common/cElement';\r\nimport {initTable, makeTg} from './trackerTable';\r\nimport {makeInOut, queueRawData} from './rawData';\r\n\r\nvar trackerData;\r\nvar tracker;\r\nvar trDialog;\r\nvar acttab2;\r\n\r\nfunction isClosed() {\r\n  return !tracker.checked;\r\n}\r\n\r\nfunction isOpen() {\r\n  return tracker.checked;\r\n}\r\n\r\nfunction closeDialog() {\r\n  tracker.checked = false;\r\n}\r\n\r\nfunction keydownHandler(evt) {\r\n  if (isOpen() && evt.code === 'Escape') {\r\n    closeDialog();\r\n  }\r\n}\r\n\r\nfunction makeDragHandle() {\r\n  return createUl({\r\n    className: 'fshMove ui-tabs-nav ui-widget-header ui-corner-all ' +\r\n      'ui-helper-reset ui-helper-clearfix',\r\n    innerHTML: '<li class=\"ui-state-default ui-corner-top\">' +\r\n      '<label class=\"fsh-tab-label\" for=\"acttab1\">' +\r\n      'Guild Activity Tracker</label></li>' +\r\n      '<li class=\"ui-state-default ui-corner-top\">' +\r\n      '<label class=\"fsh-tab-label\" for=\"acttab2\">Import/Export</label></li>' +\r\n      '<label for=\"tracker\" class=\"fsh-dialog-close ' +\r\n      'ui-dialog-titlebar-close\">&times;</label>'\r\n  });\r\n}\r\n\r\nfunction updateRawData() {\r\n  acttab2.removeEventListener('change', updateRawData);\r\n  if (trackerData) {queueRawData(trackerData);}\r\n}\r\n\r\nfunction makeInnerPopup() {\r\n  var dialogPopup = createDiv({\r\n    className: 'fsh-dialog-popup ' +\r\n      'ui-dialog ui-tabs ui-widget ui-widget-content ui-corner-all',\r\n    innerHTML: '<input id=\"acttab1\" class=\"fsh-tab-open\" ' +\r\n      'name=\"acttabs\" checked type=\"radio\">'\r\n  });\r\n  acttab2 = createInput({\r\n    className: 'fsh-tab-open',\r\n    id: 'acttab2',\r\n    name: 'acttabs',\r\n    type: 'radio'\r\n  });\r\n  acttab2.addEventListener('change', updateRawData);\r\n  insertElement(dialogPopup, acttab2);\r\n  return dialogPopup;\r\n}\r\n\r\nfunction makePopup() {\r\n  var ret = makeInnerPopup();\r\n  var hdl = makeDragHandle();\r\n  insertElement(ret, hdl);\r\n  var container = createDiv({className: 'fsh-dialog-content'});\r\n  insertElement(container, makeTg());\r\n  insertElement(container, makeInOut());\r\n  insertElement(ret, container);\r\n  draggable(hdl, ret);\r\n  insertElement(trDialog, ret);\r\n}\r\n\r\nfunction addOverlay() {\r\n  insertHtmlBeforeEnd(trDialog,\r\n    '<div class=\"fsh-dialog-overlay\">' +\r\n    '<label class=\"fsh-dialog-cancel\" for=\"tracker\"></label>' +\r\n    '</div>');\r\n}\r\n\r\nfunction gotActivity(data) {\r\n  if (data) {\r\n    trackerData = JSON.stringify(data);\r\n    initTable(data.members);\r\n  }\r\n}\r\n\r\nfunction togglePref(evt) {\r\n  if (evt.target.id === 'enableGuildActivityTracker') {\r\n    setValue('enableGuildActivityTracker',\r\n      !getValue('enableGuildActivityTracker'));\r\n  }\r\n}\r\n\r\nfunction openDialog() {\r\n  getForage('fsh_guildActivity').done(gotActivity);\r\n  tracker.removeEventListener('change', openDialog);\r\n  calf.dialogIsClosed = isClosed;\r\n  addOverlay();\r\n  makePopup();\r\n}\r\n\r\nexport default function guildTracker() {\r\n  var gs = document.querySelector('#pCC img.guild_openGuildStore');\r\n  var oldTr = gs.parentNode.parentNode;\r\n  var newTr = createTr();\r\n  var cellOne = newTr.insertCell(-1);\r\n  var cellTwo = newTr.insertCell(-1);\r\n  insertElement(cellOne, gs);\r\n  cellTwo.innerHTML = simpleCheckboxHtml('enableGuildActivityTracker') +\r\n    '&nbsp;<label class=\"custombutton\" for=\"tracker\">Show</label>';\r\n  newTr.addEventListener('change', togglePref);\r\n  oldTr.parentNode.replaceChild(newTr, oldTr);\r\n  tracker = createInput({\r\n    id: 'tracker',\r\n    className: 'fsh-dialog-open',\r\n    type: 'checkbox'\r\n  });\r\n  tracker.addEventListener('change', openDialog);\r\n  trDialog = createDiv({className: 'fsh-dialog'});\r\n  insertElement(trDialog, tracker);\r\n  document.body.addEventListener('keydown', keydownHandler);\r\n  insertElement(document.body, trDialog);\r\n}\r\n","import add from '../support/task';\r\nimport {colouredDots} from '../common/colouredDots';\r\nimport createDocument from '../system/createDocument';\r\nimport findNode from '../system/findNode';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport guildTracker from './guildTracker/guildTracker';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport moreToDo from '../common/moreToDo';\r\nimport openQuickBuffByName from '../common/openQuickBuffByName';\r\nimport {pCC} from '../support/layout';\r\nimport playerName from '../common/playerName';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport toggleVisibilty from '../common/toggleVisibilty';\r\nimport {guildXPLock, removeGuildAvyImgBorder} from './guildUtils';\r\n\r\nvar leftHandSideColumnTable;\r\nvar members;\r\nvar memCount;\r\n\r\nfunction hazConflict(conflictTable, curPage, insertHere) { // Legacy\r\n  if (curPage === 1) {\r\n    var newNode = insertHere.insertRow(insertHere.rows.length - 2);\r\n    newNode.insertCell(0);\r\n    newNode.insertCell(0);\r\n    newNode.cells[0].innerHTML =\r\n      '<a href=\"index.php?cmd=guild&subcmd=conflicts\">Active Conflicts</a>';\r\n    newNode.cells[1].innerHTML = 'Score';\r\n  }\r\n  for (var i = 1; i <= conflictTable.rows.length - 4; i += 2) {\r\n    var newRow = insertHere.insertRow(insertHere.rows.length - 2);\r\n    newRow.insertCell(0);\r\n    newRow.insertCell(0);\r\n    newRow.cells[0].innerHTML = conflictTable.rows[i].cells[0].innerHTML;\r\n    newRow.cells[1].innerHTML = '<b>' + conflictTable.rows[i].cells[6]\r\n      .innerHTML + '</b>';\r\n  }\r\n}\r\n\r\nfunction activeConflicts(doc, curPage, insertHere) { // Legacy\r\n  var conflictTable = findNode(\r\n    '//font[contains(.,\"Participants\")]/ancestor::table[1]', doc);\r\n  if (conflictTable && conflictTable.rows.length > 3) {\r\n    hazConflict(conflictTable, curPage, insertHere);\r\n  }\r\n}\r\n\r\nfunction gotConflictInfo(responseText, callback) { // Legacy\r\n  var doc = createDocument(responseText);\r\n  var page = findNode('//td[contains(.,\"Page:\")]', doc);\r\n  var curPage = parseInt(findNode('//input[@name=\"page\"]',\r\n    doc).value, 10);\r\n  var maxPage = page.innerHTML.match(/of&nbsp;(\\d*)/);\r\n  activeConflicts(doc, curPage, callback.node);\r\n  if (maxPage && parseInt(maxPage[1], 10) > curPage) {\r\n    retryAjax('index.php?no_mobile=1&cmd=guild&subcmd=conflicts&page=' +\r\n      (curPage + 1).toString()\r\n    ).done(function(html) {\r\n      gotConflictInfo(html, {node: callback.node});\r\n    });\r\n  }\r\n}\r\n\r\nfunction conflictInfo() { // jQuery.min\r\n  var statCtrl = leftHandSideColumnTable.rows[6].cells[0]\r\n    .firstChild.nextSibling;\r\n  if (statCtrl) {\r\n    retryAjax('index.php?no_mobile=1&cmd=guild&subcmd=conflicts')\r\n      .done(function(data) {\r\n        gotConflictInfo(data,\r\n          {node: statCtrl});\r\n      });\r\n  }\r\n}\r\n\r\nfunction logoToggle() {\r\n  var changeLogoCell = leftHandSideColumnTable.rows[0].cells[1].firstChild;\r\n  insertHtmlBeforeEnd(changeLogoCell, '[ <span class=\"fshLink' +\r\n    ' tip-static\" id=\"toggleGuildLogoControl\" ' +\r\n    'linkto=\"guildLogoControl\" data-tipped=\"Toggle Section\">X</span> ]');\r\n  var guildLogoElement = leftHandSideColumnTable.rows[2].cells[0]\r\n    .firstChild.nextSibling;\r\n  guildLogoElement.id = 'guildLogoControl';\r\n  if (getValue('guildLogoControl')) {\r\n    guildLogoElement.classList.add('fshHide');\r\n  }\r\n  getElementById('toggleGuildLogoControl')\r\n    .addEventListener('click', toggleVisibilty);\r\n}\r\n\r\nfunction statToggle() {\r\n  var leaveGuildCell = leftHandSideColumnTable.rows[4].cells[1].firstChild;\r\n  insertHtmlBeforeEnd(leaveGuildCell, '<span class=\"fshNoWrap\">' +\r\n    '[ <span class=\"fshLink tip-static\" id=\"toggleStatisticsControl\" ' +\r\n    'linkto=\"statisticsControl\" data-tipped=\"Toggle Section\">X</span> ]' +\r\n    '</span>');\r\n  var statisticsControlElement = leftHandSideColumnTable.rows[6].cells[0]\r\n    .firstChild.nextSibling;\r\n  statisticsControlElement.id = 'statisticsControl';\r\n  if (getValue('statisticsControl')) {\r\n    statisticsControlElement.classList.add('fshHide');\r\n  }\r\n  getElementById('toggleStatisticsControl')\r\n    .addEventListener('click', toggleVisibilty);\r\n}\r\n\r\nfunction structureToggle() {\r\n  var buildCell = leftHandSideColumnTable.rows[15].cells[1].firstChild;\r\n  insertHtmlBeforeEnd(buildCell, '[ <span class=\"fshLink ' +\r\n    'tip-static\" id=\"toggleGuildStructureControl\" ' +\r\n    'linkto=\"guildStructureControl\" data-tipped=\"Toggle Section\">X</span> ]');\r\n  var guildStructureControlElement = leftHandSideColumnTable.rows[17]\r\n    .cells[0].firstChild.nextSibling;\r\n  guildStructureControlElement.id = 'guildStructureControl';\r\n  if (getValue('guildStructureControl')) {\r\n    guildStructureControlElement.classList.add('fshHide');\r\n  }\r\n  getElementById('toggleGuildStructureControl')\r\n    .addEventListener('click', toggleVisibilty);\r\n}\r\n\r\nfunction batchBuffLinks() {\r\n  var limit = performance.now() + 5;\r\n  while (moreToDo(limit, memCount, members)) {\r\n    insertHtmlBeforeEnd(members[memCount].parentNode,\r\n      ' <span class=\"smallLink\">[b]</span>');\r\n    memCount += 1;\r\n  }\r\n  if (memCount < members.length) {\r\n    add(3, batchBuffLinks);\r\n  }\r\n}\r\n\r\nfunction buffLinks() {\r\n  // TODO preference\r\n  memCount = 0;\r\n  members = document.querySelectorAll(\r\n    '#pCC a[href^=\"index.php?cmd=profile&player_id=\"]');\r\n  add(3, batchBuffLinks);\r\n  pCC.addEventListener('click', function(evt) {\r\n    if (evt.target.className !== 'smallLink') {return;}\r\n    openQuickBuffByName(evt.target.previousElementSibling.text);\r\n  });\r\n}\r\n\r\nfunction selfRecallLink() {\r\n  // self recall\r\n  var getLi = leftHandSideColumnTable.getElementsByTagName('LI');\r\n  var selfRecall = getLi[getLi.length - 1].parentNode;\r\n  insertHtmlBeforeEnd(selfRecall,\r\n    '<li><a href=\"index.php?cmd=guild&subcmd=inventory&subcmd2=report&' +\r\n    'user=' + playerName() +\r\n    '\" class=\"tip-static\" data-tipped=\"Self Recall\">Self Recall</a></li>');\r\n}\r\n\r\nexport default function injectGuild() {\r\n  add(3, colouredDots);\r\n  add(3, removeGuildAvyImgBorder);\r\n  add(3, guildXPLock);\r\n  leftHandSideColumnTable = pCC\r\n    .lastElementChild.rows[2].cells[0].firstElementChild;\r\n  add(3, logoToggle);\r\n  add(3, statToggle);\r\n  add(3, structureToggle);\r\n  add(3, buffLinks);\r\n  add(3, selfRecallLink);\r\n  if (jQueryNotPresent()) {return;}\r\n  // Detailed conflict information\r\n  if (getValue('detailedConflictInfo')) {\r\n    add(3, conflictInfo);\r\n  }\r\n  add(4, guildTracker);\r\n}\r\n","import add from './support/task';\r\nimport createDocument from './system/createDocument';\r\nimport {createInput} from './common/cElement';\r\nimport {getElementById} from './common/getElement';\r\nimport getMembrList from './ajax/getMembrList';\r\nimport getValue from './system/getValue';\r\nimport insertElement from './common/insertElement';\r\nimport insertHtmlAfterBegin from './common/insertHtmlAfterBegin';\r\nimport insertHtmlBeforeEnd from './common/insertHtmlBeforeEnd';\r\nimport jQueryNotPresent from './common/jQueryNotPresent';\r\nimport moreToDo from './common/moreToDo';\r\nimport {pCC} from './support/layout';\r\nimport playerName from './common/playerName';\r\nimport retryAjax from './ajax/retryAjax';\r\n\r\nvar ranks;\r\nvar myRank;\r\nvar theRows;\r\nvar rankCount;\r\nvar characterRow;\r\n\r\nvar privLookup = {\r\n  'Bank Withdraw': 5,\r\n  'Build/Upgrade/Demolish Structures': 5,\r\n  'Can Un-Tag Items': 5,\r\n  'Build/Upgrade Structures': 4,\r\n  'Can Kick Members': 4,\r\n  'Can Mass Messages': 0.5,\r\n  'Take Items': 0.2,\r\n  'Can Recall Tagged Items': 0.2,\r\n  'Store Items': 0.1,\r\n  'Can View Advisor': 0.1\r\n};\r\n\r\nfunction parseRankData(linkElement, responseText) {\r\n  // Makes a weighted calculation of available permissions and gets tax rate\r\n  var doc = createDocument(responseText);\r\n  var checkBoxes = doc.querySelectorAll(\r\n    '#pCC input[type=\"checkbox\"]:checked');\r\n  var count = 0;\r\n  Array.prototype.forEach.call(checkBoxes, function(checkbox) {\r\n    var privName = checkbox.nextElementSibling.textContent.trim();\r\n    if (privName in privLookup) {\r\n      count += privLookup[privName];\r\n    } else {count += 1;}\r\n  });\r\n  var taxRate = doc.querySelector('#pCC input[name=\"rank_tax\"]').value;\r\n  insertHtmlAfterBegin(linkElement, '<span class=\"fshBlue\">(' +\r\n    Math.round(10 * count) / 10 + ') Tax:(' + taxRate + '%)</span> ');\r\n}\r\n\r\nfunction fetchRankData() { // jQuery.min\r\n  var calcButton = getElementById('getrankweightings');\r\n  calcButton.classList.add('fshHide');\r\n  var allItems = document.querySelectorAll('#pCC input[value=\"Edit\"]');\r\n  Array.prototype.forEach.call(allItems, function(anItem) {\r\n    var targetNode = anItem.parentNode.parentNode.previousElementSibling;\r\n    var href = /window\\.location='(.*)';/.exec(anItem\r\n      .getAttribute('onclick'))[1];\r\n    retryAjax(href).done(parseRankData.bind(null, targetNode));\r\n  });\r\n}\r\n\r\nfunction notValidRow(thisRankRowNum, targetRowNum, parentTable) {\r\n  return characterRow >= Math.min(thisRankRowNum, targetRowNum) ||\r\n    targetRowNum < 1 ||\r\n    targetRowNum > parentTable.rows.length;\r\n}\r\n\r\nfunction getTargetRowNumber(val) {\r\n  if (val === 'Up') {return -1;}\r\n  return 2;\r\n}\r\n\r\nfunction getPxScroll(val) {\r\n  if (val === 'Up') {return -22;}\r\n  return 22;\r\n}\r\n\r\nfunction overrideUpDown(evt, val) {\r\n  var onclickHREF = /window.location='(.*)';/\r\n    .exec(evt.target.getAttribute('onclick'))[1];\r\n  var thisRankRow = evt.target.parentNode.parentNode.parentNode;\r\n  var thisRankRowNum = thisRankRow.rowIndex;\r\n  var targetRowNum = thisRankRowNum + getTargetRowNumber(val);\r\n  var parentTable = thisRankRow.parentNode;\r\n  if (notValidRow(thisRankRowNum, targetRowNum, parentTable)) {return;}\r\n  retryAjax(onclickHREF);\r\n  var injectRow = parentTable.rows[targetRowNum];\r\n  parentTable.insertBefore(thisRankRow, injectRow);\r\n  var pxScroll = getPxScroll(val);\r\n  window.scrollBy(0, pxScroll);\r\n  evt.stopPropagation();\r\n}\r\n\r\nfunction ajaxifyRankControls(evt) {\r\n  var val = evt.target.getAttribute('value');\r\n  if (val === 'Up' || val === 'Down') {overrideUpDown(evt, val);}\r\n}\r\n\r\nfunction doButtons() {\r\n  // gather rank info button\r\n  var addNewRank = document.querySelector('#pCC a[href*=\"=ranks&subcmd2=add\"]');\r\n  if (addNewRank) {\r\n    var weightButton = createInput({\r\n      id: 'getrankweightings',\r\n      className: 'custombutton',\r\n      type: 'button',\r\n      value: 'Get Rank Weightings'\r\n    });\r\n    weightButton.addEventListener('click', fetchRankData);\r\n    var theTd = addNewRank.parentNode.parentNode;\r\n    insertHtmlBeforeEnd(theTd, '&nbsp;');\r\n    insertElement(theTd, weightButton);\r\n  }\r\n  if (getValue('ajaxifyRankControls')) {\r\n    pCC.addEventListener('click',\r\n      ajaxifyRankControls, true);\r\n  }\r\n}\r\n\r\nfunction isMyRank(rankName) {\r\n  if (rankName === myRank) {\r\n    characterRow = rankCount; // limit for ajaxify later\r\n  }\r\n}\r\n\r\nfunction hasMembers(rankCell, rankName) {\r\n  if (ranks[rankName]) { // has members\r\n    isMyRank(rankName);\r\n    insertHtmlBeforeEnd(rankCell, ' <span class=\"fshBlue\">- ' +\r\n      ranks[rankName].join(', ') + '</span>');\r\n  }\r\n}\r\n\r\nfunction getRankName(rankCell) {\r\n  if (rankCount === 1) {return 'Guild Founder';}\r\n  return rankCell.textContent;\r\n}\r\n\r\nfunction writeMembers(el) {\r\n  var rankCell = el.firstElementChild;\r\n  var rankName = getRankName(rankCell);\r\n  hasMembers(rankCell, rankName);\r\n}\r\n\r\nfunction paintRanks() {\r\n  var limit = performance.now() + 10;\r\n  while (moreToDo(limit, rankCount, theRows)) {\r\n    var el = theRows[rankCount];\r\n\r\n    writeMembers(el);\r\n\r\n    rankCount += 1;\r\n  }\r\n  if (rankCount < theRows.length) {\r\n    add(3, paintRanks);\r\n  }\r\n}\r\n\r\nfunction findTheRows() {\r\n  var outerTable = pCC.lastElementChild.previousElementSibling;\r\n  if (outerTable.rows && outerTable.rows.length > 7) {\r\n    return outerTable.rows[7].firstElementChild.firstElementChild.rows;\r\n  }\r\n}\r\n\r\nfunction getRanks(membrList) {\r\n  ranks = Object.keys(membrList).reduce(function(prev, curr) {\r\n    if (curr !== 'lastUpdate') {\r\n      var rankName = membrList[curr].rank_name;\r\n      prev[rankName] = prev[rankName] || [];\r\n      prev[rankName].push(curr);\r\n    }\r\n    return prev;\r\n  }, {});\r\n  myRank = membrList[playerName()].rank_name;\r\n  theRows = findTheRows();\r\n  if (theRows) {\r\n    rankCount = 1;\r\n    add(3, paintRanks);\r\n  }\r\n}\r\n\r\nexport default function injectGuildRanks() { // jQuery.min\r\n  if (jQueryNotPresent()) {return;}\r\n  getMembrList(true).done(function(membrList) {\r\n    add(3, getRanks, [membrList]);\r\n  });\r\n  add(3, doButtons);\r\n}\r\n","import insertHtmlBeforeEnd from './insertHtmlBeforeEnd';\r\n\r\nexport default function insertTextBeforeEnd(parent, text) {\r\n  insertHtmlBeforeEnd(parent, text);\r\n}\r\n","export default function renderBio(_bioContents) {\r\n  var bioContents = _bioContents.replace(/\\{b\\}/g, '`~')\r\n    .replace(/\\{\\/b\\}/g, '~`');\r\n  var buffs = bioContents.match(/`~([^~]|~(?!`))*~`/g);\r\n  if (!buffs) {return _bioContents;}\r\n  buffs.forEach(function(buff, i) {\r\n    var fullName = buff.replace(/(`~)|(~`)|(\\{b\\})|(\\{\\/b\\})/g, '');\r\n    var cbString = '<span id=\"fshBuff' + i + '\" class=\"buffLink fshBlue\">' +\r\n      fullName + '</span>';\r\n    bioContents = bioContents.replace(buff, cbString);\r\n  });\r\n  if (bioContents.indexOf('[cmd]') < 0) {bioContents += '[cmd]';}\r\n  bioContents = bioContents.replace('[cmd]',\r\n    '<br><input id=\"fshSendBuffMsg\" ' +\r\n    'class=\"custombutton\" type=\"button\" value=\"Ask For Buffs\">' +\r\n    '<span id=\"buffCost\" class=\"fshRed\"></span>');\r\n  return bioContents;\r\n}\r\n","import createDocument from '../system/createDocument';\r\nimport retryAjax from './retryAjax';\r\nimport {defenderMultiplier, mercRE} from '../support/constants';\r\n\r\nfunction addMercStat(mouseover, stat, i) {\r\n  return stat +\r\n    Math.round(Number(mercRE[i].exec(mouseover)[1]) * defenderMultiplier);\r\n}\r\n\r\nfunction addMercStats(prev, merc) {\r\n  return prev.map(addMercStat.bind(null, merc.dataset.tipped));\r\n}\r\n\r\nfunction addAllMercStats(mercElements) {\r\n  return Array.prototype.reduce.call(mercElements, addMercStats,\r\n    [0, 0, 0, 0, 0]);\r\n}\r\n\r\nfunction transform(mercTotal) {\r\n  return {\r\n    attack: mercTotal[0],\r\n    defense: mercTotal[1],\r\n    armor: mercTotal[2],\r\n    damage: mercTotal[3],\r\n    hp: mercTotal[4]\r\n  };\r\n}\r\n\r\nfunction parseMercStats(html) {\r\n  var doc = createDocument(html);\r\n  var mercElements = doc.querySelectorAll('#pCC img[src*=\"/merc/\"]');\r\n  var mercTotal = addAllMercStats(mercElements);\r\n  return transform(mercTotal);\r\n}\r\n\r\nexport default function getMercStats() {\r\n  return retryAjax(\r\n    'index.php?no_mobile=1&cmd=guild&subcmd=mercs').pipe(parseMercStats);\r\n}\r\n","import {getElementById} from '../common/getElement';\r\nimport intValue from '../system/intValue';\r\n\r\nfunction statAsNumber(el) {\r\n  if (el) {\r\n    return intValue(el.textContent);\r\n  }\r\n  return 0;\r\n}\r\n\r\nexport default function groupViewStats(doc) {\r\n  var attackElement = getElementById('stat-attack', doc);\r\n  var defenseElement = getElementById('stat-defense', doc);\r\n  var armorElement = getElementById('stat-armor', doc);\r\n  var damageElement = getElementById('stat-damage', doc);\r\n  var hpElement = getElementById('stat-hp', doc);\r\n  return {\r\n    attack: statAsNumber(attackElement),\r\n    attackElement: attackElement,\r\n    defense: statAsNumber(defenseElement),\r\n    defenseElement: defenseElement,\r\n    armor: statAsNumber(armorElement),\r\n    armorElement: armorElement,\r\n    damage: statAsNumber(damageElement),\r\n    damageElement: damageElement,\r\n    hp: statAsNumber(hpElement),\r\n    hpElement: hpElement\r\n  };\r\n}\r\n","import fallback from '../system/fallback';\r\nimport insertElement from './insertElement';\r\nimport openQuickBuffByName from './openQuickBuffByName';\r\nimport {places} from '../support/constants';\r\nimport {createButton, createLi, createUl} from './cElement';\r\n\r\nexport default function doBuffLinks(members) {\r\n  // quick buff only supports 16\r\n  var shortList = members.reduce(function(prev, curr, i) {\r\n    var slot = Math.floor(i / 16);\r\n    prev[slot] = fallback(prev[slot], []);\r\n    prev[slot].push(curr);\r\n    return prev;\r\n  }, []).reduce(function(prev, curr, i) {\r\n    var theNames = curr.join(',');\r\n    var modifierWord = places[i];\r\n    var li = createLi();\r\n    var btn = createButton({\r\n      className: 'fshBl fshBls tip-static',\r\n      dataset: {tipped: 'Quick buff functionality from HCS only does 16'},\r\n      textContent: 'Buff ' + modifierWord + ' 16'\r\n    });\r\n    btn.addEventListener('click',\r\n      openQuickBuffByName.bind(null, theNames));\r\n    insertElement(li, btn);\r\n    insertElement(prev, li);\r\n    return prev;\r\n  }, createUl());\r\n  return shortList;\r\n}\r\n","import createDocument from '../system/createDocument';\r\nimport groupViewStats from './groupViewStats';\r\nimport retryAjax from './retryAjax';\r\n\r\nfunction parseGroupStats(html) {\r\n  var doc = createDocument(html);\r\n  return groupViewStats(doc);\r\n}\r\n\r\nexport default function getGroupStats(viewStats) {\r\n  return retryAjax(viewStats).pipe(parseGroupStats);\r\n}\r\n","export default function alpha(a, b) {\r\n  if (a.toLowerCase() < b.toLowerCase()) {return -1;}\r\n  if (a.toLowerCase() > b.toLowerCase()) {return 1;}\r\n  return 0;\r\n}\r\n","import padZ from '../system/padZ';\r\n\r\nexport default function formatLocalDateTime(aDate) {\r\n  if (Object.prototype.toString.call(aDate) === '[object Date]' &&\r\n      !isNaN(aDate.getTime())) {\r\n    var yyyy = aDate.getFullYear().toString();\r\n    var mon = padZ(aDate.getMonth() + 1);\r\n    var dd = padZ(aDate.getDate());\r\n    var hh = padZ(aDate.getHours());\r\n    var mm = padZ(aDate.getMinutes());\r\n    var ss = padZ(aDate.getSeconds());\r\n    return yyyy + '-' + mon + '-' + dd + ' ' + hh + ':' + mm + ':' + ss;\r\n  }\r\n}\r\n","import {getElementById} from './getElement';\r\nimport setValue from '../system/setValue';\r\n\r\nexport default function toggleVisibilty(evt) {\r\n  var anItemId = evt.target.getAttribute('linkto');\r\n  var anItem = getElementById(anItemId);\r\n  var currentVisibility = anItem.classList.contains('fshHide');\r\n  anItem.classList.toggle('fshHide');\r\n  if (currentVisibility) {\r\n    setValue(anItemId, '');\r\n  } else {\r\n    setValue(anItemId, 'ON');\r\n  }\r\n}\r\n","export default function getIntFromRegExp(theText, rxSearch) {\r\n  var result;\r\n  var matches = theText.replace(/,/g, '').match(rxSearch);\r\n  if (matches) {\r\n    result = parseInt(matches[1], 10);\r\n  } else {\r\n    result = 0;\r\n  }\r\n  return result;\r\n}\r\n","import addCommas from '../system/addCommas';\r\nimport getIntFromRegExp from '../system/getIntFromRegExp';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\n\r\nexport function removeGuildAvyImgBorder() {\r\n  document.querySelector('#pCC img[oldtitle$=\"\\'s Logo\"]')\r\n    .removeAttribute('style');\r\n}\r\n\r\nexport function guildXPLock() {\r\n  var xpLock = document\r\n    .querySelector('#pCC a[data-tipped^=\"<b>Guild XP</b>\"]');\r\n  if (!xpLock) {return;}\r\n  var xpLockmouseover = xpLock.dataset.tipped;\r\n  var xpLockXP = getIntFromRegExp(xpLockmouseover,\r\n    /XP Lock: <b>(\\d*)/);\r\n  var actualXP = getIntFromRegExp(xpLockmouseover,\r\n    /XP: <b>(\\d*)/);\r\n  if (actualXP < xpLockXP) {\r\n    insertHtmlBeforeEnd(xpLock.parentNode.nextElementSibling,\r\n      ' (<b>' + addCommas(xpLockXP - actualXP) + '</b>)');\r\n  }\r\n}\r\n","import {createInput} from '../common/cElement';\r\nimport {imageServer} from '../system/system';\r\nimport insertElement from '../common/insertElement';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\nimport {pCC} from '../support/layout';\r\nimport takeitem from '../app/guild/inventory/takeitem';\r\n\r\nfunction doItemTable(rows) {\r\n  for (var i = 1; i < rows.length - 1; i += 2) {\r\n    insertHtmlBeforeEnd(rows[i].cells[2],\r\n      '&nbsp;<span class=\"sendLink\">Fast BP</span>');\r\n  }\r\n}\r\n\r\nfunction doCheckAll() {\r\n  var boxes = document.querySelectorAll('#pCC input[name=\"tagIndex[]\"]');\r\n  Array.prototype.forEach.call(boxes, function(el) {\r\n    el.click();\r\n  });\r\n}\r\n\r\nfunction takeResult(self, data) {\r\n  if (data.r === 0) {\r\n    self.removeAttribute('style');\r\n    self.className = 'fshGreen';\r\n    self.textContent = 'Taken';\r\n  }\r\n}\r\n\r\nfunction fastBp(el) {\r\n  var itmId = el.parentNode.previousElementSibling.previousElementSibling\r\n    .firstElementChild.value;\r\n  takeitem(itmId).done(takeResult.bind(null, el));\r\n  el.textContent = '';\r\n  el.className = 'guildTagSpinner';\r\n  el.style.backgroundImage = 'url(\\'' + imageServer +\r\n    '/skin/loading.gif\\')';\r\n}\r\n\r\nfunction evtHdlr(e) {\r\n  var self = e.target;\r\n  if (self.value === 'Check All') {doCheckAll();}\r\n  if (self.className === 'sendLink') {fastBp(self);}\r\n}\r\n\r\nfunction paintTable() {\r\n  var nodeList = pCC.getElementsByTagName('table');\r\n  if (nodeList.length > 0) {\r\n    doItemTable(nodeList[nodeList.length - 1].rows);\r\n  }\r\n}\r\n\r\nfunction checkAllBtn() {\r\n  var checkAll = createInput({type: 'button', value: 'Check All'});\r\n  var formTags = pCC.getElementsByTagName('form');\r\n  if (formTags.length === 1) {\r\n    insertElement(formTags[0].previousElementSibling.cells[0], checkAll);\r\n  }\r\n}\r\n\r\nexport default function injectGuildAddTagsWidgets() {\r\n  pCC.addEventListener('click', evtHdlr);\r\n  paintTable();\r\n  checkAllBtn();\r\n}\r\n","import callApp from '../../callApp';\r\nimport errorDialog from '../../errorDialog';\r\n\r\nexport default function takeitem(invId) {\r\n  return callApp({\r\n    cmd: 'guild',\r\n    subcmd: 'inventory',\r\n    subcmd2: 'takeitem',\r\n    guildstore_id: invId, // + 10000000,\r\n  }).pipe(errorDialog);\r\n}\r\n","export var defaultOptions = {\r\n  checkedElements: {\r\n    '0': 1,\r\n    '1': 1,\r\n    '2': 1,\r\n    '3': 1,\r\n    '4': 1,\r\n    '5': 1,\r\n    '6': 1,\r\n    '7': 1,\r\n    '8': 1,\r\n    '100': 1,\r\n    '101': 1,\r\n    '102': 1,\r\n    '103': 1,\r\n    '104': 1,\r\n    '105': 1,\r\n    '106': 1\r\n  },\r\n  fshMinLvl: 1,\r\n  fshMaxLvl: 9999\r\n};\r\nexport var invManFilter =\r\n  '<table class=\"fshInvFilter\">' +\r\n  '<tr><th colspan=\"14\">@@reportTitle@@</th>' +\r\n  '<th><span id=\"fshRefresh\" class=\"fshLink\">[Refresh]</span></th></tr>' +\r\n  '<tr><td colspan=\"2\" rowspan=\"3\"><b>&nbsp;Show Items:</b></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Helmet:</td>' +\r\n  '<td><input id=\"fshHelmet\" type=\"checkbox\" item=\"0\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Armor:</td>' +\r\n  '<td><input id=\"fshArmor\" type=\"checkbox\" item=\"1\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Gloves:</td>' +\r\n  '<td><input id=\"fshGloves\" type=\"checkbox\" item=\"2\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Boots:</td>' +\r\n  '<td><input id=\"fshBoots\" type=\"checkbox\" item=\"3\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Weapon:</td>' +\r\n  '<td><input id=\"fshWeapon\" type=\"checkbox\" item=\"4\"/></td>' +\r\n  '<td></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Min lvl:</td>' +\r\n  '<td><input id=\"fshMinLvl\" size=\"5\" value=\"1\"/></td>' +\r\n  '</tr><tr>' +\r\n  '<td class=\"fshRight\">&nbsp;Shield:</td>' +\r\n  '<td><input id=\"fshShield\" type=\"checkbox\" item=\"5\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Ring:</td>' +\r\n  '<td><input id=\"fshRing\" type=\"checkbox\" item=\"6\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Amulet:</td>' +\r\n  '<td><input id=\"fshAmulet\" type=\"checkbox\" item=\"7\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Rune:</td>' +\r\n  '<td><input id=\"fshRune\" type=\"checkbox\" item=\"8\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Sets Only:</td>' +\r\n  '<td><input id=\"fshSets\" item=\"-1\" type=\"checkbox\"/></td>' +\r\n  '<td></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Max lvl:</td>' +\r\n  '<td><input id=\"fshMaxLvl\" size=\"5\" value=\"9999\"/></td>' +\r\n  '</tr><tr>' +\r\n  '<td colspan=\"2\">' +\r\n  '&nbsp;[<span id=\"fshAll\" class=\"fshLink\">Select All</span>]</td>' +\r\n  '<td colspan=\"2\">' +\r\n  '&nbsp;[<span id=\"fshNone\" class=\"fshLink\">Select None</span>]</td>' +\r\n  '<td colspan=\"2\">' +\r\n  '&nbsp;[<span id=\"fshDefault\" class=\"fshLink\">Defaults</span>]</td>' +\r\n  '<td colspan=\"6\"></td>' +\r\n  '<td><input id=\"fshReset\" type=\"button\" value=\"Reset\"/></td>' +\r\n  '</tr>' +\r\n  '<tr>' +\r\n  '<td class=\"fshRight\">&nbsp;Quest Item:</td>' +\r\n  '<td><input id=\"fshQuest\" item=\"9\" type=\"checkbox\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Potion:</td>' +\r\n  '<td><input id=\"fshPotion\" item=\"10\" type=\"checkbox\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Resource:</td>' +\r\n  '<td><input id=\"fshResource\" item=\"12\" type=\"checkbox\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Recipe:</td>' +\r\n  '<td><input id=\"fshRecipe\" item=\"13\" type=\"checkbox\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Container:</td>' +\r\n  '<td><input id=\"fshContainer\" item=\"14\" type=\"checkbox\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Frag Stash:</td>' +\r\n  '<td><input id=\"fshStash\" item=\"16\" type=\"checkbox\"/></td>' +\r\n  // ' Composed: <input id=\"fshComposed\" item=\"15\" type=\"checkbox\"/>' +\r\n  '<td colspan=\"3\"></td></tr>' +\r\n  '<tr>' +\r\n  '<td class=\"fshRight\">&nbsp;Common:</td>' +\r\n  '<td><input id=\"fshCommon\" item=\"100\" type=\"checkbox\" checked/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Rare:</td>' +\r\n  '<td><input id=\"fshRare\" item=\"101\" type=\"checkbox\" checked/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Unique:</td>' +\r\n  '<td><input id=\"fshUnique\" item=\"102\" type=\"checkbox\" checked/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Legendary:</td>' +\r\n  '<td><input id=\"fshLegendary\" item=\"103\" type=\"checkbox\" checked/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Super Elite:</td>' +\r\n  '<td><input id=\"fshSuperElite\" item=\"104\" type=\"checkbox\" checked/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Crystalline:</td>' +\r\n  '<td><input id=\"fshCrystalline\" item=\"105\" type=\"checkbox\" checked/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Epic:</td>' +\r\n  '<td colspan=\"2\"><input id=\"fshEpic\" item=\"106\" type=\"checkbox\" checked/>' +\r\n  '</td>' +\r\n  '</tr>' +\r\n  '</table>';\r\nexport var inventoryCheckAll = {\r\n  '0': 1,\r\n  '1': 1,\r\n  '2': 1,\r\n  '3': 1,\r\n  '4': 1,\r\n  '5': 1,\r\n  '6': 1,\r\n  '7': 1,\r\n  '8': 1,\r\n  '9': 1,\r\n  '10': 1,\r\n  '11': 1,\r\n  '12': 1,\r\n  '13': 1,\r\n  '14': 1,\r\n  '15': 1,\r\n  '16': 1,\r\n  '100': 1,\r\n  '101': 1,\r\n  '102': 1,\r\n  '103': 1,\r\n  '104': 1,\r\n  '105': 1,\r\n  '106': 1\r\n};\r\nexport var itemType = ['Helmet', 'Armor', 'Gloves', 'Boots', 'Weapon', 'Shield',\r\n  'Ring', 'Amulet', 'Rune', 'Quest Item', 'Potion', 'Component',\r\n  'Resource', 'Recipe', 'Container', 'Composed', 'Frag Stash'];\r\nexport var craftHash = {\r\n  Perfect: {abbr: 'Perf', colour: '#00b600', index: 8},\r\n  Excellent: {abbr: 'Exc', colour: '#f6ed00', index: 7},\r\n  'Very Good': {abbr: 'VG', colour: '#f67a00', index: 6},\r\n  Good: {abbr: 'Good', colour: '#f65d00', index: 5},\r\n  Average: {abbr: 'Ave', colour: '#f64500', index: 4},\r\n  Poor: {abbr: 'Poor', colour: '#f61d00', index: 3},\r\n  'Very Poor': {abbr: 'VPr', colour: '#b21500', index: 2},\r\n  Uncrafted: {abbr: 'Unc', colour: '#666666', index: 1}\r\n};\r\n","import {defaultOptions} from './assets';\r\nimport extend from '../common/extend';\r\nimport fallback from '../system/fallback';\r\nimport getValue from '../system/getValue';\r\n\r\nexport var options;\r\nexport var showQuickDropLinks;\r\nexport var showQuickSendLinks;\r\nexport var theInv;\r\n\r\nexport function storeTheInv(data) {\r\n  theInv = data;\r\n}\r\n\r\nexport function extendOptions(data) {\r\n  options = extend({}, defaultOptions);\r\n  extend(options, fallback(data, {}));\r\n  showQuickDropLinks = getValue('showQuickDropLinks');\r\n  showQuickSendLinks = getValue('showQuickSendLinks');\r\n}\r\n","import {craftHash} from '../assets';\r\n\r\nexport default function craftRender(craft) {\r\n  if (craftHash[craft]) {return craftHash[craft].abbr;}\r\n  return '';\r\n}\r\n","function selfRowColor(data) {\r\n  if (data.equipped) {return 'fshGreen';}\r\n  return 'fshNavy';\r\n}\r\n\r\nfunction guildRowColor(data) {\r\n  if (data.player_id === -1) {return 'fshNavy';}\r\n  return 'fshMaroon';\r\n}\r\n\r\nfunction getRowColor(data) {\r\n  if (data.folder_id) {return selfRowColor(data);}\r\n  return guildRowColor(data);\r\n}\r\n\r\nexport default function createdRow(row, data) {\r\n  var colour = getRowColor(data);\r\n  row.classList.add(colour);\r\n}\r\n","import fallback from '../../system/fallback';\r\nimport {theInv} from '../options';\r\n\r\nfunction gsRecall(row) {\r\n  return '<span class=\"fshLink recallItem\" invid=\"' +\r\n    row.inv_id + '\" playerid=\"' +\r\n    fallback(row.player_id, theInv.player_id) +\r\n    '\" mode=\"1\" action=\"recall\">GS</span>';\r\n}\r\n\r\nfunction gsStore(row) {\r\n  return '<span class=\"fshLink storeItem\" invid=\"' +\r\n    row.inv_id + '\">GS</span>';\r\n}\r\n\r\nfunction gsDisplayType(type, row, fn) {\r\n  if (type === 'display') {\r\n    return fn(row);\r\n  }\r\n  return 'GS';\r\n}\r\n\r\nfunction onGuildMember(row) {\r\n  return row.player_id && row.player_id !== -1;\r\n}\r\n\r\nfunction isTagged(row) {\r\n  return row.folder_id && row.guild_tag !== -1;\r\n}\r\n\r\nfunction canRecall(row) {\r\n  return onGuildMember(row) || isTagged(row);\r\n}\r\n\r\nfunction canStore(row) {\r\n  return row.folder_id && !row.bound; // && !row.equipped;\r\n}\r\n\r\nexport default function gsRender(_data, type, row) {\r\n  if (canRecall(row)) {return gsDisplayType(type, row, gsRecall);}\r\n  if (canStore(row)) {return gsDisplayType(type, row, gsStore);}\r\n}\r\n","import {theInv} from '../options';\r\n\r\nfunction userInvNotEquipped(row) {\r\n  return row.folder_id && !row.equipped;\r\n}\r\n\r\nfunction guidInvNotEquipped(row) {\r\n  return row.player_id && !row.equipped &&\r\n    row.player_id === theInv.current_player_id;\r\n}\r\n\r\nvar locations = [\r\n  {\r\n    test: function(row) {return row.player_id && row.player_id === -1;},\r\n    res: function(row, act) {\r\n      return 'takeItem\" action=\"' + act.a;\r\n    }\r\n  },\r\n  {\r\n    test: function(row) {\r\n      return row.player_id &&\r\n        row.player_id !== theInv.current_player_id;\r\n    },\r\n    res: function(row, act) {\r\n      return 'recallItem\" playerid=\"' + row.player_id +\r\n        '\" mode=\"0\" action=\"' + act.a;\r\n    }\r\n  },\r\n  {\r\n    test: function(row) {\r\n      return userInvNotEquipped(row) || guidInvNotEquipped(row);\r\n    },\r\n    res: function(row, act) {return act.c;}\r\n  }\r\n];\r\n\r\nfunction wuRender(row, act) {\r\n  for (var i = 0; i < locations.length; i += 1) {\r\n    if (locations[i].test(row)) {\r\n      return '<span class=\"fshLink ' + locations[i].res(row, act) +\r\n        '\" invid=\"' + row.inv_id + '\">' + act.b + '</span>';\r\n    }\r\n  }\r\n  return '';\r\n}\r\n\r\nexport default function wearUseRender(data, _type, row) {\r\n  //            0  1  2  3  4  5  6  7  8 9 10 11121314 15\r\n  // eslint-disable-next-line no-sparse-arrays\r\n  var action = [1, 1, 1, 1, 1, 1, 1, 1, 1, , 2, 2, , , , 2][data];\r\n  if (action === 1) {\r\n    return wuRender(row, {\r\n      a: 'wear',\r\n      b: 'Wear',\r\n      c: 'wearItem'\r\n    });\r\n  } else if (action === 2) {\r\n    return wuRender(row, {\r\n      a: 'use',\r\n      b: 'Use',\r\n      c: 'useItem'\r\n    });\r\n  }\r\n}\r\n","import fallback from '../../system/fallback';\r\n\r\nexport default function whereData(row) {\r\n  return fallback(row.folder_id, row.player_id);\r\n}\r\n","import calf from '../../support/calf';\r\n\r\nexport default function playerName(f) {\r\n  if (!calf.membrList[f]) {return '???';}\r\n  return calf.membrList[f].username;\r\n}\r\n","export default function isSelected(val, test) {\r\n  if (val === test) {return ' selected';}\r\n  return '';\r\n}\r\n","import bpRender from './render/bpRender';\r\nimport craftRender from './render/craftRender';\r\nimport createdRow from './render/createdRow';\r\nimport dropRender from './render/dropRender';\r\nimport durabilityRender from './render/durabilityRender';\r\nimport gsRender from './render/gsRender';\r\nimport nameRender from './render/nameRender';\r\nimport sendRender from './render/sendRender';\r\nimport wearUseRender from './render/wearUseRender';\r\nimport whereData from './render/whereData';\r\nimport whereRender from './render/whereRender';\r\nimport whereRenderDisplay from './render/whereRenderDisplay';\r\nimport whereRenderFilter from './render/whereRenderFilter';\r\nimport {craftHash, itemType} from './assets';\r\nimport {showQuickDropLinks, showQuickSendLinks, theInv} from './options';\r\n\r\nvar tblCols = [\r\n  {title: 'Name', data: 'item_name', render: nameRender},\r\n  {title: 'Level', data: 'stats.min_level'},\r\n  {\r\n    title: 'Where',\r\n    data: whereData,\r\n    render: {\r\n      _: whereRender,\r\n      display: whereRenderDisplay,\r\n      filter: whereRenderFilter\r\n    }\r\n  },\r\n  {\r\n    title: 'Type',\r\n    data: 'type',\r\n    render: function(type) {return itemType[type];}\r\n  },\r\n  {title: 'Att', data: 'stats.attack'},\r\n  {title: 'Def', data: 'stats.defense'},\r\n  {title: 'Arm', data: 'stats.armor'},\r\n  {title: 'Dam', data: 'stats.damage'},\r\n  {title: 'HP', data: 'stats.hp'},\r\n  {title: 'Frg', data: 'forge'},\r\n  {\r\n    title: 'Craft',\r\n    data: 'craft',\r\n    render: {\r\n      _: function(craft) {\r\n        if (craftHash[craft]) {\r\n          return craftHash[craft].index;\r\n        }\r\n        return 0;\r\n      },\r\n      display: craftRender,\r\n      filter: craftRender\r\n    }\r\n  },\r\n  {title: 'Du%', data: 'durability', render: durabilityRender},\r\n  {title: 'BP', data: whereData, render: bpRender},\r\n  {title: 'GS', data: whereData, render: gsRender},\r\n  {title: 'W/U', data: 'type', render: wearUseRender},\r\n  {\r\n    title: 'setName',\r\n    data: 'stats.set_name',\r\n    orderable: false,\r\n    visible: false\r\n  },\r\n  {\r\n    title: 'Tag',\r\n    data: 'guild_tag',\r\n    render: function(tag) {\r\n      if (tag === -1) {return 'No';}\r\n      return 'Yes';\r\n    }\r\n  },\r\n  {title: 'Drop', data: 'type', render: dropRender},\r\n  {title: 'Send', data: 'type', render: sendRender}\r\n];\r\n\r\nexport default function doTable() { // jQuery\r\n  $('#pCC').append('<table id=\"fshInv\" class=\"hover\" ' +\r\n    'style=\"font-size: x-small;\"></table>');\r\n  var table = $('#fshInv').DataTable({\r\n    data: theInv.items,\r\n    autoWidth: false,\r\n    pageLength: 50,\r\n    lengthMenu: [[50, 100, 150, 200, -1], [50, 100, 150, 200, 'All']],\r\n    columnDefs: [{targets: '_all', defaultContent: ''},\r\n      {\r\n        targets: [1, 4, 5, 6, 7, 8, 9, 10, 12, 13],\r\n        orderSequence: ['desc', 'asc']\r\n      }],\r\n    columns: tblCols,\r\n    createdRow: createdRow,\r\n    stateSave: true,\r\n    stateDuration: 0\r\n  });\r\n  table.column(12).visible('current_player_id' in theInv);\r\n  table.column(17).visible('player_id' in theInv &&\r\n    showQuickDropLinks);\r\n  table.column(18).visible('player_id' in theInv &&\r\n    showQuickSendLinks);\r\n}\r\n","import fallback from '../../system/fallback';\r\nimport {rarity} from '../../support/constants';\r\nimport {theInv} from '../options';\r\n\r\nfunction getT(player_id) {\r\n  if (player_id === -1) {return 4;}\r\n  return 1;\r\n}\r\n\r\nfunction player(invPlayer, rowPlayer, guild) {\r\n  if (invPlayer) {return invPlayer;}\r\n  if (rowPlayer !== -1) {return rowPlayer;}\r\n  return guild;\r\n}\r\n\r\nfunction isPartOfSet(row) {\r\n  return row.stats && row.stats.set_name !== '';\r\n}\r\n\r\nfunction nameRenderDisplay(data, row) {\r\n  var cur = fallback(theInv.player_id,\r\n    theInv.current_player_id);\r\n  var t = getT(row.player_id);\r\n  var p = player(theInv.player_id, row.player_id,\r\n    theInv.guild_id);\r\n\r\n  var bold = data;\r\n  if (row.equipped) {bold = '<b>' + data + '</b>';}\r\n\r\n  var _setName = '';\r\n  if (isPartOfSet(row)) {\r\n    _setName = ' (<span class=\"fshLink setName\" set=\"' + row.stats.set_name +\r\n      '\">set</span>)';\r\n  }\r\n\r\n  return '<a href=\"index.php?cmd=auctionhouse&search=' + data +\r\n    '\" class=\"fshInvItem tip-dynamic ' +\r\n    rarity[row.rarity].clas + '\" ' +\r\n    'data-tipped=\"fetchitem.php?item_id=' + row.item_id +\r\n    '&inv_id=' + row.inv_id + '&t=' + t + '&p=' + p +\r\n    '&currentPlayerId=' + cur + '\">' +\r\n    bold + '</a>' + _setName;\r\n}\r\n\r\nexport default function nameRender(data, type, row) {\r\n  if (type !== 'display') {return data;}\r\n  return nameRenderDisplay(data, row);\r\n}\r\n","import playerName from './playerName';\r\n\r\nfunction whereRenderUserFolder(row) {\r\n  if (row.equipped) {return -2;}\r\n  return row.folder_id;\r\n}\r\n\r\nexport default function whereRender(data, type, row) {\r\n  if (row.folder_id) {\r\n    return whereRenderUserFolder(row);\r\n  }\r\n  if (row.player_id === -1) {return '~';}\r\n  return playerName(row.player_id);\r\n}\r\n","import isSelected from '../../system/isSelected';\r\nimport playerName from './playerName';\r\nimport {theInv} from '../options';\r\n\r\nfunction whereRenderGuildDisplay(row) {\r\n  if (row.player_id === -1) {return 'GS';}\r\n  return '<a class=\"fshMaroon\" href=\"index.php?cmd=profile&player_id=' +\r\n    row.player_id + '\">' + playerName(row.player_id) + '</a>';\r\n}\r\n\r\nexport default function whereRenderDisplay(data, type, row) {\r\n  if (row.player_id) {\r\n    return whereRenderGuildDisplay(row);\r\n  }\r\n  if (row.equipped) {return 'Worn';}\r\n  var folderSelect = '<select class=\"fshMoveItem\" data-inv=\"' + row.inv_id +\r\n    '\">';\r\n  var keysArray = Object.keys(theInv.folders)\r\n    .sort(function(a, b) {return a - b;});\r\n  keysArray.forEach(function(value) {\r\n    folderSelect += '<option value=\"' + value + '\"' +\r\n      isSelected(Number(value), row.folder_id) + '>' +\r\n      theInv.folders[value] + '</option>';\r\n  });\r\n  folderSelect += '</select>';\r\n  return folderSelect;\r\n}\r\n","import playerName from './playerName';\r\nimport {theInv} from '../options';\r\n\r\nfunction whereRenderGuildFilter(row) {\r\n  if (row.player_id === -1) {return 'GS';}\r\n  return playerName(row.player_id);\r\n}\r\n\r\nexport default function whereRenderFilter(data, type, row) {\r\n  if (row.player_id) {\r\n    return whereRenderGuildFilter(row);\r\n  }\r\n  if (row.equipped) {return 'Worn';}\r\n  return theInv.folders[row.folder_id];\r\n}\r\n","export default function durabilityRender(data, type, row) {\r\n  if (parseInt(row.max_durability, 10) > 0) {\r\n    return Math.ceil(row.durability / row.max_durability * 100);\r\n  }\r\n}\r\n","import {theInv} from '../options';\r\n\r\nfunction bpDisplayType(type, row) {\r\n  if (type !== 'display') {return 'BP';}\r\n  if (row.player_id === -1) {\r\n    return '<span class=\"fshLink takeItem\" invid=\"' + row.inv_id +\r\n      '\" action=\"take\">BP</span>';\r\n  }\r\n  return '<span class=\"fshLink recallItem\" invid=\"' + row.inv_id +\r\n    '\" playerid=\"' + row.player_id +\r\n    '\" mode=\"0\" action=\"recall\">BP</span>';\r\n}\r\n\r\nexport default function bpRender(where, type, row) {\r\n  if (row.folder_id || row.player_id ===\r\n    theInv.current_player_id) {return;}\r\n  return bpDisplayType(type, row);\r\n}\r\n","function taggedOrEquipped(row) {\r\n  return row.guild_tag !== -1 || row.equipped;\r\n}\r\n\r\nexport default function dropRender(data, type, row) {\r\n  if (taggedOrEquipped(row)) {return;}\r\n  if (type !== 'display') {return 'Drop';}\r\n  return '<span class=\"dropItem tip-static dropLink\" data-tipped=' +\r\n    '\"INSTANTLY DESTROY THE ITEM. NO REFUNDS OR DO-OVERS! Use at own risk.\"' +\r\n    ' data-inv=\"' + row.inv_id + '\">Drop</span>';\r\n}\r\n","import fallback from '../../system/fallback';\r\n\r\nexport default function sendRender(data, type, row) {\r\n  if (fallback(row.bound, row.equipped)) {return;}\r\n  if (type !== 'display') {return 'Send';}\r\n  return '<span class=\"sendItem tip-static sendLink\" data-tipped=' +\r\n    '\"INSTANTLY SEND THE ITEM. NO REFUNDS OR DO-OVERS! Use at own risk.\"' +\r\n    ' data-inv=\"' + row.inv_id + '\">Send</span>';\r\n}\r\n","import {options} from './options';\r\nimport setForage from '../ajax/setForage';\r\n\r\nexport default function setChecks() {\r\n  Array.prototype.forEach.call(\r\n    document.querySelectorAll('table.fshInvFilter input[type=\"checkbox\"]'),\r\n    function(el) {\r\n      el.checked =\r\n        options.checkedElements[el.getAttribute('item')] === 1;\r\n    });\r\n  setForage('fsh_inventory', options);\r\n}\r\n","import {inventoryCheckAll} from '../assets';\r\nimport {options} from '../options';\r\nimport setChecks from '../setChecks';\r\n\r\nexport default function allChecks() { // jQuery\r\n  options.checkedElements = inventoryCheckAll;\r\n  setChecks();\r\n  $('#fshInv').DataTable().draw(false);\r\n}\r\n","import {options} from '../options';\r\nimport setForage from '../../ajax/setForage';\r\n\r\nexport default function changeLvls() { // jQuery\r\n  var minLvl = parseInt($('#fshMinLvl').val(), 10);\r\n  var maxLvl = parseInt($('#fshMaxLvl').val(), 10);\r\n  if (isNaN(minLvl) || isNaN(maxLvl)) {return;}\r\n  options.fshMinLvl = minLvl;\r\n  options.fshMaxLvl = maxLvl;\r\n  setForage('fsh_inventory', options);\r\n  $('#fshInv').DataTable().draw(false);\r\n}\r\n","import {options} from '../options';\r\nimport setChecks from '../setChecks';\r\n\r\nfunction clearGearOnly(checkedElements) {\r\n  var newEle = {};\r\n  Object.keys(checkedElements).forEach(function(key) {\r\n    if (parseInt(key, 10) >= 100) {\r\n      newEle[key] = checkedElements[key];\r\n    }\r\n  });\r\n  return newEle;\r\n}\r\n\r\nexport default function clearChecks() { // jQuery\r\n  options.checkedElements = clearGearOnly(options.checkedElements);\r\n  setChecks();\r\n  $('#fshInv').DataTable().draw();\r\n}\r\n","import {imageServer} from '../../system/system';\r\n\r\nfunction removeClass(self) {\r\n  self.closest('tr')\r\n    .find('.takeItem, .recallItem, .wearItem, .dropItem, .sendItem, .storeItem')\r\n    .removeClass().qtip('hide');\r\n}\r\n\r\nfunction killRow(self, data) { // jQuery\r\n  if (data.r === 1) {return;}\r\n  var tr = self.closest('tr');\r\n  var td = $('td', tr);\r\n  td.eq(2).empty(); // Where\r\n  td.eq(12).empty(); // BP - GS\r\n  td.eq(13).empty(); // GS - W/U\r\n  td.eq(14).empty(); // W/U - Tag\r\n  td.eq(15).empty(); // Tag - Drop\r\n  td.eq(16).empty(); // ? - Send\r\n  tr.css('text-decoration', 'line-through');\r\n}\r\n\r\nfunction anotherSpinner(self) {\r\n  self.empty().append('<img src=\"' + imageServer +\r\n    '/skin/loading.gif\" width=\"11\" height=\"11\">');\r\n}\r\n\r\nexport default function doAction(fn, self) { // jQuery\r\n  removeClass(self);\r\n  fn().done(killRow.bind(null, self));\r\n  anotherSpinner(self);\r\n}\r\n","import dialog from './dialog';\r\nimport retryAjax from './retryAjax';\r\n\r\nexport default function dropItem(invIdList) {\r\n  return retryAjax({\r\n    url: 'index.php',\r\n    data: {\r\n      cmd: 'profile',\r\n      subcmd: 'dodropitems',\r\n      removeIndex: invIdList,\r\n      ajax: 1\r\n    },\r\n    dataType: 'json'\r\n  }).done(dialog);\r\n}\r\n","import {options} from '../options';\r\nimport setForage from '../../ajax/setForage';\r\n\r\nexport default function getChecks() { // jQuery\r\n  options.checkedElements = {};\r\n  Array.prototype.forEach.call(\r\n    document.querySelectorAll(\r\n      'table.fshInvFilter input[type=\"checkbox\"][item]:checked'),\r\n    function(el) {\r\n      options.checkedElements[el.getAttribute('item')] = 1;\r\n    });\r\n  setForage('fsh_inventory', options);\r\n  $('#fshInv').DataTable().draw(false);\r\n}\r\n","import dialog from './dialog';\r\nimport retryAjax from './retryAjax';\r\n\r\nexport default function moveItem(invIdList, folderId) {\r\n  return retryAjax({\r\n    url: 'index.php',\r\n    data: {\r\n      cmd: 'profile',\r\n      subcmd: 'sendtofolder',\r\n      inv_list: JSON.stringify(invIdList),\r\n      folder_id: folderId,\r\n      ajax: 1\r\n    },\r\n    dataType: 'json'\r\n  }).done(dialog);\r\n}\r\n","import {defaultOptions} from '../assets';\r\nimport {options} from '../options';\r\nimport setChecks from '../setChecks';\r\n\r\nexport default function resetChecks() { // jQuery\r\n  options.checkedElements = defaultOptions.checkedElements;\r\n  setChecks();\r\n  $('#fshInv').DataTable().draw(false);\r\n}\r\n","import {defaultOptions} from '../assets';\r\nimport {options} from '../options';\r\nimport setForage from '../../ajax/setForage';\r\n\r\nexport default function resetLvls() { // jQuery\r\n  options.fshMinLvl = defaultOptions.fshMinLvl;\r\n  options.fshMaxLvl = defaultOptions.fshMaxLvl;\r\n  setForage('fsh_inventory', options);\r\n  $('#fshMinLvl').val(options.fshMinLvl);\r\n  $('#fshMaxLvl').val(options.fshMaxLvl);\r\n  $('#fshInv').DataTable().draw(false);\r\n}\r\n","import dialog from './dialog';\r\nimport getValue from '../system/getValue';\r\nimport infoBox from '../common/infoBox';\r\nimport retryAjax from './retryAjax';\r\n\r\nfunction htmlResult(data) { // TODO change to app code to avoid 302 redirect\r\n  var info = infoBox(data);\r\n  var _r = 1;\r\n  // if (info.search(/(successfully|gained|components)/) !== -1) {_r = 0;}\r\n  if (info.includes('successfully')) {_r = 0;}\r\n  return {r: _r, m: info};\r\n}\r\n\r\nexport default function sendItem(invIdList) {\r\n  return retryAjax({\r\n    url: 'index.php',\r\n    data: {\r\n      no_mobile: 1,\r\n      cmd: 'trade',\r\n      subcmd: 'senditems',\r\n      xc: window.ajaxXC,\r\n      target_username: getValue('itemRecipient'),\r\n      sendItemList: invIdList\r\n    }\r\n  }).pipe(htmlResult)\r\n    .done(dialog);\r\n}\r\n","import backpack from '../ajax/backpack';\r\nimport equipItem from '../ajax/equipItem';\r\nimport errorDialog from '../app/errorDialog';\r\nimport recall from '../app/guild/inventory/recall';\r\nimport takeItem from '../ajax/takeItem';\r\nimport useItem from '../ajax/useItem';\r\n\r\nvar deferred = window.jQuery && jQuery.when();\r\n\r\nfunction itemStatus(data) {\r\n  return function() {return data;};\r\n}\r\n\r\nfunction doAction(fn, item, data) {\r\n  return fn(item).pipe(itemStatus(data));\r\n}\r\n\r\nfunction additionalAction(action, data) {\r\n  if (action === 'wear') {\r\n    return doAction(equipItem, data.b, data);\r\n    // Return takeitem status irrespective of the status of the equipitem\r\n  }\r\n  if (action === 'use') {\r\n    return doAction(useItem, data.b, data);\r\n    // Return takeitem status irrespective of the status of the useitem\r\n  }\r\n}\r\n\r\nfunction takeItemStatus(action, data) {\r\n  if (data.r === 0 && action !== 'take') {\r\n    return additionalAction(action, data);\r\n  }\r\n  return data;\r\n}\r\n\r\nexport function queueTakeItem(invId, action) {\r\n  // You have to chain them because they could be modifying the backpack\r\n  deferred = deferred.pipe(function pipeTakeToQueue() {\r\n    return takeItem(invId).pipe(takeItemStatus.bind(null, action));\r\n  });\r\n  return deferred;\r\n}\r\n\r\nfunction gotBackpack(o, data) {\r\n  return function(bpData) {\r\n    // TODO assuming backpack is successful...\r\n    var lastBackpackItem = bpData.items[bpData.items.length - 1].a;\r\n    if (o.action === 'wear') {\r\n      return doAction(equipItem, lastBackpackItem, data);\r\n      // Return recall status irrespective of the status of the equipitem\r\n    }\r\n    if (o.action === 'use') {\r\n      return doAction(useItem, lastBackpackItem, data);\r\n      // Return recall status irrespective of the status of the useitem\r\n    }\r\n  };\r\n}\r\n\r\nfunction recallItemStatus(o) {\r\n  return function(data) {\r\n    if (data.r === 0 && o.action !== 'recall') {\r\n      return backpack().pipe(gotBackpack(o, data));\r\n    }\r\n    return data;\r\n  };\r\n}\r\n\r\nfunction pipeRecallToQueue(o) {\r\n  return function() {\r\n    return recall(o.invId, o.playerId, o.mode).pipe(errorDialog)\r\n      .pipe(recallItemStatus(o));\r\n  };\r\n}\r\n\r\nexport function queueRecallItem(o) {\r\n  // You have to chain them because they could be modifying the backpack\r\n  deferred = deferred.pipe(pipeRecallToQueue(o));\r\n  return deferred;\r\n}\r\n","import dialog from './dialog';\r\nimport retryAjax from './retryAjax';\r\n\r\nexport default function takeItem(invId) {\r\n  return retryAjax({\r\n    url: 'index.php',\r\n    data: {\r\n      cmd: 'guild',\r\n      subcmd: 'inventory',\r\n      subcmd2: 'takeitem',\r\n      guildstore_id: invId,\r\n      ajax: 1\r\n    },\r\n    dataType: 'json'\r\n  }).done(dialog);\r\n}\r\n","import retryAjax from './retryAjax';\r\n\r\nexport default function backpack() {\r\n  return retryAjax({\r\n    url: 'index.php',\r\n    data: {cmd: 'profile', subcmd: 'fetchinv'},\r\n    dataType: 'json'\r\n  });\r\n}\r\n","import callApp from '../../callApp';\r\n// import failStub from '../../failStub';\r\n\r\nexport default function recall(invId, playerId, mode) {\r\n  // return failStub();\r\n  return callApp({\r\n    cmd: 'guild',\r\n    subcmd: 'inventory',\r\n    subcmd2: 'recall',\r\n    id: invId, // + 10000000,\r\n    player_id: playerId,\r\n    mode: mode\r\n  });\r\n}\r\n","import allChecks from './allChecks';\r\nimport changeLvls from './changeLvls';\r\nimport clearChecks from './clearChecks';\r\nimport doAction from './doAction';\r\nimport dostoreitems from '../../app/guild/inventory/dostoreitems';\r\nimport dropItem from '../../ajax/dropItem';\r\nimport equipItem from '../../ajax/equipItem';\r\nimport getChecks from './getChecks';\r\n// import {injectInventoryManagerNew} from '../inventory';\r\nimport moveItem from '../../ajax/moveItem';\r\nimport resetChecks from './resetChecks';\r\nimport resetLvls from './resetLvls';\r\nimport sendItem from '../../ajax/sendItem';\r\nimport useItem from '../../ajax/useItem';\r\nimport {queueRecallItem, queueTakeItem} from '../../ajaxQueue/queue';\r\n\r\nfunction setName(e) { // jQuery\r\n  $('#fshInv').DataTable().search($(e.target).attr('set')).draw();\r\n  $('#fshInv_filter input').focus();\r\n}\r\n\r\nfunction takeItem(e) { // jQuery\r\n  var self = $(e.target);\r\n  doAction(\r\n    queueTakeItem.bind(null, self.attr('invid'), self.attr('action')),\r\n    self\r\n  );\r\n}\r\n\r\nfunction recallItem(e) { // jQuery\r\n  var self = $(e.target);\r\n  doAction(\r\n    queueRecallItem.bind(null, {\r\n      invId: self.attr('invid'),\r\n      playerId: self.attr('playerid'),\r\n      mode: self.attr('mode'),\r\n      action: self.attr('action')\r\n    }),\r\n    self\r\n  );\r\n}\r\n\r\nfunction wearItem(e) { // jQuery\r\n  var self = $(e.target);\r\n  doAction(equipItem.bind(null, self.attr('invid')), self);\r\n}\r\n\r\nfunction doUseItem(e) { // jQuery\r\n  var self = $(e.target);\r\n  doAction(useItem.bind(null, self.attr('invid')), self);\r\n}\r\n\r\nfunction doMoveItem(e) { // jQuery\r\n  var self = $(e.target);\r\n  moveItem([self.data('inv')], self.val());\r\n}\r\n\r\nfunction doStoreItem(e) { // jQuery\r\n  var self = $(e.target);\r\n  doAction(dostoreitems.bind(null, [self.attr('invid')]), self);\r\n}\r\n\r\nfunction doDropItem(e) { // jQuery\r\n  var self = $(e.target);\r\n  doAction(dropItem.bind(null, [self.data('inv')]), self);\r\n}\r\n\r\nfunction doSendItem(e) { // jQuery\r\n  var self = $(e.target);\r\n  doAction(sendItem.bind(null, [self.data('inv')]), self);\r\n}\r\n\r\nexport default function eventHandlers() { // jQuery\r\n  // $('#fshRefresh').click(injectInventoryManagerNew);\r\n  $('#fshMinLvl, #fshMaxLvl').keyup(changeLvls);\r\n  $('#fshReset').click(resetLvls);\r\n  $('table.fshInvFilter').on('click', 'input[type=\"checkbox\"]', getChecks);\r\n  $('#fshAll').click(allChecks);\r\n  $('#fshNone').click(clearChecks);\r\n  $('#fshDefault').click(resetChecks);\r\n  $('#fshInv').on('click', 'span.setName', setName);\r\n  $('#fshInv').on('click', 'span.takeItem', takeItem);\r\n  $('#fshInv').on('click', 'span.recallItem', recallItem);\r\n  $('#fshInv').on('click', 'span.wearItem', wearItem);\r\n  $('#fshInv').on('click', 'span.useItem', doUseItem);\r\n  $('#fshInv').on('change', 'select.fshMoveItem', doMoveItem);\r\n  $('#fshInv').on('click', 'span.dropItem', doDropItem);\r\n  $('#fshInv').on('click', 'span.sendItem', doSendItem);\r\n  $('#fshInv').on('click', 'span.storeItem', doStoreItem);\r\n}\r\n","import callApp from '../../callApp';\r\nimport errorDialog from '../../errorDialog';\r\n\r\nexport default function dostoreitems(invIdAry) {\r\n  return callApp({\r\n    cmd: 'guild',\r\n    subcmd: 'inventory',\r\n    subcmd2: 'dostoreitems',\r\n    storeIndex: invIdAry\r\n  }).pipe(errorDialog);\r\n}\r\n","import intValue from '../system/intValue';\r\nimport {options} from './options';\r\n\r\nvar lvlTests = [\r\n  function(level) {return level === 0;},\r\n  function(level, min, max) {return isNaN(min) && isNaN(max);},\r\n  function(level, min, max) {return isNaN(min) && level <= max;},\r\n  function(level, min, max) {return min <= level && isNaN(max);},\r\n  function(level, min, max) {return min <= level && level <= max;}\r\n];\r\n\r\nfunction doLvlFilter(_settings, data) {\r\n  var min = options.fshMinLvl;\r\n  var max = options.fshMaxLvl;\r\n  var level = intValue(data[1]); // use data for the level column\r\n  for (var i = 0; i < lvlTests.length; i += 1) {\r\n    if (lvlTests[i](level, min, max)) {return true;}\r\n  }\r\n  return false;\r\n}\r\n\r\nexport function lvlFilter() { // jQuery\r\n  /* Custom filtering function which will search\r\n  data in column 2 between two values */\r\n  $.fn.dataTable.ext.search.push(doLvlFilter);\r\n}\r\n\r\nexport function typeFilter() { // jQuery\r\n  $.fn.dataTable.ext.search.push(\r\n    function(_settings, _row, _index, data) {\r\n      return !options.checkedElements ||\r\n        options.checkedElements[data.type];\r\n    }\r\n  );\r\n}\r\n\r\nfunction testSetId(data) {\r\n  return options.checkedElements['-1'] &&\r\n    data.stats && data.stats.set_id !== '-1';\r\n}\r\n\r\nexport function setFilter() { // jQuery\r\n  $.fn.dataTable.ext.search.push(\r\n    function(_settings, _row, _index, data) {\r\n      return !options.checkedElements ||\r\n        !options.checkedElements['-1'] ||\r\n        testSetId(data);\r\n    }\r\n  );\r\n}\r\n\r\nexport function rarityFilter() { // jQuery\r\n  $.fn.dataTable.ext.search.push(\r\n    function(_settings, _row, _index, data) {\r\n      var rarity = (parseInt(data.rarity, 10) + 100).toString();\r\n      return !options.checkedElements ||\r\n        options.checkedElements[rarity];\r\n    }\r\n  );\r\n}\r\n","import getValue from '../system/getValue';\r\nimport {pCC} from '../support/layout';\r\nimport playerId from '../common/playerId';\r\nimport playerName from '../common/playerName';\r\n\r\nvar currentPlayerId;\r\n\r\nfunction getPlayer(playerAry) { // Legacy\r\n  if (playerAry) {return Number(playerAry[1]);}\r\n  return 0;\r\n}\r\n\r\nfunction msgDoesNotIncludePlayer(aRow) {\r\n  var messageHTML = aRow.cells[2].innerHTML;\r\n  var doublerPlayerMessageRE =\r\n    /member\\s<a\\shref=\"index.php\\?cmd=profile&amp;player_id=(\\d+)/;\r\n  var secondPlayer = doublerPlayerMessageRE.exec(messageHTML);\r\n  var singlePlayerMessageRE =\r\n    /<a\\shref=\"index.php\\?cmd=profile&amp;player_id=(\\d+)/;\r\n  var firstPlayer = singlePlayerMessageRE.exec(messageHTML);\r\n  var firstPlayerID = getPlayer(firstPlayer);\r\n  var secondPlayerID = getPlayer(secondPlayer);\r\n  return firstPlayer &&\r\n    firstPlayerID !== currentPlayerId &&\r\n    secondPlayerID !== currentPlayerId;\r\n}\r\n\r\nfunction findPlayers(aRow) { // Legacy\r\n  if (msgDoesNotIncludePlayer(aRow)) {\r\n    for (var j = 0; j < 3; j += 1) {\r\n      aRow.cells[j].removeAttribute('class');\r\n    }\r\n    aRow.classList.add('fshGrey');\r\n    aRow.classList.add('fshXSmall');\r\n  }\r\n}\r\n\r\nfunction likeInvite(aRow, hasInvited) { // Legacy\r\n  var message = aRow.cells[2].innerHTML;\r\n  var firstQuote = message.indexOf('\\'');\r\n  var firstPart = '';\r\n  firstPart = message.substring(0, firstQuote);\r\n  var secondQuote = message.indexOf('\\'', firstQuote + 1);\r\n  var targetPlayerName = message.substring(firstQuote + 1, secondQuote);\r\n  aRow.cells[2].innerHTML = firstPart + '\\'' +\r\n    '<a href=\"index.php?cmd=findplayer&search_active=1&' +\r\n    'search_level_max=&search_level_min=&search_username=' +\r\n    targetPlayerName + '&search_show_first=1\">' + targetPlayerName +\r\n    '</a>' + message.substring(secondQuote, message.length);\r\n  if (!hasInvited &&\r\n    targetPlayerName !== playerName()) {\r\n    $(aRow).find('td').removeClass('row').css('font-size', 'xx-small');\r\n    aRow.style.color = 'gray';\r\n  }\r\n}\r\n\r\nfunction guildInvite(aRow) { // Legacy\r\n  var hasInvited = aRow.cells[2].textContent\r\n    .search('has invited the player') !== -1;\r\n  if (aRow.cells[2].textContent.charAt(0) === '\\'' || hasInvited) {\r\n    likeInvite(aRow, hasInvited);\r\n  }\r\n}\r\n\r\nfunction processGuildWidgetRow(aRow) { // Legacy\r\n  findPlayers(aRow);\r\n  guildInvite(aRow);\r\n}\r\n\r\nfunction getMessageHeader() {\r\n  var nodeList = pCC.getElementsByTagName('TD');\r\n  for (var i = 0; i < nodeList.length; i += 1) {\r\n    if (nodeList[i].textContent === 'Message') {\r\n      return nodeList[i];\r\n    }\r\n  }\r\n}\r\n\r\nfunction guildLogWidgetsEnabled() { // Legacy\r\n  var messageNameCell = getMessageHeader();\r\n  if (!messageNameCell) {return;}\r\n  var logTable = messageNameCell.parentNode.parentNode.parentNode;\r\n  messageNameCell.innerHTML += '&nbsp;&nbsp;<span class=\"fshWhite\">' +\r\n    '(Guild Log messages not involving self are dimmed!)</span>';\r\n\r\n  currentPlayerId = playerId();\r\n\r\n  for (var i = 1; i < logTable.rows.length; i += 2) {\r\n    var aRow = logTable.rows[i];\r\n    processGuildWidgetRow(aRow);\r\n  }\r\n}\r\n\r\nexport default function addGuildLogWidgets() {\r\n  if (getValue('hideNonPlayerGuildLogMessages')) {\r\n    guildLogWidgetsEnabled();\r\n  }\r\n}\r\n","import findNode from '../system/findNode';\r\nimport getValue from '../system/getValue';\r\nimport parseDateAsTimestamp from '../system/parseDateAsTimestamp';\r\nimport quickBuffHref from '../common/quickBuffHref';\r\nimport setValue from '../system/setValue';\r\n\r\nvar nowUtc;\r\nvar lastCheckUtc;\r\n\r\nfunction findChatTable() { // Legacy\r\n  var chatTable = findNode('//table[@class=\"width_full\"]'); // Guild Log\r\n  if (!chatTable) {\r\n    chatTable = findNode('//table[tbody/tr/td[.=\"Message\"]]'); // Outbox & Guild Chat\r\n  }\r\n  if (!chatTable) {\r\n    chatTable = findNode('//table[tbody/tr/td/span[' +\r\n      'contains(.,\"Currently showing:\")]]'); // personal log\r\n  }\r\n  return chatTable;\r\n}\r\n\r\nfunction isOldRow(postAgeMins, postDateUtc) {\r\n  return postAgeMins > 20 && postDateUtc <= lastCheckUtc;\r\n}\r\n\r\nfunction chatRowBuffLink(aRow, logScreen, addBuffTag) { // Legacy\r\n  if (logScreen === 'Chat' && addBuffTag) {\r\n    var playerIDRE = /player_id=(\\d+)/;\r\n    var playerID = playerIDRE.exec(aRow.cells[1].innerHTML)[1];\r\n    aRow.cells[1].innerHTML += ' <a class=\"fshBf\" ' +\r\n      quickBuffHref(playerID) + '>[b]</a>';\r\n  }\r\n}\r\n\r\nfunction rowColor(aRow, logScreen, dateColumn) { // Legacy\r\n  var addBuffTag = true;\r\n  var cellContents = aRow.cells[dateColumn].textContent;\r\n  var postDateUtc = parseDateAsTimestamp(cellContents);\r\n  var postAgeMins = (nowUtc - postDateUtc) / (1000 * 60);\r\n  if (postDateUtc > lastCheckUtc) {\r\n    aRow.classList.add('fshNr');\r\n  } else if (isOldRow(postAgeMins, postDateUtc)) {\r\n    aRow.classList.add('fshOr');\r\n    addBuffTag = false;\r\n  }\r\n  chatRowBuffLink(aRow, logScreen, addBuffTag);\r\n}\r\n\r\nfunction getLastCheck(lastCheckScreen) {\r\n  return getValue(lastCheckScreen) || nowUtc;\r\n}\r\n\r\nfunction doLogColoring(logScreen, dateColumn, chatTable) { // Legacy\r\n  nowUtc = (new Date()).setUTCSeconds(0, 0) - 1;\r\n  var lastCheckScreen = 'last' + logScreen + 'Check';\r\n  lastCheckUtc = getLastCheck(lastCheckScreen);\r\n  var increment = 2;\r\n  if (logScreen === 'Chat') {\r\n    increment = 4;\r\n    chatTable.classList.add('fshGc');\r\n  }\r\n  for (var i = 1; i < chatTable.rows.length; i += increment) {\r\n    rowColor(chatTable.rows[i], logScreen, dateColumn);\r\n  }\r\n  setValue(lastCheckScreen, nowUtc);\r\n}\r\n\r\nexport default function addLogColoring(logScreen, dateColumn) { // Legacy\r\n  if (!getValue('enableLogColoring')) {return;}\r\n  var chatTable = findChatTable();\r\n  if (chatTable) {doLogColoring(logScreen, dateColumn, chatTable);}\r\n}\r\n","import add from '../support/task';\r\nimport calf from '../support/calf';\r\nimport clearButton from './clearButton';\r\nimport decorate from './decorate';\r\nimport doTable from './table';\r\nimport eventHandlers from './eventHandlers/eventHandlers';\r\nimport getForage from '../ajax/getForage';\r\nimport getInventory from '../ajax/getInventory';\r\nimport getMembrList from '../ajax/getMembrList';\r\nimport headers from './headers';\r\nimport {imageServer} from '../system/system';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport setChecks from './setChecks';\r\nimport setLvls from './setLvls';\r\nimport {extendOptions, storeTheInv} from './options';\r\nimport {lvlFilter, rarityFilter, setFilter, typeFilter} from './filters';\r\nimport {time, timeEnd} from '../support/debug';\r\n\r\nfunction doSpinner() { // jQuery\r\n  $('#pCC').html('<span id=\"fshInvMan\"><img src = \"' +\r\n  imageServer + '/world/actionLoadingSpinner.gif\">&nbsp;' +\r\n    'Getting inventory data...</span>');\r\n}\r\n\r\nfunction rekeyMembrList() {\r\n  calf.membrList = Object.keys(calf.membrList)\r\n    // Using reduce() to rekey the membrList from names to id's\r\n    .reduce(function(prev, curr) {\r\n      if (curr !== 'lastUpdate') {\r\n        prev[calf.membrList[curr].id] =\r\n          calf.membrList[curr];\r\n      }\r\n      return prev;\r\n    }, {});\r\n}\r\n\r\nfunction getInvMan() {\r\n\r\n  time('inventory.getInvMan');\r\n\r\n  if (calf.membrList) {rekeyMembrList();}\r\n\r\n  decorate();\r\n  lvlFilter();\r\n  typeFilter();\r\n  setFilter();\r\n  rarityFilter();\r\n  headers();\r\n  setChecks();\r\n  setLvls();\r\n  doTable();\r\n  eventHandlers();\r\n  // eslint-disable-next-line no-use-before-define\r\n  $('#fshRefresh').click(injectInventoryManagerNew);\r\n  clearButton();\r\n\r\n  timeEnd('inventory.getInvMan');\r\n\r\n}\r\n\r\nfunction syncInvMan() { // jQuery\r\n  var prm = [];\r\n  prm.push(getInventory().done(storeTheInv));\r\n  if (calf.subcmd === 'guildinvmgr') {\r\n    prm.push(getMembrList(false));\r\n  }\r\n  prm.push(getForage('fsh_inventory')\r\n    .done(extendOptions)\r\n  );\r\n  $.when.apply($, prm).done(function() {\r\n    add(3, getInvMan);\r\n  });\r\n}\r\n\r\nexport function injectInventoryManagerNew() {\r\n  if (jQueryNotPresent()) {return;}\r\n  doSpinner();\r\n  syncInvMan();\r\n}\r\n","import {theInv} from './options';\r\n\r\nexport default function decorate() {\r\n  if (theInv.folders) {\r\n    theInv.folders['-1'] = 'Main';\r\n  }\r\n  // Hide composed potions until Zorg fixes the feed\r\n  theInv.items =\r\n    theInv.items.filter(function(obj) {\r\n      return obj.type !== 15;\r\n    });\r\n  //\r\n}\r\n","import {invManFilter} from './assets';\r\nimport {theInv} from './options';\r\n\r\nexport default function headers() { // jQuery\r\n  var reportTitle;\r\n  if (theInv.player_id) {\r\n    reportTitle = '<b>&nbsp;Inventory Manager</b> ' +\r\n      theInv.items.length +\r\n      ' items (green = worn, blue = backpack)';\r\n  } else {\r\n    reportTitle = '<b>&nbsp;Guild Inventory Manager</b> ' +\r\n      theInv.items.length +\r\n      ' items (maroon = in BP, blue=guild store)';\r\n  }\r\n  var myHtml = invManFilter.replace('@@reportTitle@@', reportTitle);\r\n  $('#pCC').html(myHtml);\r\n}\r\n","import {options} from './options';\r\n\r\nexport default function setLvls() { // jQuery\r\n  $('#fshMinLvl').val(options.fshMinLvl);\r\n  $('#fshMaxLvl').val(options.fshMaxLvl);\r\n}\r\n","export default function clearButton() { // jQuery\r\n  var input = $('#fshInv_filter input');\r\n  input.prop('type', 'text');\r\n  var clear = $('<span>&times;</span>');\r\n  input.wrap($('<span class=\"text-input-wrapper\"/>'));\r\n  input.after(clear);\r\n  clear.click(function() {\r\n    input.val('');\r\n    $('#fshInv').DataTable().search('').draw();\r\n  });\r\n}\r\n","import {getElementById} from '../common/getElement';\r\nimport {itemRE} from '../support/constants';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport outputResult from '../common/outputResult';\r\nimport retryAjax from '../ajax/retryAjax';\r\n\r\nfunction showError(data) { // jQuery\r\n  var $tempError = $('#temp_error');\r\n  $tempError.html('<span style=\"color: red\">Error:</span> ' + data.m);\r\n  $tempError.show().delay(5000).hide(400);\r\n}\r\n\r\nfunction failHndlr(jqXHR) {\r\n  showError({m: jqXHR.status + ' ' + jqXHR.statusText});\r\n}\r\n\r\nfunction quickDoneTaken(data) { // jQuery\r\n  if (data.r !== 0) {\r\n    showError(data);\r\n  } else {\r\n    var qtipId = $('#temp-inv-img-' + data.temp_id).data('hasqtip');\r\n    $('#temp-inv-' + data.temp_id).remove();\r\n    $('#qtip-' + qtipId).remove();\r\n  }\r\n  outputResult('Item taken.', getElementById('take_result'));\r\n}\r\n\r\nfunction takeAllSimilar(evt) { // jQuery.min\r\n  var invIds = evt.target.getAttribute('invIDs').split(',');\r\n  evt.target.parentNode.innerHTML = 'taking all ' +\r\n    invIds.length + ' items';\r\n  invIds.forEach(function(invId) {\r\n    retryAjax({\r\n      type: 'POST',\r\n      url: 'index.php',\r\n      data: {\r\n        cmd: 'tempinv',\r\n        subcmd: 'takeitem',\r\n        temp_id: invId,\r\n        ajax: '1'\r\n      },\r\n      dataType: 'json'\r\n    }).done(quickDoneTaken).fail(failHndlr);\r\n  });\r\n}\r\n\r\nfunction toggleQuickTake() { // jQuery\r\n  if ($('#currentMBDisplay').attr('value') === 'mailbox') {\r\n    $('#mailboxSwitcher').html('Toggle Mailbox');\r\n    $('#quickTake').css('display', 'block');\r\n    $('#regularMailbox').css('display', 'none');\r\n    $('#currentMBDisplay').attr('value', 'quicktake');\r\n  } else {\r\n    $('#mailboxSwitcher').html('Toggle Quick Take');\r\n    $('#quickTake').css('display', 'none');\r\n    $('#regularMailbox').css('display', 'block');\r\n    $('#currentMBDisplay').attr('value', 'mailbox');\r\n  }\r\n}\r\n\r\nexport default function injectMailbox() { // Bad jQuery\r\n  if (jQueryNotPresent()) {return;}\r\n  var items = $('#pCC a');\r\n  if (items.length === 0) {return;} // Empty mailbox\r\n  $('#pCC').wrapInner('<div id=\"regularMailbox\" />');\r\n  var quickTakeDiv = '<div id=\"quickTake\" style=\"display:none\"><br />' +\r\n    '<br /><center><font size=\"3\"><b>Quick Take</b></font>' +\r\n    '<br />Select which item to take all similar items from your ' +\r\n    'Mailbox.<br /></center>' +\r\n    '<table id=\"quickTakeTable\" align=\"left\"><tr><th width=20%>' +\r\n    'Actions</th><th>Items</th></tr><tr><td id=\"take_result\" ' +\r\n    'colspan=2></td></tr></table>' +\r\n    '</div>';\r\n  $('#pCC').prepend('<span id=\"mailboxSwitcher\" ' +\r\n    'style=\"cursor:pointer; text-decoration:underline; ' +\r\n    'color:blue;\">Toggle Quick Take</span><input type=\"hidden\" ' +\r\n    'id=\"currentMBDisplay\" value=\"mailbox\" />' + quickTakeDiv);\r\n  var itemList = {};\r\n  $('#regularMailbox img[data-tipped*=\"t=5\"]').each(function(i, e) {\r\n    var itemIDs = itemRE.exec($(e).attr('data-tipped'));\r\n    if (!itemIDs) {return;}\r\n    var itemId = itemIDs[1];\r\n    var invId = itemIDs[2];\r\n    var tipped = $(e).attr('data-tipped');\r\n    var src = $(e).attr('src');\r\n    if (!itemList[itemId]) {\r\n      var invIds = [];\r\n      invIds.push(invId);\r\n      itemList[itemId] = {\r\n        invIds: invIds,\r\n        tipped: tipped,\r\n        src: src\r\n      };\r\n    } else {\r\n      itemList[itemId].invIds.push(invId);\r\n    }\r\n  });\r\n  var quickTakeTable = $('#quickTakeTable');\r\n  Object.keys(itemList).forEach(function(id) {\r\n    var titem = itemList[id];\r\n    quickTakeTable.append('<tr><td align=center>' +\r\n      '<span style=\"cursor:pointer; text-decoration:underline; ' +\r\n      'color:blue; font-size:x-small;\" ' +\r\n      'id=\"Helper:takeAllSimilar' + id + '\" invIDs=\"' + titem.invIds.join() +\r\n      '\">Take All ' + titem.invIds.length + '</span></td>' +\r\n      '<td><img src=\"' + titem.src +\r\n      '\" class=\"tip-dynamic\" border=\"0\" data-tipped=\"' +\r\n      titem.tipped + '\"></td></tr>');\r\n    getElementById('Helper:takeAllSimilar' + id)\r\n      .addEventListener('click', takeAllSimilar, true);\r\n  });\r\n  getElementById('mailboxSwitcher')\r\n    .addEventListener('click', toggleQuickTake, true);\r\n}\r\n","import isType from '../common/isType';\r\n\r\nvar lookup = [\r\n  [],\r\n  ['(Potion)'],\r\n  ['recalled the item', 'took the item', 'auto-returned the',\r\n    'stored the item'],\r\n  ['has added flags to', 'has removed flags to'],\r\n  ['relic. This relic now has an empower level of',\r\n    'relic. The relic empower level has been reset to zero.',\r\n    'failed to capture the relic', 'captured the relic', 'captured your relic',\r\n    'has captured the undefended relic', 'attempted to capture your relic',\r\n    / empowered the .+ relic/, / removed the empowerment from the .+ relic/],\r\n  ['disbanded a mercenary.', 'hired the mercenary'],\r\n  ['has disbanded one of their groups',\r\n    /A group from your guild was (.*) in combat./],\r\n  [/deposited ([,0-9]+) gold into the guild bank/,\r\n    /deposited ([,0-9]+) FallenSword Points into the guild./],\r\n  ['has added a new rank entitled', 'has deleted the rank',\r\n    'has requested to join the guild', 'has invited the player',\r\n    'has officially joined the guild', 'has been kicked from the guild by',\r\n    'has left the guild', 'has been assigned the rank'],\r\n  [/resulted in (.*) with a final score of/,\r\n    'resulted in a draw. Your GvG rating ',\r\n    'has just initiated a conflict with the guild',\r\n    'has initiated a conflict with your guild',\r\n    'is participating in the conflict against the guild'],\r\n  ['bought the Titan Reward item',\r\n    'from your guild\\'s contribution to the defeat of the titan',\r\n    'a 7 day cooldown has been activated on your guild for this titan'],\r\n];\r\n\r\nexport function rowProfile(data) {\r\n\r\n  function isMatch(el) {\r\n    if (isType(el, 'string')) {\r\n      return data.includes(el);\r\n    }\r\n    return el.test(data);\r\n  }\r\n\r\n  var myIndex = lookup.findIndex(function(ary) {return ary.some(isMatch);});\r\n  if (myIndex === -1) {return 0;}\r\n  return myIndex;\r\n}\r\n","export var guildLogFilter =\r\n  '<table id=\"fshNewGuildLog\" class=\"fshInvFilter\"><thead><tr>' +\r\n  '<th colspan=\"11\"><b>Guild Log Version 4</b></th>' +\r\n  '<th colspan=\"3\"><span id=\"rfsh\" class=\"sendLink\">Reset</span> ' +\r\n  '<a href=\"index.php?cmd=guild&subcmd=log\" class=\"sendLink\">' +\r\n  'Old Guild Log</a></th>' +\r\n  '</tr></thead><tbody>' +\r\n  '<tr><td rowspan=\"3\"><b>&nbsp;Filters:</b></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Potions:</td>' +\r\n  '<td><input id=\"fshPotion\" type=\"checkbox\" item=\"1\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Store/Recalls:</td>' +\r\n  '<td><input id=\"fshStore\" type=\"checkbox\" item=\"2\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Relics:</td>' +\r\n  '<td><input id=\"fshRelic\" type=\"checkbox\" item=\"4\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Mercenaries:</td>' +\r\n  '<td><input id=\"fshMerc\" type=\"checkbox\" item=\"5\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Group Combats:</td>' +\r\n  '<td><input id=\"fshGroup\" type=\"checkbox\" item=\"6\"/></td>' +\r\n  '<td colspan=\"3\">&nbsp;</td>' +\r\n  '</tr><tr>' +\r\n  '<td class=\"fshRight\">&nbsp;Donations:</td>' +\r\n  '<td><input id=\"fshDonation\" type=\"checkbox\" item=\"7\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Rankings:</td>' +\r\n  '<td><input id=\"fshRank\" type=\"checkbox\" item=\"8\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;GvGs:</td>' +\r\n  '<td><input id=\"fshGvG\" type=\"checkbox\" item=\"9\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Tag/UnTags:</td>' +\r\n  '<td><input id=\"fshTag\" type=\"checkbox\" item=\"3\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Titans:</td>' +\r\n  '<td><input id=\"fshTitan\" type=\"checkbox\" item=\"10\"/></td>' +\r\n  '<td class=\"fshRight\">&nbsp;Other:</td>' +\r\n  '<td><input id=\"fshOther\" type=\"checkbox\" item=\"0\"/></td>' +\r\n  '<td>&nbsp;</td>' +\r\n  '</tr><tr>' +\r\n  '<td colspan=\"2\">' +\r\n  '&nbsp;[<span id=\"fshAll\" class=\"fshLink\">Select All</span>]</td>' +\r\n  '<td colspan=\"2\">' +\r\n  '&nbsp;[<span id=\"fshNone\" class=\"fshLink\">Select None</span>]</td>' +\r\n  '<td colspan=\"9\"></td>' +\r\n  '</tr><tr><td id=\"fshOutput\" class=\"fshBlue\" colspan=\"14\">' +\r\n  'Loading Page 1 ...</td></tr>' +\r\n  '</tbody></table>' +\r\n  '<table id=\"fshInjectHere\">' +\r\n  '</table>';\r\nexport var headerRow = '<tbody><tr>' +\r\n  '<td class=\"header\" width=\"16\">&nbsp;</td>' +\r\n  '<td class=\"header\" width=\"20%\">Date</td>' +\r\n  '<td class=\"header\" width=\"80%\">Message</td></tr></tbody>';\r\nexport var msgType = [\r\n  'Unknown', // 0\r\n  'Potion', // 1\r\n  'showRecallMessages', // 2\r\n  'showTaggingMessages', // 3\r\n  'showRelicMessages', // 4\r\n  'showMercenaryMessages', // 5\r\n  'showGroupCombatMessages', // 6\r\n  'showDonationMessages', // 7\r\n  'showRankingMessages', // 8\r\n  'showGvGMessages', // 9\r\n  'showTitanMessages' // 10\r\n];\r\nexport var defChecks = [true, true, true, true, true, true,\r\n  true, true, true, true, true];\r\nexport var noChecks = [false, false, false, false, false, false,\r\n  false, false, false, false, false];\r\n","import addGuildLogWidgets from '../logs/addGuildLogWidgets';\r\nimport addLogColoring from '../logs/addLogColoring';\r\nimport createDocument from '../system/createDocument';\r\nimport {createTable} from '../common/cElement';\r\nimport eventHandler from '../common/eventHandler';\r\nimport {getElementById} from '../common/getElement';\r\nimport getForage from '../ajax/getForage';\r\nimport getValue from '../system/getValue';\r\nimport {imageServer} from '../system/system';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {pCC} from '../support/layout';\r\nimport parseDateAsTimestamp from '../system/parseDateAsTimestamp';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport {rowProfile} from './profiler';\r\nimport setForage from '../ajax/setForage';\r\nimport toggleForce from '../common/toggleForce';\r\nimport {defChecks, guildLogFilter, headerRow, noChecks} from './assets';\r\n\r\nvar options = {};\r\nvar fshNewGuildLog;\r\nvar fshOutput;\r\nvar maxPagesToFetch;\r\nvar maxPage;\r\nvar doc;\r\nvar currPage;\r\nvar lastPage;\r\nvar tmpGuildLog = [];\r\nvar completeReload = true;\r\nvar myTable;\r\n\r\nfunction getGuildLogPage(page) {\r\n  return retryAjax({\r\n    url: 'index.php',\r\n    data: {no_mobile: 1, cmd: 'guild', subcmd: 'log', page: page},\r\n    datatype: 'html'\r\n  });\r\n}\r\n\r\nfunction findPageInput(prev, curr) {\r\n  var output = prev;\r\n  if (!prev && curr.name === 'page') {output = curr;}\r\n  return output;\r\n}\r\n\r\nfunction getPageInput() {\r\n  var inputList = getElementById('pCC', doc)\r\n    .getElementsByClassName('custominput');\r\n  return Array.prototype.reduce.call(inputList, findPageInput, null);\r\n}\r\n\r\nfunction parsePage(data) {\r\n  doc = createDocument(data);\r\n  var pageInput = getPageInput();\r\n  currPage = Number(pageInput.value);\r\n  lastPage = Number(/\\d+/.exec(pageInput.parentNode.textContent)[0]);\r\n  if (currPage === 1) {maxPage = Math.min(lastPage, maxPagesToFetch);}\r\n  fshOutput.textContent = 'Loading ' + currPage + ' of ' + maxPage + '...';\r\n}\r\n\r\nfunction rowMatchesLog(timestamp, myMsg) {\r\n  return timestamp === options.log[0][0] && myMsg === options.log[0][2];\r\n}\r\n\r\nfunction seenRowBefore(timestamp, myMsg) {\r\n  return currPage === 1 && options.log && rowMatchesLog(timestamp, myMsg);\r\n}\r\n\r\nfunction getTableList(tableList) {\r\n  var theTable = tableList[0];\r\n  var limit = theTable.rows.length - 1;\r\n  for (var i = 1; i < limit; i += 2) {\r\n    var myRow = theTable.rows[i];\r\n    var myDate = myRow.cells[1].textContent;\r\n    var timestamp = parseDateAsTimestamp(myDate);\r\n    var myMsg = myRow.cells[2].innerHTML;\r\n    if (seenRowBefore(timestamp, myMsg)) {\r\n      completeReload = false;\r\n      break;\r\n    }\r\n    tmpGuildLog.push([currPage * 100 + i, timestamp, myDate, myMsg,\r\n      rowProfile(myMsg)]);\r\n  }\r\n}\r\n\r\nfunction parseTable() {\r\n  var tableList = doc.getElementsByClassName('width_full');\r\n  if (tableList.length === 1) {getTableList(tableList);}\r\n}\r\n\r\nfunction processPage(data) {\r\n  parsePage(data);\r\n  parseTable();\r\n}\r\n\r\nfunction getOtherPages() {\r\n  var prm = [];\r\n  if (completeReload) {\r\n    for (var i = 2; i <= maxPage; i += 1) {\r\n      prm.push(getGuildLogPage(i).done(processPage));\r\n    }\r\n  } else {\r\n    options.log.forEach(function(e) {\r\n      tmpGuildLog.push([0, e[0], e[1], e[2], e[3]]);\r\n    });\r\n  }\r\n  return $.when.apply($, prm);\r\n}\r\n\r\nfunction storeOptions() {\r\n  setForage('fsh_guildLog', options);\r\n}\r\n\r\nfunction updateOptionsLog() {\r\n  // Don't cache current minute as it may be incomplete\r\n  var nowUtc = (new Date()).setSeconds(0, 0);\r\n  options.log = tmpGuildLog.reduce(function(prev, curr) {\r\n    if (curr[1] !== nowUtc) {\r\n      prev.push([curr[1], curr[2], curr[3], curr[4]]);\r\n    }\r\n    return prev;\r\n  }, []);\r\n  storeOptions();\r\n}\r\n\r\nfunction buildTable() {\r\n  myTable = createTable({id: 'fshInjectHere', className: 'width_full'});\r\n  insertHtmlBeforeEnd(myTable, headerRow);\r\n\r\n  tmpGuildLog.forEach(function(r) {\r\n    var myRow = myTable.insertRow(-1);\r\n    r.push(myRow);\r\n    if (!options.checks[r[4]]) {myRow.className = 'fshHide';}\r\n    myRow.insertCell(-1).innerHTML =\r\n      '<span class=\"newGuildLog\" style=\"background-image: url(\\'' +\r\n      imageServer + '/skin/log_1.gif\\');\"></span>';\r\n    myRow.cells[0].className = 'row';\r\n    myRow.insertCell(-1).innerHTML = '<nobr>' + r[2] + '</nobr>';\r\n    myRow.cells[1].className = 'row';\r\n    myRow.insertCell(-1).innerHTML = r[3];\r\n    myRow.cells[2].className = 'row';\r\n    var sepRow = myTable.insertRow(-1);\r\n    r.push(sepRow);\r\n    if (!options.checks[r[4]]) {sepRow.className = 'fshHide';}\r\n    var sep = sepRow.insertCell(-1);\r\n    sep.className = 'divider';\r\n    sep.colSpan = 3;\r\n  });\r\n\r\n  var injector = getElementById('fshInjectHere');\r\n  pCC.replaceChild(myTable, injector);\r\n  addLogColoring('myGuildLog', 1);\r\n  addGuildLogWidgets();\r\n}\r\n\r\nfunction setChecks() {\r\n  Array.prototype.forEach.call(\r\n    fshNewGuildLog.getElementsByTagName('input'),\r\n    function(el) {\r\n      el.checked = options.checks[el.getAttribute('item')];\r\n    }\r\n  );\r\n  storeOptions();\r\n}\r\n\r\nfunction gotOtherPages() {\r\n  if (completeReload) {\r\n    tmpGuildLog.sort(function(a, b) {\r\n      return a[0] - b[0];\r\n    });\r\n  }\r\n  fshOutput.textContent = 'Loading complete.';\r\n  updateOptionsLog();\r\n  buildTable();\r\n}\r\n\r\nfunction processFirstPage(data) {\r\n  processPage(data);\r\n  getOtherPages().done(gotOtherPages);\r\n}\r\n\r\nfunction toggleItem(self) {\r\n  var item = Number(self.getAttribute('item'));\r\n  options.checks[item] = !options.checks[item];\r\n  storeOptions();\r\n  var hide = !options.checks[item];\r\n  tmpGuildLog.forEach(function(r) {\r\n    if (r[4] !== item) {return;}\r\n    toggleForce(r[5], hide);\r\n    toggleForce(r[6], hide);\r\n  });\r\n}\r\n\r\nfunction selectAll() {\r\n  options.checks = defChecks.slice(0);\r\n  setChecks();\r\n  tmpGuildLog.forEach(function(r) {\r\n    r[5].classList.remove('fshHide');\r\n    r[6].classList.remove('fshHide');\r\n  });\r\n}\r\n\r\nfunction selectNone() {\r\n  options.checks = noChecks.slice(0);\r\n  setChecks();\r\n  tmpGuildLog.forEach(function(r) {\r\n    r[5].classList.add('fshHide');\r\n    r[6].classList.add('fshHide');\r\n  });\r\n}\r\n\r\nfunction refresh() {\r\n  options.log = false;\r\n  storeOptions();\r\n  fshOutput.textContent = 'Loading Page 1 ...';\r\n  tmpGuildLog = [];\r\n  completeReload = true;\r\n  getElementById('fshInjectHere').innerHTML = '';\r\n  getGuildLogPage(1).done(processFirstPage);\r\n}\r\n\r\nvar guildLogEvents = [\r\n  {test: function(self) {return self.tagName === 'INPUT';}, act: toggleItem},\r\n  {test: function(self) {return self.id === 'fshAll';}, act: selectAll},\r\n  {test: function(self) {return self.id === 'fshNone';}, act: selectNone},\r\n  {test: function(self) {return self.id === 'rfsh';}, act: refresh}\r\n];\r\n\r\nfunction gotOptions(guildLog) {\r\n  options = guildLog || options;\r\n  options.checks = options.checks || defChecks.slice(0);\r\n  pCC.innerHTML = guildLogFilter;\r\n  fshNewGuildLog = getElementById('fshNewGuildLog');\r\n  fshNewGuildLog.addEventListener('click', eventHandler(guildLogEvents));\r\n  setChecks();\r\n  fshOutput = getElementById('fshOutput');\r\n  maxPagesToFetch = Number(getValue('newGuildLogHistoryPages'));\r\n  maxPage = maxPagesToFetch;\r\n  getGuildLogPage(1).done(processFirstPage);\r\n}\r\n\r\nexport default function injectNewGuildLog() { // jQuery.min\r\n  if (jQueryNotPresent()) {return;}\r\n  getForage('fsh_guildLog').done(gotOptions);\r\n}\r\n","import getCustomUrlParameter from '../system/getCustomUrlParameter';\r\nimport {getElementById} from '../common/getElement';\r\nimport {pCC} from '../support/layout';\r\nimport retryAjax from '../ajax/retryAjax';\r\n\r\nvar bpc;\r\n\r\nfunction bp() {\r\n  if (!bpc) {\r\n    bpc = getElementById('backpackContainer');\r\n  }\r\n  return bpc;\r\n}\r\n\r\nvar elementTests = [\r\n  function(self) {return self.tagName === 'A';},\r\n  function(self) {return Boolean(self.href);},\r\n  function(self) {return self.href.includes('togglesection');}\r\n];\r\n\r\nfunction isSectionToggle(self) {\r\n  return elementTests.every(function(el) {\r\n    return el(self);\r\n  });\r\n}\r\n\r\nfunction oldStyleDiv(target) {\r\n  if (target.style.display === 'block') {\r\n    target.classList.add('fshHide');\r\n  }\r\n  target.removeAttribute('style');\r\n  return 0;\r\n}\r\n\r\nfunction toggleTarget(target) {\r\n  if (target.hasAttribute('style')) {\r\n    oldStyleDiv(target);\r\n  } else {\r\n    target.classList.toggle('fshHide');\r\n  }\r\n}\r\n\r\nfunction toggleSection(self) {\r\n  var sectionId = Number(getCustomUrlParameter(self.href, 'section_id'));\r\n  if (sectionId === 5) {\r\n    toggleTarget(bp());\r\n  } else {\r\n    toggleTarget(self.parentNode.parentNode.nextElementSibling);\r\n  }\r\n}\r\n\r\nfunction testForSection(evt) {\r\n  var self = evt.target;\r\n  if (isSectionToggle(self)) {\r\n    toggleSection(self);\r\n    retryAjax(self.href);\r\n    evt.preventDefault();\r\n  }\r\n}\r\n\r\nexport default function ajaxifyProfileSections() {\r\n  pCC.addEventListener('click', testForSection);\r\n}\r\n","import insertHtml from './insertHtml';\r\n\r\nexport default function insertHtmlBeforeBegin(parent, html) {\r\n  insertHtml(parent, 'beforebegin', html);\r\n}\r\n","import {closestTable} from './closest';\r\nimport {createDiv} from './cElement';\r\nimport insertHtmlBeforeBegin from './insertHtmlBeforeBegin';\r\nimport insertHtmlBeforeEnd from './insertHtmlBeforeEnd';\r\n\r\nfunction cellOneHazText(curr) {\r\n  return curr.cells[1] && curr.cells[1].textContent;\r\n}\r\n\r\nfunction reduceStatTable(prev, curr, index) {\r\n  var key = curr.cells[0].textContent.trim().replace(':', '');\r\n  if (!key) {return prev;}\r\n  prev[key] = {ind: index};\r\n  if (cellOneHazText(curr)) {\r\n    prev[key].value = Number(\r\n      curr.cells[1].textContent.trim().replace('+', '')\r\n    );\r\n  }\r\n  return prev;\r\n}\r\n\r\nfunction getVal(prop, obj) {\r\n  if (obj[prop] && obj[prop].value) {\r\n    return obj[prop].value;\r\n  }\r\n  return 0;\r\n}\r\n\r\nfunction getLastIndex(obj, tbl) {\r\n  if (obj.Enhancements) {\r\n    return tbl.rows[obj.Enhancements.ind - 1];\r\n  }\r\n  return tbl.rows[tbl.rows.length - 1];\r\n}\r\n\r\nfunction addStats(el) {\r\n  var statTable = closestTable(el);\r\n  var statObj = Array.prototype.reduce.call(statTable.rows,\r\n    reduceStatTable, {});\r\n  var totalStats = getVal('Attack', statObj) + getVal('Defense', statObj) +\r\n    getVal('Armor', statObj) + getVal('Damage', statObj) +\r\n    getVal('HP', statObj);\r\n  insertHtmlBeforeBegin(getLastIndex(statObj, statTable),\r\n    '<tr class=\"fshDodgerBlue\"><td>Stat Total:</td><td align=\"right\">' +\r\n    totalStats + '&nbsp;</td></tr>');\r\n}\r\n\r\nfunction fshDataFilter(data) {\r\n  var container = createDiv();\r\n  insertHtmlBeforeEnd(container, data);\r\n  var bonus = container.getElementsByTagName('font');\r\n  bonus = Array.prototype.filter.call(bonus, function(el) {\r\n    return el.textContent === 'Bonuses';\r\n  });\r\n  bonus.forEach(addStats);\r\n  return container.innerHTML;\r\n}\r\n\r\nfunction fshPreFilter(options) {\r\n  if (options.url.indexOf('fetchitem') !== 0) {return;}\r\n  options.dataFilter = fshDataFilter;\r\n}\r\n\r\nexport default function addStatTotalToMouseover() { // jQuery\r\n  $.ajaxPrefilter(fshPreFilter);\r\n}\r\n","import {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport jConfirm from '../common/jConfirm';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport {sendEvent} from '../support/fshGa';\r\n\r\nvar disableDeactivatePrompts = getValue('disableDeactivatePrompts');\r\n\r\nfunction debuff(buffId) {\r\n  return retryAjax({\r\n    url: 'fetchdata.php',\r\n    data: {\r\n      a: '22',\r\n      d: '0',\r\n      id: buffId\r\n    },\r\n    dataType: 'json'\r\n  });\r\n}\r\n\r\nfunction doDebuff(aLink) { // jQuery\r\n  sendEvent('profile', 'doDebuff');\r\n  var buffId = aLink.href.match(/(\\d+)$/)[1];\r\n  debuff(buffId)\r\n    .done(function(data) {\r\n      if (data.response.response === 0) {\r\n        aLink.parentNode.innerHTML = '';\r\n      } else {\r\n        $('#dialog_msg').html(data.response.msg).dialog('open');\r\n      }\r\n    });\r\n}\r\n\r\nfunction doPrompt(aLink) {\r\n  var onclick = aLink.getAttribute('onclick');\r\n  var warn = onclick\r\n    .match(/Are you sure you wish to remove the .* skill\\?/)[0];\r\n  jConfirm('Remove Skill', warn, function() {\r\n    doDebuff(aLink);\r\n  });\r\n}\r\n\r\nfunction checkForPrompt(aLink) {\r\n  if (!disableDeactivatePrompts) {\r\n    doPrompt(aLink);\r\n  } else {\r\n    doDebuff(aLink);\r\n  }\r\n}\r\n\r\nfunction interceptDebuff(e) { // jQuery\r\n  var aLink = e.target;\r\n  if (aLink.tagName === 'IMG') {\r\n    $(e.target).qtip('hide');\r\n    aLink = aLink.parentNode;\r\n  } else if (aLink.tagName !== 'A') {return;}\r\n  e.stopPropagation();\r\n  e.preventDefault();\r\n  checkForPrompt(aLink);\r\n}\r\n\r\nexport default function fastDebuff() {\r\n  var profileRightColumn = getElementById('profileRightColumn')\r\n    .lastElementChild;\r\n  profileRightColumn.addEventListener('click', interceptDebuff, true);\r\n}\r\n","import {getElementById} from '../common/getElement';\r\nimport insertElement from '../common/insertElement';\r\nimport insertTextBeforeEnd from '../common/insertTextBeforeEnd';\r\nimport {sendEvent} from '../support/fshGa';\r\nimport unequipitem from '../app/profile/unequipitem';\r\nimport {createButton, createDiv} from '../common/cElement';\r\n\r\nvar profileCombatSetDiv;\r\n\r\nfunction removeItem(link) {\r\n  function clearBox(json) {\r\n    if (json.s) {\r\n      link.parentNode.innerHTML = '';\r\n    }\r\n  }\r\n  var item = /inventory_id=(\\d+)/.exec(link.href)[1];\r\n  if (item) {\r\n    unequipitem(item).done(clearBox);\r\n  }\r\n}\r\n\r\nfunction getNekid() {\r\n  sendEvent('profile', 'nekidBtn');\r\n  var profileBlock = profileCombatSetDiv.nextElementSibling;\r\n  var aLinks = profileBlock.getElementsByTagName('a');\r\n  Array.prototype.forEach.call(aLinks, removeItem);\r\n}\r\n\r\nexport default function nekidBtn() {\r\n  var profileRightColumn = getElementById('profileRightColumn');\r\n  profileCombatSetDiv = getElementById('profileCombatSetDiv');\r\n  var targetBr = profileCombatSetDiv.parentNode.nextElementSibling;\r\n  var nekidDiv = createDiv({className: 'fshCenter'});\r\n  var theBtn = createButton({\r\n    className: 'fshBl fshBls',\r\n    textContent: 'Nekid'\r\n  });\r\n  insertTextBeforeEnd(nekidDiv, '[ ');\r\n  insertElement(nekidDiv, theBtn);\r\n  insertTextBeforeEnd(nekidDiv, ' ]');\r\n  profileRightColumn.replaceChild(nekidDiv, targetBr);\r\n  theBtn.addEventListener('click', getNekid);\r\n}\r\n\r\n","import createDocument from '../system/createDocument';\r\nimport eventHandler from '../common/eventHandler';\r\nimport {getElementById} from '../common/getElement';\r\nimport {imageServer} from '../system/system';\r\nimport infoBox from '../common/infoBox';\r\nimport insertElement from '../common/insertElement';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\nimport insertQuickExtract from '../quickExtract';\r\nimport insertTextBeforeEnd from '../common/insertTextBeforeEnd';\r\nimport jQueryDialog from '../chrome/jQueryDialog';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport {sendEvent} from '../support/fshGa';\r\nimport {\r\n  createDiv,\r\n  createSpan,\r\n  createTBody,\r\n  createTable\r\n} from '../common/cElement';\r\n\r\nvar quickDelDiv;\r\nvar sumComp;\r\nvar delAllDiv;\r\nvar compDel;\r\nvar compSum;\r\nvar compDelAll;\r\nvar qe;\r\nvar thisInvTable;\r\nvar componentList = {};\r\nvar usedCount;\r\nvar usedCountDom;\r\nvar totalCount;\r\nvar pageCount;\r\n\r\nfunction getInvTables(doc) {\r\n  return getElementById('profileRightColumn', doc)\r\n    .getElementsByClassName('inventory-table');\r\n}\r\n\r\nfunction tallyComponent(visible, el) {\r\n  var mouseover = el.dataset.tipped;\r\n  var id = mouseover.match(/fetchitem.php\\?item_id=(\\d+)/)[1];\r\n  componentList[id] = componentList[id] || {\r\n    count: 0,\r\n    src: el.getAttribute('src'),\r\n    onmouseover: mouseover,\r\n    del: [],\r\n    dom: []\r\n  };\r\n  componentList[id].count += 1;\r\n  componentList[id].del.push(el.parentNode.href);\r\n  if (visible) {componentList[id].dom.push(el.parentNode.parentNode);}\r\n  usedCount += 1;\r\n}\r\n\r\nfunction retriveComponent(doc) {\r\n  var visible = doc === document;\r\n  var invTbl = getInvTables(doc)[1];\r\n  var nodeList = invTbl.getElementsByTagName('IMG');\r\n  Array.prototype.forEach.call(nodeList, tallyComponent.bind(null, visible));\r\n  totalCount += invTbl.querySelectorAll(\r\n    'td[background$=\"inventory/1x1mini.gif\"]').length;\r\n}\r\n\r\nfunction tallyTableRow(prev, id) {\r\n  var comp = componentList[id];\r\n  return prev + '<tr><td><img src=\"' + comp.src +\r\n    '\" class=\"fshTblCenter tip-dynamic\" data-tipped=\"' + comp.onmouseover +\r\n    '\"></td><td>' + comp.count + '</td>' +\r\n    '<td>[<span class=\"sendLink compDelType\" data-compid=\"' + id +\r\n    '\">Del</span>]</td></tr>';\r\n}\r\n\r\nfunction displayComponentTally() {\r\n  var tbl = createTable({className: 'fshTblCenter'});\r\n  var tBody = createTBody();\r\n  insertElement(tbl, tBody);\r\n  insertHtmlBeforeEnd(tBody,\r\n    '<tr><td colspan=\"3\">Component Summary</td></tr>' +\r\n    Object.keys(componentList).reduce(tallyTableRow, ''));\r\n  var totRow = tbl.insertRow(-1);\r\n  insertHtmlBeforeEnd(totRow, '<td>Total:</td>');\r\n  var totCell = totRow.insertCell(-1);\r\n  totCell.colSpan = 2;\r\n  usedCountDom = createSpan();\r\n  usedCountDom.innerHTML = usedCount.toString();\r\n  insertElement(totCell, usedCountDom);\r\n  insertTextBeforeEnd(totCell, ' / ' + totalCount.toString());\r\n  sumComp.innerHTML = '';\r\n  insertElement(sumComp, tbl);\r\n}\r\n\r\nfunction gotComponentsPage(data) {\r\n  pageCount += 1;\r\n  insertHtmlBeforeEnd(sumComp, pageCount + ', ');\r\n  retriveComponent(createDocument(data));\r\n}\r\n\r\nfunction initCounters() {\r\n  usedCount = 0;\r\n  totalCount = 0;\r\n  pageCount = 1;\r\n}\r\n\r\nfunction getPageLinks() {\r\n  var pager = thisInvTable.nextElementSibling;\r\n  return pager.rows[1].children[0].children;\r\n}\r\n\r\nfunction countComponent(self) { // jQuery.min\r\n  sendEvent('components', 'countComponent');\r\n  self.parentNode.innerHTML = 'Retrieve page: 1, ';\r\n  initCounters();\r\n  var prm = [$.when(document).done(retriveComponent)];\r\n  Array.prototype.forEach.call(getPageLinks(), function(el) {\r\n    if (el.children.length === 0) {\r\n      prm.push(retryAjax(el.href).done(gotComponentsPage));\r\n    }\r\n  });\r\n  $.when.apply($, prm).done(displayComponentTally);\r\n}\r\n\r\nfunction delAllComponent() {\r\n  sendEvent('components', 'delAllComponent');\r\n  var nodeList = thisInvTable.getElementsByClassName('compDelBtn');\r\n  Array.prototype.forEach.call(nodeList, function(el) {\r\n    el.click();\r\n  });\r\n}\r\n\r\nfunction compDeleted(self, data) {\r\n  var response = infoBox(data);\r\n  if (response === 'Component destroyed.') {\r\n    var parent = self.parentNode;\r\n    if (parent) {self.parentNode.innerHTML = '';}\r\n  } else {\r\n    $('#dialog_msg').html(response).dialog('open');\r\n  }\r\n}\r\n\r\nfunction delComponent(self) { // jQuery.min\r\n  var href = self.previousElementSibling.href;\r\n  retryAjax(href).done(compDeleted.bind(null, self));\r\n}\r\n\r\nfunction addDelBtn(el) {\r\n  insertHtmlBeforeEnd(el.parentNode.parentNode,\r\n    '<span class=\"compDelBtn\">Del</span>');\r\n}\r\n\r\nfunction enableDelComponent() {\r\n  sendEvent('components', 'enableDelComponent');\r\n  quickDelDiv.classList.add('fshHide');\r\n  delAllDiv.classList.remove('fshHide');\r\n  var nodeList = thisInvTable.getElementsByTagName('IMG');\r\n  Array.prototype.forEach.call(nodeList, addDelBtn);\r\n}\r\n\r\nfunction updateUsedCount() {\r\n  usedCount -= 1;\r\n  usedCountDom.textContent = usedCount.toString();\r\n}\r\n\r\nfunction delCompType(self) { // jQuery.min\r\n  var id = self.dataset.compid;\r\n  var td = self.parentNode;\r\n  td.innerHTML = '';\r\n  td.className = 'guildTagSpinner';\r\n  td.style.backgroundImage = 'url(\\'' + imageServer +\r\n    '/skin/loading.gif\\')';\r\n  var prm = [];\r\n  componentList[id].del.forEach(function(href) {\r\n    prm.push(retryAjax(href).done(updateUsedCount));\r\n  });\r\n  $.when.apply($, prm).done(function() {\r\n    componentList[id].dom.forEach(function(el) {el.innerHTML = '';});\r\n    td.parentNode.remove();\r\n  });\r\n}\r\n\r\nvar evtHdl = [\r\n  {\r\n    test: function(self) {return self === compDel;},\r\n    act: enableDelComponent\r\n  },\r\n  {\r\n    test: function(self) {return self === compSum;},\r\n    act: countComponent\r\n  },\r\n  {\r\n    test: function(self) {return self === compDelAll;},\r\n    act: delAllComponent\r\n  },\r\n  {\r\n    test: function(self) {return self === qe;},\r\n    act: function() {\r\n      sendEvent('components', 'insertQuickExtract');\r\n      jQueryDialog(insertQuickExtract);\r\n    }\r\n  },\r\n  {\r\n    test: function(self) {return self.classList.contains('compDelBtn');},\r\n    act: delComponent\r\n  },\r\n  {\r\n    test: function(self) {return self.classList.contains('compDelType');},\r\n    act: delCompType\r\n  }\r\n];\r\n\r\nfunction decorateButton(parentDiv, label) {\r\n  var innerSpan = createSpan(\r\n    {className: 'sendLink', textContent: label});\r\n  parentDiv.textContent = '[';\r\n  insertElement(parentDiv, innerSpan);\r\n  insertHtmlBeforeEnd(parentDiv, ']');\r\n  return innerSpan;\r\n}\r\n\r\nexport default function profileComponents() {\r\n  var invTables = getInvTables(document);\r\n  if (invTables.length !== 2) {return;}\r\n  thisInvTable = invTables[1];\r\n  var compDiv = thisInvTable.parentNode;\r\n  var cmDiv = createDiv({className: 'fshCenter'});\r\n  quickDelDiv = createDiv();\r\n  sumComp = createDiv();\r\n  delAllDiv = createDiv({className: 'fshHide'});\r\n  var qeDiv = createDiv();\r\n  compDel = decorateButton(quickDelDiv, 'Enable Quick Del');\r\n  compSum = decorateButton(sumComp, 'Count Components');\r\n  compDelAll = decorateButton(delAllDiv, 'Delete All Visible');\r\n  qe = decorateButton(qeDiv, 'Quick Extract Components');\r\n  insertElement(cmDiv, quickDelDiv);\r\n  insertElement(cmDiv, sumComp);\r\n  insertElement(cmDiv, qeDiv);\r\n  insertElement(cmDiv, delAllDiv);\r\n  insertElement(compDiv, cmDiv);\r\n  compDiv.addEventListener('click', eventHandler(evtHdl));\r\n}\r\n","import add from '../support/task';\r\nimport {createDiv} from '../common/cElement';\r\nimport equipItem from '../ajax/equipItem';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport insertElement from '../common/insertElement';\r\nimport {sendEvent} from '../support/fshGa';\r\nimport useItem from '../ajax/useItem';\r\n\r\nfunction restyleBackpack() {\r\n  var bpBack = getElementById('backpack');\r\n  bpBack.className = 'fshBackpack';\r\n  bpBack.removeAttribute('style');\r\n}\r\n\r\nfunction backpackRemove(theBackpack, invId) { // jQuery.min\r\n  var _invId = Number(invId);\r\n  // remove from srcData\r\n  var i = theBackpack.srcData.findIndex(function(el) {return el.a === _invId;});\r\n  if (i !== -1) {theBackpack.srcData.splice(i, 1);}\r\n}\r\n\r\nfunction fastAction(theBackpack, evt, action, result) { // jQuery.min\r\n  sendEvent('profile', 'fastAction');\r\n  var self = evt.target;\r\n  var invId = self.parentNode.parentNode.firstElementChild.dataset.inv;\r\n  self.textContent = '';\r\n  self.className = 'fastAction fshSpinner fshSpinner12';\r\n  action(invId).done(function(data) {\r\n    if (data.r !== 0) {\r\n      self.remove();\r\n      return;\r\n    }\r\n    backpackRemove(theBackpack, invId);\r\n    self.classList.remove('fshSpinner');\r\n    self.parentNode.innerHTML = '<span class=\"fastWorn\">' + result + '</span>';\r\n  });\r\n}\r\n\r\nfunction evtHdl(theBackpack, evt) {\r\n  if (evt.target.classList.contains('fastWear')) {\r\n    fastAction(theBackpack, evt, equipItem, 'Worn');\r\n  }\r\n  if (evt.target.classList.contains('fastUse')) {\r\n    fastAction(theBackpack, evt, useItem, 'Used');\r\n  }\r\n}\r\n\r\nfunction actionClass(usable) {\r\n  if (usable) {return 'fastUse';}\r\n  return 'fastWear';\r\n}\r\n\r\nfunction actionText(usable) {\r\n  if (usable) {return 'Use';}\r\n  return 'Wear';\r\n}\r\n\r\nfunction drawButtons(self, theSpan) {\r\n  var toUse = theSpan.classList.contains('backpackContextMenuUsable');\r\n  var myDiv = createDiv({\r\n    className: 'fastDiv',\r\n    innerHTML: '<span class=\"sendLink fastAction ' + actionClass(toUse) + '\">' +\r\n      actionText(toUse) + '</span>'\r\n  });\r\n  if (self.options.checkboxesEnabled) {\r\n    insertElement(myDiv,\r\n      theSpan.parentNode.nextElementSibling.nextElementSibling);\r\n  }\r\n  insertElement(theSpan.parentNode.parentNode, myDiv);\r\n}\r\n\r\nfunction fastWearLinks(self) {\r\n  var items = document.querySelectorAll(\r\n    '#backpackTab_' + self.type.toString() +\r\n    ' .backpackContextMenuEquippable,.backpackContextMenuUsable');\r\n  if (items.length === 0) {return;}\r\n  Array.prototype.forEach.call(items, drawButtons.bind(null, self));\r\n}\r\n\r\nfunction foundBackpack(backpackContainer, theBackpack) {\r\n  var oldShow = theBackpack._showPage;\r\n  theBackpack._showPage = function(type, page) {\r\n    if (!this.tabData) {return;}\r\n    oldShow.call(this, type, page);\r\n    fastWearLinks(this);\r\n  };\r\n  if (getElementById('backpack_current').textContent.length !== 0) {\r\n    add(3, fastWearLinks, [theBackpack]);\r\n  }\r\n  backpackContainer.addEventListener('click', evtHdl.bind(null, theBackpack));\r\n}\r\n\r\nfunction initialiseFastWear() {\r\n  var backpackContainer = getElementById('backpackContainer');\r\n  var theBackpack = $(backpackContainer).data('backpack');\r\n  if (theBackpack) {foundBackpack(backpackContainer, theBackpack);}\r\n}\r\n\r\nexport default function injectFastWear() { // jQuery\r\n  if (!getValue('enableQuickDrink')) {return;}\r\n  restyleBackpack();\r\n  initialiseFastWear();\r\n}\r\n","import callApp from '../callApp';\r\n\r\nexport default function unequipitem(item) {\r\n  return callApp({\r\n    cmd: 'profile',\r\n    subcmd: 'unequipitem',\r\n    inventory_id: item\r\n  });\r\n}\r\n","import currentGuildId from '../common/currentGuildId';\r\nimport getValue from '../system/getValue';\r\nimport {imageServer} from '../system/system';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\nimport setValue from '../system/setValue';\r\n\r\nvar guildId;\r\nvar currentGuildRelationship;\r\nvar guildMessages = {\r\n  self: {color: 'fshGreen', message: getValue('guildSelfMessage')},\r\n  friendly: {color: 'fshOliveDrab', message: getValue('guildFrndMessage')},\r\n  old: {color: 'fshDarkCyan', message: getValue('guildPastMessage')},\r\n  enemy: {color: 'fshRed', message: getValue('guildEnmyMessage')}\r\n};\r\n\r\nexport function showRecallButton(playername) {\r\n  if (currentGuildRelationship === 'self') {\r\n    return '<a class=\"quickButton tip-static\" ' +\r\n      'href=\"index.php?cmd=guild&subcmd=inventory&subcmd2=report&user=' +\r\n      playername + '\" data-tipped=\"Recall items from ' + playername +\r\n      '\" style=\"background-image: url(\\'' + imageServer +\r\n      '/temple/3.gif\\');\"></a>&nbsp;&nbsp;';\r\n  }\r\n  return '';\r\n}\r\n\r\nexport function showRankButton(playerid, playername) {\r\n  if (currentGuildRelationship === 'self' && getValue('showAdmin')) {\r\n    return '<a class=\"quickButton buttonGuildRank tip-static\" href=\"' +\r\n      'index.php?cmd=guild&subcmd=members&subcmd2=changerank&member_id=' +\r\n      playerid + '\" data-tipped=\"Rank ' + playername +\r\n      '\" style=\"background-image: url(\\'' + imageServer +\r\n      '/guilds/' + guildId + '_mini.jpg\\');\"></a>&nbsp;&nbsp;';\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction guildAry(val) {\r\n  if (val) {\r\n    return val.toLowerCase().replace(/\\s\\s*/g, ' ').split(/\\s*,\\s*/);\r\n  }\r\n  return [];\r\n}\r\n\r\nfunction hasRelationship(txt) {\r\n  return function(el) {return el.test.includes(txt);};\r\n}\r\n\r\nfunction externalRelationship(_txt) {\r\n  var scenario = [\r\n    {test: guildAry(getValue('guildFrnd')), type: 'friendly'},\r\n    {test: guildAry(getValue('guildPast')), type: 'old'},\r\n    {test: guildAry(getValue('guildEnmy')), type: 'enemy'}\r\n  ];\r\n  var txt = _txt.toLowerCase().replace(/\\s\\s*/g, ' ');\r\n  var relObj = scenario.find(hasRelationship(txt));\r\n  if (relObj) {return relObj.type;}\r\n}\r\n\r\nfunction thisGuildId(aLink) {\r\n  var guildIdResult = /guild_id=([0-9]+)/i.exec(aLink.href);\r\n  if (guildIdResult) {return Number(guildIdResult[1]);}\r\n}\r\n\r\nfunction guildRelationship(aLink) {\r\n  guildId = thisGuildId(aLink);\r\n  if (guildId && guildId === currentGuildId()) {\r\n    setValue('guildSelf', aLink.text);\r\n    return 'self';\r\n  }\r\n  return externalRelationship(aLink.text);\r\n}\r\n\r\nfunction foundGuildLink(aLink) {\r\n  currentGuildRelationship = guildRelationship(aLink);\r\n  if (currentGuildRelationship) {\r\n    aLink.parentNode.classList.add(\r\n      guildMessages[currentGuildRelationship].color);\r\n    insertHtmlBeforeEnd(aLink.parentNode, '<br>' +\r\n      guildMessages[currentGuildRelationship].message);\r\n  }\r\n}\r\n\r\nexport function profileInjectGuildRel(self) {\r\n  var aLink = document.querySelector(\r\n    '#pCC a[href^=\"index.php?cmd=guild&subcmd=view&guild_id=\"]');\r\n  if (aLink) {foundGuildLink(aLink);} else if (self) {\r\n    setValue('guildSelf', '');\r\n  }\r\n}\r\n","var invItems;\r\nvar type;\r\nvar itemId;\r\n\r\nfunction tickElement(o, el) {\r\n  el.checked = !el.disabled && !el.checked;\r\n}\r\n\r\nvar types = [\r\n  {\r\n    c: function() {return type === 'guild';},\r\n    r: function(o, el) {\r\n      el.checked = !el.disabled && invItems[o.invid].guild_tag !== -1;\r\n    }\r\n  },\r\n  {\r\n    c: function(o) {\r\n      return type === 'item' && invItems[o.invid].item_id === itemId;\r\n    },\r\n    r: tickElement\r\n  },\r\n  {\r\n    c: function() {return type === 'checkAll';},\r\n    r: tickElement\r\n  }\r\n];\r\n\r\nfunction testType(o, el) {\r\n  var match = types.find(function(test) {\r\n    return test.c(o);\r\n  });\r\n  if (match) {match.r(o, el);}\r\n}\r\n\r\nexport default function doCheckboxes(itemsAry, invItems_, type_, itemId_) {\r\n  invItems = invItems_;\r\n  type = type_;\r\n  itemId = Number(itemId_);\r\n  itemsAry.forEach(function(o) {\r\n    var tr = o.injectHere.parentNode;\r\n    if (tr.classList.contains('fshHide')) {return;}\r\n    var el = o.el.parentNode.parentNode.previousElementSibling\r\n      .firstElementChild;\r\n    testType(o, el);\r\n  });\r\n}\r\n","import getValue from '../system/getValue';\r\nimport {imageServer} from '../system/system';\r\nimport insertHtmlAfterEnd from '../common/insertHtmlAfterEnd';\r\nimport quickBuffHref from '../common/quickBuffHref';\r\nimport {showRankButton, showRecallButton} from './profileInjectGuildRel';\r\n\r\nexport default function profileInjectQuickButton(avyImg, playerid, playername) {\r\n  var newhtml = '<div align=\"center\">';\r\n  newhtml += '<a class=\"quickButton buttonQuickBuff tip-static\" ' +\r\n    quickBuffHref(playerid) + 'data-tipped=\"Buff ' + playername +\r\n    '\" style=\"background-image: url(\\'' + imageServer +\r\n    '/skin/realm/icon_action_quickbuff.gif\\');\"></a>&nbsp;&nbsp;';\r\n  if (!getValue('enableMaxGroupSizeToJoin')) {\r\n    newhtml += '<a class=\"quickButton buttonJoinAll tip-static\" ' +\r\n      'href=\"index.php?cmd=guild&subcmd=groups&subcmd2=joinall\" ' +\r\n      'data-tipped=\"Join All Groups\" style=\"background-image: url(\\'' +\r\n      imageServer +\r\n      '/skin/icon_action_join.gif\\');\"></a>&nbsp;&nbsp;';\r\n  } else {\r\n    var maxGroupSizeToJoin = getValue('maxGroupSizeToJoin');\r\n    newhtml += '<a class=\"quickButton buttonJoinUnder tip-static\" ' +\r\n      'href=\"index.php?cmd=guild&subcmd=groups&subcmd2=' +\r\n      'joinallgroupsundersize\" data-tipped=\"Join All Groups < ' +\r\n      maxGroupSizeToJoin + ' Members\" style=\"background-image: url(\\'' +\r\n      imageServer +\r\n      '/skin/icon_action_join.gif\\');\"></a>&nbsp;&nbsp;';\r\n  }\r\n  newhtml += '<a class=\"quickButton tip-static\" ' +\r\n    'href=\"index.php?cmd=auctionhouse&type=-3&tid=' + playerid +\r\n    '\" data-tipped=\"Go to ' + playername +\r\n    '\\'s auctions\" style=\"background-image: url(\\'' +\r\n    imageServer + '/skin/gold_button.gif\\');\"></a>&nbsp;&nbsp;';\r\n  newhtml += '<a class=\"quickButton tip-static\" ' +\r\n    'href=\"index.php?cmd=trade&subcmd=createsecure&target_username=' +\r\n    playername + '\" data-tipped=\"Create Secure Trade to ' + playername +\r\n    '\" style=\"background-image: url(\\'' + imageServer +\r\n    '/temple/2.gif\\');\"></a>&nbsp;&nbsp;';\r\n  newhtml += showRecallButton(playername);\r\n  newhtml += showRankButton(playerid, playername);\r\n  newhtml += '</div>';\r\n  insertHtmlAfterEnd(avyImg, newhtml);\r\n}\r\n","import getValue from '../system/getValue';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\n\r\nfunction totalAllyEnemy(target, numberOfContacts, contactsTotal) {\r\n  var _c = '';\r\n  if (contactsTotal && contactsTotal >= numberOfContacts) {\r\n    _c = '/' + contactsTotal;\r\n  }\r\n  insertHtmlBeforeEnd(target, '<span class=\"fshBlue\">&nbsp;' +\r\n    numberOfContacts + _c + '</span>');\r\n}\r\n\r\nfunction countContacts(el, isAllies) {\r\n  var target = el.parentNode;\r\n  var numberOfContacts = target.nextSibling.nextSibling\r\n    .getElementsByTagName('table').length - 1;\r\n  if (isAllies) {\r\n    totalAllyEnemy(target, numberOfContacts, getValue('alliestotal'));\r\n  } else {\r\n    totalAllyEnemy(target, numberOfContacts, getValue('enemiestotal'));\r\n  }\r\n}\r\n\r\nfunction findAllyEnemy(el) {\r\n  var isAllies = el.textContent === 'Allies';\r\n  var isEnemies = el.textContent === 'Enemies';\r\n  if (isAllies || isEnemies) {\r\n    countContacts(el, isAllies);\r\n  }\r\n}\r\n\r\nexport default function profileParseAllyEnemy() {\r\n  // Allies/Enemies count/total function\r\n  Array.prototype.forEach.call(\r\n    document.querySelectorAll('#profileLeftColumn strong'), findAllyEnemy);\r\n}\r\n","import bioEvtHdl from './bioEvtHdl';\r\nimport {getElementById} from '../../common/getElement';\r\nimport getValue from '../../system/getValue';\r\nimport renderBio from './render';\r\n\r\nfunction expandBio() {\r\n  var bioExpander = getElementById('fshBioExpander');\r\n  if (bioExpander.textContent === 'More ...') {\r\n    bioExpander.textContent = 'Less ...';\r\n  } else {\r\n    bioExpander.textContent = 'More ...';\r\n  }\r\n  getElementById('fshBioHidden').classList.toggle('fshHide');\r\n}\r\n\r\nfunction foundMatchingTags(closeTagIndex, openTagIndex) {\r\n  return closeTagIndex !== -1 &&\r\n    (openTagIndex > closeTagIndex || openTagIndex === -1);\r\n}\r\n\r\nfunction doCompression(bioCell, bioContents, maxCharactersToShow) {\r\n  // find the end of next HTML tag after the max characters to show.\r\n  var breakPoint = bioContents.indexOf('<br>', maxCharactersToShow) + 4;\r\n  var lineBreak = '';\r\n  if (breakPoint === 3) {\r\n    breakPoint = bioContents.indexOf(' ', maxCharactersToShow) + 1;\r\n    if (breakPoint === 0) {return;}\r\n    lineBreak = '<br>';\r\n  }\r\n  var bioStart = bioContents.substring(0, breakPoint);\r\n  var bioEnd = bioContents.substring(breakPoint, bioContents.length);\r\n  var extraOpenHTML = '';\r\n  var extraCloseHTML = '';\r\n  var tagList = ['b', 'i', 'u', 'span'];\r\n  tagList.forEach(function(tag) {\r\n    var closeTagIndex = bioEnd.indexOf('</' + tag + '>');\r\n    var openTagIndex = bioEnd.indexOf('<' + tag + '>');\r\n    if (foundMatchingTags(closeTagIndex, openTagIndex)) {\r\n      extraOpenHTML += '<' + tag + '>';\r\n      extraCloseHTML += '</' + tag + '>';\r\n    }\r\n  });\r\n  bioCell.innerHTML = bioStart + extraCloseHTML + lineBreak +\r\n    '<span id=\"fshBioExpander\" class=\"sendLink\">More ...</span><br>' +\r\n    '<span class=\"fshHide\" id=\"fshBioHidden\">' + extraOpenHTML + bioEnd +\r\n    '</span>';\r\n  getElementById('fshBioExpander')\r\n    .addEventListener('click', expandBio);\r\n}\r\n\r\nfunction findStartPosition(bioContents, _maxRowsToShow) {\r\n  var maxRowsToShow = _maxRowsToShow;\r\n  var startIndex = 0;\r\n  while (maxRowsToShow > 0) {\r\n    maxRowsToShow -= 1;\r\n    startIndex = bioContents.indexOf('<br>\\n', startIndex + 1);\r\n  }\r\n  return startIndex;\r\n}\r\n\r\nfunction bioIsTooSmall(bio, maxChar, lines, maxRows) {\r\n  return bio.length <= maxChar && lines < maxRows;\r\n}\r\n\r\nfunction compressBio(bioCell) {\r\n  var bioContents = bioCell.innerHTML;\r\n  var maxCharactersToShow = getValue('maxCompressedCharacters');\r\n  var maxRowsToShow = getValue('maxCompressedLines');\r\n  var numberOfLines = bioContents.substr(0, maxCharactersToShow)\r\n    .split(/<br>\\n/).length - 1;\r\n  if (bioIsTooSmall(bioContents, maxCharactersToShow, numberOfLines,\r\n    maxRowsToShow)) {return;}\r\n  if (numberOfLines >= maxRowsToShow) {\r\n    maxCharactersToShow = findStartPosition(bioContents, maxRowsToShow);\r\n  }\r\n  doCompression(bioCell, bioContents, maxCharactersToShow);\r\n}\r\n\r\nfunction doRender(bioCell) {\r\n  var bioContents = bioCell.innerHTML;\r\n  bioContents = renderBio(bioContents);\r\n  if (bioContents) {\r\n    bioCell.innerHTML = bioContents;\r\n  }\r\n}\r\n\r\nfunction selfRender(self) {\r\n  return self && getValue('renderSelfBio');\r\n}\r\n\r\nfunction otherRender(self) {\r\n  return !self && getValue('renderOtherBios');\r\n}\r\n\r\nfunction shouldRender(self) {\r\n  return selfRender(self) || otherRender(self);\r\n}\r\n\r\nfunction testForRender(self, bioCell) {\r\n  if (shouldRender(self)) {\r\n    doRender(bioCell);\r\n  }\r\n}\r\n\r\nexport default function profileRenderBio(self) {\r\n  var bioCell = getElementById('profile-bio');\r\n  if (!bioCell) {return;}\r\n  testForRender(self, bioCell);\r\n  if (getValue('enableBioCompressor')) {compressBio(bioCell);}\r\n  bioCell.addEventListener('click', bioEvtHdl);\r\n}\r\n","import {createSpan} from '../common/cElement';\r\nimport {getElementById} from '../common/getElement';\r\nimport insertElement from '../common/insertElement';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\n\r\nfunction profileSelectAll() {\r\n  var bpTabs = getElementById('backpack_tabs');\r\n  var type = bpTabs.getElementsByClassName('tab-selected')[0]\r\n    .getAttribute('data-type');\r\n  var items = document.querySelectorAll('#backpackTab_' + type +\r\n    ' li:not(.hcsPaginate_hidden) .backpackItem');\r\n  if (items.length === 0) {return;}\r\n  var checkboxes = document.querySelectorAll('#backpackTab_' + type +\r\n    ' li:not(.hcsPaginate_hidden) .backpackCheckbox:not(:disabled)');\r\n  if (checkboxes.length > 0) {items = checkboxes;}\r\n  Array.prototype.forEach.call(items, function(el) {el.click();});\r\n}\r\n\r\nexport default function selectAllLink() {\r\n  // select all link\r\n  var node = document.querySelector('#profileRightColumn' +\r\n    ' a[href=\"index.php?cmd=profile&subcmd=dropitems\"]');\r\n  if (!node) {return;}\r\n  var allSpan = createSpan({className: 'smallLink', textContent: 'All'});\r\n  allSpan.addEventListener('click', profileSelectAll);\r\n  var wrapper = createSpan({innerHTML: '[&nbsp;'});\r\n  insertElement(wrapper, allSpan);\r\n  insertHtmlBeforeEnd(wrapper, '&nbsp;]&nbsp;');\r\n  insertElement(node.parentNode, wrapper);\r\n}\r\n","import {getElementById} from '../common/getElement';\r\n\r\nfunction gotAtk(nmvImg, atkStat) {\r\n  var defStat = Number(\r\n    getElementById('stat-defense').firstChild.textContent.trim());\r\n  var oldTipped = nmvImg.dataset.tipped;\r\n  var lvlAry = /\\(Level: (\\d+)\\)/.exec(oldTipped);\r\n  var nmvLvl = Number(lvlAry[1]);\r\n  var nmvEffect = Math.floor(atkStat * nmvLvl * 0.0025);\r\n  nmvImg.dataset.tipped = oldTipped.slice(0, -15) +\r\n    '<br>Attack: ' + (atkStat - nmvEffect).toString() +\r\n    '&nbsp;&nbsp;Defense: ' + (defStat + nmvEffect).toString() +\r\n    '</center></div>';\r\n}\r\n\r\nfunction gotImg(nmvImg) {\r\n  var atkEl = getElementById('stat-attack');\r\n  if (!atkEl) {return;}\r\n  var atkStat = Number(atkEl.firstChild.textContent.trim());\r\n  if (!isNaN(atkStat)) {gotAtk(nmvImg, atkStat);}\r\n}\r\n\r\nexport default function updateNmv() {\r\n  var nmvImg = document.querySelector(\r\n    '#profileRightColumn img[src$=\"/60_sm.gif\"]');\r\n  if (nmvImg) {gotImg(nmvImg);}\r\n}\r\n","import {getElementById} from '../common/getElement';\r\n\r\nfunction removeStatTable(el) {\r\n  var tde = el.getElementsByTagName('td');\r\n  el.parentNode.innerHTML = tde[0].innerHTML.replace(/&nbsp;/g, ' ') +\r\n    '<div class=\"profile-stat-bonus\">' + tde[1].textContent + '</div>';\r\n}\r\n\r\nexport default function updateStatistics() {\r\n  var charStats = getElementById('profileLeftColumn')\r\n    .getElementsByTagName('table')[0];\r\n  var dodgyTables = charStats.getElementsByTagName('table');\r\n  Array.prototype.forEach.call(dodgyTables, removeStatTable);\r\n}\r\n","import add from '../support/task';\r\nimport addStatTotalToMouseover from '../common/addStatTotalToMouseover';\r\nimport ajaxifyProfileSections from './ajaxifyProfileSections';\r\nimport {colouredDots} from '../common/colouredDots';\r\nimport fallback from '../system/fallback';\r\nimport fastDebuff from './debuff';\r\nimport getUrlParameter from '../system/getUrlParameter';\r\nimport highlightPvpProtection from './highlightPvpProtection';\r\nimport injectFastWear from './fastWear';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport nekidBtn from './nekidBtn';\r\nimport {pCC} from '../support/layout';\r\nimport playerId from '../common/playerId';\r\nimport playerName from '../common/playerName';\r\nimport profileComponents from './components';\r\nimport {profileInjectGuildRel} from './profileInjectGuildRel';\r\nimport profileInjectQuickButton from './profileInjectQuickButton';\r\nimport profileParseAllyEnemy from './profileAllyEnemy';\r\nimport profileRenderBio from './bio/bio';\r\nimport quickWearLink from './quickWearLink';\r\nimport selectAllLink from './selectAllLink';\r\nimport storeVL from './storeVL';\r\nimport updateNmv from './updateNmv';\r\nimport updateStatistics from './updateStatistics';\r\n\r\nfunction ifSelf(self) {\r\n  if (self) {\r\n    // self inventory\r\n    fastDebuff();\r\n    profileParseAllyEnemy();\r\n    injectFastWear();\r\n    profileComponents();\r\n    quickWearLink();\r\n    selectAllLink();\r\n    storeVL();\r\n    nekidBtn();\r\n    ajaxifyProfileSections();\r\n  }\r\n}\r\n\r\nfunction yuuzhan(playername, avyImg) {\r\n  if (playername === 'yuuzhan') {\r\n    avyImg.src = 'http://evolutions.yvong.com/images/tumbler.gif';\r\n    avyImg.addEventListener('click', function() {\r\n      $('#dialog_msg').text('Winner!').dialog('open');\r\n    });\r\n  }\r\n}\r\n\r\nexport default function injectProfile() { // Legacy\r\n  if (jQueryNotPresent()) {return;}\r\n  var avyImg = document\r\n    .querySelector('#profileLeftColumn img[oldtitle*=\"\\'s Avatar\"]');\r\n  if (!avyImg) {return;}\r\n  var playername = pCC.getElementsByTagName('h1')[0].textContent;\r\n  var self = playername === playerName();\r\n  ifSelf(self);\r\n  // Must be before profileInjectQuickButton\r\n  profileInjectGuildRel(self);\r\n  // It sets up guildId and currentGuildRelationship\r\n  var playerid = fallback(getUrlParameter('player_id'), playerId());\r\n  profileInjectQuickButton(avyImg, playerid, playername);\r\n\r\n  //* ************* yuuzhan having fun\r\n  yuuzhan(playername, avyImg);\r\n  //* *************\r\n\r\n  updateNmv();\r\n  updateStatistics();\r\n  //#if _DEV  //  highlightPvpProtection\r\n  highlightPvpProtection();\r\n  //#endif\r\n  profileRenderBio(self);\r\n  addStatTotalToMouseover();\r\n  add(3, colouredDots);\r\n}\r\n","import {getElementById} from '../common/getElement';\r\nimport intValue from '../system/intValue';\r\nimport setValue from '../system/setValue';\r\n\r\nexport default function storeVL() {\r\n  // store the VL of the player\r\n  var virtualLevel = parseInt(getElementById('stat-vl').textContent, 10);\r\n  if (intValue(document.getElementsByClassName('stat-level')[0]\r\n    .nextElementSibling.textContent) === virtualLevel) {\r\n    setValue('characterVirtualLevel', ''); // ?\r\n  } else {\r\n    setValue('characterVirtualLevel', virtualLevel);\r\n  }\r\n}\r\n","import {createSpan} from '../common/cElement';\r\nimport insertElement from '../common/insertElement';\r\nimport insertQuickWear from '../quickWear/quickWear';\r\nimport insertTextBeforeEnd from '../common/insertTextBeforeEnd';\r\nimport jQueryDialog from '../chrome/jQueryDialog';\r\nimport {sendEvent} from '../support/fshGa';\r\n\r\nexport default function quickWearLink() {\r\n  // quick wear manager link\r\n  var node = document.querySelector('#profileRightColumn ' +\r\n    'a[href=\"index.php?cmd=profile&subcmd=togglesection&section_id=2\"]');\r\n  if (!node) {return;}\r\n  var wrap = createSpan({innerHTML: '&nbsp;['});\r\n  var qw = createSpan({className: 'sendLink', innerHTML: 'Quick&nbsp;Wear'});\r\n  insertElement(wrap, qw);\r\n  insertTextBeforeEnd(wrap, ']');\r\n  insertElement(node.parentNode, wrap);\r\n  qw.addEventListener('click', function() {\r\n    sendEvent('profile', 'insertQuickWear');\r\n    jQueryDialog(insertQuickWear);\r\n  });\r\n}\r\n","import calf from '../support/calf';\r\nimport {pCC} from '../support/layout';\r\n\r\nvar insertHere;\r\n\r\nfunction setInsertHere() {\r\n  if (!insertHere) {\r\n    var cltn = pCC.getElementsByTagName('form');\r\n    if (cltn.length > 0) {\r\n      insertHere = cltn[0].previousElementSibling.firstElementChild;\r\n    }\r\n  }\r\n}\r\n\r\nfunction showHideLabel(pref) {\r\n  if (pref) {return 'Hide';}\r\n  return 'Show';\r\n}\r\n\r\nexport default function doToggleButtons(showExtraLinks, showQuickDropLinks) {\r\n  // Option toggle buttons for both screens\r\n  setInsertHere();\r\n  if (insertHere) {\r\n    var inject = '[<span id=\"fshShowExtraLinks\" class=\"sendLink\">' +\r\n      showHideLabel(showExtraLinks) + ' AH and UFSG links</span>]&nbsp;' +\r\n      '[<span id=\"fshShowQuickDropLinks\" class=\"sendLink\">' +\r\n      showHideLabel(showQuickDropLinks) + ' Quick Drop links</span>]&nbsp;';\r\n    if (calf.subcmd2 === 'storeitems') {\r\n      inject += '[<span id=\"fshSelectAllGuildLocked\" class=\"sendLink\">' +\r\n        ' Select All Guild Locked</span>]&nbsp;';\r\n    }\r\n    insertHere.innerHTML = inject;\r\n  }\r\n}\r\n","import getValue from '../system/getValue';\r\nimport setValue from '../system/setValue';\r\n\r\nexport var disableItemColoring;\r\nexport var showExtraLinks;\r\nexport var showQuickDropLinks;\r\nexport var showQuickSendLinks;\r\n\r\nexport function setShowExtraLinks() {\r\n  showExtraLinks = !showExtraLinks;\r\n  setValue('showExtraLinks', showExtraLinks);\r\n}\r\n\r\nexport function setShowQuickDropLinks() {\r\n  showQuickDropLinks = !showQuickDropLinks;\r\n  setValue('showQuickDropLinks', showQuickDropLinks);\r\n}\r\n\r\nexport function getPrefs() {\r\n  disableItemColoring = getValue('disableItemColoring');\r\n  showExtraLinks = getValue('showExtraLinks');\r\n  showQuickDropLinks = getValue('showQuickDropLinks');\r\n  showQuickSendLinks = getValue('showQuickSendLinks');\r\n}\r\n","import addStatTotalToMouseover from '../common/addStatTotalToMouseover';\r\nimport doToggleButtons from './doToggleButtons';\r\nimport {itemRE} from '../support/constants';\r\nimport {pCC} from '../support/layout';\r\nimport {\r\n  getPrefs,\r\n  showExtraLinks,\r\n  showQuickDropLinks\r\n} from './getPrefs';\r\n\r\nexport var itemsAry;\r\nexport var itemsHash;\r\n\r\nfunction getItemImg() {\r\n  var allTables = pCC.getElementsByTagName('table');\r\n  var lastTable = allTables[allTables.length - 1];\r\n  return lastTable.getElementsByTagName('img');\r\n}\r\n\r\nexport function getItems() {\r\n  addStatTotalToMouseover();\r\n  getPrefs();\r\n  doToggleButtons(showExtraLinks, showQuickDropLinks);\r\n  // pCC.addEventListener('click', eventHandler(evts));\r\n  var imgList = getItemImg();\r\n  itemsAry = [];\r\n  itemsHash = {};\r\n  Array.prototype.forEach.call(imgList, function(el) {\r\n    var tipped = el.dataset.tipped;\r\n    if (tipped) {\r\n      var matches = tipped.match(itemRE);\r\n      itemsHash[matches[1]] = (itemsHash[matches[1]] || 0) + 1;\r\n      var injectHere = el.parentNode.parentNode.nextElementSibling;\r\n      itemsAry.push({\r\n        el: el,\r\n        invid: matches[2],\r\n        injectHere: injectHere\r\n      });\r\n    }\r\n  });\r\n  // Exclude composed pots\r\n  itemsHash[13699] = 1;\r\n}\r\n","import add from '../support/task';\r\nimport doCheckboxes from './doCheckboxes';\r\nimport doFolderButtons from './doFolderButtons';\r\nimport doToggleButtons from './doToggleButtons';\r\nimport dropItem from '../ajax/dropItem';\r\nimport eventHandler from '../common/eventHandler';\r\nimport fallback from '../system/fallback';\r\nimport getInventoryById from '../ajax/getInventoryById';\r\nimport hideFolders from './hideFolders';\r\nimport insertHtmlAfterBegin from '../common/insertHtmlAfterBegin';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport moreToDo from '../common/moreToDo';\r\nimport moveItemsToFolder from './moveItemsToFolder';\r\nimport {pCC} from '../support/layout';\r\nimport quickAction from './quickAction';\r\nimport sendItem from '../ajax/sendItem';\r\nimport toggleForce from '../common/toggleForce';\r\nimport {\r\n  disableItemColoring,\r\n  setShowExtraLinks,\r\n  setShowQuickDropLinks,\r\n  showExtraLinks,\r\n  showQuickDropLinks,\r\n  showQuickSendLinks\r\n} from './getPrefs';\r\nimport {getItems, itemsAry, itemsHash} from './getItems';\r\nimport {guideUrl, rarity} from '../support/constants';\r\n\r\nvar extraLinks;\r\nvar paintCount;\r\nvar checkAll;\r\nvar dropLinks;\r\nvar invItems;\r\nvar colouring;\r\nvar sendLinks;\r\n\r\nfunction afterbegin(o, item) {\r\n  if (fallback(extraLinks, !showExtraLinks)) {return;}\r\n  var pattern = '<span><span class=\"aHLink\">';\r\n  if (!item.bound) {\r\n    pattern += '[<a href=\"index.php?cmd=auctionhouse&search=' +\r\n      encodeURIComponent(item.item_name) + '\">AH</a>]';\r\n  }\r\n  pattern += '</span>[<a href=\"' + guideUrl + 'items&subcmd=view&item_id=' +\r\n    item.item_id + '\" target=\"_blank\">UFSG</a>]</span>';\r\n  insertHtmlAfterBegin(o.injectHere, pattern);\r\n}\r\n\r\nfunction itemColouring(o, item) {\r\n  if (!colouring && !disableItemColoring) {\r\n    o.injectHere.classList.add(rarity[item.rarity].clas);\r\n  }\r\n}\r\n\r\nvar buildTrailer = [\r\n  {\r\n    test: function(item) {return !checkAll && itemsHash[item.item_id] !== 1;},\r\n    act: function(o, item) {\r\n      return ' [<span linkto=\"' + item.item_id +\r\n        '\" class=\"fshLink\">Check all</span>]';\r\n    }\r\n  },\r\n  {\r\n    test: function(item) {\r\n      return !sendLinks && showQuickSendLinks && !item.bound;\r\n    },\r\n    act: function(o) {\r\n      return ' <span class=\"quickAction sendLink tip-static\" ' +\r\n        'itemInvId=\"' + o.invid + '\" data-tipped=\"INSTANTLY SENDS THE ' +\r\n        'ITEM. NO REFUNDS OR DO-OVERS! Use at own risk.\">[Quick Send]</span>';\r\n    }\r\n  },\r\n  {\r\n    test: function(item) {\r\n      return !dropLinks && showQuickDropLinks && item.guild_tag === -1;\r\n    },\r\n    act: function(o) {\r\n      return ' <span class=\"quickAction dropLink tip-static\" itemInvId=\"' +\r\n        o.invid + '\" data-tipped=\"INSTANTLY DROP THE ITEM. NO REFUNDS ' +\r\n        'OR DO-OVERS! Use at own risk.\">[Quick Drop]</span>';\r\n    }\r\n  }\r\n];\r\n\r\nfunction beforeend(o, item) {\r\n  itemColouring(o, item);\r\n  var pattern = buildTrailer.reduce(function(prev, el) {\r\n    var ret = prev;\r\n    if (el.test(item)) {\r\n      ret += el.act(o, item);\r\n    }\r\n    return ret;\r\n  }, '');\r\n  if (pattern !== '') {insertHtmlBeforeEnd(o.injectHere, pattern);}\r\n}\r\n\r\nfunction itemWidgets(o, item) {\r\n  if (item) {\r\n    afterbegin(o, item);\r\n    beforeend(o, item);\r\n  }\r\n}\r\n\r\nfunction doneInvPaint() {\r\n  if (showExtraLinks) {extraLinks = true;}\r\n  checkAll = true;\r\n  colouring = true;\r\n  if (showQuickDropLinks) {dropLinks = true;}\r\n  sendLinks = true;\r\n}\r\n\r\nfunction invPaint() { // Native - abstract this pattern\r\n  var limit = performance.now() + 5;\r\n  while (moreToDo(limit, paintCount, itemsAry)) {\r\n    var o = itemsAry[paintCount];\r\n    var item = invItems[o.invid];\r\n    itemWidgets(o, item);\r\n    paintCount += 1;\r\n  }\r\n  if (paintCount < itemsAry.length) {\r\n    add(3, invPaint);\r\n  } else {\r\n    doneInvPaint();\r\n  }\r\n}\r\n\r\nfunction toggleShowExtraLinks() {\r\n  setShowExtraLinks();\r\n  doToggleButtons(showExtraLinks, showQuickDropLinks);\r\n  if (!extraLinks) {\r\n    paintCount = 0;\r\n    add(3, invPaint);\r\n  } else {\r\n    itemsAry.forEach(function(o) {\r\n      var el = o.injectHere.firstElementChild;\r\n      toggleForce(el, !showExtraLinks);\r\n    });\r\n  }\r\n}\r\n\r\nfunction toggleShowQuickDropLinks() {\r\n  setShowQuickDropLinks();\r\n  doToggleButtons(showExtraLinks, showQuickDropLinks);\r\n  if (!dropLinks) {\r\n    paintCount = 0;\r\n    add(3, invPaint);\r\n  } else {\r\n    itemsAry.forEach(function(o) {\r\n      var el = o.injectHere.querySelector('.dropLink');\r\n      toggleForce(el, !showQuickDropLinks);\r\n    });\r\n  }\r\n}\r\n\r\nvar evts = [\r\n  {\r\n    test: function(self) {return self.id === 'fshShowExtraLinks';},\r\n    act: toggleShowExtraLinks\r\n  },\r\n  {\r\n    test: function(self) {return self.id === 'fshShowQuickDropLinks';},\r\n    act: toggleShowQuickDropLinks\r\n  },\r\n  {\r\n    test: function(self) {return self.id === 'fshSelectAllGuildLocked';},\r\n    act: function() {doCheckboxes(itemsAry, invItems, 'guild');}\r\n  },\r\n  {\r\n    test: function(self) {return self.id === 'fshMove';},\r\n    act: function() {moveItemsToFolder(itemsAry);}\r\n  },\r\n  {\r\n    test: function(self) {return self.hasAttribute('linkto');},\r\n    act: function(self) {\r\n      doCheckboxes(itemsAry, invItems, 'item', self.getAttribute('linkto'));\r\n    }\r\n  },\r\n  {\r\n    test: function(self) {return self.classList.contains('sendLink');},\r\n    act: function(self) {quickAction(self, sendItem, 'Sent', '.dropLink');}\r\n  },\r\n  {\r\n    test: function(self) {return self.classList.contains('dropLink');},\r\n    act: function(self) {quickAction(self, dropItem, 'Dropped', '.sendLink');}\r\n  },\r\n  {\r\n    test: function(self) {return self.classList.contains('fshFolder');},\r\n    act: function(self) {hideFolders(itemsAry, invItems, self);}\r\n  },\r\n  {\r\n    test: function(self) {return self.id === 'fshChkAll';},\r\n    act: function() {doCheckboxes(itemsAry, invItems, 'checkAll');}\r\n  }\r\n];\r\n\r\nfunction badData(data) {\r\n  return !data || !data.items || !data.folders;\r\n}\r\n\r\nfunction inventory(data) {\r\n  if (badData(data)) {return;}\r\n  extraLinks = false;\r\n  checkAll = false;\r\n  invItems = data.items;\r\n  colouring = false;\r\n  dropLinks = false;\r\n  sendLinks = false;\r\n  paintCount = 0;\r\n  add(3, invPaint);\r\n  doFolderButtons(data.folders);\r\n}\r\n\r\nexport default function injectStoreItems() {\r\n  if (jQueryNotPresent()) {return;}\r\n  getInventoryById().done(inventory);\r\n  add(3, getItems);\r\n  pCC.addEventListener('click', eventHandler(evts));\r\n}\r\n","import calf from '../support/calf';\r\nimport insertElement from '../common/insertElement';\r\nimport insertHtmlAfterBegin from '../common/insertHtmlAfterBegin';\r\nimport makeFolderSpans from '../common/makeFolderSpans';\r\nimport {pCC} from '../support/layout';\r\nimport {createTd, createTr} from '../common/cElement';\r\n\r\nfunction extraButtons() {\r\n  var tRows = pCC.getElementsByTagName('table')[0].rows;\r\n  insertHtmlAfterBegin(tRows[tRows.length - 2].cells[0],\r\n    '<input id=\"fshChkAll\" value=\"Check All\" type=\"button\">&nbsp;');\r\n}\r\n\r\nexport default function doFolderButtons(folders) {\r\n  if (calf.subcmd2 === 'storeitems') {\r\n    var formNode = pCC.getElementsByTagName('form')[0];\r\n    if (formNode) {\r\n      var tr = createTr({className: 'fshCenter'});\r\n      var insertHere = createTd({colSpan: 3});\r\n      insertElement(tr, insertHere);\r\n      formNode.parentNode.insertBefore(tr, formNode);\r\n      insertHere.innerHTML = makeFolderSpans(folders);\r\n      extraButtons();\r\n    }\r\n  }\r\n}\r\n","import {imageServer} from '../system/system';\r\n\r\nfunction anotherSpinner(self) {\r\n  self.innerHTML = '<img class=\"quickActionSpinner\" src=\"' +\r\n    imageServer +\r\n    '/skin/loading.gif\" width=\"15\" height=\"15\">';\r\n}\r\n\r\nexport default function quickAction(self, fn, success, otherClass) { // jQuery.min\r\n  self.className = 'quickAction';\r\n  var itemInvId = self.getAttribute('itemInvId');\r\n  fn([itemInvId]).done(function(data) {\r\n    if (data.r === 1) {return;}\r\n    self.style.color = 'green';\r\n    self.innerHTML = success;\r\n  });\r\n  $(self).qtip('hide');\r\n  anotherSpinner(self);\r\n  var theTd = self.parentNode;\r\n  var otherButton = theTd.querySelector(otherClass);\r\n  if (otherButton) {\r\n    otherButton.className = 'quickAction';\r\n    otherButton.innerHTML = '';\r\n  }\r\n  var checkbox = theTd.parentNode.firstElementChild.firstElementChild;\r\n  checkbox.checked = false;\r\n  checkbox.disabled = true;\r\n}\r\n","import fallback from '../system/fallback';\r\nimport {getElementById} from '../common/getElement';\r\nimport moveItem from '../ajax/moveItem';\r\n\r\nexport default function moveItemsToFolder(itemsAry) { // jQuery.min\r\n  var folderId = getElementById('selectFolderId').value;\r\n  var batchNo;\r\n  var counter = 0;\r\n  var invList = [];\r\n  var prm = [];\r\n  itemsAry.forEach(function(o) {\r\n    var el = o.injectHere.previousElementSibling.previousElementSibling\r\n      .firstElementChild;\r\n    if (el.checked) {\r\n      batchNo = Math.floor(counter / 50);\r\n      invList[batchNo] = fallback(invList[batchNo], []);\r\n      invList[batchNo].push(o.invid);\r\n      counter += 1;\r\n      if (counter % 50 === 0) {\r\n        prm.push(moveItem(invList[batchNo], folderId));\r\n      }\r\n    }\r\n  });\r\n  if (counter % 50 !== 0) {\r\n    prm.push(moveItem(invList[batchNo], folderId));\r\n  }\r\n  $.when.apply($, prm).done(function() {location.reload();}); // TODO ajaxify this\r\n}\r\n","import toggleForce from '../common/toggleForce';\r\n\r\nexport default function hideFolders(itemsAry, invItems, self) {\r\n  var folderId = Number(self.dataset.folder);\r\n  itemsAry.forEach(function(o) {\r\n    o.el.parentNode.parentNode.previousElementSibling.firstElementChild\r\n      .checked = false;\r\n    var tr = o.injectHere.parentNode;\r\n    var separator = tr.nextElementSibling;\r\n    if (folderId === 0) {\r\n      tr.classList.remove('fshHide');\r\n      separator.classList.remove('fshHide');\r\n    } else {\r\n      var folder = invItems[o.invid].folder_id;\r\n      var force = folderId !== folder;\r\n      toggleForce(tr, force);\r\n      toggleForce(separator, force);\r\n    }\r\n  });\r\n}\r\n","import createDocument from './system/createDocument';\r\nimport {createSpan} from './common/cElement';\r\nimport fallback from './system/fallback';\r\nimport formatLastActivity from './system/formatLastActivity';\r\nimport {getElementById} from './common/getElement';\r\nimport getProfile from './ajax/getProfile';\r\nimport insertElementAfter from './common/insertElementAfter';\r\nimport insertHtmlAfterEnd from './common/insertHtmlAfterEnd';\r\nimport jQueryNotPresent from './common/jQueryNotPresent';\r\nimport retryAjax from './ajax/retryAjax';\r\n\r\nvar retries = 0;\r\nvar quickBuffHeader =\r\n  '<div id=\"helperQBheader\"><table class=\"quickbuffTable\"><thead><tr>' +\r\n  '<th class=\"quickbuffTableHeader\">Sustain</th>' +\r\n  '<th class=\"quickbuffTableHeader\">Fury Caster</th>' +\r\n  '<th class=\"quickbuffTableHeader\">Guild Buffer</th>' +\r\n  '<th class=\"quickbuffTableHeader\">Buff Master</th>' +\r\n  '<th class=\"quickbuffTableHeader\">Extend</th>' +\r\n  '<th class=\"quickbuffTableHeader\">Reinforce</th>' +\r\n  '</tr></thead><tbody><tr>' +\r\n  '<td id=\"fshSus\" class=\"quickbuffTableDetail\">&nbsp;</td>' +\r\n  '<td id=\"fshFur\" class=\"quickbuffTableDetail\">&nbsp;</td>' +\r\n  '<td id=\"fshGB\"  class=\"quickbuffTableDetail\">&nbsp;</td>' +\r\n  '<td id=\"fshBM\"  class=\"quickbuffTableDetail\">&nbsp;</td>' +\r\n  '<td id=\"fshExt\" class=\"quickbuffTableDetail\">&nbsp;</td>' +\r\n  '<td id=\"fshRI\"  class=\"quickbuffTableDetail\">&nbsp;</td>' +\r\n  '</tr></tbody></table></div>';\r\nvar excludeBuff = {\r\n  'skill-50': 'Death Dealer',\r\n  'skill-54': 'Counter Attack',\r\n  'skill-55': 'Summon Shield Imp',\r\n  'skill-56': 'Vision',\r\n  'skill-60': 'Nightmare Visage',\r\n  'skill-61': 'Quest Finder',\r\n  'skill-98': 'Barricade',\r\n  'skill-101': 'Severe Condition'\r\n};\r\n\r\nfunction getEnhancement(doc, enh, inject) {\r\n  var enhLevel = doc[enh] || 0;\r\n  var enhClass = 'fshLime';\r\n  if (enhLevel < 100) {enhClass = 'fshRed';}\r\n  inject.innerHTML = '<span class=\"' + enhClass + '\">' + enhLevel + '%</span>';\r\n}\r\n\r\nfunction timeUnit(value, unit) {\r\n  if (value > 0) {return value.toString() + unit;}\r\n  return '';\r\n}\r\n\r\nfunction buffTimeLeft(_s) {\r\n  var m = Math.floor(_s / 60);\r\n  var s = _s % 60;\r\n  var buffTimeToExpire = timeUnit(m, 'm');\r\n  if (m > 0 && s > 0) {buffTimeToExpire += ' ';}\r\n  buffTimeToExpire += timeUnit(s, 's');\r\n  return buffTimeToExpire;\r\n}\r\n\r\nfunction getBuff(doc, buff, inject) {\r\n  var s = fallback(doc[buff], 0);\r\n  if (s) {\r\n    var buffTimeToExpire = buffTimeLeft(s);\r\n    inject.innerHTML = '<span class=\"fshLime\">On</span>&nbsp;<span ' +\r\n      'class=\"fshBuffOn\">(' + buffTimeToExpire + ')</span>';\r\n  } else {\r\n    var elem = getElementById('buff-outer')\r\n      .querySelector('input[data-name=\"' + buff + '\"]');\r\n    if (elem) {\r\n      inject.innerHTML = '<span class=\"quickbuffActivate\" ' +\r\n        'buffID=\"' + elem.getAttribute('value') + '\">Activate</span>';\r\n    } else {\r\n      inject.innerHTML = '<span class=\"fshRed;\">Off</span>';\r\n    }\r\n  }\r\n}\r\n\r\nfunction itWorked(result) {\r\n  return result &&\r\n    (result.textContent.indexOf(\r\n      'current or higher level is currently active on') !== -1 ||\r\n    result.textContent.indexOf('was activated on') !== -1);\r\n}\r\n\r\nfunction quickActivate(evt) { // jQuery\r\n  var trigger = evt.target;\r\n  if (trigger.className !== 'quickbuffActivate') {return;}\r\n  var buffHref = '?cmd=quickbuff&subcmd=activate&targetPlayers=' +\r\n    window.self + '&skills[]=' + trigger.getAttribute('buffID');\r\n  retryAjax(buffHref).done(function(data) {\r\n    var doc = createDocument(data);\r\n    var result = doc.querySelector('#quickbuff-report font');\r\n    if (itWorked(result)) {\r\n      trigger.className = 'fshLime';\r\n      trigger.innerHTML = 'On';\r\n    }\r\n  });\r\n}\r\n\r\nfunction addStatsQuickBuff(data) {\r\n  var myPlayer = document.querySelector('div.player[data-username=\"' +\r\n    data.username + '\"]');\r\n  var activity = myPlayer.querySelector('span.fshLastActivity');\r\n  if (!activity) {\r\n    activity = createSpan({className: 'fshLastActivity'});\r\n    var player = myPlayer.getElementsByTagName('h1')[0];\r\n    insertElementAfter(activity, player);\r\n  }\r\n  activity.innerHTML = 'Last Activity: ' +\r\n    formatLastActivity(data.last_login) +\r\n    '<br>Stamina: ' + data.current_stamina + ' / ' +\r\n    data.stamina + ' ( ' + Math.floor(data.current_stamina /\r\n    data.stamina * 100) + '% )';\r\n}\r\n\r\nfunction newPlayerSpan(el, playerSpan) {\r\n  if (!playerSpan) {\r\n    var ret = createSpan({className: 'fshPlayer'});\r\n    insertElementAfter(ret, el.nextElementSibling);\r\n    return ret;\r\n  }\r\n  return playerSpan;\r\n}\r\n\r\nfunction getBuffColor(myLvl, playerBuffLevel) {\r\n  if (myLvl > playerBuffLevel) {return 'fshRed';}\r\n  return 'fshGreen';\r\n}\r\n\r\nfunction buffRunning(el, playerBuffLevel, playerSpan) {\r\n  if (!playerBuffLevel) {\r\n    playerSpan.innerHTML = '';\r\n    return;\r\n  }\r\n  var lvlSpan = el.nextElementSibling.firstElementChild.firstElementChild;\r\n  var myLvl = parseInt(lvlSpan.textContent.replace(/\\[|\\]/g, ''), 10);\r\n  var fshPlayerSpan = newPlayerSpan(el, playerSpan);\r\n  var buffColor = getBuffColor(myLvl, playerBuffLevel);\r\n  fshPlayerSpan.innerHTML = ' <span class=\"' + buffColor +\r\n    '\">[' + playerBuffLevel + ']</span>';\r\n}\r\n\r\nfunction hazBuff(playerData, el) {\r\n  var myBuffName = el.getAttribute('data-name');\r\n  var playerBuffLevel = playerData[myBuffName];\r\n  var playerSpan = el.nextElementSibling.nextElementSibling;\r\n  if (playerBuffLevel || playerSpan) {\r\n    buffRunning(el, playerBuffLevel, playerSpan);\r\n  }\r\n}\r\n\r\nfunction addBuffLevels(evt) {\r\n  var player = evt.target;\r\n  if (player.tagName !== 'H1') {return;}\r\n  getProfile(player.textContent).done(addStatsQuickBuff);\r\n\r\n  var playerData = player.parentNode.lastElementChild.textContent.split(',');\r\n  playerData = playerData.reduce(function(prev, curr) {\r\n    if (curr.indexOf(' [') !== -1) {\r\n      var foo = curr.split(' [');\r\n      prev[foo[0].trim()] = parseInt(foo[1].replace(']', ''), 10);\r\n    }\r\n    return prev;\r\n  }, {});\r\n\r\n  var buffOuter = getElementById('buff-outer');\r\n  var nodeList = buffOuter.querySelectorAll('input[name]');\r\n\r\n  Array.prototype.forEach.call(nodeList, hazBuff.bind(null, playerData));\r\n\r\n}\r\n\r\nfunction doLabels(el) {\r\n  var nameSpan = el.firstElementChild;\r\n  var dataTipped = nameSpan.dataset.tipped;\r\n  var cost = el.previousElementSibling.getAttribute('data-cost');\r\n  nameSpan.dataset.tipped = dataTipped\r\n    .replace('</center>', '<br>Stamina Cost: ' + cost + '$&');\r\n  var lvlSpan = nameSpan.firstElementChild;\r\n  var myLvl = parseInt(lvlSpan.textContent.replace(/\\[|\\]/g, ''), 10);\r\n  if (!excludeBuff[el.getAttribute('for')] && myLvl < 125) {\r\n    el.classList.add('fshDim');\r\n  }\r\n}\r\n\r\nfunction waitForPlayer(firstPlayer) {\r\n  return !firstPlayer && retries < 9;\r\n}\r\n\r\nfunction haveTargets() {\r\n  var firstPlayer = getElementById('players')\r\n    .getElementsByTagName('h1')[0];\r\n  if (waitForPlayer(firstPlayer)) {\r\n    retries += 1;\r\n    setTimeout(haveTargets, 100);\r\n    return;\r\n  }\r\n  if (!firstPlayer) {return;}\r\n  firstPlayer.click();\r\n}\r\n\r\nfunction firstPlayerStats() {\r\n  var targets = getElementById('targetPlayers')\r\n    .getAttribute('value');\r\n  if (targets && targets !== '') {haveTargets();}\r\n}\r\n\r\nfunction getSustain(responseText) {\r\n  var enh = responseText._enhancements.reduce(function(prev, curr) {\r\n    prev[curr.name] = curr.value;\r\n    return prev;\r\n  }, {});\r\n  var skl = responseText._skills.reduce(function(prev, curr) {\r\n    prev[curr.name] = curr.duration;\r\n    return prev;\r\n  }, {});\r\n  getEnhancement(enh, 'Sustain', getElementById('fshSus'));\r\n  getEnhancement(enh, 'Fury Caster', getElementById('fshFur'));\r\n  getBuff(skl, 'Guild Buffer', getElementById('fshGB'));\r\n  getBuff(skl, 'Buff Master', getElementById('fshBM'));\r\n  getBuff(skl, 'Extend', getElementById('fshExt'));\r\n  getBuff(skl, 'Reinforce', getElementById('fshRI'));\r\n\r\n  getElementById('helperQBheader')\r\n    .addEventListener('click', quickActivate);\r\n  getElementById('players')\r\n    .addEventListener('click', addBuffLevels);\r\n\r\n  var labels = getElementById('buff-outer')\r\n    .querySelectorAll('label[for^=\"skill-\"]');\r\n  Array.prototype.forEach.call(labels, doLabels);\r\n\r\n  firstPlayerStats();\r\n\r\n}\r\n\r\nexport default function injectQuickBuff() { // jQuery\r\n  if (jQueryNotPresent()) {return;}\r\n  var quickbuffDiv = getElementById('quickbuff');\r\n  if (!quickbuffDiv) {return;}\r\n  insertHtmlAfterEnd(quickbuffDiv.firstElementChild, quickBuffHeader);\r\n  getProfile(window.self).done(getSustain);\r\n}\r\n","export default function reduceBuffArray(buffAry) {\r\n  return buffAry.reduce(function(prev, curr) {\r\n    prev[curr.name] = Number(curr.level);\r\n    return prev;\r\n  }, {});\r\n}\r\n","import insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport myStats from '../ajax/myStats';\r\nimport {pCC} from '../support/layout';\r\nimport reduceBuffArray from '../common/reduceBuffArray';\r\n\r\nvar packRE = />([ a-zA-Z]+) Level (\\d+)/g;\r\n\r\nfunction postWarnings(myBuffs) {\r\n  var packsRow = pCC.firstElementChild.rows[9];\r\n  if (!packsRow) {return;}\r\n  var nodeList = packsRow.cells[0].firstElementChild.getElementsByTagName('A');\r\n  Array.prototype.forEach.call(nodeList, function(el) {\r\n    var tipped = el.dataset.tipped;\r\n    var packBuffs;\r\n    while ((packBuffs = packRE.exec(tipped)) !== null) {\r\n      if (myBuffs[packBuffs[1]] === Number(packBuffs[2])) {\r\n        insertHtmlBeforeEnd(el.parentNode,\r\n          '<br><span class=\"fshRed fshNoWrap\">' + packBuffs[1] + ' ' +\r\n          packBuffs[2] + ' active</span>');\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\nfunction parseProfile(data) {\r\n  if (data._skills.length !== 0) {\r\n    var myBuffs = reduceBuffArray(data._skills);\r\n    postWarnings(myBuffs);\r\n  }\r\n}\r\n\r\nexport default function injectRPUpgrades() { // jQuery.min\r\n  if (jQueryNotPresent()) {return;}\r\n  myStats().done(parseProfile);\r\n}\r\n","import equipItem from '../ajax/equipItem';\r\nimport {imageServer} from '../system/system';\r\nimport {queueRecallItem} from '../ajaxQueue/queue';\r\n\r\nvar spinner = '<span class=\"guildReportSpinner\" style=\"background-image: ' +\r\n  'url(\\'' + imageServer + '/skin/loading.gif\\');\"></span>';\r\n\r\nfunction recallItem(evt) { // jQuery\r\n  $(evt.target).qtip('hide');\r\n  var mode = evt.target.getAttribute('mode');\r\n  var theTd = evt.target.parentNode.parentNode;\r\n  if (mode === '0') {theTd = theTd.parentNode;}\r\n  var href = theTd.firstElementChild.href;\r\n  queueRecallItem({\r\n    invId: href.match(/&id=(\\d+)/)[1],\r\n    playerId: href.match(/&player_id=(\\d+)/)[1],\r\n    mode: mode,\r\n    action: evt.target.getAttribute('action')\r\n  })\r\n    .done(function(data) {\r\n      if (data.r === 1) {return;}\r\n      theTd.innerHTML = '<span class=\"fastWorn\">' +\r\n        'You successfully recalled the item</span>';\r\n    });\r\n  theTd.innerHTML = spinner;\r\n}\r\n\r\nfunction wearItem(evt) { // jQuery\r\n  $(evt.target).qtip('hide');\r\n  var theTd = evt.target.parentNode.parentNode.parentNode;\r\n  var href = theTd.firstElementChild.href;\r\n  equipItem(href.match(/&id=(\\d+)/)[1]).done(function(data) {\r\n    if (data.r === 1) {return;}\r\n    theTd.innerHTML = '<span class=\"fastWorn\">Worn</span>';\r\n  });\r\n  theTd.innerHTML = spinner;\r\n}\r\n\r\nvar events = [\r\n  {test: 'recall', fn: recallItem},\r\n  {test: 'equip', fn: wearItem},\r\n  {\r\n    test: 'a-reply',\r\n    fn: function(evt) {\r\n      window.openQuickMsgDialog(evt.target.getAttribute('target_player'));\r\n    }\r\n  }\r\n];\r\n\r\nexport default function eventHandlers(evt) {\r\n  for (var i = 0; i < events.length; i += 1) {\r\n    if (evt.target.classList.contains(events[i].test)) {\r\n      events[i].fn(evt);\r\n      return;\r\n    }\r\n  }\r\n}\r\n","import alpha from '../common/alpha';\r\nimport {createDiv} from '../common/cElement';\r\nimport eventHandler from '../common/eventHandler';\r\nimport extend from '../common/extend';\r\nimport fallback from '../system/fallback';\r\nimport getForage from '../ajax/getForage';\r\nimport insertElement from '../common/insertElement';\r\nimport isChecked from '../system/isChecked';\r\nimport isSelected from '../system/isSelected';\r\nimport {pCC} from '../support/layout';\r\nimport setForage from '../ajax/setForage';\r\nimport testRange from '../system/testRange';\r\n\r\nvar storeMap = 'fsh_potMap';\r\nvar defaultOpts = {\r\n  pottab1: false,\r\n  pottab2: false,\r\n  pottab3: false,\r\n  myMap: {},\r\n  minpoint: 12,\r\n  maxpoint: 20\r\n};\r\nvar potObj;\r\nvar potOpts;\r\nvar inventory;\r\nvar mapping;\r\nvar thresholds;\r\n\r\nfunction createContainer() {\r\n  return createDiv({\r\n    id: 'potReport',\r\n    innerHTML: '<input id=\"pottab1\" type=\"checkbox\" name=\"pottabs\"' +\r\n      isChecked(potOpts.pottab1) + '>' +\r\n      '<label for=\"pottab1\">Composed Potion Inventory</label>' +\r\n      '<input id=\"pottab2\" type=\"checkbox\" name=\"pottabs\"' +\r\n      isChecked(potOpts.pottab2) + '>' +\r\n      '<label for=\"pottab2\">Mapping</label>' +\r\n      '<input id=\"pottab3\" type=\"checkbox\" name=\"pottabs\"' +\r\n      isChecked(potOpts.pottab3) + '>' +\r\n      '<label for=\"pottab3\">Thresholds</label>'\r\n  });\r\n}\r\n\r\nfunction createThresholds() {\r\n  return createDiv({\r\n    id: 'thresholds',\r\n    innerHTML: 'Min:' +\r\n      '<input id=\"minpoint\" type=\"number\" value=\"' +\r\n      potOpts.minpoint + '\" min=\"0\" max=\"999\">' +\r\n      'Max:' +\r\n      '<input id=\"maxpoint\" type=\"number\" value=\"' +\r\n      potOpts.maxpoint + '\" min=\"0\" max=\"999\">',\r\n  });\r\n}\r\n\r\nfunction sortKeys(obj) {\r\n  return Object.keys(obj).sort(alpha).reduce(function(result, key) {\r\n    result[key] = obj[key];\r\n    return result;\r\n  }, {});\r\n}\r\n\r\nfunction resetMap() {\r\n  potOpts.myMap = Object.keys(potObj).reduce(function(prev, pot) {\r\n    prev[pot] = pot;\r\n    return prev;\r\n  }, {});\r\n}\r\n\r\nfunction buildMap() {\r\n  Object.keys(potObj).forEach(function(pot) {\r\n    if (!potOpts.myMap[pot]) {potOpts.myMap[pot] = pot;}\r\n  });\r\n  potOpts.myMap = sortKeys(potOpts.myMap);\r\n}\r\n\r\nfunction buildOptions(select) {\r\n  return '<select name=\"' + select +\r\n    '\"><option value=\"Ignore\">Ignore</option>' +\r\n    Object.keys(potOpts.myMap).reduce(function(prev, pot) {\r\n      return prev + '<option value=\"' + pot + '\"' +\r\n        isSelected(pot, potOpts.myMap[select]) + '>' + pot + '</option>';\r\n    }, '') + '</select>';\r\n}\r\n\r\nfunction drawMapping() {\r\n  mapping.innerHTML = '<table><tbody>' +\r\n    Object.keys(potOpts.myMap).reduce(function(prev, pot) {\r\n      var options = buildOptions(pot);\r\n      return prev + '<tr height=\"19px\"><td>' + pot + '</td><td>' + options +\r\n        '</td></tr>';\r\n    }, '') + '<tr><td></td><td class=\"fshCenter\">' +\r\n    '<input id=\"fshReset\" value=\"Reset\" type=\"button\">' +\r\n    '</td></tr></tbody></table>';\r\n}\r\n\r\nfunction perc2color(percent) {\r\n  var perc = Math.max(Math.min(percent, 100), 0);\r\n  var r;\r\n  var g;\r\n  var b = 0;\r\n  if (perc < 50) {\r\n    r = 255;\r\n    g = Math.round(5.1 * perc);\r\n  } else {\r\n    g = 255;\r\n    r = Math.round(510 - 5.10 * perc);\r\n  }\r\n  var h = r * 0x10000 + g * 0x100 + b;\r\n  return '#' + ('000000' + h.toString(16)).slice(-6);\r\n}\r\n\r\nfunction pivotPotObj(prev, pot) {\r\n  if (potOpts.myMap[pot] !== 'Ignore') {\r\n    if (prev[potOpts.myMap[pot]]) {\r\n      prev[potOpts.myMap[pot]] += potObj[pot];\r\n    } else {\r\n      prev[potOpts.myMap[pot]] = potObj[pot];\r\n    }\r\n  }\r\n  return prev;\r\n}\r\n\r\nfunction makeRowsFromPivot(pivot, prev, pot) {\r\n  return prev + '<tr height=\"19px\"><td>' + pot +\r\n    '</td><td style=\"background-color: ' +\r\n    perc2color((pivot[pot] - potOpts.minpoint) /\r\n    (potOpts.maxpoint - potOpts.minpoint) * 100) + ';\">' +\r\n    pivot[pot].toString() + '</td></tr>';\r\n}\r\n\r\nfunction drawInventory() {\r\n  var pivot = Object.keys(potObj).reduce(pivotPotObj, {});\r\n  inventory.innerHTML = '<table><tbody>' +\r\n    Object.keys(pivot).reduce(makeRowsFromPivot.bind(null, pivot), '') +\r\n    '</tbody></table>';\r\n}\r\n\r\nfunction onChange(e) {\r\n  if (e.target.tagName === 'SELECT') {\r\n    potOpts.myMap[e.target.name] = e.target.value;\r\n    setForage(storeMap, potOpts);\r\n    drawInventory();\r\n  }\r\n}\r\n\r\nfunction doReset() {\r\n  resetMap();\r\n  setForage(storeMap, potOpts);\r\n  drawMapping();\r\n  drawInventory();\r\n}\r\n\r\nfunction saveState(self) {\r\n  var option = self.id;\r\n  potOpts[option] = self.checked;\r\n  setForage(storeMap, potOpts);\r\n}\r\n\r\nvar evtHdl = [\r\n  {\r\n    test: function(self) {return self.id === 'fshReset';},\r\n    act: doReset\r\n  },\r\n  {\r\n    test: function(self) {\r\n      return /^pottab\\d$/.test(self.id);\r\n    },\r\n    act: saveState\r\n  }\r\n];\r\n\r\nfunction onInput(e) {\r\n  var self = e.target.id;\r\n  var maybeValue = testRange(e.target.value, 0, 999);\r\n  if (maybeValue) {\r\n    potOpts[self] = maybeValue;\r\n    setForage(storeMap, potOpts);\r\n    drawInventory();\r\n  }\r\n}\r\n\r\nfunction gotMap(data) {\r\n  potOpts = extend({}, defaultOpts);\r\n  extend(potOpts, fallback(data, {}));\r\n  buildMap(potObj);\r\n  setForage(storeMap, potOpts);\r\n  var container = createContainer();\r\n  var panels = createDiv({id: 'panels'});\r\n  insertElement(container, panels);\r\n  inventory = createDiv({id: 'inventory'});\r\n  drawInventory();\r\n  insertElement(panels, inventory);\r\n  mapping = createDiv({id: 'mapping'});\r\n  drawMapping();\r\n  insertElement(panels, mapping);\r\n  thresholds = createThresholds();\r\n  insertElement(panels, thresholds);\r\n\r\n  var myCell = pCC.lastElementChild.insertRow(2).insertCell(-1);\r\n  myCell.addEventListener('change', onChange);\r\n  myCell.addEventListener('click', eventHandler(evtHdl));\r\n  myCell.addEventListener('input', onInput);\r\n  insertElement(myCell, container);\r\n}\r\n\r\nexport default function potReport(potObj_) {\r\n  potObj = sortKeys(potObj_);\r\n  getForage(storeMap).done(gotMap);\r\n}\r\n","import add from '../support/task';\r\nimport {createSpan} from '../common/cElement';\r\nimport insertElement from '../common/insertElement';\r\nimport moreToDo from '../common/moreToDo';\r\nimport potReport from './potReport';\r\n\r\nvar wearRE = new RegExp('<b>|Bottle|Brew|Draft|Elixir|Potion|Jagua Egg|' +\r\n  'Gut Rot Head Splitter|Serum');\r\nvar counter;\r\nvar nodeArray;\r\nvar nodeList;\r\nvar potObj;\r\n\r\nfunction paintChild() {\r\n  var limit = performance.now() + 1;\r\n  while (moreToDo(limit, counter, nodeArray)) {\r\n    var el = nodeList[counter];\r\n    var inject = nodeArray[counter];\r\n    insertElement(el, inject);\r\n    counter += 1;\r\n  }\r\n  if (counter < nodeArray.length) {\r\n    add(3, paintChild);\r\n  }\r\n}\r\n\r\nfunction hideElement(test) {\r\n  if (test) {return ' class=\"fshHide\"';}\r\n  return '';\r\n}\r\n\r\nfunction isEquipable(test) {\r\n  if (test) {return 'recall';}\r\n  return 'equip';\r\n}\r\n\r\nfunction addPotObj(item) {\r\n  if (item.indexOf(' (Potion)') !== -1) {\r\n    var itemName = item.replace(' (Potion)', '');\r\n    if (potObj[itemName]) {\r\n      potObj[itemName] += 1;\r\n    } else {\r\n      potObj[itemName] = 1;\r\n    }\r\n  }\r\n}\r\n\r\nfunction mySpan(el) {\r\n  var secondHref = el.children.length === 2;\r\n  var firstHref = hideElement(!secondHref);\r\n  var itemName = el.previousElementSibling.innerHTML;\r\n  addPotObj(itemName);\r\n  var wearable = hideElement(wearRE.test(itemName));\r\n  var equipable = isEquipable(secondHref);\r\n  return createSpan({\r\n    innerHTML: '<span' + firstHref +\r\n    '> | <span class=\"sendLink recall tip-static\" data-tipped=\"' +\r\n    'Click to recall to backpack\" mode=\"0\" action=\"recall\">Fast BP' +\r\n    '</span></span>' +\r\n    ' | <span class=\"sendLink recall tip-static\" ' +\r\n    'data-tipped=\"Click to recall to guild store\" mode=\"1\" ' +\r\n    'action=\"recall\">Fast GS</span>' +\r\n    '<span' + wearable +\r\n    '> | <span class=\"sendLink ' +\r\n    equipable +\r\n    '\" mode=\"0\" action=\"wear\">Fast Wear</span></span>'\r\n  });\r\n}\r\n\r\nfunction doSpan(el) {\r\n  if (counter === 0) {\r\n    el.previousSibling.setAttribute('width', '200px');\r\n    el.setAttribute('width', '370px');\r\n  } else {\r\n    el.previousSibling.removeAttribute('width');\r\n    el.removeAttribute('width');\r\n  }\r\n  nodeArray.push(mySpan(el));\r\n}\r\n\r\nfunction makeSpan() {\r\n  var limit = performance.now() + 10;\r\n  while (moreToDo(limit, counter, nodeList)) {\r\n    var el = nodeList[counter];\r\n\r\n    doSpan(el);\r\n\r\n    counter += 1;\r\n  }\r\n  if (counter < nodeList.length) {\r\n    add(3, makeSpan);\r\n  } else {\r\n    counter = 0;\r\n    add(3, paintChild);\r\n    potReport(potObj);\r\n  }\r\n}\r\n\r\nexport default function prepareChildRows() {\r\n  nodeList = document.querySelectorAll('#pCC table table ' +\r\n    'tr:not(.fshHide) td:nth-of-type(3n+0)');\r\n  potObj = {};\r\n  nodeArray = [];\r\n  counter = 0;\r\n  add(3, makeSpan);\r\n}\r\n","import add from '../support/task';\r\nimport calf from '../support/calf';\r\nimport moreToDo from '../common/moreToDo';\r\nimport {onlineDot} from '../common/colouredDots';\r\n\r\nvar headerCount;\r\nvar headers;\r\n\r\nfunction memberHeader(oldhtml) {\r\n  if (!calf.membrList[oldhtml]) {return oldhtml;}\r\n  return onlineDot({last_login: calf.membrList[oldhtml].last_login}) +\r\n    '<a href=\"index.php?cmd=profile&player_id=' + calf.membrList[oldhtml].id +\r\n    '\">' + oldhtml + '</a> [ <span class=\"a-reply fshLink\" target_player=' +\r\n    oldhtml + '>m</span> ]';\r\n}\r\n\r\nfunction paintHeader() {\r\n  var limit = performance.now() + 10;\r\n  while (moreToDo(limit, headerCount, headers)) {\r\n    // while (performance.now() < limit && headerCount < headers.length) {\r\n    var el = headers[headerCount];\r\n    var oldhtml = el.textContent;\r\n    el.innerHTML = memberHeader(oldhtml);\r\n    headerCount += 1;\r\n  }\r\n  if (headerCount < headers.length) {\r\n    add(3, paintHeader);\r\n  }\r\n}\r\n\r\nexport default function reportHeader() {\r\n  headers = document.querySelectorAll('#pCC table table ' +\r\n    'tr:not(.fshHide) td[bgcolor=\"#DAA534\"][colspan=\"2\"] b');\r\n  headerCount = 0;\r\n  add(3, paintHeader);\r\n}\r\n","import add from '../support/task';\r\nimport getUrlParameter from '../system/getUrlParameter';\r\nimport moreToDo from '../common/moreToDo';\r\n\r\nvar counter;\r\nvar nodeList;\r\nvar findUser;\r\nvar foundUser;\r\n\r\nfunction hideOther(el) {\r\n  if (el.firstChild.hasAttribute('bgcolor')) {\r\n    foundUser = el.firstChild.firstElementChild.textContent === findUser;\r\n  }\r\n  if (!foundUser) {\r\n    el.className = 'fshHide';\r\n  }\r\n}\r\n\r\nfunction hideOthers() {\r\n  var limit = performance.now() + 5;\r\n  while (moreToDo(limit, counter, nodeList)) {\r\n    var el = nodeList[counter];\r\n\r\n    hideOther(el);\r\n\r\n    counter += 1;\r\n  }\r\n  if (counter < nodeList.length) {\r\n    add(2, hideOthers);\r\n  }\r\n}\r\n\r\nexport default function searchUser() {\r\n  findUser = getUrlParameter('user');\r\n  if (!findUser) {return;}\r\n  var userNodes = document.querySelectorAll(\r\n    '#pCC table table td[bgcolor=\"#DAA534\"] b');\r\n  var userNode = Array.prototype.some.call(userNodes, function(el) {\r\n    return el.textContent === findUser;\r\n  });\r\n  if (!userNode) {return;}\r\n  nodeList = document.querySelectorAll('#pCC table table tr');\r\n  counter = 0;\r\n  add(2, hideOthers);\r\n}\r\n","import currentGuildId from '../common/currentGuildId';\r\nimport getProfile from '../ajax/getProfile';\r\nimport getValue from '../system/getValue';\r\nimport guildView from '../app/guild/view';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\nimport isObject from '../common/isObject';\r\nimport isUndefined from '../common/isUndefined';\r\nimport jQueryPresent from '../common/jQueryPresent';\r\nimport {nowSecs} from '../support/constants';\r\nimport {onlineDot} from '../common/colouredDots';\r\nimport {pCC} from '../support/layout';\r\nimport {playerDataObject} from '../common/common';\r\nimport {\r\n  calculateBoundaries,\r\n  pvpLowerLevel,\r\n  pvpUpperLevel\r\n} from '../common/levelHighlight';\r\nimport {createInput, createSpan} from '../common/cElement';\r\n\r\nvar highlightPlayersNearMyLvl;\r\nvar spinner;\r\nvar validPvP = nowSecs - 604800;\r\nvar guilds;\r\nvar myGuildId;\r\n\r\nvar highlightTests = [\r\n  function() {return highlightPlayersNearMyLvl;},\r\n  function(guildId) {return isUndefined(guildId) || guildId !== myGuildId;},\r\n  function(guildId, data) {return data.last_login >= validPvP;},\r\n  function(guildId, data) {return data.virtual_level >= pvpLowerLevel;},\r\n  function(guildId, data) {return data.virtual_level <= pvpUpperLevel;}\r\n];\r\n\r\nfunction pvpHighlight(guildId, data) {\r\n  return highlightTests.every(function(el) {\r\n    return el(guildId, data);\r\n  });\r\n}\r\n\r\nfunction doOnlineDot(aTable, guildId, data) {\r\n  insertHtmlBeforeEnd(aTable.rows[0],\r\n    '<td>' + onlineDot({last_login: data.last_login}) + '</td>');\r\n  if (pvpHighlight(guildId, data)) {\r\n    aTable.parentNode.parentNode.classList.add('lvlHighlight');\r\n  }\r\n}\r\n\r\nfunction parsePlayer(aTable, guildId, data, jqXhr) {\r\n  if (data) {\r\n    doOnlineDot(aTable, guildId, data);\r\n    //#if _DEV  //  get cloaked players\r\n    var defender = playerDataObject(data);\r\n    if (defender.cloakLevel !== 0) {console.log('Cloaked Player', data);} // eslint-disable-line no-console\r\n    //#endif\r\n  } else {\r\n    insertHtmlBeforeEnd(aTable.rows[0],\r\n      '<td class=\"fshBkRed\">' + jqXhr.status + '</td>');\r\n  }\r\n}\r\n\r\nfunction failFilter(jqXhr) {\r\n  return $.Deferred().resolve(null, jqXhr).promise();\r\n}\r\n\r\nfunction addPlayerObjectToGuild(guildId, obj) {\r\n  if (guilds[guildId]) {\r\n    guilds[guildId].push(obj);\r\n  } else {\r\n    guilds[guildId] = [obj];\r\n  }\r\n}\r\n\r\nfunction addPlayerToGuild(tbl, playerName) {\r\n  var guildHRef = tbl.rows[0].cells[0].firstElementChild.href;\r\n  var guildId = /guild_id=(\\d+)/.exec(guildHRef)[1];\r\n  addPlayerObjectToGuild(guildId, {dom: tbl, player: playerName});\r\n}\r\n\r\nfunction stackAjax(prm, playerName, tbl, guildId) {\r\n  prm.push(getProfile(playerName)\r\n    .pipe(null, failFilter)\r\n    .done(parsePlayer.bind(null, tbl, guildId))\r\n  );\r\n}\r\n\r\nfunction parseGuild(data) {\r\n  var guildId = data.r.id;\r\n  data.r.members.forEach(function(member) {\r\n    guilds[guildId].forEach(function(player) {\r\n      if (member.name === player.player) {\r\n        doOnlineDot(player.dom, guildId, {\r\n          last_login: (nowSecs - member.last_activity).toString(),\r\n          virtual_level: member.vl\r\n        });\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\nfunction findOnlinePlayers() { // jQuery\r\n  var someTables = pCC.getElementsByTagName('table');\r\n  var prm = [];\r\n  guilds = {};\r\n  Array.prototype.slice.call(someTables, 4).forEach(function(tbl) {\r\n    var playerName = tbl.textContent.trim();\r\n    if (tbl.rows[0].cells[0].firstElementChild) {\r\n      addPlayerToGuild(tbl, playerName);\r\n    } else {\r\n      stackAjax(prm, playerName, tbl);\r\n    }\r\n  });\r\n  Object.keys(guilds).forEach(function(guildId) {\r\n    if (guilds[guildId].length === 1) {\r\n      stackAjax(prm, guilds[guildId][0].player, guilds[guildId][0].dom,\r\n        guildId);\r\n    } else {\r\n      guildView(guildId).done(parseGuild);\r\n    }\r\n  });\r\n  $.when.apply($, prm).done(function() {\r\n    spinner.classList.add('fshHide');\r\n  });\r\n}\r\n\r\nfunction getMyVL(e) { // jQuery\r\n  $(e.target).qtip('hide');\r\n  spinner = createSpan({\r\n    className: 'fshCurveContainer fshTopListSpinner',\r\n    innerHTML: '<div class=\"fshCurveEle fshCurveLbl fshOldSpinner\"></div>'\r\n  });\r\n  e.target.parentNode.replaceChild(spinner, e.target);\r\n  highlightPlayersNearMyLvl = getValue('highlightPlayersNearMyLvl');\r\n  if (highlightPlayersNearMyLvl) {\r\n    calculateBoundaries();\r\n    myGuildId = currentGuildId();\r\n  }\r\n  findOnlinePlayers();\r\n}\r\n\r\nfunction looksLikeTopRated() {\r\n  var theCell = pCC.getElementsByTagName('TD')[0];\r\n  theCell.firstElementChild.className = 'fshTopListWrap';\r\n  var findBtn = createInput({\r\n    id: 'fshFindOnlinePlayers',\r\n    className: 'custombutton tip-static',\r\n    type: 'button',\r\n    value: 'Find Online Players',\r\n    dataset: {\r\n      tipped: 'Fetch the online status of the ' +\r\n        'top 250 players (warning ... takes a few seconds).'\r\n    }\r\n  });\r\n  theCell.insertBefore(findBtn, theCell.firstElementChild);\r\n  findBtn.addEventListener('click', getMyVL);\r\n}\r\n\r\nvar topRatedTests = [\r\n  function() {return jQueryPresent();},\r\n  function() {return isObject(pCC);},\r\n  function() {return isObject(pCC.firstElementChild);},\r\n  function() {return isObject(pCC.firstElementChild.rows);},\r\n  function() {return pCC.firstElementChild.rows.length > 2;},\r\n  function() {\r\n    return pCC.firstElementChild.rows[1].textContent.indexOf(\r\n      'Last Updated') === 0;\r\n  }\r\n];\r\n\r\nfunction testforTopRated() {\r\n  return topRatedTests.every(function(e) {return e();});\r\n}\r\n\r\nexport default function injectTopRated() {\r\n  if (testforTopRated()) {looksLikeTopRated();}\r\n}\r\n","import jQueryPresent from './common/jQueryPresent';\r\n\r\n// var system = require('./support/system');\r\n\r\n// Legacy - Bad, could be repurposed\r\n/* function getBpCountFromWorld(responseText) {\r\n  // backpack counter\r\n  var doc=system.createDocument(responseText);\r\n  var bp=system.findNode(\r\n    '//td[a/img[contains(@src,\"_manageitems.gif\")]]',doc);\r\n  var injectHere=document.getElementById('reportDiv');\r\n  if (!injectHere) {\r\n    injectHere=system.findNode(\r\n      '//b[contains(.,\"Multiple Scavenging Results\")]/..');\r\n  }\r\n  insertElement(injectHere, bp);\r\n}\r\n*/\r\n\r\n/* function multiSummary() { // Legacy - Bad, could be repurposed\r\n  var injectHere=system.findNode(\r\n    '//b[contains(.,\"Multiple Scavenging Results\")]/..');\r\n  if (injectHere) { // multi scavenging\r\n    var victories=system.findNodes('//td[contains(.,\"victorious\")]');\r\n    if (victories) {\r\n      injectHere.innerHTML+='<br/>Victories: '+victories.length;\r\n    }\r\n    var defeats=system.findNodes('//td[contains(.,\"defeated\")]');\r\n    if (defeats) {\r\n      injectHere.innerHTML+=', Defeated: '+defeats.length;\r\n    }\r\n    var gains=system.findNodes('//td[contains(.,\"Item Gained\")]/b');\r\n    if (gains) {\r\n      injectHere.innerHTML+='<br/>'+gains.length+' item(s): ';\r\n      var gainHash={};\r\n      for (var i=0;i<gains.length;i += 1) {\r\n        if (gainHash[gains[i].textContent]) {\r\n          gainHash[gains[i].textContent]+= 1;\r\n        } else {\r\n          gainHash[gains[i].textContent]=1;\r\n        }\r\n      }\r\n      for (var item in gainHash) {\r\n        if (!gainHash.hasOwnProperty(item)) { continue; }\r\n        injectHere.innerHTML+=gainHash[item]+' '+item+'(s), ';\r\n      }\r\n    }\r\n  }\r\n  system.xmlhttp('index.php?cmd=world', getBpCountFromWorld);\r\n}\r\n*/\r\n\r\nfunction dontPost(e) { // jQuery\r\n  e.preventDefault();\r\n  window.location = 'index.php?cmd=scavenging&subcmd=process' +\r\n    '&cave_id=' + $('#pCC input[name=\"cave_id\"]:checked').val() +\r\n    '&gold=' + $('#gold').val() + '&submit=Scavenge';\r\n}\r\n\r\nexport default function injectScavenging() { // jQuery\r\n  if (jQueryPresent()) {\r\n    $('#pCC input[value=\"Scavenge\"]').click(dontPost);\r\n  }\r\n}\r\n","import insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\nimport openQuickBuffByName from '../common/openQuickBuffByName';\r\n\r\nfunction buffIndividual(self) {\r\n  if (self.previousElementSibling) {\r\n    openQuickBuffByName(self.previousElementSibling.textContent);\r\n  }\r\n}\r\n\r\nfunction buffAll(self) {\r\n  var titanTable = self.parentNode.parentNode.parentNode.parentNode;\r\n  var shortList = [];\r\n  for (var j = 1; j < titanTable.rows.length; j += 2) {\r\n    var firstCell = titanTable.rows[j].cells[0].firstChild.firstChild;\r\n    shortList.push(firstCell.textContent);\r\n  }\r\n  openQuickBuffByName(shortList.join());\r\n}\r\n\r\nfunction buffEvent(e) {\r\n  var self = e.target;\r\n  if (self.textContent === '[b]') {\r\n    buffIndividual(self);\r\n  }\r\n  if (self.textContent === 'all') {\r\n    buffAll(self);\r\n  }\r\n}\r\n\r\nfunction evtHdl(e) {\r\n  if (e.target.classList.contains('fshBl')) {buffEvent(e);}\r\n}\r\n\r\nfunction doBuffLinks(titanTable) {\r\n  for (var j = 1; j < titanTable.rows.length; j += 2) {\r\n    var firstCell = titanTable.rows[j].cells[0];\r\n    insertHtmlBeforeEnd(firstCell,\r\n      ' <button class=\"fshBl fshXSmall\">[b]</button>');\r\n  }\r\n  insertHtmlBeforeEnd(titanTable.rows[0].cells[0],\r\n    ' <button class=\"fshBl fshXSmall\">all</button>');\r\n}\r\n\r\nfunction gotTables(titanTables) {\r\n  for (var i = 2; i < titanTables.length; i += 1) {\r\n    var titanTable = titanTables[i];\r\n    if (titanTable.rows.length < 2) {continue;}\r\n    doBuffLinks(titanTable);\r\n  }\r\n  titanTables[1].addEventListener('click', evtHdl);\r\n}\r\n\r\nexport default function injectScouttowerBuffLinks(titanTables) {\r\n  if (titanTables.length > 2) {gotTables(titanTables);}\r\n}\r\n","export default function isNaN(value) {\r\n  return Number.isNaN(value);\r\n}\r\n","import round from './round';\r\n\r\nexport default function roundToString(number, precision) {\r\n  return round(number, precision).toString();\r\n}\r\n","import isNaN from './isNaN';\r\n\r\nexport default function round(number, precision) {\r\n  var factor = Math.pow(10, precision);\r\n  if (isNaN(factor)) {factor = 1;}\r\n  return Math.round(number * factor) / factor;\r\n}\r\n","import getForage from '../ajax/getForage';\r\nimport injectScouttowerBuffLinks from './injectScouttowerBuffLinks';\r\nimport insertElement from '../common/insertElement';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {pCC} from '../support/layout';\r\nimport parseDateAsTimestamp from '../system/parseDateAsTimestamp';\r\nimport roundToString from '../common/roundToString';\r\nimport setForage from '../ajax/setForage';\r\nimport {createAnchor, createTBody, createTable} from '../common/cElement';\r\nimport {guideUrl, now} from '../support/constants';\r\n\r\nfunction getTitanName(aRow) {\r\n  return aRow.cells[0].firstElementChild.getAttribute('oldtitle');\r\n}\r\n\r\nfunction cooldownTracker(aRow, theTitans) {\r\n  var myName = getTitanName(aRow).replace(' (Titan)', '');\r\n  if (!theTitans[myName]) {\r\n    var cooldown = aRow.nextElementSibling.cells[0].textContent;\r\n    var coolTime = 0;\r\n    if (cooldown.indexOf('until') !== -1) {\r\n      coolTime = parseDateAsTimestamp(\r\n        cooldown.replace('Cooldown until: ', ''));\r\n    }\r\n    theTitans[myName] = {\r\n      cooldownText: cooldown,\r\n      coolTime: coolTime,\r\n      seen: 'yes'\r\n    };\r\n  }\r\n}\r\n\r\nfunction addRow(theTitans, trackerTable, titan) {\r\n  if (theTitans[titan].coolTime < now) {return;}\r\n  insertHtmlBeforeEnd(trackerTable,\r\n    '<tr><td class=\"fshCenter\">' + titan + '</td>' +\r\n    '<td class=\"fshBold fshCenter fshCooldown\">' +\r\n    theTitans[titan].cooldownText + '</td><td class=\"fshCenter\">' +\r\n    theTitans[titan].seen + '</td></tr>');\r\n}\r\n\r\nfunction displayTracker(parentTable, theTitans) {\r\n  var trackerTable = createTable({className: 'fshTTracker'});\r\n  var tBody = createTBody({\r\n    innerHTML: '<tr><td class=\"header fshCenter\">Titan</td>' +\r\n      '<td class=\"header fshCenter\">Cooldown</td>' +\r\n      '<td class=\"header fshCenter\">Visible</td></tr>'\r\n  });\r\n  insertElement(trackerTable, tBody);\r\n  Object.keys(theTitans).forEach(addRow.bind(null, theTitans, tBody));\r\n\r\n  var newRow = parentTable.insertRow(5);\r\n  var newCell = newRow.insertCell(-1);\r\n  newCell.colSpan = 3;\r\n  insertElement(newCell, trackerTable);\r\n}\r\n\r\nfunction addMissingTitansFromOld(oldTitans, newTitans) {\r\n  if (!oldTitans) {return;}\r\n  Object.keys(oldTitans).forEach(function(oldTitan) {\r\n    if (newTitans[oldTitan]) {return;}\r\n    if (oldTitans[oldTitan].coolTime <= now) {return;}\r\n    newTitans[oldTitan] = {\r\n      cooldownText: oldTitans[oldTitan].cooldownText,\r\n      coolTime: oldTitans[oldTitan].coolTime,\r\n      seen: 'no'\r\n    };\r\n  });\r\n}\r\n\r\nexport function getTitanString(guildKills, totalHP, currentHP) {\r\n  var numberOfKillsToSecure = Math.ceil(totalHP / 2 + 1);\r\n  if (guildKills >= numberOfKillsToSecure) {\r\n    return 'Secured';\r\n  }\r\n  var remainingKills = numberOfKillsToSecure - guildKills;\r\n  if (remainingKills > currentHP) {\r\n    return '<span class=\"fshRed\">Cannot Secure</span>';\r\n  }\r\n  return '<span class=\"fshRed\">' + remainingKills + '</span> to secure';\r\n}\r\n\r\nexport function getKillsPct(currentNumberOfKills, guildKills) {\r\n  if (currentNumberOfKills === 0) {return 0;}\r\n  return guildKills * 100 / currentNumberOfKills;\r\n}\r\n\r\nfunction killsSummary(aRow) {\r\n  var titanHP = aRow.cells[2].textContent;\r\n  if (titanHP.indexOf('-') !== -1) {return;}\r\n  var guildKills = Number(aRow.cells[3].textContent);\r\n  var titanHPArray = titanHP.split('/');\r\n  var currentHP = Number(titanHPArray[0]);\r\n  var totalHP = Number(titanHPArray[1]);\r\n  insertHtmlBeforeEnd(aRow.cells[3],\r\n    '<br><span class=\"fshBlue\"> (' +\r\n    roundToString(getKillsPct(totalHP - currentHP, guildKills), 2) +\r\n    '% Current <br>' + roundToString(guildKills * 100 / totalHP, 2) +\r\n    '% Total<br>' + getTitanString(guildKills, totalHP, currentHP) + ')');\r\n}\r\n\r\nfunction guideLink(aRow) {\r\n  var myName = encodeURIComponent(getTitanName(aRow));\r\n  var myImg = aRow.cells[0].firstElementChild;\r\n  var myLink = createAnchor({\r\n    href: guideUrl + 'creatures&search_name=' + myName,\r\n    target: '_blank'\r\n  });\r\n  insertElement(myLink, myImg);\r\n  insertElement(aRow.cells[0], myLink);\r\n}\r\n\r\nfunction gotOldTitans(oldTitans) {\r\n  var titanTables = pCC.getElementsByTagName('table');\r\n  injectScouttowerBuffLinks(titanTables);\r\n  var titanTable = titanTables[1];\r\n  var newTitans = {};\r\n  for (var i = 1; i < titanTable.rows.length - 1; i += 6) {\r\n    var aRow = titanTable.rows[i];\r\n    killsSummary(aRow);\r\n    cooldownTracker(aRow, newTitans); // Pref\r\n    guideLink(aRow);\r\n  }\r\n  addMissingTitansFromOld(oldTitans, newTitans); // Pref\r\n  displayTracker(titanTables[0], newTitans); // Pref\r\n  setForage('fsh_titans', newTitans); // Pref\r\n}\r\n\r\nexport default function injectScouttower() { // jQuery.min\r\n  if (jQueryNotPresent()) {return;}\r\n  getForage('fsh_titans').done(gotOldTitans); // Pref\r\n}\r\n","import calf from '../support/calf';\r\nimport getValue from '../system/getValue';\r\nimport isChecked from '../system/isChecked';\r\nimport {networkIcon} from './settingObj';\r\nimport {helpLink, simpleCheckbox} from './simpleCheckbox';\r\n\r\nfunction guildInfoWidgets() {\r\n  return '<tr><td class=\"fshRight\"><label for=\"enableGuildInfoWidgets\">' +\r\n    'Enable Guild Info Widgets' +\r\n    helpLink('Enable Guild Info Widgets',\r\n      'Enabling this option will enable the Guild Info Widgets ' +\r\n      '(coloring on the Guild Info panel)') +\r\n    ':</label></td><td>' +\r\n    '<input id=\"enableGuildInfoWidgets\" name=\"enableGuildInfoWidgets\" ' +\r\n    'type=\"checkbox\" value=\"on\"' + isChecked(calf.enableGuildInfoWidgets) +\r\n    '>&nbsp;<label>Hide Message&gt;<input name=\"hideGuildInfoMessage\" ' +\r\n    'type=\"checkbox\" value=\"on\"' + isChecked(calf.hideGuildInfoMessage) +\r\n    '></label>&nbsp;<label>Hide Buff&gt;<input name=\"hideGuildInfoBuff\" ' +\r\n    'type=\"checkbox\" value=\"on\"' + isChecked(calf.hideGuildInfoBuff) +\r\n    '></label>&nbsp;<label>Hide ST&gt;<input name=\"hideGuildInfoSecureTrade\" ' +\r\n    'type=\"checkbox\" value=\"on\"' + isChecked(calf.hideGuildInfoSecureTrade) +\r\n    '></label>&nbsp;<label>Hide Trade&gt;<input name=\"hideGuildInfoTrade\" ' +\r\n    'type=\"checkbox\" value=\"on\"' + isChecked(calf.hideGuildInfoTrade) +\r\n    '></label></td></tr>';\r\n}\r\n\r\nfunction onlineAlliesEnemies() {\r\n  return '<tr><td class=\"fshRight\">' + networkIcon +\r\n    'Show Online Allies/Enemies' +\r\n    helpLink('Show Online Allies/Enemies',\r\n      'This will show the allies/enemies online list on the right.') +\r\n    ':</td><td><label>Allies&nbsp;<input name=\"enableAllyOnlineList\" ' +\r\n    'type=\"checkbox\" value=\"on\"' + isChecked(calf.enableAllyOnlineList) +\r\n    '></label>&nbsp;&nbsp;<label>Enemies&nbsp;' +\r\n    '<input name=\"enableEnemyOnlineList\" type=\"checkbox\" value=\"on\"' +\r\n    isChecked(calf.enableEnemyOnlineList) + '></label>&nbsp;&nbsp;' +\r\n    '<input name=\"allyEnemyOnlineRefreshTime\" size=\"3\" value=\"' +\r\n    getValue('allyEnemyOnlineRefreshTime') + '\"> seconds refresh</td></tr>';\r\n}\r\n\r\nfunction quickLinksLocation() {\r\n  return '<tr><td class=\"fshRight\">Quick Links Screen Location' +\r\n    helpLink('Quick Links Screen Location',\r\n      'Determines where the quick links dialog shows on the screen. ' +\r\n      'Default is top 22, left 0.') +\r\n    ':</td><td>Top: <input name=\"quickLinksTopPx\" size=\"3\" value=\"' +\r\n    getValue('quickLinksTopPx') +\r\n    '\"> Left: <input name=\"quickLinksLeftPx\" size=\"3\" value=\"' +\r\n    getValue('quickLinksLeftPx') + '\"></td></tr>';\r\n}\r\n\r\nexport default function generalPrefs() {\r\n  // General Prefs\r\n  return '<tr><th colspan=\"2\"><b>General preferences ' +\r\n      '(apply to most screens)</b></th></tr>' +\r\n\r\n    guildInfoWidgets() +\r\n\r\n    simpleCheckbox('moveGuildList') +\r\n    simpleCheckbox('moveOnlineAlliesList') +\r\n\r\n    onlineAlliesEnemies() +\r\n\r\n    simpleCheckbox('enableOnlineAlliesWidgets') +\r\n    simpleCheckbox('moveFSBox') +\r\n    simpleCheckbox('moveDailyQuest') +\r\n    simpleCheckbox('fsboxlog') +\r\n    simpleCheckbox('gameHelpLink') +\r\n    simpleCheckbox('enableTempleAlert') +\r\n    simpleCheckbox('enableUpgradeAlert') +\r\n    simpleCheckbox('enableComposingAlert') +\r\n    simpleCheckbox('enhanceOnlineDots') +\r\n    simpleCheckbox('hideBuffSelected') +\r\n    simpleCheckbox('hideHelperMenu') +\r\n    simpleCheckbox('keepHelperMenuOnScreen') +\r\n    simpleCheckbox('draggableHelperMenu') +\r\n\r\n    quickLinksLocation() +\r\n\r\n    simpleCheckbox('draggableQuickLinks') +\r\n    simpleCheckbox('expandMenuOnKeyPress');\r\n}\r\n","import getValue from '../system/getValue';\r\nimport isChecked from '../system/isChecked';\r\nimport {helpLink, simpleCheckbox} from './simpleCheckbox';\r\n\r\nfunction injectSettingsGuildData(guildType) {\r\n  var title = '';\r\n  var disabled = '';\r\n  if (guildType === 'Self') {\r\n    title = ' title=\"This is automatically detected\"';\r\n    disabled = ' disabled';\r\n  }\r\n  return '<input' + title + ' name=\"guild' + guildType + '\" size=\"60\" value=\"' +\r\n    getValue('guild' + guildType) + '\"' + disabled + '>' +\r\n\r\n    '<span class=\"fshPoint\" ' +\r\n    'id=\"toggleShowGuild' + guildType + 'Message\" linkto=\"showGuild' +\r\n    guildType + 'Message\"> &#x00bb;</span>' +\r\n\r\n    '<div id=\"showGuild' + guildType + 'Message\" class=\"fshHide\">' +\r\n    '<input name=\"guild' + guildType + 'Message\" size=\"60\" value=\"' +\r\n    getValue('guild' + guildType + 'Message') + '\">' +\r\n    '</div>';\r\n}\r\n\r\nexport default function guildPrefs() {\r\n  // Guild Manage\r\n  return '<tr><th colspan=\"2\"><b>Guild>Manage preferences' +\r\n      '</b></th></tr>' +\r\n    '<tr><td colspan=\"2\">Enter guild names, ' +\r\n      'separated by commas</td></tr>' +\r\n    '<tr><td class=\"fshRight\">Own Guild</td><td>' +\r\n      injectSettingsGuildData('Self') + '</td></tr>' +\r\n    '<tr><td class=\"fshRight\">Friendly Guilds</td><td>' +\r\n      injectSettingsGuildData('Frnd') + '</td></tr>' +\r\n    '<tr><td class=\"fshRight\">Old Guilds</td><td>' +\r\n      injectSettingsGuildData('Past') + '</td></tr>' +\r\n    '<tr><td class=\"fshRight\">Enemy Guilds</td><td>' +\r\n      injectSettingsGuildData('Enmy') + '</td></tr>' +\r\n\r\n    '<tr><td class=\"fshRight\">Highlight Valid PvP Targets' +\r\n      helpLink('Highlight Valid PvP Targets',\r\n        'Enabling this option will highlight targets in OTHER guilds that ' +\r\n        'are within your level range to attack for PvP or GvG.') +\r\n      ':</td><td>PvP: <input name=\"highlightPlayersNearMyLvl\" ' +\r\n      'type=\"checkbox\" value=\"on\"' +\r\n      isChecked(getValue('highlightPlayersNearMyLvl')) +\r\n      '> GvG: <input name=\"highlightGvGPlayersNearMyLvl\" ' +\r\n      'type=\"checkbox\" value=\"on\"' +\r\n      isChecked(getValue('highlightGvGPlayersNearMyLvl')) +\r\n      '></td></tr>' +\r\n\r\n    simpleCheckbox('showAdmin') +\r\n    simpleCheckbox('ajaxifyRankControls') +\r\n    simpleCheckbox('detailedConflictInfo');\r\n}\r\n","import calf from '../support/calf';\r\nimport getValue from '../system/getValue';\r\nimport isChecked from '../system/isChecked';\r\nimport isSelected from '../system/isSelected';\r\nimport {\r\n  helpLink,\r\n  justCheckbox,\r\n  justLabel,\r\n  simpleCheckbox\r\n} from './simpleCheckbox';\r\n\r\nfunction worldGroup() {\r\n  // World Screen\r\n  return '<tr><td class=\"fshRight\">Hide Create Group Button' +\r\n    helpLink('Hide Create Group Button',\r\n      'Enabling this option will hide the Create Group button') +\r\n    ':</td><td>' +\r\n    '<input name=\"hideChampionsGroup\" type=\"checkbox\" value=\"on\"' +\r\n      isChecked(getValue('hideChampionsGroup')) + '>' +\r\n    '&nbsp;Champions&nbsp;&nbsp;' +\r\n    '<input name=\"hideElitesGroup\" type=\"checkbox\" value=\"on\"' +\r\n      isChecked(getValue('hideElitesGroup')) + '>' +\r\n    '&nbsp;Elites&nbsp;&nbsp;' +\r\n    '<input name=\"hideSEGroup\" type=\"checkbox\" value=\"on\"' +\r\n      isChecked(getValue('hideSEGroup')) + '>' +\r\n    '&nbsp;Super Elite&nbsp;&nbsp;' +\r\n    '<input name=\"hideTitanGroup\" type=\"checkbox\" value=\"on\"' +\r\n      isChecked(getValue('hideTitanGroup')) + '>' +\r\n    '&nbsp;Titan&nbsp;&nbsp;' +\r\n    '<input name=\"hideLegendaryGroup\" type=\"checkbox\" value=\"on\"' +\r\n      isChecked(getValue('hideLegendaryGroup')) + '>' +\r\n    '&nbsp;Legendary' +\r\n    '</td></tr>';\r\n}\r\n\r\nfunction keepCombatLogs() {\r\n  return '<tr><td class=\"fshRight\">Keep Combat Logs' +\r\n    helpLink('Keep Combat Logs',\r\n      'Save combat logs to a temporary variable. ' +\r\n      'Press <u>Show logs</u> on the right to display and copy them') +\r\n    ':</td><td><input name=\"keepLogs\" type=\"checkbox\" value=\"on\"' +\r\n    isChecked(getValue('keepLogs')) + '>&nbsp;&nbsp;' +\r\n    '<input type=\"button\" class=\"custombutton\" value=\"Show Logs\" ' +\r\n    'id=\"Helper:ShowLogs\"></td></tr>';\r\n}\r\n\r\nfunction combatEvalBias() {\r\n  return '<tr><td class=\"fshRight\">Combat Evaluator Bias' +\r\n    helpLink('Combat Evaluator Bias',\r\n      'This changes the bias of the combat evaluator for the damage and ' +\r\n      'HP evaluation. It will not change the attack bias (1.1053).' +\r\n      '<br>Conservative = 1.1053 and 1.1 (Safest)' +\r\n      '<br>Semi-Conservative = 1.1 and 1.053' +\r\n      '<br>Adventurous = 1.053 and 1 (Bleeding Edge)' +\r\n      '<br>Conservative+ = 1.1053 and 1 with the attack calculation ' +\r\n      'changed to +-48 per RJEM') +\r\n    ':</td><td><select name=\"combatEvaluatorBias\">' +\r\n    '<option value=\"0\"' +\r\n    isSelected(calf.combatEvaluatorBias, 0) +\r\n    '>Conservative</option>' +\r\n    '<option value=\"1\"' +\r\n    isSelected(calf.combatEvaluatorBias, 1) +\r\n    '>Semi-Conservative</option>' +\r\n    '<option value=\"2\"' +\r\n    isSelected(calf.combatEvaluatorBias, 2) +\r\n    '>Adventurous</option>' +\r\n    '<option value=\"3\"' +\r\n    isSelected(calf.combatEvaluatorBias, 3) +\r\n    '>Conservative+</option></select></td></tr>';\r\n}\r\n\r\nfunction keepCreatureLog() {\r\n  return '<tr><td class=\"fshRight\">' + justLabel('showMonsterLog') +\r\n    '</td><td>' + justCheckbox('showMonsterLog') +\r\n    '&nbsp;&nbsp;<input type=\"button\" class=\"custombutton\" ' +\r\n    'value=\"Show\" id=\"Helper:ShowMonsterLogs\"></td></tr>';\r\n}\r\n\r\nfunction showSendGold() {\r\n  return '<tr><td class=\"fshRight\">Show Send Gold' +\r\n    helpLink('Show Gold on World Screen',\r\n      'This will show an icon below the world map to allow you to ' +\r\n      'quickly send gold to a Friend.') +\r\n    ':</td><td><input name=\"sendGoldonWorld\" type=\"checkbox\" value=\"on\"' +\r\n    isChecked(getValue('sendGoldonWorld')) + '>' +\r\n    '&nbsp;&nbsp;Send <input name=\"goldAmount\" size=\"5\" value=\"' +\r\n    getValue('goldAmount') + '\"> ' +\r\n    'gold to <input name=\"goldRecipient\" size=\"10\" value=\"' +\r\n    getValue('goldRecipient') + '\">' +\r\n    ' Current total: <input name=\"currentGoldSentTotal\" size=\"5\" value=\"' +\r\n    getValue('currentGoldSentTotal') + '\"></td></tr>';\r\n}\r\n\r\nfunction theDoNotKillList() {\r\n  return '<tr><td class=\"fshRight\">Do Not Kill List' +\r\n    helpLink('Do Not Kill List',\r\n      'List of creatures that will not be killed by quick kill. ' +\r\n      'You must type the full name of each creature, separated by commas. ' +\r\n      'Creature name will show up in red color on world screen and will ' +\r\n      'not be killed by keyboard entry (but can still be killed by ' +\r\n      'mouseclick). Quick kill must be enabled for this function to work.') +\r\n    ':</td><td colspan=\"3\"><input name=\"doNotKillList\" size=\"60\" value=\"' +\r\n    calf.doNotKillList + '\"></td></tr>';\r\n}\r\n\r\nfunction huntBuff() {\r\n  return 'Hunting Buffs' + helpLink('Hunting Buffs',\r\n    'Customize which buffs are designated as hunting buffs. ' +\r\n    'You must type the full name of each buff, separated by commas. ' +\r\n    'Use the checkbox to enable/disable them.') + ':';\r\n}\r\n\r\nfunction huntBuffCheck() {\r\n  return '<input name=\"showHuntingBuffs\" ' +\r\n    'class=\"fshVMid\" type=\"checkbox\" value=\"on\"' +\r\n    isChecked(calf.showBuffs) + '>';\r\n}\r\n\r\nexport function huntMode() {\r\n  return 'Enabled Hunting Mode' +\r\n    helpLink('Enabled Hunting Mode',\r\n      'This will determine which list of buffs gets checked ' +\r\n      'on the world screen.') +\r\n    ':<select name=\"enabledHuntingMode\">' +\r\n    '<option value=\"1\"' + isSelected(calf.enabledHuntingMode, '1') +\r\n    '>' + calf.buffsName + '</option>' +\r\n    '<option value=\"2\"' + isSelected(calf.enabledHuntingMode, '2') +\r\n    '>' + calf.buffs2Name + '</option>' +\r\n    '<option value=\"3\"' + isSelected(calf.enabledHuntingMode, '3') +\r\n    '>' + calf.buffs3Name + '</option>' +\r\n    '</select>';\r\n}\r\n\r\nexport function huntingBuffsHtml() {\r\n  return huntBuff() + huntBuffCheck() + ' ' + huntMode();\r\n}\r\n\r\nfunction huntingBuffs() {\r\n  return '<tr><td class=\"fshRight\">' + huntBuff() + '</td><td colspan=\"3\">' +\r\n    huntBuffCheck() + ' ' + huntMode() + '</td></tr>';\r\n}\r\n\r\nfunction huntingBuffsList(modeLabel, modeName, buffsName, buffs) {\r\n  return '<tr><td class=\"fshRight\">' + modeLabel + ' Hunting Buff List' +\r\n    helpLink(modeLabel + ' Hunting Buff List',\r\n      modeLabel + ' list of hunting buffs.') +\r\n    ':</td><td colspan=\"3\"><input name=\"' + modeName +\r\n    '\" title=\"Hunting mode name\" size=\"7\" value=\"' + modeLabel +\r\n    '\"><input name=\"' + buffsName + '\" size=\"49\" value=\"' + buffs +\r\n    '\"></td></tr>';\r\n}\r\n\r\nexport function prefs() {\r\n  // World Screen\r\n  return '<tr><th colspan=\"2\"><b>' +\r\n    'World screen/Hunting preferences</b></th></tr>' +\r\n\r\n    worldGroup() +\r\n    keepCombatLogs() +\r\n\r\n    simpleCheckbox('showCombatLog') +\r\n    simpleCheckbox('enableCreatureColoring') +\r\n    simpleCheckbox('showCreatureInfo') +\r\n\r\n    combatEvalBias() +\r\n    keepCreatureLog() +\r\n    showSendGold() +\r\n    theDoNotKillList() +\r\n    huntingBuffs() +\r\n\r\n    huntingBuffsList(calf.buffsName, 'huntingBuffsName', 'huntingBuffs',\r\n      calf.buffs) +\r\n    huntingBuffsList(calf.buffs2Name, 'huntingBuffs2Name', 'huntingBuffs2',\r\n      calf.buffs2) +\r\n    huntingBuffsList(calf.buffs3Name, 'huntingBuffs3Name', 'huntingBuffs3',\r\n      calf.buffs3) +\r\n\r\n    simpleCheckbox('huntingMode');\r\n}\r\n","import bountyPrefs from './bountyPrefs';\r\nimport calf from '../support/calf';\r\nimport equipPrefs from './equipPrefs';\r\nimport generalPrefs from './generalPrefs';\r\nimport guildPrefs from './guildPrefs';\r\nimport logPrefs from './logPrefs';\r\nimport otherPrefs from './otherPrefs';\r\nimport {prefs} from './worldPrefs';\r\nimport profilePrefs from './profilePrefs';\r\nimport questPrefs from './questPrefs';\r\n\r\nfunction storageDetails() {\r\n  return '<tr><td align=center><input id=\"fshClearStorage\" type=\"button\" ' +\r\n    'class=\"awesome magenta tip-static\" value=\"Clear Storage\" ' +\r\n    'data-tipped=\"<span class=\\'fshHelpTitle\\'>Clear Storage' +\r\n    '</span><br><br>This will clear all localStorage related to ' +\r\n    'fallensword.com<br>It will reset all your Helper settings to ' +\r\n    'defaults<br>Use it if your storage has overflowed or become ' +\r\n    'corrupt\"></td><td align=center>' +\r\n    '<span style=\"font-size:x-small\">(Current version: ' +\r\n    FSH.version + '(' + FSH.calf + ')) (Storage Used: ' +\r\n    calf.storage + '% Remaining: ' +\r\n    (100 - calf.storage).toFixed(2) + '%)</span></td></tr>';\r\n}\r\n\r\nfunction linkToWebsite() {\r\n  return '<tr><td colspan=\"2\" align=center>' +\r\n  '<span style=\"font-weight:bold;\">Visit the ' +\r\n  '<a href=\"https://github.com/fallenswordhelper/fallenswordhelper\">' +\r\n  'Fallen Sword Helper web site</a> ' +\r\n  'for any suggestions, requests or bug reports</span></td></tr>';\r\n}\r\n\r\nfunction coderLink(prev, curr, ind, ary) {\r\n  var ret = prev + '<a href=\"index.php?cmd=profile&player_id=' + curr[0] +\r\n    '\">' + curr[1] + '</a>';\r\n  if (ind === ary.length - 2) {\r\n    ret += ' and ';\r\n  } else if (ind !== ary.length - 1) {ret += ', ';}\r\n  return ret;\r\n}\r\n\r\nfunction listOfCoders(ary) {\r\n  return ary.reduce(coderLink, '');\r\n}\r\n\r\nfunction codedBy() {\r\n  return '<tr><td colspan=\"2\" align=center>' +\r\n    '<span class=\"fshXXSmall\">Fallen Sword Helper was coded by ' +\r\n    listOfCoders([['1393340', 'Coccinella'], ['1599987', 'yuuzhan'],\r\n      ['1963510', 'PointyHair'], ['1346893', 'Tangtop'],\r\n      ['2536682', 'dkwizard'], ['1570854', 'jesiegel'],\r\n      ['2156859', 'ByteBoy'], ['2169401', 'McBush']]) +\r\n    ', with valuable contributions by ' +\r\n    listOfCoders([['524660', 'Nabalac'], ['37905', 'Ananasii']]) +\r\n    '</span></td></tr>';\r\n}\r\n\r\nexport default function setupConfigData() {\r\n  calf.configData =\r\n    '<form><table id=\"fshSettingsTable\">' +\r\n    '<thead><th colspan=\"2\"><b>Fallen Sword Helper configuration ' +\r\n      'Settings</b></th></thead>' +\r\n    storageDetails() +\r\n    linkToWebsite() +\r\n    // General Prefs\r\n    generalPrefs() +\r\n    // Guild Manage\r\n    guildPrefs() +\r\n    // World Screen\r\n    prefs() +\r\n    // Log screen prefs\r\n    logPrefs() +\r\n    // Equipment screen prefs\r\n    equipPrefs() +\r\n    // Quest Preferences\r\n    questPrefs() +\r\n    // profile prefs\r\n    profilePrefs() +\r\n    // Bounty hunting prefs\r\n    bountyPrefs() +\r\n    // Other prefs\r\n    otherPrefs() +\r\n    // save button\r\n    '<tr><td colspan=\"2\" align=center><input type=\"button\" class=' +\r\n      '\"custombutton\" value=\"Save\" id=\"Helper:SaveOptions\"></td></tr>' +\r\n    // Export or Load Settings\r\n    // http://www.fallensword.com/index.php?cmd=notepad&blank=1&subcmd=savesettings\r\n    '<tr><td colspan=\"2\" align=center>' +\r\n      '<a href=\"index.php?cmd=notepad&blank=1&subcmd=savesettings\">' +\r\n      'Export or Load Settings!</a></td></tr>' +\r\n    codedBy() +\r\n    '</table></form>';\r\n}\r\n","import getValue from '../system/getValue';\r\nimport isChecked from '../system/isChecked';\r\nimport {helpLink, simpleCheckbox} from './simpleCheckbox';\r\n\r\nexport default function logPrefs() {\r\n  // Log screen prefs\r\n  return '<tr><th colspan=\"2\"><b>Log screen preferences' +\r\n      '</b></th></tr>' +\r\n\r\n    simpleCheckbox('hideNonPlayerGuildLogMessages') +\r\n    simpleCheckbox('useNewGuildLog') +\r\n\r\n    '<tr><td class=\"fshRight\">New Guild Log History' +\r\n      helpLink('New Guild Log History (pages)',\r\n        'This is the number of pages that the new guild log ' +\r\n        'screen will go back in history.') +\r\n      ':</td><td><input name=\"newGuildLogHistoryPages\" size=\"3\" value=\"' +\r\n      getValue('newGuildLogHistoryPages') + '\"></td></td></tr>' +\r\n\r\n    simpleCheckbox('enableLogColoring') +\r\n\r\n    '<tr><td class=\"fshRight\">New Log Message Sound' +\r\n      helpLink('New Log Message Sound',\r\n        'The .wav or .ogg file to play when you have unread log messages. ' +\r\n        'This must be a .wav or .ogg file. This option can be turned on/off ' +\r\n        'on the world page. Only works in Firefox 3.5+') +\r\n      ':</td><td colspan=\"3\"><input name=\"defaultMessageSound\" size=\"60\" ' +\r\n      'value=\"' + getValue('defaultMessageSound') +\r\n      '\"></td></tr>' +\r\n\r\n    '<tr><td class=\"fshRight\">Play sound on unread log' +\r\n      helpLink('Play sound on unread log',\r\n        'Should the above sound play when you have unread log messages? ' +\r\n        '(will work on Firefox 3.5+ only)') +\r\n      ':</td><td><input name=\"playNewMessageSound\" type=\"checkbox\" ' +\r\n      'value=\"on\"' +\r\n      isChecked(getValue('playNewMessageSound')) + '>' +\r\n      ' Show speaker on world' +\r\n      helpLink('Show speaker on world',\r\n        'Should the toggle play sound speaker show on the world map? ' +\r\n        '(This icon is next to the Fallensword wiki icon and will only ' +\r\n        'display on Firefox 3.5+)') +\r\n      ':<input name=\"showSpeakerOnWorld\" type=\"checkbox\" value=\"on\"' +\r\n      isChecked(getValue('showSpeakerOnWorld')) +\r\n      '></tr></td>' +\r\n\r\n    simpleCheckbox('enableChatParsing') +\r\n    simpleCheckbox('keepBuffLog') +\r\n    simpleCheckbox('addAttackLinkToLog') +\r\n    simpleCheckbox('enhanceChatTextEntry');\r\n}\r\n","import escapeHtml from '../system/escapeHtml';\r\nimport getValue from '../system/getValue';\r\nimport isChecked from '../system/isChecked';\r\nimport {helpLink, simpleCheckbox} from './simpleCheckbox';\r\n\r\nexport default function equipPrefs() {\r\n  // Equipment screen prefs\r\n  return '<tr><th colspan=\"2\"><b>Equipment screen preferences' +\r\n      '</b></th></tr>' +\r\n\r\n    simpleCheckbox('showExtraLinks') +\r\n    simpleCheckbox('disableItemColoring') +\r\n\r\n    '<tr><td class=\"fshRight\">Show Quick Send Item' +\r\n      helpLink('Show Quick Send on Manage Backpack',\r\n        'This will show a link beside each item which gives the option to ' +\r\n        'quick send the item to this person') +\r\n      ':</td><td><input name=\"showQuickSendLinks\" type=\"checkbox\" ' +\r\n      'value=\"on\"' +\r\n      isChecked(getValue('showQuickSendLinks')) + '>' +\r\n      '&nbsp;&nbsp;Send Items To ' +\r\n      '<input name=\"itemRecipient\" size=\"10\" value=\"' +\r\n      getValue('itemRecipient') + '\">' +\r\n\r\n    simpleCheckbox('showQuickDropLinks') +\r\n\r\n    '<tr><td class=\"fshRight\">Quick Select all of type in Send Screen' +\r\n      helpLink('Quick Select all of type in Send Screen',\r\n        'This allows you to customize what quick links you would like ' +\r\n        'displayed in your send item screen.<br>Use the format ' +\r\n        '[&quot;name&quot;,&quot;itemid&quot;],[&quot;othername&quot;,' +\r\n        '&quot;itemid2&quot;].<br>WARNING: NO REFUNDS ON ERROR') +\r\n      ':</td><td><input name=\"sendClasses\" size=\"60\" value=\"' +\r\n      escapeHtml(getValue('sendClasses')) + '\">';\r\n}\r\n","import getValue from '../system/getValue';\r\nimport isChecked from '../system/isChecked';\r\nimport {helpLink, simpleCheckbox} from './simpleCheckbox';\r\n\r\nexport default function questPrefs() {\r\n  // Quest Preferences\r\n  return '<tr><th colspan=\"2\"><b>Quest preferences</b></th></tr>' +\r\n\r\n    '<tr><td class=\"fshRight\">Hide Specific Quests' +\r\n      helpLink('Hide Specific Quests',\r\n        'If enabled, this hides quests whose name matches the list ' +\r\n        '(separated by commas). This works on Quest Manager and Quest Book.') +\r\n      ':</td><td colspan=\"3\"><input name=\"hideQuests\" type=\"checkbox\" ' +\r\n      'value=\"on\"' +\r\n      isChecked(getValue('hideQuests')) + '>' +\r\n      '&nbsp;<input name=\"hideQuestNames\" size=\"60\" value=\"' +\r\n      getValue('hideQuestNames') + '\"></td></tr>' +\r\n\r\n    simpleCheckbox('storeLastQuestPage') +\r\n    simpleCheckbox('showNextQuestSteps');\r\n}\r\n","import getValue from '../system/getValue';\r\nimport isChecked from '../system/isChecked';\r\nimport {helpLink, simpleCheckbox} from './simpleCheckbox';\r\n\r\nexport default function profilePrefs() {\r\n  // profile prefs\r\n  return '<tr><th colspan=\"2\"><b>Profile preferences</b></th></tr>' +\r\n\r\n    simpleCheckbox('renderSelfBio') +\r\n    simpleCheckbox('renderOtherBios') +\r\n\r\n    '<tr><td class=\"fshRight\">Enable Bio Compressor' +\r\n      helpLink('Enable Bio Compressor',\r\n        'This will compress long bios according to settings and provide a ' +\r\n        'link to expand the compressed section.') +\r\n      ':</td><td><input name=\"enableBioCompressor\" type=\"checkbox\" ' +\r\n      'value=\"on\"' +\r\n      isChecked(getValue('enableBioCompressor')) +\r\n      '> Max Characters:<input name=\"maxCompressedCharacters\" size=\"4\" ' +\r\n      'value=\"' + getValue('maxCompressedCharacters') + '\" />' +\r\n      ' Max Lines:<input name=\"maxCompressedLines\" size=\"3\" value=\"' +\r\n      getValue('maxCompressedLines') + '\"></td></tr>' +\r\n\r\n    '<tr><td class=\"fshRight\">Buy Buffs Greeting' +\r\n      helpLink('Buy Buffs Greeting',\r\n        'This is the default text to open a message with when asking to ' +\r\n        'buy buffs. You can use {playername} to insert the target players ' +\r\n        'name. You can also use {buffs} to insert the list of buffs. You ' +\r\n        'can use {cost} to insert the total cost of the buffs.') +\r\n      ':</td><td colspan=\"3\"><input name=\"buyBuffsGreeting\" size=\"60\" ' +\r\n      'value=\"' + getValue('buyBuffsGreeting') + '\"></td></tr>' +\r\n\r\n    simpleCheckbox('showStatBonusTotal') +\r\n    simpleCheckbox('enableQuickDrink') +\r\n    simpleCheckbox('disableDeactivatePrompts');\r\n}\r\n","import calf from '../support/calf';\r\nimport isChecked from '../system/isChecked';\r\nimport {networkIcon} from './settingObj';\r\nimport {helpLink, simpleCheckbox} from './simpleCheckbox';\r\n\r\nexport default function bountyPrefs() {\r\n  // Bounty hunting prefs\r\n  return '<tr><th colspan=\"2\"><b>Bounty hunting preferences' +\r\n      '</b></th></tr>' +\r\n\r\n    '<tr><td align= \"right\">' + networkIcon +\r\n      'Show Active Bounties' +\r\n      helpLink('Show Active Bounties',\r\n        'This will show your active bounties on the right hand side') +\r\n      ':</td><td colspan=\"3\"><input name=\"enableActiveBountyList\" ' +\r\n      'type = \"checkbox\" value = \"on\"' +\r\n      isChecked(calf.enableActiveBountyList) + '>&nbsp;' +\r\n      '<input name=\"bountyListRefreshTime\" size=\"3\" value=\"' +\r\n      calf.bountyListRefreshTime + '\"> seconds refresh</td></tr>' +\r\n\r\n    '<tr><td align= \"right\">' + networkIcon +\r\n      'Show Wanted Bounties' +\r\n      helpLink('Show Wanted Bounties',\r\n        'This will show when someone you want is on the bounty board, ' +\r\n        'the list is displayed on the right hand side') +\r\n      ':</td><td colspan=\"3\"><input name=\"enableWantedList\" ' +\r\n      'type=\"checkbox\" value=\"on\"' +\r\n      isChecked(calf.enableWantedList) +\r\n      '> Refresh time is same as Active Bounties' +\r\n\r\n    '<tr><td align= \"right\">Wanted Names' +\r\n      helpLink('Wanted Names',\r\n        'The names of the people you want to see on the bounty board ' +\r\n        'separated by commas (or * for all)') + ':</td><td colspan=\"3\">' +\r\n      '<input name=\"wantedNames\" size=\"60\" value=\"' + calf.wantedNames +\r\n      '\"></td></tr>' +\r\n\r\n    simpleCheckbox('wantedGuildMembers') +\r\n    simpleCheckbox('enableAttackHelper') +\r\n    simpleCheckbox('showPvPSummaryInLog');\r\n}\r\n","import getValue from '../system/getValue';\r\nimport isChecked from '../system/isChecked';\r\nimport {helpLink, simpleCheckbox} from './simpleCheckbox';\r\n\r\nexport default function otherPrefs() {\r\n  // Other prefs\r\n  return '<tr><th colspan=\"2\"><b>Other preferences</b></th></tr>' +\r\n\r\n    simpleCheckbox('autoFillMinBidPrice') +\r\n\r\n    '<tr><td class=\"fshRight\">Hide Specific Recipes' +\r\n      helpLink('Hide Specific Recipes',\r\n        'If enabled, this hides recipes whose name matches the list ' +\r\n        '(separated by commas). This works on Recipe Manager') +\r\n      ':</td><td colspan=\"3\"><input name=\"hideRecipes\" ' +\r\n      'type=\"checkbox\" value=\"on\"' +\r\n      isChecked(getValue('hideRecipes')) + '>' +\r\n      '&nbsp;<input name=\"hideRecipeNames\" size=\"60\" value=\"' +\r\n      getValue('hideRecipeNames') + '\"></td></tr>' +\r\n\r\n    simpleCheckbox('hideRelicOffline') +\r\n    simpleCheckbox('enterForSendMessage') +\r\n    simpleCheckbox('navigateToLogAfterMsg') +\r\n\r\n    '<tr><td align= \"right\">Max Group Size to Join' +\r\n      helpLink('Max Group Size to Join',\r\n        'This will disable HCSs Join All functionality and will only join ' +\r\n        'groups less than a set size. ') +\r\n      ':</td><td colspan=\"3\"><input name=\"enableMaxGroupSizeToJoin\" ' +\r\n      'type = \"checkbox\" value = \"on\"' +\r\n      isChecked(getValue('enableMaxGroupSizeToJoin')) +\r\n      '>&nbsp;&nbsp;Max Size: ' +\r\n      '<input name=\"maxGroupSizeToJoin\" size=\"3\" value=\"' +\r\n      getValue('maxGroupSizeToJoin') + '\"></td></tr>' +\r\n\r\n    simpleCheckbox('moveComposingButtons');\r\n}\r\n","import calf from '../support/calf';\r\nimport findNode from '../system/findNode';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport injectMonsterLog from '../monstorLog';\r\nimport injectNotepadShowLogs from '../combatLog';\r\nimport insertElement from '../common/insertElement';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\nimport jConfirm from '../common/jConfirm';\r\nimport jQueryDialog from '../chrome/jQueryDialog';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {saveBoxes} from './settingObj';\r\nimport {sendEvent} from '../support/fshGa';\r\nimport setValue from '../system/setValue';\r\nimport setupConfigData from './configData';\r\nimport toggleVisibilty from '../common/toggleVisibilty';\r\nimport {createBr, createSpan} from '../common/cElement';\r\n\r\nfunction getVars() {\r\n  calf.showBuffs = getValue('showHuntingBuffs');\r\n  calf.buffs = getValue('huntingBuffs');\r\n  calf.buffsName = getValue('huntingBuffsName');\r\n  calf.buffs2 = getValue('huntingBuffs2');\r\n  calf.buffs2Name = getValue('huntingBuffs2Name');\r\n  calf.buffs3 = getValue('huntingBuffs3');\r\n  calf.buffs3Name = getValue('huntingBuffs3Name');\r\n  calf.doNotKillList = getValue('doNotKillList');\r\n\r\n  calf.bountyListRefreshTime = getValue('bountyListRefreshTime');\r\n  calf.wantedNames = getValue('wantedNames');\r\n  calf.combatEvaluatorBias = getValue('combatEvaluatorBias');\r\n  calf.enabledHuntingMode = getValue('enabledHuntingMode');\r\n  calf.storage = (JSON.stringify(localStorage).length /\r\n    (5 * 1024 * 1024) * 100).toFixed(2);\r\n}\r\n\r\nfunction toggleTickAllBuffs(e) { // jQuery\r\n  var allItems = $('input[name^=\"blockedSkillList\"]:visible',\r\n    '#settingsTabs-4');\r\n  var tckTxt = $(e.target);\r\n  allItems.prop('checked', tckTxt.text() === 'Tick all buffs');\r\n  if (tckTxt.text() === 'Tick all buffs') {\r\n    tckTxt.text('Untick all buffs');\r\n  } else {\r\n    tckTxt.text('Tick all buffs');\r\n  }\r\n}\r\n\r\nfunction clearStorage() {\r\n  jConfirm('Clear localStorage',\r\n    'Are you sure you want to clear you localStorage?',\r\n    function() {localStorage.clear();}\r\n  );\r\n}\r\n\r\nfunction saveValueForm(oForm, name) { // Legacy\r\n  var formElement =\r\n    findNode('//input[@name=\"' + name + '\"]', oForm);\r\n  if (formElement.getAttribute('type') === 'checkbox') {\r\n    setValue(name, formElement.checked);\r\n  } else {\r\n    setValue(name, formElement.value);\r\n  }\r\n}\r\n\r\nfunction setMaxCompressedCharacters(oForm) { // Legacy\r\n  var maxCompressedCharacters =\r\n    findNode('//input[@name=\"maxCompressedCharacters\"]', oForm);\r\n  var maxCompressedCharactersValue = Number(maxCompressedCharacters.value);\r\n  if (isNaN(maxCompressedCharactersValue) ||\r\n      maxCompressedCharactersValue <= 50) {\r\n    maxCompressedCharacters.value = 1500;\r\n  }\r\n}\r\n\r\nfunction setMaxCompressedLines(oForm) { // Legacy\r\n  var maxCompressedLines =\r\n    findNode('//input[@name=\"maxCompressedLines\"]', oForm);\r\n  var maxCompressedLinesValue = Number(maxCompressedLines.value);\r\n  if (isNaN(maxCompressedLinesValue) || maxCompressedLinesValue <= 1) {\r\n    maxCompressedLines.value = 25;\r\n  }\r\n}\r\n\r\nfunction setGuildLogHistoryPages(oForm) { // Legacy\r\n  var newGuildLogHistoryPages =\r\n    findNode('//input[@name=\"newGuildLogHistoryPages\"]', oForm);\r\n  var newGuildLogHistoryPagesValue = Number(newGuildLogHistoryPages.value);\r\n  if (isNaN(newGuildLogHistoryPagesValue) ||\r\n      newGuildLogHistoryPagesValue <= 1) {\r\n    newGuildLogHistoryPages.value = 25;\r\n  }\r\n}\r\n\r\nfunction setMaxGroupSizeToJoin(oForm) { // Legacy\r\n  var maxGroupSizeToJoin =\r\n    findNode('//input[@name=\"maxGroupSizeToJoin\"]', oForm);\r\n  var maxGroupSizeToJoinValue = Number(maxGroupSizeToJoin.value);\r\n  if (isNaN(maxGroupSizeToJoinValue) || maxGroupSizeToJoinValue <= 1) {\r\n    maxGroupSizeToJoin.value = 11;\r\n  }\r\n}\r\n\r\nfunction saveConfig(evt) { // Legacy\r\n  var oForm = evt.target.form;\r\n  // bio compressor validation logic\r\n  setMaxCompressedCharacters(oForm);\r\n  setMaxCompressedLines(oForm);\r\n  setGuildLogHistoryPages(oForm);\r\n  setMaxGroupSizeToJoin(oForm);\r\n  var combatEvaluatorBiasElement =\r\n    findNode('//select[@name=\"combatEvaluatorBias\"]', oForm);\r\n  var combatEvaluatorBias = Number(combatEvaluatorBiasElement.value);\r\n  setValue('combatEvaluatorBias', combatEvaluatorBias);\r\n  var enabledHuntingModeElement =\r\n    findNode('//select[@name=\"enabledHuntingMode\"]', oForm);\r\n  var enabledHuntingMode = enabledHuntingModeElement.value;\r\n  setValue('enabledHuntingMode', enabledHuntingMode);\r\n\r\n  saveBoxes.forEach(saveValueForm.bind(null, oForm));\r\n\r\n  $('#dialog_msg').text('FS Helper Settings Saved').dialog('open');\r\n}\r\n\r\nfunction showLogs() {\r\n  sendEvent('settingsPage', 'injectNotepadShowLogs');\r\n  jQueryDialog(injectNotepadShowLogs);\r\n}\r\n\r\nfunction showMonsterLogs() {\r\n  sendEvent('settingsPage', 'injectMonsterLog');\r\n  jQueryDialog(injectMonsterLog);\r\n}\r\n\r\nfunction createEventListeners() {\r\n  var tickAll = createSpan({\r\n    id: 'fshAllBuffs',\r\n    className: 'fshLink',\r\n    textContent: 'Tick all buffs'\r\n  });\r\n  tickAll.addEventListener('click', toggleTickAllBuffs);\r\n  var inject = getElementById('settingsTabs-4').firstElementChild\r\n    .rows[0].cells[0];\r\n  insertElement(inject, createBr());\r\n  insertElement(inject, tickAll);\r\n\r\n  getElementById('fshClearStorage')\r\n    .addEventListener('click', clearStorage);\r\n\r\n  getElementById('Helper:SaveOptions')\r\n    .addEventListener('click', saveConfig);\r\n  getElementById('Helper:ShowLogs')\r\n    .addEventListener('click', showLogs);\r\n  getElementById('Helper:ShowMonsterLogs')\r\n    .addEventListener('click', showMonsterLogs);\r\n\r\n  getElementById('toggleShowGuildSelfMessage')\r\n    .addEventListener('click', toggleVisibilty);\r\n  getElementById('toggleShowGuildFrndMessage')\r\n    .addEventListener('click', toggleVisibilty);\r\n  getElementById('toggleShowGuildPastMessage')\r\n    .addEventListener('click', toggleVisibilty);\r\n  getElementById('toggleShowGuildEnmyMessage')\r\n    .addEventListener('click', toggleVisibilty);\r\n}\r\n\r\nexport default function injectSettings() { // jQuery.min\r\n  if (jQueryNotPresent()) {return;}\r\n  getVars();\r\n  setupConfigData();\r\n  var settingsTabs = getElementById('settingsTabs');\r\n  insertHtmlBeforeEnd(settingsTabs, '<div id=\"fshSettings\">' +\r\n    calf.configData + '</div>');\r\n  if ($(settingsTabs).tabs('length') > 0) {\r\n    $(settingsTabs).tabs('add', '#fshSettings', 'FSH Settings');\r\n  }\r\n  createEventListeners();\r\n  setValue('minGroupLevel', getElementById('settingsTabs-1')\r\n    .firstElementChild.lastElementChild.rows[1].cells[1].firstElementChild\r\n    .value);\r\n}\r\n","import createDocument from '../system/createDocument';\r\nimport fallback from '../system/fallback';\r\nimport intValue from '../system/intValue';\r\nimport reduceBuffArray from './reduceBuffArray';\r\n\r\nfunction getStat(stat, doc) { // jQuery\r\n  // 'Hidden' returns NaN\r\n  return intValue(\r\n    $(stat, doc)\r\n      .contents()\r\n      .filter(function(i, e) {\r\n        return e.nodeType === 3;\r\n      })[0].nodeValue\r\n  );\r\n}\r\n\r\nfunction getBuffLevel(doc, buff) { // jQuery\r\n  var hasBuff = $('img.tip-static[data-tipped*=\"b>' + buff + '</b\"]', doc)\r\n    .data('tipped');\r\n  // var re = new RegExp('</b> \\\\(Level: (\\\\d+)\\\\)');\r\n  var test = /<\\/b> \\(Level: (\\d+)\\)/.exec(hasBuff);\r\n  if (test) {return intValue(test[1]);}\r\n  return 0;\r\n}\r\n\r\nfunction getBonus(stat, doc) { // jQuery\r\n  var target = $(stat, doc);\r\n  var children = target.children();\r\n  if (children.length === 0) {\r\n    children = target.next();\r\n  }\r\n  return intValue(children.text().slice(2, -1));\r\n}\r\n\r\nfunction cloakGuess(bonus, level) {\r\n  if (bonus > level * 10 ||\r\n      bonus < level) {\r\n    return bonus;\r\n  }\r\n  return level * 10;\r\n}\r\n\r\nfunction updateForCloak(obj) {\r\n  obj.attackValue = cloakGuess(obj.attackBonus, obj.levelValue);\r\n  obj.defenseValue = cloakGuess(obj.defenseBonus, obj.levelValue);\r\n  obj.armorValue = cloakGuess(obj.armorBonus, obj.levelValue);\r\n  obj.damageValue = cloakGuess(obj.damageBonus, obj.levelValue);\r\n  obj.hpValue = obj.hpBonus;\r\n}\r\n\r\nfunction attackValueIsNumber(atk) {\r\n  return typeof atk === 'number' && !isNaN(atk);\r\n}\r\n\r\nexport function playerDataString(responseText) {\r\n  var doc = createDocument(responseText);\r\n  var obj = {\r\n    levelValue: getStat('#stat-vl', doc),\r\n    attackValue: getStat('#stat-attack', doc),\r\n    attackBonus: getBonus('#stat-attack', doc),\r\n    defenseValue: getStat('#stat-defense', doc),\r\n    defenseBonus: getBonus('#stat-defense', doc),\r\n    armorValue: getStat('#stat-armor', doc),\r\n    armorBonus: getBonus('#stat-armor', doc),\r\n    damageValue: getStat('#stat-damage', doc),\r\n    damageBonus: getBonus('#stat-damage', doc),\r\n    hpValue: getStat('#stat-hp', doc),\r\n    hpBonus: getBonus('#stat-hp', doc),\r\n    killStreakValue: getStat('#stat-kill-streak', doc),\r\n    // get buffs here later ... DD, CA, DC, Constitution, etc\r\n    counterAttackLevel: getBuffLevel(doc, 'Counter Attack'),\r\n    doublerLevel: getBuffLevel(doc, 'Doubler'),\r\n    deathDealerLevel: getBuffLevel(doc, 'Death Dealer'),\r\n    darkCurseLevel: getBuffLevel(doc, 'Dark Curse'),\r\n    holyFlameLevel: getBuffLevel(doc, 'Holy Flame'),\r\n    constitutionLevel: getBuffLevel(doc, 'Constitution'),\r\n    sanctuaryLevel: getBuffLevel(doc, 'Sanctuary'),\r\n    flinchLevel: getBuffLevel(doc, 'Flinch'),\r\n    nightmareVisageLevel: getBuffLevel(doc, 'Nightmare Visage'),\r\n    superEliteSlayerLevel: getBuffLevel(doc, 'Super Elite Slayer'),\r\n    fortitudeLevel: getBuffLevel(doc, 'Fortitude'),\r\n    chiStrikeLevel: getBuffLevel(doc, 'Chi Strike'),\r\n    terrorizeLevel: getBuffLevel(doc, 'Terrorize'),\r\n    barricadeLevel: getBuffLevel(doc, 'Barricade'),\r\n    reignOfTerrorLevel: getBuffLevel(doc, 'Reign Of Terror'),\r\n    anchoredLevel: getBuffLevel(doc, 'Anchored'),\r\n    severeConditionLevel: getBuffLevel(doc, 'Severe Condition'),\r\n    entrenchLevel: getBuffLevel(doc, 'Entrench'),\r\n    cloakLevel: getBuffLevel(doc, 'Cloak')\r\n  };\r\n  obj.superEliteSlayerMultiplier = Math.round(0.002 *\r\n    obj.superEliteSlayerLevel * 100) / 100;\r\n\r\n  if (obj.cloakLevel === 0 ||\r\n      attackValueIsNumber(obj.attackValue)) {\r\n    return obj;\r\n  }\r\n\r\n  updateForCloak(obj);\r\n  return obj;\r\n}\r\n\r\nfunction getBuffLvl(buffs, buff) {\r\n  return fallback(buffs[buff], 0);\r\n}\r\n\r\nexport function playerDataObject(json) {\r\n  var buffs = reduceBuffArray(json._skills);\r\n  var obj = {\r\n    levelValue: json.level,\r\n    attackValue: json.attack,\r\n    attackBonus: json.bonus_attack,\r\n    defenseValue: json.defense,\r\n    defenseBonus: json.bonus_defense,\r\n    armorValue: json.armor,\r\n    armorBonus: json.bonus_armor,\r\n    damageValue: json.damage,\r\n    damageBonus: json.bonus_damage,\r\n    hpValue: json.hp,\r\n    hpBonus: json.bonus_hp,\r\n    killStreakValue: intValue(json.killstreak),\r\n    // get buffs here later ... DD, CA, DC, Constitution, etc\r\n    counterAttackLevel: getBuffLvl(buffs, 'Counter Attack'),\r\n    doublerLevel: getBuffLvl(buffs, 'Doubler'),\r\n    deathDealerLevel: getBuffLvl(buffs, 'Death Dealer'),\r\n    darkCurseLevel: getBuffLvl(buffs, 'Dark Curse'),\r\n    holyFlameLevel: getBuffLvl(buffs, 'Holy Flame'),\r\n    constitutionLevel: getBuffLvl(buffs, 'Constitution'),\r\n    sanctuaryLevel: getBuffLvl(buffs, 'Sanctuary'),\r\n    flinchLevel: getBuffLvl(buffs, 'Flinch'),\r\n    nightmareVisageLevel: getBuffLvl(buffs, 'Nightmare Visage'),\r\n    superEliteSlayerLevel: getBuffLvl(buffs, 'Super Elite Slayer'),\r\n    fortitudeLevel: getBuffLvl(buffs, 'Fortitude'),\r\n    chiStrikeLevel: getBuffLvl(buffs, 'Chi Strike'),\r\n    terrorizeLevel: getBuffLvl(buffs, 'Terrorize'),\r\n    barricadeLevel: getBuffLvl(buffs, 'Barricade'),\r\n    reignOfTerrorLevel: getBuffLvl(buffs, 'Reign Of Terror'),\r\n    anchoredLevel: getBuffLvl(buffs, 'Anchored'),\r\n    severeConditionLevel: getBuffLvl(buffs, 'Severe Condition'),\r\n    entrenchLevel: getBuffLvl(buffs, 'Entrench'),\r\n    cloakLevel: getBuffLvl(buffs, 'Cloak')\r\n  };\r\n  if (obj.cloakLevel !== 0) {updateForCloak(obj);}\r\n  return obj;\r\n}\r\n","import callApp from '../callApp';\r\n\r\nexport default function guildView(guildId) {\r\n  return callApp({cmd: 'guild', subcmd: 'view', guild_id: guildId});\r\n}\r\n","import add from '../support/task';\r\nimport fallback from '../system/fallback';\r\nimport {getElementById} from '../common/getElement';\r\nimport getInventoryById from '../ajax/getInventoryById';\r\nimport insertElement from '../common/insertElement';\r\nimport insertElementBefore from '../common/insertElementBefore';\r\nimport insertHtmlBeforeBegin from '../common/insertHtmlBeforeBegin';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {createDiv, createTr} from '../common/cElement';\r\nimport {time, timeEnd} from '../support/debug';\r\n\r\nvar invItems;\r\n\r\nfunction getItemDiv() {\r\n  var itemDiv = getElementById('item-div');\r\n  if (!itemDiv) {\r\n    itemDiv = createDiv({id: 'item-div', className: 'itemDiv'});\r\n    var itemList = getElementById('item-list');\r\n    var oldItems = itemList.getElementsByTagName('table');\r\n    while (oldItems.length) {\r\n      oldItems[0].classList.add('fshBlock');\r\n      insertElement(itemDiv, oldItems[0]);\r\n    }\r\n    itemList.parentNode.insertBefore(itemDiv, itemList);\r\n  }\r\n  return itemDiv;\r\n}\r\n\r\nfunction shouldShow(hidden, all, hasFolder) {\r\n  return hidden && fallback(all, hasFolder);\r\n}\r\n\r\nfunction shouldHide(hidden, all, hasFolder) {\r\n  return !hidden && !all && !hasFolder;\r\n}\r\n\r\nfunction doHideFolder(evt) {\r\n  var folderid = evt.target.id;\r\n  var itemDiv = getItemDiv();\r\n  var items = itemDiv.getElementsByTagName('table');\r\n  Array.prototype.forEach.call(items, function(el) {\r\n    el.firstElementChild.lastElementChild.firstElementChild\r\n      .firstElementChild.checked = false;\r\n    var hidden = el.classList.contains('fshHide');\r\n    var all = folderid === 'folderid0';\r\n    var hasFolder = el.classList.contains(folderid);\r\n    if (shouldShow(hidden, all, hasFolder)) {\r\n      el.classList.remove('fshHide');\r\n      el.classList.add('fshBlock'); // show()\r\n    }\r\n    if (shouldHide(hidden, all, hasFolder)) {\r\n      el.classList.remove('fshBlock');\r\n      el.classList.add('fshHide'); // hide()\r\n    }\r\n  });\r\n}\r\n\r\nfunction hideFolder(evt) {\r\n  if (evt.target.nodeName === 'SPAN' &&\r\n      evt.target.id.indexOf('folderid') !== -1) {doHideFolder(evt);}\r\n}\r\n\r\nfunction doFolderHeaders(folders) {\r\n  var folderCell = '<td colspan=6>';\r\n  // append main folder\r\n  folderCell += '<span id=\"folderid0\" class=\"fshLink\" fid=0>All</span>' +\r\n    ' &ensp;<span id=\"folderid-1\" class=\"fshLink\" fid=\"-1\">Main</span>';\r\n  Object.keys(folders).forEach(function(key) {\r\n    folderCell += ' &ensp;<span id=\"folderid' + key +\r\n      '\" class=\"fshLink fshNoWrap\" fid=' + key + '>' +\r\n      folders[key] + '</span> ';\r\n  });\r\n  var foldersRow = createTr({\r\n    id: 'fshFolderSelect',\r\n    innerHTML: folderCell\r\n  });\r\n  foldersRow.addEventListener('click', hideFolder);\r\n  var el = getElementById('item-list').parentNode.parentNode;\r\n  insertHtmlBeforeBegin(el, '<tr id=\"fshShowSTs\">' +\r\n    '<td align=\"center\" colspan=6>' +\r\n    '<label><input type=\"checkbox\" id=\"itemsInSt\" checked> ' +\r\n    'Select items in ST</label></td></tr>');\r\n  insertElementBefore(foldersRow, el);\r\n}\r\n\r\nfunction stColor(el, item) {\r\n  if (item.is_in_st) {\r\n    el.classList.add('isInST');\r\n  } else {el.classList.add('tradeItemMargin');}\r\n}\r\n\r\nfunction forEachInvItem(el) {\r\n  var checkbox = el.firstElementChild.lastElementChild.firstElementChild\r\n    .firstElementChild;\r\n  var item = invItems[checkbox.getAttribute('value')];\r\n  if (item) {\r\n    el.classList.add('folderid' + item.folder_id);\r\n    if (invItems.fshHasST) {stColor(el, item);}\r\n    checkbox.classList.add('itemid' + item.item_id);\r\n    checkbox.classList.add('itemtype' + item.type);\r\n  }\r\n}\r\n\r\nfunction processTrade(data) {\r\n\r\n  time('trade.processTrade');\r\n\r\n  invItems = data.items;\r\n  /* Highlight items in ST */\r\n  var nodeList = getElementById('item-list')\r\n    .getElementsByTagName('table');\r\n  Array.prototype.forEach.call(nodeList, forEachInvItem);\r\n  doFolderHeaders(data.folders);\r\n\r\n  timeEnd('trade.processTrade');\r\n\r\n}\r\n\r\nexport default function doFolders() { // jQuery.min\r\n  if (jQueryNotPresent()) {return;}\r\n  getInventoryById().done(function(data) {\r\n    add(3, processTrade, [data]);\r\n  });\r\n}\r\n","import add from '../support/task';\r\nimport {colouredDots} from '../common/colouredDots';\r\nimport currentGuildId from '../common/currentGuildId';\r\nimport getUrlParameter from '../system/getUrlParameter';\r\nimport getValue from '../system/getValue';\r\nimport {lastActivityRE} from '../support/constants';\r\nimport {\r\n  calculateBoundaries,\r\n  gvgLowerLevel,\r\n  gvgUpperLevel,\r\n  pvpLowerLevel,\r\n  pvpUpperLevel\r\n} from '../common/levelHighlight';\r\nimport {guildXPLock, removeGuildAvyImgBorder} from './guildUtils';\r\n\r\nvar highlightPlayersNearMyLvl;\r\nvar highlightGvGPlayersNearMyLvl;\r\n\r\nfunction isPvpTarget(vlevel) {\r\n  return highlightPlayersNearMyLvl &&\r\n    vlevel >= pvpLowerLevel &&\r\n    vlevel <= pvpUpperLevel;\r\n}\r\n\r\nfunction isGvgTarget(vlevel) {\r\n  return highlightGvGPlayersNearMyLvl &&\r\n    vlevel >= gvgLowerLevel &&\r\n    vlevel <= gvgUpperLevel;\r\n}\r\n\r\nfunction isActive(el, tipped) {\r\n  var vlevel = Number(/VL:.+?(\\d+)/.exec(tipped)[1]);\r\n  var aRow = el.parentNode.parentNode;\r\n  if (isPvpTarget(vlevel)) {\r\n    aRow.classList.add('lvlHighlight');\r\n  } else if (isGvgTarget(vlevel)) {\r\n    aRow.classList.add('lvlGvGHighlight');\r\n  }\r\n}\r\n\r\nfunction highlightMembers(el) {\r\n  var tipped = el.dataset.tipped;\r\n  var lastActDays = lastActivityRE.exec(tipped)[1];\r\n  if (lastActDays < 7) {isActive(el, tipped);}\r\n}\r\n\r\nfunction dontHighlight() {\r\n  return Number(getUrlParameter('guild_id')) === currentGuildId() ||\r\n    !highlightPlayersNearMyLvl && !highlightGvGPlayersNearMyLvl;\r\n}\r\n\r\nexport default function injectViewGuild() {\r\n  add(3, colouredDots);\r\n  removeGuildAvyImgBorder();\r\n  guildXPLock();\r\n  highlightPlayersNearMyLvl = getValue('highlightPlayersNearMyLvl');\r\n  highlightGvGPlayersNearMyLvl = getValue('highlightGvGPlayersNearMyLvl');\r\n  if (dontHighlight()) {return;}\r\n  calculateBoundaries();\r\n  var memList = document.querySelectorAll(\r\n    '#pCC a[data-tipped*=\"<td>VL:</td>\"]');\r\n  Array.prototype.forEach.call(memList, highlightMembers);\r\n}\r\n","import add from '../support/task';\r\nimport calf from '../support/calf';\r\nimport {createTr} from '../common/cElement';\r\nimport {defaults} from '../support/dataObj';\r\nimport doFolders from './doFolders';\r\nimport fallback from '../system/fallback';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport jsonParse from '../common/jsonParse';\r\n\r\nfunction getHowMany(itemTables) {\r\n  var howMany = parseInt(getElementById('fshSendHowMany').value, 10);\r\n  if (isNaN(howMany)) {return itemTables.length;}\r\n  // maximum of 100 items in an ST\r\n  if (calf.subcmd !== '-') {return Math.min(100, howMany);}\r\n  return howMany;\r\n}\r\n\r\nfunction itemType(itemid, checkbox) {\r\n  return itemid === 'itemid-2' && checkbox.classList.contains('itemtype12');\r\n}\r\n\r\nfunction shouldBeChecked(itemid, checkbox) {\r\n  return itemid === 'itemid-1' ||\r\n    itemType(itemid, checkbox) ||\r\n    checkbox.classList.contains(itemid);\r\n}\r\n\r\nfunction canBeChecked(howMany, itemsInSt, el, itemid, checkbox) {\r\n  return howMany &&\r\n    fallback(itemsInSt, !el.classList.contains('isInST')) &&\r\n    shouldBeChecked(itemid, checkbox);\r\n}\r\n\r\nfunction findStCheck() {\r\n  var cbox = getElementById('itemsInSt');\r\n  if (cbox) {return cbox.checked;}\r\n}\r\n\r\nfunction doCheckAll(evt) {\r\n  var itemid = evt.target.id;\r\n  var itemList = getElementById('item-div') ||\r\n    getElementById('item-list');\r\n  var itemTables = itemList.querySelectorAll('table:not(.fshHide)');\r\n  //#if _BETA  //  sendClasses\r\n  console.log('itemTables', itemTables); // eslint-disable-line no-console\r\n  //#endif\r\n  var howMany = getHowMany(itemTables);\r\n  var itemsInSt = findStCheck();\r\n  Array.prototype.forEach.call(itemTables, function(el) {\r\n    var checkbox = el.firstElementChild.lastElementChild.firstElementChild\r\n      .firstElementChild;\r\n    if (canBeChecked(howMany, itemsInSt, el, itemid, checkbox)) {\r\n      checkbox.checked = true;\r\n      howMany -= 1;\r\n      return;\r\n    }\r\n    checkbox.checked = false;\r\n  });\r\n}\r\n\r\nfunction toggleAllPlants(evt) {\r\n  //#if _BETA  //  sendClasses\r\n  console.log('toggleAllPlants', evt.target.className); // eslint-disable-line no-console\r\n  //#endif\r\n  if (evt.target.classList.contains('fshCheckAll')) {doCheckAll(evt);}\r\n}\r\n\r\nfunction getItemList() {\r\n  var sendClasses = getValue('sendClasses');\r\n  var itemList = jsonParse('[' + sendClasses + ']');\r\n  if (itemList) {return itemList;}\r\n  return jsonParse('[' + defaults.sendClasses + ']');\r\n}\r\n\r\nfunction injectTradeOld() {\r\n  var myTd = '<td colspan=6>Select:&ensp;<span id=\"itemid-1\" ' +\r\n    'class=\"fshCheckAll fshLink fshNoWrap\">All Items</span> &ensp;' +\r\n    '<span id=\"itemid-2\" ' +\r\n    'class=\"fshCheckAll fshLink fshNoWrap\">All Resources</span>';\r\n  var itemList = getItemList();\r\n  itemList.forEach(function(el) {\r\n    myTd += ' &ensp;<span id=\"itemid' + el[1] +\r\n      '\" class=\"fshCheckAll fshLink fshNoWrap\">' + el[0] + '</span>';\r\n  });\r\n  myTd += ' &ensp;How&nbsp;many:<input id=\"fshSendHowMany\" type=\"text\" ' +\r\n    'class=\"custominput\" value=\"all\" size=3></td>';\r\n  var multiple = createTr({\r\n    id: 'fshSelectMultiple',\r\n    innerHTML: myTd\r\n  });\r\n  multiple.addEventListener('click', toggleAllPlants);\r\n  var el = getElementById('item-list').parentNode.parentNode;\r\n  el.parentNode.insertBefore(multiple, el);\r\n}\r\n\r\nexport default function injectTrade() {\r\n  add(3, doFolders);\r\n  add(3, injectTradeOld);\r\n}\r\n","import addCommas from '../system/addCommas';\r\nimport createDocument from '../system/createDocument';\r\nimport findNode from '../system/findNode';\r\nimport getValue from '../system/getValue';\r\nimport intValue from '../system/intValue';\r\nimport isUndefined from '../common/isUndefined';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport setValue from '../system/setValue';\r\n\r\nvar impStyles = [\r\n  ' style=\"color:red; font-size:large; font-weight:bold\"',\r\n  ' style=\"color:Orangered; font-size:large; font-weight:bold\"',\r\n  ' style=\"color:Orangered; font-size:medium; font-weight:bold;\"'\r\n];\r\n\r\nfunction getImpWarningStyle(impsRem) { // Legacy\r\n  if (impsRem >= 0 && impsRem <= 2) {\r\n    return impStyles[impsRem];\r\n  }\r\n  return ' style=\"color:green; font-size:medium;\"';\r\n}\r\n\r\nfunction impWarning(impsRem) { // Legacy\r\n  var applyImpWarningColor = getImpWarningStyle(impsRem);\r\n  var recastButton = '';\r\n  if (impsRem === 0) {\r\n    recastButton = '&nbsp;<span id=\"Helper:recastImpAndRefresh\" ' +\r\n      'style=\"color: blue; cursor: pointer; text-decoration: underline; ' +\r\n      'font-size: xx-small;\">Recast</span>';\r\n  }\r\n  return '<tr><td' + applyImpWarningColor + '>Shield Imps Remaining: ' +\r\n    impsRem.toString() + recastButton + '</td></tr>';\r\n}\r\n\r\nfunction getKillStreak(responseText) { // Hybrid\r\n  var doc = createDocument(responseText);\r\n  var killStreakLocation = $(doc).find('td:contains(\"Streak:\"):last').next();\r\n  //#if _DEV  //  killStreakLocation TODO WTF?\r\n  console.log('killStreakLocation', killStreakLocation); // eslint-disable-line no-console\r\n  //#endif\r\n  var playerKillStreakValue;\r\n  if (killStreakLocation.length > 0) {\r\n    playerKillStreakValue = intValue(killStreakLocation.text());\r\n  }\r\n  var killStreakElement = findNode('//span[@findme=\"killstreak\"]');\r\n  killStreakElement.innerHTML = addCommas(playerKillStreakValue);\r\n  setValue('lastKillStreak', playerKillStreakValue);\r\n  var deathDealerBuff =\r\n    findNode('//img[contains(@data-tipped,\"Death Dealer\")]');\r\n  var deathDealerRE = /<b>Death Dealer<\\/b> \\(Level: (\\d+)\\)/;\r\n  var deathDealer = deathDealerRE.exec($(deathDealerBuff).data('tipped'));\r\n  var deathDealerPercentage;\r\n  if (deathDealer) {\r\n    var deathDealerLevel = deathDealer[1];\r\n    deathDealerPercentage = Math.min(Math.round(\r\n      Math.floor(playerKillStreakValue / 5) * deathDealerLevel\r\n    ) * 0.01, 20);\r\n  }\r\n  var deathDealerPercentageElement =\r\n    findNode('//span[@findme=\"damagebonus\"]');\r\n  deathDealerPercentageElement.innerHTML = deathDealerPercentage;\r\n  setValue('lastDeathDealerPercentage', deathDealerPercentage);\r\n}\r\n\r\nfunction getLastValue(pref) {\r\n  var val = getValue(pref);\r\n  if (isUndefined(val)) {\r\n    setValue(pref, 0);\r\n    val = 0;\r\n  }\r\n  return val;\r\n}\r\n\r\nfunction getTrackText(trackKillStreak) { // Legacy\r\n  if (trackKillStreak) {return 'ON';}\r\n  return 'off';\r\n}\r\n\r\nfunction notMaxDd(lastDeathDealerPercentage, lastKillStreak) {\r\n  var trackKillStreak = getValue('trackKillStreak');\r\n  var trackText = getTrackText(trackKillStreak);\r\n  if (!trackKillStreak) {\r\n    return '<tr><td style=\"font-size:small; color:' +\r\n      'navy\" nowrap>KillStreak tracker disabled. <span style=\"' +\r\n      'font-size:xx-small\">Track: <span id=Helper:toggleKS' +\r\n      'tracker style=\"color:navy;cursor:pointer;text-' +\r\n      'decoration:underline;\" title=\"Click to toggle\">' +\r\n      trackText + '</span></span></td></tr>';\r\n  }\r\n  retryAjax('index.php?no_mobile=1&cmd=profile').done(getKillStreak);\r\n  return '<tr><td style=\"font-size:small; color:' +\r\n    'navy\" nowrap>KillStreak: <span findme=\"killstreak\">' +\r\n    addCommas(lastKillStreak) + '</span> Damage bonus' +\r\n    ': <span findme=\"damagebonus\">' +\r\n    Math.round(lastDeathDealerPercentage * 100) / 100 +\r\n    '</span>%&nbsp;<span style=\"font-size:xx-small\">Track: ' +\r\n    '<span id=Helper:toggleKStracker style=\"color:navy;' +\r\n    'cursor:pointer;text-decoration:underline;\" title=\"Click' +\r\n    ' to toggle\">' + trackText + '</span></span></td></tr>';\r\n}\r\n\r\nfunction doDeathDealer(impsRem) { // Legacy\r\n  var lastDeathDealerPercentage = getLastValue('lastDeathDealerPercentage');\r\n  var lastKillStreak = getLastValue('lastKillStreak');\r\n  if (impsRem > 0 && lastDeathDealerPercentage === 20) {\r\n    return '<tr><td style=\"font-size:small; color:black\"' +\r\n      '>Kill Streak: <span findme=\"killstreak\">&gt;' +\r\n      addCommas(lastKillStreak) + '</span> Damage bonus: <' +\r\n      'span findme=\"damagebonus\">20</span>%</td></tr>';\r\n  }\r\n  return notMaxDd(lastDeathDealerPercentage, lastKillStreak);\r\n}\r\n\r\nfunction getImpHp(hasDd, impsRem) { // Legacy - Old Map\r\n  var ret = impWarning(impsRem);\r\n  if (hasDd) {\r\n    ret += doDeathDealer(impsRem);\r\n  }\r\n  return ret;\r\n}\r\n\r\nexport default function findImps(hasDd, hasSsi, impsRem) { // Legacy - Old Map\r\n  if (hasDd || hasSsi) {\r\n    return getImpHp(hasDd, impsRem);\r\n  }\r\n  return '';\r\n}\r\n","var re = /(\\d+) HP remaining/;\r\n\r\nexport default function getImpsRemaining(hasSsi) { // Legacy - Old Map\r\n  var impsRem = 0;\r\n  if (hasSsi) {\r\n    var textToTest = $(hasSsi).data('tipped');\r\n    var impsRemainingRE = re.exec(textToTest);\r\n    impsRem = Number(impsRemainingRE[1]);\r\n  }\r\n  return impsRem;\r\n}\r\n","import findNode from '../system/findNode';\r\n\r\nfunction getCaLvl(hasCounterAttack) { // Legacy\r\n  var counterAttackLevel;\r\n  if (hasCounterAttack.getAttribute('src').search('/skills/') !== -1) {\r\n    var onmouseover = $(hasCounterAttack).data('tipped');\r\n    var counterAttackRE = /<b>Counter Attack<\\/b> \\(Level: (\\d+)\\)/;\r\n    var counterAttack = counterAttackRE.exec(onmouseover);\r\n    if (counterAttack) {\r\n      counterAttackLevel = counterAttack[1];\r\n    }\r\n  }\r\n  return '<tr><td style=\"font-size:small; color:' +\r\n    'blue\">CA' + counterAttackLevel + ' active</td></tr>';\r\n}\r\n\r\nexport default function hasCA() { // Legacy\r\n  var replacementText = '';\r\n  var hasCounterAttack = findNode('//img[contains(@src,\"/54_sm.gif\")]');\r\n  if (hasCounterAttack) {\r\n    replacementText += getCaLvl(hasCounterAttack);\r\n  }\r\n  return replacementText;\r\n}\r\n","import findNode from '../system/findNode';\r\n\r\nvar doublerRE = /<b>Doubler<\\/b> \\(Level: (\\d+)\\)/;\r\n\r\nfunction doublerLvl(onmouseover) { // Legacy\r\n  var doubler = doublerRE.exec(onmouseover);\r\n  if (doubler) {return doubler[1];}\r\n}\r\n\r\nfunction getDoublerLevel(hasDoubler) { // Legacy\r\n  var doublerLevel;\r\n  if (hasDoubler.getAttribute('src').search('/skills/') !== -1) {\r\n    var onmouseover = $(hasDoubler).data('tipped');\r\n    doublerLevel = doublerLvl(onmouseover);\r\n  }\r\n  if (doublerLevel === 200) { // ???\r\n    return '<tr><td style=\"font-size:small; color:' +\r\n      'red\">Doubler ' + doublerLevel + ' active</td></tr>';\r\n  }\r\n  return '';\r\n}\r\n\r\nexport default function hasDblr() { // Legacy\r\n  var hasDoubler = findNode('//img[contains(@src,\"/26_sm.gif\")]');\r\n  if (hasDoubler) {\r\n    return getDoublerLevel(hasDoubler);\r\n  }\r\n  return '';\r\n}\r\n","import {def_suffixSuccessActionResponse} from '../support/constants';\r\nimport getForage from '../ajax/getForage';\r\nimport getValue from '../system/getValue';\r\nimport setForage from '../ajax/setForage';\r\n\r\n// Taking the Not Save in case they add new enhancements.\r\nvar notSave = ['Breaker', 'Protection', 'Master Thief', 'Protect Gold',\r\n  'Disarm', 'Duelist', 'Thievery', 'Master Blacksmith', 'Master Crafter',\r\n  'Fury Caster', 'Master Inventor', 'Sustain'];\r\nvar combatLog = [];\r\nvar combatData;\r\n\r\nfunction storeBuffs(buff) {\r\n  if (buff.id === 54 || buff.id === 26) {\r\n    combatData.player.buffs[buff.id] = parseInt(buff.level, 10);\r\n  }\r\n}\r\n\r\nfunction storeEnhancements(enh) {\r\n  if (notSave.indexOf(enh.name) === -1) {\r\n    combatData.player.enhancements[enh.name] = enh.value;\r\n  }\r\n}\r\n\r\nfunction hazBuffs(data) {\r\n  if (data.player.buffs) {\r\n    data.player.buffs.forEach(storeBuffs); // loop through buffs, only need to keep CA and Doubler 54 = ca, 26 = doubler\r\n  }\r\n}\r\n\r\nfunction hazEnhancements(data) {\r\n  if (data.player.enhancements) {\r\n    data.player.enhancements.forEach(storeEnhancements); // loop through enhancements\r\n  }\r\n}\r\n\r\nfunction processCombatResponse(e, data) {\r\n  combatData = {};\r\n  combatData.combat = data.response.data;\r\n  if (combatData.combat.inventory_id) {\r\n    combatData.combat.drop = combatData.combat.item.id;\r\n  }\r\n\r\n  combatData.player = {};\r\n  combatData.player.buffs = {};\r\n  combatData.player.enhancements = {};\r\n  hazBuffs(data);\r\n  hazEnhancements(data);\r\n  combatData.time = data.time;\r\n  combatLog.push(combatData);\r\n  setForage('fsh_combatLog', combatLog);\r\n}\r\n\r\nfunction combatResponse(e, data) {\r\n  // If bad response do nothing.\r\n  if (data.response.response === 0) {processCombatResponse(e, data);}\r\n}\r\n\r\nfunction gotCombatLog(data) { // jQuery.min\r\n  if (data) {combatLog = data;}\r\n  $.subscribe('2' + def_suffixSuccessActionResponse, combatResponse);\r\n}\r\n\r\nexport default function combatLogger() { // jQuery.min\r\n  if (getValue('keepLogs')) {\r\n    getForage('fsh_combatLog').done(gotCombatLog);\r\n  }\r\n}\r\n","import calf from '../support/calf';\r\nimport {def_afterUpdateActionlist} from '../support/constants';\r\nimport {getElementById} from '../common/getElement';\r\nimport isFunction from '../common/isFunction';\r\nimport isUndefined from '../common/isUndefined';\r\n\r\nvar oldDoAction;\r\n\r\nexport function afterUpdateActionList() {\r\n  // color the critters in the do no kill list blue\r\n  var act = getElementById('actionList');\r\n  var creatures = act.getElementsByClassName('creature');\r\n  Array.prototype.forEach.call(creatures, function(el) {\r\n    el.classList.toggle('fshBlue',\r\n      calf.doNotKillList.indexOf(el.textContent) !== -1);\r\n  });\r\n}\r\n\r\nvar actionsToIntercept = {\r\n  // def_creatureCombat\r\n  '2': function(action, fetch, data, attempts) {\r\n    // Do custom stuff e.g. do not kill list\r\n    var creature = GameData.actions()[data.passback];\r\n    if (creature) {\r\n      var creatureName = creature.data.name;\r\n      if (calf.doNotKillList.indexOf(creatureName) !== -1) {\r\n        $('#actionList div.header').eq(data.passback)\r\n          .find('a.icon').removeClass('loading');\r\n        return;\r\n      }\r\n    }\r\n    // Call standard action\r\n    oldDoAction(action, fetch, data, attempts);\r\n  }\r\n};\r\n\r\nfunction firstAttempt(attempts) {\r\n  return isUndefined(attempts) || attempts === 0;\r\n}\r\n\r\nfunction goodInterceptFunction(interceptFunction) {\r\n  return interceptFunction && isFunction(interceptFunction);\r\n}\r\n\r\nfunction maybeIntercept(action, fetch, data, attempts) {\r\n  var interceptFunction = actionsToIntercept[action];\r\n  if (goodInterceptFunction(interceptFunction) && firstAttempt(attempts)) {\r\n    interceptFunction(action, fetch, data, attempts);\r\n  } else {\r\n    oldDoAction(action, fetch, data, attempts);\r\n  }\r\n}\r\n\r\nfunction interceptDoAction() {\r\n  oldDoAction = GameData.doAction;\r\n  GameData.doAction = maybeIntercept;\r\n}\r\n\r\nexport default function doNotKill() {\r\n  $.subscribe(def_afterUpdateActionlist, afterUpdateActionList);\r\n  afterUpdateActionList();\r\n  // then intercept the action call\r\n  interceptDoAction();\r\n}\r\n","export var atkStats = '<table class=\"relicT relicS\"><thead>' +\r\n  '<tr><th colspan=\"2\">Adjusted defense values</th></tr></thead><tbody>' +\r\n  '<tr><td>DC225:</td><td id=\"DC225\">0</td></tr>' +\r\n  '<tr><td>DC175:</td><td id=\"DC175\">0</td></tr>' +\r\n  '<tr><td colspan=\"2\">&nbsp;</td></tr></tbody><thead>' +\r\n  '<tr><th colspan=\"2\">Attacking Group Stats</th></tr></thead><tbody>' +\r\n  '<tr><td>Raw Group Attack:</td>' +\r\n    '<td class=\"fshGrey\" id=\"GroupAttack\"></td></tr>' +\r\n  '<tr><td>Group Attack w/ buffs:</td><td id=\"GroupAttackBuffed\"></td></tr>' +\r\n  '<tr><td>Raw Group Defense:</td>' +\r\n    '<td class=\"fshGrey\" id=\"GroupDefense\"></td></tr>' +\r\n  '<tr><td>Group Defense w/ buffs:</td>' +\r\n    '<td id=\"GroupDefenseBuffed\"></td></tr>' +\r\n  '<tr><td>Raw Group Armor:</td>' +\r\n    '<td class=\"fshGrey\" id=\"GroupArmor\"></td></tr>' +\r\n  '<tr><td>Group Armor w/ buffs:</td><td id=\"GroupArmorBuffed\"></td></tr>' +\r\n  '<tr><td>Raw Group Damage:</td>' +\r\n    '<td class=\"fshGrey\" id=\"GroupDamage\"></td></tr>' +\r\n  '<tr><td>Group Damage w/ buffs:</td><td id=\"GroupDamageBuffed\"></td></tr>' +\r\n  '<tr><td>Raw Group HP:</td><td class=\"fshGrey\" id=\"GroupHP\"></td></tr>' +\r\n  '<tr><td>Group HP w/ buffs:</td><td id=\"GroupHPBuffed\"></td></tr>' +\r\n  '</tbody></table>';\r\nexport var defStats = '<table class=\"relicT relicS\"><thead>' +\r\n  '<tr><th colspan=\"2\">Defending Guild Stats</th></tr></thead><tbody>' +\r\n  '<tr><td>Relic Count:</td><td id=\"relicCount\">0</td></tr>' +\r\n  '<tr><td>Lead Defender Bonus:</td><td id=\"LDPercentage\">0</td></tr>' +\r\n  '<tr><td>Lead Defender Cloaked:</td><td id=\"LDCloaked\">No</td></tr>' +\r\n  '</tbody><thead><tr><th colspan=\"2\">Other Defender Stats</th></tr>' +\r\n  '</thead><tbody>' +\r\n  '<tr><td>Raw Attack:</td><td class=\"fshGrey\" id=\"attackValue\">0</td></tr>' +\r\n  '<tr><td>Attack w/ buffs:</td><td id=\"attackValueBuffed\">0</td></tr>' +\r\n  '<tr><td>Raw Defense:</td>' +\r\n    '<td class=\"fshGrey\" id=\"defenseValue\">0</td></tr>' +\r\n  '<tr><td>Defense w/buffs:</td><td id=\"defenseValueBuffed\">0</td></tr>' +\r\n  '<tr><td>Raw Armor:</td><td class=\"fshGrey\" id=\"armorValue\">0</td></tr>' +\r\n  '<tr><td>Armor w/ buffs:</td><td id=\"armorValueBuffed\">0</td></tr>' +\r\n  '<tr><td>Raw Damage:</td><td class=\"fshGrey\" id=\"damageValue\">0</td></tr>' +\r\n  '<tr><td>Damage w/ buffs:</td><td id=\"damageValueBuffed\">0</td></tr>' +\r\n  '<tr><td>Raw HP:</td><td class=\"fshGrey\" id=\"hpValue\">0</td></tr>' +\r\n  '<tr><td>HP w/ buffs:</td><td id=\"hpValueBuffed\">0</td></tr>' +\r\n  '<tr><td>Cloaked:</td><td id=\"defendersCloaked\">0</td></tr>' +\r\n  '<tr><td>Processed:</td><td id=\"defendersProcessed\">0</td></tr>' +\r\n  '</tbody></table>';\r\nexport var proc = '<table class=\"relicT\">' +\r\n  '<thead><tr><th colspan=\"2\">Processing</th></tr></thead><tbody>' +\r\n  '<tr><td class=\"fshGreen\" colspan=\"2\" id=\"ProcessingStatus\">' +\r\n    'Parsing defending guild stats ...</td></tr>' +\r\n  '</tbody><thead><tr><th colspan=\"2\">Assumptions</th></tr></thead><tbody>' +\r\n  '<tr><td colspan=\"2\" class=\"fshGrey\">Above calculations include ' +\r\n    'Constitution, Fortitude, Nightmare Visage, Chi Strike, Sanctuary, ' +\r\n    'Terrorize and Flinch bonus calculations (in that order) on both the ' +\r\n    'defending group and attacking group.</td></tr>' +\r\n  '</tbody></table>';\r\n","import doBuffLinks from '../../common/doBuffLinks';\r\nimport {getElementById} from '../../common/getElement';\r\nimport insertElement from '../../common/insertElement';\r\nimport {createButton, createDiv} from '../../common/cElement';\r\n\r\nexport var containerDiv;\r\nexport var leftDiv;\r\nexport var fetchStatsBtn;\r\nexport var myDefenders;\r\n\r\nexport function defendersSetup(relicData) {\r\n  myDefenders = relicData.defenders.map(function(x) {\r\n    return x.player_name;\r\n  });\r\n}\r\n\r\nexport function primaryElementsSetup(relicData) {\r\n  defendersSetup(relicData);\r\n  if (containerDiv) {\r\n    containerDiv.innerHTML = '';\r\n  } else {\r\n    containerDiv = createDiv({className: 'body'});\r\n  }\r\n  leftDiv = createDiv({className: 'fshFloatLeft fshRelicLeftDiv'});\r\n  insertElement(containerDiv, leftDiv);\r\n  if (relicData.is_owner) {\r\n    insertElement(leftDiv, doBuffLinks(myDefenders));\r\n  }\r\n  fetchStatsBtn = createButton({\r\n    className: 'custombutton',\r\n    textContent: 'Fetch Stats'\r\n  });\r\n  insertElement(leftDiv, fetchStatsBtn);\r\n  var dialogRelic = getElementById('dialog-relic');\r\n  insertElement(dialogRelic, containerDiv);\r\n}\r\n","import {createDiv} from '../../common/cElement';\r\nimport {getElementById} from '../../common/getElement';\r\nimport getMembrList from '../../ajax/getMembrList';\r\nimport getValue from '../../system/getValue';\r\nimport insertElement from '../../common/insertElement';\r\nimport insertHtmlBeforeEnd from '../../common/insertHtmlBeforeEnd';\r\nimport {nowSecs} from '../../support/constants';\r\nimport {atkStats, defStats, proc} from './assets';\r\nimport {\r\n  containerDiv,\r\n  fetchStatsBtn,\r\n  leftDiv,\r\n  myDefenders\r\n} from './primaryElements';\r\n\r\nvar guildMemberList;\r\nvar twoMinutes;\r\nvar sevenDays;\r\nvar memberExclusions = [\r\n  function(key) {return key === 'lastUpdate';},\r\n  function(key) {return myDefenders.indexOf(key) !== -1;},\r\n  function(key) {return !guildMemberList[key].last_login;},\r\n  function(key) {return Number(guildMemberList[key].last_login) >= twoMinutes;},\r\n  function(key) {return Number(guildMemberList[key].last_login) <= sevenDays;},\r\n  function(key) {\r\n    return guildMemberList[key].level >= 400 &&\r\n      guildMemberList[key].level <= 421;\r\n  },\r\n  function(key) {\r\n    return guildMemberList[key].level >= 441 &&\r\n      guildMemberList[key].level <= 450;\r\n  }\r\n];\r\nexport var relicCountElement;\r\nexport var lDPercentageElement;\r\nexport var lDCloakedElement;\r\nexport var attackElement;\r\nexport var attackBuffedElement;\r\nexport var defenseElement;\r\nexport var defenseBuffedElement;\r\nexport var armorElement;\r\nexport var armorBuffedElement;\r\nexport var damageElement;\r\nexport var damageBuffedElement;\r\nexport var hpElement;\r\nexport var hpBuffedElement;\r\nexport var defCloakedElement;\r\nexport var defProcessedElement;\r\nexport var dc225Element;\r\nexport var dc175Element;\r\nexport var groupAttackElement;\r\nexport var groupAttackBuffedElement;\r\nexport var groupDefenseElement;\r\nexport var groupDefenseBuffedElement;\r\nexport var groupArmorElement;\r\nexport var groupArmorBuffedElement;\r\nexport var groupDamageElement;\r\nexport var groupDamageBuffedElement;\r\nexport var groupHPElement;\r\nexport var groupHPBuffedElement;\r\nexport var processingStatus;\r\n\r\nfunction missingMembers(membrList) {\r\n  guildMemberList = membrList;\r\n  var myMembers = Object.keys(guildMemberList);\r\n  twoMinutes = nowSecs - 120;\r\n  sevenDays = nowSecs - 604800;\r\n  var filtered = myMembers.reduce(function(prev, key) {\r\n    for (var i = 0; i < memberExclusions.length; i += 1) {\r\n      if (memberExclusions[i](key)) {return prev;}\r\n    }\r\n    prev.push('<a href=\"index.php?cmd=profile&player_id=' +\r\n      guildMemberList[key].id + '\">' + key + '</a>');\r\n    return prev;\r\n  }, []);\r\n  insertHtmlBeforeEnd(containerDiv,\r\n    '<div class=\"fshFloatLeft fshRelicLowDiv\"><table class=\"relicT\">' +\r\n    '<thead><tr><th>Offline guild members not at relic:</th></tr></thead>' +\r\n    '<tbody><tr><td>' + filtered.join(' ') + '</td></tr></tbody>' +\r\n    '</table></div>');\r\n}\r\n\r\nfunction setDefVars() {\r\n  relicCountElement = getElementById('relicCount');\r\n  lDPercentageElement = getElementById('LDPercentage');\r\n  lDCloakedElement = getElementById('LDCloaked');\r\n  attackElement = getElementById('attackValue');\r\n  attackBuffedElement = getElementById('attackValueBuffed');\r\n  defenseElement = getElementById('defenseValue');\r\n  defenseBuffedElement = getElementById('defenseValueBuffed');\r\n  armorElement = getElementById('armorValue');\r\n  armorBuffedElement = getElementById('armorValueBuffed');\r\n  damageElement = getElementById('damageValue');\r\n  damageBuffedElement = getElementById('damageValueBuffed');\r\n  hpElement = getElementById('hpValue');\r\n  hpBuffedElement = getElementById('hpValueBuffed');\r\n  defCloakedElement = getElementById('defendersCloaked');\r\n  defProcessedElement = getElementById('defendersProcessed');\r\n}\r\n\r\nfunction setAtkVars() {\r\n  dc225Element = getElementById('DC225');\r\n  dc175Element = getElementById('DC175');\r\n  groupAttackElement = getElementById('GroupAttack');\r\n  groupAttackBuffedElement = getElementById('GroupAttackBuffed');\r\n  groupDefenseElement = getElementById('GroupDefense');\r\n  groupDefenseBuffedElement = getElementById('GroupDefenseBuffed');\r\n  groupArmorElement = getElementById('GroupArmor');\r\n  groupArmorBuffedElement = getElementById('GroupArmorBuffed');\r\n  groupDamageElement = getElementById('GroupDamage');\r\n  groupDamageBuffedElement = getElementById('GroupDamageBuffed');\r\n  groupHPElement = getElementById('GroupHP');\r\n  groupHPBuffedElement = getElementById('GroupHPBuffed');\r\n}\r\n\r\nexport function prepareSecondaryDivs(relicData) {\r\n  fetchStatsBtn.classList.add('fshHide');\r\n  var hideRelicOffline = getValue('hideRelicOffline');\r\n  if (relicData.is_owner && !hideRelicOffline) {\r\n    getMembrList(false).done(missingMembers);\r\n  }\r\n  insertHtmlBeforeEnd(leftDiv, proc);\r\n  processingStatus = getElementById('ProcessingStatus');\r\n  var midDiv = createDiv({\r\n    className: 'fshFloatLeft fshRelicMidDiv',\r\n    innerHTML: defStats\r\n  });\r\n  insertElement(containerDiv, midDiv);\r\n  setDefVars();\r\n  var rightDiv = createDiv({\r\n    className: 'fshFloatLeft fshRelicRightDiv',\r\n    innerHTML: atkStats\r\n  });\r\n  insertElement(containerDiv, rightDiv);\r\n  setAtkVars();\r\n}\r\n","import createDocument from '../../system/createDocument';\r\nimport {lDPercentageElement, relicCountElement} from './secondaryElements';\r\n\r\nexport var relicMultiplier;\r\n\r\nfunction calcRelicMultiplier(rels) {\r\n  if (rels === 1) {return 1.5;}\r\n  return Math.round((1 - rels / 10) * 100) / 100;\r\n}\r\n\r\nexport function parseGuild(html) {\r\n  var doc = createDocument(html);\r\n  var nodeList = doc.querySelectorAll('#pCC img[src*=\"/relics/\"]');\r\n  var relicCount = nodeList.length;\r\n  relicCountElement.textContent = relicCount.toString();\r\n  relicMultiplier = calcRelicMultiplier(relicCount);\r\n  lDPercentageElement.textContent = (relicMultiplier * 100).toString() + '%';\r\n}\r\n","import addCommas from '../../system/addCommas';\r\nimport {defenderMultiplier} from '../../support/constants';\r\nimport fallback from '../../system/fallback';\r\nimport {playerDataObject} from '../../common/common';\r\nimport reduceBuffArray from '../../common/reduceBuffArray';\r\nimport {relicMultiplier} from './parseGuild';\r\nimport {\r\n  armorBuffedElement,\r\n  armorElement,\r\n  attackBuffedElement,\r\n  attackElement,\r\n  damageBuffedElement,\r\n  damageElement,\r\n  dc175Element,\r\n  dc225Element,\r\n  defCloakedElement,\r\n  defProcessedElement,\r\n  defenseBuffedElement,\r\n  defenseElement,\r\n  groupArmorBuffedElement,\r\n  groupArmorElement,\r\n  groupAttackBuffedElement,\r\n  groupAttackElement,\r\n  groupDamageBuffedElement,\r\n  groupDamageElement,\r\n  groupDefenseBuffedElement,\r\n  groupDefenseElement,\r\n  groupHPBuffedElement,\r\n  groupHPElement,\r\n  hpBuffedElement,\r\n  hpElement,\r\n  lDCloakedElement,\r\n  processingStatus\r\n} from './secondaryElements';\r\n\r\nvar defRawAttack;\r\nvar defBuffedAttack;\r\nvar defRawDefense;\r\nvar defRawArmor;\r\nvar defRawDamage;\r\nvar defBuffedDamage;\r\nvar defRawHp;\r\nvar defCloaked;\r\nvar defProcessed;\r\nvar leadDefender;\r\nvar groupStats;\r\nvar mercStats;\r\n\r\nfunction deductMercStats() {\r\n  groupStats.attack -= mercStats.attack;\r\n  groupStats.defense -= mercStats.defense;\r\n  groupStats.armor -= mercStats.armor;\r\n  groupStats.damage -= mercStats.damage;\r\n  groupStats.hp -= mercStats.hp;\r\n}\r\n\r\nfunction updateDefValues() {\r\n  attackElement.textContent = addCommas(defRawAttack);\r\n  defenseElement.textContent = addCommas(defRawDefense);\r\n  armorElement.textContent = addCommas(defRawArmor);\r\n  damageElement.textContent = addCommas(defRawDamage);\r\n  hpElement.textContent = addCommas(defRawHp);\r\n  defCloakedElement.textContent = defCloaked.toString();\r\n  defProcessed += 1;\r\n  defProcessedElement.textContent = defProcessed.toString();\r\n}\r\n\r\nfunction calculateGroup() {\r\n  processingStatus.textContent = 'Processing attacking group stats ... ';\r\n  if (mercStats) {deductMercStats();}\r\n  groupAttackElement.textContent = addCommas(groupStats.attack);\r\n  groupDefenseElement.textContent = addCommas(groupStats.defense);\r\n  groupArmorElement.textContent = addCommas(groupStats.armor);\r\n  groupDamageElement.textContent = addCommas(groupStats.damage);\r\n  groupHPElement.textContent = addCommas(groupStats.hp);\r\n\r\n  var buffs = reduceBuffArray(GameData.player().buffs);\r\n\r\n  var nightmareVisageEffect = Math.ceil(groupStats.attack *\r\n    (fallback(buffs['Nightmare Visage'], 0) * 0.0025));\r\n  groupStats.attack -= nightmareVisageEffect;\r\n\r\n  var storedFlinchEffectValue = Math.ceil(groupStats.attack *\r\n    leadDefender.flinchLevel * 0.001);\r\n  groupAttackBuffedElement.textContent = addCommas(groupStats.attack -\r\n    storedFlinchEffectValue);\r\n\r\n  var defenseWithConstitution = Math.ceil(groupStats.defense *\r\n    (1 + fallback(buffs.Constitution, 0) * 0.001));\r\n  var totalDefense = defenseWithConstitution + nightmareVisageEffect;\r\n  groupDefenseBuffedElement.textContent = addCommas(totalDefense);\r\n\r\n  groupArmorBuffedElement.textContent = addCommas(groupStats.armor +\r\n    Math.floor(groupStats.armor * fallback(buffs.Sanctuary, 0) * 0.001));\r\n\r\n  var fortitudeBonusHP = Math.ceil(defenseWithConstitution *\r\n    fallback(buffs.Fortitude, 0) * 0.001);\r\n  var chiStrikeBonusDamage = Math.ceil((groupStats.hp + fortitudeBonusHP) *\r\n    fallback(buffs['Chi Strike'], 0) * 0.001);\r\n  var storedTerrorizeEffectValue = Math.ceil(\r\n    groupStats.damage * leadDefender.terrorizeLevel * 0.001);\r\n  groupDamageBuffedElement.textContent = addCommas(groupStats.damage +\r\n    chiStrikeBonusDamage - storedTerrorizeEffectValue);\r\n  groupHPBuffedElement.textContent = addCommas(groupStats.hp +\r\n    fortitudeBonusHP);\r\n\r\n  // Effect on defending group from Flinch on attacking group.\r\n  var flinchEffectValue = Math.ceil(defBuffedAttack *\r\n    fallback(buffs.Flinch, 0) * 0.001);\r\n  defenseBuffedElement.textContent = addCommas(defBuffedAttack -\r\n    flinchEffectValue);\r\n  var terrorizeEffectValue = Math.ceil(defBuffedDamage *\r\n    fallback(buffs.Terrorize, 0) * 0.001);\r\n  damageBuffedElement.textContent = addCommas(defBuffedDamage -\r\n    terrorizeEffectValue);\r\n\r\n  processingStatus.textContent = 'Done.';\r\n}\r\n\r\nexport function doCalculations() {\r\n  processingStatus.textContent = 'Processing defending guild stats ... ';\r\n\r\n  defRawAttack += Math.round(leadDefender.attackValue * relicMultiplier);\r\n  var nightmareVisageEffect = Math.ceil(defRawAttack *\r\n    (leadDefender.nightmareVisageLevel * 0.0025));\r\n\r\n  defRawDefense += Math.round(leadDefender.defenseValue * relicMultiplier);\r\n  var defenseWithConstitution = Math.ceil(defRawDefense *\r\n    (1 + leadDefender.constitutionLevel * 0.001));\r\n  var defBuffedDefense = defenseWithConstitution + nightmareVisageEffect;\r\n\r\n  defRawArmor += Math.round(leadDefender.armorValue * relicMultiplier);\r\n\r\n  defRawDamage += Math.round(leadDefender.damageValue * relicMultiplier);\r\n  defRawHp += Math.round(leadDefender.hpValue * relicMultiplier);\r\n  var fortitudeBonusHP = Math.ceil(defenseWithConstitution *\r\n    leadDefender.fortitudeLevel * 0.001);\r\n  var defBuffedHp = defRawHp + fortitudeBonusHP;\r\n  var chiStrikeBonusDamage = Math.ceil(defBuffedHp *\r\n    leadDefender.chiStrikeLevel * 0.001);\r\n\r\n  updateDefValues();\r\n\r\n  defBuffedAttack = defRawAttack - nightmareVisageEffect;\r\n  attackBuffedElement.textContent = addCommas(defBuffedAttack);\r\n  defenseBuffedElement.textContent = addCommas(defBuffedDefense);\r\n  dc225Element.textContent = addCommas(Math.ceil(\r\n    defBuffedDefense * 0.55));\r\n  dc175Element.textContent = addCommas(Math.ceil(\r\n    defBuffedDefense * 0.65));\r\n  armorBuffedElement.textContent = addCommas(defRawArmor +\r\n    Math.floor(defRawArmor * leadDefender.sanctuaryLevel * 0.001));\r\n  defBuffedDamage = defRawDamage + chiStrikeBonusDamage;\r\n  damageBuffedElement.textContent = addCommas(defBuffedDamage);\r\n  hpBuffedElement.textContent = addCommas(defBuffedHp);\r\n\r\n  if (leadDefender.cloakLevel !== 0) {\r\n    lDCloakedElement.textContent = 'Yes';\r\n  }\r\n\r\n  if (GameData.player().hasGroup) {\r\n    calculateGroup();\r\n  } else {\r\n    processingStatus.textContent = 'Done.';\r\n  }\r\n\r\n}\r\n\r\nexport function parseDefender(json) {\r\n  var defender = playerDataObject(json);\r\n  defRawAttack += Math.round(defender.attackValue * defenderMultiplier);\r\n  defRawDefense += Math.round(defender.defenseValue *\r\n    defenderMultiplier);\r\n  defRawArmor += Math.round(defender.armorValue * defenderMultiplier);\r\n  defRawDamage += Math.round(defender.damageValue * defenderMultiplier);\r\n  defRawHp += Math.round(defender.hpValue * defenderMultiplier);\r\n  if (defender.cloakLevel !== 0) {defCloaked += 1;}\r\n  updateDefValues();\r\n}\r\n\r\nexport function storeLeadDefender(json) {\r\n  leadDefender = playerDataObject(json);\r\n}\r\n\r\nexport function storeGroupStats(obj) {\r\n  groupStats = obj;\r\n}\r\n\r\nexport function storeMercStats(obj) {\r\n  mercStats = obj;\r\n}\r\n\r\nexport function resetCounters() {\r\n  defRawAttack = 0;\r\n  defRawDefense = 0;\r\n  defRawArmor = 0;\r\n  defRawDamage = 0;\r\n  defRawHp = 0;\r\n  defCloaked = 0;\r\n  defProcessed = 0;\r\n}\r\n","import createDocument from '../../system/createDocument';\r\nimport {def_suffixSuccessActionResponse} from '../../support/constants';\r\nimport getGroupStats from '../../ajax/getGroupStats';\r\nimport getMercStats from '../../ajax/getMercStats';\r\nimport getProfile from '../../ajax/getProfile';\r\nimport {parseGuild} from './parseGuild';\r\nimport retryAjax from '../../ajax/retryAjax';\r\nimport {\r\n  doCalculations,\r\n  parseDefender,\r\n  resetCounters,\r\n  storeGroupStats,\r\n  storeLeadDefender,\r\n  storeMercStats\r\n} from './calcs';\r\nimport {\r\n  fetchStatsBtn,\r\n  myDefenders,\r\n  primaryElementsSetup\r\n} from './primaryElements';\r\nimport {\r\n  prepareSecondaryDivs,\r\n  processingStatus\r\n} from './secondaryElements';\r\n\r\nvar relicData;\r\n\r\nfunction ajaxFailure(jqXHR) {\r\n  processingStatus.textContent = jqXHR.status.toString() + ' ' +\r\n    jqXHR.statusText;\r\n}\r\n\r\nfunction getGuild() {\r\n  return retryAjax({\r\n    url: 'index.php',\r\n    data: {\r\n      no_mobile: 1,\r\n      cmd: 'guild',\r\n      subcmd: 'view',\r\n      guild_id: relicData.controlled_by.guild_id\r\n    }\r\n  });\r\n}\r\n\r\nfunction getGroups() {\r\n  return retryAjax({\r\n    url: 'index.php',\r\n    data: {\r\n      no_mobile: 1,\r\n      cmd: 'guild',\r\n      subcmd: 'groups'\r\n    }\r\n  });\r\n}\r\n\r\nfunction parseGroups(html) {\r\n  var doc = createDocument(html);\r\n  var disband = doc.querySelector('#pCC a[href*=\"confirmDisband\"]');\r\n  var viewStats = disband.previousElementSibling.href;\r\n  var prm = [getGroupStats(viewStats).done(storeGroupStats)];\r\n  var hasMerc = disband.parentNode.parentNode.previousElementSibling\r\n    .previousElementSibling.innerHTML.indexOf('\"#000099\"') !== -1;\r\n  if (hasMerc) {\r\n    prm.push(getMercStats().done(storeMercStats));\r\n  }\r\n  return $.when.apply($, prm);\r\n}\r\n\r\nexport function getStats() {\r\n  prepareSecondaryDivs(relicData);\r\n  resetCounters();\r\n  var prm = [];\r\n  prm.push(getGuild().done(parseGuild));\r\n  if (GameData.player().hasGroup) {\r\n    prm.push(getGroups().pipe(parseGroups));\r\n  }\r\n  for (var i = 1; i < myDefenders.length; i += 1) {\r\n    prm.push(getProfile(myDefenders[i]).done(parseDefender)\r\n      .fail(ajaxFailure));\r\n  }\r\n  prm.push(getProfile(myDefenders[0]).done(storeLeadDefender));\r\n  $.when.apply($, prm).done(doCalculations);\r\n}\r\n\r\nfunction viewRelic(e, data) {\r\n  relicData = data.response.data;\r\n  if (relicData.defenders.length > 0) {\r\n    primaryElementsSetup(relicData);\r\n    fetchStatsBtn.addEventListener('click', getStats);\r\n  }\r\n}\r\n\r\nexport default function injectRelic() {\r\n  $.subscribe('9' + def_suffixSuccessActionResponse, viewRelic);\r\n}\r\n","export var colorHash = {\r\n  '0': 'red', // Should never see this.\r\n  '1': 'orange',\r\n  '2': 'yellow'\r\n};\r\n\r\nexport var bias = {\r\n  '0': {generalVariable: 1.1053, hpVariable: 1.1},\r\n  '1': {generalVariable: 1.1, hpVariable: 1.053},\r\n  '2': {generalVariable: 1.053, hpVariable: 1},\r\n  '3': {generalVariable: 1.1053, hpVariable: 1}\r\n};\r\n","export var realmName;\r\n\r\nexport function setRealm(data) {\r\n  realmName = data;\r\n}\r\n","import {createSpan} from '../../common/cElement';\r\n\r\nexport var currentHp;\r\nexport var maxHp;\r\nexport var guildKills;\r\nexport var currentPct;\r\nexport var totalPct;\r\nexport var statusText;\r\nexport var cooldownText;\r\n\r\nexport function initVars() {\r\n  currentHp = createSpan();\r\n  maxHp = createSpan();\r\n  guildKills = createSpan();\r\n  currentPct = createSpan();\r\n  totalPct = createSpan();\r\n  statusText = createSpan();\r\n  cooldownText = createSpan();\r\n}\r\n\r\nexport function clearTitanDiv() {\r\n  currentHp.textContent = '';\r\n  maxHp.textContent = '';\r\n  guildKills.textContent = '';\r\n  currentPct.textContent = '';\r\n  totalPct.textContent = '';\r\n  statusText.innerHTML = '';\r\n  cooldownText.innerHTML = '';\r\n}\r\n","import {addRows} from './common';\r\nimport insertElement from '../../common/insertElement';\r\nimport insertTextBeforeEnd from '../../common/insertTextBeforeEnd';\r\nimport {\r\n  cooldownText,\r\n  currentHp,\r\n  currentPct,\r\n  guildKills,\r\n  maxHp,\r\n  statusText,\r\n  totalPct\r\n} from './placeholders';\r\nimport {createSpan, createTable, textSpan} from '../../common/cElement';\r\n\r\nexport var titanTbl;\r\n\r\nexport function clearMemberRows() {\r\n  if (titanTbl.rows.length > 7) {\r\n    for (var i = 7; i < titanTbl.rows.length; i += 1) {\r\n      titanTbl.deleteRow(i);\r\n    }\r\n  }\r\n}\r\n\r\nfunction makeTitanHpWrapper() {\r\n  var titanHpWrapper = createSpan();\r\n  insertElement(titanHpWrapper, currentHp);\r\n  insertTextBeforeEnd(titanHpWrapper, '/');\r\n  insertElement(titanHpWrapper, maxHp);\r\n  return titanHpWrapper;\r\n}\r\n\r\nfunction makePctWrapper(pct) {\r\n  var pctWrapper = createSpan();\r\n  insertElement(pctWrapper, pct);\r\n  insertTextBeforeEnd(pctWrapper, '%');\r\n  return pctWrapper;\r\n}\r\n\r\nexport function buildTitanInfoTable() {\r\n  titanTbl = createTable({className: 'fshCenter'});\r\n  addRows(titanTbl, [\r\n    [[[2, textSpan('Titan HP'), true], [4, textSpan('Your Guild'), true]]],\r\n    [[[2, makeTitanHpWrapper()], [4, guildKills]]],\r\n    [[[2, textSpan('Current'), true], [4, makePctWrapper(currentPct)]], true],\r\n    [[[2, textSpan('Total'), true], [4, makePctWrapper(totalPct)]], true],\r\n    [[[2, textSpan('Status'), true], [4, statusText]], true],\r\n    [[[6, cooldownText]]],\r\n    [[[2, textSpan('Member'), true], [2, textSpan('Kills'), true],\r\n      [2, textSpan('% of Total'), true]]]\r\n  ]);\r\n}\r\n","import {createDiv} from '../../common/cElement';\r\nimport {getElementById} from '../../common/getElement';\r\nimport insertElement from '../../common/insertElement';\r\nimport toggleForce from '../../common/toggleForce';\r\nimport {\r\n  buildTitanInfoTable,\r\n  clearMemberRows,\r\n  titanTbl\r\n} from './buildTitanInfoTable';\r\nimport {clearTitanDiv, initVars} from './placeholders';\r\n\r\nexport var titanDiv;\r\nexport var titanId;\r\n\r\nexport function hideTitanDiv() {\r\n  titanId = null;\r\n  if (titanDiv && !titanDiv.classList.contains('fshHide')) {\r\n    toggleForce(titanDiv, true);\r\n    clearTitanDiv();\r\n    clearMemberRows();\r\n  }\r\n}\r\n\r\nexport function hasTitan(el) {\r\n  if (el.type === 0) {\r\n    titanId = el.base_creature_id;\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\nexport function setupTitanDiv() {\r\n  if (titanDiv) {\r\n    toggleForce(titanDiv, false);\r\n  } else {\r\n    var actCont = getElementById('actionContainer');\r\n    titanDiv = createDiv({className: 'titanInfo'});\r\n    initVars();\r\n    buildTitanInfoTable();\r\n    insertElement(titanDiv, titanTbl);\r\n    insertElement(actCont, titanDiv);\r\n  }\r\n}\r\n","import calf from '../../support/calf';\r\nimport {processTitans} from './processTitans';\r\nimport scouttower from '../../app/guild/scouttower';\r\nimport {setRealm} from './realm';\r\nimport setValue from '../../system/setValue';\r\nimport {hasTitan, hideTitanDiv, setupTitanDiv} from './hasTitan';\r\n\r\nvar timeoutId;\r\n\r\nfunction clearTheTimeout() {\r\n  if (timeoutId) {\r\n    window.clearTimeout(timeoutId);\r\n    timeoutId = null;\r\n  }\r\n}\r\n\r\nfunction goodData(data) {\r\n  return data.s && Array.isArray(data.r);\r\n}\r\n\r\nfunction titanToShow(dynamic) {\r\n  return calf.showTitanInfo && Array.isArray(dynamic) && dynamic.some(hasTitan);\r\n}\r\n\r\nfunction ajaxScoutTower() {\r\n  scouttower().done(function processScoutTower(data) {\r\n    if (goodData(data)) {\r\n      processTitans(data.r);\r\n      if (titanToShow(GameData.realm().dynamic)) {\r\n        timeoutId = window.setTimeout(ajaxScoutTower, 30000);\r\n      } else {\r\n        hideTitanDiv();\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\nfunction testDynamics(dynamic) {\r\n  clearTheTimeout();\r\n  if (titanToShow(dynamic)) {\r\n    setupTitanDiv();\r\n    ajaxScoutTower();\r\n  } else {\r\n    hideTitanDiv();\r\n  }\r\n}\r\n\r\nexport function titanStats(data) {\r\n  if (data.realm.dynamic) {\r\n    setRealm(data.realm.name);\r\n    testDynamics(data.realm.dynamic);\r\n  }\r\n}\r\n\r\nexport function toggleShowTitanInfo() {\r\n  calf.showTitanInfo = !calf.showTitanInfo;\r\n  setValue('showTitanInfo', calf.showTitanInfo);\r\n  testDynamics(GameData.realm().dynamic);\r\n}\r\n","import calf from '../support/calf';\r\nimport eventHandler from '../common/eventHandler';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport {guideUrl} from '../support/constants';\r\nimport insertElement from '../common/insertElement';\r\nimport openQuickBuffByName from '../common/openQuickBuffByName';\r\nimport playerName from '../common/playerName';\r\nimport setValue from '../system/setValue';\r\nimport {\r\n  createButton,\r\n  createDiv,\r\n  createInput,\r\n  createLabel,\r\n  textSpan\r\n} from '../common/cElement';\r\n\r\nvar buttonContainer;\r\nvar yourLvl;\r\nvar formGroup;\r\nvar quickBuff;\r\nvar realmMap;\r\nvar ufsgMap;\r\nvar soundCheck;\r\nvar huntCheck;\r\n\r\nfunction doFormGroup(self) { // jQuery.min\r\n  $(self).qtip('hide');\r\n  GameData.doAction(12, 401, {}, 0);\r\n}\r\n\r\nfunction openQuickBuff() {\r\n  openQuickBuffByName(playerName());\r\n}\r\n\r\nfunction openRealmMap() {\r\n  window.open('index.php?cmd=world&subcmd=map', 'fsMap');\r\n}\r\n\r\nfunction openUfsgMap() {\r\n  var gameRealm = GameData.realm();\r\n  window.open(guideUrl + 'realms&subcmd=view&realm_id=' + gameRealm.id,\r\n    'mapUfsg');\r\n}\r\n\r\nfunction toggleSound() {\r\n  // Doesn't actually work in New World...\r\n  setValue('playNewMessageSound', !getValue('playNewMessageSound'));\r\n}\r\n\r\nfunction toggleHuntMode() {\r\n  calf.huntingMode = !calf.huntingMode;\r\n  setValue('huntingMode', calf.huntingMode);\r\n}\r\n\r\nvar changeHdl = [\r\n  {\r\n    test: function(self) {return self === soundCheck;},\r\n    act: toggleSound\r\n  },\r\n  {\r\n    test: function(self) {return self === huntCheck;},\r\n    act: toggleHuntMode\r\n  }\r\n];\r\n\r\nvar clickHdl = [\r\n  {\r\n    test: function(self) {return self === formGroup;},\r\n    act: doFormGroup\r\n  },\r\n  {\r\n    test: function(self) {return self === quickBuff;},\r\n    act: openQuickBuff\r\n  },\r\n  {\r\n    test: function(self) {return self === realmMap;},\r\n    act: openRealmMap\r\n  },\r\n  {\r\n    test: function(self) {return self === ufsgMap;},\r\n    act: openUfsgMap\r\n  }\r\n];\r\n\r\nfunction fixTeleport() {\r\n  if (window.GameController && GameController.Realm) {\r\n    GameController.Realm.footprintTileList = []; // BUGFIX - in case of teleporting in new realm with footprints turned on\r\n  }\r\n}\r\n\r\nfunction makeButtonContainer() {\r\n  if (buttonContainer) {buttonContainer.remove();}\r\n  return createDiv({\r\n    className: 'fshCurveContainer',\r\n    id: 'fshWorldButtonContainer'\r\n  });\r\n}\r\n\r\nfunction doLevels(data, worldName) {\r\n  var lvlDiv = createDiv({\r\n    className: 'fshFsty',\r\n    innerHTML: '<div>Min Lvl: ' + data.realm.minlevel + '</div>'\r\n  });\r\n  var btmDiv = createDiv({textContent: 'Your Lvl: '});\r\n  yourLvl = textSpan(data.player.level.toString());\r\n  insertElement(btmDiv, yourLvl);\r\n  insertElement(lvlDiv, btmDiv);\r\n  insertElement(worldName, lvlDiv);\r\n}\r\n\r\nfunction doBtn(className, tip, worldName) {\r\n  var btn = createButton({\r\n    className: 'fshCurveEle fshCurveBtn fshPoint tip-static ' + className,\r\n    dataset: {tipped: tip}\r\n  });\r\n  insertElement(worldName, btn);\r\n  return btn;\r\n}\r\n\r\nfunction showQuickLinks(worldName, data) {\r\n  doLevels(data, worldName);\r\n  formGroup = doBtn('fshFormGroup', 'Quick Create Attack Group', worldName);\r\n  quickBuff = doBtn('fshQuickBuff', 'Open Quick Buff Popup', worldName);\r\n  realmMap = doBtn('fshRealmMap', 'Open Realm Map', worldName);\r\n  ufsgMap = doBtn('fshTempleOne', 'Search map in Ultimate FSG', worldName);\r\n}\r\n\r\nfunction createLbl(className, tip, htmlFor) {\r\n  return createLabel({\r\n    className: 'fshCurveEle fshCurveLbl fshPoint tip-static ' + className,\r\n    dataset: {tipped: tip},\r\n    htmlFor: htmlFor\r\n  });\r\n}\r\n\r\nfunction makeToggleBtn(o) {\r\n  var btnDiv = createDiv({className: 'fshToggle'});\r\n  var btnCheck = createInput({\r\n    checked: o.prefVal,\r\n    id: o.checkId,\r\n    type: 'checkbox'\r\n  });\r\n  insertElement(btnDiv, btnCheck);\r\n  var onLbl = createLbl(o.onClass, o.onTip, o.checkId);\r\n  insertElement(btnDiv, onLbl);\r\n  var offLbl = createLbl(o.offClass, o.offTip, o.checkId);\r\n  insertElement(btnDiv, offLbl);\r\n  insertElement(o.worldName, btnDiv);\r\n  return btnCheck;\r\n}\r\n\r\nfunction showSpeakerOnWorld(worldName) {\r\n  if (getValue('showSpeakerOnWorld')) {\r\n    var msgSounds = getValue('playNewMessageSound');\r\n    soundCheck = makeToggleBtn({\r\n      prefVal: msgSounds,\r\n      checkId: 'fshSoundCheck',\r\n      onClass: 'soundOn',\r\n      onTip: 'Turn Off Sound when you have a new log message',\r\n      offClass: 'soundOff',\r\n      offTip: 'Turn On Sound when you have a new log message',\r\n      worldName: worldName\r\n    });\r\n  }\r\n}\r\n\r\nfunction showHuntMode(worldName) {\r\n  var inHuntMode = calf.huntingMode;\r\n  huntCheck = makeToggleBtn({\r\n    prefVal: inHuntMode,\r\n    checkId: 'fshHuntCheck',\r\n    onClass: 'huntOn',\r\n    onTip: 'Hunting mode is ON',\r\n    offClass: 'huntOff',\r\n    offTip: 'Hunting mode is OFF',\r\n    worldName: worldName\r\n  });\r\n}\r\n\r\nexport function injectButtons(data) {\r\n  fixTeleport();\r\n  buttonContainer = makeButtonContainer();\r\n  showQuickLinks(buttonContainer, data);\r\n  showSpeakerOnWorld(buttonContainer);\r\n  showHuntMode(buttonContainer);\r\n  buttonContainer.addEventListener('click', eventHandler(clickHdl));\r\n  buttonContainer.addEventListener('change', eventHandler(changeHdl));\r\n  getElementById('worldContainer')\r\n    .insertBefore(buttonContainer, getElementById('worldCoord'));\r\n}\r\n\r\nexport function levelStats(e, data) {\r\n  //#if _DEV  //  \"Your Lvl\" does not update during combat #155\r\n  console.log('level.stats-player data', data); // eslint-disable-line no-console\r\n  // level.stats-player data Object { a: 3381, b: 3382 }\r\n  //#endif\r\n  if (yourLvl) {\r\n    yourLvl.textContent = data.b;\r\n  }\r\n}\r\n","import insertElement from '../../common/insertElement';\r\n\r\n/*\r\n  colSpan = attributes[0]\r\n  anElement = attributes[1]\r\n  isHeader = attributes[2]\r\n*/\r\nfunction addNextCell(row, attributes) {\r\n  var aCell = row.insertCell(-1);\r\n  aCell.colSpan = attributes[0];\r\n  if (attributes[2]) {aCell.className = 'header';}\r\n  insertElement(aCell, attributes[1]);\r\n  return aCell;\r\n}\r\n\r\nfunction addRowCells(aRow, someCells) {\r\n  someCells.forEach(function(cell) {\r\n    addNextCell(aRow, cell);\r\n  });\r\n}\r\n\r\nfunction addNextRow(tbl, cells, isBlue) {\r\n  var aRow = tbl.insertRow(-1);\r\n  if (isBlue) {aRow.className = 'fshBlue';}\r\n  addRowCells(aRow, cells);\r\n  return aRow;\r\n}\r\n\r\nexport function addRows(tbl, rows) {\r\n  rows.forEach(function(row) {\r\n    addNextRow(tbl, row[0], row[1]);\r\n  });\r\n}\r\n","import {addRows} from './common';\r\nimport padZ from '../../system/padZ';\r\nimport {realmName} from './realm';\r\nimport roundToString from '../../common/roundToString';\r\nimport {textSpan} from '../../common/cElement';\r\nimport {titanId} from './hasTitan';\r\nimport {clearMemberRows, titanTbl} from './buildTitanInfoTable';\r\nimport {\r\n  cooldownText,\r\n  currentHp,\r\n  currentPct,\r\n  guildKills,\r\n  maxHp,\r\n  statusText,\r\n  totalPct\r\n} from './placeholders';\r\nimport {getKillsPct, getTitanString} from '../../scoutTower/injectScouttower';\r\nimport {months, now} from '../../support/constants';\r\n\r\nfunction formatOffset(secs) {\r\n  var aDate = new Date(now + secs * 1000);\r\n  var yyyy = aDate.getFullYear();\r\n  var dd = padZ(aDate.getDate());\r\n  var month = months[aDate.getMonth()];\r\n  var hh = padZ(aDate.getHours());\r\n  var mm = padZ(aDate.getMinutes());\r\n  return hh + ':' + mm + ' ' + dd + '/' + month + '/' + yyyy;\r\n}\r\n\r\nfunction getCooldownHtml(cooldown) {\r\n  if (cooldown <= 0) {\r\n    return '<span class=\"fshGreen cooldown\">No active cooldown</span>';\r\n  }\r\n  return '<span class=\"fshMaroon cooldown\">Cooldown until: ' +\r\n    formatOffset(cooldown) +\r\n    '</span>';\r\n}\r\n\r\nfunction doTopLabels(ourTitan) {\r\n  currentHp.textContent = ourTitan.current_hp.toString();\r\n  maxHp.textContent = ourTitan.max_hp.toString();\r\n  guildKills.textContent = ourTitan.kills.toString();\r\n  currentPct.textContent = roundToString(getKillsPct(ourTitan.max_hp -\r\n    ourTitan.current_hp, ourTitan.kills), 2);\r\n  totalPct.textContent = roundToString(ourTitan.kills * 100 / ourTitan.max_hp,\r\n    2);\r\n  statusText.innerHTML = getTitanString(ourTitan.kills, ourTitan.max_hp,\r\n    ourTitan.current_hp);\r\n  cooldownText.innerHTML = getCooldownHtml(ourTitan.cooldown);\r\n}\r\n\r\nfunction doMemberRows(ourTitan) {\r\n  clearMemberRows();\r\n  if (!ourTitan.contributors) {return;}\r\n  var memberRows = ourTitan.contributors.map(function(member) {\r\n    return [[\r\n      [2, textSpan(member.player.name)],\r\n      [2, textSpan(member.kills.toString())],\r\n      [2, textSpan(roundToString(member.kills * 100 / ourTitan.kills, 2) + '%')]\r\n    ]];\r\n  });\r\n  addRows(titanTbl, memberRows);\r\n}\r\n\r\nfunction currentTitan(el) {\r\n  return el.realm && el.creature.base_id === titanId && el.realm === realmName;\r\n}\r\n\r\nexport function processTitans(r) {\r\n  var ourTitan = r.find(currentTitan);\r\n  if (ourTitan) {\r\n    doTopLabels(ourTitan);\r\n    doMemberRows(ourTitan);\r\n  }\r\n}\r\n","import callApp from '../callApp';\r\n\r\nexport default function scouttower() {\r\n  return callApp({cmd: 'guild', subcmd: 'scouttower'});\r\n}\r\n","import addCommas from '../system/addCommas';\r\nimport fallback from '../system/fallback';\r\nimport {getElementById} from '../common/getElement';\r\nimport insertElement from '../common/insertElement';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport rnd from '../system/rnd';\r\nimport testQuant from '../system/testQuant';\r\nimport {createButton, createDiv, createInput} from '../common/cElement';\r\n\r\nvar shoppingData;\r\nvar dialog;\r\nvar jDialog;\r\nvar fshDiv;\r\nvar numInput;\r\nvar qbBtn;\r\nvar resultDiv;\r\n\r\nfunction quickBuy() {\r\n  return retryAjax({\r\n    cache: false,\r\n    url: 'fetchdata.php',\r\n    data: {\r\n      a: 14,\r\n      d: 0,\r\n      id: shoppingData.id,\r\n      item_id: shoppingData.itemId,\r\n      _rnd: rnd()\r\n    },\r\n    dataType: 'json'\r\n  });\r\n}\r\n\r\nfunction quickDone(data) {\r\n  var resp = data.response.response;\r\n  var rmsg = data.response.msg;\r\n  var msg;\r\n  if (resp !== 0) {\r\n    var firstTag = rmsg.indexOf('<');\r\n    if (firstTag !== -1) {\r\n      msg = rmsg.substring(0, firstTag);\r\n    } else {\r\n      msg = rmsg;\r\n    }\r\n  } else {\r\n    msg = 'You purchased ' + data.response.data.name +\r\n      ' for ' + addCommas(data.response.data.cost) + ' gold.';\r\n  }\r\n  insertHtmlBeforeEnd(resultDiv, msg + '<br>');\r\n}\r\n\r\nfunction normalBuy() {\r\n  GameData.doAction(14, 3, {\r\n    id: shoppingData.id,\r\n    item_id: shoppingData.itemId\r\n  }, 0);\r\n  jDialog.close();\r\n}\r\n\r\nfunction qBuy() {\r\n  var theValue = testQuant(numInput.value);\r\n  if (!theValue) {return;}\r\n  var prm = [];\r\n  for (var i = 1; i < theValue; i += 1) {\r\n    prm.push(quickBuy().done(quickDone));\r\n  }\r\n  $.when.apply($, prm).done(normalBuy);\r\n}\r\n\r\nfunction injectQuickBuy() {\r\n  fshDiv = createDiv({\r\n    className: 'fshClear',\r\n    textContent: 'Select how many to quick-buy:'\r\n  });\r\n  numInput = createInput({\r\n    id: 'buyAmount',\r\n    className: 'fshNumberInput',\r\n    min: 1,\r\n    max: 99,\r\n    value: 1,\r\n    type: 'number'\r\n  });\r\n  insertElement(fshDiv, numInput);\r\n  qbBtn = createButton({textContent: 'Quick-buy'});\r\n  qbBtn.addEventListener('click', qBuy);\r\n  insertElement(fshDiv, qbBtn);\r\n  resultDiv = createDiv();\r\n  insertElement(fshDiv, resultDiv);\r\n  insertElement(dialog, fshDiv);\r\n}\r\n\r\nfunction worldDialogShop(e, data) {\r\n  shoppingData = data;\r\n  dialog = fallback(dialog,\r\n    getElementById('shopDialogConfirm'));\r\n  if (!dialog) {return;}\r\n  jDialog = fallback(jDialog, $(dialog).data('worldDialogShopConfirm'));\r\n  if (!fshDiv) {injectQuickBuy();} else {resultDiv.textContent = '';}\r\n}\r\n\r\nexport default function prepareShop() {\r\n  $.subscribe('prompt.worldDialogShop', worldDialogShop);\r\n}\r\n","import calf from '../support/calf';\r\nimport {colorHash} from './assets';\r\nimport {getElementById} from '../common/getElement';\r\nimport {titanStats} from './titanStats/titanStats';\r\nimport {\r\n  def_playerBuffs,\r\n  def_suffixSuccessActionResponse\r\n} from '../support/constants';\r\nimport {injectButtons, levelStats} from './buttons';\r\nimport {injectSendGoldOnWorld, updateSendGoldOnWorld} from './sendGold';\r\n\r\nfunction fixDebuffQTip(e) { // jQuery.min\r\n  $(e.target).qtip('hide');\r\n}\r\n\r\nfunction hazRealm(data) {\r\n  return data.realm && data.realm.name;\r\n}\r\n\r\nfunction injectWorldNewMap(data) {\r\n  updateSendGoldOnWorld(data);\r\n  if (hazRealm(data)) {\r\n    injectButtons(data);\r\n    titanStats(data);\r\n    getElementById('buffList')\r\n      .addEventListener('click', fixDebuffQTip);\r\n    if (calf.hideSubLvlCreature) {GameData.fetch(256);}\r\n  }\r\n}\r\n\r\nfunction impIconColour() { // jQuery\r\n  var imp = $('#actionlist-shield-imp');\r\n  if (imp.length === 1) {\r\n    imp.css('background-color',\r\n      colorHash[imp.text()] || '#ad8043');\r\n  }\r\n}\r\n\r\nexport default function onWorld() {\r\n  injectSendGoldOnWorld();\r\n  if (window.initialGameData) {// HCS initial data\r\n    injectWorldNewMap(window.initialGameData);\r\n    impIconColour(null,\r\n      {b: window.initialGameData.player.buffs});\r\n  }\r\n  $.subscribe('-1' + def_suffixSuccessActionResponse +\r\n              ' 5' + def_suffixSuccessActionResponse,\r\n  function(e, data) { // change of information\r\n    injectWorldNewMap(data);\r\n  });\r\n  $.subscribe(def_playerBuffs, impIconColour);\r\n  $.subscribe('level.stats-player', levelStats);\r\n}\r\n","\r\nfunction evalMiss(combat) {\r\n  if (combat.numberOfCreatureHitsTillDead - combat.numberOfHitsRequired <= 1) {\r\n    return ', dies on miss';\r\n  }\r\n  return ', survives a miss';\r\n}\r\n\r\nfunction canIHit(combat) {\r\n  return combat.numberOfHitsRequired === '-' ||\r\n    combat.numberOfHitsRequired > combat.numberOfCreatureHitsTillDead;\r\n}\r\n\r\nfunction evalPlayerHits(combat) {\r\n  if (combat.numberOfCreatureHitsTillDead === '-') {\r\n    return combat.numberOfHitsRequired;\r\n  } else if (canIHit(combat)) {\r\n    return '-';\r\n  }\r\n  return combat.numberOfHitsRequired;\r\n}\r\n\r\nfunction canCreatureHit(combat) {\r\n  return combat.numberOfCreatureHitsTillDead === '-' ||\r\n    combat.numberOfCreatureHitsTillDead > combat.numberOfHitsRequired;\r\n}\r\n\r\nfunction evalCreatureHits(combat) {\r\n  if (combat.numberOfHitsRequired === '-') {\r\n    return combat.numberOfCreatureHitsTillDead;\r\n  } else if (canCreatureHit(combat)) {\r\n    return '-';\r\n  }\r\n  return combat.numberOfCreatureHitsTillDead;\r\n}\r\n\r\nvar evalFightStatus = [\r\n  {\r\n    test: function(combat) {\r\n      return combat.playerHits === '-' && combat.creatureHits === '-';\r\n    },\r\n    fStatus: function() {return 'Unresolved';}\r\n  },\r\n  {\r\n    test: function(combat) {return combat.playerHits === '-';},\r\n    fStatus: function() {return 'Player dies';}\r\n  },\r\n  {\r\n    test: function(combat) {return combat.playerHits === 1;},\r\n    fStatus: function(combat) {return 'Player 1 hits' + evalMiss(combat);}\r\n  },\r\n  {\r\n    test: function(combat) {return combat.playerHits > 1;},\r\n    fStatus: function(combat) {return 'Player > 1 hits' + evalMiss(combat);}\r\n  }\r\n];\r\n\r\nexport default function evalAnalysis(combat) {\r\n  // Analysis:\r\n  combat.playerHits = evalPlayerHits(combat);\r\n  combat.creatureHits = evalCreatureHits(combat);\r\n  for (var i = 0; i < evalFightStatus.length; i += 1) {\r\n    if (evalFightStatus[i].test(combat)) {\r\n      combat.fightStatus = evalFightStatus[i].fStatus(combat);\r\n      return combat;\r\n    }\r\n  }\r\n  combat.fightStatus = 'Unknown';\r\n  return combat;\r\n}\r\n","import {bias} from '../assets';\r\nimport {getElementById} from '../../common/getElement';\r\nimport getValue from '../../system/getValue';\r\nimport intValue from '../../system/intValue';\r\nimport setValue from '../../system/setValue';\r\n\r\nexport var showCreatureInfo;\r\nvar generalVariable = 1.1053;\r\nvar hpVariable = 1.1;\r\nvar statLevel;\r\nvar statDefense;\r\nvar statAttack;\r\nvar statDamage;\r\nvar statArmor;\r\nvar statHp;\r\n\r\nexport function toggleShowCreatureInfo() {\r\n  showCreatureInfo = !showCreatureInfo;\r\n  setValue('showCreatureInfo', showCreatureInfo);\r\n}\r\n\r\nfunction biasIsValid(combatEvaluatorBias) {\r\n  return combatEvaluatorBias &&\r\n    combatEvaluatorBias >= 0 && combatEvaluatorBias <= 3;\r\n}\r\n\r\nexport function getBias() {\r\n  var combatEvaluatorBias = getValue('combatEvaluatorBias');\r\n  if (biasIsValid(combatEvaluatorBias)) {\r\n    generalVariable = bias[combatEvaluatorBias].generalVariable;\r\n    hpVariable = bias[combatEvaluatorBias].hpVariable;\r\n  }\r\n}\r\n\r\nfunction getStatText(statTooltip, statClassName) {\r\n  return statTooltip.getElementsByClassName(statClassName)[0]\r\n    .nextElementSibling.textContent;\r\n}\r\n\r\nexport function getMyStats() {\r\n  statLevel = intValue(getStatText(\r\n    getElementById('statbar-level-tooltip-general'), 'stat-level'));\r\n  var statTooltip = getElementById('statbar-character-tooltip-stats');\r\n  statDefense = getStatText(statTooltip, 'stat-defense');\r\n  statAttack = getStatText(statTooltip, 'stat-attack');\r\n  statDamage = getStatText(statTooltip, 'stat-damage');\r\n  statArmor = getStatText(statTooltip, 'stat-armor');\r\n  statHp = getStatText(statTooltip, 'stat-hp');\r\n}\r\n\r\nfunction doMouseOver(creature, monster) {\r\n  var oneHitNumber = Math.ceil(creature.hp * hpVariable + creature.armor *\r\n    generalVariable);\r\n  var myLvlClas = 'fshYellow';\r\n  if (statLevel > creature.level) {myLvlClas = 'fshRed';}\r\n  var monsterTip = '<table><tr><td>' +\r\n    '<img src=\"https://cdn.fallensword.com/creatures/' + creature.image_id +\r\n    '.jpg\" height=\"200\" width=\"200\"></td><td rowspan=\"2\">' +\r\n    '<table width=\"400\"><tr>' +\r\n    '<td class=\"header\" colspan=\"4\" class=\"fshCenter\">Statistics</td></tr>' +\r\n    '<tr><td>Class:&nbsp;</td><td width=\"40%\">' + creature.creature_class +\r\n    '</td><td>Level:&nbsp;</td><td width=\"40%\">' + creature.level +\r\n    ' (your level:<span class=\"' + myLvlClas + '\">' +\r\n    statLevel + '</span>)</td>' +\r\n    '</tr><tr><td>Attack:&nbsp;</td><td width=\"40%\">' + creature.attack +\r\n    ' (your defense:<span class=\"fshYellow\">' + statDefense + '</span>)</td>' +\r\n    '<td>Defense:&nbsp;</td><td width=\"40%\">' + creature.defense +\r\n    ' (your attack:<span class=\"fshYellow\">' + statAttack + '</span>)</td>' +\r\n    '</tr><tr><td>Armor:&nbsp;</td><td width=\"40%\">' + creature.armor +\r\n    ' (your damage:<span class=\"fshYellow\">' + statDamage + '</span>)</td>' +\r\n    '<td>Damage:&nbsp;</td><td width=\"40%\">' + creature.damage +\r\n    ' (your armor:<span class=\"fshYellow\">' + statArmor + '</span>)</td>' +\r\n    '</tr><tr><td>HP:&nbsp;</td><td width=\"40%\">' + creature.hp +\r\n    ' (your HP:<span class=\"fshYellow\">' + statHp + '</span>)' +\r\n    '(1H: <span class=\"fshRed\">' + oneHitNumber + '</span>)</td>' +\r\n    '<td>Gold:&nbsp;</td><td width=\"40%\">' + creature.gold + '</td></tr>' +\r\n    '<tr><td colspan=\"4\" height=\"5\"></td></tr><tr>' +\r\n    '<td class=\"header\" colspan=\"4\" class=\"fshCenter\">Enhancements</td></tr>';\r\n\r\n  if (!creature.enhancements) {\r\n    monsterTip += '<tr><td colspan=\"4\">[no enhancements]</td></tr>';\r\n  } else {\r\n    creature.enhancements.forEach(function(e) {\r\n      monsterTip += '<tr><td colspan=\"2\">' + e.name +\r\n        ':</td><td colspan=\"2\">' + e.value + '</td></tr>';\r\n    });\r\n  }\r\n\r\n  monsterTip += '<tr><td colspan=\"4\" height=\"5\"></td></tr><tr>' +\r\n    '<td class=\"header\" colspan=\"4\" class=\"fshCenter\">Description</td>' +\r\n    '</tr><tr><td colspan=\"4\">' + creature.description + '</td></tr>' +\r\n    '<tr><td colspan=\"4\" height=\"5\"></td></tr></table></td></tr>' +\r\n    '<tr><td class=\"fshCenter\"><b>' + creature.name + '</b></td></tr>' +\r\n    '</table>';\r\n\r\n  monster.dataset.tipped = monsterTip;\r\n}\r\n\r\nvar bailOut = [\r\n  function(data, actions) {\r\n    return actions.length === 1 &&\r\n      actions[0].classList.contains('hcs-state-disabled'); // In motion\r\n  },\r\n  function(data, actions) {\r\n    return actions.length - 1 < data.passback; // Not enough actions\r\n  },\r\n  function(data) {\r\n    return !GameData.actions()[data.passback];\r\n  },\r\n  function(data) {\r\n    return data.response.data.id !==\r\n      GameData.actions()[data.passback].data.id.toString(); // Different action list\r\n  }\r\n];\r\n\r\nfunction doCreatureInfo(data) {\r\n  var actions = getElementById('actionList').children;\r\n  for (var i = 0; i < bailOut.length; i += 1) {\r\n    if (bailOut[i](data, actions)) {return;}\r\n  }\r\n  // monster = 0;\r\n  doMouseOver(data.response.data, actions[data.passback].firstElementChild\r\n    .firstElementChild.firstElementChild);\r\n}\r\n\r\nexport function processMouseOver(data) {\r\n  if (showCreatureInfo) {doCreatureInfo(data);}\r\n}\r\n\r\nexport function getCreaturePrefs() {\r\n  showCreatureInfo = getValue('showCreatureInfo');\r\n}\r\n","\r\nfunction calcArm(combat) {\r\n  if (combat.callback.groupExists) {\r\n    return combat.callback.groupArmorValue;\r\n  }\r\n  return combat.player.armorValue;\r\n}\r\n\r\nfunction evalSanctuary(combat) {\r\n  if (combat.player.sanctuaryLevel > 0) {\r\n    combat.extraNotes += 'Sanc Bonus Armor = ' +\r\n      Math.floor(combat.player.armorValue *\r\n      combat.player.sanctuaryLevel * 0.001) + '<br>';\r\n  }\r\n}\r\n\r\nfunction evalTerrorize(combat) {\r\n  if (combat.player.terrorizeLevel > 0) {\r\n    combat.extraNotes += 'Terrorize Creature Damage Effect = ' +\r\n      combat.terrorizeEffect * -1 + '<br>';\r\n  }\r\n}\r\n\r\nexport default function evalArmour(combat) {\r\n  var armorVal = calcArm(combat);\r\n  combat.overallArmorValue = armorVal +\r\n    Math.floor(combat.player.armorValue *\r\n    combat.player.sanctuaryLevel * 0.001);\r\n\r\n  evalSanctuary(combat);\r\n\r\n  combat.terrorizeEffect = Math.floor(combat.creature.damage *\r\n    combat.player.terrorizeLevel * 0.001);\r\n\r\n  evalTerrorize(combat);\r\n\r\n  combat.creature.damage -= combat.terrorizeEffect;\r\n  combat.creatureDamageDone = Math.ceil(combat.generalVariable *\r\n    combat.creature.damage - combat.overallArmorValue +\r\n    combat.overallHPValue);\r\n\r\n  if (combat.creatureHitByHowMuch >= 0) {\r\n    var approxDmg = combat.generalVariable * combat.creature.damage;\r\n    if (approxDmg < combat.overallArmorValue) {\r\n      combat.numberOfCreatureHitsTillDead = combat.overallHPValue;\r\n    } else {\r\n      combat.numberOfCreatureHitsTillDead = Math.ceil(\r\n        combat.overallHPValue / (approxDmg - combat.overallArmorValue));\r\n    }\r\n  } else {\r\n    combat.numberOfCreatureHitsTillDead = '-';\r\n  }\r\n\r\n  return combat;\r\n}\r\n","\r\nfunction calcAttack(combat) {\r\n  if (combat.callback.groupExists) {\r\n    return combat.callback.groupAttackValue;\r\n  }\r\n  return combat.player.attackValue;\r\n}\r\n\r\nfunction calcHitByHowMuch(combat) {\r\n  var remainingDef = combat.creature.defense - combat.creature.defense *\r\n    combat.player.darkCurseLevel * 0.002;\r\n  if (combat.combatEvaluatorBias === 3) {\r\n    return combat.overallAttackValue - Math.ceil(remainingDef) - 50;\r\n  }\r\n  return combat.overallAttackValue -\r\n    Math.ceil(combat.attackVariable * remainingDef);\r\n}\r\n\r\nexport default function evalAttack(combat) {\r\n  var atkValue = calcAttack(combat);\r\n  // Attack:\r\n  if (combat.player.darkCurseLevel > 0) {\r\n    combat.extraNotes += 'DC Bonus Attack = ' +\r\n      Math.floor(combat.creature.defense *\r\n      combat.player.darkCurseLevel * 0.002) + '<br>';\r\n  }\r\n  combat.nightmareVisageAttackMovedToDefense =\r\n    Math.floor((atkValue +\r\n    combat.counterAttackBonusAttack) *\r\n    combat.player.nightmareVisageLevel * 0.0025);\r\n  if (combat.player.nightmareVisageLevel > 0) {\r\n    combat.extraNotes += 'NMV Attack moved to Defense = ' +\r\n      combat.nightmareVisageAttackMovedToDefense + '<br>';\r\n  }\r\n  combat.overallAttackValue = atkValue +\r\n    combat.counterAttackBonusAttack -\r\n    combat.nightmareVisageAttackMovedToDefense;\r\n  combat.hitByHowMuch = calcHitByHowMuch(combat);\r\n  return combat;\r\n}\r\n","function caIsRunning(combat) {\r\n  return combat.player.counterAttackLevel > 0 &&\r\n    combat.numberOfHitsRequired === 1;\r\n}\r\n\r\nfunction calcLowest(combat) {\r\n  combat.lowestCALevelToStillHit = Math.max(Math.ceil((\r\n    combat.counterAttackBonusAttack - combat.hitByHowMuch + 1) /\r\n    combat.player.attackValue / 0.0025), 0);\r\n  combat.lowestCALevelToStillKill = Math.max(Math.ceil((\r\n    combat.counterAttackBonusDamage - combat.damageDone + 1) /\r\n    combat.player.damageValue / 0.0025), 0);\r\n}\r\n\r\nfunction stamAtLowestCa(combat) {\r\n  if (combat.player.counterAttackLevel > 0) {\r\n    return Math.ceil((1 + combat.player.doublerLevel / 50) * 0.0025 *\r\n      combat.lowestFeasibleCALevel);\r\n  }\r\n  return 0;\r\n}\r\n\r\nfunction caRunning(combat) {\r\n  calcLowest(combat);\r\n  combat.lowestFeasibleCALevel =\r\n    Math.max(combat.lowestCALevelToStillHit,\r\n      combat.lowestCALevelToStillKill);\r\n  combat.extraNotes += 'Lowest CA to still 1-hit this creature = ' +\r\n    combat.lowestFeasibleCALevel + '<br>';\r\n  if (combat.lowestFeasibleCALevel !== 0) {\r\n    combat.extraAttackAtLowestFeasibleCALevel =\r\n      Math.floor(combat.player.attackValue * 0.0025 *\r\n      combat.lowestFeasibleCALevel);\r\n    combat.extraDamageAtLowestFeasibleCALevel =\r\n      Math.floor(combat.player.damageValue * 0.0025 *\r\n      combat.lowestFeasibleCALevel);\r\n    combat.extraNotes +=\r\n      'Extra CA Att/Dam at this lowered CA level = ' +\r\n      combat.extraAttackAtLowestFeasibleCALevel + ' / ' +\r\n      combat.extraDamageAtLowestFeasibleCALevel + '<br>';\r\n  }\r\n  combat.extraStaminaPerHitAtLowestFeasibleCALevel = stamAtLowestCa(combat);\r\n  if (combat.extraStaminaPerHitAtLowestFeasibleCALevel <\r\n    combat.extraStaminaPerHit) {\r\n    combat.extraNotes +=\r\n      'Extra Stam Used at this lowered CA level = ' +\r\n      combat.extraStaminaPerHitAtLowestFeasibleCALevel + '<br>';\r\n  } else {\r\n    combat.extraNotes +=\r\n      'No reduction of stam used at the lower CA level<br>';\r\n  }\r\n}\r\n\r\nfunction needCa(combat) {\r\n  return combat.numberOfHitsRequired === '-' ||\r\n    combat.numberOfHitsRequired !== 1;\r\n}\r\n\r\nfunction evalCaKill(combat) {\r\n  if (combat.lowestCALevelToStillHit > 175) {\r\n    combat.extraNotes +=\r\n      'Even with CA175 you cannot hit this creature<br>';\r\n  } else if (combat.lowestCALevelToStillHit !== 0) {\r\n    combat.extraNotes += 'You need a minimum of CA' +\r\n      combat.lowestCALevelToStillHit +\r\n      ' to hit this creature<br>';\r\n  }\r\n}\r\n\r\nfunction evalCaOneHit(combat) {\r\n  if (combat.lowestCALevelToStillKill > 175) {\r\n    combat.extraNotes +=\r\n      'Even with CA175 you cannot 1-hit kill this creature<br>';\r\n  } else if (combat.lowestCALevelToStillKill !== 0) {\r\n    combat.extraNotes += 'You need a minimum of CA' +\r\n      combat.lowestCALevelToStillKill +\r\n      ' to 1-hit kill this creature<br>';\r\n  }\r\n}\r\n\r\nfunction caResult(combat) {\r\n  calcLowest(combat);\r\n  evalCaKill(combat);\r\n  evalCaOneHit(combat);\r\n}\r\n\r\nexport default function evalCA(combat) {\r\n  if (caIsRunning(combat)) {\r\n    caRunning(combat);\r\n  }\r\n  if (needCa(combat)) {\r\n    caResult(combat);\r\n  }\r\n  return combat;\r\n}\r\n","\r\nfunction calcHp(combat) {\r\n  if (combat.callback.groupExists) {\r\n    return combat.callback.groupHPValue;\r\n  }\r\n  return combat.player.hpValue;\r\n}\r\n\r\nfunction calcDmg(combat) {\r\n  if (combat.callback.groupExists) {\r\n    return combat.callback.groupDamageValue;\r\n  }\r\n  return combat.player.damageValue;\r\n}\r\n\r\nfunction evalFortitude(combat) {\r\n  var hpValue = calcHp(combat);\r\n  var fortitudeLevel = combat.player.fortitudeLevel;\r\n  combat.fortitudeExtraHPs = Math.floor(hpValue * fortitudeLevel * 0.001);\r\n  if (fortitudeLevel > 0) {\r\n    combat.extraNotes += 'Fortitude Bonus HP = ' + combat.fortitudeExtraHPs +\r\n      '<br>';\r\n  }\r\n  combat.overallHPValue = hpValue + combat.fortitudeExtraHPs;\r\n}\r\n\r\nfunction evalChiStrike(combat) {\r\n  var chiStrikeLevel = combat.player.chiStrikeLevel;\r\n  combat.chiStrikeExtraDamage = Math.floor(combat.overallHPValue *\r\n    chiStrikeLevel * 0.001);\r\n  if (chiStrikeLevel > 0) {\r\n    combat.extraNotes += 'Chi Strike Bonus Damage = ' +\r\n      combat.chiStrikeExtraDamage + '<br>';\r\n  }\r\n}\r\n\r\nexport default function evalDamage(combat) {\r\n  // Damage:\r\n  evalFortitude(combat);\r\n  evalChiStrike(combat);\r\n\r\n  var damageValue = calcDmg(combat);\r\n  combat.overallDamageValue = damageValue +\r\n    combat.deathDealerBonusDamage + combat.counterAttackBonusDamage +\r\n    combat.holyFlameBonusDamage + combat.chiStrikeExtraDamage;\r\n  combat.damageDone = Math.floor(combat.overallDamageValue - (\r\n    combat.generalVariable * combat.creature.armor +\r\n    combat.hpVariable * combat.creature.hp));\r\n\r\n  if (combat.hitByHowMuch > 0) {\r\n    var dmgLessArmor = 1;\r\n    if (combat.overallDamageValue >=\r\n        combat.generalVariable * combat.creature.armor) {\r\n      dmgLessArmor = combat.overallDamageValue - combat.generalVariable *\r\n        combat.creature.armor;\r\n    }\r\n    combat.numberOfHitsRequired = Math.ceil(combat.hpVariable *\r\n      combat.creature.hp / dmgLessArmor);\r\n  } else {\r\n    combat.numberOfHitsRequired = '-';\r\n  }\r\n  return combat;\r\n}\r\n","function calcDef(combat) {\r\n  if (combat.callback.groupExists) {\r\n    return combat.callback.groupDefenseValue;\r\n  }\r\n  return combat.player.defenseValue;\r\n}\r\n\r\nfunction evalConstitution(combat) {\r\n  if (combat.player.constitutionLevel > 0) {\r\n    combat.extraNotes += 'Constitution Bonus Defense = ' +\r\n    Math.floor(calcDef(combat) *\r\n    combat.player.constitutionLevel * 0.001) + '<br>';\r\n  }\r\n}\r\n\r\nfunction evalFlinch(combat) {\r\n  if (combat.player.flinchLevel > 0) {\r\n    combat.extraNotes += 'Flinch Bonus Attack Reduction = ' +\r\n    Math.floor(combat.creature.attack * combat.player.flinchLevel *\r\n    0.001) + '<br>';\r\n  }\r\n}\r\n\r\nexport default function evalDefence(combat) {\r\n  combat.overallDefenseValue = calcDef(combat) +\r\n    Math.floor(calcDef(combat) *\r\n    combat.player.constitutionLevel * 0.001) +\r\n    combat.nightmareVisageAttackMovedToDefense;\r\n\r\n  evalConstitution(combat);\r\n  evalFlinch(combat);\r\n\r\n  combat.creatureHitByHowMuch = Math.floor(combat.attackVariable *\r\n    combat.creature.attack - combat.creature.attack *\r\n    combat.player.flinchLevel * 0.001 - combat.overallDefenseValue);\r\n\r\n  if (combat.combatEvaluatorBias === 3) {\r\n    combat.creatureHitByHowMuch = Math.floor(combat.creature.attack -\r\n      combat.creature.attack * combat.player.flinchLevel * 0.001 -\r\n      combat.overallDefenseValue - 50);\r\n  }\r\n\r\n  return combat;\r\n}\r\n","\r\nfunction evalSes(combat) {\r\n  if (combat.player.superEliteSlayerLevel > 0) {\r\n    combat.extraNotes += 'SES Stat Reduction Multiplier = ' +\r\n    combat.player.superEliteSlayerMultiplier + '<br>';\r\n  }\r\n}\r\n\r\nfunction evalHolyFlame(combat) {\r\n  combat.holyFlameBonusDamage = 0;\r\n  if (combat.creature.class !== 'Undead') {return;}\r\n  combat.holyFlameBonusDamage = Math.max(Math.floor(\r\n    (combat.player.damageValue - combat.creature.armor) *\r\n    combat.player.holyFlameLevel * 0.002), 0);\r\n  if (combat.player.holyFlameLevel > 0) {\r\n    combat.extraNotes += 'HF Bonus Damage = ' + combat.holyFlameBonusDamage +\r\n    '<br>';\r\n  }\r\n}\r\n\r\nfunction evalExtraStam(combat) {\r\n  combat.extraStaminaPerHit = 0;\r\n  if (combat.player.counterAttackLevel > 0) {\r\n    combat.extraStaminaPerHit = Math.ceil(\r\n      (1 + combat.player.doublerLevel / 50) *\r\n      0.0025 * combat.player.counterAttackLevel\r\n    );\r\n  }\r\n}\r\n\r\nfunction evalDeathDealer(combat) {\r\n  if (combat.player.deathDealerLevel > 0) {\r\n    combat.extraNotes += 'DD Bonus Damage = ' +\r\n      combat.deathDealerBonusDamage + '<br>';\r\n  }\r\n}\r\n\r\nfunction evalCounterAttack(combat) {\r\n  if (combat.player.counterAttackLevel > 0) {\r\n    combat.extraNotes += 'CA Bonus Attack/Damage = ' +\r\n      combat.counterAttackBonusAttack + ' / ' +\r\n      combat.counterAttackBonusDamage + '<br>' +\r\n      'CA Extra Stam Used = ' + combat.extraStaminaPerHit + '<br>';\r\n  }\r\n}\r\n\r\nexport default function evalExtraBuffs(combat) {\r\n  combat.extraNotes = '';\r\n  evalSes(combat);\r\n  // math section ... analysis\r\n  // Holy Flame adds its bonus after the\r\n  // armor of the creature has been taken off.\r\n  evalHolyFlame(combat);\r\n  // Death Dealer and Counter Attack both applied at the same time\r\n  combat.deathDealerBonusDamage =\r\n    Math.floor(combat.player.damageValue * (Math.min(Math.floor(\r\n      combat.player.killStreakValue / 5) * 0.01 *\r\n      combat.player.deathDealerLevel, 20) / 100));\r\n  combat.counterAttackBonusAttack =\r\n    Math.floor(combat.player.attackValue * 0.0025 *\r\n    combat.player.counterAttackLevel);\r\n  combat.counterAttackBonusDamage =\r\n    Math.floor(combat.player.damageValue * 0.0025 *\r\n    combat.player.counterAttackLevel);\r\n  evalExtraStam(combat);\r\n  evalDeathDealer(combat);\r\n  evalCounterAttack(combat);\r\n  return combat;\r\n}\r\n","import {afterUpdateActionList} from '../doNotKill';\r\nimport {bias} from '../assets';\r\nimport calf from '../../support/calf';\r\nimport createDocument from '../../system/createDocument';\r\nimport evalAnalysis from './evalAnalysis';\r\nimport evalArmour from './evalArmour';\r\nimport evalAttack from './evalAttack';\r\nimport evalCa from './evalCa';\r\nimport evalDamage from './evalDamage';\r\nimport evalDefence from './evalDefence';\r\nimport evalExtraBuffs from './evalExtraBuffs';\r\nimport evalHtml from './evalHtml';\r\nimport findNode from '../../system/findNode';\r\nimport {getElementById} from '../../common/getElement';\r\nimport getValue from '../../system/getValue';\r\nimport intValue from '../../system/intValue';\r\nimport {playerDataString} from '../../common/common';\r\nimport retryAjax from '../../ajax/retryAjax';\r\nimport setValue from '../../system/setValue';\r\n\r\nfunction getBiasGeneral(combat) {\r\n  if (bias[combat.combatEvaluatorBias]) {\r\n    return bias[combat.combatEvaluatorBias].generalVariable;\r\n  }\r\n  return 1.1053;\r\n}\r\n\r\nfunction getBiasHp(combat) {\r\n  if (bias[combat.combatEvaluatorBias]) {\r\n    return bias[combat.combatEvaluatorBias].hpVariable;\r\n  }\r\n  return 1.1;\r\n}\r\n\r\nfunction creatureData(ses) { // jQuery\r\n  var obj = {};\r\n  obj.name = $('#dialog-viewcreature').find('h2.name').text();\r\n  obj.class = $('#dialog-viewcreature')\r\n    .find('span.classification')\r\n    .text();\r\n  obj.attack = intValue($('#dialog-viewcreature')\r\n    .find('dd.attribute-atk').text());\r\n  obj.defense = intValue($('#dialog-viewcreature')\r\n    .find('dd.attribute-def').text());\r\n  obj.armor = intValue($('#dialog-viewcreature')\r\n    .find('dd.attribute-arm').text());\r\n  obj.damage = intValue($('#dialog-viewcreature')\r\n    .find('dd.attribute-dmg').text());\r\n  obj.hp = intValue($('#dialog-viewcreature')\r\n    .find('p.health-max').text());\r\n  // reduce stats if critter is a SE and player has SES cast on them.\r\n  if (obj.name.search('Super Elite') !== -1) {\r\n    obj.attack -= Math.ceil(obj.attack * ses);\r\n    obj.defense -= Math.ceil(obj.defense * ses);\r\n    obj.armor -= Math.ceil(obj.armor * ses);\r\n    obj.damage -= Math.ceil(obj.damage * ses);\r\n    obj.hp -= Math.ceil(obj.hp * ses);\r\n  }\r\n  return obj;\r\n}\r\n\r\nfunction checkForCreatureEvaluatorGroup() { // Legacy\r\n  if ($('#creatureEvaluatorGroup').length === 0) {\r\n    $('#dialog-viewcreature')\r\n      .append('<div id=\"creatureEvaluatorGroup\" ' +\r\n        'style=\"clear:both;\"></div>');\r\n  }\r\n}\r\n\r\nfunction checkForCreatureEvaluator() { // Legacy\r\n  if ($('#creatureEvaluator').length === 0) {\r\n    $('#dialog-viewcreature')\r\n      .append('<div id=\"creatureEvaluator\" ' +\r\n        'style=\"clear:both;\"></div>');\r\n  }\r\n}\r\n\r\nfunction getCreaturePlayerData(responseText, callback) { // Legacy\r\n  var combat = {};\r\n  combat.callback = callback;\r\n  // playerdata\r\n  combat.player = playerDataString(responseText);\r\n  combat.combatEvaluatorBias = getValue('combatEvaluatorBias');\r\n  combat.attackVariable = 1.1053;\r\n  combat.generalVariable = getBiasGeneral(combat);\r\n  combat.hpVariable = getBiasHp(combat);\r\n  combat.creature =\r\n    creatureData(combat.player.superEliteSlayerMultiplier);\r\n  combat = evalExtraBuffs(combat);\r\n  combat = evalAttack(combat);\r\n  combat = evalDamage(combat);\r\n  combat = evalDefence(combat);\r\n  combat = evalArmour(combat);\r\n  combat = evalAnalysis(combat);\r\n  combat = evalCa(combat);\r\n  combat.evaluatorHTML = evalHtml(combat);\r\n  var tempdata;\r\n  if (callback.groupEvaluation) {\r\n    checkForCreatureEvaluatorGroup();\r\n    tempdata = combat.evaluatorHTML.replace(/'/g, '\\\\\\'');\r\n    $('#creatureEvaluatorGroup').html(tempdata);\r\n  } else {\r\n    checkForCreatureEvaluator();\r\n    tempdata = combat.evaluatorHTML.replace(/'/g, '\\\\\\'');\r\n    $('#creatureEvaluator').html(tempdata);\r\n  }\r\n}\r\n\r\nfunction getStatValue(stat, doc) { // Legacy\r\n  var node = findNode('//table[@width=\"400\"]/tbody/tr/td[contains(.,\"' +\r\n    stat + ':\")]', doc);\r\n  if (node) {return Number(node.nextSibling.textContent.replace(/,/, ''));}\r\n  return 0;\r\n}\r\n\r\nfunction getCreatureGroupData(responseText) { // Legacy\r\n  var doc = createDocument(responseText);\r\n  var groupAttackValue = getStatValue('Attack', doc);\r\n  var groupDefenseValue = getStatValue('Defense', doc);\r\n  var groupArmorValue = getStatValue('Armor', doc);\r\n  var groupDamageValue = getStatValue('Damage', doc);\r\n  var groupHPValue = getStatValue('HP', doc);\r\n  retryAjax('index.php?no_mobile=1&cmd=profile').done(function(html) {\r\n    getCreaturePlayerData(html, {\r\n      groupExists: true,\r\n      groupAttackValue: groupAttackValue,\r\n      groupDefenseValue: groupDefenseValue,\r\n      groupArmorValue: groupArmorValue,\r\n      groupDamageValue: groupDamageValue,\r\n      groupHPValue: groupHPValue,\r\n      groupEvaluation: true\r\n    });\r\n  });\r\n}\r\n\r\nfunction checkIfGroupExists(responseText) { // Hybrid\r\n  var doc = createDocument(responseText);\r\n  var groupExistsIMG = $(doc)\r\n    .find('img[title=\"Disband Group (Cancel Attack)\"]');\r\n  if (groupExistsIMG.length > 0) {\r\n    var groupHref = groupExistsIMG.parents('td:first').find('a:first')\r\n      .attr('href');\r\n    retryAjax(groupHref).done(getCreatureGroupData);\r\n  }\r\n}\r\n\r\nfunction addRemoveCreatureToDoNotKillList(evt) {\r\n  var creatureName = evt.target.getAttribute('creatureName');\r\n  var ind = calf.doNotKillList.indexOf(creatureName);\r\n  if (ind !== -1) {\r\n    calf.doNotKillList.splice(ind, 1);\r\n    evt.target.innerHTML = 'Add to the do not kill list';\r\n  } else {\r\n    calf.doNotKillList.push(creatureName);\r\n    evt.target.innerHTML = 'Remove from do not kill list';\r\n  }\r\n  setValue('doNotKillList', calf.doNotKillList.join());\r\n  // refresh the action list\r\n  afterUpdateActionList();\r\n}\r\n\r\nexport default function readyViewCreature() { // Hybrid\r\n  $('#creatureEvaluator').html('');\r\n  $('#creatureEvaluatorGroup').html('');\r\n\r\n  retryAjax('index.php?no_mobile=1&cmd=profile').done(function(html) {\r\n    getCreaturePlayerData(html, {\r\n      groupExists: false,\r\n      groupAttackValue: 0,\r\n      groupDefenseValue: 0,\r\n      groupArmorValue: 0,\r\n      groupDamageValue: 0,\r\n      groupHPValue: 0,\r\n      groupEvaluation: false\r\n    });\r\n  });\r\n  retryAjax('index.php?no_mobile=1&cmd=guild&subcmd=groups')\r\n    .done(checkIfGroupExists);\r\n\r\n  $('#addRemoveCreatureToDoNotKillList').html('');\r\n  if ($('#addRemoveCreatureToDoNotKillList').length === 0) {\r\n    var doNotKillElement = '<div id=\"addRemoveCreatureToDo' +\r\n      'NotKillList\"\" class=\"description\" style=\"cursor:' +\r\n      'pointer;text-decoration:underline;color:blue;\"></div>';\r\n    $(doNotKillElement).insertAfter($('#dialog-viewcreature')\r\n      .find('p.description'));\r\n  }\r\n  var creatureName = $('#dialog-viewcreature').find('h2.name')\r\n    .text();\r\n  $('#addRemoveCreatureToDoNotKillList')\r\n    .attr('creatureName', creatureName);\r\n  var extraText = 'Add to the do not kill list';\r\n  if (calf.doNotKillList.indexOf(creatureName) !== -1) {\r\n    extraText = 'Remove from do not kill list';\r\n  }\r\n  $('#addRemoveCreatureToDoNotKillList').html(extraText);\r\n  getElementById('addRemoveCreatureToDoNotKillList')\r\n    .addEventListener('click',\r\n      addRemoveCreatureToDoNotKillList, true);\r\n}\r\n","function doesGroupExist(combat) {\r\n  if (combat.callback.groupExists) {return 'Group ';}\r\n  return '';\r\n}\r\n\r\nfunction canIHitIt(combat) {\r\n  if (combat.hitByHowMuch > 0) {return 'Yes';}\r\n  return 'No';\r\n}\r\n\r\nfunction willIBeHit(combat) {\r\n  if (combat.creatureHitByHowMuch >= 0) {return 'Yes';}\r\n  return 'No';\r\n}\r\n\r\nexport default function evalHTML(combat) {\r\n  return '<table width=\"100%\"><tbody>' +\r\n    '<tr><td bgcolor=\"#CD9E4B\" colspan=\"4\" align=\"center\">' +\r\n    doesGroupExist(combat) +\r\n    'Combat Evaluation</td></tr>' +\r\n    '<tr><td align=\"right\"><span style=\"color:#333333\">' +\r\n    'Will I hit it? </td><td align=\"left\">' +\r\n    canIHitIt(combat) +\r\n    '</td><td align=\"right\"><span style=\"color:#333333\">' +\r\n    'Extra Attack: </td><td align=\"left\">( ' +\r\n    combat.hitByHowMuch + ' )</td></tr>' +\r\n    '<tr><td align=\"right\"><span style=\"color:#333333\">' +\r\n    '# Hits to kill it? </td><td align=\"left\">' +\r\n    combat.numberOfHitsRequired +\r\n    '</td><td align=\"right\"><span style=\"color:#333333\">' +\r\n    'Extra Damage: </td><td align=\"left\">( ' + combat.damageDone +\r\n    ' )</td></tr>' +\r\n    '<tr><td align=\"right\"><span style=\"color:#333333\">' +\r\n    'Will I be hit? </td><td align=\"left\">' +\r\n    willIBeHit(combat) +\r\n    '</td><td align=\"right\"><span style=\"color:#333333\">' +\r\n    'Extra Defense: </td><td align=\"left\">( ' + -1 *\r\n    combat.creatureHitByHowMuch + ' )</td></tr>' +\r\n    '<tr><td align=\"right\"><span style=\"color:#333333\">' +\r\n    '# Hits to kill me? </td><td align=\"left\">' +\r\n    combat.numberOfCreatureHitsTillDead +\r\n    '</td><td align=\"right\"><span style=\"color:#333333\">' +\r\n    'Extra Armor + HP: </td><td align=\"left\">( ' + -1 *\r\n    combat.creatureDamageDone + ' )</td></tr>' +\r\n    '<tr><td align=\"right\"><span style=\"color:#333333\">' +\r\n    '# Player Hits? </td><td align=\"left\">' + combat.playerHits +\r\n    '</td><td align=\"right\"><span style=\"color:#333333\">' +\r\n    '# Creature Hits? </td><td align=\"left\">' + combat.creatureHits +\r\n    '</td></tr>' +\r\n    '<tr><td align=\"right\"><span style=\"color:#333333\">' +\r\n    'Fight Status: </span></td><td align=\"left\" colspan=\"3\"><span>' +\r\n    combat.fightStatus + '</span></td></tr>' +\r\n    '<tr><td align=\"right\"><span style=\"color:#333333\">' +\r\n    'Notes: </span></td><td align=\"left\" colspan=\"3\">' +\r\n    '<span style=\"font-size:x-small;\">' + combat.extraNotes +\r\n    '</span></td></tr>' +\r\n    '<tr><td colspan=\"4\"><span style=\"font-size:x-small; ' +\r\n    'color:gray\">*Does include CA, DD, HF, DC, Flinch, Super Elite ' +\r\n    'Slayer, NMV, Sanctuary, Constitution, Fortitude, Chi Strike ' +\r\n    'and Terrorize (if active) and allow for randomness (1.1053). ' +\r\n    'Constitution, NMV, Fortitude and Chi Strike apply to group ' +\r\n    'stats.</span></td></tr>' +\r\n    '</tbody></table>';\r\n}\r\n","import fallback from '../../system/fallback';\r\nimport getForage from '../../ajax/getForage';\r\nimport getValue from '../../system/getValue';\r\nimport setForage from '../../ajax/setForage';\r\nimport setValue from '../../system/setValue';\r\n\r\nexport var showMonsterLog;\r\nvar monsterLog;\r\n\r\nexport function toggleShowMonsterLog() {\r\n  showMonsterLog = !showMonsterLog;\r\n  setValue('showMonsterLog', showMonsterLog);\r\n}\r\n\r\nfunction updateMinMax(_logStat, creatureStat) {\r\n  var logStat = fallback(_logStat, {});\r\n  if (logStat.min) {\r\n    logStat.min = Math.min(logStat.min, creatureStat);\r\n  } else {\r\n    logStat.min = creatureStat;\r\n  }\r\n  if (logStat.max) {\r\n    logStat.max = Math.max(logStat.max, creatureStat);\r\n  } else {\r\n    logStat.max = creatureStat;\r\n  }\r\n  return logStat;\r\n}\r\n\r\nfunction creatureHazEnhancements(creature) {\r\n  return creature.enhancements && creature.enhancements.length > 0;\r\n}\r\n\r\nfunction doMonsterLog(creature) {\r\n  if (!monsterLog) {monsterLog = {};}\r\n  monsterLog[creature.name] = fallback(monsterLog[creature.name], {});\r\n  var logCreature = monsterLog[creature.name];\r\n  logCreature.creature_class = fallback(logCreature.creature_class,\r\n    creature.creature_class);\r\n  logCreature.image_id = fallback(logCreature.image_id,\r\n    creature.image_id);\r\n  logCreature.level = fallback(logCreature.level,\r\n    Number(creature.level));\r\n  logCreature.type = fallback(logCreature.type, creature.type);\r\n  logCreature.armor = updateMinMax(logCreature.armor,\r\n    Number(creature.armor));\r\n  logCreature.attack = updateMinMax(logCreature.attack,\r\n    Number(creature.attack));\r\n  logCreature.damage = updateMinMax(logCreature.damage,\r\n    Number(creature.damage));\r\n  logCreature.defense = updateMinMax(logCreature.defense,\r\n    Number(creature.defense));\r\n  logCreature.hp = updateMinMax(logCreature.hp,\r\n    Number(creature.hp));\r\n  if (creatureHazEnhancements(creature)) {\r\n    logCreature.enhancements = fallback(logCreature.enhancements, {});\r\n    var logEnh = logCreature.enhancements;\r\n    creature.enhancements.forEach(function(e) {\r\n      logEnh[e.name] = updateMinMax(logEnh[e.name], Number(e.value));\r\n    });\r\n  }\r\n  setForage('fsh_monsterLog', monsterLog);\r\n}\r\n\r\nexport function processMonsterLog(creature) {\r\n  if (showMonsterLog) {doMonsterLog(creature);}\r\n}\r\n\r\nexport function getMonsterPrefs() {\r\n  showMonsterLog = getValue('showMonsterLog');\r\n  getForage('fsh_monsterLog').done(function(data) {\r\n    monsterLog = data || {};\r\n  });\r\n}\r\n","import calf from '../../support/calf';\r\nimport isFunction from '../../common/isFunction';\r\n\r\nexport var huntingBuffs;\r\nexport var huntingBuffsName;\r\nvar buffLookup = {\r\n  '1': function() {\r\n    huntingBuffs = calf.buffs;\r\n    huntingBuffsName = calf.buffsName;\r\n  },\r\n  '2': function() {\r\n    huntingBuffs = calf.buffs2;\r\n    huntingBuffsName = calf.buffs2Name;\r\n  },\r\n  '3': function() {\r\n    huntingBuffs = calf.buffs3;\r\n    huntingBuffsName = calf.buffs3Name;\r\n  }\r\n};\r\n\r\nexport function setCurrentBuffList() {\r\n  var tmpFn = buffLookup[calf.enabledHuntingMode];\r\n  if (isFunction(tmpFn)) {\r\n    tmpFn();\r\n  }\r\n}\r\n","import {def_afterUpdateActionlist} from '../../support/constants';\r\nimport retryAjax from '../../ajax/retryAjax';\r\nimport {\r\n  getBias,\r\n  getCreaturePrefs,\r\n  getMyStats,\r\n  processMouseOver,\r\n  showCreatureInfo\r\n} from './creatureInfo';\r\nimport {\r\n  getMonsterPrefs,\r\n  processMonsterLog,\r\n  showMonsterLog\r\n} from './processMonsterLog';\r\n\r\nfunction badData(data) {\r\n  return !data || !data.response || !data.response.data;\r\n}\r\n\r\nfunction processMonster(data) {\r\n  if (badData(data)) {return;} // creature is null\r\n  processMouseOver(data);\r\n  processMonsterLog(data.response.data);\r\n}\r\n\r\nfunction loopActions(e, i) { // jQuery.min\r\n  if (e.type !== 6) {return;}\r\n  retryAjax({\r\n    url: 'fetchdata.php?a=1&id=' + e.data.id + '&passback=' + i,\r\n    dataType: 'json'\r\n  }).done(processMonster);\r\n}\r\n\r\nfunction getCreatures() {\r\n  if (showCreatureInfo) {getMyStats();}\r\n  GameData.actions().forEach(loopActions);\r\n}\r\n\r\nfunction initMonsterLog() {\r\n  // if (!showCreatureInfo && !showMonsterLog) {return;}\r\n  if (showCreatureInfo || showMonsterLog) {\r\n    getCreatures();\r\n  }\r\n}\r\n\r\nexport default function startMonsterLog() { // jQuery.min\r\n  getCreaturePrefs();\r\n  getMonsterPrefs();\r\n  getBias();\r\n  $.subscribe(def_afterUpdateActionlist, initMonsterLog);\r\n  initMonsterLog();\r\n}\r\n","import {def_afterUpdateActionlist} from '../support/constants';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport setValue from '../system/setValue';\r\n\r\nvar hidePlayerActions;\r\n\r\nexport function toggleHidePlayerActions() {\r\n  hidePlayerActions = !hidePlayerActions;\r\n  setValue('hidePlayerActions', hidePlayerActions);\r\n  GameData.fetch(256);\r\n}\r\n\r\nfunction doHidePlayerActions() {\r\n  if (!hidePlayerActions) {return;}\r\n  var act = getElementById('actionList');\r\n  var players = act.getElementsByClassName('player');\r\n  Array.prototype.forEach.call(players, function(el) {\r\n    var verbs = el.getElementsByClassName('verbs');\r\n    if (verbs.length === 1) {\r\n      verbs[0].classList.add('fshHide');\r\n    }\r\n  });\r\n}\r\n\r\nexport function prepareHidePlayerActions() {\r\n  hidePlayerActions = getValue('hidePlayerActions');\r\n  $.subscribe(def_afterUpdateActionlist, doHidePlayerActions);\r\n  doHidePlayerActions();\r\n}\r\n","import calf from '../../support/calf';\r\nimport {setCurrentBuffList} from './setCurrentBuffList';\r\nimport setValue from '../../system/setValue';\r\n\r\nexport default function toggleEnabledHuntingMode(e) {\r\n  if (e.target.name !== 'enabledHuntingMode') {return;}\r\n  calf.enabledHuntingMode = e.target.value;\r\n  setValue('enabledHuntingMode', calf.enabledHuntingMode);\r\n  setCurrentBuffList();\r\n  GameData.fetch(16);\r\n}\r\n","import bitwiseAnd from '../common/bitwiseAnd';\r\nimport calf from '../support/calf';\r\nimport {def_fetch_worldRealmActions} from '../support/constants';\r\nimport jsonParse from '../common/jsonParse';\r\nimport setValue from '../system/setValue';\r\n\r\nexport function toggleSubLvlCreature() {\r\n  calf.hideSubLvlCreature = !calf.hideSubLvlCreature;\r\n  setValue('hideSubLvlCreature', calf.hideSubLvlCreature);\r\n  GameData.fetch(256);\r\n}\r\n\r\nvar testActions = [\r\n  function(myData) {return !myData;},\r\n  function(myData) {return !myData.actions;},\r\n  function(myData) {return myData.actions.length === 0;}\r\n];\r\n\r\nfunction xhrDataFilter(data) {\r\n  var myData = jsonParse(data);\r\n  if (testActions.some(function(el) {return el();})) {return data;}\r\n  var realm = GameData.realm();\r\n  myData.actions = myData.actions.filter(function(el) {\r\n    if (el.type === 6) {\r\n      return el.data.creature_type !== 0 || el.data.level >= realm.minlevel;\r\n    }\r\n    return true;\r\n  });\r\n  var ret = JSON.stringify(myData);\r\n  return ret;\r\n}\r\n\r\nfunction isActionList(originalOptions) {\r\n  return originalOptions.data &&\r\n    originalOptions.data.d &&\r\n    bitwiseAnd(originalOptions.data.d, def_fetch_worldRealmActions);\r\n}\r\n\r\nfunction xhrPreFilter(options, originalOptions) {\r\n  if (calf.hideSubLvlCreature && isActionList(originalOptions)) {\r\n    options.dataFilter = xhrDataFilter;\r\n  }\r\n}\r\n\r\nexport function interceptXHR() { // jQuery.min\r\n  $.ajaxPrefilter('JSON', xhrPreFilter);\r\n}\r\n","import {createDiv} from '../../common/cElement';\r\nimport {getElementById} from '../../common/getElement';\r\nimport {huntingBuffsHtml} from '../../settings/worldPrefs';\r\nimport insertElement from '../../common/insertElement';\r\nimport insertElementBefore from '../../common/insertElementBefore';\r\nimport isFunction from '../../common/isFunction';\r\nimport {simpleCheckboxHtml} from '../../settings/simpleCheckbox';\r\nimport toggleEnabledHuntingMode from './toggleEnabledHuntingMode';\r\nimport {toggleHidePlayerActions} from '../prepareHidePlayerActions';\r\nimport {toggleShowCreatureInfo} from '../monsterLog/creatureInfo';\r\nimport toggleShowHuntingBuffs from './toggleShowHuntingBuffs';\r\nimport {toggleShowMonsterLog} from '../monsterLog/processMonsterLog';\r\nimport {toggleShowTitanInfo} from '../titanStats/titanStats';\r\nimport {toggleSubLvlCreature} from '../interceptXHR';\r\n\r\nexport var missingBuffsDiv;\r\n\r\nvar fshEvents = {\r\n  hideSubLvlCreature: toggleSubLvlCreature,\r\n  hidePlayerActions: toggleHidePlayerActions,\r\n  showCreatureInfo: toggleShowCreatureInfo,\r\n  showHuntingBuffs: toggleShowHuntingBuffs,\r\n  showMonsterLog: toggleShowMonsterLog,\r\n  showTitanInfo: toggleShowTitanInfo\r\n};\r\n\r\nfunction prefsClickEvent(e) {\r\n  var tmpFn = fshEvents[e.target.name];\r\n  if (isFunction(tmpFn)) {\r\n    e.target.blur();\r\n    tmpFn(e);\r\n  }\r\n}\r\n\r\nexport function buildFshDivs() {\r\n  var fshDiv = createDiv({className: 'fshCenter fshFten'});\r\n  var prefsDiv = createDiv({\r\n    id: 'fshWorldPrefs',\r\n    innerHTML: simpleCheckboxHtml('showCreatureInfo') + '&nbsp;&nbsp;' +\r\n      simpleCheckboxHtml('showMonsterLog') + '&nbsp;&nbsp;' +\r\n      simpleCheckboxHtml('showTitanInfo') + '&nbsp;&nbsp;' +\r\n      '<br>' +\r\n      simpleCheckboxHtml('hideSubLvlCreature') + '&nbsp;&nbsp;' +\r\n      simpleCheckboxHtml('hidePlayerActions') + '&nbsp;&nbsp;' +\r\n      huntingBuffsHtml()\r\n  });\r\n  prefsDiv.addEventListener('click', prefsClickEvent);\r\n  prefsDiv.addEventListener('change', toggleEnabledHuntingMode);\r\n  insertElement(fshDiv, prefsDiv);\r\n  missingBuffsDiv = createDiv();\r\n  insertElement(fshDiv, missingBuffsDiv);\r\n  var tempWorldButtons = getElementById('worldContainerBelow').children[0];\r\n  insertElementBefore(fshDiv, tempWorldButtons);\r\n}\r\n","import calf from '../../support/calf';\r\nimport setValue from '../../system/setValue';\r\n\r\nexport default function toggleShowHuntingBuffs() {\r\n  calf.showBuffs = !calf.showBuffs;\r\n  setValue('showHuntingBuffs', calf.showBuffs);\r\n  GameData.fetch(16);\r\n}\r\n","import calf from '../../support/calf';\r\nimport {def_playerBuffs} from '../../support/constants';\r\nimport {missingBuffsDiv} from './buildFshDivs';\r\nimport {\r\n  huntingBuffs,\r\n  huntingBuffsName,\r\n  setCurrentBuffList\r\n} from './setCurrentBuffList';\r\n\r\nfunction huntingBuffsEnabled(evt, data) {\r\n  if (!calf.showBuffs) {\r\n    missingBuffsDiv.innerHTML = '';\r\n    return;\r\n  }\r\n  var buffHash = data.b.reduce(function(prev, curr) {\r\n    prev[curr.name] = true;\r\n    return prev;\r\n  }, {});\r\n  var missingBuffs = huntingBuffs.reduce(function(prev, curr) {\r\n    if (!buffHash[curr.trim()]) {prev.push(curr);}\r\n    return prev;\r\n  }, []);\r\n  if (missingBuffs.length > 0) {\r\n    missingBuffsDiv.innerHTML = 'You are missing some ' +\r\n      huntingBuffsName + ' hunting buffs<br>(' +\r\n      missingBuffs.join(', ') + ')';\r\n  } else {missingBuffsDiv.innerHTML = '';}\r\n}\r\n\r\nfunction dataEventsPlayerBuffs(evt, data) {\r\n  if (huntingBuffs) {huntingBuffsEnabled(evt, data);}\r\n}\r\n\r\nexport function doHuntingBuffs() { // jQuery.min\r\n  setCurrentBuffList();\r\n  $.subscribe(def_playerBuffs, dataEventsPlayerBuffs);\r\n  if (calf.showBuffs && window.initialGameData) { // HCS initial data\r\n    dataEventsPlayerBuffs(null,\r\n      {b: window.initialGameData.player.buffs});\r\n  }\r\n}\r\n","import {buildFshDivs} from './buildFshDivs';\r\nimport calf from '../../support/calf';\r\nimport {doHuntingBuffs} from './doHuntingBuffs';\r\nimport getValue from '../../system/getValue';\r\nimport {interceptXHR} from '../interceptXHR';\r\nimport {prepareHidePlayerActions} from '../prepareHidePlayerActions';\r\nimport shouldBeArray from '../../system/shouldBeArray';\r\n\r\nfunction getPrefs() {\r\n  calf.buffs = shouldBeArray('huntingBuffs');\r\n  calf.buffsName = getValue('huntingBuffsName');\r\n  calf.buffs2 = shouldBeArray('huntingBuffs2');\r\n  calf.buffs2Name = getValue('huntingBuffs2Name');\r\n  calf.buffs3 = shouldBeArray('huntingBuffs3');\r\n  calf.buffs3Name = getValue('huntingBuffs3Name');\r\n  calf.doNotKillList = shouldBeArray('doNotKillList');\r\n  calf.enabledHuntingMode = getValue('enabledHuntingMode');\r\n  calf.hideSubLvlCreature = getValue('hideSubLvlCreature');\r\n  calf.showBuffs = getValue('showHuntingBuffs');\r\n  calf.showTitanInfo = getValue('showTitanInfo');\r\n}\r\n\r\nexport default function worldPrefs() {\r\n  getPrefs();\r\n  buildFshDivs();\r\n  interceptXHR();\r\n  doHuntingBuffs();\r\n  prepareHidePlayerActions();\r\n}\r\n","import combatLogger from './combatLogger';\r\nimport {def_afterUpdateActionlist} from '../support/constants';\r\nimport doNotKill from './doNotKill';\r\nimport {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport injectRelic from './relic/relic';\r\nimport onWorld from './onWorld';\r\nimport prepareShop from './shop';\r\nimport readyViewCreature from './viewCreature/viewCreature';\r\nimport startMonsterLog from './monsterLog/monsterLog';\r\nimport worldPrefs from './worldPrefs/worldPrefs';\r\n\r\nfunction hideGroupByType(type) { // jQuery\r\n  $('#actionList li.creature-' + type.toString() + ' a.create-group').hide();\r\n}\r\n\r\nfunction hideGroupSubscribe(type) { // jQuery.min\r\n  $.subscribe(def_afterUpdateActionlist, hideGroupByType.bind(null, type));\r\n}\r\n\r\nvar hideGroupTypes = [\r\n  'hideChampionsGroup',\r\n  'hideElitesGroup',\r\n  'hideSEGroup',\r\n  'hideTitanGroup',\r\n  'hideLegendaryGroup'\r\n];\r\n\r\nfunction hideGroupButton() {\r\n  hideGroupTypes.forEach(function(el, i) {\r\n    if (getValue(el)) {\r\n      hideGroupSubscribe(i + 1);\r\n      hideGroupByType(i + 1);\r\n    }\r\n  });\r\n}\r\n\r\nfunction colorType(actionList, creatureClass, colorClass) {\r\n  var creatures = actionList.getElementsByClassName(creatureClass);\r\n  Array.prototype.forEach.call(creatures, function(el) {\r\n    el.classList.add(colorClass);\r\n  });\r\n}\r\n\r\nfunction colorMonsters() {\r\n  var act = getElementById('actionList');\r\n  colorType(act, 'creature-1', 'fshGreen');\r\n  colorType(act, 'creature-2', 'fshYellow');\r\n  colorType(act, 'creature-3', 'fshRed');\r\n}\r\n\r\nfunction doMonsterColors() { // jQuery.min\r\n  if (getValue('enableCreatureColoring')) {\r\n    $.subscribe(def_afterUpdateActionlist, colorMonsters);\r\n    colorMonsters();\r\n  }\r\n}\r\n\r\nfunction doRepair(e, key) {\r\n  if (key === 'ACT_REPAIR') {GameData.fetch(402);}\r\n}\r\n\r\nexport default function subscribes() { // jQuery.min\r\n  worldPrefs();\r\n  // subscribe to view creature events on the new map.\r\n  $.subscribe('ready.view-creature', readyViewCreature);\r\n  hideGroupButton(); // Hide Create Group button\r\n  doMonsterColors();\r\n  doNotKill(); // add do-not-kill list functionality\r\n  startMonsterLog(); // add monster log functionality\r\n  $.subscribe('keydown.controls', doRepair);\r\n  combatLogger();\r\n  onWorld(); // on world\r\n  // somewhere near here will be multi buy on shop\r\n  prepareShop();\r\n  injectRelic();\r\n  $('#messageCenter').worldMessageCenter({offset: '0 60'});\r\n  $('#mapTooltip').qtip('hide');\r\n}\r\n\r\n// -1 = world page\r\n// 0 = quest responce\r\n// 1 = view creature\r\n// 2 = attack creature\r\n// 3 = attack player\r\n// 4 = move\r\n// 5 = use stair\r\n// 6 = use chest\r\n// 7 = take portal\r\n// 10 = problaby view relic\r\n// 11 = take relic\r\n// 12 = create group\r\n// 13 = view shop\r\n// 14 = purchase item\r\n// 15 = repair\r\n// 17 = login\r\n// 18 = username not found\r\n","import calf from '../support/calf';\r\nimport {createDiv} from '../common/cElement';\r\nimport createDocument from '../system/createDocument';\r\nimport findImps from './findImps';\r\nimport findNode from '../system/findNode';\r\nimport {getElementById} from '../common/getElement';\r\nimport getImpsRemaining from './getImpsRemaining';\r\nimport getValue from '../system/getValue';\r\nimport hasCA from './hasCA';\r\nimport hasDblr from './hasDblr';\r\nimport {imageServer} from '../system/system';\r\nimport insertElement from '../common/insertElement';\r\nimport jQueryPresent from '../common/jQueryPresent';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport setValue from '../system/setValue';\r\nimport subscribes from '../newMap/newMap';\r\n\r\nfunction recastImpAndRefresh(responseText) { // Legacy\r\n  var doc = createDocument(responseText);\r\n  if (doc) {\r\n    location.reload();\r\n  }\r\n}\r\n\r\nfunction toggleKsTracker() { // Legacy\r\n  var trackKS = getElementById('Helper:toggleKStracker');\r\n  if (trackKS) {\r\n    trackKS.addEventListener('click', function() {\r\n      setValue('trackKillStreak',\r\n        !getValue('trackKillStreak'));\r\n      location.reload();\r\n    }, true);\r\n  }\r\n}\r\n\r\nfunction canRecast(hasDd, hasSsi, impsRem) {\r\n  return (hasDd || hasSsi) && impsRem === 0;\r\n}\r\n\r\nfunction impRecast(hasDd, hasSsi, impsRem) { // Legacy - Old Map\r\n  if (canRecast(hasDd, hasSsi, impsRem)) {\r\n    var _recastImpAndRefresh = getElementById('Helper:recastImpAndRefresh');\r\n    var impHref = 'index.php?no_mobile=1&cmd=quickbuff&subcmd=activate&target' +\r\n      'Players=' +\r\n      $('dt.stat-name:first').next().text().replace(/,/g, '') +\r\n      '&skills%5B%5D=55';\r\n    _recastImpAndRefresh.addEventListener('click', function() {\r\n      retryAjax(impHref).done(recastImpAndRefresh);\r\n    }, true);\r\n  }\r\n}\r\n\r\nfunction injectOldMap() { // Legacy - Old Map\r\n  // extra world screen text\r\n  var replacementText = '<td background=\"' + imageServer +\r\n    '/skin/realm_right_bg.jpg\"><table align=\"right\" cellpadding=\"1\" ' +\r\n    'style=\"width:270px;margin-left:38px;margin-right:38px;font-size' +\r\n    ':medium; border-spacing: 1px; border-collapse: collapse;\"><tr><' +\r\n    'td colspan=\"2\" height=\"10\"></td></tr><tr>';\r\n  var hasShieldImp = findNode('//img[contains(@src,\"/55_sm.gif\")]');\r\n  var hasDeathDealer = findNode('//img[contains(@src,\"/50_sm.gif\")]');\r\n  var impsRemaining = getImpsRemaining(hasShieldImp);\r\n  replacementText += findImps(hasDeathDealer, hasShieldImp, impsRemaining);\r\n  replacementText += hasCA();\r\n  replacementText += hasDblr();\r\n  if (calf.huntingMode) {\r\n    replacementText += '<tr><td style=\"font-size: small; color:red\">' +\r\n      'Hunting mode enabled</td></tr>';\r\n  }\r\n  replacementText += '<tr><td colspan=\"2\" height=\"10\"></td></tr>';\r\n  replacementText += '</td>';\r\n\r\n  var injectHere = findNode('//div[table[@class=\"centered\" ' +\r\n    'and @style=\"width: 270px;\"]]');\r\n  if (!injectHere) {return;}\r\n  // insert after kill all monsters image and text\r\n  var newSpan = createDiv({innerHTML: replacementText});\r\n  insertElement(injectHere, newSpan);\r\n\r\n  impRecast(hasDeathDealer, hasShieldImp, impsRemaining);\r\n  toggleKsTracker();\r\n}\r\n\r\nfunction oldOrNew() {\r\n  if (getElementById('worldPage') && window.GameData) { // new map\r\n    subscribes();\r\n  } else { // not new map.\r\n    injectOldMap();\r\n  }\r\n}\r\n\r\nexport default function injectWorld() {\r\n  if (jQueryPresent()) {oldOrNew();}\r\n}\r\n","import {createTd} from './common/cElement';\r\nimport doinvent from './app/inventing/doinvent';\r\nimport fallback from './system/fallback';\r\nimport findNode from './system/findNode';\r\nimport findNodes from './system/findNodes';\r\nimport {getElementById} from './common/getElement';\r\nimport {guideUrl} from './support/constants';\r\nimport insertElement from './common/insertElement';\r\nimport jQueryPresent from './common/jQueryPresent';\r\nimport jsonFail from './common/jsonFail';\r\nimport outputResult from './common/outputResult';\r\nimport retryAjax from './ajax/retryAjax';\r\nimport {server} from './system/system';\r\n\r\nvar itemRE = /<b>([^<]+)<\\/b>/i;\r\nvar plantFromComponentHash = {\r\n  'Amber Essense': 'Amber Plant',\r\n  'Blood Bloom Flower': 'Blood Bloom Plant',\r\n  'Dark Shade ': 'Dark Shade Plant',\r\n  'Snake Eye': 'Elya Snake Head',\r\n  'Snake Venom Fang': 'Elya Snake Head',\r\n  'Heffle Wart': 'Heffle Wart Plant',\r\n  'Jademare Blossom': 'Jademare Plant',\r\n  'Trinettle Leaf': 'Trinettle Plant',\r\n  'Purplet Flower': 'Purplet Plant',\r\n};\r\n\r\nfunction quickInventDone(json) {\r\n  var inventResult = getElementById('invent_Result');\r\n  if (jsonFail(json, inventResult)) {return;}\r\n  if (json.r.success) {\r\n    outputResult('<span class=\"fshGreen\">' +\r\n      'You successfully invented the item!</span>', inventResult);\r\n  } else {\r\n    outputResult('<span class=\"fshRed\">' +\r\n      'You have failed to invent the item.</span>', inventResult);\r\n  }\r\n}\r\n\r\nfunction quickInvent() { // Legacy\r\n  var amountToInvent = $('#invent_amount').attr('value');\r\n  var recipeID = $('input[name=\"recipe_id\"]').attr('value');\r\n  $('#invet_Result_label').html('Inventing ' + amountToInvent + ' Items');\r\n  for (var i = 0; i < amountToInvent; i += 1) {\r\n    doinvent(recipeID).done(quickInventDone);\r\n  }\r\n}\r\n\r\nfunction injectInvent() { // Bad jQuery\r\n  var selector = '<tr><td align=\"center\">Select how many to quick ' +\r\n    'invent<input value=1 id=\"invent_amount\" name=\"invent_amount\" ' +\r\n    'size=3 class=\"custominput\"></td></tr>' +\r\n    '<tr><td align=\"center\"><input id=\"quickInvent\" value=\"Quick ' +\r\n    'invent items\" class=\"custombutton\" type=\"submit\"></td></tr>' + // button to invent\r\n    '<tr><td colspan=6 align=\"center\"><span id=\"invet_Result_label\">' +\r\n    '</span><ol id=\"invent_Result\"></ol></td></tr>';\r\n  $('input[name=\"recipe_id\"]').closest('tbody').append(selector);\r\n  getElementById('quickInvent').addEventListener('click',\r\n    quickInvent, true);\r\n\r\n}\r\n\r\nfunction getItemName(responseText) { // Legacy\r\n  var itemName = itemRE.exec(responseText);\r\n  if (itemName) {return itemName[1];}\r\n}\r\n\r\nfunction injectViewRecipeLinks(responseText, callback) { // Legacy\r\n  var itemName = getItemName(responseText);\r\n  var plantFromComponent = fallback(plantFromComponentHash[itemName],\r\n    itemName);\r\n  if (itemName !== plantFromComponent) {\r\n    var itemLinks = createTd({\r\n      innerHTML: '<a href=\"' + server +\r\n        '?cmd=auctionhouse&search=' +\r\n        encodeURI(plantFromComponent) + '\">AH</a>'\r\n    });\r\n    var counter = findNode('../../../../tr[2]/td', callback);\r\n    counter.setAttribute('colspan', '2');\r\n    insertElement(callback.parentNode.parentNode.parentNode, itemLinks);\r\n  }\r\n}\r\n\r\nfunction linkFromMouseoverCustom(mouseOver) { // Legacy\r\n  var reParams =\r\n    /item_id=(\\d+)&inv_id=([-0-9]*)&t=(\\d+)&p=(\\d+)&vcode=([a-z0-9]*)/i;\r\n  var reResult = reParams.exec(mouseOver);\r\n  if (reResult === null) {\r\n    return null;\r\n  }\r\n  var itemId = reResult[1];\r\n  var invId = reResult[2];\r\n  var type = reResult[3];\r\n  var pid = reResult[4];\r\n  var vcode = reResult[5];\r\n  var theUrl = 'fetchitem.php?item_id=' + itemId + '&inv_id=' + invId +\r\n    '&t=' + type + '&p=' + pid + '&vcode=' + vcode;\r\n  theUrl = server + theUrl;\r\n  return theUrl;\r\n}\r\n\r\nfunction injectViewRecipe() { // Legacy\r\n  var recipe = $('#pCC table table b').first();\r\n  var name = recipe.html();\r\n  var searchName = recipe.html().replace(/ /g, '%20');\r\n  recipe.html('<a href=\"' + guideUrl +\r\n    'items&subcmd=view&search_name=' + searchName + '\">' + name +\r\n    '</a>');\r\n\r\n  var components = findNodes(\r\n    '//b[.=\"Components Required\"]/../../following-sibling::tr[2]//img');\r\n  if (components) {\r\n    components.forEach(function(compI) {\r\n      var mo = compI.dataset.tipped;\r\n      retryAjax(linkFromMouseoverCustom(mo)).done(function(html) {\r\n        injectViewRecipeLinks(html, compI);\r\n      });\r\n      var componentCountElement = compI.parentNode.parentNode\r\n        .parentNode.nextSibling.firstChild;\r\n      componentCountElement.innerHTML = '<nobr>' +\r\n        componentCountElement.innerHTML + '</nobr>';\r\n    });\r\n  }\r\n}\r\n\r\nexport default function inventing() {\r\n  if (jQueryPresent()) {\r\n    injectViewRecipe();\r\n    injectInvent();\r\n  }\r\n}\r\n","import addCommas from './system/addCommas';\r\nimport {closestTable} from './common/closest';\r\nimport {getElementById} from './common/getElement';\r\nimport {pCC} from './support/layout';\r\n\r\nvar amt;\r\nvar prc;\r\nvar warn;\r\n\r\nfunction getAmount() {\r\n  if (!amt) {amt = getElementById('amount');}\r\n  return amt;\r\n}\r\n\r\nfunction getPrice() {\r\n  if (!prc) {prc = getElementById('price');}\r\n  return prc;\r\n}\r\n\r\nfunction getWarning() {\r\n  if (!warn) {\r\n    var requestTable = closestTable(getAmount());\r\n    var newRow = requestTable.insertRow(2);\r\n    warn = newRow.insertCell(0);\r\n    warn.colSpan = '2';\r\n    warn.className = 'fshCenter';\r\n  }\r\n  return warn;\r\n}\r\n\r\nfunction totalPrice(amount, sellPrice) {\r\n  var gross = amount * sellPrice;\r\n  return gross + Math.ceil(gross / 200);\r\n}\r\n\r\nfunction marketplaceWarning(sellPrice) {\r\n  var amount = getAmount().value;\r\n  getWarning().innerHTML = '<span class=\"fshBlue\">You are offering to buy ' +\r\n    '<b>' + amount + '</b> FSP for >> <b>' + addCommas(sellPrice) +\r\n    '</b> (Total: ' + addCommas(totalPrice(amount, sellPrice)) + ')</span>';\r\n}\r\n\r\nfunction clearWarning() {\r\n  if (warn && warn.innerHTML !== '') {warn.innerHTML = '';}\r\n}\r\n\r\nfunction addMarketplaceWarning() {\r\n  var price = getPrice();\r\n  if (price) {\r\n    var sellPrice = price.value;\r\n    if (sellPrice.search(/^[0-9]+$/) !== -1) {\r\n      marketplaceWarning(sellPrice);\r\n    } else {clearWarning();}\r\n  }\r\n}\r\n\r\nexport default function marketplace() {\r\n  pCC.addEventListener('keyup', addMarketplaceWarning);\r\n}\r\n","import callApp from '../callApp';\r\n\r\nexport default function doinvent(recipe) {\r\n  return callApp({\r\n    cmd: 'inventing',\r\n    subcmd: 'doinvent',\r\n    recipe_id: recipe\r\n  });\r\n}\r\n","import {createTr} from './common/cElement';\r\nimport getValue from './system/getValue';\r\nimport insertElement from './common/insertElement';\r\nimport {now} from './support/constants';\r\nimport outputFormat from './system/outputFormat';\r\n\r\nfunction dontPost() {\r\n  var submitButton = document.querySelector('#pCC input[type=\"submit\"]');\r\n  if (submitButton) {\r\n    submitButton.addEventListener('click', function(e) {\r\n      e.preventDefault();\r\n      window.location = 'index.php?cmd=pvpladder&viewing_band_id=' +\r\n        document.querySelector('#pCC select[name=\"viewing_band_id\"]').value;\r\n    });\r\n  }\r\n}\r\n\r\nfunction formatLastReset(lastLadderReset) {\r\n  var m = Math.floor((now - lastLadderReset) / 60000);\r\n  var h = Math.floor(m / 60);\r\n  m %= 60;\r\n  return outputFormat(h, ' hours, ') + m + ' mins';\r\n}\r\n\r\nfunction formatTime() {\r\n  var lastLadderReset = getValue('lastLadderReset');\r\n  if (lastLadderReset < now - 48 * 60 * 60 * 1000) {\r\n    return '<span class=\"fshLink tip-static\" data-tipped=\"FSH has not seen ' +\r\n      'the last ladder reset.<br>You can find it in your log if you ' +\r\n      'qualified<br>or Tavern Rumours.\">???</span>';\r\n  }\r\n  return formatLastReset(lastLadderReset);\r\n}\r\n\r\nfunction lastReset() {\r\n  var topTable = document.querySelector('#pCC table');\r\n  var newRow = createTr();\r\n  var leftCell = newRow.insertCell(-1);\r\n  leftCell.height = 25;\r\n  leftCell.textContent = 'Last Reset:';\r\n  var rightCell = newRow.insertCell(-1);\r\n  rightCell.align = 'right';\r\n  rightCell.innerHTML = formatTime();\r\n  insertElement(topTable, newRow);\r\n}\r\n\r\nexport default function ladder() {\r\n  dontPost();\r\n  lastReset();\r\n}\r\n","import {imageServer} from '../system/system';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {moveOptions} from './assets';\r\nimport retryAjax from '../ajax/retryAjax';\r\n\r\nvar oldMoves = [];\r\nvar nodes;\r\nvar selectRow;\r\n\r\nfunction doPickMove(moveId, slotId) {\r\n  return retryAjax({\r\n    url: 'index.php',\r\n    data: {\r\n      no_mobile: 1,\r\n      cmd: 'arena',\r\n      subcmd: 'dopickmove',\r\n      move_id: moveId,\r\n      slot_id: slotId\r\n    }\r\n  });\r\n}\r\n\r\nfunction updateMoves() { // jQuery\r\n  var newMoves = [];\r\n  $('select', selectRow).each(function(i, e) {\r\n    newMoves.push($(e).val());\r\n  });\r\n  var prm = [];\r\n  newMoves.forEach(function(val, ind) {\r\n    if (val === oldMoves[ind]) {return;}\r\n    prm.push(doPickMove('x', ind));\r\n    nodes.eq(ind).attr({\r\n      src: imageServer + '/world/actionLoadingSpinner.gif',\r\n      width: '25',\r\n      height: '25'\r\n    });\r\n  });\r\n  $.when.apply($, prm).done(function() {\r\n    newMoves.forEach(function(val, ind) {\r\n      if (val === 'x' || val === oldMoves[ind]) {return;}\r\n      prm.push(doPickMove(val, ind));\r\n    });\r\n    $.when.apply($, prm).done(function() {\r\n      window.location = 'index.php?cmd=arena&subcmd=setup';\r\n    });\r\n  });\r\n}\r\n\r\nfunction selectMoves(evt) { // jQuery\r\n  $(evt.target).off();\r\n\r\n  nodes =\r\n    $('#pCC a[href^=\"index.php?cmd=arena&subcmd=pickmove&slot_id=\"] img');\r\n  var table = nodes.eq(0).closest('table').parent().closest('table');\r\n\r\n  var row = $('<tr/>');\r\n  selectRow = row;\r\n  row.append('<td/>');\r\n  nodes.each(function(i, e) {\r\n    var move = $(e).attr('src');\r\n    if (move.indexOf('bar_icon_holder.jpg') > 0) {\r\n      move = 'x';\r\n    } else {\r\n      move = move.match(/pvp\\/(\\d+).gif$/)[1];\r\n    }\r\n    var html = $(moveOptions);\r\n    $('option[value=' + move + ']', html).prop('selected', true);\r\n    row.append(html);\r\n  });\r\n  table.append(row);\r\n\r\n  $('img[src$=\"pvp/bar_spacer.jpg\"]', table)\r\n    .attr({width: '15', height: '50'});\r\n\r\n  row = $('<tr><td colspan=32 align=center ' +\r\n    'style=\"padding-top: 2px;padding-bottom: 2px;\">' +\r\n    '<input class=\"custombutton\" value=\"Update\" type=\"button\">' +\r\n    '</td></tr>');\r\n  $('input', row).click(updateMoves);\r\n  table.append(row);\r\n}\r\n\r\nexport default function setupMoves() { // jQuery\r\n  if (jQueryNotPresent()) {return;}\r\n  var node = $('#pCC b:contains(\"Setup Combat Moves\")');\r\n  if (node.length !== 1) {return;}\r\n  node.addClass('fshLink fshGreen');\r\n  node.click(selectMoves);\r\n}\r\n","import {createSpan} from './common/cElement';\r\nimport {getElementById} from './common/getElement';\r\nimport insertElement from './common/insertElement';\r\nimport insertTextBeforeEnd from './common/insertTextBeforeEnd';\r\nimport intValue from './system/intValue';\r\nimport isNaN from './common/isNaN';\r\nimport {server} from './system/system';\r\nimport setValue from './system/setValue';\r\n\r\nvar upgrades;\r\nvar currentFSP;\r\nvar warehouse = {};\r\n\r\nfunction findText(text) {\r\n  return Array.prototype.find.call(upgrades, function(el) {\r\n    return el.textContent.indexOf(text) !== -1;\r\n  });\r\n}\r\n\r\nfunction getInputCell(label) {\r\n  return findText(label).nextElementSibling.nextElementSibling\r\n    .nextElementSibling;\r\n}\r\n\r\nfunction getInputElement(el) {\r\n  return el.nextElementSibling.nextElementSibling\r\n    .nextElementSibling.children[0].rows[0].cells[0].children[0];\r\n}\r\n\r\nfunction getRe(type, label) {\r\n  if (label === 'amount') {\r\n    return new RegExp('\\\\+(\\\\d+) ' + type);\r\n  }\r\n  return /(\\d+)\\xA0/;\r\n}\r\n\r\nfunction getValue(type, element, label) {\r\n  if (!warehouse[type][label]) {\r\n    var valRe = getRe(type, label);\r\n    var value = element.textContent.match(valRe)[1];\r\n    warehouse[type][label] = value;\r\n  }\r\n  return warehouse[type][label];\r\n}\r\n\r\nfunction getAmount(type, upgrade) {\r\n  return getValue(type, upgrade, 'amount');\r\n}\r\n\r\nfunction getCost(type, upgrade) {\r\n  return getValue(type, upgrade.nextElementSibling, 'cost');\r\n}\r\n\r\nfunction getCell(type, upgrade) {\r\n  if (!warehouse[type]) {warehouse[type] = {};}\r\n  if (!warehouse[type].span) {\r\n    var span = createSpan();\r\n    insertTextBeforeEnd(upgrade, ' ');\r\n    insertElement(upgrade, span);\r\n    warehouse[type].span = span;\r\n  }\r\n  return warehouse[type].span;\r\n}\r\n\r\nfunction doStamCount(type, upgrade, quantity, cell) {\r\n  var amount = getAmount(type, upgrade);\r\n  var cost = getCost(type, upgrade);\r\n  // cap the value if the user goes over his current FSP\r\n  var extraStam;\r\n  if (quantity * cost <= currentFSP) {\r\n    extraStam = quantity * amount;\r\n    cell.className = 'fshBlue';\r\n  } else {\r\n    extraStam = Math.floor(currentFSP / cost) * amount;\r\n    cell.className = 'fshRed';\r\n  }\r\n  cell.textContent = '(+' + extraStam + ' stamina)';\r\n}\r\n\r\nfunction updateStamCount(type, upgrade, evt) {\r\n  var self = evt.target;\r\n  var quantity = Number(self.value);\r\n  var cell = getCell(type, upgrade);\r\n  if (isNaN(quantity) || quantity === 0) {\r\n    cell.className = 'fshHide';\r\n    return;\r\n  }\r\n  doStamCount(type, upgrade, quantity, cell);\r\n}\r\n\r\nfunction injectUpgradeHelper(type) {\r\n  var upgrade = findText(type);\r\n  getInputElement(upgrade).addEventListener('keyup',\r\n    updateStamCount.bind(null, type, upgrade));\r\n}\r\n\r\nfunction injectPoints() {\r\n  currentFSP = intValue(getElementById('statbar-fsp').textContent);\r\n  injectUpgradeHelper('Current');\r\n  injectUpgradeHelper('Maximum');\r\n  getInputCell('Gold').innerHTML = '<a href=\"' + server +\r\n    'index.php?cmd=marketplace\">Sell at Marketplace</a>';\r\n}\r\n\r\nfunction saveUpgradeValue(upgrade, key) {\r\n  var text = findText(upgrade);\r\n  var ratio = text.nextElementSibling.nextElementSibling;\r\n  if (ratio) {\r\n    var valueRE = /(\\d+) \\/ 115/;\r\n    var value = Number(valueRE.exec(ratio.innerHTML)[1]);\r\n    setValue(key, value + 5);\r\n  }\r\n}\r\n\r\nexport default function storePlayerUpgrades() {\r\n  upgrades = document.querySelectorAll('#pCC > table:last-of-type > tbody > ' +\r\n    'tr:nth-child(even) > td:first-child');\r\n  saveUpgradeValue('+1 Max Allies', 'alliestotal');\r\n  saveUpgradeValue('+1 Max Enemies', 'enemiestotal');\r\n  injectPoints();\r\n}\r\n","import getForage from '../ajax/getForage';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport setForage from '../ajax/setForage';\r\n\r\nfunction gotMoves(_arena) { // jQuery\r\n  var arena = _arena || {};\r\n  arena.moves = {};\r\n  var arenaMoves = $('#pCC img[vspace=\"4\"]').slice(1);\r\n  arenaMoves.each(function(i, e) {\r\n    var self = $(e);\r\n    var src = self.attr('src');\r\n    var moveId = /(\\d+)\\.gif/.exec(src)[1];\r\n    arena.moves[moveId] = {};\r\n    arena.moves[moveId].count = Number(/(\\d)$/\r\n      .exec(self.closest('td').html())[1]);\r\n    arena.moves[moveId].href = src;\r\n  });\r\n  setForage('fsh_arena', arena);\r\n}\r\n\r\nexport default function storeMoves() { // jQuery.min\r\n  if (jQueryNotPresent()) {return;}\r\n  getForage('fsh_arena').done(gotMoves);\r\n}\r\n","import calf from '../support/calf';\r\nimport formatUtcDateTime from '../common/formatUtcDateTime';\r\nimport insertElement from '../common/insertElement';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {pCC} from '../support/layout';\r\nimport setValue from '../system/setValue';\r\nimport {simpleCheckboxHtml} from '../settings/simpleCheckbox';\r\nimport {createTBody, createTable} from '../common/cElement';\r\nimport {\r\n  disableBackgroundChecks,\r\n  doBackgroundCheck,\r\n  getFshSeLog,\r\n  oldLog\r\n} from './seLog';\r\n\r\nvar enableSeTracker = 'enableSeTracker';\r\nvar trackerCell;\r\n\r\nfunction addRow(trackerTable, se) {\r\n  insertHtmlBeforeEnd(trackerTable,\r\n    '<tr><td class=\"fshCenter\">' + se[0] + '</td>' +\r\n    '<td class=\"fshBold fshCenter fshCooldown\">' +\r\n    formatUtcDateTime(new Date(se[1] * 1000)) + '</td></tr>');\r\n}\r\n\r\nfunction buildTrackerTable(seAry) {\r\n  var trackerTable = createTable({className: 'fshTTracker'});\r\n  var tBody = createTBody({\r\n    innerHTML: '<tr><td class=\"header fshCenter\">Creature</td>' +\r\n      '<td class=\"header fshCenter\">Last Kill</td></tr>'\r\n  });\r\n  insertElement(trackerTable, tBody);\r\n  seAry.forEach(addRow.bind(null, tBody));\r\n  return trackerTable;\r\n}\r\n\r\nfunction insertNewRow() {\r\n  var newRow = pCC.lastElementChild.insertRow(-1);\r\n  var newCell = newRow.insertCell(-1);\r\n  newCell.colSpan = 3;\r\n  return newCell;\r\n}\r\n\r\nfunction displayTracker(seAry) {\r\n  var trackerTable = buildTrackerTable(seAry);\r\n  trackerCell = insertNewRow();\r\n  insertElement(trackerCell, trackerTable);\r\n}\r\n\r\nfunction gotSeLog() {\r\n  if (oldLog && oldLog.se) {\r\n    var seAry = Object.keys(oldLog.se).map(function(key) {\r\n      return [key, oldLog.se[key]];\r\n    }).sort(function(a, b) {\r\n      return a[1] - b[1];\r\n    });\r\n    displayTracker(seAry);\r\n  }\r\n}\r\n\r\nfunction killTable() {\r\n  if (!calf.enableSeTracker) {\r\n    if (trackerCell) {\r\n      trackerCell.parentNode.remove();\r\n      trackerCell = false;\r\n    }\r\n    disableBackgroundChecks();\r\n  } else {\r\n    doBackgroundCheck().always(gotSeLog);\r\n  }\r\n}\r\n\r\nfunction togglePref(evt) {\r\n  if (evt.target.id === enableSeTracker) {\r\n    calf.enableSeTracker = !calf.enableSeTracker;\r\n    setValue(enableSeTracker, calf.enableSeTracker);\r\n    killTable();\r\n  }\r\n}\r\n\r\nfunction waitForLog() {\r\n  doBackgroundCheck().always(gotSeLog);\r\n}\r\n\r\nexport default function superelite() {\r\n  if (jQueryNotPresent()) {return;}\r\n  var newCell = insertNewRow();\r\n  newCell.height = 20;\r\n  newCell = insertNewRow();\r\n  newCell.className = 'fshCenter';\r\n  newCell.innerHTML = simpleCheckboxHtml(enableSeTracker);\r\n  newCell.addEventListener('change', togglePref);\r\n  if (calf.enableSeTracker) {\r\n    getFshSeLog().done(waitForLog);\r\n  }\r\n}\r\n","import getUrlParameter from './system/getUrlParameter';\r\nimport getValue from './system/getValue';\r\nimport {guideUrl} from './support/constants';\r\nimport {imageServer} from './system/system';\r\nimport insertHtmlBeforeEnd from './common/insertHtmlBeforeEnd';\r\nimport {pCC} from './support/layout';\r\nimport setValue from './system/setValue';\r\n\r\nvar normalLink;\r\nvar seasonLink;\r\nvar activeLink;\r\nvar completeLink;\r\nvar notStartedLink;\r\nvar currentPageValue;\r\n\r\nfunction dontPost(e) {\r\n  if (e.target.type !== 'submit') {return;}\r\n  e.preventDefault();\r\n  var form = e.target.form;\r\n  var mode = form[1].value;\r\n  var type = form[2].value;\r\n  var letter = form[3].value;\r\n  var sortby = form[4].value;\r\n  var sortbydir = form[5].value;\r\n  var page = form[6].value;\r\n  window.location = 'index.php?cmd=questbook&type=' + type + '&mode=' + mode +\r\n    '&page=' + page + '&letter=' + letter + '&sortby=' + sortby +\r\n    '&sortbydir=' + sortbydir;\r\n}\r\n\r\nvar currentLocationValue = [\r\n  {value: 0},\r\n  {value: 3},\r\n  {value: 0},\r\n  {value: 1},\r\n  {value: 2}\r\n];\r\n\r\nvar savePrefKey = [\r\n  'lastNormalActiveQuestPage',\r\n  'lastNormalCompletedQuestPage',\r\n  'lastNormalNotStartedQuestPage',\r\n  'lastSeasonalActiveQuestPage',\r\n  'lastSeasonalCompletedQuestPage',\r\n  'lastSeasonalNotStartedQuestPage'\r\n];\r\n\r\nfunction whereAmI() {\r\n  var aLinks = pCC.getElementsByTagName('a');\r\n  normalLink = aLinks[0];\r\n  seasonLink = aLinks[1];\r\n  activeLink = aLinks[2];\r\n  completeLink = aLinks[3];\r\n  notStartedLink = aLinks[4];\r\n  currentPageValue = currentLocationValue.reduce(function(prev, curr, i) {\r\n    var ret = prev;\r\n    if (aLinks[i].firstElementChild.getAttribute('color') === '#FF0000') {\r\n      ret += curr.value;\r\n    }\r\n    return ret;\r\n  }, 0);\r\n}\r\n\r\nfunction storeLoc() {\r\n  var lastQBPage = location.search;\r\n  setValue('lastActiveQuestPage', lastQBPage);\r\n  setValue(savePrefKey[currentPageValue], lastQBPage);\r\n}\r\n\r\nfunction setLink(aLink, url) {\r\n  if (url.length > 0) {\r\n    aLink.setAttribute('href', url);\r\n  }\r\n}\r\n\r\nfunction updateLinks() {\r\n  var lastNormalActiveQuestPage = getValue(savePrefKey[0]);\r\n  var lastNormalCompletedQuestPage = getValue(savePrefKey[1]);\r\n  var lastNormalNotStartedQuestPage = getValue(savePrefKey[2]);\r\n  var lastSeasonalActiveQuestPage = getValue(savePrefKey[3]);\r\n  var lastSeasonalCompletedQuestPage = getValue(savePrefKey[4]);\r\n  var lastSeasonalNotStartedQuestPage = getValue(savePrefKey[5]);\r\n\r\n  var oppositeTypeUrl = [\r\n    lastSeasonalActiveQuestPage,\r\n    lastSeasonalCompletedQuestPage,\r\n    lastSeasonalNotStartedQuestPage,\r\n    lastNormalActiveQuestPage,\r\n    lastNormalCompletedQuestPage,\r\n    lastNormalNotStartedQuestPage\r\n  ];\r\n\r\n  if (currentPageValue < 3) {\r\n    setLink(seasonLink, oppositeTypeUrl[currentPageValue]);\r\n    setLink(activeLink, lastNormalActiveQuestPage);\r\n    setLink(completeLink, lastNormalCompletedQuestPage);\r\n    setLink(notStartedLink, lastNormalNotStartedQuestPage);\r\n  } else {\r\n    setLink(normalLink, oppositeTypeUrl[currentPageValue]);\r\n    setLink(activeLink, lastSeasonalActiveQuestPage);\r\n    setLink(completeLink, lastSeasonalCompletedQuestPage);\r\n    setLink(notStartedLink, lastSeasonalNotStartedQuestPage);\r\n  }\r\n}\r\n\r\nfunction storeQuestPage() {\r\n  if (getValue('storeLastQuestPage')) {\r\n    whereAmI();\r\n    storeLoc();\r\n    updateLinks();\r\n  }\r\n}\r\n\r\nfunction guideButtons(questID, questName) {\r\n  return '<div class=\"parent\">' +\r\n    '<a href=\"' + guideUrl + 'quests&' +\r\n    'subcmd=view&quest_id=' + questID + '\" class=\"tip-static\" ' +\r\n    'data-tipped=\"Search for this quest on the Ultimate Fallen Sword Guide\" ' +\r\n    'style=\"background-image: url(\\'' + imageServer +\r\n    '/temple/1.gif\\');\" target=\"_blank\"></a>&nbsp;' +\r\n    '<a href=\"https://wiki.fallensword.com/index.php?title=' +\r\n    questName.replace(/ /g, '_') + '\" class=\"tip-static\" ' +\r\n    'data-tipped=\"Search for this quest on the Wiki\" ' +\r\n    'style=\"background-image: url(\\'' + imageServer +\r\n    '/skin/fs_wiki.gif\\');\" target=\"_blank\"></a></div>';\r\n}\r\n\r\nfunction isHideQuests() {\r\n  if (getValue('hideQuests')) {\r\n    return getValue('hideQuestNames').split(',');\r\n  }\r\n  return [];\r\n}\r\n\r\nfunction doHideQuests(hideQuests, questName, aRow) {\r\n  if (hideQuests.indexOf(questName) >= 0) {\r\n    aRow.classList.add('fshHide');\r\n    aRow.nextElementSibling.classList.add('fshHide');\r\n    aRow.nextElementSibling.nextElementSibling.classList.add('fshHide');\r\n    aRow.nextElementSibling.nextElementSibling.nextElementSibling\r\n      .classList.add('fshHide');\r\n  }\r\n}\r\n\r\nexport function injectQuestBookFull() {\r\n  pCC.addEventListener('click', dontPost);\r\n  storeQuestPage();\r\n  var questTable = pCC.getElementsByTagName('table')[5];\r\n  if (!questTable) {return;}\r\n  var hideQuests = isHideQuests();\r\n  for (var i = 2; i < questTable.rows.length; i += 4) {\r\n    var aRow = questTable.rows[i];\r\n    var questName = aRow.cells[0].textContent.replace(/ {2}/g, ' ').trim();\r\n    doHideQuests(hideQuests, questName, aRow);\r\n    var questID = /quest_id=(\\d+)/.exec(aRow.cells[4].innerHTML)[1];\r\n    aRow.cells[4].innerHTML = guideButtons(questID, questName);\r\n  }\r\n}\r\n\r\nexport function injectQuestTracker() {\r\n  var lastActiveQuestPage = getValue('lastActiveQuestPage');\r\n  if (lastActiveQuestPage.length > 0) {\r\n    pCC.getElementsByTagName('a')[0]\r\n      .setAttribute('href', lastActiveQuestPage);\r\n  }\r\n  var questID = getUrlParameter('quest_id');\r\n  var injectHere = pCC.getElementsByTagName('td')[0];\r\n  var questName = injectHere.getElementsByTagName('font')[1].textContent\r\n    .replace(/\"/g, '');\r\n  insertHtmlBeforeEnd(injectHere, guideButtons(questID, questName));\r\n}\r\n","import padZ from '../system/padZ';\r\n\r\nexport default function formatUtcDateTime(aDate) {\r\n  if (Object.prototype.toString.call(aDate) === '[object Date]' &&\r\n      !isNaN(aDate.getTime())) {\r\n    var yyyy = aDate.getUTCFullYear().toString();\r\n    var mon = padZ(aDate.getUTCMonth() + 1);\r\n    var dd = padZ(aDate.getUTCDate());\r\n    var hh = padZ(aDate.getUTCHours());\r\n    var mm = padZ(aDate.getUTCMinutes());\r\n    var ss = padZ(aDate.getUTCSeconds());\r\n    return yyyy + '-' + mon + '-' + dd + ' ' + hh + ':' + mm + ':' + ss;\r\n  }\r\n}\r\n","import buffList from '../support/buffObj';\r\nimport formatLocalDateTime from '../common/formatLocalDateTime';\r\nimport {getElementById} from '../common/getElement';\r\nimport getForage from '../ajax/getForage';\r\nimport getValue from '../system/getValue';\r\nimport setForage from '../ajax/setForage';\r\n\r\nfunction rejected(timeStamp, buffsNotCast, buffLog) {\r\n  if (buffsNotCast) {\r\n    return timeStamp + ' <span style=\"color: red;\">' +\r\n      buffsNotCast[0] + '</span><br>' + buffLog;\r\n  }\r\n  return buffLog;\r\n}\r\n\r\nfunction getStamUsed(buffCast) {\r\n  for (var j = 0; j < buffList.length; j += 1) {\r\n    if (buffList[j].name === buffCast[1]) {\r\n      return buffList[j].stam.toString();\r\n    }\r\n  }\r\n  return '-';\r\n}\r\n\r\nfunction successfull(timeStamp, buffCast, buffLog) {\r\n  if (buffCast) {\r\n    return timeStamp + ' ' + buffCast[0] + ' (' + getStamUsed(buffCast) +\r\n      ' stamina) <br>' + buffLog;\r\n  }\r\n  return buffLog;\r\n}\r\n\r\nfunction buffResult(_buffLog) {\r\n  var buffLog = _buffLog;\r\n  if (!buffLog) {buffLog = '';}\r\n  var timeStamp = formatLocalDateTime(new Date());\r\n  var buffsAttempted = getElementById('quickbuff-report')\r\n    .innerHTML.split('<p>');\r\n  var buffsNotCastRE = new RegExp('The skill ([\\\\w ]*) of current or' +\r\n    ' higher level is currently active on \\'(\\\\w*)\\'');\r\n  var buffsCastRE = new RegExp('Skill ([\\\\w ]*) level (\\\\d*) was ' +\r\n    'activated on \\'(\\\\w*)\\'');\r\n  for (var i = 0; i < buffsAttempted.length; i += 1) {\r\n    var buffCast = buffsCastRE.exec(buffsAttempted[i]);\r\n    var buffNotCast = buffsNotCastRE.exec(buffsAttempted[i]);\r\n    buffLog = successfull(timeStamp, buffCast, buffLog);\r\n    buffLog = rejected(timeStamp, buffNotCast, buffLog);\r\n  }\r\n  setForage('fsh_buffLog', buffLog);\r\n}\r\n\r\nexport default function updateBuffLog() {\r\n  if (!getValue('keepBuffLog')) {return;}\r\n  getForage('fsh_buffLog').done(buffResult);\r\n}\r\n","import findNode from '../system/findNode';\r\nimport {getElementById} from '../common/getElement';\r\nimport injectAdvisor from '../guildAdvisor';\r\nimport {injectQuestBookFull} from '../questBook';\r\nimport inventing from '../recipes';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {screenview} from '../support/fshGa';\r\nimport updateBuffLog from '../buffLog/updateBuffLog';\r\n\r\nvar unknown = [\r\n  {\r\n    condition: function() {\r\n      return getElementById('quickbuff-report');\r\n    },\r\n    result: function() {\r\n      screenview('unknown.buffLog.updateBuffLog');\r\n      updateBuffLog();\r\n    }\r\n  },\r\n  {\r\n    condition: function() {\r\n      return findNode('//td[.=\"Quest Name\"]');\r\n    },\r\n    result: function() {\r\n      screenview('unknown.questBook.injectQuestBookFull');\r\n      injectQuestBookFull();\r\n    }\r\n  },\r\n  {\r\n    condition: function() {\r\n      return findNode('//font[@size=2 and .=\"Advisor\"]') &&\r\n        findNode('//a[@href=\"index.php?cmd=guild&amp;subcmd=manage\" ' +\r\n          'and .=\"Back to Guild Management\"]');\r\n    },\r\n    result: function() {\r\n      screenview('unknown.guildAdvisor.injectAdvisor');\r\n      injectAdvisor();\r\n    }\r\n  },\r\n  // {\r\n  //   condition: function() {\r\n  //     return findNode('//a[.=\"Back to Scavenging\"]');\r\n  //   },\r\n  //   result: function() {\r\n  //     screenview('unknown.scavenging.injectScavenging');\r\n  //     FSH.scavenging.injectScavenging(); // Is this used???\r\n  //   }\r\n  // },\r\n  {\r\n    condition: function() {\r\n      return $('#pCC img[title=\"Inventing\"]').length > 0;\r\n    },\r\n    result: function() {\r\n      screenview('unknown.recipes.inventing');\r\n      inventing();\r\n    }\r\n  //#if _DEV  //  Fell through!\r\n  },\r\n  {\r\n    condition: function() {return true;},\r\n    result: function() {console.log('Fell through!');} // eslint-disable-line no-console\r\n  //#endif\r\n  }\r\n];\r\n\r\nexport default function unknownPage() { // Legacy\r\n  if (jQueryNotPresent()) {return;}\r\n  //#if _DEV  //  unknownPage\r\n  console.log('unknownPage'); // eslint-disable-line no-console\r\n  //#endif\r\n  unknown.some(function(el) {\r\n    if (el.condition()) {\r\n      el.result();\r\n      return true;\r\n    }\r\n    return false;\r\n  });\r\n}\r\n","import collapse from '../common/collapse';\r\nimport getValue from '../system/getValue';\r\nimport insertHtmlAfterEnd from '../common/insertHtmlAfterEnd';\r\nimport {pCC} from '../support/layout';\r\nimport parseDateAsTimestamp from '../system/parseDateAsTimestamp';\r\nimport setValue from '../system/setValue';\r\nimport {simpleCheckbox} from '../settings/simpleCheckbox';\r\n\r\nvar ladderResetPref = 'lastLadderReset';\r\nvar lastLadderReset;\r\n\r\nfunction checkForPvPLadder(row) {\r\n  if (row.children[1].children[0].textContent === 'PvP Ladder') {\r\n    var logTime = parseDateAsTimestamp(\r\n      row.children[1].children[2].textContent.replace('Posted: ', ''));\r\n    if (logTime > lastLadderReset) {\r\n      setValue(ladderResetPref, logTime);\r\n      lastLadderReset = logTime;\r\n    }\r\n  }\r\n}\r\n\r\nfunction testArticle(rowType) {return rowType > 1;}\r\n\r\nfunction setupPref(prefName, rowInjector) {\r\n  insertHtmlAfterEnd(rowInjector, simpleCheckbox(prefName));\r\n}\r\n\r\nexport default function viewArchive() {\r\n  lastLadderReset = getValue(ladderResetPref);\r\n  var prefName = 'collapseNewsArchive';\r\n  var theTables = pCC.getElementsByTagName('table');\r\n  if (theTables.length > 2) {\r\n    setupPref(prefName, theTables[0].rows[2]);\r\n    collapse({\r\n      prefName: prefName,\r\n      theTable: theTables[2],\r\n      headInd: 6,\r\n      articleTest: testArticle,\r\n      extraFn: checkForPvPLadder\r\n    });\r\n  }\r\n}\r\n","import getValue from '../system/getValue';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {pCC} from '../support/layout';\r\n\r\nfunction hasTextEntry() { // jQuery\r\n  $('#pCC form').first().attr('id', 'dochat');\r\n  $('#pCC input').slice(0, 7).each(function(i, e) {\r\n    $(e).attr('form', 'dochat');\r\n  });\r\n  var theTable = $('#pCC table table').first();\r\n  theTable.append('<tr id=\"fshMass\"></tr>');\r\n  $('td', theTable).eq(0).remove();\r\n  var btnMass = $('input[value=\"Send As Mass\"]', theTable);\r\n  if (btnMass.length === 1) {\r\n    btnMass.appendTo('#fshMass', theTable);\r\n  }\r\n  var ourTd = $('td', theTable).eq(0);\r\n  ourTd.attr('rowspan', '2');\r\n  $('input', ourTd).replaceWith('<textarea id=\"fshTxt\" name=\"msg\" cols' +\r\n    '=\"72\" rows=\"2\" form=\"dochat\" style=\"resize: none\"></textarea>');\r\n  var fshTxt = $('#fshTxt', ourTd);\r\n  fshTxt.keydown(function(e) {\r\n    if (e.keyCode === 13 && fshTxt.val() !== '') {\r\n      $('input[value=Send]', theTable).click();\r\n      return false;\r\n    }\r\n  });\r\n}\r\n\r\nvar tests = [\r\n  function() {return !getValue('enhanceChatTextEntry');},\r\n  function() {return !pCC;},\r\n  function() {return jQueryNotPresent();}\r\n];\r\n\r\nexport default function addChatTextArea() {\r\n  if (tests.some(function(el) {return el();})) {return;}\r\n  hasTextEntry();\r\n}\r\n","import calf from '../support/calf';\r\nimport quickBuffHref from '../common/quickBuffHref';\r\n\r\nfunction removeHTML(buffName) {\r\n  return buffName.replace(/<\\/?[^>]+(>|$)/g, '');\r\n}\r\n\r\nfunction reportIgnore(aRow, isGuildMate, playerName) { // Legacy\r\n  var extraPart = '';\r\n  var dateHTML = aRow.cells[1].innerHTML;\r\n  var dateFirstPart = dateHTML\r\n    .substring(0, dateHTML.indexOf('>Report') + 7);\r\n  var dateLastPart = dateHTML\r\n    .substring(dateHTML.indexOf('Message</a>') + 11, dateHTML.length);\r\n  if (!isGuildMate) {\r\n    extraPart = ' | <a title=\"Add to Ignore List\" href=\"index.php?cmd' +\r\n      '=log&subcmd=doaddignore&ignore_username=' + playerName +\r\n      '\">Ignore</a>';\r\n  }\r\n  aRow.cells[1].innerHTML = dateFirstPart + '</a>' + extraPart +\r\n    dateLastPart;\r\n}\r\n\r\nfunction doBuffLink(_buffsSent, targetPlayerID) { // Legacy\r\n  var quickBuff = '';\r\n  var buffsSent = _buffsSent[0].replace('`~', '').replace('~`', '')\r\n    .split(/\\s*,\\s*/);\r\n  buffsSent.reduce(function(prev, el) {\r\n    var ret = prev;\r\n    var nick = el.toLowerCase();\r\n    if (calf.nickList[nick]) {\r\n      ret += calf.nickList[nick].toString() + ';';\r\n    }\r\n    return ret;\r\n  }, '');\r\n  return ' | <a ' + quickBuffHref(targetPlayerID, quickBuff) +\r\n      '>Buff</a></span>';\r\n}\r\n\r\nfunction getAttackPart(playerName) { // Legacy\r\n  if (calf.addAttackLinkToLog) {\r\n    return ' | <a href=\"index.php?cmd=attackplayer&target_username=' +\r\n      playerName + '\">Attack</a>';\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction getThirdPart(messageHTML) { // Legacy\r\n  var thirdPart = messageHTML.substring(messageHTML.indexOf('>Reply</a>') + 10,\r\n    messageHTML.indexOf('>Buff</a>') + 9);\r\n  var targetPlayerRE = /quickBuff\\((\\d+)\\)/.exec(thirdPart);\r\n  if (targetPlayerRE) {\r\n    var targetPlayerID = targetPlayerRE[1];\r\n    var buffsSent = messageHTML.match(/`~.*?~`/);\r\n    if (buffsSent) {\r\n      return doBuffLink(buffsSent, targetPlayerID);\r\n    }\r\n    return ' | <a ' + quickBuffHref(targetPlayerID) + '>Buff</a></span>';\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction isChat(aRow, isGuildMate, playerName) { // Legacy\r\n  reportIgnore(aRow, isGuildMate, playerName);\r\n  var messageHTML = aRow.cells[2].innerHTML;\r\n  var firstPart = messageHTML.substring(0, messageHTML.indexOf('<small>') + 7);\r\n  var thirdPart = getThirdPart(messageHTML);\r\n  var fourthPart = messageHTML.substring(messageHTML\r\n    .indexOf('>Trade</a>') + 10, messageHTML.indexOf('</small>'));\r\n  var lastPart = messageHTML.substring(messageHTML.indexOf('</small>'),\r\n    messageHTML.length);\r\n  var extraPart = ' | <a href=\"index.php?cmd=trade&target_player=' +\r\n    playerName + '\">Trade</a> | <a title=\"Secure Trade\" ' +\r\n    'href=\"index.php?cmd=trade&subcmd=createsecure&target_username=' +\r\n    playerName + '\">ST</a>';\r\n  var attackPart = getAttackPart(playerName);\r\n  var replyTo = '';\r\n  if (calf.enableChatParsing) {\r\n    replyTo = removeHTML(firstPart.replace(/&nbsp;/g, ' ')).substr(0, 140);\r\n  }\r\n  var msgReplyTo = '[ <span style=\"cursor:pointer;text-' +\r\n    'decoration:underline\"class=\"a-reply\" target_player=\"' + playerName +\r\n    '\" replyTo=\"' + replyTo + '...\">Reply</span>';\r\n  aRow.cells[2].innerHTML = firstPart + '<nobr>' + msgReplyTo +\r\n    extraPart + thirdPart + attackPart + fourthPart +\r\n    '</nobr>' + lastPart;\r\n}\r\n\r\nexport default function doChat(messageType, aRow, isGuildMate, playerName) { // Legacy\r\n  if (messageType === 'Chat') {isChat(aRow, isGuildMate, playerName);}\r\n}\r\n","import calf from '../support/calf';\r\nimport parseDateAsTimestamp from '../system/parseDateAsTimestamp';\r\nimport setValue from '../system/setValue';\r\n\r\nfunction isLadderReset(aRow) {\r\n  return aRow.cells[2].firstElementChild &&\r\n    aRow.cells[2].firstElementChild.tagName === 'IMG' &&\r\n    aRow.cells[2].firstElementChild.src.indexOf('pvp_icon.gif') !== -1;\r\n}\r\n\r\nfunction saveLastResetTime(aRow) {\r\n  var logTime = parseDateAsTimestamp(aRow.cells[1].textContent);\r\n  if (logTime > calf.lastLadderReset) {\r\n    setValue('lastLadderReset', logTime);\r\n    calf.lastLadderReset = logTime;\r\n  }\r\n}\r\n\r\nexport default function processLadder(aRow, messageType) {\r\n  if (messageType === 'Notification' && isLadderReset(aRow)) {\r\n    saveLastResetTime(aRow);\r\n  }\r\n}\r\n","/* eslint-disable max-len */\r\nexport var specials = {\r\n  '0': 'Dull Edge was activated.',\r\n  '1': '@0 was afflicted by Super Elite Slayer.',\r\n  '2': '@0 was withered.',\r\n  '3': '@0\\'s armor was shattered.',\r\n  '4': '@0 was infused with extra defense (Constitution).',\r\n  '5': '@0 was infused with extra armor (Sanctuary).',\r\n  '7': '@0 activated Spectral Knight reducing targets armor to zero.',\r\n  '8': '@0 activated Savagery.',\r\n  '9': '@0 activated Shield Strike.',\r\n  '13': '@0 activated Conserve.',\r\n  '18': '@0 leeched the buff \\'@1\\'.',\r\n  '17': '@0 activated Four Leaf.',\r\n  '19': '@0\\'s demoralize skill reduced the effectiveness of @1\\'s enhancements.',\r\n  '20': '@0\\'s reckoning has improved their skill \\'@1\\'',\r\n  '21': '@0 was mesmerized by Spell Breaker, losing the \\'@1\\' buff.',\r\n  '22': '@0 was turned Undead by Necrosis.',\r\n  '23': '@0 activated High Guard.',\r\n  '24': '@0 was smote.',\r\n  '25': '@0 activated Barricade.',\r\n  '26': '@0 activated Ageless.',\r\n  '27': '@0 activated Severe Condition.',\r\n  '28': '@0 activated Golden Shield.',\r\n  '29': '@0 activated Anti Deflect.',\r\n  '30': '@0 activated Sealed. (Negated @1)',\r\n  '31': '@0 activated Fist Fight.',\r\n  '33': '@0 activated Dispel Curse.',\r\n  '35': '@0 activated Heavy Weight.',\r\n  '37': '@0 had their armor and defence Inverted.',\r\n  '38': '@0 had their attack reduced by Fumble.'\r\n};\r\n","import addCommas from '../system/addCommas';\r\nimport calf from '../support/calf';\r\nimport createDocument from '../system/createDocument';\r\nimport getForage from '../ajax/getForage';\r\nimport insertElement from '../common/insertElement';\r\nimport {nowSecs} from '../support/constants';\r\nimport parseDateAsTimestamp from '../system/parseDateAsTimestamp';\r\nimport retryAjax from '../ajax/retryAjax';\r\nimport {sendEvent} from '../support/fshGa';\r\nimport setForage from '../ajax/setForage';\r\nimport {specials} from '../support/specials';\r\nimport viewCombat from '../app/combat/view';\r\nimport {createDiv, createSpan} from '../common/cElement';\r\n\r\nvar combatCache = {};\r\n\r\nfunction result(stat, desc, color) {\r\n  if (stat !== 0) {\r\n    return desc + ':<span class=\"' + color + '\">' +\r\n      addCommas(stat) + ' </span>';\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction iDefended(json) {\r\n  return json.r.is_defender && json.r.winner === 1;\r\n}\r\n\r\nfunction iAttacked(json) {\r\n  return !json.r.is_defender && json.r.winner === 0;\r\n}\r\n\r\nfunction iWon(json) {\r\n  if (iDefended(json) || iAttacked(json)) {\r\n    return 'fshGreen';\r\n  }\r\n  return 'fshRed';\r\n}\r\n\r\nfunction highlightSpecials(prev, el) {\r\n  if (el.id === 18) {\r\n    return prev + '<br><span class=\"fshRed fshBold\">' + el.params[0] +\r\n      ' leeched the buff \\'' + el.params[1] + '\\'.</span>';\r\n  }\r\n  if (el.id === 21) {\r\n    return prev + '<br><span class=\"fshRed fshBold\">' + el.params[0] +\r\n      ' was mesmerized by Spell Breaker, losing the \\'' + el.params[1] +\r\n      '\\' buff.</span>';\r\n  }\r\n  return prev;\r\n}\r\n\r\nfunction parseCombat(combatSummary, json) {\r\n  if (!json.s) {return;}\r\n  var color = iWon(json);\r\n  combatSummary.innerHTML = result(json.r.xp_gain, 'XP stolen', color) +\r\n    result(json.r.gold_gain, 'Gold lost', color) +\r\n    result(json.r.gold_stolen, 'Gold stolen', color) +\r\n    result(json.r.pvp_prestige_gain, 'Prestige gain', color) +\r\n    result(json.r.pvp_rating_change, 'PvP change', color) +\r\n    json.r.specials.reduce(highlightSpecials, '');\r\n}\r\n\r\nfunction inSpecialsList(el) {\r\n  return el.id in specials;\r\n}\r\n\r\nfunction whatsMissing(json, html) {\r\n  var specialHtml = createDocument(html).querySelectorAll('#specialsDiv');\r\n  json.r.specials.forEach(function(el, i) {\r\n    if (!inSpecialsList(el)) {\r\n      //#if _DEV  //  PvP missing Special\r\n      console.log(JSON.stringify(el) + ' ' + specialHtml[i].textContent); // eslint-disable-line no-console\r\n      //#endif\r\n      sendEvent('Logs', 'Missing PvP Special',\r\n        JSON.stringify(el) + ' ' + specialHtml[i].textContent);\r\n    }\r\n  });\r\n}\r\n\r\nfunction unknownSpecials(json) {\r\n  if (!json.r.specials.every(inSpecialsList)) {\r\n    retryAjax('index.php?cmd=combat&subcmd=view&combat_id=' + json.r.id)\r\n      .done(whatsMissing.bind(null, json));\r\n  }\r\n}\r\n\r\nfunction cacheCombat(aRow, json) {\r\n  if (!json.s) {return;}\r\n  var cellContents = aRow.cells[1].textContent;\r\n  json.logTime = parseDateAsTimestamp(cellContents) / 1000;\r\n  combatCache[json.r.id] = json;\r\n  setForage('fsh_pvpCombat', combatCache);\r\n  unknownSpecials(json);\r\n}\r\n\r\nfunction processCombat(aRow) {\r\n  var combatID = /combat_id=(\\d+)/.exec(aRow.cells[2].innerHTML)[1];\r\n  var combatSummary = createDiv({style: {color: 'gray'}});\r\n  insertElement(aRow.cells[2], combatSummary);\r\n  if (combatCache[combatID] && combatCache[combatID].logTime) {\r\n    parseCombat(combatSummary, combatCache[combatID]);\r\n  } else {\r\n    viewCombat(combatID).done(cacheCombat.bind(null, aRow))\r\n      .done(parseCombat.bind(null, combatSummary));\r\n  }\r\n}\r\n\r\nfunction replaceLeadingText(msgCell, newHtml) {\r\n  var replaceText = createSpan({innerHTML: newHtml});\r\n  msgCell.replaceChild(replaceText, msgCell.firstChild);\r\n}\r\n\r\nfunction parseCombatWinner(msgCell) {\r\n  var victory = /You were victorious over/.test(msgCell.innerHTML);\r\n  if (victory) {\r\n    replaceLeadingText(msgCell,\r\n      'You were <span class=\"fshGreen\">victorious</span> over ');\r\n    return 1;\r\n  }\r\n  var defeat = /You were defeated by/.test(msgCell.innerHTML);\r\n  if (defeat) {\r\n    replaceLeadingText(msgCell,\r\n      'You were <span class=\"fshRed\">defeated</span> by ');\r\n    return 0;\r\n  }\r\n}\r\n\r\nfunction processCombatRow(aRow) {\r\n  var winner = parseCombatWinner(aRow.cells[2]);\r\n  if ([0, 1].includes(winner)) {processCombat(aRow);}\r\n}\r\n\r\nvar combatRowTests = [\r\n  function(aRow, messageType) {return messageType === 'Combat';},\r\n  function() {return calf.showPvPSummaryInLog;},\r\n  function(aRow) {\r\n    return aRow.cells[2] && /combat_id=/.test(aRow.cells[2].innerHTML);\r\n  },\r\n  function(aRow) {\r\n    return !/\\(Guild Conflict\\)/.test(aRow.cells[2].textContent);\r\n  }\r\n];\r\n\r\nfunction isCombatRow(aRow, messageType) {\r\n  return combatRowTests.every(function(e) {return e(aRow, messageType);});\r\n}\r\n\r\nexport function addPvpSummary(aRow, messageType) {\r\n  // add PvP combat log summary\r\n  if (isCombatRow(aRow, messageType)) {processCombatRow(aRow);}\r\n}\r\n\r\nfunction currentCombatRecord(data, combatId, sevenDays) {\r\n  return combatId === 'lastCheck' || data[combatId].logTime &&\r\n    data[combatId].logTime > sevenDays;\r\n}\r\n\r\nfunction cleanCache(data) {\r\n  var sevenDays = nowSecs - 7 * 24 * 60 * 60;\r\n  combatCache = Object.keys(data).reduce(function(prev, combatId) {\r\n    if (currentCombatRecord(data, combatId, sevenDays)) {\r\n      prev[combatId] = data[combatId];\r\n    }\r\n    return prev;\r\n  }, {});\r\n  combatCache.lastCheck = nowSecs;\r\n  setForage('fsh_pvpCombat', combatCache);\r\n}\r\n\r\nfunction prepareCache(data) {\r\n  var oneDay = nowSecs - 24 * 60 * 60;\r\n  if (!data.lastCheck || data.lastCheck < oneDay) {\r\n    cleanCache(data);\r\n  } else {\r\n    combatCache = data;\r\n  }\r\n}\r\n\r\nfunction checkCache(data) {\r\n  if (data) {prepareCache(data);}\r\n}\r\n\r\nexport function initCache() {\r\n  return getForage('fsh_pvpCombat').done(checkCache);\r\n}\r\n","import callApp from '../callApp';\r\n\r\nexport default function viewCombat(id) {\r\n  return callApp({\r\n    cmd: 'combat',\r\n    subcmd: 'view',\r\n    combat_id: id\r\n  });\r\n}\r\n","import buffList from '../support/buffObj';\r\nimport calf from '../support/calf';\r\nimport doChat from './doChat';\r\nimport fallback from '../system/fallback';\r\nimport findNode from '../system/findNode';\r\nimport getMembrList from '../ajax/getMembrList';\r\nimport getValue from '../system/getValue';\r\nimport insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport myStats from '../ajax/myStats';\r\nimport processLadder from './processLadder';\r\nimport quickBuffHref from '../common/quickBuffHref';\r\nimport {addPvpSummary, initCache} from './addPvpSummary';\r\n\r\nvar myPlayer = {};\r\nvar memberNameString;\r\nvar listOfAllies;\r\nvar listOfEnemies;\r\n\r\nfunction buildNickList() {// Native\r\n  calf.nickList = buffList.reduce(function(prev, curr) {\r\n    var ret = prev;\r\n    var nicks = curr.nicks.split(',');\r\n    nicks.forEach(function(el) {\r\n      var nick = el.toLowerCase();\r\n      ret[nick] = curr.id;\r\n    });\r\n    return ret;\r\n  }, {});\r\n}\r\n\r\nfunction isEnemy(playerName, playerElement) { // Legacy\r\n  if (listOfEnemies.indexOf(playerName) !== -1) {\r\n    playerElement.style.color = 'red';\r\n  }\r\n}\r\n\r\nfunction isAlly(playerName, playerElement) { // Legacy\r\n  if (listOfAllies.indexOf(playerName) !== -1) {\r\n    playerElement.style.color = 'blue';\r\n  }\r\n}\r\n\r\nfunction playerColor(colorPlayerName, playerName, playerElement) { // Legacy\r\n  if (!colorPlayerName) {return false;}\r\n  if (memberNameString.indexOf(playerName) !== -1) {\r\n    playerElement.style.color = 'green';\r\n    return true;\r\n  }\r\n  isEnemy(playerName, playerElement);\r\n  isAlly(playerName, playerElement);\r\n  return false;\r\n}\r\n\r\nfunction addExtraStuff(aRow, playerName, isGuildMate) { // Legacy\r\n  if (!isGuildMate) {\r\n    var dateExtraText = '<nobr><span style=\"font-size:x-small;\">' +\r\n      '[ <a title=\"Add to Ignore List\" href=\"index.php?cmd=log' +\r\n      '&subcmd=doaddignore&ignore_username=' + playerName +\r\n      '\">Ignore</a> ]</span></nobr>';\r\n    aRow.cells[1].innerHTML = aRow.cells[1].innerHTML + '<br>' +\r\n      dateExtraText;\r\n  }\r\n  var buffingPlayerIDRE = /player_id=(\\d+)/;\r\n  var buffingPlayerID = buffingPlayerIDRE\r\n    .exec(aRow.cells[2].innerHTML)[1];\r\n  var buffingPlayerName = aRow.cells[2].firstChild.nextSibling\r\n    .innerHTML;\r\n  var extraText = ' <span style=\"font-size:x-small;\"><nobr>' +\r\n    '[ <span style=\"cursor:pointer;text-decoration:underline\" ' +\r\n    'class=\"a-reply\" target_player=\"' + buffingPlayerName +\r\n    '\">Reply</span> | <a href=\"index.php?cmd=trade&target_player=' +\r\n    buffingPlayerName + '\">Trade</a> | <a title=\"Secure Trade\" ' +\r\n    'href=\"index.php?cmd=trade&subcmd=createsecure&target_username=' +\r\n    buffingPlayerName + '\">ST</a>';\r\n  extraText += ' | <a ' + quickBuffHref(buffingPlayerID) +\r\n    '>Buff</a>';\r\n  if (calf.addAttackLinkToLog) {\r\n    extraText += ' | <a href=\"index.php?cmd=attackplayer' +\r\n      '&target_username=' + buffingPlayerName + '\">Attack</a>';\r\n  }\r\n  extraText += ' ]</nobr></span>';\r\n\r\n  aRow.cells[2].innerHTML += extraText;\r\n}\r\n\r\nfunction hasPlayerLink(aRow) {\r\n  return aRow.cells[2].firstChild.nextSibling &&\r\n    aRow.cells[2].firstChild.nextSibling.nodeName === 'A' &&\r\n    /player_id/.test(aRow.cells[2].firstChild.nextSibling.href);\r\n}\r\n\r\nfunction otherMsgType(aRow, messageType) {\r\n  return fallback(messageType === 'General', messageType === 'Notification') &&\r\n    hasPlayerLink(aRow);\r\n}\r\n\r\nfunction doExtraStuff(aRow, messageType, playerName, isGuildMate) {\r\n  if (messageType === 'Notification' &&\r\n      hasPlayerLink(aRow)) {\r\n    addExtraStuff(aRow, playerName, isGuildMate);\r\n  }\r\n}\r\n\r\nfunction doLogWidgetRow(aRow, messageType) { // Legacy\r\n  var playerElement;\r\n  var playerName;\r\n  var colorPlayerName = false;\r\n  if (messageType === 'Chat') {\r\n    playerElement = aRow.cells[2].firstChild;\r\n    playerName = playerElement.innerHTML;\r\n    colorPlayerName = true;\r\n  }\r\n  if (otherMsgType(aRow, messageType)) {\r\n    playerElement = aRow.cells[2].firstChild.nextSibling;\r\n    playerName = playerElement.innerHTML;\r\n    colorPlayerName = true;\r\n  }\r\n  var isGuildMate = playerColor(colorPlayerName, playerName, playerElement);\r\n  doChat(messageType, aRow, isGuildMate, playerName);\r\n  doExtraStuff(aRow, messageType, playerName, isGuildMate);\r\n  addPvpSummary(aRow, messageType);\r\n  processLadder(aRow, messageType);\r\n}\r\n\r\nfunction processLogWidgetRow(aRow) { // Legacy\r\n  // Valid Types: General, Chat, Guild\r\n  var messageType = aRow.cells[0].firstChild.getAttribute('oldtitle');\r\n  if (messageType) {doLogWidgetRow(aRow, messageType);}\r\n}\r\n\r\nfunction foundLogTable(logTable) { // Legacy\r\n  memberNameString = Object.keys(calf.membrList);\r\n  listOfAllies = myPlayer._allies.map(function(obj) {\r\n    return obj.username;\r\n  });\r\n  listOfEnemies = myPlayer._enemies.map(function(obj) {\r\n    return obj.username;\r\n  });\r\n  calf.showPvPSummaryInLog = getValue('showPvPSummaryInLog');\r\n  calf.lastLadderReset = getValue('lastLadderReset');\r\n  calf.enableChatParsing = getValue('enableChatParsing');\r\n  var messageHeader = logTable.rows[0].cells[2];\r\n  if (messageHeader) {\r\n    insertHtmlBeforeEnd(messageHeader, '&nbsp;&nbsp;' +\r\n      '<span class=\"fshWhite\">(Guild mates show up in ' +\r\n      '<span class=\"fshGreen\">green</span>)</span>');\r\n  }\r\n  for (var i = 1; i < logTable.rows.length; i += 2) {\r\n    processLogWidgetRow(logTable.rows[i]);\r\n  }\r\n  $('.a-reply').click(function(evt) {\r\n    window.openQuickMsgDialog(evt.target.getAttribute('target_player'),\r\n      '', evt.target.getAttribute('replyTo'));\r\n  });\r\n}\r\n\r\nfunction addLogWidgetsOld() { // Legacy\r\n  buildNickList();\r\n  calf.addAttackLinkToLog = getValue('addAttackLinkToLog');\r\n  var logTable = findNode('//table[tbody/tr/td/span[contains' +\r\n    '(.,\"Currently showing:\")]]');\r\n  if (logTable) {foundLogTable(logTable);}\r\n}\r\n\r\nexport default function addLogWidgets() { // jQuery.min\r\n  if (jQueryNotPresent()) {return;}\r\n  $.when(\r\n    getMembrList(false),\r\n    myStats(false).done(function(data) {\r\n      myPlayer = data;\r\n    }),\r\n    initCache()\r\n  ).done(addLogWidgetsOld);\r\n}\r\n","import {createSpan} from './common/cElement';\r\nimport {getElementById} from './common/getElement';\r\nimport getValue from './system/getValue';\r\nimport {imageServer} from './system/system';\r\nimport insertElementAfterBegin from './common/insertElementAfterBegin';\r\nimport insertHtmlAfterBegin from './common/insertHtmlAfterBegin';\r\nimport jQueryNotPresent from './common/jQueryNotPresent';\r\nimport {pCC} from './support/layout';\r\nimport perfFilter from './common/perfFilter';\r\nimport retryAjax from './ajax/retryAjax';\r\n\r\nfunction cancelAllAH() { // jQuery\r\n  var cancelButtons = getElementById('resultRows')\r\n    .getElementsByClassName('auctionCancel');\r\n  if (cancelButtons.length === 0) {return;}\r\n  var prm = [];\r\n  for (var i = cancelButtons.length - 1; i >= 0; i -= 1) {\r\n    var cancelButton = cancelButtons[i];\r\n    var itemImage = cancelButton.parentNode.parentNode.firstElementChild\r\n      .firstElementChild;\r\n    cancelButton.outerHTML = '<img src=\"' + imageServer +\r\n      '/skin/loading.gif\" width=\"14\" height=\"14\">';\r\n    prm.push(\r\n      retryAjax({\r\n        url: 'index.php?no_mobile=1&cmd=auctionhouse&subcmd=cancel',\r\n        data: {auction_id: /inv_id=(\\d+)/.exec(itemImage.dataset.tipped)[1]}\r\n      })\r\n    );\r\n  }\r\n  $.when.apply($, prm).done(function() {\r\n    getElementById('refresh').click();\r\n  });\r\n}\r\n\r\nfunction makeCancelAll() {\r\n  var cancelAll = createSpan({\r\n    className: 'smallLink',\r\n    textContent: 'Cancel All'\r\n  });\r\n  var fill = getElementById('fill').parentNode.parentNode\r\n    .nextElementSibling.firstElementChild;\r\n  fill.classList.add('fshCenter');\r\n  insertHtmlAfterBegin(fill, ']');\r\n  insertElementAfterBegin(fill, cancelAll);\r\n  insertHtmlAfterBegin(fill, '[');\r\n  cancelAll.addEventListener('click', cancelAllAH);\r\n}\r\n\r\nfunction autoFill() {\r\n  if (getValue('autoFillMinBidPrice')) {\r\n    getElementById('auto-fill').checked = true;\r\n  }\r\n}\r\n\r\nexport function injectAuctionHouse() {\r\n  if (jQueryNotPresent() || !pCC) {return;}\r\n  makeCancelAll();\r\n  autoFill();\r\n  getElementById('sort0').click();\r\n}\r\n\r\nexport function quickCreate() {\r\n  perfFilter('auction');\r\n}\r\n","import createDocument from './system/createDocument';\r\nimport jQueryPresent from './common/jQueryPresent';\r\nimport retryAjax from './ajax/retryAjax';\r\n\r\nvar playerBank = {\r\n  headText: 'Bank',\r\n  appLink: true,\r\n  depoPos: 2,\r\n  balPos: 1,\r\n  data: {\r\n    no_mobile: 1,\r\n    cmd: 'bank',\r\n    subcmd: 'transaction'\r\n  },\r\n  initWithdraw: ''\r\n};\r\nvar guildBank = {\r\n  headText: 'Guild Bank',\r\n  appLink: false,\r\n  depoPos: 3,\r\n  balPos: 2,\r\n  data: {\r\n    no_mobile: 1,\r\n    cmd: 'guild',\r\n    subcmd: 'bank',\r\n    subcmd2: 'transaction'\r\n  },\r\n  initWithdraw: '1'\r\n};\r\nvar bankSettings;\r\n\r\nfunction doInfoBox(infoBox) { // jQuery\r\n  var target = $('#pCC #info-msg');\r\n  if (target.length === 0) {\r\n    $('#pCC').prepend(infoBox.closest('table'));\r\n  } else {\r\n    target.closest('table').replaceWith(infoBox.closest('table'));\r\n  }\r\n}\r\n\r\nfunction disableDepo(o) { // jQuery\r\n  if ($('#pCC b').eq(o.depoPos).text() === '0') {\r\n    $('#pCC input[value=\"Deposit\"]').prop('disabled', true);\r\n  }\r\n}\r\n\r\nfunction updateDepoAmount(o, doc) { // jQuery\r\n  if (o.data.deposit_amount !== '1') {\r\n    $('#pCC #deposit_amount').val($('#pCC #deposit_amount', doc).val());\r\n  } else {\r\n    $('#pCC #deposit_amount').val('1');\r\n  }\r\n}\r\n\r\nfunction transResponse(response) { // jQuery\r\n  var doc = createDocument(response);\r\n  var infoBox = $('#pCC #info-msg', doc);\r\n  if (infoBox.length === 0) {return;}\r\n  doInfoBox(infoBox);\r\n  $('#pH #statbar-gold').text($('#pH #statbar-gold', doc).text());\r\n  $('#pH #statbar-gold-tooltip-general dd').text(function(index) {\r\n    return $('#pH #statbar-gold-tooltip-general dd', doc).eq(index).text();\r\n  });\r\n  var o = bankSettings;\r\n  $('#pCC b').slice(o.balPos).text(function(index) {\r\n    return $('#pCC b', doc).slice(o.balPos).eq(index).text();\r\n  });\r\n  disableDepo(o);\r\n  updateDepoAmount(o, doc);\r\n  $('#pCC #withdraw_amount').val(o.initWithdraw);\r\n}\r\n\r\nfunction invalidAmount(o, amount) { // jQuery\r\n  return $('#pCC b').eq(o.depoPos).text() === '0' ||\r\n    !$.isNumeric(amount) || amount < 1;\r\n}\r\n\r\nfunction doAjax(oData) {\r\n  retryAjax({url: 'index.php', data: oData}).done(transResponse);\r\n}\r\n\r\nfunction bankDeposit(e) { // jQuery\r\n  e.preventDefault();\r\n  var o = bankSettings;\r\n  var amount = $('#pCC #deposit_amount').val();\r\n  if (invalidAmount(o, amount)) {return;}\r\n  o.data.mode = 'deposit';\r\n  o.data.deposit_amount = amount;\r\n  doAjax(o.data);\r\n}\r\n\r\nfunction bankWithdrawal(e) { // jQuery\r\n  e.preventDefault();\r\n  var o = bankSettings;\r\n  var amount = $('#pCC #withdraw_amount').val();\r\n  if (!$.isNumeric(amount) || amount < 1) {return;}\r\n  o.data.mode = 'withdraw';\r\n  o.data.withdraw_amount = amount;\r\n  doAjax(o.data);\r\n}\r\n\r\nfunction linkToGuildBank(o, bank) { // jQuery\r\n  if (o.appLink) {\r\n    bank.eq(0).closest('tr').after('<tr><td colspan=\"3\" align=\"center\">' +\r\n      '<a href=\"/index.php?cmd=guild&subcmd=bank\">Go to Guild Bank</a>' +\r\n      '</td></tr>');\r\n  }\r\n}\r\n\r\nfunction captureButtons(o, depo, withdraw) { // jQuery\r\n  if ($('#pCC b').eq(o.depoPos).text() === '0') { // Check Deposits Available\r\n    depo.prop('disabled', true);\r\n  } else {\r\n    depo.click(bankDeposit);\r\n  }\r\n  withdraw.click(bankWithdrawal);\r\n}\r\n\r\nfunction appLink(o, bank) { // jQuery\r\n  linkToGuildBank(o, bank);\r\n  var depo = $('#pCC input[value=\"Deposit\"]');\r\n  if (depo.length !== 1) {return;}\r\n  var withdraw = $('#pCC input[value=\"Withdraw\"]');\r\n  if (withdraw.length !== 1) {return;}\r\n  captureButtons(o, depo, withdraw);\r\n}\r\n\r\nfunction hasJquery() { // jQuery\r\n  var o = bankSettings;\r\n  var bank = $('#pCC b');\r\n  if (bank.length !== 0 && bank.eq(0).text() === o.headText) {\r\n    appLink(o, bank);\r\n  }\r\n}\r\n\r\nfunction ajaxifyBank() {\r\n  if (jQueryPresent()) {hasJquery();}\r\n}\r\n\r\nexport function injectGuildBank() {\r\n  bankSettings = guildBank;\r\n  ajaxifyBank();\r\n}\r\n\r\nexport function injectBank() {\r\n  bankSettings = playerBank;\r\n  ajaxifyBank();\r\n}\r\n","import {getElementById} from '../common/getElement';\r\n\r\nvar maxcharacters;\r\nvar textArea;\r\nvar shoutboxPreview;\r\n\r\nfunction updateShoutboxPreview() {\r\n  var textContent = textArea.value;\r\n  var chars = textContent.length;\r\n  if (chars > maxcharacters) {\r\n    textContent = textContent.substring(0, maxcharacters);\r\n    textArea.value = textContent;\r\n    chars = maxcharacters;\r\n  }\r\n  if (!shoutboxPreview) {\r\n    shoutboxPreview = textArea.parentNode.parentNode.parentNode.parentNode\r\n      .insertRow().insertCell();\r\n  }\r\n  shoutboxPreview.innerHTML = '<table class=\"sbpTbl\"><tbody><tr>' +\r\n    '<td class=\"sbpHdr\">Preview (' + chars + '/' + maxcharacters +\r\n    ' characters)</td></tr><tr><td class=\"sbpMsg\"><span>' + textContent +\r\n    '</span></td></tr></tbody></table>';\r\n}\r\n\r\nfunction injectShoutboxWidgets() {\r\n  textArea = getElementById('textInputBox');\r\n  textArea.addEventListener('keyup', updateShoutboxPreview);\r\n}\r\n\r\nexport function newsFsbox() {\r\n  maxcharacters = 100;\r\n  injectShoutboxWidgets();\r\n}\r\n\r\nexport function newsShoutbox() {\r\n  maxcharacters = 150;\r\n  injectShoutboxWidgets();\r\n}\r\n","import allowBack from '../guide/allowBack';\r\nimport completedArenas from '../arena/completedArenas';\r\nimport composingBreakdown from '../composing/breakdown';\r\nimport craftForge from '../craftForge/craftForge';\r\nimport globalQuest from '../topRated/globalQuest';\r\nimport guildHall from '../guild/hall';\r\nimport guildMailbox from '../mailbox/guildMailbox';\r\nimport injectAdvisor from '../guildAdvisor';\r\nimport injectArena from '../arena/arena';\r\nimport injectBazaar from '../bazaar';\r\nimport injectBioWidgets from '../profile/bio/bioWidgets';\r\nimport injectBuffLog from '../buffLog/injectBuffLog';\r\nimport injectGroupStats from '../groups/injectGroupStats';\r\nimport injectGroups from '../groups/groups';\r\nimport injectGuild from '../guild/guild';\r\nimport injectGuildAddTagsWidgets from '../guild/injectGuildAddTagsWidgets';\r\nimport injectGuildRanks from '../rank';\r\nimport {injectInventoryManagerNew} from '../inventory/inventory';\r\nimport injectMailbox from '../mailbox/mailbox';\r\nimport injectMonsterLog from '../monstorLog';\r\nimport injectNewGuildLog from '../newGuildLog/newGuildLog';\r\nimport injectNotepadShowLogs from '../combatLog';\r\nimport injectOnlinePlayers from '../onlinePlayers';\r\nimport injectProfile from '../profile/profile';\r\nimport injectProfileDropItems from '../dropItems/injectProfileDropItems';\r\nimport injectQuickBuff from '../quickBuff';\r\nimport injectRPUpgrades from '../guild/injectRPUpgrades';\r\nimport injectRecipeManager from '../recipeMgr/recipeMgr';\r\nimport injectReportPaint from '../guildReport/guildReport';\r\nimport injectSaveSettings from '../settings/load';\r\nimport injectScavenging from '../scavenging';\r\nimport injectScouttower from '../scoutTower/injectScouttower';\r\nimport injectSettings from '../settings/injectSettings';\r\nimport injectStoreItems from '../dropItems/injectStoreItems';\r\nimport injectTitan from '../scoutTower/injectTitan';\r\nimport injectTopRated from '../topRated/toprated';\r\nimport injectTrade from '../trade/trade';\r\nimport injectViewGuild from '../guild/injectViewGuild';\r\nimport injectWorld from '../legacy/legacy';\r\nimport insertQuickExtract from '../quickExtract';\r\nimport insertQuickWear from '../quickWear/quickWear';\r\nimport inventing from '../recipes';\r\nimport ladder from '../ladder';\r\nimport marketplace from '../marketplace';\r\nimport parseGoldUpgrades from '../notification/parseGoldUpgrades';\r\nimport {parseTemplePage} from '../notification/parseTemplePage';\r\nimport setupMoves from '../arena/setup';\r\nimport showAllQuestSteps from '../guide/showAllQuestSteps';\r\nimport storeMoves from '../arena/store';\r\nimport storePlayerUpgrades from '../upgrades';\r\nimport superelite from '../seLog/superelite';\r\nimport unknownPage from './unknownPage';\r\nimport viewArchive from '../news/viewArchive';\r\nimport {composingCreate, injectComposing} from '../composing/composing';\r\nimport {guildChat, guildLog, outbox, playerLog} from '../logs/logs';\r\nimport {injectAuctionHouse, quickCreate} from '../auctionHouse';\r\nimport {injectAuctionSearch, injectQuickLinkManager} from '../lists/lists';\r\nimport {injectBank, injectGuildBank} from '../bank';\r\nimport {injectFindBuffs, injectFindOther} from '../findBuffs/findBuffs';\r\nimport {\r\n  injectFindPlayer,\r\n  injectFsBoxContent,\r\n  injectNotepad\r\n} from '../misc';\r\nimport {injectQuestBookFull, injectQuestTracker} from '../questBook';\r\nimport {newsFsbox, newsShoutbox} from '../news/news';\r\n\r\nexport default {\r\n  settings: {'-': {'-': {'-': {'-': injectSettings}}}},\r\n  world: {'-': {'-': {'-': {'-': injectWorld}}}},\r\n  news: {\r\n    fsbox: {'-': {'-': {'-': newsFsbox}}},\r\n    shoutbox: {'-': {'-': {'-': newsShoutbox}}}\r\n  },\r\n  blacksmith: {repairall: {'-': {'-': {'1': injectWorld}}}},\r\n  arena: {\r\n    '-': {'-': {'-': {'-': injectArena}}},\r\n    join: {'-': {'-': {'-': injectArena}}},\r\n    completed: {'-': {'-': {'-': completedArenas}}},\r\n    pickmove: {'-': {'-': {'-': storeMoves}}},\r\n    setup: {'-': {'-': {'-': setupMoves}}}\r\n  },\r\n  questbook: {\r\n    '-': {'-': {'-': {'-': injectQuestBookFull}}},\r\n    atoz: {'-': {'-': {'-': injectQuestBookFull}}},\r\n    viewquest: {'-': {'-': {'-': injectQuestTracker}}}\r\n  },\r\n  profile: {\r\n    '-': {'-': {'-': {'-': injectProfile}}},\r\n    managecombatset: {'-': {'-': {'-': injectProfile}}},\r\n    report: {'-': {'-': {'-': injectProfile}}},\r\n    equipitem: {'-': {'-': {'-': injectProfile}}},\r\n    useitem: {'-': {'-': {'-': injectProfile}}},\r\n    changebio: {'-': {'-': {'-': injectBioWidgets}}},\r\n    dropitems: {'-': {'-': {'-': injectProfileDropItems}}}\r\n  },\r\n  auctionhouse: {\r\n    '-': {'-': {'-': {'-': injectAuctionHouse}}},\r\n    quickcreate: {'-': {'-': {'-': quickCreate}}}\r\n  },\r\n  guild: {\r\n    inventory: {\r\n      report: {'-': {'-': injectReportPaint}},\r\n      addtags: {'-': {'-': injectGuildAddTagsWidgets}},\r\n      removetags: {'-': {'-': injectGuildAddTagsWidgets}},\r\n      storeitems: {'-': {'-': injectStoreItems}}\r\n    },\r\n    chat: {'-': {'-': {'-': guildChat}}},\r\n    log: {'-': {'-': {'-': guildLog}}},\r\n    groups: {\r\n      viewstats: {'-': {'-': injectGroupStats}},\r\n      joinallgroupsundersize: {'-': {'-': injectGroups}},\r\n      joinall: {'-': {'-': injectGroups}},\r\n      '-': {'-': {'-': injectGroups}}\r\n    },\r\n    manage: {'-': {'-': {'-': injectGuild}}},\r\n    advisor: {\r\n      '-': {'-': {'-': injectAdvisor}},\r\n      weekly: {'-': {'-': injectAdvisor}}\r\n    },\r\n    history: {'-': {'-': {'-': injectBioWidgets}}},\r\n    view: {'-': {'-': {'-': injectViewGuild}}},\r\n    scouttower: {'-': {'-': {'-': injectScouttower}}},\r\n    mailbox: {'-': {'-': {'-': guildMailbox}}},\r\n    ranks: {'-': {'-': {'-': injectGuildRanks}}},\r\n    conflicts: {rpupgrades: {'-': {'-': injectRPUpgrades}}},\r\n    bank: {'-': {'-': {'-': injectGuildBank}}},\r\n    hall: {\r\n      '-': {'-': {'-': guildHall}},\r\n      post: {'-': {'-': injectBioWidgets}}\r\n    }\r\n  },\r\n  bank: {'-': {'-': {'-': {'-': injectBank}}}},\r\n  log: {\r\n    '-': {'-': {'-': {'-': playerLog}}},\r\n    outbox: {'-': {'-': {'-': outbox}}}\r\n  },\r\n  potionbazaar: {'-': {'-': {'-': {'-': injectBazaar}}}},\r\n  marketplace: {createreq: {'-': {'-': {'-': marketplace}}}},\r\n  quickbuff: {'-': {'-': {'-': {'-': injectQuickBuff}}}}, // No ga\r\n  notepad: {\r\n    showlogs: {'-': {'-': {'-': injectNotepadShowLogs}}}, // done\r\n    invmanagernew: {'-': {'-': {'-': injectInventoryManagerNew}}},\r\n    guildinvmgr: {'-': {'-': {'-': injectInventoryManagerNew}}},\r\n    recipemanager: {'-': {'-': {'-': injectRecipeManager}}}, // done\r\n    auctionsearch: {'-': {'-': {'-': injectAuctionSearch}}},\r\n    onlineplayers: {'-': {'-': {'-': injectOnlinePlayers}}}, // done\r\n    quicklinkmanager: {'-': {'-': {'-': injectQuickLinkManager}}}, // done\r\n    monsterlog: {'-': {'-': {'-': injectMonsterLog}}}, // done\r\n    quickextract: {'-': {'-': {'-': insertQuickExtract}}}, // done\r\n    quickwear: {'-': {'-': {'-': insertQuickWear}}}, // done\r\n    fsboxcontent: {'-': {'-': {'-': injectFsBoxContent}}}, // done\r\n    bufflogcontent: {'-': {'-': {'-': injectBuffLog}}}, // done\r\n    newguildlog: {'-': {'-': {'-': injectNewGuildLog}}},\r\n    findbuffs: {'-': {'-': {'-': injectFindBuffs}}}, // done\r\n    findother: {'-': {'-': {'-': injectFindOther}}}, // done\r\n    savesettings: {'-': {'-': {'-': injectSaveSettings}}},\r\n    '-': {'-': {'-': {'-': injectNotepad}}}\r\n  },\r\n  points: {\r\n    '-': {\r\n      '-': {\r\n        '-': {'-': storePlayerUpgrades},\r\n        '0': {'-': storePlayerUpgrades},\r\n        '1': {'-': parseGoldUpgrades}\r\n      }\r\n    }\r\n  },\r\n  trade: {\r\n    '-': {'-': {'-': {'-': injectTrade}}},\r\n    createsecure: {'-': {'-': {'-': injectTrade}}},\r\n    docreatesecure: {'-': {'-': {'-': injectTrade}}}\r\n  },\r\n  titan: {'-': {'-': {'-': {'-': injectTitan}}}},\r\n  toprated: {\r\n    xp: {'-': {'-': {'-': injectTopRated}}},\r\n    monthlyxp: {'-': {'-': {'-': injectTopRated}}},\r\n    gold: {'-': {'-': {'-': injectTopRated}}},\r\n    killstreak: {'-': {'-': {'-': injectTopRated}}},\r\n    bounties: {'-': {'-': {'-': injectTopRated}}},\r\n    risingstars: {'-': {'-': {'-': injectTopRated}}},\r\n    arena: {'-': {'-': {'-': injectTopRated}}},\r\n    superelites: {'-': {'-': {'-': injectTopRated}}},\r\n    smasher: {'-': {'-': {'-': injectTopRated}}},\r\n    globalquest: {'-': {'-': {'-': globalQuest}}}\r\n  },\r\n  inventing: {viewrecipe: {'-': {'-': {'-': inventing}}}},\r\n  tempinv: {'-': {'-': {'-': {'-': injectMailbox}}}},\r\n  findplayer: {'-': {'-': {'-': {'-': injectFindPlayer}}}},\r\n  quests: { // UFSG\r\n    '-': {'-': {'-': {'-': allowBack}}},\r\n    view: {'-': {'-': {'-': showAllQuestSteps}}}\r\n  },\r\n  items: {'-': {'-': {'-': {'-': allowBack}}}}, // UFSG\r\n  creatures: {'-': {'-': {'-': {'-': allowBack}}}}, // UFSG\r\n  masterrealms: {'-': {'-': {'-': {'-': allowBack}}}}, // UFSG\r\n  realms: {'-': {'-': {'-': {'-': allowBack}}}}, // UFSG\r\n  relics: {'-': {'-': {'-': {'-': allowBack}}}}, // UFSG\r\n  shops: {'-': {'-': {'-': {'-': allowBack}}}}, // UFSG\r\n  scavenging: {'-': {'-': {'-': {'-': injectScavenging}}}},\r\n  temple: {'-': {'-': {'-': {'-': parseTemplePage}}}},\r\n  composing: {\r\n    '-': {'-': {'-': {'-': injectComposing}}},\r\n    breakdown: {'-': {'-': {'-': composingBreakdown}}},\r\n    create: {'-': {'-': {'-': composingCreate}}}\r\n  },\r\n  pvpladder: {'-': {'-': {'-': {'-': ladder}}}},\r\n  crafting: {'-': {'-': {'-': {'-': craftForge}}}},\r\n  hellforge: {'-': {'-': {'-': {'-': craftForge}}}},\r\n  superelite: {'-': {'-': {'-': {'-': superelite}}}},\r\n  '-': {\r\n    viewupdatearchive: {'-': {'-': {'-': viewArchive}}},\r\n    viewarchive: {'-': {'-': {'-': viewArchive}}},\r\n    '-': {'-': {'-': {'-': unknownPage}}}\r\n  }\r\n};\r\n","import add from '../support/task';\r\nimport calf from '../support/calf';\r\nimport doQuickLinks from './doQuickLinks';\r\nimport fallback from '../system/fallback';\r\nimport getUrlParameter from '../system/getUrlParameter';\r\nimport isFunction from '../common/isFunction';\r\nimport isMessageSound from './isMessageSound';\r\nimport isObject from '../common/isObject';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport lookForHcsData from './lookForHcsData';\r\nimport pageSwitcher from './pageSwitcher';\r\nimport {end, screenview, setup, start} from '../support/fshGa';\r\n\r\nvar coreFunction;\r\nvar functionPath;\r\n\r\nfunction getType(cmd) {\r\n  var type = '-';\r\n  if (cmd === 'points') {\r\n    type = fallback(getUrlParameter('type'), '-');\r\n  }\r\n  return type;\r\n}\r\n\r\nfunction newSelector(selector) {\r\n  var test_cmd = document.querySelector(selector);\r\n  return test_cmd && test_cmd.value || '-';\r\n}\r\n\r\nvar isValid = [\r\n  function(cmd) {return pageSwitcher[cmd];},\r\n  function(cmd, subcmd) {return pageSwitcher[cmd][subcmd];},\r\n  function(cmd, subcmd, subcmd2) {return pageSwitcher[cmd][subcmd][subcmd2];},\r\n  function(cmd, subcmd, subcmd2, type) {\r\n    return pageSwitcher[cmd][subcmd][subcmd2][type];\r\n  }\r\n];\r\n\r\nfunction testCoreFunction(cmd, subcmd, subcmd2, type, fromWorld) {\r\n  if (isValid.every(function(e) {\r\n    return isObject(e(cmd, subcmd, subcmd2, type));\r\n  }) && pageSwitcher[cmd][subcmd][subcmd2][type][fromWorld]) {\r\n    return pageSwitcher[cmd][subcmd][subcmd2][type][fromWorld];\r\n  }\r\n}\r\n\r\nfunction getCoreFunction() {\r\n  var cmd;\r\n  var subcmd;\r\n  var subcmd2;\r\n  var type;\r\n  var fromWorld;\r\n  if (document.location.search !== '') {\r\n    cmd = fallback(getUrlParameter('cmd'), '-');\r\n    subcmd = fallback(getUrlParameter('subcmd'), '-');\r\n    subcmd2 = fallback(getUrlParameter('subcmd2'), '-');\r\n    type = getType(cmd);\r\n    fromWorld = fallback(getUrlParameter('fromworld'), '-');\r\n  } else {\r\n    cmd = newSelector('input[name=\"cmd\"]');\r\n    subcmd = newSelector('input[name=\"subcmd\"]');\r\n    if (subcmd === 'dochat') {\r\n      cmd = '-';\r\n      subcmd = '-';\r\n    }\r\n    subcmd2 = newSelector('input[name=\"subcmd2\"]');\r\n    type = '-';\r\n    fromWorld = '-';\r\n  }\r\n  calf.cmd = cmd;\r\n  calf.subcmd = subcmd;\r\n  calf.subcmd2 = subcmd2;\r\n  functionPath = cmd + '/' + subcmd + '/' + subcmd2 + '/' + type + '/' +\r\n    fromWorld;\r\n\r\n  coreFunction = testCoreFunction(cmd, subcmd, subcmd2, type, fromWorld);\r\n}\r\n\r\nfunction devHooks() {\r\n  /* eslint-disable no-console */\r\n  console.log('functionPath', functionPath);\r\n  if (!coreFunction) {\r\n    console.log('No Core Function.');\r\n  } else if (typeof coreFunction !== 'function') {\r\n    console.log('Not Core Function.');\r\n  }\r\n  /* eslint-enable no-console */\r\n}\r\n\r\nfunction asyncDispatcher() {\r\n  //#if _DEV  //  asyncDispatcher messages\r\n  devHooks();\r\n  //#endif\r\n  if (isFunction(coreFunction)) {\r\n    screenview(functionPath);\r\n    start('JS Perf', functionPath);\r\n    coreFunction();\r\n    end('JS Perf', functionPath);\r\n  }\r\n}\r\n\r\nwindow.FSH = window.FSH || {};\r\nwindow.FSH.calf = '$_CALFVER';\r\n\r\n// main event dispatcher\r\nwindow.FSH.dispatch = function dispatch() {\r\n\r\n  setup();\r\n  start('JS Perf', 'FSH.dispatch');\r\n\r\n  getCoreFunction();\r\n  lookForHcsData();\r\n  add(3, asyncDispatcher);\r\n\r\n  if (jQueryNotPresent()) {return;}\r\n\r\n  isMessageSound();\r\n\r\n  /* This must be at the end in order not to\r\n  screw up other findNode calls (Issue 351) */\r\n  doQuickLinks();\r\n\r\n  end('JS Perf', 'FSH.dispatch');\r\n\r\n};\r\n","import injectMoveItems from './injectMoveItems';\r\nimport injectStoreItems from './injectStoreItems';\r\n\r\nexport default function injectProfileDropItems() {\r\n  injectStoreItems();\r\n  injectMoveItems();\r\n}\r\n","import insertHtmlAfterEnd from '../common/insertHtmlAfterEnd';\r\nimport {pCC} from '../support/layout';\r\n\r\nexport default function injectMoveItems() {\r\n  var flrRow = pCC.getElementsByTagName('form')[0]\r\n    .nextElementSibling.nextElementSibling.nextElementSibling;\r\n  var folders = flrRow.getElementsByTagName('img');\r\n  var flrEnabled;\r\n  var oFlr;\r\n  var options = '<tr><td class=\"fshCenter\">Move selected items to: ' +\r\n    '<select name=\"folder\" id=\"selectFolderId\" class=\"customselect\">';\r\n  Array.prototype.forEach.call(folders, function(e) {\r\n    var src = e.getAttribute('src');\r\n    if (src.indexOf('/folder_on.gif') !== -1) {flrEnabled = true;}\r\n    if (src.indexOf('/folder.gif') !== -1) {\r\n      oFlr = true;\r\n      options += '<option value=' + e.parentNode.href\r\n        .match(/&folder_id=(-*\\d+)/i)[1] + '>' +\r\n        e.parentNode.parentNode.textContent + '</option>';\r\n    }\r\n  });\r\n  if (!flrEnabled || !oFlr) {return;}\r\n  options += '</select>&nbsp;<input type=\"button\" class=\"custombutton\" ' +\r\n    'id=\"fshMove\" value=\"Move\"></td></tr>';\r\n  insertHtmlAfterEnd(flrRow, options);\r\n}\r\n","import add from '../support/task';\r\nimport eventHandlers from './eventHandlers';\r\nimport getMembrList from '../ajax/getMembrList';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport {pCC} from '../support/layout';\r\nimport prepareChildRows from './prepareChildRows';\r\nimport reportHeader from './reportHeader';\r\nimport searchUser from './searchUser';\r\n\r\nexport default function injectReportPaint() { // jQuery\r\n  if (jQueryNotPresent()) {return;}\r\n  getMembrList(false).done(function() {\r\n    add(3, reportHeader);\r\n  });\r\n  add(2, searchUser);\r\n  add(3, prepareChildRows);\r\n  pCC.getElementsByTagName('TABLE')[1]\r\n    .addEventListener('click', eventHandlers);\r\n}\r\n","import addChatTextArea from './addChatTextArea';\r\nimport addGuildLogWidgets from './addGuildLogWidgets';\r\nimport addLogColoring from './addLogColoring';\r\nimport addLogWidgets from './addLogWidgets';\r\n\r\nexport function guildChat() {\r\n  addChatTextArea();\r\n  addLogColoring('Chat', 0);\r\n}\r\n\r\nexport function guildLog() {\r\n  addLogColoring('GuildLog', 1);\r\n  addGuildLogWidgets();\r\n}\r\n\r\nexport function outbox() {\r\n  addLogColoring('OutBox', 1);\r\n}\r\n\r\nexport function playerLog() {\r\n  addLogColoring('PlayerLog', 1);\r\n  addLogWidgets();\r\n}\r\n","import {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\nimport isObject from '../common/isObject';\r\nimport jQueryNotPresent from '../common/jQueryNotPresent';\r\nimport jsonParse from '../common/jsonParse';\r\nimport {pCC} from '../support/layout';\r\nimport setValue from '../system/setValue';\r\n\r\nexport default function injectSaveSettings() { // Hybrid\r\n  if (jQueryNotPresent()) {return;}\r\n  var content = pCC;\r\n  var fshSettings = {};\r\n  var list = GM_listValues();\r\n  for (var i = 0; i < list.length; i += 1) {\r\n    fshSettings[list[i]] = getValue(list[i]);\r\n  }\r\n  content.innerHTML = '<h1>FSH Settings</h1><br><center>The box below ' +\r\n    'is your current settings. Copy it to save your current settings<br>' +\r\n    'To load saved settings, simply replace the contents of the box with ' +\r\n    'your saved copy and press the button below.' +\r\n    '<textarea align=\"center\" cols=\"80\" rows=\"25\" style=\"' +\r\n    'background-color:white;' +\r\n    'font-family:Consolas,\\'Lucida Console\\',\\'Courier New\\',monospace;\" ' +\r\n    'id=\"HelperfshSettings\" name=\"fshSettings\">' +\r\n    JSON.stringify(fshSettings) + '</textarea>' +\r\n    '<br><input id=\"HelperLoadSettings\" class=\"custombutton\" ' +\r\n    'type=\"submit\" value=\"Load Settings!\" /></center>';\r\n  $('#HelperLoadSettings').click(function() {\r\n    var userInput = jsonParse(getElementById('HelperfshSettings').value);\r\n    if (isObject(userInput)) {\r\n      var settings = userInput;\r\n      Object.keys(settings).forEach(function(id) {\r\n        setValue(id, settings[id]);\r\n      });\r\n      $('#dialog_msg').text('Settings loaded successfully!').dialog('open');\r\n    }\r\n  });\r\n}\r\n","import insertHtmlBeforeEnd from '../common/insertHtmlBeforeEnd';\r\nimport {pCC} from '../support/layout';\r\n\r\nexport default function injectTitan() {\r\n  var titanTable = pCC.children[0];\r\n  var newRow = titanTable.insertRow(2);\r\n  insertHtmlBeforeEnd(newRow, '<br>');\r\n  newRow = titanTable.insertRow(3);\r\n  insertHtmlBeforeEnd(newRow, '<td class=\"fshCenter fshBold\">[ ' +\r\n    '<a href=\"index.php?cmd=guild&subcmd=scouttower\">Scout Tower</a> ]</td>');\r\n}\r\n","import {pCC} from '../support/layout';\r\n\r\nexport default function globalQuest() {\r\n  var topTable = pCC.getElementsByTagName('table')[3];\r\n  for (var i = 2; i < topTable.rows.length; i += 4) {\r\n    var aCell = topTable.rows[i].cells[1];\r\n    aCell.innerHTML = '<a href=\"index.php?cmd=findplayer' +\r\n      '&search_show_first=1&search_active=1&search_username=' +\r\n      aCell.textContent + '\">' + aCell.textContent + '</a>';\r\n  }\r\n}\r\n","import {getElementById} from '../common/getElement';\r\nimport getValue from '../system/getValue';\r\n\r\nexport default function showAllQuestSteps() {\r\n  if (!getValue('showNextQuestSteps')) {return;}\r\n  Array.prototype.forEach.call(document.querySelectorAll('div[id^=\"stage\"]'),\r\n    function(e) {e.style.display = 'block';});\r\n  getElementById('next_stage_button').style.display = 'none';\r\n}\r\n"]}